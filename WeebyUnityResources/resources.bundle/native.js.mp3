;(function() {
window.BUILD_TARGET="native-ios";
window.BUILD_ENV="native";
window.DEBUG=true;
window.DEV_MODE=true;
window.ADDON_WEEBY=true;
window.CONFIG={"appID":"6c6f7c977d6a4d4698d66b3b5e36aa2f","shortName":"weebyUnityGame","title":"weebyUnityGame","disableNativeViews":false,"target":"native-ios","servicesURL":"http://api.gameclosure.com","noRedirect":false,"inviteURLTemplate":"http://weebyUnityGame.studio.example.com/?i={code}","splash":{"autoHide":true,"portrait480":"resources/splash/portrait480.png","portrait960":"resources/splash/portrait960.png","portrait1024":"resources/splash/portrait1024.png","portrait1136":"resources/splash/portrait1136.png","portrait2048":"resources/splash/portrait2048.png","landscape768":"resources/splash/landscape768.png","landscape1536":"resources/splash/landscape1536.png"},"useDOM":false,"sdkVersion":"unknown"};
window.CONFIG.baseURL = window.location.toString().match(/(.*\/).*$/)[1];
})();window.CACHE = {"resources/fonts/fontsheetSizeMap.json":"{}","resources/weebyConfig.json":"{\"stringsDir\":\"resources/strings/\",\"equipSlots\":3,\"songs\":{\"leaderboard\":\"puzz_forest\"},\"lifeRegenTimeMS\":480000,\"equipItems\":[{\"id\":\"guide\",\"name\":\"guide_name\",\"description\":\"guide_description\",\"price\":5,\"currency\":\"common\",\"displayPrice\":\"5\",\"iconUrl\":\"resources/images/icon_guide.png\",\"isSpecialCurrency\":false},{\"id\":\"time\",\"name\":\"time_name\",\"description\":\"time_description\",\"price\":20,\"currency\":\"common\",\"displayPrice\":\"20\",\"iconUrl\":\"resources/images/icon_time.png\",\"isSpecialCurrency\":false},{\"id\":\"bombs\",\"name\":\"bombs_name\",\"description\":\"bombs_description\",\"price\":30,\"currency\":\"common\",\"displayPrice\":\"30\",\"iconUrl\":\"resources/images/icon_bombs.png\",\"isSpecialCurrency\":false},{\"id\":\"meteors\",\"name\":\"meteors_name\",\"description\":\"meteors_description\",\"price\":40,\"currency\":\"common\",\"displayPrice\":\"40\",\"iconUrl\":\"resources/images/icon_shooting_star.png\",\"isSpecialCurrency\":false}],\"buyItems\":{\"common\":[{\"id\":\"coins_9\",\"displayName\":\"coins_9_displayName\",\"displayCost\":\"coins_9_displayCost\",\"cost\":1,\"displayAmount\":\"9\",\"rewardAmount\":9,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"common\",\"hasSale\":false,\"iconUrl\":\"addons/weeby/theme/images/icon_common.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"coins_45\",\"displayName\":\"coins_45_displayName\",\"displayCost\":\"coins_45_displayCost\",\"cost\":4,\"displayAmount\":\"45\",\"rewardAmount\":45,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"common\",\"hasSale\":true,\"displaySaleTitle\":\"+25%\",\"iconUrl\":\"addons/weeby/theme/images/icon_common.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"coins_180\",\"displayName\":\"coins_180_displayName\",\"displayCost\":\"coins_180_displayCost\",\"cost\":15,\"displayAmount\":\"180\",\"rewardAmount\":180,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"common\",\"hasSale\":true,\"displaySaleTitle\":\"+33%\",\"iconUrl\":\"addons/weeby/theme/images/icon_common.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"coins_450\",\"displayName\":\"coins_450_displayName\",\"displayCost\":\"coins_450_displayCost\",\"cost\":30,\"displayAmount\":\"450\",\"rewardAmount\":450,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"common\",\"hasSale\":true,\"displaySaleTitle\":\"+67%\",\"iconUrl\":\"addons/weeby/theme/images/icon_common.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"coins_900\",\"displayName\":\"coins_900_displayName\",\"displayCost\":\"coins_900_displayCost\",\"cost\":55,\"displayAmount\":\"900\",\"rewardAmount\":900,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"common\",\"hasSale\":true,\"displaySaleTitle\":\"+82%\",\"iconUrl\":\"addons/weeby/theme/images/icon_common.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"}],\"premium\":[{\"id\":\"gems_5\",\"displayName\":\"gems_5_displayName\",\"displayCost\":\"gems_5_displayCost\",\"cost\":0.99,\"displayAmount\":\"5\",\"rewardAmount\":5,\"purchaseCurrency\":\"real_money\",\"rewardCurrency\":\"premium\",\"hasSale\":false,\"iconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"gems_30\",\"displayName\":\"gems_30_displayName\",\"displayCost\":\"gems_30_displayCost\",\"cost\":4.99,\"displayAmount\":\"30\",\"rewardAmount\":30,\"purchaseCurrency\":\"real_money\",\"rewardCurrency\":\"premium\",\"hasSale\":true,\"displaySaleTitle\":\"+20%\",\"iconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"gems_65\",\"displayName\":\"gems_65_displayName\",\"displayCost\":\"gems_65_displayCost\",\"cost\":9.99,\"displayAmount\":\"65\",\"rewardAmount\":65,\"purchaseCurrency\":\"real_money\",\"rewardCurrency\":\"premium\",\"hasSale\":true,\"displaySaleTitle\":\"+30%\",\"iconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"gems_200\",\"displayName\":\"gems_200_displayName\",\"displayCost\":\"gems_200_displayCost\",\"cost\":29.99,\"displayAmount\":\"200\",\"rewardAmount\":200,\"purchaseCurrency\":\"real_money\",\"rewardCurrency\":\"premium\",\"hasSale\":true,\"displaySaleTitle\":\"+33%\",\"iconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"gems_350\",\"displayName\":\"gems_350_displayName\",\"displayCost\":\"gems_350_displayCost\",\"cost\":49.99,\"displayAmount\":\"350\",\"rewardAmount\":350,\"purchaseCurrency\":\"real_money\",\"rewardCurrency\":\"premium\",\"hasSale\":true,\"displaySaleTitle\":\"+40%\",\"iconUrl\":\"addons/weeby/theme/images/icon_premium.png\"}],\"life\":[{\"id\":\"life_5\",\"displayName\":\"life_5_displayName\",\"displayCost\":\"life_5_displayCost\",\"cost\":5,\"displayAmount\":\"5\",\"rewardAmount\":5,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"life\",\"hasSale\":false,\"iconUrl\":\"addons/weeby/theme/images/icon_life.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"life_12\",\"displayName\":\"life_12_displayName\",\"displayCost\":\"life_12_displayCost\",\"cost\":10,\"displayAmount\":\"12\",\"rewardAmount\":12,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"life\",\"hasSale\":true,\"displaySaleTitle\":\"+20%\",\"iconUrl\":\"addons/weeby/theme/images/icon_life.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"},{\"id\":\"life_25\",\"displayName\":\"life_25_displayName\",\"displayCost\":\"life_25_displayCost\",\"cost\":20,\"displayAmount\":\"25\",\"rewardAmount\":25,\"purchaseCurrency\":\"premium\",\"rewardCurrency\":\"life\",\"hasSale\":true,\"displaySaleTitle\":\"+25%\",\"iconUrl\":\"addons/weeby/theme/images/icon_life.png\",\"costIconUrl\":\"addons/weeby/theme/images/icon_premium.png\"}]},\"currencies\":{\"common\":{\"iconUrl\":\"addons/weeby/theme/images/icon_common.png\",\"displayName\":\"Coins\",\"startAmount\":\"200\",\"notEnoughDialog\":{\"title\":\"currencies_common_notEnoughDialog_title\",\"text\":\"currencies_common_notEnoughDialog_text\"}},\"premium\":{\"iconUrl\":\"addons/weeby/theme/images/icon_premium.png\",\"displayName\":\"Gems\",\"startAmount\":\"50\",\"notEnoughDialog\":{\"title\":\"currencies_premium_notEnoughDialog_title\",\"text\":\"currencies_premium_notEnoughDialog_text\"}},\"life\":{\"iconUrl\":\"addons/weeby/theme/images/icon_life.png\",\"displayName\":\"Lives\",\"notEnoughDialog\":{\"title\":\"currencies_life_notEnoughDialog_title\",\"text\":\"currencies_life_notEnoughDialog_text\"},\"tooManyDialog\":{\"title\":\"currencies_life_tooManyDialog_title\",\"text\":\"currencies_life_tooManyDialog_text\"}}},\"balance\":{\"minScoreForXP\":10000,\"minAdjustedScore\":50000,\"maxAdjustedScore\":1000000,\"levelUpRewardPremiumMultiplier\":0,\"levelUpRewardPremiumAddition\":1,\"levelUpRewardCommonMultiplier\":10,\"levelUpRewardCommonAddition\":0},\"maxLives\":100,\"billingPublicKey\":\"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjEs7EiQlh3EtJM0bbmE9d7HWa6hBgbhL3UZK/0idkknMCWuODHAVnFbuVazzOHY8X1lFXHy8q+ZGnihXieVEDaa+/pLGPLutawGKcHJyq+RyzWWgQNr9O/7OdaSG9qkFVTA3TfFQlplJSxdRB85Jf/QJ3DBSRNDpmrPE98Wff3Ab8uwDm0jldh0TdB9b7nEF1ydzXEyyyyWo2uCqG6kkKUKxBH1xjg9og99rnPEKHEhMJFYujoUbibB3mQn+ivFll9Rn/FIVL803ziIY3zShhNB3/gQBaUb0etOct5qY5whI31tkv+9Cwbyzo7xosGgaXzk/55wJykcYeGk7i+HbEQIDAQAB\",\"notifications\":{\"notifEnergyRefill\":\"notifications_notifEnergyRefill\",\"notifGiftReceived\":\"notifications_notifGiftReceived\",\"notifPassedOnLeaderboard\":\"notifications_notifPassedOnLeaderboard\",\"notif1Day\":\"notifications_notif1Day\",\"notif3Day\":\"notifications_notif3Day\",\"notif5Day\":\"notifications_notif5Day\"}}","spritesheetSizeMap.json":"{}","spritesheets/map.json":"{\"resources/fonts/fontsheetSizeMap.json\":{},\"resources/splash/portrait2048.png\":{},\"resources/splash/portrait1136.png\":{},\"resources/splash/landscape768.png\":{},\"resources/icons/icon512.png\":{},\"resources/splash/portrait480.png\":{},\"resources/splash/portrait960.png\":{},\"resources/icons/ios72.png\":{},\"resources/icons/android72.png\":{},\"resources/icons/android96.png\":{},\"resources/icons/ios144.png\":{},\"resources/splash/landscape1536.png\":{},\"resources/icons/ios57.png\":{},\"resources/icons/ios114.png\":{},\"resources/icons/android36.png\":{},\"resources/icons/android48.png\":{},\"resources/splash/portrait1024.png\":{}}"};// Copyright (c) 2010
// Michael Carter (cartermichael@gmail.com)
// Martin Hunt (mghunt@gmail.com)
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

// Initialization of js.io occurs in a closure, preventing local variables
// from entering the global scope.  During execution, the method `jsio` is
// added to the global scope.

;(function() {
	function init(cloneFrom) {
		// We expect this code to be minified before production use, so we may
		// write code slightly more verbosely than we otherwise would.
	
		// Should we parse syntax errors in the browser?
		var DEBUG = true;
	
		// Store a reference to the slice function for converting objects of
		// type arguments to type array.
		var SLICE = Array.prototype.slice;
	
		// js.io supports multiple JavaScript environments such as node.js and
		// most web browsers (IE, Firefox, WebKit).  The ENV object wraps 
		// any utility functions that contain environment-specific code (e.g.
		// reading a file using node's `fs` library or a browser's
		// `XMLHttpRequest`).  Running js.io in other JavaScript environments
		// is as easy as implementing an environment object that conforms to 
		// the abstract interface for an environment (provided below) and 
		// calling `jsio.setEnv()`.
		var ENV;
	
		// Checks if the last character in a string is `/`.
		var rexpEndSlash = /\/|\\$/;

		function getModuleDef (path) {
			path += '.js';
			return jsio.__modules[path] || new ModuleDef(path);
		}
	
		// Creates an object containing metadata about a module.
		function ModuleDef (path) {
			this.path = path;
			this.friendlyPath = path;
			util.splitPath(path, this);
		};

		ModuleDef.prototype.setBase = function (baseMod, basePath) {
			this.baseMod = baseMod;
			this.basePath = basePath;
		};
	
		// Utility functions
		var util = {
				// `util.bind` returns a function that, when called, will execute
				// the method passed in with the provided context and any additional
				// arguments passed to `util.bind`.
				//       util.bind(obj, 'f', a) -> function() { return obj.f(a); }
				//       util.bind(obj, g, a, b, c) -> function() { return g.call(g, a, b, c); }
				bind: function(context, method/*, args... */) {
					var args = SLICE.call(arguments, 2);
					return function() {
						method = (typeof method == 'string' ? context[method] : method);
						return method.apply(context, args.concat(SLICE.call(arguments, 0)));
					};
				},
			
				// `util.addEndSlash` accepts a string.  That string is returned with a `/`
				// appended if the string did not already end in a `/`.
				addEndSlash: function(str) {
					return rexpEndSlash.test(str) ? str : str + '/';
				},
			
				// `util.removeEndSlash` accepts a string.  It removes a trailing `/` if
				// one is found.
				removeEndSlash: function(str) {
					return str.replace(rexpEndSlash, '');
				},
			
				// `util.makeRelativePath` accepts two paths (strings) and returns the first path
				// made relative to the second.  Note: this function needs some work.  It currently
				// handles the most common use cases, but may fail in unexpected edge cases.
				// 
				//  - Simple case: if `path` starts with `relativeTo`, then we can strip `path` 
				// off the `relativeTo` part and we're done.
				//
				//         util.makeRelativePath('abc/def/', 'abc') -> 'def'
				//
				//  - Harder case: `path` starts with some substring of `relativeTo`.  We want to remove this substring and then add `../` for each remaining segment of `relativeTo`.
				//
				//         util.makeRelativePath('abc/def/', 'abc/hij') -> '../def'
				//
				makeRelativePath: function(path, relativeTo) {
					var len = relativeTo.length;
					if (path.substring(0, len) == relativeTo) {
						/* Note: we're casting a boolean to an int by adding len to it */
						return path.slice((path.charAt(len) == ENV.pathSep) + len);
					}
				
					var sA = util.removeEndSlash(path).split(ENV.pathSep),
						sB = util.removeEndSlash(relativeTo).split(ENV.pathSep),
						i = 0;
				
					/* Count how many segments match. */
					while(sA[i] == sB[i]) { ++i; }
				
					if (i) {
						/* If at least some segments matched, remove them.  The result is our new path. */
						path = sA.slice(i).join(ENV.pathSep);
					
						/* Prepend `../` for each segment remaining in `relativeTo`. */
						for (var j = sB.length - i; j > 0; --j) { path = '../' + path; }
					}
				
					return path;
				},
			
				// `buildPath` accepts an arbitrary number of string arguments to concatenate into a path.
				//     util.buildPath('a', 'b', 'c/', 'd/') -> 'a/b/c/d/'
				buildPath: function() {
					var args = Array.prototype.filter.call(arguments, function (x) { return x; });
					return util.resolveRelativePath(args.join('/'));
				},
			
				// `resolveRelativePath` removes relative path indicators.  For example:
				//     util.resolveRelativePath('a/../b') -> b
				resolveRelativePath: function(path) {
					/* If the path starts with a protocol, store it and remove it (add it
					   back later) so we don't accidently modify it. */
					var protocol = path.match(/^(\w+:\/\/)(.*)$/);
					if (protocol) { path = protocol[2]; }
				
					/* Remove multiple slashes and trivial dots (`/./ -> /`). */
					path = path.replace(/\/+/g, '/').replace(/\/\.\//g, '/');
				
					/* Loop to collapse instances of `../` in the path by matching a previous
					   path segment.  Essentially, we find substrings of the form `/abc/../`
					   where abc is not `.` or `..` and replace the substrings with `/`.
					   We loop until the string no longer changes since after collapsing
					   possible instances once, we may have created more instances that can
					   be collapsed.
					*/
					var o;
					while((o = path) != (path = path.replace(/(^|\/)(?!\.?\.\/)([^\/]+)\/\.\.\//g, '$1'))) {}
					/* Don't forget to prepend any protocol we might have removed earlier. */
					return protocol ? protocol[1] + path : path;
				},
			
				resolveRelativeModule: function (modulePath, directory) {
					var result = [],
						parts = modulePath.split('.'),
						len = parts.length,
						relative = (len > 1 && !parts[0]),
						i = relative ? 0 : -1;
				
					while(++i < len) { result.push(parts[i] ? parts[i] : '..'); }
					return util.buildPath(relative ? directory : '', result.join('/'));
				},
				resolveModulePath: function (modulePath, directory) {
					// resolve relative paths
					if (modulePath.charAt(0) == '.') {
						return [getModuleDef(util.resolveRelativeModule(modulePath, directory))];
					}
				
					// resolve absolute paths with respect to jsio packages/
					var pathSegments = modulePath.split('.');
					var baseMod = pathSegments[0];
					var pathString = pathSegments.join('/');
					
					if (jsioPath.cache.hasOwnProperty(baseMod)) {
						return [getModuleDef(util.buildPath(jsioPath.cache[baseMod], pathString))];
					}
				
					var defs = [];
					var paths = jsioPath.get();
					var len = paths.length;
					for (var i = 0; i < len; ++i) {
						var moduleDef = getModuleDef(util.buildPath(paths[i], pathString));
						moduleDef.setBase(baseMod, paths[i]);
						defs.push(moduleDef);
					}
					return defs;
				},
				splitPath: function(path, result) {
					if (!result) { result = {}; }
					var i = path.lastIndexOf('/') + 1;
					result.directory = path.substring(0, i);
					result.filename = path.substring(i);
					return result;
				}
			};
		
		// construct the top-level jsio object
		var jsio = util.bind(this, importer, null, null, null);

		jsio.__util = util;
		jsio.__init__ = init;

		var srcCache;
		jsio.setCache = function(cache) { srcCache = jsio.__srcCache = cache; }
		jsio.setCache(cloneFrom && cloneFrom.__srcCache || {});

		jsio.setCachedSrc = function(path, src) { srcCache[path] = { path: path, src: src }; }
		jsio.getCachedSrc = function(path) { return srcCache[path]; }

		jsio.__filename = 'jsio.js';
		jsio.__cmds = [];
		jsio.__jsio = jsio;
		jsio.__importer = importer;
		jsio.__modules = {preprocessors:{}};
		var jsioPath = {
				set: function(path) { jsioPath.value = (typeof path == 'string' ? [path] : path); },
				get: function() { return jsioPath.value.slice(0); },
				add: function(path) {
					var v = jsioPath.value, len = v.length;
					for (var i = 0; i < len; ++i) {
						if (v[i] == path) { return; }
					}
					v.push(path);
				},
				remove: function(path) {
					var v = jsioPath.value, len = v.length;
					for (var i = 0; i < len; ++i) {
						if (v[i] == path) {
							v.splice(i, 1);
						}
					}
				},
				value: [],
				cache: {}
			};
		
		jsio.path = jsioPath;
		jsio.addPath = util.bind(jsioPath, 'add');
		jsio.addCmd = util.bind(jsio.__cmds, 'push');
		
		jsio.setEnv = function(envCtor) {
			if (!envCtor && cloneFrom) {
				ENV = new cloneFrom.__env.constructor(util);
			} else {
				if (typeof envCtor == 'string') {
					envCtor = ({
							node: ENV_node,
							browser: ENV_browser
						})[envCtor] || ENV_browser;
				}

				ENV = new envCtor(util);
			}

			this.__env = ENV;
			this.__dir = ENV.getCwd();
			this.path.set(ENV.getPath());
		}
		
		if (cloneFrom) {
			jsio.setEnv();
		} else if (typeof process !== 'undefined' && process.version) {
			jsio.setEnv('node');
		} else if (typeof XMLHttpRequest != 'undefined' || typeof ActiveXObject != 'undefined') {
			jsio.setEnv('browser');
		}

		/*
		function ENV_abstract() {
			this.global = null;
			this.getCwd = function() {};
			this.getPath = function() {};
			this.eval = function(code, path) {};
			this.fetch = function(path) { return contentsOfPath; };
			this.log = function(args...) {};
		}
		*/
	
		function ENV_node() {
			var fs = require('fs');
			var path = require('path');
			
			this.name = 'node';
			this.global = GLOBAL;
			this.getCwd = process.cwd;
			this.pathSep = path.sep;

			this.log = function() {
				var msg;
				try {
					msg = Array.prototype.map.call(arguments, function(a) {
							if ((a instanceof Error) && a.message) {
								return 'Error:' + a.message + '\nStack:' + a.stack + '\nArguments:' + a.arguments;
							}
							return (typeof a == 'string' ? a : JSON.stringify(a));
						}).join(' ') + '\n';
				} catch(e) {
					msg = Array.prototype.join.call(arguments, ' ') + '\n';
				}

				process.stderr.write(msg);
				return msg;
			}
			
			this.getPath = function() {
				return path.relative(this.getCwd(), path.dirname(__filename) || '.');
			}
			
			if (process.compile) {
				this.eval = process.compile;
			} else {
				var vm = require('vm');
				this.eval = function (code, path) {
					try {
						return vm.runInThisContext(code, path);
					} catch (e) {
						this.log('In ' + path + ':\n' + e.message);
						throw e;
					}
				}
			}
			
			this.fetch = function (p) {
				p = path.resolve(this.getCwd(), p);

				try {
					var dirname = path.dirname(p);
					var filename = path.basename(p);
					var lowerFilename = filename.toLowerCase();
					var files = fs.readdirSync(dirname);
				} catch (e) {
					return false;
				}

				for (var i = 0, testName; testName = files[i]; ++i) {
					if (testName.toLowerCase() == lowerFilename && testName != filename) {
						throw "Invalid case when importing [" + p + "].  You probably meant" + testName;
					}
				}

				try {
					return fs.readFileSync(p, 'utf8');
				} catch(e) {
					return false;
				}
			}
			
			this.require = require;
		}
	
		function ENV_browser() {
			var XHR = window.XMLHttpRequest || function() { return new ActiveXObject("Msxml2.XMLHTTP"); },
				cwd = null,
				path = null,
				JOIN = Array.prototype.join;
			
			this.name = 'browser';
			this.global = window;
			this.pathSep = "/";

			if (!this.global.jsio) { this.global.jsio = jsio; }
		
			if (window.console && console.log) {
				if (!console.log.apply || /Android|iPhone|iPad|iPod/.test(navigator.userAgent)) {
					this.log = function () {
						var args = JOIN.call(arguments, ' ');
						console.log(args);
						return args;
					}
				} else {
					this.log = function () {
						console.log.apply(console, arguments);
						return JOIN.call(arguments, ' ');
					}
				}
			} else {
				this.log = function () { return JOIN.call(arguments, ' '); }
			}

			this.getCwd = function() {
				if(!cwd) {
					var loc = window.location, path = loc.pathname;
					cwd = loc.protocol + '//' + loc.host + path.substring(0, path.lastIndexOf('/') + 1);
				}
				return cwd;
			}
		
			this.getPath = function() {
				if(!path) {
					try {
						var filename = new RegExp('(.*?)' + jsio.__filename + '(\\?.*)?$'),
							scripts = document.getElementsByTagName('script');
					
						for (var i = 0, script; script = scripts[i]; ++i) {
							var result = script.src.match(filename);
							if (result) {
								path = result[1];
								if (/^[A-Za-z]*:\/\//.test(path)) { path = util.makeRelativePath(path, this.getCwd()); }
								break;
							}
						}
					} catch(e) {}
				
					if(!path) { path = '.'; }
				}
				return path;
			}
		
			this.debugPath = function(path) { return path; }

			// IE6 won't return an anonymous function from eval, so use the function constructor instead
			var rawEval = typeof eval('(function(){})') == 'undefined'
				? function(src, path) { return (new Function('return ' + src))(); }
				: function(src, path) { var src = src + '\n//@ sourceURL=' + path; return window.eval(src); };

			// provide an eval with reasonable debugging
			this.eval = function(code, path, origCode) {
				try {
					return rawEval(code, this.debugPath(path));
				} catch(e) {
					if(e instanceof SyntaxError) {
						ENV.log("a syntax error is preventing execution of " + path);
						if (DEBUG && this.checkSyntax) {
							this.checkSyntax(origCode, path);
						}
					}
					throw e;
				}
			}
		
			this.checkSyntax = function(code, path) {
				try {
					var syntax = jsio('import util.syntax', {suppressErrors: true, dontExport: true}),
						result = syntax(code);
					syntax.display(result, path);
				} catch(e) {}
			}
		
			this.fetch = function(path) {
				var xhr = new XHR();
				try {
					xhr.open('GET', path, false);
					xhr.send(null);
				} catch(e) {
					ENV.log('e:', e);
					return false; // firefox file://
				}
			
				if (xhr.status == 404 || // all browsers, http://
					xhr.status == -1100 || // safari file://
					// XXX: We have no way to tell in opera if a file exists and is empty, or is 404
					// XXX: Use flash?
					//(!failed && xhr.status == 0 && !xhr.responseText && EXISTS)) // opera
					false)
				{
					return false;
				}
			
				return xhr.responseText;
			}
		};
	
		var preprocessorCheck = /^"use (.*?)"\s*;\s*\n/,
			preprocessorFunc = /^(.+)\(.+\)$/,
			failedFetch = {};
	
		function findModule(possibilities, opts) {
			var src;
			for (var i = 0, possible; possible = possibilities[i]; ++i) {
				var path = possible.path,
					cachedVersion = srcCache[path];
				
				if (cachedVersion) {
					possible.src = cachedVersion.src;
					possible.pre = true;
					return possible;
				}
			
				/*if (/^\.\//.test(path)) {
					// remove one path segment for each dot from the cwd 
					path = addEndSlash(ENV.getCwd()) + path;
				}*/
			
				src = ENV.fetch(path);
			
				if (src !== false) {
					possible.src = src;
					return possible;
				} else {
					failedFetch[path] = true;
				}
			}
		
			return false;
		}
	
		// load a module from a file
		function loadModule (fromDir, fromFile, modulePath, opts) {
			var possibilities = util.resolveModulePath(modulePath, fromDir);
			for (var i = 0, p; p = possibilities[i]; ++i) {
				var path = possibilities[i].path;
				if (!opts.reload && (path in jsio.__modules)) {
					return possibilities[i];
				}

				if (path in failedFetch) { possibilities.splice(i--, 1); }
			}
		
			if (!possibilities.length) {
				if (opts.suppressErrors) { return false; }
				var e = new Error('Module failed to load (again)');
				e.jsioLogged = true;
				throw e;
			}
		
			var moduleDef = findModule(possibilities, opts),
				match;
		
			if (!moduleDef) {
				if (opts.suppressErrors) { return false; }
				var paths = [];
				for (var i = 0, p; p = possibilities[i]; ++i) { paths.push(p.path); }
				throw new Error(
					"requested import (" + modulePath + ") not found\n"
					+ "\tlooked in:\n"
						+ "\t\t" + paths.join('\n\t\t') + "\n"
						+ "\tImport Stack:\n"
						+ "\t\t" + importStack.join("\n\t\t"));
			}
		
			// a (potentially) nicer way to refer to a module -- how it was referenced in code when it was first imported
			moduleDef.friendlyPath = modulePath;
			
			// cache the base module's path in the path cache so we don't have to
			// try out all paths the next time we see the same base module.
			if (moduleDef.baseMod && !(moduleDef.baseMod in jsioPath.cache)) {
				jsioPath.cache[moduleDef.baseMod] = moduleDef.basePath;
			}

			// don't apply the standard preprocessors to base.js.  If we're reloading
			// the source code, always apply them.  We also don't want to run them
			// if they've been run once -- moduleDef.pre is set to true already
			// if we're reading the code from the source cache.
			if (modulePath != 'base' && (opts.reload || !opts.dontPreprocess && !moduleDef.pre)) {
				moduleDef.pre = true;

				applyPreprocessors(fromDir, moduleDef, ["import", "cls"], opts);

				// the order here is somewhat arbitrary and might be overly restrictive (... or overly powerful)
				// while (moduleDef.src.charAt(0) == '"' && (match = moduleDef.src.match(preprocessorCheck))) {
				// 	moduleDef.src = moduleDef.src.substring(match[0].length - 1);
				// 	applyPreprocessors(fromDir, moduleDef, match[1].split(','), opts);
				// }
			}

			// any additional preprocessors?
			if (opts.preprocessors) {
				applyPreprocessors(fromDir, moduleDef, opts.preprocessors, opts);
			}

			return moduleDef;
		}
	
		function applyPreprocessors(path, moduleDef, names, opts) {
			for (var i = 0, len = names.length; i < len; ++i) {
				p = getPreprocessor(names[i]);

				// if we have a recursive import and p isn't a function, just
				// skip it (handles the case where a preprocessor imports
				// other modules).
				if (p && typeof p == 'function') {
					p(path, moduleDef, opts);
				}
			}
		}
		
		function getPreprocessor(name) {
			var module = jsio.__modules['preprocessors.' + name];
			return typeof name == 'function'
				? name
				: (module && module.exports
					|| jsio('import preprocessors.' + name, {dontExport: true, dontPreprocess: true}));
		}
	
		function execModuleDef(context, moduleDef) {
			var src = moduleDef.src;
			delete moduleDef.src;

			var code = "(function(_){with(_){delete _;return function $$" + moduleDef.friendlyPath.replace(/[\:\\\/.-]/g, '_') + "(){" + src + "\n}}})";
			var fn = ENV.eval(code, moduleDef.path, src);
			fn = fn(context);
			fn.call(context.exports);
		};
		
		function resolveImportRequest(context, request, opts) {
			var cmds = jsio.__cmds,
				imports = [],
				result = false;
		
			for (var i = 0, imp; imp = cmds[i]; ++i) {
				if ((result = imp(context, request, opts, imports))) { break; }
			}
		
			if (result !== true) {
				throw new (typeof SyntaxError != 'undefined' ? SyntaxError : Error)(String(result || 'invalid jsio command: jsio(\'' + request + '\')'));
			}
		
			return imports;
		};
	
		function makeContext(ctx, modulePath, moduleDef, dontAddBase) {
			if (!ctx) { ctx = {}; }
			if (!ctx.exports) { ctx.exports = {}; }

			ctx.jsio = util.bind(this, importer, ctx, moduleDef.directory, moduleDef.filename);
			ctx.require = function(request, opts) {
				if (!opts) { opts = {}; }
				opts.dontExport = true;
				// opts.suppressErrors = true;
				
				try {
					var ret = ctx.jsio(request, opts);
					if (ret === false) {
						// need this to trigger require attempt due to suppresserrors = true
						throw "module failed to load";
					} else {
						return ret;
					}
				} catch(e) {
					ENV.log('Error loading request ' + request + ':');
					ENV.log(e);
				}
			};
			
			ctx.module = {id: modulePath, exports: ctx.exports};
			if (!dontAddBase && modulePath != 'base') {
				ctx.jsio('from base import *', {dontPreprocess: true});
				ctx.logging.__create(modulePath, ctx);
			}
		
			// TODO: FIX for "trailing ." case
			ctx.jsio.__jsio = jsio;
			ctx.jsio.__env = jsio.__env;
			ctx.jsio.__dir = moduleDef.directory;
			ctx.jsio.__filename = moduleDef.filename;
			ctx.jsio.path = jsioPath;
			return ctx;
		};
		
		var importStack = [];
		function importer(boundContext, fromDir, fromFile, request, opts) {
			opts = opts || {};
			fromDir = fromDir || './';
			fromFile = fromFile || '<initial file>';
		
			// importer is bound to a module's (or global) context -- we can override this
			// by using opts.exportInto
			var exportInto = opts.exportInto || boundContext || ENV.global;
		
			// parse the import request(s)
			var imports = resolveImportRequest(exportInto, request, opts),
				numImports = imports.length,
				retVal = numImports > 1 ? {} : null;
		
			// import each requested item
			for (var i = 0; i < numImports; ++i) {
				var item = imports[i];
				var modulePath = item.from;
				var modules = jsio.__modules;
				var path;
				var moduleDef;
				var err;
				
				try {
					moduleDef = loadModule(fromDir, fromFile, modulePath, opts);
				} catch(e) {
					err = e;
				}

				if (moduleDef) {
					path = moduleDef.path;
				} else if (jsio.__env.require) {
					path = modulePath;
					try {
						modules[path] = {exports: jsio.__env.require(modulePath)};
						err = null;
					} catch (e2) {
						if (!err) { err = e2; }
					}
				} else if (moduleDef == false) {
					return false;
				}

				if (err) {
					if (opts.suppressErrors) { return false; }
					if (!err.jsioLogged) {
						ENV.log(
							'\nError loading module:\n',
							'\t[[', request, ']]\n',
							'\trequested by:', fromDir + fromFile, '\n',
							'\tcurrent directory:', jsio.__env.getCwd(), '\n',
							'\t' + err, '\n',
							'\t' + err.stack);
						err.jsioLogged = true;
					}

					throw err;
				}
				
				if (moduleDef) {
					importStack.push(importStack.length + ' : ' + moduleDef.friendlyPath + ' (' + moduleDef.path + ')');
				}
				
				// eval any packages that we don't know about already
				if (!(path in modules)) {
					var newContext = makeContext(opts.context, modulePath, moduleDef, item.dontAddBase);

					modules[path] = moduleDef;

					moduleDef.exports = newContext.exports;
					if (item.dontUseExports) {
						var src = [';(function(){'], k = 1;
						for (var j in item['import']) {
							newContext.exports[j] = undefined;
							src[k++] = 'if(typeof '+j+'!="undefined"&&exports.'+j+'==undefined)exports.'+j+'='+j+';';
						}
						src[k] = '})();';
						moduleDef.src += src.join('');
					}

					execModuleDef(newContext, moduleDef);
					moduleDef.exports = newContext.exports;
				}
				
				importStack.pop();
			
				var module = modules[path].exports;
			
				// return the module if we're only importing one module
				if (numImports == 1) { retVal = module; }
			
				if (!opts.dontExport) {
					// add the module to the current context
					if (item.as) {
						// remove trailing/leading dots
						var as = item.as.match(/^\.*(.*?)\.*$/)[1],
							segments = as.split('.'),
							kMax = segments.length - 1,
							c = exportInto;
				
						// build the object in the context
						for(var k = 0; k < kMax; ++k) {
							var segment = segments[k];
							if (!segment) continue;
							if (!c[segment]) { c[segment] = {}; }
							c = c[segment];
						}
					
						c[segments[kMax]] = module;
				
						// there can be multiple module imports with this syntax (import foo, bar)
						if (numImports > 1) {
							retVal[as] = module;
						}
					} else if (item['import']) {
						// there can only be one module import with this syntax 
						// (from foo import bar), so retVal will already be set here
						if (item['import']['*']) {
							for (var k in modules[path].exports) { exportInto[k] = module[k]; }
						} else {
							for (var k in item['import']) { exportInto[item['import'][k]] = module[k]; }
						}
					}
				}
			}
		
			return retVal;
		}
	
		// DEFINE SYNTAX FOR JSIO('cmd')
	
		// from myPackage import myFunc
		// external myPackage import myFunc
		jsio.addCmd(function(context, request, opts, imports) {
			var match = request.match(/^\s*(from|external)\s+([\w.$]+)\s+(import|grab)\s+(.*)$/);
			if(match) {
				imports.push({
					from: match[2],
					dontAddBase: match[1] == 'external',
					dontUseExports: match[3] == 'grab' || match[1] == 'external',
					'import': {}
				});
			
				match[4].replace(/\s*([\w.$*]+)(?:\s+as\s+([\w.$]+))?/g, function(_, item, as) {
					imports[0]['import'][item] = as || item;
				});
				return true;
			}
		});

		// import myPackage
		jsio.addCmd(function(context, request, opts, imports) {
			var match = request.match(/^\s*import\s+(.*)$/);
			if (match) {
				match[1].replace(/\s*([\w.$]+)(?:\s+as\s+([\w.$]+))?,?/g, function(_, fullPath, as) {
					imports.push(
						as ? {
							from: fullPath,
							as: as
						} : {
							from: fullPath,
							as: fullPath
						});
				});
				return true;
			}
		});

		// CommonJS syntax
		jsio.addCmd(function(context, request, opts, imports) {
		
			//		./../b -> ..b
			// 		../../b -> ...b
			// 		../b -> ..b
			// 		./b -> .b
		
			var match = request.match(/^\s*[\w.0-9$\/\-]+\s*$/);
			if (match) {
			
				var req = util.resolveRelativePath(match[0]),
					isRelative = req.charAt(0) == '.';
			
				req = req
					// .replace(/^\//, '') // remove any leading slash
					.replace(/\.\.\//g, '.') // replace relative path indicators with dots
					.replace(/\.\//g, '')
					.replace(/\//g, '.'); // any remaining slashes are path separators

				imports[0] = { from: (isRelative ? '.' : '') + req };
				return true;
			}
		});
		
		jsio.install = function() {
			jsio('from base import *');
			GLOBAL['logger'] = logging.get('jsiocore');
		};

		jsio.eval = function (src, path) {
			path = ENV.getCwd() || '/';
			var moduleDef = new ModuleDef(path);
			moduleDef.src = src;
			applyPreprocessors(path, moduleDef, ["import", "cls"], {});
			execModuleDef(ENV.global, moduleDef);
		};
		
		jsio.clone = util.bind(null, init, jsio);

		return jsio;
	}

	var J = init(null, {});
	if (typeof exports != 'undefined') {
		module.exports = J;
	} else {
		jsio = J;
	}
})();
jsio.path.set(["sdk/jsio",".","sdk/gc/api/","sdk/","sdk/timestep/"]);jsio.path.cache={"preprocessors":"sdk/jsio","base":"sdk/jsio","util":"sdk/jsio","gc":"sdk/","device":"sdk/timestep/","event":"sdk/timestep/","lib":"sdk/jsio","ui":"sdk/timestep/","std":"sdk/jsio","platforms":"sdk/timestep/","math":"sdk/jsio","AudioManager":"sdk/timestep/","timer":"sdk/timestep/","animate":"sdk/timestep/","squill":"sdk/","net":"sdk/jsio","src":".","plugins":"sdk/","GCDataSource":"sdk/gc/api/"};jsio.setCache({"sdk/jsio/base.js":{"path":"sdk/jsio/base.js","friendlyPath":"base","directory":"sdk/jsio/","filename":"base.js","baseMod":"base","basePath":"sdk/jsio","src":"/**\n * base.js\n * This file contains all global functions provided by js.io.\n */\n\nexports.log = jsio.__env.log;\nexports.GLOBAL = jsio.__env.global;\n\n/**\n * Various polyfill methods to ensure js.io implementations provide\n * a baseline of JavaScript functionality. Feature compatibility (localStorage,\n * etc.) should be provided elsewhere.\n */\n\n// Array.isArray\n// Not available before ECMAScript 5.\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/isArray\n\nif (!Array.isArray) {\n\tArray.isArray = function (arg) {\n\t\treturn Object.prototype.toString.call(arg) === '[object Array]';\n\t}\n};\n\n// Function.prototype.bind\n// Not available before ECMAScript 5.\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind\n\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function (oThis) {\n    if (typeof this !== \"function\") {\n      // closest thing possible to the ECMAScript 5 internal IsCallable function\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n    }\n\n    var aArgs = Array.prototype.slice.call(arguments, 1), \n        fToBind = this, \n        fNOP = function () {},\n        fBound = function () {\n          return fToBind.apply(this instanceof fNOP\n                                 ? this\n                                 : oThis,\n                               aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n\n    return fBound;\n  };\n}\n\n/**\n * DEPRECATED. Old js.io polyfills.\n */\n\nvar SLICE = Array.prototype.slice;\n\n/* Use native isArray if available\n */\nif (typeof Array.isArray === 'function') {\n\texports.isArray = Array.isArray;\n} else {\n\texports.isArray = function (obj) {\n\t\treturn Object.prototype.toString.call(obj) === '[object Array]';\n\t}\n}\n\nexports.bind = function(context, method /*, VARGS*/) {\n\tif(arguments.length > 2) {\n\t\tvar args = SLICE.call(arguments, 2);\n\t\treturn typeof method == 'string'\n\t\t\t? function __bound() {\n\t\t\t\tif (context[method]) {\n\t\t\t\t\treturn context[method].apply(context, args.concat(SLICE.call(arguments, 0)));\n\t\t\t\t} else {\n\t\t\t\t\tthrow logger.error('No method:', method, 'for context', context);\n\t\t\t\t}\n\t\t\t}\n\t\t\t: function __bound() { return method.apply(context, args.concat(SLICE.call(arguments, 0))); }\n\t} else {\n\t\treturn typeof method == 'string'\n\t\t\t? function __bound() {\n\t\t\t\tif (context[method]) {\n\t\t\t\t\treturn context[method].apply(context, arguments);\n\t\t\t\t} else {\n\t\t\t\t\tthrow logger.error('No method:', method, 'for context', context);\n\t\t\t\t}\n\t\t\t}\n\t\t\t: function __bound() { return method.apply(context, arguments); }\n\t}\n}\n\n/**\n * Class constructor.\n */\n\nexports.Class = function(name, parent, proto) {\n\treturn exports.__class__(function() { return this.init && this.init.apply(this, arguments); }, name, parent, proto);\n}\n\nexports.__class__ = function (cls, name, parent, proto) {\n\tvar clsProto = function () {};\n\tvar logger;\n\n\tif (typeof name != 'string') {\n\t\tproto = parent;\n\t\tparent = name;\n\t\tname = null;\n\t}\n\n\tif (name) {\n\t\tlogger = exports.logging.get(name);\n\t}\n\n\tif (!parent) { throw new Error('parent or prototype not provided'); }\n\tif (!proto) { proto = parent; parent = null; }\n\n\tif (parent) {\n\t\tif (exports.isArray(parent)) { // multiple inheritance, use at your own risk =)\n\t\t\tclsProto.prototype = {};\n\t\t\tfor(var i = 0, p; p = parent[i]; ++i) {\n\t\t\t\tif (p == Error && ErrorParentClass) { p = ErrorParentClass; }\n\t\t\t\tfor (var item in p.prototype) {\n\t\t\t\t\tif (!(item in clsProto.prototype)) {\n\t\t\t\t\t\tclsProto.prototype[item] = p.prototype[item];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tparent = parent[0];\n\t\t} else {\n\t\t\tif (parent == Error && ErrorParentClass) { parent = ErrorParentClass; }\n\t\t\tclsProto.prototype = parent.prototype;\n\t\t}\n\t}\n\t\n\tvar supr = parent ? function(context, method, args) {\n\t\t\tvar f = parent.prototype[method];\n\t\t\tif (!f) { throw new Error('method ' + method + ' does not exist'); }\n\t\t\treturn f.apply(context, args || []);\n\t\t} : null;\n\t\n\tvar p = cls.prototype = new clsProto();\n\tp.constructor = cls;\n\tp.__parentClass__ = parent;\n\tif (name) { p.__class__ = name; }\n\tproto.call(p, logger || supr, logger && supr);\n\treturn cls;\n}\n\nvar ErrorParentClass = exports.__class__(function ErrorCls() {\n\t\tvar err = Error.prototype.constructor.apply(this, arguments);\n\t\tfor (var prop in err) {\n\t\t\tif (err.hasOwnProperty(prop)) {\n\t\t\t\tthis[prop] = err[prop];\n\t\t\t}\n\t\t}\n\t}, function() {});\n\n/**\n * Merge two objects together.\n */\n\nexports.Class.defaults = \nexports.merge = function(base, extra) {\n\tbase = base || {};\n\t\n\tfor (var i = 1, len = arguments.length; i < len; ++i) {\n\t\tvar copyFrom = arguments[i];\n\t\tfor (var key in copyFrom) {\n\t\t\tif (copyFrom.hasOwnProperty(key) && !base.hasOwnProperty(key)) {\n\t\t\t\tbase[key] = copyFrom[key];\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn base;\n}\n\n/**\n * Create a timer delay.\n */\n\nexports.delay = function(orig, timeout) {\n\tvar _timer = null;\n\tvar ctx, args;\n\tvar f = function() { orig.apply(ctx, args); }\n\treturn function() {\n\t\tctx = this;\n\t\targs = arguments;\n\t\tif (_timer) { clearTimeout(_timer); }\n\t\t_timer = setTimeout(f, timeout || 0);\n\t}\n}\n\n/**\n * Log constructor and default \"logger\".\n */\n\nexports.logging = (function() {\n\t\n\t// logging namespace, this is what is exported\n\tvar logging = {\n\t\t\tDEBUG: 1,\n\t\t\tLOG: 2,\n\t\t\tINFO: 3,\n\t\t\tWARN: 4,\n\t\t\tERROR: 5,\n\t\t\tNONE: 10\n\t\t},\n\t\tloggers = {}, // effectively globals - all loggers and a global production state\n\t\tproduction = false;\n\tvar gPrefix = '';\n\tlogging.setPrefix = function(prefix) { gPrefix = prefix + ' '; }\n\tlogging.setProduction = function(prod) { production = !!prod; }\n\tlogging.get = function(name) {\n\t\treturn loggers.hasOwnProperty(name) ? loggers[name]\n\t\t\t: (loggers[name] = new Logger(name));\n\t}\n\tlogging.set = function(name, _logger) {\n\t\tloggers[name] = _logger;\n\t}\n\t\n\tlogging.getAll = function() { return loggers; }\n\n\tlogging.__create = function(pkg, ctx) { ctx.logger = logging.get(pkg); }\n\t\n\tvar Logger = exports.__class__(\n\t\tfunction Logger(name, level) {\n\t\t\tthis._name = name;\n\t\t\tthis._level = level || logging.LOG;\n\t\t},\n\t\tfunction () {\n\t\t\tthis.setLevel = function(level) { this._level = level; }\n\t\t\n\t\t\tfunction makeLogFunction(level, type) {\n\t\t\t\treturn function() {\n\t\t\t\t\tif (!production && level >= this._level) {\n\t\t\t\t\t\tvar prefix = type + ' ' + gPrefix + this._name,\n\t\t\t\t\t\t\tlistener = this._listener || exports.log;\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn listener && listener.apply(this._listener, [prefix].concat(SLICE.call(arguments)));\n\t\t\t\t\t}\n\t\t\t\t\treturn arguments[0];\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\tthis.setListener = function(listener) { this._listener = listener; }\n\t\t\tthis.debug = makeLogFunction(logging.DEBUG, \"DEBUG\");\n\t\t\tthis.log = makeLogFunction(logging.LOG, \"LOG\");\n\t\t\tthis.info = makeLogFunction(logging.INFO, \"INFO\");\n\t\t\tthis.warn = makeLogFunction(logging.WARN, \"WARN\");\n\t\t\tthis.error = makeLogFunction(logging.ERROR, \"ERROR\");\n\t\t});\n\n\treturn logging;\n})();\n\nvar logger = exports.logging.get('jsiocore');\n"},"sdk/gc/native/launchClient.js":{"path":"sdk/gc/native/launchClient.js","friendlyPath":"gc.native.launchClient","directory":"sdk/gc/native/","filename":"launchClient.js","baseMod":"gc","basePath":"sdk/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nGLOBAL.console = jsio('import base', {}).logging.get('console');\n\nif (!window.DEV_MODE) { window.DEV_MODE = false; }\n\n//install the device so that timestep knows where to get stuff\n\njsio(\"import device\");\njsio(\"import platforms.native.initialize\");\n\nlogger.log('getting initialize for native');\ndevice.init();\n\njsio(\"import .common\");\ncommon.install();\n\njsio(\"import .socketTransport\");\n\nif (window.DEBUG_WAIT) {\n\tjsio(\"import ..debugging.connect\");\n\n\tvar cwd = jsio.__env.getCwd();\n\tvar match = /https?:\\/\\/([^:]*).*/.exec(cwd);\n\tvar host = null;\n\tif (match) {\n\t\thost = match[1];\n\t}\n\n\tdebugging.connect.connect({\n\t\ttransport: socketTransport.Connector,\n\t\topts: {\n\t\t\thost: host,\n\t\t\tport: 9226\n\t\t}\n\t}, startApp);\n} else {\n\tstartApp();\n}\n\n/**\n * Anonymous statistics, this information helps us improve the DevKit by \n * providing us information about which versions are out there.\n *\n * You can remove this or replace it with your own analytics if you like.\n */\nfunction analytics () {\n\tvar config = GLOBAL.CONFIG;\n\tvar params = 'appID:' + escape(config.appID || '') + '&' +\n\t\t\t'bundleID:' + escape(config.bundleID || '') + '&' +\n\t\t\t'appleID:' + escape(config.appleID || '') + '&' +\n\t\t\t'version:' + escape(config.version || '') + '&' +\n\t\t\t'sdkVersion:' + escape(config.sdkVersion || '') + '&' +\n\t\t\t'isAndroid:' + (device.isAndroid ? 1 : 0) + '&' +\n\t\t\t'isIOS:' + (device.isIOS ? 1 : 0);\n\n\tvar xhr = new XMLHttpRequest();\n\txhr.open('GET', 'http://www.gameclosure.com/analytics?' + params, true);\n\txhr.send();\t\n}\n\nfunction startApp (conn) {\n\tif (conn) {\n\t\tjsio(\"import ..debugging.TimestepInspector\");\n\t\tconn.addClient(new debugging.TimestepInspector());\n\t}\n\n\tvar type = \"Client\";\n\t//logging.setPrefix(type);\n\t\n\t// prefix filenames in the debugger\n\tjsio.__env.debugPath = function (path) { return '[' + type + ']:' + path; };\n\t\n\tlogger.log('init debugging', jsio.__env.getCwd());\n\n\tjsio(\"import gc.API\");\n\tanalytics();\n\tGC.buildApp('launchUI');\n\n\tif (conn) {\n\t\tconn.setApp(GC.app);\n\t}\n}\n\n","pre":true},"sdk/timestep/device.js":{"path":"sdk/timestep/device.js","friendlyPath":"device","directory":"sdk/timestep/","filename":"device.js","baseMod":"device","basePath":"sdk/timestep/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module device;\n *\n * Namespace for the current device. Determines what device we're running using\n * navigator.userAgent. This namespace exposes various properties about the\n * current device, such as screen size, mobile/browser, pixel ratios, etc.\n *\n * Using device.get('...') imports device-specific implementations from\n *   timestep.env.* by default, or from packages registered using\n *   registerDevice().\n * Using device.importUI('...') imports rendering classes for DOM or canvas.\n *\n * @doc http://doc.gameclosure.com/api/device.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/device.md\n */\n\njsio(\"import event.Emitter as Emitter\");\njsio(\"import util.setProperty\");\n\nif (typeof navigator == 'undefined' || !navigator.userAgent) {\n\tlogger.warn('> Timestep was unable to determine your device! Please check that navigator.userAgent is defined.');\n\texports = {isUnknown: true};\n}\n\nvar ua = navigator.userAgent;\n\n/**\n * @namespace\n */\n\nvar _devices = {}\nexports.registerDevice = function (name, path) {\n\t_devices[name] = path;\n}\n\nexports.get = function (module) {\n\tvar path = _devices[exports.name] || 'platforms.browser';\n\treturn jsio('import ' + path + '.' + module, {dontExport: true, suppressErrors: true});\n};\n\nexports.importUI = function (module) {\n\treturn jsio('import ui.backend.' + (exports.useDOM ? 'dom' : 'canvas') + '.' + module, {dontExport: true, suppressErrors: true});\n};\n\nexports.isMobileNative = exports.isMobile = /TeaLeaf/.test(ua);\n\nlogger.log(exports.isMobile ? 'on mobile device' : 'in web browser');\n\nexports.screen = new Emitter();\n\nvar devicePixelRatio = window.devicePixelRatio || 1;\n\n// @deprecated\nexports.devicePixelRatio = devicePixelRatio;\n\nexports.screen.devicePixelRatio = devicePixelRatio;\nexports.screen.width = window.screen.width * devicePixelRatio;\nexports.screen.height = window.screen.height * devicePixelRatio;\n\n// This is stubbed out unless available on the current device.\nexports.hideAddressBar = function () {};\n\nutil.setProperty(exports, 'defaultFontFamily', {\n\tcb: function (value) {\n\t\tjsio(\"import ui.resource.Font\");\n\t\tui.resource.Font.setDefaultFontFamily(value);\n\t},\n\tvalue: 'Helvetica'\n});\n\nif ('ontouchstart' in window && (!/BlackBerry/.test(ua))) {\n\texports.events = {\n\t\tstart: 'touchstart',\n\t\tmove: 'touchmove',\n\t\tend: 'touchend'\n\t};\n} else {\n\texports.events = {\n\t\tstart: 'mousedown',\n\t\tmove: 'mousemove',\n\t\tend: 'mouseup'\n\t};\n}\n\nexports.isMobileBrowser = false;\nexports.isUIWebView = false;\nexports.isSafari = /Safari/.test(ua);\n\njsio(\"import std.uri\");\nuri = new std.uri(window.location);\nexports.isSimulator = !!(uri.query('device') || uri.hash('device'));\n\nif (exports.isSimulator) {\n\tvar urlStr = window.location.href.toLowerCase();\n\texports.isIOSSimulator = urlStr.indexOf('ipad') !== -1 || urlStr.indexOf('iphone') !== -1;\n\t\n\t// Until we support more platforms, if it's not\n\t// iOS then it's assumed to be an Android device\n\texports.isAndroidSimulator = !exports.isIOSSimulator;\n} else {\n\texports.isAndroidSimulator = false;\n\texports.isIOSSimulator = false;\n}\n\nif (exports.isMobile) {\n\texports.name = 'tealeaf';\n\texports.width = navigator.width;\n\texports.height = navigator.height;\n\texports.isAndroid = /Android/.test(ua);\n\tif (exports.isAndroid) {\n\t\texports.isTablet = navigator.width/devicePixelRatio >= 600;\n\t} else {\n\t\texports.isIPad = exports.isTablet = /iPad/.test(ua);\n\t\texports.isIPhone = /iPhone/.test(ua);\n\n\t\t// Until we support more platforms, if it's not\n\t\t// Android then it's assumed to be an iOS device\n\t\texports.isIOS = true;\n\t}\n} else {\n\tif (/(iPod|iPhone|iPad)/i.test(ua)) {\n\t\texports.name = 'browser';\n\t\texports.isMobileBrowser = true;\n\t\texports.isIOS = true;\n\t\texports.isUIWebView = !exports.isSafari;\n\n\t\texports.screen.defaultOrientation = 'portrait';\n\t\texports.screen.browserChrome = {\n\t\t\tportrait: {top: 20 * devicePixelRatio, bottom: 44 * devicePixelRatio},\n\t\t\tlandscape: {top: 20 * devicePixelRatio, bottom: 32 * devicePixelRatio}\n\t\t};\n\n\t} else if (/Mobile Safari/.test(ua) || /Android/.test(ua) || /BlackBerry/.test(ua)) {\n\t\texports.name = 'browser';\n\t\texports.isMobileBrowser = true;\n\t\texports.isAndroid = true;\n\n\t\texports.screen.width = window.outerWidth;\n\t\texports.screen.height = window.outerHeight - 1;\n\n\t\texports.screen.defaultOrientation = 'portrait';\n\t\texports.screen.browserChrome = {\n\t\t\tportrait: {top: 0, bottom: 0},\n\t\t\tlandscape: {top: 0, bottom: 0}\n\t\t};\n\t} else {\n\t\t// All other browsers\n\t\texports.width = window.innerWidth;\n\t\texports.height = window.innerHeight;\n\t\texports.screen.width = window.innerWidth;\n\t\texports.screen.height = window.innerHeight;\n\t\texports.name = 'browser';\n\t\texports.canResize = false;\n\t}\n}\n\nexports.useDOM = false;\nexports.setUseDOM = function (useDOM) {\n\tif (exports.useDOM != useDOM) {\n\t\texports.useDOM = useDOM;\n\n\t\tjsio(\"import ui.View as View\");\n\t\tvar backing = exports.importUI('ViewBacking');\n\t\tView.setDefaultViewBacking(backing);\n\t}\n}\n\nexports.getDimensions = function (isLandscape) {\n\tvar dMin = Math.min(exports.width, exports.height),\n\t\tdMax = Math.max(exports.width, exports.height);\n\n\treturn isLandscape\n\t\t? {height: dMin, width: dMax}\n\t\t: {height: dMax, width: dMin};\n}\n\n/**\n * Initialize the device. Called from somewhere else.\n */\n\nexports.init = function () {\n\tjsio(\"import ui.init\");\n\texports.get('initialize').init();\n\texports.screen.width = exports.width;\n\texports.screen.height = exports.height;\n}\n\n/**\n * Event handlers\n */\nexports.setBackButtonHandler = function (handler) {\n\tNATIVE.onBackButton = handler;\n}\n\nexports.setRotationHandler = function (handler) {\n\tNATIVE.onRotation = handler;\n}\n\n/*\n * Stay awake\n */\nexports.stayAwake = function(enable) {\n\tNATIVE.stayAwake && NATIVE.stayAwake(enable);\n}\n\n/**\n * Garbage Collection\n */\nexports.collectGarbage = function () {\n\tlogger.log('collecting garbage');\n\tNATIVE.gc && NATIVE.gc.runGC();\n}\n\n/**\n * Global device accessibility controls. Muting, click, color, font changing, etc.\n */\n\nGLOBAL.ACCESSIBILITY = new (Class(Emitter, function (supr) {\n\tthis.muted = false;\n\n\tthis.mute = function (flag) {\n\t\tthis.muted = flag;\n\t\tthis.publish('MuteChange');\n\t};\n}));\n\nif (GLOBAL.ONACCESSIBLE) {\n\tGLOBAL.ONACCESSIBLE();\n}\n","pre":true},"sdk/timestep/event/Emitter.js":{"path":"sdk/timestep/event/Emitter.js","friendlyPath":"event.Emitter","directory":"sdk/timestep/event/","filename":"Emitter.js","baseMod":"event","basePath":"sdk/timestep/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.Emitter;\n * Namespace shim to bring in PubSub from jsio.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.emitter\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio(\"import lib.PubSub as exports\");\n","pre":true},"sdk/jsio/lib/PubSub.js":{"path":"sdk/jsio/lib/PubSub.js","friendlyPath":"lib.PubSub","directory":"sdk/jsio/lib/","filename":"PubSub.js","baseMod":"lib","basePath":"sdk/jsio","src":"/**\n * Summary: inherit from lib.PubSub if a class wants publish/subscribe ability\n * Methods:\n *  - publish(signal, args...) - all subscribers to signal will be called\n *     with the list of arguments provided.\n *  - subscribe(signal, ctx, method, args...) - register a bound method\n *     to a signal.  Any args that are passed in will be the first args\n *     when the method is invoked during a publish.\n *  Usage notes: There is one special signal '__any'.  Any subscribers to\n *     '__any' will be called on every publish with the first publish\n *     argument being the signal itself (after any args passed in during\n *     the corresponding subscribe). \n *     Calling the super constructor is not required for descendants of \n *     lib.PubSub. \n */\n\nvar ctx = jsio.__env.global,\n\tSLICE = Array.prototype.slice;\n\nvar sdk_jsio_lib_PubSub=__class__;exports=sdk_jsio_lib_PubSub(function sdk_jsio_lib_PubSub(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function () {};\n\t\n\tthis.publish = function (signal) {\n\t\tif (this._subscribers) {\n\t\t\tvar args = SLICE.call(arguments, 1);\n\t\t\tif (this._subscribers.__any) {\n\t\t\t\tvar anyArgs = [signal].concat(args),\n\t\t\t\t\tsubs = this._subscribers.__any.slice(0);\n\t\t\t\tfor(var i = 0, sub; sub = subs[i]; ++i) {\n\t\t\t\t\tsub.apply(ctx, anyArgs);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (!this._subscribers[signal]) {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t\t\n\t\t\tvar subs = this._subscribers[signal].slice(0);\n\t\t\tfor (var i = 0, sub; sub = subs[i]; ++i) {\n\t\t\t\tsub.apply(ctx, args);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\t\n\tthis.subscribe = function (signal, ctx, method) {\n\t\tvar cb;\n\t\tif (arguments.length == 2) {\n\t\t\tcb = ctx;\n\t\t} else {\n\t\t\tcb = bind.apply(GLOBAL, SLICE.call(arguments, 1));\n\t\t\tcb._ctx = ctx; // references for unsubscription\n\t\t\tcb._method = method;\n\t\t}\n\t\t\n\t\tvar s = this._subscribers || (this._subscribers = {});\n\t\t(s[signal] || (s[signal] = [])).push(cb);\n\t\treturn this;\n\t};\n\t\n\tthis.subscribeOnce = function (signal, ctx, method) {\n\t\tvar args = arguments,\n\t\t\tcb = bind(this, function () {\n\t\t\t\tthis.unsubscribe(signal, cb);\n\t\t\t\tif (args.length == 2) {\n\t\t\t\t\tctx.apply(GLOBAL, arguments);\n\t\t\t\t} else {\n\t\t\t\t\tbind.apply(GLOBAL, SLICE.call(args, 1))\n\t\t\t\t\t\t.apply(GLOBAL, arguments);\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\tif (args.length === 3) {\n\t\t\tcb._ctx = ctx;\n\t\t\tcb._method = method;\n\t\t}\n\t\t\n\t\treturn this.subscribe(signal, cb);\n\t};\n\t\n\t// If no method is specified, all subscriptions with a callback context\n\t// of ctx will be removed.\n\n\tthis.unsubscribe = function (signal, ctx, method) {\n\t\tif (!this._subscribers || !this._subscribers[signal]) {\n\t\t\treturn this;\n\t\t}\n\t\tvar subs = this._subscribers[signal];\n\t\tfor (var i = 0, c; c = subs[i]; ++i) {\n\t\t\tif (c == ctx || c._ctx == ctx && (!method || c._method == method)) {\n\t\t\t\tsubs.splice(i--, 1);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\t/**\n\t * EventEmitter-style API\n\t * http://nodejs.org/api/events.html\n\t */\n\n\tthis.listeners = function (type) {\n\t\tthis._subscribers = (this._subscribers ? this._subscribers : {});\n\t\treturn (this.hasOwnProperty.call(this._subscribers, type))\n\t\t\t? this._subscribers[type]\n\t\t\t: (this._subscribers[type] = []);\n\t};\n\n\tthis.addListener = this.on = function (type, f) {\n\t\tif (this.listeners(type).length + 1 > this._maxListeners && this._maxListeners !== 0) {\n\t\t\tif (typeof console !== \"undefined\") {\n\t\t\t\tconsole.warn(\"Possible EventEmitter memory leak detected. \" + this._subscribers[type].length + \" listeners added. Use emitter.setMaxListeners() to increase limit.\");\n\t\t\t}\n\t\t}\n\t\tthis.emit(\"newListener\", type, f);\n\t\treturn this.subscribe(type, this, f);\n\t};\n\n\tthis.once = function (type, f) {\n\t\treturn this.subscribeOnce(type, this, f);\n\t};\n\n\tthis.removeListener = function (type, f) {\n\t\tthis.unsubscribe(type, this, f);\n\t\treturn this;\n\t};\n\n\tthis.removeAllListeners = function (type) {\n\t\tif (this._subscribers) {\n\t\t\tfor (var k in this._subscribers) {\n\t\t\t\tif (type == null || type == k) {\n\t\t\t\t\tdelete this._subscribers[k];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.emit = function (type) {\n\t\tthis.publish.apply(this, arguments);\n\t\treturn this.listeners(type).length > 0;\n\t};\n\n\tthis._maxListeners = 10;\n\n\tthis.setMaxListeners = function (_maxListeners) {\n\t\tthis._maxListeners = _maxListeners;\n\t};\n\n\tthis.hasListeners = function (type) {\n\t\treturn this._subscribers && this._subscribers[type] && this._subscribers[type].length;\n\t};\n});\n\n","pre":true},"sdk/jsio/util/setProperty.js":{"path":"sdk/jsio/util/setProperty.js","friendlyPath":"util.setProperty","directory":"sdk/jsio/util/","filename":"setProperty.js","src":"function createGetter(ctx, name) {\n\treturn function() {\n\t\treturn this[name];\n\t}\n}\n\nfunction createSetter(ctx, name, callback, initialValue) {\n\tif (initialValue !== undefined) {\n\t\tctx[name] = initialValue;\n\t}\n\t\n\tif (typeof callback == 'function') {\n\t\treturn function(value) {\n\t\t\tif (this[name] !== value) {\n\t\t\t\tvar old = this[name];\n\t\t\t\tthis[name] = value;\n\t\t\t\tcallback.call(this, name, value, old);\n\t\t\t}\n\t\t}\n\t} else if (typeof callback == 'string') {\n\t\treturn function(value) {\n\t\t\tif (this[name] !== value) {\n\t\t\t\tvar old = this[name];\n\t\t\t\tthis[name] = value;\n\t\t\t\tthis[callback](name, value, old);\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn function(value) {\n\t\t\tthis[name] = value;\n\t\t}\n\t}\n}\n\nexports = function(ctx, name, def) {\n\tif (!def.get && !def.set && !def.cb && ('value' in def)) {\n\t\tctx[name] = def.value;\n\t} else {\n\t\tif (!def.get) { def.get = createGetter(ctx, '_' + name); }\n\t\tif (!def.set) { def.set = createSetter(ctx, '_' + name, def.cb, def.value); }\n\t\tif ('value' in def) { ctx['_' + name] = def.value; }\n\n\t\tdelete def.value;\n\t\tif (Object.defineProperty) {\n\t\t\tObject.defineProperty(ctx, name, def);\n\t\t\t// merge(def, {\n\t\t\t// \t\t\t\tconfigurable: false,\n\t\t\t// \t\t\t\tenumerable: true\n\t\t\t// \t\t\t});\n\t\t} else if (ctx.__defineSetter__) {\n\t\t\tctx.__defineSetter__(name, def.set);\n\t\t\tctx.__defineGetter__(name, def.get);\n\t\t} else {\n\t\t\tctx[name] = def.value;\n\t\t}\n\t}\n}\n","pre":true},"sdk/timestep/ui/resource/Font.js":{"path":"sdk/timestep/ui/resource/Font.js","friendlyPath":"ui.resource.Font","directory":"sdk/timestep/ui/resource/","filename":"Font.js","baseMod":"ui","basePath":"sdk/timestep/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.resource.Font;\n * Font string parser, a la CSS Font strings. Exports a Font object class.\n * This class is purely informational.\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.resource.font\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\nvar _cache = {},\n\tweights = 'normal|bold|bolder|lighter|[1-9]00',\n\tstyles = 'normal|italic|oblique',\n\tunits = 'px|pt|pc|in|cm|mm|%',\n\tname = '([\\\\w\\\"\\'\\\\- ]+(?:,|$))+',\n\tfontParser = new RegExp(\n\t\t'^ *'\n\t\t\t+ '(?:(' + weights + ') *)?'\n\t\t\t+ '(?:(' + styles + ') *)?'\n\t\t\t+ '([\\\\d\\\\.]+)(' + units + ')'\n\t\t\t+ '('+ name + ')',\n\t\t\t'i'\n\t),\n\tsizeParser = new RegExp('([\\\\d\\\\.]+)(' + units + ')', 'i'),\n\tTO_PT = {\n\t\t'pt': 1,\n\t\t'px': 3 / 4,\n\t\t'in': 3 / 4 * 96,\n\t\t'mm': 3 / 4 * 96 / 25.4,\n\t\t'cm': 3 / 4 * 96 / 2.54\n\t},\n\tTO_PX = {\n\t\t'pt': 4 / 3,\n\t\t'px': 1,\n\t\t'in': 96,\n\t\t'mm': 96 / 25.4,\n\t\t'cm': 96 / 2.54\n\t};\n\nfunction parseSize(sizeStr, unit) {\n\tvar match = sizeStr.match(sizeParser);\n\tif (!match) { throw 'invalid font size'; }\n\treturn {\n\t\tvalue: parseFloat(match[1]),\n\t\tunit: match[2]\n\t};\n}\n\nfunction toPx(size) {\n\treturn {\n\t\tvalue: size.value * TO_PX[size.unit],\n\t\tunit: 'px'\n\t};\n}\n\nfunction toPt(size) {\n\treturn {\n\t\tvalue: size.value * TO_PT[size.unit],\n\t\tunit: 'pt'\n\t};\n}\n\nfunction parseFont(fontStr) {\n\tvar match = fontStr.match(fontParser);\n\tif (!match) { throw 'invalid font string'; }\n\t\n\tvar res = {};\n\tres.weight = match[1] || 'normal';\n\tres.style = match[2] || 'normal';\n\tres.size = {\n\t\tvalue: parseFloat(match[3]),\n\t\tunit: match[4]\n\t};\n\tres.names = match[5]\n\t\t.split(',')\n\t\t.map(function (str) {\n\t\t\treturn str.replace(/[\\-_]/g, ' ')\n\t\t\t\t.replace(/\\s+/g, ' ')\n\t\t\t\t.replace(/['\"]/g, '')\n\t\t\t\t.replace(/^\\s+|\\s+$/g, '')\n\t\t});\n\n\tres.name = res.names[0];\n\treturn res;\n};\n\nvar sdk_timestep_ui_resource_Font=__class__;var Font = exports=sdk_timestep_ui_resource_Font(function sdk_timestep_ui_resource_Font(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\tvar _defaultFontFamily = null;\n\tthis.constructor.setDefaultFontFamily = function (fontFamily) {\n\t\t_defaultFontFamily = fontFamily;\n\t}\n\n\tvar defaults = {\n\t\tname: _defaultFontFamily,\n\t\tsize: 20,\n\t\tunit: 'px',\n\t\tstyle: '',\n\t\tweight: ''\n\t};\n\n\tthis.init = function (opts) {\n\t\tif (typeof opts === 'string') {\n\t\t\t_cache[opts] = this;\n\t\t\tthis._string = opts;\n\t\t\topts = parseFont(opts);\n\t\t} else {\n\t\t\topts = merge(opts, defaults);\n\t\t}\n\t\t\n\t\tif (typeof opts.size == 'string') {\n\t\t\topts.size = parseSize(opts.size);\n\t\t}\n\t\t\n\t\tthis._name = opts.name;\n\t\tthis._style = opts.style;\n\t\tthis.size = opts.size;\n\t\tthis.sizePx = toPx(this.size).value;\n\t\tthis.sizePt = toPt(this.size).value;\n\t\tthis._weight = opts.weight;\n\n\t\tthis._isBold = /bold/i.test(this._weight);\n\t};\n\t\n\tthis.getSize = function () { return this.sizePx; }\n\n\tthis.getName = function () { return this._name; }\n\tthis.getWeight = function () { return this._weight; }\n});\n\nexports.parse = function (str) {\n\tif (str in _cache) {\n\t\treturn _cache[str];\n\t} else {\n\t\treturn new Font(str);\n\t}\n}\n","pre":true},"sdk/jsio/std/uri.js":{"path":"sdk/jsio/std/uri.js","friendlyPath":"std.uri","directory":"sdk/jsio/std/","filename":"uri.js","baseMod":"std","basePath":"sdk/jsio","src":"var attrs = [ \n\t\"source\",\n\t\"protocol\",\n\t\"authority\",\n\t\"userInfo\",\n\t\"user\",\n\t\"password\",\n\t\"host\",\n\t\"port\",\n\t\"relative\",\n\t\"path\",\n\t\"directory\",\n\t\"file\",\n\t\"query\",\n\t\"anchor\"\n];\n\nvar sdk_jsio_std_uri=__class__;var URI = exports=sdk_jsio_std_uri(function sdk_jsio_std_uri(){return this.init&&this.init.apply(this,arguments)},function(supr) {\n\tthis.init = function(url, isStrict) {\n\t\tif (url instanceof URI) {\n\t\t\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\t\t\tthis['_' + attr] = url['_' + attr];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tthis._isStrict = isStrict;\n\t\t\n\t\tvar uriData = exports.parse(url, isStrict);\n\t\tfor (var attr in uriData) {\n\t\t\tthis['_' + attr] = uriData[attr];\n\t\t};\n\t}\n  \n\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\t(function(attr) {\n\t\t\tvar fNameSuffix = attr.charAt(0).toUpperCase() + attr.slice(1);\n\t\t\tthis['get' + fNameSuffix] = function() {\n\t\t\t\treturn this['_' + attr];\n\t\t\t};\n\t\t\tthis['set' + fNameSuffix] = function(val) {\n\t\t\t\tthis['_' + attr] = val;\n\t\t\t\treturn this;\n\t\t\t};\n\t\t}).call(this, attr);\n\t};\n\t\n\tthis.query = function(key) { return exports.parseQuery(this._query)[key]; }\n\tthis.hash = function(key) { return exports.parseQuery(this._anchor)[key]; }\n\t\n\tthis.addHash = function(kvp) {\n\t\tvar hash = exports.parseQuery(this._anchor);\n\t\tfor (var i in kvp) { hash[i] = kvp[i]; }\n\t\tthis._anchor = exports.buildQuery(hash);\n\t\treturn this;\n\t}\n\t\n\tthis.push = function(path) {\n\t\tif (path) {\n\t\t\tthis._path = (this._path + '/' + path).replace(/\\/\\/+/g, '/');\n\t\t}\n\t\treturn this;\n\t}\n\t\n\tthis.addQuery = function(kvp) {\n\t\tvar query = exports.parseQuery(this._query);\n\t\tfor (var i in kvp) { query[i] = kvp[i]; }\n\t\tthis._query = exports.buildQuery(query);\n\t\treturn this;\n\t}\n\t\n\tthis.removeQuery = function(keys) {\n\t\tvar query = exports.parseQuery(this._query);\n\t\tif (isArray(keys)) {\n\t\t\tfor (var i = 0, n = keys.length; i < n; ++i) {\n\t\t\t\tdelete query[keys[i]];\n\t\t\t}\n\t\t} else {\n\t\t\tdelete query[keys];\n\t\t}\n\t\tthis._query = exports.buildQuery(query);\n\t\treturn this;\n\t}\n\n\tthis.toJSON = function() { return this.toString(false); }\n\n\tthis.toString = function(onlyBase) {\n\t\t// XXX TODO: This is vaguely reasonable, but not complete. fix it...\n\t\tvar a = this._protocol ? this._protocol + \"://\" : \"\"\n\t\tvar b = this._host ? this._host + ((this._port || 80) == 80 ? \"\" : \":\" + this._port) : \"\";\n\t\t\n\t\tif (onlyBase) {\n\t\t\treturn a + b;\n\t\t}\n\t\t\n\t\tvar c = this._path;\n\t\tvar d = this._query ? '?' + this._query : '';\n\t\tvar e = this._anchor ? '#' + this._anchor : '';\n\t\treturn a + b + c + d + e;\n\t};\n});\n\nexports.relativeTo = function(url, base) {\n\tvar url = String(url);\n\tif (base && !/^http(s?):\\/\\//.test(url)) {\n\t\tvar baseURI = new exports(base)\n\t\t\t.setAnchor('')\n\t\t\t.setQuery('')\n\t\t\t.setFile('')\n\t\t\t.toString(url.charAt(0) == '/');\n\n\t\turl = exports.resolveRelative(baseURI + url);\n\t}\n\n\treturn new URI(url);\n}\n\nexports.resolveRelative = function(url) {\n\tvar prevUrl;\n\t\n\t// remove ../ with preceeding folder\n\twhile((prevUrl = url) != (url = url.replace(/(^|\\/)([^\\/]+)\\/\\.\\.\\//g, '/'))) {};\n\t\n\t// remove ./ if it isn't preceeded by a .\n\treturn url.replace(/[^.]\\.\\//g, '');\n}\n\nexports.buildQuery = function(kvp) {\n\tvar pairs = [];\n\tfor (var key in kvp) {\n\t\tpairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(kvp[key]));\n\t}\n\treturn pairs.join('&');\n}\n\nexports.parseQuery = function(str) {\n\tvar pairs = str.split('&'),\n\t\tn = pairs.length,\n\t\tdata = {};\n\tfor (var i = 0; i < n; ++i) {\n\t\tvar pair = pairs[i].split('='),\n\t\t\tkey = decodeURIComponent(pair[0]);\n\t\tif (key) { data[key] = decodeURIComponent(pair[1]); }\n\t}\n\treturn data;\n}\n\n// Regexs are based on parseUri 1.2.2\n// Original: (c) Steven Levithan <stevenlevithan.com>\n// Original: MIT License\n\nvar strictRegex = /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nvar looseRegex = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nvar queryStringRegex = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\nexports.parse = function(str, isStrict) {\n\tvar regex = isStrict ? strictRegex : looseRegex;\n\tvar result = {};\n\tvar match = regex.exec(str);\n\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\tresult[attr] = match[i] || \"\";\n\t}\n\t\n\tvar qs = result['queryKey'] = {};\n\tresult['query'].replace(queryStringRegex, function(check, key, val) {\n\t\tif (check) {\n\t\t\tqs[key] = val;\n\t\t}\n\t});\n\t\n\treturn result;\n}\n\nexports.isSameDomain = function(urlA, urlB) {\n\tvar a = exports.parse(urlA);\n\tvar b = exports.parse(urlB);\n\treturn ((a.port == b.port ) && (a.host == b.host) && (a.protocol == b.protocol));\n};\n","pre":true},"sdk/timestep/platforms/native/Canvas.js":{"path":"sdk/timestep/platforms/native/Canvas.js","friendlyPath":".Canvas","directory":"sdk/timestep/platforms/native/","filename":"Canvas.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import .Context2D');\n\n// mock canvas object for IOS\n\nlogger.log('setting up the canvas object');\nvar sdk_timestep_platforms_native_Canvas=__class__;var Canvas = GLOBAL.HTMLCanvasElement = exports=sdk_timestep_platforms_native_Canvas(function sdk_timestep_platforms_native_Canvas(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\twidth: 400,\n\t\t\theight: 400,\n\t\t\toffscreen: true\n\t\t});\n\t\t\n\t\t// TODO: add getters/setters to width/height to auto-resize -- we'll need to allocate\n\t\t// a new texture in OpenGL and blit the old one into the new one\n\t\t\n\t\tthis._width = opts.width;\n\t\tthis._height = opts.height;\n\t\tthis._offscreen = opts.offscreen;\n\n\t\tthis.style = {};\n\t\tthis._context2D = null;\n\t\tthis.complete = true;\n\t}\n\t\n\tthis.__defineSetter__('width', function (width) {\n\t\tthis._width = width;\n\t\tif (this._context2D) { this._resize(); }\n\t});\n\t\n\tthis.__defineGetter__('width', function () { return this._width; });\n\t\n\tthis.__defineSetter__('height', function (height) {\n\t\tthis._height = height;\n\t\tif (this._context2D) { this._resize(); }\n\t});\n\t\n\tthis.__defineGetter__('height', function () { return this._height; });\n\t\n\tthis._resize = function () { throw 'resizing a rendered canvas is not yet implemented!'; }\n\t\n\tthis.getContext = function (which) {\n\t\tif (which.toUpperCase() == '2D') {\n\t\t\tthis.complete = true;\n\t\t\treturn this._context2D || (this._context2D = new Context2D({\n\t\t\t\tcanvas: this,\n\t\t\t\toffscreen: this._offscreen\n\t\t\t}));\n\t\t}\n\t}\n\n\tthis.toFileURI = function (filename) {\n\t\treturn NATIVE.gl.saveBufferToFile(this._context2D, filename)\n\t}\n});\n\nlogger.log('set it up')\nlogger.log(GLOBAL.HTMLCanvasElement)\ndocument.__registerCreateElementHandler('CANVAS', function () {\n\treturn new Canvas();\n});\n\n","pre":true},"sdk/timestep/platforms/native/Context2D.js":{"path":"sdk/timestep/platforms/native/Context2D.js","friendlyPath":".Context2D","directory":"sdk/timestep/platforms/native/","filename":"Context2D.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import std.uri\")\n\njsio(\"import .BufferedCanvas\");\njsio(\"import device\");\njsio(\"import .FontRenderer\");\n\njsio(\"import ui.resource.Font as Font\");\n\nvar createdOnscreenCanvas = false,\n\t__globalScissor = false;\n\nvar sdk_timestep_platforms_native_Context2D=__class__;exports=sdk_timestep_platforms_native_Context2D(function sdk_timestep_platforms_native_Context2D(){return this.init&&this.init.apply(this,arguments)},BufferedCanvas, function (supr) {\n\n\t//FIXME add globalalpha back to these\n\tthis.updateState = function (src, dest) {\n/*\n\t\tobj.stroke = this.stroke;\n\t\tobj.patternQuality = this.patternQuality;\n\t\tobj.fillPattern = this.fillPattern;\n\t\tobj.strokePattern = this.strokePattern;\n*/\n\t\tdest.font = src.font;\n\t\tdest.textAlign = src.textAlign;\n\t\tdest.textBaseline = src.textBaseline;\n\t\tdest.fillStyle = src.fillStyle;\n\t\tdest.strokeStyle = src.strokeStyle;\n/*\n\t\tobj.shadow = this.shadow;\n\t\tobj.shadowBlur = this.shadowBlur;\n\t\tobj.shadowOffsetX = this.shadowOffsetX;\n\t\tobj.shadowOffsetY = this.shadowOffsetY;\n*/\n\t\treturn dest;\n\t};\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis._stack = [];\n\t\tthis._stackPos = 0;\n\n\t\topts = merge(opts, {\n\t\t\twidth: 480,\n\t\t\theight: 320,\n\t\t\toffscreen: true\n\t\t});\n\n\t\tif (!opts.offscreen && createdOnscreenCanvas) {\n\t\t\tthrow 'IOS only supports one on-screen canvas at the moment.  You can create multiple off-screen canvases and draw them to the on-screen canvas.';\n\t\t}\n\n\t\tthis.canvas = opts.canvas || {\n\t\t\twidth: opts.width,\n\t\t\theight: opts.height\n\t\t};\n\n\t\tif (!opts.offscreen) {\n\t\t\tcreatedOnscreenCanvas = true;\n\t\t\tthis.canvas.__gl_name = -1;\n\t\t\tthis.canvas._src = 'onscreen';\n\t\t} else {\n\t\t\tvar textureData = NATIVE.gl.newTexture(this.canvas.width, this.canvas.height);\n\t\t\tthis.canvas.__gl_name = textureData.__gl_name;\n\t\t\tthis.canvas._src = textureData._src;\n\t\t}\n\n\t\tthis._ctx = new NATIVE.gl.Context2D(this.canvas, this.canvas._src, this.canvas.__gl_name);\n\n\t\tfor (var i = 0; i < 64; i++) {\n\t\t\tthis._stack[i] = this.updateState(this, {});\n\t\t}\n\t};\n\n\tthis.getNativeCtx = function () { return this._ctx; }\n\n\tthis.getElement = function () {\n\t\treturn this.canvas;\n\t};\n\n\tthis.font = '10px ' + device.defaultFontFamily;\n\n\tthis.textAlign = 'start';\n\tthis.textBaseline = 'alphabetic';\n\tthis.fillStyle = 'rgb(255,255,255)';\n\tthis.strokeStyle = 'rgb(0,0,0)';\n\n\tthis.destroy = function () {\n\t\tthis._ctx.destroy();\n\t};\n\n\tthis.show = function () {\n\t\t// TODO: NATIVE.gl.show();\n\t};\n\n\tthis.hide = function () {\n\t\t// TODO: NATIVE.gl.hide();\n\t};\n\n\tthis.clear = function () {\n\t\tthis._ctx.clear();\n\t};\n\n\tthis.swap = function (operations) {\n\t\tNATIVE.gl.flushImages();\n\t};\n\n\tthis.loadIdentity = function () {\n\t\tthis._ctx.loadIdentity();\n\t};\n\n\tthis.save = function () {\n\t\tif (this._stack.length <= this._stackPos) {\n\t\t\tlogger.log('expanding stack');\n\t\t\tthis._stack.push({});\n\t\t}\n\t\tthis.updateState(this, this._stack[this._stackPos++]);\n\t\tthis._ctx.save();\n\t};\n\n\tthis.restore = function () {\n\t\tthis._ctx.restore();\n\t\tthis.updateState(this._stack[this._stackPos--], this);\n\t};\n\n\tthis.clipRect = function (x, y, w, h) {\n\t\tthis._ctx.enableScissor(x, y, w, h);\n\t};\n\n\tthis.drawImage = function (img, x1, y1, w1, h1, x2, y2, w2, h2) {\n\t\tif (!img || !img.complete) { return; }\n\t\tvar n = arguments.length,\n\t\t\top = this.getCompositeOperationID();\n\n\t\tif (n == 3) {\n\t\t\tthis._ctx.drawImage(img.__gl_name, img._src, 0, 0, img.width, img.height, x1, y1, img.width, img.height, op);\n\t\t} else if (n == 5) {\n\t\t\tthis._ctx.drawImage(img.__gl_name, img._src, 0, 0, img.width, img.height, x1, y1, w1, h1, op);\n\t\t} else {\n\t\t\tthis._ctx.drawImage(img.__gl_name, img._src, x1, y1, w1, h1, x2, y2, w2, h2, op);\n\t\t}\n\t};\n\n\tthis.translate = function (x, y) { this._ctx.translate(x, y); }\n\tthis.rotate = function (r) { this._ctx.rotate(r); }\n\tthis.scale = function (x, y) { this._ctx.scale(x, y); }\n\n\tthis.setFilters = function (filters) {\n\t\tfor (var name in filters) {\n\t\t\tvar filter = filters[name];\n\t\t\tthis._ctx.addFilter(name, filter.get());\n\t\t}\n\t}\n\n\tthis.clearFilters = function () {\n\t\tthis._ctx.clearFilters();\n\t}\n\n\t//FIXME the getter seems to crash v8 on android\t\n\tthis.__defineSetter__(\n\t\t'globalAlpha',\n\t\tfunction (alpha) {\n\t\t\tthis._ctx.setGlobalAlpha(alpha);\n\t\t}\n\t);\n\n\tthis.__defineGetter__(\n\t\t'globalAlpha',\n\t\tfunction () {\n\t\t\treturn this._ctx.getGlobalAlpha();\n\t\t}\n\t);\n\n\tvar compositeOps = {\n\t\t'source-atop': 1337,\n\t\t'source-in': 1338,\n\t\t'source-out': 1339,\n\t\t'source-over': 1340,\n\t\t'destination-atop': 1341,\n\t\t'destination-in': 1342,\n\t\t'destination-out': 1343,\n\t\t'destination-over': 1344,\n\t\t'lighter': 1345,\n\t\t'xor': 1346,\n\t\t'copy': 1347\n\t};\n\n\tthis._globalCompositeOperation = 'source-over';\n\n\tthis.getCompositeOperationID = function () {\n\t\treturn compositeOps[this.globalCompositeOperation] || 0;\n\t};\n\n\tthis.clearRect = function (x, y, width, height) {\n\t\tthis._ctx.clearRect(x, y, width, height); \n\t};\n\n\tthis.fillRect = function (x, y, width, height) {\n\t\tif (typeof this.fillStyle == 'object') {\n\t\t\tvar img = this.fillStyle.img,\n\t\t\t\tw = img.width, h = img.height,\n\t\t\t\twMax, hMax, xx, yy,\n\t\t\t\top = this.getCompositeOperationID();\n\t\t\tswitch (this.fillStyle.repeatPattern) {\n\t\t\t\tcase 'repeat':\n\t\t\t\t\tfor (xx = 0; xx < width; xx += w) {\n\t\t\t\t\t\twMax = Math.min(w, width - xx);\n\t\t\t\t\t\tfor (yy = y; yy < height; yy += h) {\n\t\t\t\t\t\t\thMax = Math.min(h, height - yy);\n\t\t\t\t\t\t\tthis._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x + xx, y + yy, wMax, hMax, op);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'repeat-x':\n\t\t\t\t\tfor (xx = 0; xx < width; xx += w) {\n\t\t\t\t\t\twMax = Math.min(w, width - xx);\n\t\t\t\t\t\tthis._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x + xx, y, wMax, hMax, op);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'repeat-y':\n\t\t\t\t\tfor (yy = 0; yy < height; yy += h) {\n\t\t\t\t\t\thMax = Math.min(h, height - yy);\n\t\t\t\t\t\tthis._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x, y + yy, wMax, hMax, op);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'no-repeat':\n\t\t\t\tdefault:\n\t\t\t\t\twMax = Math.min(w, width);\n\t\t\t\t\thMax = Math.min(h, height);\n\t\t\t\t\tthis._ctx.drawImage(img.__gl_name, img._src, 0, 0, wMax, hMax, x, y, wMax, hMax, op);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._ctx.fillRect(x, y, width, height, this.fillStyle, this.getCompositeOperationID());\n\t\t}\n\t};\n\n\tthis.strokeRect = function (x, y, width, height) {\n\t\tthis._ctx.strokeRect(x, y, width, height, this.strokeStyle, this.lineWidth || 1, this.getCompositeOperationID());\n\t};\n\n\tthis.createPattern = function (img, repeatPattern) {\n\t\treturn {\n\t\t\timg: img,\n\t\t\trepeatPattern: repeatPattern\n\t\t};\n\t};\n\n\tthis._checkPath = function () {\n\t\tif (!this._path) {\n\t\t\tthis._path = [];\n\t\t}\n\t\tif (this._pathIndex === undefined) {\n\t\t\tthis._pathIndex = 0;\n\t\t}\n\t\treturn (this._pathIndex > 0);\n\t};\n\n\tthis.beginPath = function () {\n\t\tthis._pathIndex = 0;\n\t};\n\n\tthis.moveTo = this.lineTo = function (x, y) {\n\t\tthis._checkPath();\n\t\tthis._path[this._pathIndex] = {x:x, y:y};\n\t\tthis._pathIndex++;\n\t};\n\n\tthis.pointSprite = null;\n\tthis.pointSpriteStep = 2;\n\tthis.drawPointSprites = function (x1, y1, x2, y2) {\n\t\tthis._ctx.drawPointSprites(this.pointSprite.src, this.lineWidth || 5, this.pointSpriteStep || 2, this.strokeStyle, x1, y1, x2, y2);\n\t}\n\t\n\tthis.closePath = function () {};\n\n\tthis.fill = function () {\n\t\tif (this._checkPath()) {\n\t\t\tthis._ctx.fill(this._path, this._pathIndex, this.fillStyle, this.getCompositeOperationID());\n\t\t}\n\t};\n\n\tthis.stroke = function () {\n\t\tif (this._checkPath()) {\n\t\t\tthis._ctx.stroke(this._path, this._pathIndex, this.strokeStyle, this.getCompositeOperationID());\n\t\t}\n\t};\n\n    this.fillText = FontRenderer.wrapFillText(function (str, x, y, maxWidth) {\n        var font = Font.parse(this.font);\n        var fontName = font.getName();\n\n        this._ctx.fillText(\n            str + '',\n            x,\n            y,\n            maxWidth || 0,\n            this.fillStyle,\n            font.getSize(),\n            /*font.getWeight() + ' ' + */fontName,\n            this.textAlign,\n            this.textBaseline,\n            this.getCompositeOperationID()\n            );\n    });\n\n    this.fill = function () {}\n    this.stroke = function () {}\n\n    this.strokeText = FontRenderer.wrapStrokeText(function (str, x, y, maxWidth) {\n        var font = Font.parse(this.font);\n        var fontName = font.getName();\n\n        this._ctx.strokeText(\n            str + '',\n            x,\n            y,\n            maxWidth || 0,\n            this.strokeStyle,\n            font.getSize(),\n            fontName,\n            this.textAlign,\n            this.textBaseline,\n            this.getCompositeOperationID(),\n            this.lineWidth\n            );\n    });\n\n    this.measureText = FontRenderer.wrapMeasureText(function (str) {\n        var font = Font.parse(this.font);\n        var fontName = font.getName();\n\n        return this._ctx.measureText(str + '', font.getSize(), font.getWeight() + ' ' + fontName);\n    });\n});\n","pre":true},"sdk/timestep/platforms/native/BufferedCanvas.js":{"path":"sdk/timestep/platforms/native/BufferedCanvas.js","friendlyPath":".BufferedCanvas","directory":"sdk/timestep/platforms/native/","filename":"BufferedCanvas.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\nfunction getter(name) {\n\treturn (function () {\n\t\treturn this._ctxShim[name];\n\t});\n}\n\nfunction setter(name) {\n\treturn (function (val) {\n\t\tthis._ctxShim[name] = val;\n\t});\n}\n\nfunction wrap(name) {\n\treturn function () {};\n}\n\nvar sdk_timestep_platforms_native_BufferedCanvas=__class__;exports=sdk_timestep_platforms_native_BufferedCanvas(function sdk_timestep_platforms_native_BufferedCanvas(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\t\n\tthis.init = function () {\n\t\tthis._ctxShim = {};\n\t}\n\t\n\tthis.getViewport = function (targetView) {\n\t\tif (this._viewport) {\n\t\t\tvar viewport = new math2D.Rect(this._viewport),\n\t\t\t\tsrc = this._viewport.src,\n\t\t\t\tv = targetView,\n\t\t\t\ttrace = [targetView];\n\t\t\t\n\t\t\twhile(v != src) {\n\t\t\t\tv = v._superview;\n\t\t\t\tif (!v) { return null; }\n\t\t\t\ttrace.push(v);\n\t\t\t}\n\t\t\t\n\t\t\t// TODO: finish this - translate viewport to local coordinates?\n\t\t\t// should use a modified View::getAbsolutePos(relativeTo)\n\t\t\twhile((v = trace.pop())) {\n\t\t\t\t//viewport.\n\t\t\t}\n\t\t\t\n\t\t\treturn viewport;\n\t\t}\n\t}\n\t\n\tthis.swap = function () {}\n\t\n\tthis.reset = function () {\n\t\tthis._buffer = [];\n\t}\n\t\n\tthis.show = this.hide = function () { throw 'abstract'; }\n\n\tthis.drawImage = wrap('drawImage');\n\tthis.putImageData = wrap('putImageData');\n\t\n\tthis.fillRect = wrap('fillRect');\n\tthis.fillCircle = function (x, y, radius, fillStyle) {\n\t\tthis._buffer.push(['beginPath']);\n\t\tthis._buffer.push(['arc', [x, y, radius, 0, 2 * Math.PI, true]]);\n\t\tthis._buffer.push(['fill']);\n\t}\n\t\n\tthis.fillText = wrap('fillText');\n\tthis.measureText = wrap('measureText');\n\tthis.strokeText = wrap('strokeText');\n\tthis.beginPath = wrap('beginPath');\n\tthis.moveTo = wrap('moveTo');\n\tthis.closePath = wrap('closePath');\n\tthis.lineTo = wrap('lineTo');\n\n\tthis.arc = wrap('arc');\n\tthis.quadraticCurveTo = wrap('quadraticCurveTo');\n\t\n\tthis.rect = wrap('rect');\n\tthis.fillRect = wrap('fillRect');\n\tthis.strokeRect = wrap('strokeRect');\n\n\tthis.save = wrap('save');\n\tthis.restore = wrap('restore');\n\t\n\tthis.clip = wrap('clip');\n\tthis.stroke = wrap('stroke');\n\tthis.fill = wrap('fill');\n\t\n\tthis.translate = wrap('translate');\n\tthis.rotate = wrap('rotate');\n\tthis.scale = wrap('scale');\n\n});\n","pre":true},"sdk/timestep/platforms/native/FontRenderer.js":{"path":"sdk/timestep/platforms/native/FontRenderer.js","friendlyPath":".FontRenderer","directory":"sdk/timestep/platforms/native/","filename":"FontRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import ui.Color as Color\");\njsio(\"import ui.filter as filter\");\njsio(\"import ui.resource.Font as Font\");\n\nvar _customFonts = {},\n\t_customFontInfo = {};\n\nfunction loadCustomFontImage(customFont, index) {\n\tvar image = new Image();\n\n\timage.onload = function () {\n\t\timage.onload = null;\n\t\tcustomFont.imagesLoaded++;\n\t\tcustomFont.loaded = (customFont.imagesLoaded === customFont.imagesTotal);\n\t}\n\timage._src = 'resources/fonts/' + customFont.filename + index + '.png';\n\timage.src = image._src;\n\n\treturn image;\n}\n\nfunction findVerticalInfo(dimensions) {\n\t// A..Z, a..z, all\n\tvar ranges = [{start: 0x41, end: 0x5A}, {start: 0x61, end: 0x7A}, {start: 0x20, end: 0xFF}];\n\tvar range;\n\tvar dimension;\n\tvar found = false;\n\tvar baseline = 0;\n\tvar bottom = 0;\n\tvar i;\n\n\tfor (i = 0; i < ranges.length; i++) {\n\t\trange = ranges[i];\n\t\tfor (j = range.start; j <= range.end; j++) {\n\t\t\tdimension = dimensions[j];\n\t\t\tif (dimension) {\n\t\t\t\tbaseline = Math.max(baseline, dimension.h);\n\t\t\t\tbottom = Math.max(bottom, dimension.h);\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t}\n\t\tif (found) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\tbaseline: baseline,\n\t\tbottom: bottom\n\t};\n}\n\nfunction findHorizontalInfo(dimensions) {\n\t// a..z, A..Z\n\tvar ranges = [{start: 0x61, end: 0x7A}, {start: 0x41, end: 0x5A}, {start: 0x20, end: 0xFF}];\n\tvar range;\n\tvar dimension;\n\tvar width = 0;\n\tvar count = 0;\n\tvar i, j;\n\n\tfor (i = 0; i < ranges.length; i++) {\n\t\trange = ranges[i];\n\t\tfor (j = range.start; j <= range.end; j++) {\n\t\t\tdimension = dimensions[j];\n\t\t\tif (dimension) {\n\t\t\t\twidth += dimension.w;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\tif (count !== 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\twidth: width / count\n\t};\n}\n\nfunction loadingCustomFont(customFont) {\n\tif (customFont.imagesLoaded !== -1) {\n\t \treturn !customFont.loaded;\n\t}\n\n\tvar settings = customFont.settings,\n\t\tfilename = settings.filename,\n\t\timages,\n\t\timage,\n\t\tinfo,\n\t\ti, j;\n\n\tif (_customFontInfo[filename]) {\n\t\tinfo = _customFontInfo[filename];\n\t\tcustomFont.dimensions = info.dimensions;\n\t\tcustomFont.horizontal = info.horizontal;\n\t\tcustomFont.vertical = info.vertical;\n\t} else {\n\t\tvar basename = 'resources/fonts/' + filename;\n\t\tvar json = CACHE[basename + '.json'];\n\t\tif (json == null) {\n\t\t\tvar js = CACHE[basename + '.js'];\n\t\t\tif (js) {\n\t\t\t\tjson = js.replace(/^\\s*exports\\s*=\\s*|;\\s*$/g, '');\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tcustomFont.dimensions = JSON.parse(json);\n\t\tcustomFont.horizontal = findHorizontalInfo(customFont.dimensions);\n\t\tcustomFont.horizontal.tracking = settings.tracking;\n\t\tcustomFont.horizontal.outline = settings.outline;\n\t\tcustomFont.vertical = findVerticalInfo(customFont.dimensions);\n\n\t\t_customFontInfo[filename] = {\n\t\t\tdimensions: customFont.dimensions,\n\t\t\thorizontal: customFont.horizontal,\n\t\t\tvertical: customFont.vertical\n\t\t};\n\t}\n\n\tcustomFont.images = [];\n\tcustomFont.imagesLoaded = 0;\n\n\timages = customFont.images;\n\n\tswitch (customFont.type) {\n\t\tcase 'color':\n\t\t\tfor (i = 0; i < settings.count; i++) {\n\t\t\t\timages[i] = [];\n\t\t\t\timages[i].push(loadCustomFontImage(customFont, '_0_' + i));\n\t\t\t\tcustomFont.imagesTotal++;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'composite':\n\t\t\tfor (i = 1; i < 3; i++) {\n\t\t\t\timages[i - 1] = [];\n\t\t\t\tfor (j = 0; j < settings.count; j++) {\n\t\t\t\t\timages[i - 1].push(loadCustomFontImage(customFont, '_' + i + '_' + j));\n\t\t\t\t\tcustomFont.imagesTotal++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\treturn true;\n}\n\n(function () {\n\tvar manifest = window.CONFIG;\n\n\tif (manifest.fonts) {\n\t\tvar fonts = manifest.fonts,\n\t\t\tfont,\n\t\t\tcustomFont,\n\t\t\ti = fonts.length;\n\n\t\twhile (i) {\n\t\t\tfont = fonts[--i];\n\t\t\t\n\t\t\tcustomFont = {\n\t\t\t\tfilename: font.filename,\n\t\t\t\tsettings: font,\n\t\t\t\timagesLoaded: -1,\n\t\t\t\timagesTotal: 0,\n\t\t\t\tloaded: false,\n\t\t\t\ttype: 'color'\n\t\t\t};\n\t\t\t_customFonts[font.contextName + ' color'] = customFont;\n\t\t\t//font.preloadColor && \n\t\t\tloadingCustomFont(customFont);\n\n\t\t\tcustomFont = {\n\t\t\t\t// The difference between color- and composite-filename is in the suffix!!!\n\t\t\t\tfilename: font.filename,\n\t\t\t\tsettings: font,\n\t\t\t\timagesLoaded: -1,\n\t\t\t\timagesTotal: 0,\n\t\t\t\tloaded: false,\n\t\t\t\ttype: 'composite'\n\t\t\t}\n\t\t\t_customFonts[font.contextName + ' composite'] = customFont;\n\t\t\t//font.preloadComposite && \n\t\t\tloadingCustomFont(customFont);\n\t\t}\n\t}\n})();\n\nexports.findFontInfo = function (ctx) {\n\tvar font = Font.parse(ctx.font);\n\tvar name = font.getName();\n\tif (name && _customFonts[name]) {\n\t\tcustomFont = _customFonts[name];\n\t\tfont.customFont = customFont;\n\t\tfont.scale = font.getSize() / customFont.settings.size;\n\t\treturn font;\n\t}\n\n\treturn false;\n}\n\nexports.wrapMeasureText = function (origMeasureText) {\n\treturn function (text) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\n\t\tif (!fontInfo) {\n\t\t\treturn origMeasureText.apply(this, arguments);\n\t\t}\n\t\tif (loadingCustomFont(fontInfo.customFont)) {\n\t\t\treturn origMeasureText.apply(this, arguments);\n\t\t}\n\t\tvar measureInfo = this._ctx.measureTextBitmap(text + '', fontInfo);\n\t\tif (measureInfo.failed) {\n\t\t\treturn origMeasureText.apply(this, arguments);\n\t\t}\n\n\t\treturn measureInfo;\n\t}\n};\n\nexports.wrapFillText = function (origFillText) {\n\treturn function (text, x, y) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\n\t\tif (!fontInfo) {\n\t\t\treturn origFillText.apply(this, arguments);\n\t\t}\n\n\t\tif (loadingCustomFont(fontInfo.customFont)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (fontInfo.customFont.type === 'composite') {\n\t\t\tvar color = Color.parse(this.fillStyle);\n\t\t\tif (this.__compositeColor != color) {\n\t\t\t\tthis.__compositeColor = color;\n\t\t\t\tif (!this.__compositeFilter) { this.__compositeFilter = []; }\n\t\t\t\tthis.__compositeFilter[0] = new filter.MultiplyFilter(color);\n\t\t\t}\n\n\t\t\tvar resetFilters = true;\n\t\t\tthis.clearFilters();\n\t\t\tthis.setFilters(this.__compositeFilter);\n\t\t}\n\n\t\tif (!this._ctx.fillTextBitmap(this, x, y, text + '', this.fillStyle, fontInfo, 0)) {\n\t\t\treturn origFillText.apply(this, arguments);\n\t\t}\n\n\t\tif (resetFilters) {\n\t\t\tthis.clearFilters();\n\n\t\t\t// TODO: might be nice to reset original filters... this is a bug in some cases otherwise\n\t\t\t// this.setFilters(originalFilters);\n\t\t}\n\t}\n};\n\nexports.wrapStrokeText = function (origStrokeText) {\n\treturn function (text, x, y) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\n\t\tif (!fontInfo) {\n\t\t\treturn origStrokeText.apply(this, arguments);\n\t\t}\n\n\t\tif (loadingCustomFont(fontInfo.customFont)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (fontInfo.customFont.type === 'composite') {\n\t\t\tvar color = Color.parse(this.strokeStyle);\n\t\t\tif (this.__compositeStrokeColor != color) {\n\t\t\t\tthis.__compositeStrokeColor = color;\n\t\t\t\tif (!this.__compositeStrokeFilter) { this.__compositeStrokeFilter = []; }\n\t\t\t\tthis.__compositeStrokeFilter[0] = new filter.MultiplyFilter(color);\n\t\t\t}\n\n\t\t\tvar resetFilters = true;\n\t\t\tthis.clearFilters();\n\t\t\tthis.setFilters(this.__compositeStrokeFilter);\n\t\t}\n\n\t\tif (!this._ctx.fillTextBitmap(this, x, y, text + '', this.strokeStyle, fontInfo, 1)) {\n\t\t\treturn origStrokeText.apply(this, arguments);\n\t\t}\n\n\t\tif (resetFilters) {\n\t\t\tthis.clearFilters();\n\n\t\t\t// TODO: might be nice to reset original filters... this is a bug in some cases otherwise\n\t\t\t// this.setFilters(originalFilters);\n\t\t}\n\t}\n};\n","pre":true},"sdk/timestep/ui/Color.js":{"path":"sdk/timestep/ui/Color.js","friendlyPath":"ui.Color","directory":"sdk/timestep/ui/","filename":"Color.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.Color\n *\n * @doc http://doc.gameclosure.com/api/color.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/color.md\n */\nvar sdk_timestep_ui_Color=__class__;var RGBA = exports=sdk_timestep_ui_Color(function sdk_timestep_ui_Color(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (rgba) {\n\t\tif (arguments.length > 2) {\n\t\t\tthis.r = arguments[0];\n\t\t\tthis.g = arguments[1];\n\t\t\tthis.b = arguments[2];\n\t\t\tthis.a = (arguments[3] == undefined) ? 1 : arguments[3];\n\t\t} else if (typeof rgba == 'string') {\n\t\t\tthis.parse(rgba);\n\t\t} else if (rgba) {\n\t\t\tthis.set(rgba);\n\t\t}\n\t};\n\n\tthis.set = function (rgba) {\n\t\tthis.r = rgba.r || 0;\n\t\tthis.g = rgba.g || 0;\n\t\tthis.b = rgba.b || 0;\n\t\tthis.a = 'a' in rgba ? rgba.a : 1;\n\t};\n\n\tthis.get = function () {\n\t\treturn {\n\t\t\tr: this.r,\n\t\t\tg: this.g,\n\t\t\tb: this.b,\n\t\t\ta: this.a\n\t\t};\n\t};\n\n\tthis.toHex = function () {\n\t\t// https://gist.github.com/983535\n\t\treturn \"#\" + ((256 + this.r << 8 | this.g) << 8 | this.b).toString(16).slice(1)\n\t};\n\n\tvar rgbParser = /rgba?\\(\\s*([.0-9]+)\\s*,\\s*([.0-9]+)\\s*,\\s*([.0-9]+)\\s*,?\\s*([.0-9]+)?\\s*\\)/;\n\n\tfunction hexToRGB(a) {\n\t\ta = '0x' + a.slice(1).replace(a.length < 5 && /./g, '$&$&');\n\t\treturn [a >> 16, a >> 8 & 255, a & 255];\n\t};\n\n\tthis.parse = function (str) {\n\t\tvar match = str.match(rgbParser);\n\t\tif (match) {\n\t\t\tthis.r = parseInt(match[1]) || 0;\n\t\t\tthis.g = parseInt(match[2]) || 0;\n\t\t\tthis.b = parseInt(match[3]) || 0;\n\t\t\tif (4 in match) {\n\t\t\t\tvar a = parseFloat(match[4]);\n\t\t\t\tthis.a = isNaN(a) ? 1 : a;\n\t\t\t} else {\n\t\t\t\tthis.a = 1;\n\t\t\t}\n\t\t} else {\n\n\t\t\tthis.a = 1;\n\n\t\t\tif (str.length == 9) {\n\t\t\t\tstr = str.substring(0, 7);\n\t\t\t\tthis.a = '0x' + str.substring(7, 9) | 0;\n\t\t\t}\n\n\t\t\tvar match = hexToRGB(str);\n\t\t\tif (match) {\n\t\t\t\tthis.r = match[0];\n\t\t\t\tthis.g = match[1];\n\t\t\t\tthis.b = match[2];\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.toString = function () {\n\t\treturn 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + this.a + ')';\n\t};\n});\n\nexports.parse = function (str) {\n\treturn cache[str] || (cache[str] = new RGBA(str));\n};\n\nvar cache = {\n\taliceblue:            new RGBA(240, 248, 255),\n\tantiquewhite:         new RGBA(250, 235, 215),\n\taqua:                 new RGBA(  0, 255, 255),\n\taquamarine:           new RGBA(127, 255, 212),\n\tazure:                new RGBA(240, 255, 255),\n\tbeige:                new RGBA(245, 245, 220),\n\tbisque:               new RGBA(255, 228, 196),\n\tblack:                new RGBA(  0,   0,   0),\n\tblanchedalmond:       new RGBA(255, 235, 205),\n\tblue:                 new RGBA(  0,   0, 255),\n\tblueviolet:           new RGBA(138,  43, 226),\n\tbrown:                new RGBA(165,  42,  42),\n\tburlywood:            new RGBA(222, 184, 135),\n\tcadetblue:            new RGBA( 95, 158, 160),\n\tchartreuse:           new RGBA(127, 255,   0),\n\tchocolate:            new RGBA(210, 105,  30),\n\tcoral:                new RGBA(255, 127,  80),\n\tcornflowerblue:       new RGBA(100, 149, 237),\n\tcornsilk:             new RGBA(255, 248, 220),\n\tcrimson:              new RGBA(220,  20,  60),\n\tcyan:                 new RGBA(  0, 255, 255),\n\tdarkblue:             new RGBA(  0,   0, 139),\n\tdarkcyan:             new RGBA(  0, 139, 139),\n\tdarkgoldenrod:        new RGBA(184, 134,  11),\n\tdarkgray:             new RGBA(169, 169, 169),\n\tdarkgreen:            new RGBA(  0, 100,   0),\n\tdarkgrey:             new RGBA(169, 169, 169),\n\tdarkkhaki:            new RGBA(189, 183, 107),\n\tdarkmagenta:          new RGBA(139,   0, 139),\n\tdarkolivegreen:       new RGBA( 85, 107,  47),\n\tdarkorange:           new RGBA(255, 140,   0),\n\tdarkorchid:           new RGBA(153,  50, 204),\n\tdarkred:              new RGBA(139,   0,   0),\n\tdarksalmon:           new RGBA(233, 150, 122),\n\tdarkseagreen:         new RGBA(143, 188, 143),\n\tdarkslateblue:        new RGBA( 72,  61, 139),\n\tdarkslategray:        new RGBA( 47,  79,  79),\n\tdarkslategrey:        new RGBA( 47,  79,  79),\n\tdarkturquoise:        new RGBA(  0, 206, 209),\n\tdarkviolet:           new RGBA(148,   0, 211),\n\tdeeppink:             new RGBA(255,  20, 147),\n\tdeepskyblue:          new RGBA(  0, 191, 255),\n\tdimgray:              new RGBA(105, 105, 105),\n\tdimgrey:              new RGBA(105, 105, 105),\n\tdodgerblue:           new RGBA( 30, 144, 255),\n\tfirebrick:            new RGBA(178,  34,  34),\n\tfloralwhite:          new RGBA(255, 250, 240),\n\tforestgreen:          new RGBA( 34, 139,  34),\n\tfuchsia:              new RGBA(255,   0, 255),\n\tgainsboro:            new RGBA(220, 220, 220),\n\tghostwhite:           new RGBA(248, 248, 255),\n\tgold:                 new RGBA(255, 215,   0),\n\tgoldenrod:            new RGBA(218, 165,  32),\n\tgray:                 new RGBA(128, 128, 128),\n\tgrey:                 new RGBA(128, 128, 128),\n\tgreen:                new RGBA(  0, 128,   0),\n\tgreenyellow:          new RGBA(173, 255,  47),\n\thoneydew:             new RGBA(240, 255, 240),\n\thotpink:              new RGBA(255, 105, 180),\n\tindianred:            new RGBA(205,  92,  92),\n\tindigo:               new RGBA( 75,   0, 130),\n\tivory:                new RGBA(255, 255, 240),\n\tkhaki:                new RGBA(240, 230, 140),\n\tlavender:             new RGBA(230, 230, 250),\n\tlavenderblush:        new RGBA(255, 240, 245),\n\tlawngreen:            new RGBA(124, 252,   0),\n\tlemonchiffon:         new RGBA(255, 250, 205),\n\tlightblue:            new RGBA(173, 216, 230),\n\tlightcoral:           new RGBA(240, 128, 128),\n\tlightcyan:            new RGBA(224, 255, 255),\n\tlightgoldenrodyellow: new RGBA(250, 250, 210),\n\tlightgray:            new RGBA(211, 211, 211),\n\tlightgreen:           new RGBA(144, 238, 144),\n\tlightgrey:            new RGBA(211, 211, 211),\n\tlightpink:            new RGBA(255, 182, 193),\n\tlightsalmon:          new RGBA(255, 160, 122),\n\tlightseagreen:        new RGBA( 32, 178, 170),\n\tlightskyblue:         new RGBA(135, 206, 250),\n\tlightslategray:       new RGBA(119, 136, 153),\n\tlightslategrey:       new RGBA(119, 136, 153),\n\tlightsteelblue:       new RGBA(176, 196, 222),\n\tlightyellow:          new RGBA(255, 255, 224),\n\tlime:                 new RGBA(  0, 255,   0),\n\tlimegreen:            new RGBA( 50, 205,  50),\n\tlinen:                new RGBA(250, 240, 230),\n\tmagenta:              new RGBA(255,   0, 255),\n\tmaroon:               new RGBA(128,   0,   0),\n\tmediumaquamarine:     new RGBA(102, 205, 170),\n\tmediumblue:           new RGBA(  0,   0, 205),\n\tmediumorchid:         new RGBA(186,  85, 211),\n\tmediumpurple:         new RGBA(147, 112, 219),\n\tmediumseagreen:       new RGBA( 60, 179, 113),\n\tmediumslateblue:      new RGBA(123, 104, 238),\n\tmediumspringgreen:    new RGBA(  0, 250, 154),\n\tmediumturquoise:      new RGBA( 72, 209, 204),\n\tmediumvioletred:      new RGBA(199,  21, 133),\n\tmidnightblue:         new RGBA( 25,  25, 112),\n\tmintcream:            new RGBA(245, 255, 250),\n\tmistyrose:            new RGBA(255, 228, 225),\n\tmoccasin:             new RGBA(255, 228, 181),\n\tnavajowhite:          new RGBA(255, 222, 173),\n\tnavy:                 new RGBA(  0,   0, 128),\n\toldlace:              new RGBA(253, 245, 230),\n\tolive:                new RGBA(128, 128,   0),\n\tolivedrab:            new RGBA(107, 142,  35),\n\torange:               new RGBA(255, 165,   0),\n\torangered:            new RGBA(255,  69,   0),\n\torchid:               new RGBA(218, 112, 214),\n\tpalegoldenrod:        new RGBA(238, 232, 170),\n\tpalegreen:            new RGBA(152, 251, 152),\n\tpaleturquoise:        new RGBA(175, 238, 238),\n\tpalevioletred:        new RGBA(219, 112, 147),\n\tpapayawhip:           new RGBA(255, 239, 213),\n\tpeachpuff:            new RGBA(255, 218, 185),\n\tperu:                 new RGBA(205, 133,  63),\n\tpink:                 new RGBA(255, 192, 203),\n\tplum:                 new RGBA(221, 160, 221),\n\tpowderblue:           new RGBA(176, 224, 230),\n\tpurple:               new RGBA(128,   0, 128),\n\tred:                  new RGBA(255,   0,   0),\n\trosybrown:            new RGBA(188, 143, 143),\n\troyalblue:            new RGBA( 65, 105, 225),\n\tsaddlebrown:          new RGBA(139,  69,  19),\n\tsalmon:               new RGBA(250, 128, 114),\n\tsandybrown:           new RGBA(244, 164,  96),\n\tseagreen:             new RGBA( 46, 139,  87),\n\tseashell:             new RGBA(255, 245, 238),\n\tsienna:               new RGBA(160,  82,  45),\n\tsilver:               new RGBA(192, 192, 192),\n\tskyblue:              new RGBA(135, 206, 235),\n\tslateblue:            new RGBA(106,  90, 205),\n\tslategray:            new RGBA(112, 128, 144),\n\tslategrey:            new RGBA(112, 128, 144),\n\tsnow:                 new RGBA(255, 250, 250),\n\tspringgreen:          new RGBA(  0, 255, 127),\n\tsteelblue:            new RGBA( 70, 130, 180),\n\ttan:                  new RGBA(210, 180, 140),\n\tteal:                 new RGBA(  0, 128, 128),\n\tthistle:              new RGBA(216, 191, 216),\n\ttomato:               new RGBA(255,  99,  71),\n\ttransparent:          new RGBA(  0,   0,   0,   0),\n\tturquoise:            new RGBA( 64, 224, 208),\n\tviolet:               new RGBA(238, 130, 238),\n\twheat:                new RGBA(245, 222, 179),\n\twhite:                new RGBA(255, 255, 255),\n\twhitesmoke:           new RGBA(245, 245, 245),\n\tyellow:               new RGBA(255, 255,   0),\n\tyellowgreen:          new RGBA(154, 205,  50)\n};\n","pre":true},"sdk/timestep/ui/filter.js":{"path":"sdk/timestep/ui/filter.js","friendlyPath":"ui.filter","directory":"sdk/timestep/ui/","filename":"filter.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module ui.filter;\n *\n * A namespace for graphical filters used in games. These are attached using\n * View functions and applied using the Image class. This class is purely informational.\n *\n * If this is a namespace, the file name should be lower-case!\n *\n * Resources:\n *  http://jswidget.com/blog/2011/03/11/image-blending-algorithmpart-i/\n *  http://jswidget.com/blog/2011/03/11/image-blending-algorithmpart-ii/\n *\n * @doc http://doc.gameclosure.com/api/ui-filter.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/filter.md\n */\n\njsio(\"import ui.resource.Image as Image\");\n\nexports.Filter=__class__;var Filter = exports.Filter=exports.Filter(function exports_Filter(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar defaults = {\n\t\tpriority: 0,\n\t\ttype: null,\n\t\tr: 0,\n\t\tg: 0,\n\t\tb: 0,\n\t\ta: 0\n\t};\n\n\tthis.init = function (opts) {\n\t\tthis._opts = merge(opts, defaults);\n\t\tthis._views = [];\n\t};\n\n\tthis.get = function () {\n\t\treturn this._opts;\n\t};\n\n\tthis.getType = function () {\n\t\treturn this._opts.type;\n\t};\n\n\tthis.update = function (opts) {\n\t\topts = opts || {};\n\t\tfor (var prop in opts) {\n\t\t\tif (typeof this._opts[prop] != 'undefined') {\n\t\t\t\tthis._opts[prop] = opts[prop];\n\t\t\t}\n\t\t}\n\t\tfor (var i = 0; i < this._views.length; i++) {\n\t\t\tvar view = this._views[i];\n\t\t\tview.__view.filterColor = this.getColorString();\n\t\t\tview.__view.filterType = Filter.TYPES[this.getType()] || 0;\n\t\t}\n\t};\n\n\tthis.setView = function (view) {\n\t\tif (this._views.indexOf(view) == -1) {\n\t\t\tthis._views.push(view);\n\t\t}\n\t};\n\n\tthis.removeView = function (view) {\n\t\tvar i = this._views.indexOf(view);\n\t\tif (i != -1) {\n\t\t\tthis._views.splice(i, 1);\n\t\t}\n\t};\n\n\tthis.getColorString = function () {\n\t\tvar c = this._opts;\n\t\treturn 'rgba(' + c.r + ',' + c.g + ',' + c.b + ',' + c.a + ')';\n\t};\n});\n\nFilter.TYPES = {\n\t\"None\": 0,\n\t\"LinearAdd\": 1, \n\t\"Multiply\": 2\n};\n\n/**\n * Linear add (lighten) filter.\n */\n\nexports.LinearAddFilter=__class__;exports.LinearAddFilter=exports.LinearAddFilter(function exports_LinearAddFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this,'init',arguments);\n\t\tthis._opts.type = 'LinearAdd';\n\t};\n\n\tthis.get = function () {\n\t\treturn this._opts;\n\t};\n});\n\n/**\n * Tint (averaging) filter.\n */\n\nexports.TintFilter=__class__;exports.TintFilter=exports.TintFilter(function exports_TintFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._opts.type = 'Tint';\n\t};\n\n\tthis.get = function () {\n\t\treturn this._opts;\n\t};\n});\n\n/**\n * Multiply filter.\n */\n\nexports.MultiplyFilter=__class__;exports.MultiplyFilter=exports.MultiplyFilter(function exports_MultiplyFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._opts.type = 'Multiply';\n\t};\n\n\tthis.get = function () {\n\t\treturn this._opts;\n\t};\n});\n\n/**\n * Positive masking.\n */\n\nexports.PositiveMaskFilter=__class__;exports.PositiveMaskFilter=exports.PositiveMaskFilter(function exports_PositiveMaskFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._opts.type = 'PositiveMask';\n\t\tif (this._opts.image) {\n\t\t\tthis._opts.imgObject = new Image({url: this._opts.image});\n\t\t}\n\t};\n\n\tthis.get = function () {\n\t\treturn this._opts;\n\t};\n});\n\n/**\n * Negative masking.\n */\n\nexports.NegativeMaskFilter=__class__;exports.NegativeMaskFilter=exports.NegativeMaskFilter(function exports_NegativeMaskFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._opts.type = 'NegativeMask';\n\t\tif (this._opts.image) {\n\t\t\tthis._opts.imgObject = new Image({url: this._opts.image});\n\t\t}\n\t};\n\n\tthis.get = function () {\n\t\treturn this._opts;\n\t}\n});\n","pre":true},"sdk/timestep/ui/resource/Image.js":{"path":"sdk/timestep/ui/resource/Image.js","friendlyPath":"ui.resource.Image","directory":"sdk/timestep/ui/resource/","filename":"Image.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.resource.Image;\n * Model an Image for rendering. Supports taking a subset of images, to support\n * extracting from compacted sprite sheets. Also supports applying filters to\n * an image, usually by the View class.\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html#class-ui.resource.image\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio(\"import event.Callback as Callback\");\njsio(\"import math.geom.Rect as Rect\");\njsio(\"import device\");\njsio(\"import ui.resource.loader as resourceLoader\");\n\n/**\n * Callback when images are loaded. This has a failsafe that runs up to a certain\n * threshold asynchronously, attempting to read the image size, before dying.\n */\n\nvar ImageCache = {};\n\nfunction imageOnLoad(success, evt, failCount) {\n\t// Some browsers report onLoad before the image width is available.\n\tif (success && !this.width) {\n\t\tif (failCount > 3) {\n\t\t\tthis.onLoad = this.onError = null;\n\t\t\treturn this.__cb.fire(false);\n\t\t}\n\n\t\treturn setTimeout(bind(this, imageOnLoad, success, evt, (failCount || 0) + 1), 0);\n\t}\n\n\tthis.__cb.fire(success);\n\tthis.isError = !success;\n\tthis.onLoad = this.onError = null;\n}\n\n/**\n * This class models the region of a larger image that this \"Image\" references.\n */\n\nvar ImageMap = !GLOBAL.CONFIG.disableNativeViews && GLOBAL.NATIVE && GLOBAL.NATIVE.timestep && GLOBAL.NATIVE.timestep.ImageMap;\n\nif (!ImageMap) {\nImageMap=__class__;\tImageMap=ImageMap(function ImageMap(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\tthis.init = function (parentImage, x, y, width, height, marginTop, marginRight, marginBottom, marginLeft, url) {\n\t\t\tthis.url = url;\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.width = width;\n\t\t\tthis.height = height;\n\t\t\tthis.marginTop = marginTop;\n\t\t\tthis.marginRight = marginRight;\n\t\t\tthis.marginBottom = marginBottom;\n\t\t\tthis.marginLeft = marginLeft;\n\t\t}\n\t});\n}\n\nvar sdk_timestep_ui_resource_Image=__class__;exports=sdk_timestep_ui_resource_Image(function sdk_timestep_ui_resource_Image(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tif (!opts) { opts = {}; }\n\n\t\tthis._cb = new Callback();\n\t\tthis._map = new ImageMap(this, 0, 0, -1, -1, 0, 0, 0, 0, opts.url || '');\n\n\t\tthis._originalURL = opts.url;\n\n\t\tresourceLoader._updateImageMap(this._map, opts.url, opts.sourceX, opts.sourceY, opts.sourceW, opts.sourceH);\n\n\t\tthis._scale = opts.scale;\n\n\t\t// srcImage can be null, then setSrcImg will create one\n\t\t// (use the map's URL in case it was updated to a spritesheet)\n\t\tthis._setSrcImg(opts.srcImage, this._map.url, opts.forceReload);\n\t};\n\n\tthis._setSrcImg = function (img, url, forceReload) {\n\t\tthis._cb.reset();\n\n\t\t// if we haven't found an image, look in the image cache\n\t\tif (!img && url && !forceReload && ImageCache[url]) {\n\t\t\timg = ImageCache[url];\n\t\t}\n\n\t\t// look up the base64 cache -- if it's been preloaded, we'll get back an image that's already loaded\n\t\t// if it has not been preloaded, we'll get back raw base64 in the b64 variable\n\t\tif (!img && !forceReload && Image.get) {\n\t\t\tvar b64 = Image.get(url);\n\t\t\tif (typeof b64 == 'object') {\n\t\t\t\timg = b64;\n\t\t\t} else if (b64) {\n\t\t\t\turl = b64;\n\t\t\t}\n\t\t}\n\n\t\tif (forceReload) {\n\t\t\t// clear native texture in an image object\n\t\t\tif (img && img.destroy) {\n\t\t\t\timg.destroy();\n\t\t\t}\n\n\t\t\t// clear native textures by URL\n\t\t\tif (url && NATIVE && NATIVE.gl && NATIVE.gl.deleteTexture) {\n\t\t\t\tNATIVE.gl.deleteTexture(url);\n\t\t\t}\n\t\t}\n\n\t\t// if it's already loaded...\n\t\tif (img && img.complete) {\n\t\t\tthis._srcImg = img;\n\t\t\tthis._onLoad(!img.isError);\n\t\t} else {\n\t\t\t// add a callback and wait for it\n\n\t\t\t// create an image if we don't have one\n\t\t\tthis._srcImg = img = img || new Image();\n\n\t\t\tif (!img.__cb) {\n\t\t\t\timg.__cb = new Callback();\n\t\t\t\timg.addEventListener('load', bind(img, imageOnLoad, true), false);\n\t\t\t\timg.addEventListener('error', bind(img, imageOnLoad, false), false);\n\n\t\t\t\tif (url) { ImageCache[url] = img; }\n\t\t\t\tif (!img.src && url) {\n\t\t\t\t\tthis._srcImg.src = this._map.url = url;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\timg.__cb.run(this, '_onLoad');\n\t\t}\n\t};\n\n\tthis.setSource = this.setSrcImg = function (srcImg) {\n\t\tthis._setSrcImg(srcImg);\n\t};\n\n\tthis.__reload__ = function (cb) {\n\t\tif (this._srcImg) {\n\t\t\tvar chainedCb = cb.chain();\n\n\t\t\tvar onReload = bind(this, function () {\n\t\t\t\tthis._srcImg.removeEventListener('reload', onReload, false);\n\t\t\t\tchainedCb();\n\t\t\t});\n\n\t\t\tthis._srcImg.addEventListener('reload', onReload, false);\n\t\t}\n\t};\n\n\tthis.setURL = function (url, forceReload) {\n\t\tresourceLoader._updateImageMap(this._map, url);\n\t\tthis._setSrcImg(null, this._map.url, forceReload);\n\t};\n\n\tthis.getURL = function () { return this._map.url; };\n\tthis.getOriginalURL = function () { return this._originalURL; }\n\n\tthis.getSourceWidth = this.getOrigWidth = this.getOrigW = function () { return this._srcImg.width; };\n\tthis.getSourceHeight = this.getOrigHeight = this.getOrigH = function () { return this._srcImg.height; };\n\n\tthis.setSourceWidth = this.setSourceW = function (w) { this._map.width = w; };\n\tthis.setSourceHeight = this.setSourceH = function (h) { this._map.height = h; };\n\tthis.setSourceY = this.setSourceY = function (y) { this._map.y = y; };\n\tthis.setSourceX = this.setSourceX = function (x) { this._map.x = x; };\n\n\tthis.setMarginTop = function (n) { this._map.marginTop = n; };\n\tthis.setMarginRight = function (n) { this._map.marginRight = n; };\n\tthis.setMarginBottom = function (n) { this._map.marginBottom = n; };\n\tthis.setMarginLeft = function (n) { this._map.marginLeft = n; };\n\n\tthis.getURL = function () { return this._map.url; }\n\n\t/* @deprecated */\n\tthis.getSourceWidth = this.getOrigWidth = this.getOrigW = function () { return this._srcImg.width; }\n\t/* @deprecated */\n\tthis.getSourceHeight = this.getOrigHeight = this.getOrigH = function () { return this._srcImg.height; }\n\t/* @deprecated */\n\tthis.setSourceWidth = this.setSourceW = function (w) { this._map.width = w; }\n\t/* @deprecated */\n\tthis.setSourceHeight = this.setSourceH = function (h) { this._map.height = h; }\n\t/* @deprecated */\n\tthis.setSourceY = this.setSourceY = function (y) { this._map.y = y; }\n\t/* @deprecated */\n\tthis.setSourceX = this.setSourceX = function (x) { this._map.x = x; }\n\t/* @deprecated */\n\tthis.setMarginTop = function (n) { this._map.marginTop = n; }\n\t/* @deprecated */\n\tthis.setMarginRight = function (n) { this._map.marginRight = n; }\n\t/* @deprecated */\n\tthis.setMarginBottom = function (n) { this._map.marginBottom = n; }\n\t/* @deprecated */\n\tthis.setMarginLeft = function (n) { this._map.marginLeft = n; }\n\t\n\tthis.getSource = function () {\n\t\treturn this._srcImg;\n\t};\n\n\tthis.getWidth = function () {\n\t\treturn (this._map.width == -1\n\t\t\t? 0\n\t\t\t: this._map.width + this._map.marginLeft + this._map.marginRight) / this._map.scale;\n\t};\n\n\tthis.getHeight = function () {\n\t\treturn (this._map.height == -1 ? 0 :\n\t\t\t\t\t\t\t   this._map.height + this._map.marginTop + this._map.marginBottom) / this._map.scale;\n\t};\n\n\tthis.getMap =\n\tthis.getBounds = function () { return this._map; };\n\tthis.setBounds = function (x, y, w, h, marginTop, marginRight, marginBottom, marginLeft) {\n\t\tvar map = this._map;\n\t\tmap.x = x;\n\t\tmap.y = y;\n\t\tmap.width = w;\n\t\tmap.height = h;\n\t\tmap.marginTop = marginTop || 0;\n\t\tmap.marginRight = marginRight || 0;\n\t\tmap.marginBottom = marginBottom || 0;\n\t\tmap.marginLeft = marginLeft || 0;\n\t};\n\n\t/* @deprecated */\n\tthis.setBounds = this.setMap;\n\t\n\t// register a callback for onload\n\tthis.doOnLoad = function () { this._cb.forward(arguments); return this; };\n\n\t// internal onload handler for actual Image object\n\tthis._onLoad = function (didLoad) {\n\t\tif (!didLoad) {\n\t\t\t// TODO: something better?\n\t\t\tlogger.error('Image failed to load:', this._map.url);\n\t\t\tthis._isError = true;\n\t\t\tthis._cb.fire({NoImage: true});\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._srcImg.width == 0) { logger.warn('Image has no width', this._url); }\n\n\t\tvar map = this._map;\n\t\tif (this._scale && (map.width != -1 || map.height != -1)) {\n\t\t\t// requested scale & provided a width or height\n\t\t\tif (map.width == -1) {\n\t\t\t\t// by the above check, this._sourceH should not be -1\n\t\t\t\tmap.width = this._srcImg.width * map.height / this._srcImg.height;\n\t\t\t}\n\n\t\t\tif (map.height == -1) {\n\t\t\t\t// this._sourceW was initialized above\n\t\t\t\tmap.height = this._srcImg.height * map.width / this._srcImg.width;\n\t\t\t}\n\n\t\t\t// TODO: sourceImage might be shared so we can't actually modify width/height.  This is a bug.\n\t\t\tthis._srcImg.width = map.width;\n\t\t\tthis._srcImg.height = map.height;\n\t\t} else {\n\t\t\tif (map.width == -1) { map.width = this._srcImg.width; }\n\t\t\tif (map.height == -1) { map.height = this._srcImg.height; }\n\t\t}\n\n\t\tthis._map.url = this._srcImg.src;\n\n\t\tthis._cb.fire(null, this);\n\t};\n\n\tthis.isError = function () { return this._isError; }\n\tthis.isLoaded =\n\tthis.isReady = function () { return !this._isError && this._cb.fired(); };\n\n\tvar isNative = GLOBAL.NATIVE && !device.simulatingMobileNative;\n\tvar SLICE = Array.prototype.slice;\n\tif (!isNative) {\n\t\tvar Canvas = device.get('Canvas');\n\t\tvar _filterCanvas = new Canvas();\n\t\tvar _filterCtx = _filterCanvas.getContext('2d');\n\t};\n\n\tthis.render = function (ctx, destX, destY, destW, destH) {\n\t\tif (!this._cb.fired()) { return; }\n\n\t\ttry {\n\t\t\tvar args = arguments;\n\t\t\tvar map = this._map;\n\t\t\tvar scaleX;\n\t\t\tvar scaleY;\n\n\t\t\tif (!(ctx.filters && (ctx.filters.Multiply || ctx.filters.NegativeMask || ctx.filters.PositiveMask))) {\n\t\t\t\tif (args.length == 9) {\n\t\t\t\t\tctx.drawImage(this._srcImg, args[1], args[2], args[3], args[4], args[5], args[6], args[7], args[8]);\n\t\t\t\t} else if (destX instanceof Rect) {\n\t\t\t\t\tif (destY instanceof Rect) {\n\t\t\t\t\t\tvar srcRect = destX;\n\t\t\t\t\t\tvar destRect = destY;\n\t\t\t\t\t\tscaleX = destRect.width / (map.marginLeft + map.width + map.marginRight);\n\t\t\t\t\t\tscaleY = destRect.height / (map.marginTop + map.height + map.marginBottom);\n\t\t\t\t\t\tctx.drawImage(this._srcImg,\n\t\t\t\t\t\t\tsrcRect.x, srcRect.y, srcRect.width, srcRect.height,\n\t\t\t\t\t\t\tdestRect.x, destRect.y, destRect.width, destRect.height);\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar destRect = destX;\n\t\t\t\t\t\tscaleX = destRect.width / (map.marginLeft + map.width + map.marginRight);\n\t\t\t\t\t\tscaleY = destRect.height / (map.marginTop + map.height + map.marginBottom);\n\t\t\t\t\t\tctx.drawImage(this._srcImg,\n\t\t\t\t\t\t\t\t\t  map.x, map.y, map.width, map.height,\n\t\t\t\t\t\t\t\t\t  destRect.x + scaleX * map.marginLeft,\n\t\t\t\t\t\t\t\t\t  destRect.y + scaleY * map.marginTop,\n\t\t\t\t\t\t\t\t\t  scaleX * map.width,\n\t\t\t\t\t\t\t\t\t  scaleY * map.height);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tscaleX = destW / (map.marginLeft + map.width + map.marginRight);\n\t\t\t\t\tscaleY = destH / (map.marginTop + map.height + map.marginBottom);\n\n\t\t\t\t\tctx.drawImage(this._srcImg,\n\t\t\t\t\t\t\t\t  map.x, map.y, map.width, map.height,\n\t\t\t\t\t\t\t\t  (destX || 0) + scaleX * map.marginLeft,\n\t\t\t\t\t\t\t\t  (destY || 0) + scaleY * map.marginTop,\n\t\t\t\t\t\t\t\t  scaleX * map.width,\n\t\t\t\t\t\t\t\t  scaleY * map.height);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar renderArgs = arguments, img = this;\n\n\t\t\tfunction applyOperation(color, op1, op2) {\n\t\t\t\t_filterCanvas.width = destW;\n\t\t\t\t_filterCanvas.height = destH;\n\t\t\t\t_filterCtx.globalCompositeOperation = 'source-over';\n\t\t\t\timg.render.apply(img, [_filterCtx].concat(SLICE.call(renderArgs, 1)));\n\n\t\t\t\t_filterCtx.globalCompositeOperation = op1;\n\t\t\t\t_filterCtx.fillStyle = \"rgba(\" + color.r  + \",\" + color.g + \",\" + color.b + \",\" + color.a + \")\";\n\t\t\t\t_filterCtx.fillRect(destX || 0, destY || 0, destW || map.width, destH || map.height);\n\n\t\t\t\tvar oldCompositeOperation = ctx.globalCompositeOperation;\n\t\t\t\tctx.globalCompositeOperation = op2;\n\t\t\t\tctx.drawImage(_filterCanvas, destX || 0, destY || 0, destW || map.width, destH || map.height);\n\t\t\t\tctx.globalCompositeOperation = oldCompositeOperation;\n\t\t\t}\n\n\t\t\t// Rendering engine flags.\n\t\t\tvar isWebkit = /WebKit/.exec(navigator.appVersion);\n\t\t\tif (!isNative && ctx.filters) {\n\n\t\t\t\tif (ctx.filters.LinearAdd) {\n\t\t\t\t\tvar f = ctx.filters.LinearAdd.get();\n\t\t\t\t\tapplyOperation(f, 'source-in', 'lighter');\n\t\t\t\t}\n\n\t\t\t\tif (ctx.filters.Tint) {\n\t\t\t\t\tvar f = ctx.filters.Tint.get();\n\t\t\t\t\tvar color = {r: f.r, g: f.g, b: f.b, a: f.a};\n\t\t\t\t\tapplyOperation(color, 'source-in', 'source-over');\n\t\t\t\t}\n\n\t\t\t\tif (ctx.filters.Multiply) {\n\t\t\t\t\tvar f = ctx.filters.Multiply.get();\n\t\t\t\t\tvar imgData = this.getImageData();\n\t\t\t\t\tvar data = imgData.data;\n\t\t\t\t\t\n\t\t\t\t\tfor (var i = 0; i < data.length; i+=4) {\n\t\t\t\t\t\tdata[i] *= (f.r / 255);\n\t\t\t\t\t\tdata[i + 1] *= (f.g / 255); \n\t\t\t\t\t\tdata[i + 2] *= (f.b / 255); \n\t\t\t\t\t}\n\n\t\t\t\t\t_filterCanvas.width = imgData.width;\n\t\t\t\t\t_filterCanvas.height = imgData.height;\n\t\t\t\t\t_filterCtx.putImageData(imgData, 0, 0);\n\t\t\t\t\tctx.drawImage(_filterCanvas, destX || 0, destY || 0, destW || map.width, destH || map.height);\n\n\t\t\t\t}\n\n\t\t\t\tif (ctx.filters.NegativeMask) {\n\t\t\t\t\tvar f = ctx.filters.NegativeMask.get();\n\t\t\t\t\t_filterCanvas.width = destW;\n\t\t\t\t\t_filterCanvas.height = destH;\n\t\t\t\t\t_filterCtx.globalCompositeOperation = 'source-over';\n\t\t\t\t\tf.imgObject.render.apply(f.imgObject, [_filterCtx].concat(SLICE.call(renderArgs, 1)));\n\n\t\t\t\t\t_filterCtx.globalCompositeOperation = 'source-in';\n\t\t\t\t\timg.render.apply(img, [_filterCtx].concat(SLICE.call(renderArgs, 1)));\n\n\t\t\t\t\tvar oldCompositeOperation = ctx.globalCompositeOperation;\n\t\t\t\t\tctx.globalCompositeOperation = 'source-over';\n\t\t\t\t\tctx.drawImage(_filterCanvas, destX || 0, destY || 0, destW || map.width, destH || map.height);\n\t\t\t\t\tctx.globalCompositeOperation = oldCompositeOperation;\n\t\t\t\t}\n\n\t\t\t\tif (ctx.filters.PositiveMask) {\n\t\t\t\t\tvar f = ctx.filters.PositiveMask.get();\n\t\t\t\t\t_filterCanvas.width = destW;\n\t\t\t\t\t_filterCanvas.height = destH;\n\t\t\t\t\t_filterCtx.globalCompositeOperation = 'source-over';\n\t\t\t\t\tf.imgObject.render.apply(f.imgObject, [_filterCtx].concat(SLICE.call(renderArgs, 1)));\n\n\t\t\t\t\t_filterCtx.globalCompositeOperation = 'source-out';\n\t\t\t\t\timg.render.apply(img, [_filterCtx].concat(SLICE.call(renderArgs, 1)));\n\n\t\t\t\t\tvar oldCompositeOperation = ctx.globalCompositeOperation;\n\t\t\t\t\tctx.globalCompositeOperation = 'source-over';\n\t\t\t\t\tctx.drawImage(_filterCanvas, destX || 0, destY || 0, destW || map.width, destH || map.height);\n\t\t\t\t\tctx.globalCompositeOperation = oldCompositeOperation;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch(e) {}\n\t};\n\n\tthis.getImageData = function () {\n\t\tif (!GLOBAL.document || !document.createElement) { throw 'Not supported'; }\n\t\tif (!this._map.width || !this._map.height) { throw 'Not loaded'; }\n\n\t\tvar canvas = document.createElement('canvas');\n\t\tcanvas.width = this._map.width;\n\t\tcanvas.height = this._map.height;\n\t\tvar ctx = canvas.getContext('2d');\n\n\t\tthis.render(ctx, 0, 0, this._map.width, this._map.height);\n\n\t\tvar imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n\t\treturn imageData;\n\t};\n\n\tthis.setImageData = function (data) { };\n\n\tthis.destroy = function () {\n\t\tthis._srcImg.destroy && this._srcImg.destroy();\n\t};\n});\n\nexports.__clearCache__ = function () {\n\tImageCache = {};\n};\n","pre":true},"sdk/timestep/event/Callback.js":{"path":"sdk/timestep/event/Callback.js","friendlyPath":"event.Callback","directory":"sdk/timestep/event/","filename":"Callback.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.Callback;\n * Namespace shim to bring in Callback from jsio.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.callback\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio(\"import lib.Callback as exports\");\n","pre":true},"sdk/jsio/lib/Callback.js":{"path":"sdk/jsio/lib/Callback.js","friendlyPath":"lib.Callback","directory":"sdk/jsio/lib/","filename":"Callback.js","src":"var sdk_jsio_lib_Callback=__class__;exports=sdk_jsio_lib_Callback(function sdk_jsio_lib_Callback(){return this.init&&this.init.apply(this,arguments)},function() {\n\n\tthis._fired = false;\n\tthis._id = 0;\n\tthis._pending = null;\n\n\tthis.init = function() { this._run = []; };\n\t\n\t/* fired is @deprecated in favor of hasFired*/\n\tthis.hasFired = this.fired = function() { return this._fired; } ;\n\n\t// preserve pending callbacks, but clear fired status\n\tthis.reset = function() { this._args = []; this._fired = false; };\n\n\t// clear fired status and remove any pending callbacks\n\tthis.clear = function() { this.reset(); this._run = []; this._pending = null; this._stat = null; };\n\n\t// a convenience function to proxy arguments to `this.run`: arguments passed as the first argument\n\tthis.forward = function(args) { this.run.apply(this, args); };\n\n\t// when the lib.Callback object fires, run a ctx, method, and\n\t// (optional) curried arguments or a single callback function\n\tthis.run = function(ctx, method) {\n\t\tvar f = method ? bind.apply(this, arguments) : ctx;\n\t\tif (f) {\n\t\t\tif (this._fired) {\n\t\t\t\tf.apply(this, this._args);\n\t\t\t} else {\n\t\t\t\tthis._run.push(f);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.runOrTimeout = function(onFire, onTimeout, duration) {\n\t\tif (!onFire && !onTimeout) { return; }\n\n\t\tif (this._fired) {\n\t\t\tonFire.apply(this, this._args);\n\t\t} else {\n\t\t\tvar f = bind(this, function() {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tonFire.apply(this, this._args);\n\t\t\t});\n\n\t\t\tthis.run(f);\n\n\t\t\tvar timeout = setTimeout(bind(this, function() {\n\t\t\t\tfor (var i = 0, n = this._run.length; i < n; ++i) {\n\t\t\t\t\tif (this._run[i] == f) {\n\t\t\t\t\t\tthis._run.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tonTimeout();\n\t\t\t}), duration);\n\t\t}\n\t};\n\n\tthis.fire = function() {\n\t\tif (this._fired) { return; }\n\t\tthis._fired = true;\n\n\t\tvar cbs = this._run;\n\t\tthis._args = arguments;\n\t\tfor(var i = 0, len = cbs.length; i < len; ++i) {\n\t\t\tif (cbs[i]) { cbs[i].apply(this, arguments); }\n\t\t}\n\t};\n\n\tthis.chain = function(id) {\n\t\tif (!this._pending) { this._pending = {}; }\n\t\tif (id === undefined) { id = this._id++; }\n\t\tthis._pending[id] = true;\n\n\t\tthis.reset();\n\t\treturn bind(this, '_deferred', id);\n\t};\n\n\tthis._deferred = function(id) {\n\t\tif (!this._stat) { this._stat = {}; }\n\t\tif (this._stat.hasOwnProperty(id)) { return; }\n\n\t\tthis._stat[id] = Array.prototype.slice.call(arguments, 1);\n\t\tvar pending = this._pending;\n\t\tdelete pending[id];\n\t\tfor (var id in pending) {\n\t\t\tif (pending.hasOwnProperty(id)) { return; }\n\t\t}\n\n\t\tthis.fire(this._stat);\n\t};\n});\n","pre":true},"sdk/jsio/math/geom/Rect.js":{"path":"sdk/jsio/math/geom/Rect.js","friendlyPath":"math.geom.Rect","directory":"sdk/jsio/math/geom/","filename":"Rect.js","baseMod":"math","basePath":"sdk/jsio","src":"jsio(\"import lib.Enum\");\njsio(\"import .Point\");\njsio(\"import .Line\");\njsio(\"import .intersect\");\n\n/**\n * Model a rectangle.\n */\n\nvar sdk_jsio_math_geom_Rect=__class__;var Rect = exports=sdk_jsio_math_geom_Rect(function sdk_jsio_math_geom_Rect(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b, c, d) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0: // init\n\t\t\t\tthis.width = this.height = this.x = this.y = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1: // copy\n\t\t\t\tthis.width = a.width;\n\t\t\t\tthis.height = a.height;\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tbreak;\n\t\t\tcase 2: // (x, y), (width, height)\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tthis.width = b.x;\n\t\t\t\tthis.height = b.y;\n\t\t\t\tbreak;\n\t\t\tcase 3: // (x, y), width, height\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tthis.width = b;\n\t\t\t\tthis.height = c;\n\t\t\t\tbreak;\n\t\t\tcase 4: // x, y, width, height\n\t\t\t\tthis.x = a;\n\t\t\t\tthis.y = b;\n\t\t\t\tthis.width = c;\n\t\t\t\tthis.height = d;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Normalize negative height and width dimensions by adjusting the position\n\t * of the rect.\n\t */\n\t\n\tthis.normalize = function() {\n\t\tif (this.width < 0) {\n\t\t\tthis.x -= this.width;\n\t\t\tthis.width = -this.width;\n\t\t}\n\t\t\n\t\tif (this.height < 0) {\n\t\t\tthis.y -= this.height;\n\t\t\tthis.height = -this.height;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Generate the intersection of a rectange with another rectangle.\n\t */\n\n\tthis.intersectRect = function (rect) {\n\t\tif (intersect.isRectAndRect(this, rect)) {\n\t\t\tvar x1 = this.x;\n\t\t\tvar y1 = this.y;\n\t\t\tvar x2 = this.x + this.width;\n\t\t\tvar y2 = this.y + this.height;\n\n\t\t\tthis.x = Math.max(x1, rect.x),\n\t\t\tthis.y = Math.max(y1, rect.y),\n\t\t\tthis.width = Math.min(x2, rect.x + rect.width) - this.x;\n\t\t\tthis.height = Math.min(y2, rect.y + rect.height) - this.y;\n\t\t} else {\n\t\t\tthis.width = 0;\n\t\t\tthis.height = 0;\n\t\t}\n\t}\n\t\n\t/**\n\t * Generate the union of a rectange with another rectangle.\n\t */\n\t\n\tthis.unionRect = function(rect) {\n\t\tthis.normalize();\n\t\tif (rect.normalize) { rect.normalize(); }\n\t\t\n\t\tvar x2 = this.x + this.width,\n\t\t\ty2 = this.y + this.height;\n\t\t\n\t\tvar rx2 = rect.x + rect.width,\n\t\t\try2 = rect.y + rect.height;\n\t\t\n\t\tthis.x = this.x < rect.x ? this.x : rect.x;\n\t\tthis.y = this.y < rect.y ? this.y : rect.y;\n\t\t\n\t\tthis.width = (x2 > rx2 ? x2 : rx2) - this.x;\n\t\tthis.height = (y2 > ry2 ? y2 : ry2) - this.y;\n\t};\n\n\t/**\n\t * Get a point for the given corner.\n\t */\n\t\n\tthis.getCorner = function(i) {\n\t\tswitch(i) {\n\t\t\tcase CORNERS.TOP_LEFT:\n\t\t\t\treturn new Point(this.x, this.y);\n\t\t\tcase CORNERS.TOP_RIGHT:\n\t\t\t\treturn new Point(this.x + this.width, this.y);\n\t\t\tcase CORNERS.BOTTOM_LEFT:\n\t\t\t\treturn new Point(this.x, this.y + this.height);\n\t\t\tcase CORNERS.BOTTOM_RIGHT:\n\t\t\t\treturn new Point(this.x + this.width, this.y + this.height);\n\t\t}\n\t}\n\t\n\t/**\n\t * Return a line corresponding to the given side.\n\t */\n\t\n\tthis.getSide = function(i) {\n\t\tswitch(i) {\n\t\t\tcase SIDES.TOP:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.TOP_LEFT), this.getCorner(CORNERS.TOP_RIGHT));\n\t\t\tcase SIDES.RIGHT:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.TOP_RIGHT), this.getCorner(CORNERS.BOTTOM_RIGHT));\n\t\t\tcase SIDES.BOTTOM:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.BOTTOM_RIGHT), this.getCorner(CORNERS.BOTTOM_LEFT));\n\t\t\tcase SIDES.LEFT:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.BOTTOM_LEFT), this.getCorner(CORNERS.TOP_LEFT));\n\t\t}\n\t}\n\n\t/**\n\t * Return the center point of a rectangle.\n\t */\n\t\n\tthis.getCenter = function() {\n\t\treturn new Point(this.x + this.width / 2, this.y + this.height / 2);\n\t}\n});\n\nvar SIDES = Rect.SIDES = lib.Enum('TOP', 'BOTTOM', 'LEFT', 'RIGHT');\nvar CORNERS = Rect.CORNERS = lib.Enum('TOP_LEFT', 'TOP_RIGHT', 'BOTTOM_RIGHT', 'BOTTOM_LEFT');\n","pre":true},"sdk/jsio/lib/Enum.js":{"path":"sdk/jsio/lib/Enum.js","friendlyPath":"lib.Enum","directory":"sdk/jsio/lib/","filename":"Enum.js","src":"exports = function() {\n\tif (arguments.length == 1) {\n\t\tif (typeof arguments[0] == 'object') {\n\t\t\tvar obj = arguments[0];\n\t\t\tfor (var i in obj) {\n\t\t\t\tif (!(obj[i] in obj)) {\n\t\t\t\t\tobj[obj[i]] = i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn obj;\n\t\t} else if (typeof arguments[0] != 'string') {\n\t\t\tkeys = arguments[0];\n\t\t}\n\t}\n\t\n\tif (!keys) { var keys = arguments; }\n\tvar obj = {};\n\tfor(var i = 0, len = keys.length; i < len; ++i) {\n\t\tif (keys[i]) {\n\t\t\tobj[keys[i]] = i + 1;\n\t\t}\n\t\tobj[i + 1] = keys[i];\n\t}\n\treturn obj;\n}","pre":true},"sdk/jsio/math/geom/Point.js":{"path":"sdk/jsio/math/geom/Point.js","friendlyPath":".Point","directory":"sdk/jsio/math/geom/","filename":"Point.js","src":"/**\n * @package math.geom.Point;\n * Models a Point in 2D space.\n */\n\nvar sdk_jsio_math_geom_Point=__class__;var Point = exports=sdk_jsio_math_geom_Point(function sdk_jsio_math_geom_Point(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.x = 0;\n\t\t\t\tthis.y = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.x = a.x || 0;\n\t\t\t\tthis.y = a.y || 0;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.x = a || 0;\n\t\t\t\tthis.y = b || 0;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Rotates this point around the origin by a value in radians.\n\t */\n\t\n\tthis.rotate = function(r) {\n\t\tvar x = this.x,\n\t\t\ty = this.y,\n\t\t\tcosr = Math.cos(r),\n\t\t\tsinr = Math.sin(r);\n\t\t\n\t\tthis.x = x * cosr - y * sinr;\n\t\tthis.y = x * sinr + y * cosr;\n\t\t\n\t\treturn this;\n\t}\n\n\t/**\n\t * Translate this point by two scalars or by another point.\n\t */\n\t\n\tthis.translate = this.add = function(x, y) {\n\t\tif (typeof x == 'number') {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t} else {\n\t\t\tthis.x += x.x;\n\t\t\tthis.y += x.y;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Subtract this point by two scalars or by another point.\n\t */\n\t\n\tthis.subtract = function(x, y) {\n\t\tif (typeof x == 'number') {\n\t\t\tthis.x -= x;\n\t\t\tthis.y -= y;\n\t\t} else {\n\t\t\tthis.x -= x.x;\n\t\t\tthis.y -= x.y;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Scale this number.\n\t */\n\n\tthis.scale = function(sx, sy) {\n\t\t//if no scaleY specified\n\t\tif(sy === undefined) sy = sx;\n\n\t\tthis.x *= sx;\n\t\tthis.y *= sy;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Set the magnitude of this point at a constant angle.\n\t */\n\t\n\tthis.setMagnitude = function(m) {\n\t\tvar theta = this.getAngle();\n\t\tthis.x = m * Math.cos(theta);\n\t\tthis.y = m * Math.sin(theta);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Normalize this point to the unit circle.\n\t */\n\t\n\tthis.normalize = function() {\n\t\tvar m = this.getMagnitude();\n\t\tthis.x /= m;\n\t\tthis.y /= m;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add magnitude to this point.\n\t */\n\t\n\tthis.addMagnitude = function(m) {\n\t\treturn this.setMagnitude(this.getMagnitude() + m);\n\t};\n\n\tthis.getMagnitude = function() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t};\n\n\tthis.getSquaredMagnitude = function() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t};\n\n\tthis.getDirection = this.getAngle = function() {\n\t\treturn Math.atan2(this.y, this.x);\n\t};\n\t\n});\n\n/*\n */\nPoint.getPolarR = function(x, y) { \n\tthrow \"notImplemented\";\n}\n\n/*\n\t### Class Method: Point.getPolarTheta (x, y)\n\t1. `x {number}`\n\t2. `y {number}`\n\t3. Return: `{number}`\n*/\nPoint.getPolarTheta = function(x, y) { \n\tvar val = Math.atan2(y,x) + (Math.PI * 2); \n\treturn val > Math.PI * 2 ? val % (Math.PI * 2) : val;\n}\n\n/*\n\t### Class Method: Point.add (a, b, c, d)\n\t### Class Method: Point.translate (a, b, c, d)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. `d {number}`\n\t5. Return: `{Point}`\n */\nPoint.add = Point.translate = function(a, b, c, d) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).add(b);\n\t\tcase 3: return new Point(a).add(b, c);\n\t\tcase 4: return new Point(a, b).add(c, d);\n\t}\n}\n\n/*\n\t### Class Method: Point.subtract (a, b, c, d)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. `d {number}`\n\t5. Return: `{Point}`\n */\nPoint.subtract = function(a, b, c, d) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).subtract(b);\n\t\tcase 3: return new Point(a).subtract(b, c);\n\t\tcase 4: return new Point(a, b).subtract(c, d);\n\t}\n}\n\n/*\n\t### Class Method: Point.scale (a, b, c) \n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.scale = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).scale(b);\n\t\tcase 3: return new Point(a, b).scale(c);\n\t}\n}\n\n/*\n\t### Class Method: Point.setMagnitude (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n*/\nPoint.setMagnitude = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).setMagnitude(c);\n\t\tcase 3: return new Point(a, b).setMagnitude(c);\n\t}\n}\n\n/*\n\t### Class Method: Point.addMagnitude (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.addMagnitude = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: pt = new Point(a); break;\n\t\tcase 3: pt = new Point(a, b); b = c; break;\n\t}\n\t\n\treturn pt.addMagnitude(b);\n}\n\n/*\n\t### Class Method: Point.getMagnitude (a, b)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. Return: `{Point}`\n */\nPoint.getMagnitude = function(a, b) { return new Point(a, b).getMagnitude(); }\n\n/*\n\t### Class Method: Point.rotate (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.rotate = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).rotate(b);\n\t\tcase 3: return new Point(a, b).rotate(c);\n\t}\n}\n\n/**\n * Treat two points as vectors and project a onto b\n *  (a dot unit(b)) * unit(b)\n */\nPoint.project = function (a, b) {\n\tvar unitB = new Point(b).normalize();\n\treturn unitB.scale(unitB.x * a.x + unitB.y * a.y);\n}\n","pre":true},"sdk/jsio/math/geom/Line.js":{"path":"sdk/jsio/math/geom/Line.js","friendlyPath":".Line","directory":"sdk/jsio/math/geom/","filename":"Line.js","src":"jsio(\"import .Point\");\n\nvar sdk_jsio_math_geom_Line=__class__;exports=sdk_jsio_math_geom_Line(function sdk_jsio_math_geom_Line(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b, c, d) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.start = new Point();\n\t\t\t\tthis.end = new Point();\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.start = new Point(a.start);\n\t\t\t\tthis.end = new Point(a.end);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.start = new Point(a);\n\t\t\t\tthis.end = new Point(b);\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.start = new Point(a);\n\t\t\t\tthis.end = new Point(b, c);\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\tdefault:\n\t\t\t\tthis.start = new Point(a, b);\n\t\t\t\tthis.end = new Point(c, d);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tthis.getMagnitude = \n\tthis.getLength = function() {\n\t\tvar dx = this.end.x - this.start.x,\n\t\t\tdy = this.end.y - this.start.y;\n\t\t\n\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t}\n});\n","pre":true},"sdk/jsio/math/geom/intersect.js":{"path":"sdk/jsio/math/geom/intersect.js","friendlyPath":".intersect","directory":"sdk/jsio/math/geom/","filename":"intersect.js","src":"jsio(\"import .Point\");\njsio(\"import .Line\");\njsio(\"import .Rect\");\n\n/**\n * @package math.geom.intersect\n */\nvar intersect = exports;\n\nintersect.pointAndRect = intersect.ptAndRect = function (pt, rect) {\n\tvar x = pt.x,\n\t\t\ty = pt.y;\n\treturn (x >= rect.x &&\n\t\t\t\t\tx <= rect.x + rect.width &&\n\t\t\t\t\ty >= rect.y &&\n\t\t\t\t\ty <= rect.y + rect.height);\n};\n\nintersect.rectAndPoint = intersect.rectAndPt = function (rect, pt) {\n\treturn intersect.pointAndRect(pt, rect);\n};\n\nintersect.pointAndCircle = intersect.ptAndCirc = function(pt, circle) {\n\tvar dx = pt.x - circle.x,\n\t\t\tdy = pt.y - circle.y;\n\treturn dx * dx + dy * dy < circle.radius * circle.radius;\n};\n\nintersect.circleAndPoint = intersect.circAndPt = function (circle, pt) {\n\treturn intersect.pointAndCircle(pt, circle);\n};\n\nintersect.isRectAndRect = function (rect1, rect2) {\n\treturn !((rect1.y + rect1.height < rect2.y) ||\n\t\t\t\t\t (rect2.y + rect2.height < rect1.y) ||\n\t\t\t\t\t (rect1.x + rect1.width < rect2.x) ||\n\t\t\t\t\t (rect2.x + rect2.width < rect1.x));\n};\n\nintersect.circleAndRect = function(circle, rect) {\n\tif (intersect.pointAndRect(circle, rect)) {\n\t\treturn true;\n\t}\n\treturn (intersect.lineAndCircle(rect.getSide(1), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(2), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(3), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(4), circle));\n};\n\nintersect.rectAndCircle = function(rect, circle) {\n\treturn intersect.circleAndRect(circle, rect);\n};\n\nintersect.lineAndCircle = function (line, circle) {\n\tvar vec = intersect.pointToLine(circle, line);\n\treturn vec.getMagnitude() < circle.radius;\n};\n\nintersect.circleAndLine = function (circle, line) {\n\treturn intersect.lineAndCircle(line, circle);\n};\n\n// returns line from pt to nearest pt on line\nintersect.pointToLine = intersect.ptToLine = function (pt, line) {\n\tvar dx = (line.end.x - line.start.x),\n\t\t\tdy = (line.end.y - line.start.y),\n\t\t\tu = ((pt.x - line.start.x) * dx\t// TODO can we abstract this from 2D to 2D/3D?\n\t\t\t\t\t + (pt.y - line.start.y) * dy) / (dx * dx + dy * dy);\n\n\tvar i;\n\tif (u < 0) {\n\t\ti = new Point(line.start);\n\t} else if (u > 1) {\n\t\ti = new Point(line.end);\n\t} else {\n\t\ti = new Point(line.start.x + u * dx, line.start.y + u * dy);\n\t}\n\treturn new Line(i, pt);\n};\n\n// returns rectangle of intersection\nintersect.rectAndRect = function (rect1, rect2) {\n\tjsio(\"import .Rect\");\n\treturn (intersect.rectAndRect = function(rect1, rect2) {\n\t\tif (rect1 === true) { return new Rect(rect2); }\n\t\tif (rect2 === true) { return new Rect(rect2); }\n\n\t\tif (intersect.isRectAndRect(rect1, rect2)) {\n\t\t\tvar x1 = Math.max(rect1.x, rect2.x),\n\t\t\t\t\ty1 = Math.max(rect1.y, rect2.y),\n\t\t\t\t\tx2 = Math.min(rect1.x + rect1.width, rect2.x + rect2.width),\n\t\t\t\t\ty2 = Math.min(rect1.y + rect1.height, rect2.y + rect2.height);\n\t\t\treturn new Rect(x1, y1, x2 - x1, y2 - y1);\n\t\t}\n\t\treturn null;\n\t})(rect1, rect2);\n}\n","pre":true},"sdk/timestep/ui/resource/loader.js":{"path":"sdk/timestep/ui/resource/loader.js","friendlyPath":"ui.resource.loader","directory":"sdk/timestep/ui/resource/","filename":"loader.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.Callback\");\n\nvar _cache = {};\n\nvar MIME = {\n\t'.png': 'image',\n\t'.jpg': 'image',\n\t'.bmp': 'image',\n\t'.css': 'css',\n\t'.html': 'html',\n\t'.mp3': 'audio',\n\t'.ogg': 'audio',\n\t'.mp4': 'audio',\n\t'.3gp': 'audio',\n\t'.m4a': 'audio',\n\t'.aac': 'audio',\n\t'.flac': 'audio',\n\t'.mkv': 'audio',\n\t'.wav': 'audio'\n};\n\nLoader=__class__;var Loader=Loader(function Loader(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis._map = {};\n\n\tthis.getMap = function () { return this._map; }\n\tthis.setMap = function (map) { \n\t\tvar localizedMap = {};\n\t\t// For any resource staring with resource-local/ change the path to be resources/\n\t\t// This allows localized resources to be loaded the same way for all languages\n\t\tfor (var key in map) {\n\t\t\tvar language = navigator.language && navigator.language.split('-')[0].toLowerCase() || 'en';\n\t\t\tvar localResources = 'resources-' + language;\n\t\t\tvar localLoc = key.indexOf(localResources);\n\t\t\tif (localLoc == 0) {\n\t\t\t\tvar modifiedPath = 'resources' + key.substring(localResources.length);\n\t\t\t\tlocalizedMap[modifiedPath] = map[key];\n\t\t\t} else {\n\t\t\t\tlocalizedMap[key] = map[key];\n\t\t\t}\n\t\t}\n\t\tthis._map = localizedMap; \n\t}\n\t\n\t// TODO: rename this function...\n\tthis.get = function (file) {\n\t\treturn 'resources/images/' + file;\n\t}\n\t\n\t/**\n\t * Preload a given resource or array of resources.\n\t * You can specify a folder name, or even a partial filename,\n\t * to preload all resources that begin with that prefix.\n\t * For instance, in a tree like so:\n\t * \n\t * resources\n\t * └── images\n     *     ├── boss\n     *     │   ├── enemy1.png\n\t *     │   └── enemy2.png\n     *     └── hero\n     *         ├── shield.png\n\t *         └── sword.png\n\t * \n\t * You could preload both enemy images in either of the following\n\t * ways:\n\t * \n\t *     ui.resource.loader.preload(\"resources/images/boss/\");\n\t *     ui.resource.loader.preload(\"resources/images/boss/enemy\");\n\t * \n\t * Pass an array of paths to preload all at once. The callback\n\t * will be called when all resources have finished loading.\n\t * \n\t * This works for both images and sounds.\n\t */\n\tthis.preload = function (pathPrefix, opts, cb) {\n\t\tif (typeof opts == 'function') {\n\t\t\tcb = opts;\n\t\t\topts = undefined;\n\t\t}\n\n\t\t// process an array of items, where cb is run at completion of the final one\n\t\tif (isArray(pathPrefix)) {\n\t\t\tvar chainCb = new lib.Callback();\n\t\t\tpathPrefix.forEach(function (prefix) {\n\t\t\t\tif (prefix) {\n\t\t\t\t\tthis.preload(prefix, opts, chainCb.chain());\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\tcb && chainCb.run(cb);\n\t\t\treturn chainCb;\n\t\t} else {\n\t\t\tpathPrefix = pathPrefix.replace(/^\\//, ''); // remove leading slash\n\t\t\t// if an item is found in the map, add that item's sheet to the group.\n\t\t\t// If there is no sheet in the map (i.e. for sounds), load that file directly.\n\t\t\tvar preloadSheets = {};\n\t\t\tvar map = this._map;\n\t\t\tfor (var uri in map) {\n\t\t\t\tif (uri.indexOf(pathPrefix) == 0) {\n\t\t\t\t\t// sprites have sheet; sounds are just by the filename key itself\n\t\t\t\t\tpreloadSheets[map[uri] && map[uri].sheet || uri] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar files = Object.keys(preloadSheets);\n\n\t\t\tvar callback = this._loadGroup(merge({resources: files}, opts));\n\t\t\tcb && callback.run(cb);\n\t\t\treturn callback;\n\t\t}\n\t};\n\t\n\tvar soundLoader = null;\n\tthis.getSound = function (src) {\n\t\tif (!soundLoader) {\n\t\t\tjsio(\"import AudioManager\");\n\t\t\tsoundLoader = new AudioManager();\n\t\t}\n\n\t\tif (GLOBAL.NATIVE && GLOBAL.NATIVE.sound && GLOBAL.NATIVE.sound.preloadSound) {\n\t\t\treturn NATIVE.sound.preloadSound(src);\n\t\t} else {\n\t\t\tsoundLoader.addSound(src);\n\t\t\t//HACK to make the preloader continue in the browser\n\t\t\treturn { complete: true };\n\t\t}\n\t}\n\n\tthis.getImage = function (src, noWarn) {\n\t\t// create the image\n\t\tvar img = new Image();\n\t\t\n\t\t// find the base64 image if it exists\n\t\tif (Image.get) {\n\t\t\tvar b64 = Image.get(src);\n\t\t\tif (b64 instanceof Image) { \n\t\t\t\treturn b64;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (b64) {\n\t\t\timg.src = b64;\n\t\t\tImage.set(src, img);\n\t\t} else {\n\t\t\tif (!noWarn) { logger.warn(src, 'may not be properly cached!'); }\n\t\t\timg.src = src;\n\t\t}\n\n\t\treturn img;\n\t}\n\n\t/** \n\t * used internally by timestep.Image to seamlessly convert\n\t * non-sprited image URLs to sprited images. This is here (rather\n\t * than in timestep.Image) to keep sprite formats in one consistent place. \n\t */\n\tthis._updateImageMap = function (map, url, x, y, w, h) {\n\n\t\tx = x || 0;\n\t\ty = y || 0;\n\t\tw = w == undefined ? -1 : w;\n\t\th = h == undefined ? -1 : h;\n\n\t\tvar info = this._map[url];\n\t\tif (!info || !info.sheet) {\n\t\t\tmap.x = x;\n\t\t\tmap.y = y;\n\t\t\tmap.width = w;\n\t\t\tmap.height = h;\n\t\t\tmap.scale = 1;\n\t\t\tmap.url = url;\n\t\t\treturn;\n\t\t}\n\n\t\tvar scale = info.scale || 1;\n\n\t\t// calculate the source rectangle, with margins added to the edges\n\t\t// (disregarding the fact that they may fall off the edge of the sheet)\n\t\tmap.x = info.x - info.marginLeft;\n\t\tmap.y = info.y - info.marginTop;\n\t\tmap.width = info.w + info.marginLeft + info.marginRight;\n\t\tmap.height = info.h + info.marginTop + info.marginBottom;\n\t\t\n\t\t// Add in any source map options passed in to get the actual offsets\n\t\tmap.x += x * scale;\n\t\tmap.y += y * scale;\n\t\tif (w > 0) {\n\t\t\tmap.width = w * scale;\n\t\t}\n\t\tif (h > 0) {\n\t\t\tmap.height = h * scale;\n\t\t}\n\t\t\n\t\t// now updatea the margins to account for the new source map\n\t\tmap.marginLeft = Math.max(0, info.x - map.x);\n\t\tmap.marginTop = Math.max(0, info.y - map.y);\n\t\tmap.marginRight = Math.max(0, (map.x + map.width) - (info.x + info.w));\n\t\tmap.marginBottom = Math.max(0, (map.y + map.height) - (info.y + info.h));\n\t\t\n\t\t// and re-offset the source map to exclude margins\n\t\tmap.x += map.marginLeft;\n\t\tmap.y += map.marginTop;\n\t\tmap.width -= (map.marginLeft + map.marginRight);\n\t\tmap.height -= (map.marginTop + map.marginBottom);\n\t\t\n\t\t// the scale of the source image, if scaled in a spritesheet\n\t\tmap.scale = scale;\n\t\tmap.url = info.sheet;\n\n\t\treturn map;\n\t}\n\n\tthis._getRaw = function (type, src, copy, noWarn) {\n\t\t// always return the cached copy unless specifically requested not to\n\t\tif (!copy && _cache[src]) { return _cache[src]; }\n\t\tvar res = null;\n\t\tswitch (type) {\n\t\t\tcase 'audio':\n\t\t\t\tres = this.getSound(src);\n\t\t\t\tbreak;\n\t\t\tcase 'image':\n\t\t\t\tres = this.getImage(src, noWarn);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.error('unknown type for preloader', type);\n\t\t}\n\t\treturn (_cache[src] = res);\n\t}\n\n\t// The callback is called for each image in the group with the image\n\t// source that loaded and whether there was an error.\n\t// \n\t// function callback(lastSrc, error, isComplete, numCompleted, numTotal)\n\t//    where error is true or false and isComplete is true when numCompleted == numTotal\n\t//\n\tthis._loadGroup = function (opts, cb) {\n\t\tvar timeout = opts.timeout;\n\t\tvar callback = new lib.Callback();\n\t\t\n\t\t// compute a list of images using file extensions\n\t\tvar resources = opts.resources || [];\n\t\tvar n = resources.length || 0;\n\t\tvar loadableResources = [];\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tvar ext = resources[i].substring(resources[i].lastIndexOf('.')).split('|')[0];\n\t\t\tif (MIME[ext] == 'image') {\n\t\t\t\tloadableResources.push({type:'image', resource: resources[i]});\n\t\t\t\tGLOBAL.NATIVE && NATIVE.gl && NATIVE.gl.touchTexture(resources[i]);\n\t\t\t} else if (MIME[ext] == 'audio') {\n\t\t\t\tloadableResources.push({type:'audio', resource: resources[i]});\n\t\t\t}\n\t\t}\n\n\t\t// If no resources were loadable,\n\t\tif (!loadableResources.length) {\n\t\t\tcb && callback.run(cb);\n\t\t\tcallback.fire();\n\t\t\treturn callback;\n\t\t}\n\t\t\n\t\t// do the preload asynchronously (note that base64 is synchronous, only downloads are asynchronous)\n\t\tvar nextIndexToLoad = 0;\n\t\tvar numResources = loadableResources.length;\n\t\tvar parallel = Math.min(numResources, opts.parallel || 5); // how many should we try to download at a time?\n\t\tvar numLoaded = 0;\n\n\t\tvar loadResource = bind(this, function () {\n\t\t    var currentIndex = nextIndexToLoad++;\n\t\t\tvar src = loadableResources[currentIndex];\n\t\t\tvar res;\n\t\t\tif (src) {\n\t\t\t\tres = this._getRaw(src.type, src.resource, false, true);\n\t\t\t} else {\n\t\t\t\t// End of resource list, done!\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar next = function (failed) {\n\t\t\t\t// If already complete, stub this out\n\t\t\t\tif (numLoaded >= numResources) { return; }\n\n\t\t\t\t// Set stubs for the reload and load events so that code\n\t\t\t\t// elsewhere can blindly call these without causing problems.\n\t\t\t\t// An alternative would be to set these to null but not every\n\t\t\t\t// piece of code that uses this does the right checks.\n\t\t\t\tres.onreload = res.onload = res.onerror = function() {};\n\n\t\t\t\t// The number of loads (success or failure) has increased.\n\t\t\t\t++numLoaded;\n\n\t\t\t\t// If we have loaded all of the resources,\n\t\t\t\tif (numLoaded >= numResources) {\n\t\t\t\t\t// Call the progress callback with isComplete == true\n\t\t\t\t\tcb && cb(src, failed, true, numLoaded, numResources);\n\n\t\t\t\t\t// If a timeout was set, clear it\n\t\t\t\t\tif (_timeout) {\n\t\t\t\t\t\tclearTimeout(_timeout);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Fire the completion callback chain\n\t\t\t\t\tcallback.fire();\n\t\t\t\t} else {\n\t\t\t\t\t// Call the progress callback with the current progress\n\t\t\t\t\tcb && cb(src, failed, false, numLoaded, numResources);\n\n\t\t\t\t\t// Restart on next image in list\n\t\t\t\t\tsetTimeout(loadResource, 0);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// IF this is the type of resource that has a reload method,\n\t\t\tif (res.reload && res.complete) {\n\t\t\t\t// Use the magic of closures to create a chain of onreload\n\t\t\t\t// completion callbacks.  This is really important because\n\t\t\t\t// we can be be preloading the same resource twice, and we can\n\t\t\t\t// also be simultaneously preloading two groups at once.\n\t\t\t\tvar prevOnLoad = res.onreload;\n\t\t\t\tvar prevOnError = res.onerror;\n\n\t\t\t\t// When the resource completes loading, either with success\n\t\t\t\t// or failure:\n\n\t\t\t\tres.onreload = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnLoad && prevOnLoad();\n\n\t\t\t\t\t// React to successful load of this resource\n\t\t\t\t\tnext(false);\n\t\t\t\t};\n\n\t\t\t\tres.onerror = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnError && prevOnError();\n\n\t\t\t\t\t// React to failed load of this resource\n\t\t\t\t\tnext(true);\n\t\t\t\t}\n\n\t\t\t\t// Start it reloading\n\t\t\t\tres.reload();\n\t\t\t} else if (res.complete) {\n\t\t\t\t// Since the resource has already completed loading, go\n\t\t\t\t// ahead and invoke the next callback indicating the previous\n\t\t\t\t// success or failure.\n\t\t\t\tnext(res.failed === true);\n\t\t\t} else {\n\t\t\t\t// The comments above about onreload callback chaining equally\n\t\t\t\t// apply here.  See above.\n\t\t\t\tvar prevOnLoad = res.onload;\n\t\t\t\tvar prevOnError = res.onerror;\n\n\t\t\t\t// When the resource completes loading, either with success\n\t\t\t\t// or failure:\n\n\t\t\t\tres.onload = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnLoad && prevOnLoad();\n\n\t\t\t\t\t// Reset fail flag\n\t\t\t\t\tres.failed = false;\n\n\t\t\t\t\t// React to successful load of this resource\n\t\t\t\t\tnext(false);\n\t\t\t\t};\n\n\t\t\t\tres.onerror = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnError && prevOnError();\n\n\t\t\t\t\t// Set fail flag\n\t\t\t\t\tres.failed = true;\n\n\t\t\t\t\t// React to failed load of this resource\n\t\t\t\t\tnext(true);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\n\t\tvar _timeout = null;\n\t\tsetTimeout(function () {\n\t\t\t// spin up n simultaneous loaders!\n\t\t\tfor (var i = 0; i < parallel; ++i) { loadResource(); }\n\t\t\t\n\t\t\t// register timeout call\n\t\t\tif (timeout) {\n\t\t\t\t_timeout = setTimeout(function () {\n\t\t\t\t\tcallback.fire();\n\t\t\t\t\tnumLoaded = numResources;\n\t\t\t\t}, timeout)\n\t\t\t}\n\t\t}, 0);\n\t\t\n\t\treturn callback;\n\t}\n});\n\nexports = new Loader();\n","pre":true},"sdk/timestep/AudioManager.js":{"path":"sdk/timestep/AudioManager.js","friendlyPath":"AudioManager","directory":"sdk/timestep/","filename":"AudioManager.js","baseMod":"AudioManager","basePath":"sdk/timestep/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class Sound;\n * Implement the correct Audio support, depending on what platform we're running.\n *\n * @doc http://doc.gameclosure.com/api/sound.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/sound.md\n */\n\njsio(\"import device\");\njsio(\"import event.Emitter as Emitter\");\n\n// Allow accessibility controls (like muting).\n// TODO This should definitely be in another file.\nGLOBAL.ACCESSIBILITY = new (Class(Emitter, function (supr) {\n\tthis.muted = false;\n\n\tthis.mute = function (flag) {\n\t\tthis.muted = flag;\n\t\tthis.publish('MuteChange');\n\t};\n}));\nif (GLOBAL.ONACCESSIBLE) {\n\tGLOBAL.ONACCESSIBLE();\n}\n\n// Determine which API to include.\nif (device.isMobileBrowser && !device.simulatingMobileBrowser) {\n\tjsio(\"import platforms.browser.MobileBrowserAPI\");\n\texports = platforms.browser.MobileBrowserAPI;\n} else {\n\texports = jsio('import ui.backend.sound.HTML5API');\n}\n","pre":true},"sdk/timestep/platforms/browser/doc.js":{"path":"sdk/timestep/platforms/browser/doc.js","friendlyPath":".doc","directory":"sdk/timestep/platforms/browser/","filename":"doc.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.PubSub\");\njsio(\"import lib.Enum as Enum\");\njsio(\"import std.js as JS\");\njsio(\"from util.browser import $\");\n\njsio(\"import device\");\n\nvar SCALING = Enum('FIXED', 'RESIZE', 'MANUAL');\nvar defaultScalingMode = device.isMobileBrowser || device.simulating ? SCALING.RESIZE : SCALING.FIXED;\n\n/**\n * @extends lib.PubSub\n */\nDocument=__class__;var Document=Document(function Document(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\tthis.init = function () {\n\t\tif (!$) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar doc = GLOBAL.document,\n\t\t\tbody = doc && doc.body;\n\t\t\n\t\tthis._el = $({\n\t\t\tparent: body,\n\t\t\tstyle: {\n \t\t\t\tposition: 'absolute',\n\t\t\t\toverflow: 'hidden',\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%'\n\t\t\t}\n\t\t});\n\t\t\n\t\tdevice.screen.subscribe('Resize', this, 'onResize');\n\t\t\n\t\tif (exports.postCreateHook) { exports.postCreateHook(this); }\n\t\tthis.setScalingMode(defaultScalingMode);\n\t}\n\t\n\tthis.unsubscribeResize = function () {\n\t\tdevice.screen.unsubscribe('Resize', this, 'onResize');\n\t}\n\t\n\tthis.setEngine = function (engine) {\n\t\tif (engine == this._engine) { return; }\n\t\t\n\t\tthis._engine = engine;\n\t\tthis._canvas = this._engine.getCanvas();\n\t\tthis.appendChild(this._canvas);\n\n\t\tif (this._canvas.getContext) {\n\t\t\tvar ctx = this._canvas.getContext(window.WebGLRenderingContext ? 'webgl' : '2d');\n\t\t\tif (ctx.setParentNode) {\n\t\t\t\tctx.setParentNode(this._el);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tthis.getElement = function () {\n\t\treturn this._el;\n\t};\n\t\n\tthis.setScalingMode = function (scalingMode, opts) {\n\t\tthis._scalingMode = scalingMode;\n\t\t\n\t\tvar el = this._el,\n\t\t\ts = el.style;\n\t\t\n\t\tswitch (scalingMode) {\n\t\t\tcase SCALING.FIXED:\n\t\t\t\topts = merge(opts, {\n\t\t\t\t\t\twidth: device.width,\n\t\t\t\t\t\theight: device.height\n\t\t\t\t\t});\n\t\t\t\ts.width = opts.width + 'px';\n\t\t\t\ts.height = opts.height + 'px';\n\t\t\t\tbreak;\n\t\t\tcase SCALING.RESIZE:\n\t\t\t\topts = merge(opts, {\n\t\t\t\t\t\tresizeCanvas: true\n\t\t\t\t\t});\n\t\t\t\t// fall through:\n\t\t\tcase SCALING.MANUAL:\n\t\t\t\ts.margin = '0px';\n\t\t\t\ts.width = '100%';\n\t\t\t\ts.height = '100%';\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\tthis._scalingOpts = opts;\n\t\tthis.onResize();\n\t\tsetTimeout(bind(this, 'onResize'), 1000);\n\t}\n\t\n\tthis.onResize = function () {\n\t\tvar el = this._el;\n\t\tvar s = this._el.style;\n\t\t\n\t\tel.className = device.screen.orientation;\n\t\tlogger.log('resize', device.width, device.height);\n\t\t\n\t\tvar width = device.width;\n\t\tvar height = device.height;\n\t\tvar mode = this._scalingMode;\n\t\tvar opts = this._scalingOpts;\n\t\t\n\t\tif (mode == SCALING.FIXED) {\n\t\t\twidth = opts.width;\n\t\t\theight = opts.height;\n\t\t}\n\t\t\n\t\t// enforce maxWidth/maxHeight\n\t\t// if maxWidth/maxHeight is met, switch a RESIZE scaling mode to FIXED (center the document on the screen)\n\t\tif (opts.maxWidth && width > opts.maxWidth) {\n\t\t\twidth = opts.maxWidth;\n\t\t\tif (mode == SCALING.RESIZE) { mode = SCALING.FIXED; }\n\t\t}\n\t\t\n\t\tif (opts.maxHeight && height > opts.maxHeight) {\n\t\t\theight = opts.maxHeight;\n\t\t\tif (mode == SCALING.RESIZE) { mode = SCALING.FIXED; }\n\t\t}\n\t\t\n\t\tswitch (mode) {\n\t\t\tcase SCALING.MANUAL:\n\t\t\t\tbreak; // do nothing\n\t\t\tcase SCALING.FIXED:\n\t\t\t\t// try to center the container\n\t\t\t\tel.style.top = Math.round(Math.max(0, (window.innerHeight - height) / 2)) + 'px';\n\t\t\t\tel.style.left = Math.round(Math.max(0, (window.innerWidth - width) / 2)) + 'px';\n\t\t\t\t\n\t\t\t\ts.width = width + 'px';\n\t\t\t\ts.height = height + 'px';\n\t\t\t\tbreak;\n\t\t\tcase SCALING.RESIZE:\n\t\t\t\t// if we have a canvas element, scale it\n\t\t\t\tif (opts.resizeCanvas && this._canvas\n\t\t\t\t\t\t&& (this._canvas.width != width || this._canvas.height != height)) {\n\t\t\t\t\tthis._canvas.width = width;\n\t\t\t\t\tthis._canvas.height = height;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ts.width = width + 'px';\n\t\t\t\ts.height = height + 'px';\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// make sure to force a render immediately (should we use needsRepaint instead?)\n\t\tthis._setDim(width, height);\n\t\tif (this._engine) { this._engine.render(); }\n\t}\n\t\n\tthis._setDim = function (width, height) {\n\t\tif (this.width != width || this.height != height) {\n\t\t\tthis.width = width;\n\t\t\tthis.height = height;\n\t\t\tthis.publish('Resize', width, height);\n\t\t}\n\t}\n\t\n\tthis.setColors = function (bgColor, engineColor) {\n\t\tif (this._el) {\n\t\t\tthis._el.style.background = engineColor;\n\t\t\tdocument.documentElement.style.background = document.body.style.background = bgColor;\n\t\t}\n\t}\n\t\n\tthis.appendChild = function (el) {\n\t\tthis._el.appendChild(el);\n\t}\n\t\n\tthis.getOffset = function () {\n\t\treturn {\n\t\t\tx: this._el.offsetLeft,\n\t\t\ty: this._el.offsetTop\n\t\t};\n\t}\n});\n\nexports = new Document();\nexports.SCALING = SCALING;\n\nexports.setDocStyle = function () {\n\tvar doc = GLOBAL.document,\n\t\tbody = doc && doc.body;\n\t\n\tif (body) {\n\t\tvar docStyle = {\n\t\t\theight: '100%',\n\t\t\tmargin: '0px',\n\t\t\tpadding: '0px'\n\t\t};\n\t\n\t\t$.style(document.documentElement, docStyle);\n\t\t$.style(document.body, docStyle);\n\t}\n}\n\nexports.defaultParent = null;\nexports.postCreateHook = null;\n","pre":true},"sdk/jsio/std/js.js":{"path":"sdk/jsio/std/js.js","friendlyPath":"std.js","directory":"sdk/jsio/std/","filename":"js.js","src":"var SLICE = Array.prototype.slice;\n\nexports.vargs = function(args, n) { return SLICE.call(args, n || 0); }\nexports.isArray = function(input) { return Object.prototype.toString.call(input) === '[object Array]'; }\n\nexports.shallowCopy = function(input) {\n\tif (exports.isArray(input)) {\n\t\treturn input.slice(0);\n\t} else {\n\t\tvar out = {};\n\t\tfor (var key in input) {\n\t\t\tif (input.hasOwnProperty(key)) {\n\t\t\t\tout[key] = input[key];\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn out;\n}\n\nexports.merge = function(base, extra) {\n\tbase = base || {};\n\t\n\tfor (var i = 1, len = arguments.length; i < len; ++i) {\n\t\tvar copyFrom = arguments[i];\n\t\tfor (var key in copyFrom) {\n\t\t\tif (copyFrom.hasOwnProperty(key) && !base.hasOwnProperty(key)) {\n\t\t\t\tbase[key] = copyFrom[key];\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn base;\n}\n\nexports.curry = function(method /*, VARGS*/) {\n\tvar args = SLICE.call(arguments, 1),\n\t\tf = typeof method == 'string'\n\t\t\t\t? function() { this[method].apply(ctx, args.concat(SLICE.call(arguments))); }\n\t\t\t\t: function() { method.apply(this, args.concat(SLICE.call(arguments))); }\n\tf.curried = true;\n\treturn f;\n}\n\nexports.unbind = function(method /*, VARGS*/) {\n\tvar args = SLICE.call(arguments, 1),\n\t\tf = typeof method == 'string'\n\t\t\t\t? function(ctx) { ctx[method].apply(ctx, args.concat(SLICE.call(arguments, 1))); }\n\t\t\t\t: function(ctx) { method.apply(ctx, args.concat(SLICE.call(arguments, 1))); }\n\tf.unbound = true;\n\treturn f;\n}\n\n","pre":true},"sdk/jsio/util/browser.js":{"path":"sdk/jsio/util/browser.js","friendlyPath":"util.browser","directory":"sdk/jsio/util/","filename":"browser.js","src":"if (jsio.__env.name == 'browser') {\n\tjsio('external .sizzle import Sizzle');\n\tjsio('import math.geom.Rect');\n\t\n\tfunction isWindow(el) {\n\t\treturn el && !$.isElement(el) && $.isElement(el.document);\n\t}\n\t\n\tvar singleId = /^#([\\w-]+)$/;\n\t\n\tvar $ = exports.$ = function(selector, win) {\n\t\tswitch(typeof selector) {\n\t\t\tcase 'object':\n\t\t\t\tif ($.isElement(selector)) {\n\t\t\t\t\treturn $.remove(selector);\n\t\t\t\t} else if ($.isElement(selector.document && selector.document.body)) {\n\t\t\t\t\treturn $.size(selector);\n\t\t\t\t}\n\t\t\t\treturn $.create(selector);\n\t\t\tcase 'string':\n\t\t\t\tif (singleId.test(selector)) { return $.id(selector.substring(1), win); }\n\t\t\t\treturn Sizzle.apply(GLOBAL, arguments);\n\t\t}\n\t}\n\t\n\tvar DOM2 = typeof HTMLElement === \"object\";\n\t$.isElement = DOM2\n\t\t? function(el) { return el && el instanceof HTMLElement; }\n\t\t: function(el) { return el && typeof el.nodeType == 'number' && typeof el.nodeName == 'string' };\n\t\n\t$.id = function(id, win) { return typeof id == 'string' ? (win || window).document.getElementById(id) : id; }\n\n\t$.apply = function(el, params) {\n\t\tif (params.attrs) {\n\t\t\tfor(attr in params.attrs) {\n\t\t\t\tel.setAttribute(attr, params.attrs[attr]);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (params.id) { el.id = params.id; }\n\t\tif (params.style) { $.style(el, params.style); }\n\t\tif (params.src) { el.src = params.src; }\n\t\tif (params['class'] || params['className']) {\n\t\t\tel.className = params['class'] || params['className'];\n\t\t}\n\t\t\n\t\tvar parent = params.parent || params.parentNode;\n\t\tif (parent && params.first) {\n\t\t\t$.insertBefore(parent, el, parent.firstChild);\n\t\t} else if (params.before) {\n\t\t\t$.insertBefore(params.before.parentNode || parent, el, params.before);\n\t\t} else if (params.after) {\n\t\t\t$.insertAfter(params.after.parentNode || parent, el, params.after);\n\t\t} else if (parent) {\n\t\t\tparent.appendChild(el);\n\t\t}\n\t\t\n\t\tif ('html' in params) { el.innerHTML = params.html; }\n\t\tif ('text' in params) { $.setText(el, params.text); }\n\t\t\n\t\tif (params.children) {\n\t\t\tvar c = params.children;\n\t\t\tfor (var i = 0, n = c.length; i < n; ++i) {\n\t\t\t\tel.appendChild($.isElement(c[i]) ? c[i] : $(c[i]));\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn el;\n\t}\n\t\n\t$.insertBefore = function(parentNode, el, beforeNode) {\n\t\tif (!parentNode || !el) { return; }\n\t\tif (beforeNode && beforeNode.parentNode == parentNode) {\n\t\t\tparentNode.insertBefore(el, beforeNode);\n\t\t} else {\n\t\t\tparentNode.appendChild(el);\n\t\t}\n\t}\n\t\n\t$.insertAfter = function(parentNode, el, afterNode) {\n\t\tif (!parentNode || !el) { return; }\n\t\tif (!afterNode || afterNode.parentNode != parentNode) {\n\t\t\t$.insertBefore(parentNode, el, parentNode.firstChild);\n\t\t} else if (!afterNode.nextSibling) {\n\t\t\tparentNode.appendChild(el);\n\t\t} else {\n\t\t\tparentNode.insertBefore(el, afterNode.nextSibling);\n\t\t}\n\t}\n\n\t$.create = function(params) {\n\t\tvar doc = ((params && params.win) || window).document;\n\t\tif (!params || typeof params == 'string') {\n\t\t\treturn doc.createElement(params || 'div');\n\t\t};\n\n\t\treturn $.apply(params.el || doc.createElement(params.tag || params.tagName || 'div'), params);\n\t}\n\n\t$.show = function(el, how) { $.id(el).style.display = how || 'block'; }\n\t$.hide = function(el) { $.id(el).style.display = 'none'; }\n\n\t// accepts an array or a space-delimited string of classNames\n\t$.addClass = function(el, classNames) {\n\t\tif (!el) { return; }\n\t\tvar el = $.id(el);\n\t\tif (typeof classNames == \"string\") {\n\t\t\tclassNames = classNames.split(' ');\n\t\t}\n\t\n\t\tvar current = ' ' + el.className + ' ';\n\t\tfor (var i = 0, len = classNames.length; i < len; ++i) {\n\t\t\tvar c = classNames[i];\n\t\t\tif (current.indexOf(' ' + c + ' ') == -1) {\n\t\t\t\tcurrent += c + ' ';\n\t\t\t}\n\t\t}\n\t\t\n\t\tel.className = current.replace(/^\\s+|\\s+$/g, '');\n\t\treturn $;\n\t}\n\t\n\t$.getTag = function(from, tag) { return from.getElementsByTagName(tag); }\n\n\t$.removeClass = function(el, classNames) {\n\t\tif (!el) { return; }\n\t\tvar el = $.id(el);\n\t\tel.className = (' ' + el.className + ' ')\n\t\t\t.replace(' ', '  ')\n\t\t\t.replace(new RegExp('( ' + classNames.replace('\\s+', ' | ').replace('-','\\-') + ' )', 'g'), ' ')\n\t\t\t.replace(/\\s+/, ' ')\n\t\t\t.replace(/^\\s+|\\s+$/g, '');\n\t}\n\n\tfunction ieGetAlpha(el) {\n\t\ttry {\n\t\t\treturn el.filters.item(\"alpha\");\n\t\t} catch(e) {}\n\t\n\t\ttry {\n\t\t\treturn el.filters.item(\"progid:DXImageTransform.Microsoft.Alpha\");\n\t\t} catch(e) {}\n\t\n\t\treturn null;\n\t}\n\n\t$.style = function(el, style) {\n\t\tif(el instanceof Array) {\n\t\t\tfor(var i = 0, o; o = el[i]; ++i) { $.style(o, style); }\n\t\t\treturn;\n\t\t}\n\t\n\t\tel = $.id(el);\n\t\tvar s = el.style;\n\t\tfor(prop in style) {\n\t\t\tswitch(prop) {\n\t\t\t\tcase 'styleFloat':\n\t\t\t\tcase 'cssFloat':\n\t\t\t\tcase 'float':\n\t\t\t\t\ts.styleFloat = s.cssFloat = style[prop];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'opacity':\n\t\t\t\t\ts.opacity = style[prop];\n\t\t\t\t\tif(el.filters) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar alpha = ieGetAlpha();\n\t\t\t\t\t\t\tvar opacity = style[prop] == 1 ? 99.99 : style[prop] * 100;\n\t\t\t\t\t\t\tif(!alpha) {\n\t\t\t\t\t\t\t\t// TODO: this might destroy any existing filters?\n\t\t\t\t\t\t\t\ts.filter = \"alpha(opacity=\" + opacity + \")\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\talpha.Opacity = opacity;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e) {}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'borderRadius':\n\t\t\t\t\ts.borderRadius = s.MozBorderRadius = style[prop];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boxSizing':\n\t\t\t\t\ts.MsBoxSizing = s.MozBoxSizing = s.WebkitBoxSizing = style[prop];\n\t\t\t\tdefault:\n\t\t\t\t\ts[prop] = style[prop];\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\t$.onEvent = function(el, name, f) {\n\t\tif (typeof f != 'function') {\n\t\t\tf = bind.apply(GLOBAL, Array.prototype.slice.call(arguments, 2));\n\t\t}\n\t\n\t\tvar handler = f;\n\t\n\t\tel = $.id(el);\n\t\tif(el.addEventListener) { \n\t\t\tel.addEventListener(name, handler, false);\n\t\t} else {\n\t\t\thandler = function(e) {\n\t\t\t\tvar evt = e || window.event;\n\t\t\t\t// TODO: normalize the event object\n\t\t\t\tf(evt);\n\t\t\t};\n\t\t\n\t\t\tel.attachEvent('on' + name, handler);\n\t\t}\n\t\n\t\treturn bind($, 'removeEvent', el, name, handler);\n\t};\n\n\t$.removeEvent = function(el, name, f) {\n\t\tel = $.id(el);\n\t\tif (el.addEventListener) {\n\t\t\tel.removeEventListener(name, f, false);\n\t\t} else {\n\t\t\tel.detachEvent('on' + name, f);\n\t\t}\n\t}\n\n\t$.stopEvent = function(e) {\n\t\tif (e) {\n\t\t\te.cancelBubble = true;\n\t\t\tif(e.stopPropagation) e.stopPropagation();\n\t\t\tif(e.preventDefault) e.preventDefault();\n\t\t}\n\t}\n\n\t$.setText = function(el, text) {\n\t\tel = $.id(el);\n\t\ttext = String(text);\n\t\tif ('textContent' in el) {\n\t\t\tel.textContent = text;\n\t\t} else if ('innerText' in el) {\n\t\t\tel.innerText = text.replace(/\\n/g, ' ');\n\t\t} else {\n\t\t\tel.innerHTML = '';\n\t\t\tel.appendChild(document.createTextNode(text));\n\t\t}\n\t}\n\n\t$.setValue = function(el, value) {\n\t\tel = $.id(el);\n\t\tif ('value' in el) {\n\t\t\tel.value = value;\n\t\t} else if ('value' in el.firstChild) {\n\t\t\tel.firstChild.value = value;\n\t\t}\n\t};\n\n\t$.remove = function(el) {\n\t\tel = $.id(el);\n\t\tif(el && el.parentNode) {\n\t\t\tel.parentNode.removeChild(el);\n\t\t}\n\t}\n\n\t$.cursorPos = function(ev, el) {\n\t\tvar offset = $.pos(el);\n\t\toffset.top = ev.clientY - offset.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop);\n\t\toffset.left = ev.clientX - offset.left + (window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft);\n\t\treturn offset;\n\t}\n\n\t$.pos = function(el) {\n\t\tvar parent = el;\n\t\tvar offset = {top: 0, left: 0};\n\t\twhile(parent && parent != document.body) {\n\t\t\toffset.left += parent.offsetLeft;\n\t\t\toffset.top += parent.offsetTop;\n\t\t\twhile(parent.offsetParent != parent.parentNode) {\n\t\t\t\toffset.top -= parent.scrollTop; offset.left -= parent.scrollLeft;\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\t\t\tparent = parent.offsetParent;\n\t\t}\n\t\treturn offset;\n\t}\n\t\n\t$.size = function(el) {\n\t\tif ($.isElement(el)) {\n\t\t\treturn {width: el.offsetWidth, height: el.offsetHeight};\n\t\t} else if (el.document) {\n\t\t\tvar doc = el.document.documentElement || el.document.body;\n\t\t\treturn new math.geom.Rect(\n\t\t\t\tdoc.offsetTop,\n\t\t\t\tdoc.offsetLeft,\n\t\t\t\tel.innerWidth || (doc.clientWidth || doc.clientWidth),\n\t\t\t\tel.innerHeight || (doc.clientHeight || doc.clientHeight)\n\t\t\t);\n\t\t}\n\t}\n\t\n\t$.insertCSSFile = function(filename) {\n\t\tdocument.getElementsByTagName('head')[0].appendChild($({\n\t\t\ttag: 'link',\n\t\t\tattrs: {\n\t\t\t\trel: 'stylesheet',\n\t\t\t\ttype: 'text/css',\n\t\t\t\thref: filename\n\t\t\t}\n\t\t}));\n\t}\n}\n","pre":true},"sdk/jsio/util/sizzle.js":{"path":"sdk/jsio/util/sizzle.js","friendlyPath":".sizzle","directory":"sdk/jsio/util/","filename":"sizzle.js","src":"/*!\n * Sizzle CSS Selector Engine - v1.0\n *  Copyright 2009, The Dojo Foundation\n *  Released under the MIT, BSD, and GPL Licenses.\n *  More information: http://sizzlejs.com/\n */\n\nSizzle = (function(){\n\nvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^[\\]]*\\]|['\"][^'\"]*['\"]|[^[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?/g,\n\tdone = 0,\n\ttoString = Object.prototype.toString,\n\thasDuplicate = false;\n\nvar Sizzle = function(selector, context, results, seed) {\n\tresults = results || [];\n\tvar origContext = context = context || document;\n\n\tif ( context.nodeType !== 1 && context.nodeType !== 9 ) {\n\t\treturn [];\n\t}\n\t\n\tif ( !selector || typeof selector !== \"string\" ) {\n\t\treturn results;\n\t}\n\n\tvar parts = [], m, set, checkSet, check, mode, extra, prune = true, contextXML = isXML(context);\n\t\n\t// Reset the position of the chunker regexp (start from head)\n\tchunker.lastIndex = 0;\n\t\n\twhile ( (m = chunker.exec(selector)) !== null ) {\n\t\tparts.push( m[1] );\n\t\t\n\t\tif ( m[2] ) {\n\t\t\textra = RegExp.rightContext;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif ( parts.length > 1 && origPOS.exec( selector ) ) {\n\t\tif ( parts.length === 2 && Expr.relative[ parts[0] ] ) {\n\t\t\tset = posProcess( parts[0] + parts[1], context );\n\t\t} else {\n\t\t\tset = Expr.relative[ parts[0] ] ?\n\t\t\t\t[ context ] :\n\t\t\t\tSizzle( parts.shift(), context );\n\n\t\t\twhile ( parts.length ) {\n\t\t\t\tselector = parts.shift();\n\n\t\t\t\tif ( Expr.relative[ selector ] )\n\t\t\t\t\tselector += parts.shift();\n\n\t\t\t\tset = posProcess( selector, set );\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// Take a shortcut and set the context if the root selector is an ID\n\t\t// (but not if it'll be faster if the inner selector is an ID)\n\t\tif ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&\n\t\t\t\tExpr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {\n\t\t\tvar ret = Sizzle.find( parts.shift(), context, contextXML );\n\t\t\tcontext = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];\n\t\t}\n\n\t\tif ( context ) {\n\t\t\tvar ret = seed ?\n\t\t\t\t{ expr: parts.pop(), set: makeArray(seed) } :\n\t\t\t\tSizzle.find( parts.pop(), parts.length === 1 && (parts[0] === \"~\" || parts[0] === \"+\") && context.parentNode ? context.parentNode : context, contextXML );\n\t\t\tset = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;\n\n\t\t\tif ( parts.length > 0 ) {\n\t\t\t\tcheckSet = makeArray(set);\n\t\t\t} else {\n\t\t\t\tprune = false;\n\t\t\t}\n\n\t\t\twhile ( parts.length ) {\n\t\t\t\tvar cur = parts.pop(), pop = cur;\n\n\t\t\t\tif ( !Expr.relative[ cur ] ) {\n\t\t\t\t\tcur = \"\";\n\t\t\t\t} else {\n\t\t\t\t\tpop = parts.pop();\n\t\t\t\t}\n\n\t\t\t\tif ( pop == null ) {\n\t\t\t\t\tpop = context;\n\t\t\t\t}\n\n\t\t\t\tExpr.relative[ cur ]( checkSet, pop, contextXML );\n\t\t\t}\n\t\t} else {\n\t\t\tcheckSet = parts = [];\n\t\t}\n\t}\n\n\tif ( !checkSet ) {\n\t\tcheckSet = set;\n\t}\n\n\tif ( !checkSet ) {\n\t\tthrow \"Syntax error, unrecognized expression: \" + (cur || selector);\n\t}\n\n\tif ( toString.call(checkSet) === \"[object Array]\" ) {\n\t\tif ( !prune ) {\n\t\t\tresults.push.apply( results, checkSet );\n\t\t} else if ( context && context.nodeType === 1 ) {\n\t\t\tfor ( var i = 0; checkSet[i] != null; i++ ) {\n\t\t\t\tif ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && contains(context, checkSet[i])) ) {\n\t\t\t\t\tresults.push( set[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor ( var i = 0; checkSet[i] != null; i++ ) {\n\t\t\t\tif ( checkSet[i] && checkSet[i].nodeType === 1 ) {\n\t\t\t\t\tresults.push( set[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tmakeArray( checkSet, results );\n\t}\n\n\tif ( extra ) {\n\t\tSizzle( extra, origContext, results, seed );\n\t\tSizzle.uniqueSort( results );\n\t}\n\n\treturn results;\n};\n\nSizzle.uniqueSort = function(results){\n\tif ( sortOrder ) {\n\t\thasDuplicate = false;\n\t\tresults.sort(sortOrder);\n\n\t\tif ( hasDuplicate ) {\n\t\t\tfor ( var i = 1; i < results.length; i++ ) {\n\t\t\t\tif ( results[i] === results[i-1] ) {\n\t\t\t\t\tresults.splice(i--, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\nSizzle.matches = function(expr, set){\n\treturn Sizzle(expr, null, null, set);\n};\n\nSizzle.find = function(expr, context, isXML){\n\tvar set, match;\n\n\tif ( !expr ) {\n\t\treturn [];\n\t}\n\n\tfor ( var i = 0, l = Expr.order.length; i < l; i++ ) {\n\t\tvar type = Expr.order[i], match;\n\t\t\n\t\tif ( (match = Expr.match[ type ].exec( expr )) ) {\n\t\t\tvar left = RegExp.leftContext;\n\n\t\t\tif ( left.substr( left.length - 1 ) !== \"\\\\\" ) {\n\t\t\t\tmatch[1] = (match[1] || \"\").replace(/\\\\/g, \"\");\n\t\t\t\tset = Expr.find[ type ]( match, context, isXML );\n\t\t\t\tif ( set != null ) {\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif ( !set ) {\n\t\tset = context.getElementsByTagName(\"*\");\n\t}\n\n\treturn {set: set, expr: expr};\n};\n\nSizzle.filter = function(expr, set, inplace, not){\n\tvar old = expr, result = [], curLoop = set, match, anyFound,\n\t\tisXMLFilter = set && set[0] && isXML(set[0]);\n\n\twhile ( expr && set.length ) {\n\t\tfor ( var type in Expr.filter ) {\n\t\t\tif ( (match = Expr.match[ type ].exec( expr )) != null ) {\n\t\t\t\tvar filter = Expr.filter[ type ], found, item;\n\t\t\t\tanyFound = false;\n\n\t\t\t\tif ( curLoop == result ) {\n\t\t\t\t\tresult = [];\n\t\t\t\t}\n\n\t\t\t\tif ( Expr.preFilter[ type ] ) {\n\t\t\t\t\tmatch = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );\n\n\t\t\t\t\tif ( !match ) {\n\t\t\t\t\t\tanyFound = found = true;\n\t\t\t\t\t} else if ( match === true ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( match ) {\n\t\t\t\t\tfor ( var i = 0; (item = curLoop[i]) != null; i++ ) {\n\t\t\t\t\t\tif ( item ) {\n\t\t\t\t\t\t\tfound = filter( item, match, i, curLoop );\n\t\t\t\t\t\t\tvar pass = not ^ !!found;\n\n\t\t\t\t\t\t\tif ( inplace && found != null ) {\n\t\t\t\t\t\t\t\tif ( pass ) {\n\t\t\t\t\t\t\t\t\tanyFound = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcurLoop[i] = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if ( pass ) {\n\t\t\t\t\t\t\t\tresult.push( item );\n\t\t\t\t\t\t\t\tanyFound = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( found !== undefined ) {\n\t\t\t\t\tif ( !inplace ) {\n\t\t\t\t\t\tcurLoop = result;\n\t\t\t\t\t}\n\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\n\n\t\t\t\t\tif ( !anyFound ) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Improper expression\n\t\tif ( expr == old ) {\n\t\t\tif ( anyFound == null ) {\n\t\t\t\tthrow \"Syntax error, unrecognized expression: \" + expr;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\told = expr;\n\t}\n\n\treturn curLoop;\n};\n\nvar Expr = Sizzle.selectors = {\n\torder: [ \"ID\", \"NAME\", \"TAG\" ],\n\tmatch: {\n\t\tID: /#((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,\n\t\tCLASS: /\\.((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,\n\t\tNAME: /\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)['\"]*\\]/,\n\t\tATTR: /\\[\\s*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,\n\t\tTAG: /^((?:[\\w\\u00c0-\\uFFFF\\*_-]|\\\\.)+)/,\n\t\tCHILD: /:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+-]*)\\))?/,\n\t\tPOS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^-]|$)/,\n\t\tPSEUDO: /:((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)(?:\\((['\"]*)((?:\\([^\\)]+\\)|[^\\2\\(\\)]*)+)\\2\\))?/\n\t},\n\tattrMap: {\n\t\t\"class\": \"className\",\n\t\t\"for\": \"htmlFor\"\n\t},\n\tattrHandle: {\n\t\thref: function(elem){\n\t\t\treturn elem.getAttribute(\"href\");\n\t\t}\n\t},\n\trelative: {\n\t\t\"+\": function(checkSet, part, isXML){\n\t\t\tvar isPartStr = typeof part === \"string\",\n\t\t\t\tisTag = isPartStr && !/\\W/.test(part),\n\t\t\t\tisPartStrNotTag = isPartStr && !isTag;\n\n\t\t\tif ( isTag && !isXML ) {\n\t\t\t\tpart = part.toUpperCase();\n\t\t\t}\n\n\t\t\tfor ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {\n\t\t\t\tif ( (elem = checkSet[i]) ) {\n\t\t\t\t\twhile ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}\n\n\t\t\t\t\tcheckSet[i] = isPartStrNotTag || elem && elem.nodeName === part ?\n\t\t\t\t\t\telem || false :\n\t\t\t\t\t\telem === part;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( isPartStrNotTag ) {\n\t\t\t\tSizzle.filter( part, checkSet, true );\n\t\t\t}\n\t\t},\n\t\t\">\": function(checkSet, part, isXML){\n\t\t\tvar isPartStr = typeof part === \"string\";\n\n\t\t\tif ( isPartStr && !/\\W/.test(part) ) {\n\t\t\t\tpart = isXML ? part : part.toUpperCase();\n\n\t\t\t\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\t\t\t\tvar elem = checkSet[i];\n\t\t\t\t\tif ( elem ) {\n\t\t\t\t\t\tvar parent = elem.parentNode;\n\t\t\t\t\t\tcheckSet[i] = parent.nodeName === part ? parent : false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\t\t\t\tvar elem = checkSet[i];\n\t\t\t\t\tif ( elem ) {\n\t\t\t\t\t\tcheckSet[i] = isPartStr ?\n\t\t\t\t\t\t\telem.parentNode :\n\t\t\t\t\t\t\telem.parentNode === part;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( isPartStr ) {\n\t\t\t\t\tSizzle.filter( part, checkSet, true );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"\": function(checkSet, part, isXML){\n\t\t\tvar doneName = done++, checkFn = dirCheck;\n\n\t\t\tif ( !/\\W/.test(part) ) {\n\t\t\t\tvar nodeCheck = part = isXML ? part : part.toUpperCase();\n\t\t\t\tcheckFn = dirNodeCheck;\n\t\t\t}\n\n\t\t\tcheckFn(\"parentNode\", part, doneName, checkSet, nodeCheck, isXML);\n\t\t},\n\t\t\"~\": function(checkSet, part, isXML){\n\t\t\tvar doneName = done++, checkFn = dirCheck;\n\n\t\t\tif ( typeof part === \"string\" && !/\\W/.test(part) ) {\n\t\t\t\tvar nodeCheck = part = isXML ? part : part.toUpperCase();\n\t\t\t\tcheckFn = dirNodeCheck;\n\t\t\t}\n\n\t\t\tcheckFn(\"previousSibling\", part, doneName, checkSet, nodeCheck, isXML);\n\t\t}\n\t},\n\tfind: {\n\t\tID: function(match, context, isXML){\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\n\t\t\t\tvar m = context.getElementById(match[1]);\n\t\t\t\treturn m ? [m] : [];\n\t\t\t}\n\t\t},\n\t\tNAME: function(match, context, isXML){\n\t\t\tif ( typeof context.getElementsByName !== \"undefined\" ) {\n\t\t\t\tvar ret = [], results = context.getElementsByName(match[1]);\n\n\t\t\t\tfor ( var i = 0, l = results.length; i < l; i++ ) {\n\t\t\t\t\tif ( results[i].getAttribute(\"name\") === match[1] ) {\n\t\t\t\t\t\tret.push( results[i] );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn ret.length === 0 ? null : ret;\n\t\t\t}\n\t\t},\n\t\tTAG: function(match, context){\n\t\t\treturn context.getElementsByTagName(match[1]);\n\t\t}\n\t},\n\tpreFilter: {\n\t\tCLASS: function(match, curLoop, inplace, result, not, isXML){\n\t\t\tmatch = \" \" + match[1].replace(/\\\\/g, \"\") + \" \";\n\n\t\t\tif ( isXML ) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\tfor ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {\n\t\t\t\tif ( elem ) {\n\t\t\t\t\tif ( not ^ (elem.className && (\" \" + elem.className + \" \").indexOf(match) >= 0) ) {\n\t\t\t\t\t\tif ( !inplace )\n\t\t\t\t\t\t\tresult.push( elem );\n\t\t\t\t\t} else if ( inplace ) {\n\t\t\t\t\t\tcurLoop[i] = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tID: function(match){\n\t\t\treturn match[1].replace(/\\\\/g, \"\");\n\t\t},\n\t\tTAG: function(match, curLoop){\n\t\t\tfor ( var i = 0; curLoop[i] === false; i++ ){}\n\t\t\treturn curLoop[i] && isXML(curLoop[i]) ? match[1] : match[1].toUpperCase();\n\t\t},\n\t\tCHILD: function(match){\n\t\t\tif ( match[1] == \"nth\" ) {\n\t\t\t\t// parse equations like 'even', 'odd', '5', '2n', '3n+2', '4n-1', '-n+6'\n\t\t\t\tvar test = /(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(\n\t\t\t\t\tmatch[2] == \"even\" && \"2n\" || match[2] == \"odd\" && \"2n+1\" ||\n\t\t\t\t\t!/\\D/.test( match[2] ) && \"0n+\" + match[2] || match[2]);\n\n\t\t\t\t// calculate the numbers (first)n+(last) including if they are negative\n\t\t\t\tmatch[2] = (test[1] + (test[2] || 1)) - 0;\n\t\t\t\tmatch[3] = test[3] - 0;\n\t\t\t}\n\n\t\t\t// TODO: Move to normal caching system\n\t\t\tmatch[0] = done++;\n\n\t\t\treturn match;\n\t\t},\n\t\tATTR: function(match, curLoop, inplace, result, not, isXML){\n\t\t\tvar name = match[1].replace(/\\\\/g, \"\");\n\t\t\t\n\t\t\tif ( !isXML && Expr.attrMap[name] ) {\n\t\t\t\tmatch[1] = Expr.attrMap[name];\n\t\t\t}\n\n\t\t\tif ( match[2] === \"~=\" ) {\n\t\t\t\tmatch[4] = \" \" + match[4] + \" \";\n\t\t\t}\n\n\t\t\treturn match;\n\t\t},\n\t\tPSEUDO: function(match, curLoop, inplace, result, not){\n\t\t\tif ( match[1] === \"not\" ) {\n\t\t\t\t// If we're dealing with a complex expression, or a simple one\n\t\t\t\tif ( chunker.exec(match[3]).length > 1 || /^\\w/.test(match[3]) ) {\n\t\t\t\t\tmatch[3] = Sizzle(match[3], null, null, curLoop);\n\t\t\t\t} else {\n\t\t\t\t\tvar ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);\n\t\t\t\t\tif ( !inplace ) {\n\t\t\t\t\t\tresult.push.apply( result, ret );\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\treturn match;\n\t\t},\n\t\tPOS: function(match){\n\t\t\tmatch.unshift( true );\n\t\t\treturn match;\n\t\t}\n\t},\n\tfilters: {\n\t\tenabled: function(elem){\n\t\t\treturn elem.disabled === false && elem.type !== \"hidden\";\n\t\t},\n\t\tdisabled: function(elem){\n\t\t\treturn elem.disabled === true;\n\t\t},\n\t\tchecked: function(elem){\n\t\t\treturn elem.checked === true;\n\t\t},\n\t\tselected: function(elem){\n\t\t\t// Accessing this property makes selected-by-default\n\t\t\t// options in Safari work properly\n\t\t\telem.parentNode.selectedIndex;\n\t\t\treturn elem.selected === true;\n\t\t},\n\t\tparent: function(elem){\n\t\t\treturn !!elem.firstChild;\n\t\t},\n\t\tempty: function(elem){\n\t\t\treturn !elem.firstChild;\n\t\t},\n\t\thas: function(elem, i, match){\n\t\t\treturn !!Sizzle( match[3], elem ).length;\n\t\t},\n\t\theader: function(elem){\n\t\t\treturn /h\\d/i.test( elem.nodeName );\n\t\t},\n\t\ttext: function(elem){\n\t\t\treturn \"text\" === elem.type;\n\t\t},\n\t\tradio: function(elem){\n\t\t\treturn \"radio\" === elem.type;\n\t\t},\n\t\tcheckbox: function(elem){\n\t\t\treturn \"checkbox\" === elem.type;\n\t\t},\n\t\tfile: function(elem){\n\t\t\treturn \"file\" === elem.type;\n\t\t},\n\t\tpassword: function(elem){\n\t\t\treturn \"password\" === elem.type;\n\t\t},\n\t\tsubmit: function(elem){\n\t\t\treturn \"submit\" === elem.type;\n\t\t},\n\t\timage: function(elem){\n\t\t\treturn \"image\" === elem.type;\n\t\t},\n\t\treset: function(elem){\n\t\t\treturn \"reset\" === elem.type;\n\t\t},\n\t\tbutton: function(elem){\n\t\t\treturn \"button\" === elem.type || elem.nodeName.toUpperCase() === \"BUTTON\";\n\t\t},\n\t\tinput: function(elem){\n\t\t\treturn /input|select|textarea|button/i.test(elem.nodeName);\n\t\t}\n\t},\n\tsetFilters: {\n\t\tfirst: function(elem, i){\n\t\t\treturn i === 0;\n\t\t},\n\t\tlast: function(elem, i, match, array){\n\t\t\treturn i === array.length - 1;\n\t\t},\n\t\teven: function(elem, i){\n\t\t\treturn i % 2 === 0;\n\t\t},\n\t\todd: function(elem, i){\n\t\t\treturn i % 2 === 1;\n\t\t},\n\t\tlt: function(elem, i, match){\n\t\t\treturn i < match[3] - 0;\n\t\t},\n\t\tgt: function(elem, i, match){\n\t\t\treturn i > match[3] - 0;\n\t\t},\n\t\tnth: function(elem, i, match){\n\t\t\treturn match[3] - 0 == i;\n\t\t},\n\t\teq: function(elem, i, match){\n\t\t\treturn match[3] - 0 == i;\n\t\t}\n\t},\n\tfilter: {\n\t\tPSEUDO: function(elem, match, i, array){\n\t\t\tvar name = match[1], filter = Expr.filters[ name ];\n\n\t\t\tif ( filter ) {\n\t\t\t\treturn filter( elem, i, match, array );\n\t\t\t} else if ( name === \"contains\" ) {\n\t\t\t\treturn (elem.textContent || elem.innerText || \"\").indexOf(match[3]) >= 0;\n\t\t\t} else if ( name === \"not\" ) {\n\t\t\t\tvar not = match[3];\n\n\t\t\t\tfor ( var i = 0, l = not.length; i < l; i++ ) {\n\t\t\t\t\tif ( not[i] === elem ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tCHILD: function(elem, match){\n\t\t\tvar type = match[1], node = elem;\n\t\t\tswitch (type) {\n\t\t\t\tcase 'only':\n\t\t\t\tcase 'first':\n\t\t\t\t\twhile ( (node = node.previousSibling) )  {\n\t\t\t\t\t\tif ( node.nodeType === 1 ) return false;\n\t\t\t\t\t}\n\t\t\t\t\tif ( type == 'first') return true;\n\t\t\t\t\tnode = elem;\n\t\t\t\tcase 'last':\n\t\t\t\t\twhile ( (node = node.nextSibling) )  {\n\t\t\t\t\t\tif ( node.nodeType === 1 ) return false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\tcase 'nth':\n\t\t\t\t\tvar first = match[2], last = match[3];\n\n\t\t\t\t\tif ( first == 1 && last == 0 ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar doneName = match[0],\n\t\t\t\t\t\tparent = elem.parentNode;\n\t\n\t\t\t\t\tif ( parent && (parent.sizcache !== doneName || !elem.nodeIndex) ) {\n\t\t\t\t\t\tvar count = 0;\n\t\t\t\t\t\tfor ( node = parent.firstChild; node; node = node.nextSibling ) {\n\t\t\t\t\t\t\tif ( node.nodeType === 1 ) {\n\t\t\t\t\t\t\t\tnode.nodeIndex = ++count;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} \n\t\t\t\t\t\tparent.sizcache = doneName;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar diff = elem.nodeIndex - last;\n\t\t\t\t\tif ( first == 0 ) {\n\t\t\t\t\t\treturn diff == 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn ( diff % first == 0 && diff / first >= 0 );\n\t\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tID: function(elem, match){\n\t\t\treturn elem.nodeType === 1 && elem.getAttribute(\"id\") === match;\n\t\t},\n\t\tTAG: function(elem, match){\n\t\t\treturn (match === \"*\" && elem.nodeType === 1) || elem.nodeName === match;\n\t\t},\n\t\tCLASS: function(elem, match){\n\t\t\treturn (\" \" + (elem.className || elem.getAttribute(\"class\")) + \" \")\n\t\t\t\t.indexOf( match ) > -1;\n\t\t},\n\t\tATTR: function(elem, match){\n\t\t\tvar name = match[1],\n\t\t\t\tresult = Expr.attrHandle[ name ] ?\n\t\t\t\t\tExpr.attrHandle[ name ]( elem ) :\n\t\t\t\t\telem[ name ] != null ?\n\t\t\t\t\t\telem[ name ] :\n\t\t\t\t\t\telem.getAttribute( name ),\n\t\t\t\tvalue = result + \"\",\n\t\t\t\ttype = match[2],\n\t\t\t\tcheck = match[4];\n\n\t\t\treturn result == null ?\n\t\t\t\ttype === \"!=\" :\n\t\t\t\ttype === \"=\" ?\n\t\t\t\tvalue === check :\n\t\t\t\ttype === \"*=\" ?\n\t\t\t\tvalue.indexOf(check) >= 0 :\n\t\t\t\ttype === \"~=\" ?\n\t\t\t\t(\" \" + value + \" \").indexOf(check) >= 0 :\n\t\t\t\t!check ?\n\t\t\t\tvalue && result !== false :\n\t\t\t\ttype === \"!=\" ?\n\t\t\t\tvalue != check :\n\t\t\t\ttype === \"^=\" ?\n\t\t\t\tvalue.indexOf(check) === 0 :\n\t\t\t\ttype === \"$=\" ?\n\t\t\t\tvalue.substr(value.length - check.length) === check :\n\t\t\t\ttype === \"|=\" ?\n\t\t\t\tvalue === check || value.substr(0, check.length + 1) === check + \"-\" :\n\t\t\t\tfalse;\n\t\t},\n\t\tPOS: function(elem, match, i, array){\n\t\t\tvar name = match[2], filter = Expr.setFilters[ name ];\n\n\t\t\tif ( filter ) {\n\t\t\t\treturn filter( elem, i, match, array );\n\t\t\t}\n\t\t}\n\t}\n};\n\nvar origPOS = Expr.match.POS;\n\nfor ( var type in Expr.match ) {\n\tExpr.match[ type ] = new RegExp( Expr.match[ type ].source + /(?![^\\[]*\\])(?![^\\(]*\\))/.source );\n}\n\nvar makeArray = function(array, results) {\n\tarray = Array.prototype.slice.call( array, 0 );\n\n\tif ( results ) {\n\t\tresults.push.apply( results, array );\n\t\treturn results;\n\t}\n\t\n\treturn array;\n};\n\n// Perform a simple check to determine if the browser is capable of\n// converting a NodeList to an array using builtin methods.\ntry {\n\tArray.prototype.slice.call( document.documentElement.childNodes, 0 );\n\n// Provide a fallback method if it does not work\n} catch(e){\n\tmakeArray = function(array, results) {\n\t\tvar ret = results || [];\n\n\t\tif ( toString.call(array) === \"[object Array]\" ) {\n\t\t\tArray.prototype.push.apply( ret, array );\n\t\t} else {\n\t\t\tif ( typeof array.length === \"number\" ) {\n\t\t\t\tfor ( var i = 0, l = array.length; i < l; i++ ) {\n\t\t\t\t\tret.push( array[i] );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor ( var i = 0; array[i]; i++ ) {\n\t\t\t\t\tret.push( array[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t};\n}\n\nvar sortOrder;\n\nif ( document.documentElement.compareDocumentPosition ) {\n\tsortOrder = function( a, b ) {\n\t\tvar ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;\n\t\tif ( ret === 0 ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn ret;\n\t};\n} else if ( \"sourceIndex\" in document.documentElement ) {\n\tsortOrder = function( a, b ) {\n\t\tvar ret = a.sourceIndex - b.sourceIndex;\n\t\tif ( ret === 0 ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn ret;\n\t};\n} else if ( document.createRange ) {\n\tsortOrder = function( a, b ) {\n\t\tvar aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();\n\t\taRange.selectNode(a);\n\t\taRange.collapse(true);\n\t\tbRange.selectNode(b);\n\t\tbRange.collapse(true);\n\t\tvar ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);\n\t\tif ( ret === 0 ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn ret;\n\t};\n}\n\n// Check to see if the browser returns elements by name when\n// querying by getElementById (and provide a workaround)\n(function(){\n\t// We're going to inject a fake input element with a specified name\n\tvar form = document.createElement(\"div\"),\n\t\tid = \"script\" + (new Date).getTime();\n\tform.innerHTML = \"<a name='\" + id + \"'/>\";\n\n\t// Inject it into the root element, check its status, and remove it quickly\n\tvar root = document.documentElement;\n\troot.insertBefore( form, root.firstChild );\n\n\t// The workaround has to do additional checks after a getElementById\n\t// Which slows things down for other browsers (hence the branching)\n\tif ( !!document.getElementById( id ) ) {\n\t\tExpr.find.ID = function(match, context, isXML){\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\n\t\t\t\tvar m = context.getElementById(match[1]);\n\t\t\t\treturn m ? m.id === match[1] || typeof m.getAttributeNode !== \"undefined\" && m.getAttributeNode(\"id\").nodeValue === match[1] ? [m] : undefined : [];\n\t\t\t}\n\t\t};\n\n\t\tExpr.filter.ID = function(elem, match){\n\t\t\tvar node = typeof elem.getAttributeNode !== \"undefined\" && elem.getAttributeNode(\"id\");\n\t\t\treturn elem.nodeType === 1 && node && node.nodeValue === match;\n\t\t};\n\t}\n\n\troot.removeChild( form );\n\troot = form = null; // release memory in IE\n})();\n\n(function(){\n\t// Check to see if the browser returns only elements\n\t// when doing getElementsByTagName(\"*\")\n\n\t// Create a fake element\n\tvar div = document.createElement(\"div\");\n\tdiv.appendChild( document.createComment(\"\") );\n\n\t// Make sure no comments are found\n\tif ( div.getElementsByTagName(\"*\").length > 0 ) {\n\t\tExpr.find.TAG = function(match, context){\n\t\t\tvar results = context.getElementsByTagName(match[1]);\n\n\t\t\t// Filter out possible comments\n\t\t\tif ( match[1] === \"*\" ) {\n\t\t\t\tvar tmp = [];\n\n\t\t\t\tfor ( var i = 0; results[i]; i++ ) {\n\t\t\t\t\tif ( results[i].nodeType === 1 ) {\n\t\t\t\t\t\ttmp.push( results[i] );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresults = tmp;\n\t\t\t}\n\n\t\t\treturn results;\n\t\t};\n\t}\n\n\t// Check to see if an attribute returns normalized href attributes\n\tdiv.innerHTML = \"<a href='#'></a>\";\n\tif ( div.firstChild && typeof div.firstChild.getAttribute !== \"undefined\" &&\n\t\t\tdiv.firstChild.getAttribute(\"href\") !== \"#\" ) {\n\t\tExpr.attrHandle.href = function(elem){\n\t\t\treturn elem.getAttribute(\"href\", 2);\n\t\t};\n\t}\n\n\tdiv = null; // release memory in IE\n})();\n\nif ( document.querySelectorAll ) (function(){\n\tvar oldSizzle = Sizzle, div = document.createElement(\"div\");\n\tdiv.innerHTML = \"<p class='TEST'></p>\";\n\n\t// Safari can't handle uppercase or unicode characters when\n\t// in quirks mode.\n\tif ( div.querySelectorAll && div.querySelectorAll(\".TEST\").length === 0 ) {\n\t\treturn;\n\t}\n\t\n\tSizzle = function(query, context, extra, seed){\n\t\tcontext = context || document;\n\n\t\t// Only use querySelectorAll on non-XML documents\n\t\t// (ID selectors don't work in non-HTML documents)\n\t\tif ( !seed && context.nodeType === 9 && !isXML(context) ) {\n\t\t\ttry {\n\t\t\t\treturn makeArray( context.querySelectorAll(query), extra );\n\t\t\t} catch(e){}\n\t\t}\n\t\t\n\t\treturn oldSizzle(query, context, extra, seed);\n\t};\n\n\tfor ( var prop in oldSizzle ) {\n\t\tSizzle[ prop ] = oldSizzle[ prop ];\n\t}\n\n\tdiv = null; // release memory in IE\n})();\n\nif ( document.getElementsByClassName && document.documentElement.getElementsByClassName ) (function(){\n\tvar div = document.createElement(\"div\");\n\tdiv.innerHTML = \"<div class='test e'></div><div class='test'></div>\";\n\n\t// Opera can't find a second classname (in 9.6)\n\tif ( div.getElementsByClassName(\"e\").length === 0 )\n\t\treturn;\n\n\t// Safari caches class attributes, doesn't catch changes (in 3.2)\n\tdiv.lastChild.className = \"e\";\n\n\tif ( div.getElementsByClassName(\"e\").length === 1 )\n\t\treturn;\n\n\tExpr.order.splice(1, 0, \"CLASS\");\n\tExpr.find.CLASS = function(match, context, isXML) {\n\t\tif ( typeof context.getElementsByClassName !== \"undefined\" && !isXML ) {\n\t\t\treturn context.getElementsByClassName(match[1]);\n\t\t}\n\t};\n\n\tdiv = null; // release memory in IE\n})();\n\nfunction dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\n\tvar sibDir = dir == \"previousSibling\" && !isXML;\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\tvar elem = checkSet[i];\n\t\tif ( elem ) {\n\t\t\tif ( sibDir && elem.nodeType === 1 ){\n\t\t\t\telem.sizcache = doneName;\n\t\t\t\telem.sizset = i;\n\t\t\t}\n\t\t\telem = elem[dir];\n\t\t\tvar match = false;\n\n\t\t\twhile ( elem ) {\n\t\t\t\tif ( elem.sizcache === doneName ) {\n\t\t\t\t\tmatch = checkSet[elem.sizset];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ( elem.nodeType === 1 && !isXML ){\n\t\t\t\t\telem.sizcache = doneName;\n\t\t\t\t\telem.sizset = i;\n\t\t\t\t}\n\n\t\t\t\tif ( elem.nodeName === cur ) {\n\t\t\t\t\tmatch = elem;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\telem = elem[dir];\n\t\t\t}\n\n\t\t\tcheckSet[i] = match;\n\t\t}\n\t}\n}\n\nfunction dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\n\tvar sibDir = dir == \"previousSibling\" && !isXML;\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\tvar elem = checkSet[i];\n\t\tif ( elem ) {\n\t\t\tif ( sibDir && elem.nodeType === 1 ) {\n\t\t\t\telem.sizcache = doneName;\n\t\t\t\telem.sizset = i;\n\t\t\t}\n\t\t\telem = elem[dir];\n\t\t\tvar match = false;\n\n\t\t\twhile ( elem ) {\n\t\t\t\tif ( elem.sizcache === doneName ) {\n\t\t\t\t\tmatch = checkSet[elem.sizset];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\t\tif ( !isXML ) {\n\t\t\t\t\t\telem.sizcache = doneName;\n\t\t\t\t\t\telem.sizset = i;\n\t\t\t\t\t}\n\t\t\t\t\tif ( typeof cur !== \"string\" ) {\n\t\t\t\t\t\tif ( elem === cur ) {\n\t\t\t\t\t\t\tmatch = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {\n\t\t\t\t\t\tmatch = elem;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\telem = elem[dir];\n\t\t\t}\n\n\t\t\tcheckSet[i] = match;\n\t\t}\n\t}\n}\n\nvar contains = document.compareDocumentPosition ?  function(a, b){\n\treturn a.compareDocumentPosition(b) & 16;\n} : function(a, b){\n\treturn a !== b && (a.contains ? a.contains(b) : true);\n};\n\nvar isXML = function(elem){\n\treturn elem.nodeType === 9 && elem.documentElement.nodeName !== \"HTML\" ||\n\t\t!!elem.ownerDocument && elem.ownerDocument.documentElement.nodeName !== \"HTML\";\n};\n\nvar posProcess = function(selector, context){\n\tvar tmpSet = [], later = \"\", match,\n\t\troot = context.nodeType ? [context] : context;\n\n\t// Position selectors must be done after the filter\n\t// And so must :not(positional) so we move all PSEUDOs to the end\n\twhile ( (match = Expr.match.PSEUDO.exec( selector )) ) {\n\t\tlater += match[0];\n\t\tselector = selector.replace( Expr.match.PSEUDO, \"\" );\n\t}\n\n\tselector = Expr.relative[selector] ? selector + \"*\" : selector;\n\n\tfor ( var i = 0, l = root.length; i < l; i++ ) {\n\t\tSizzle( selector, root[i], tmpSet );\n\t}\n\n\treturn Sizzle.filter( later, tmpSet );\n};\n\nreturn Sizzle;\n\n})();\n","pre":true},"sdk/timestep/platforms/browser/Audio.js":{"path":"sdk/timestep/platforms/browser/Audio.js","friendlyPath":".Audio","directory":"sdk/timestep/platforms/browser/","filename":"Audio.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.Audio;\n *\n * Audio implementation using the <audio> element for browsers.\n */\n\nexports = function (opts) {\n\tvar defaults = {\n\t\tautoplay: false,\n\t\tpreload: 'auto',\n\t\tvolume: 1.0,\n\t\tloop: 0,\n\t\tsrc: ''\n\t};\n\t\n\topts = merge(opts, defaults);\n\tvar el = document.createElement('Audio');\n\t\n\tel.autoplay = opts.autoplay;\n\tel.preload = opts.preload;\n\tel.volume = opts.volume;\n\tel.loop = opts.loop;\n\tel.src = opts.src;\n\t\n\treturn el;\n};","pre":true},"sdk/timestep/platforms/browser/Canvas.js":{"path":"sdk/timestep/platforms/browser/Canvas.js","friendlyPath":".Canvas","directory":"sdk/timestep/platforms/browser/","filename":"Canvas.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\"use import\";\n\n/**\n * @package timestep.env.browser.Canvas;\n *\n * Canvas implementation for browsers. Wraps a Context2D.\n */\n\njsio(\"import .Context2D\");\n\nvar sdk_timestep_platforms_browser_Canvas=__class__;exports=sdk_timestep_platforms_browser_Canvas(function sdk_timestep_platforms_browser_Canvas(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {width: 300, height: 200});\n\t\tvar ctx = new Context2D(opts);\n\t\tvar el = this._el = ctx.getElement();\n\t\tel.getContext = function () { return ctx; }\n\t\tel.complete = true;\n\t\treturn el;\n\t}\n});\n","pre":true},"sdk/timestep/platforms/browser/Context2D.js":{"path":"sdk/timestep/platforms/browser/Context2D.js","friendlyPath":".Context2D","directory":"sdk/timestep/platforms/browser/","filename":"Context2D.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.Context2D;\n *\n * Generates a rendering context by creating our own Canvas element.\n */\n\njsio(\"import device\");\njsio(\"import .FontRenderer\");\n\nfunction setter(name) {\n\treturn (function (val) {\n\t\treturn (this[name] = val);\n\t});\n}\n\nfunction getter(name) {\n\treturn (function (val) {\n\t\treturn this[name];\n\t});\n}\n\nexports = function (opts) {\n\tvar parentNode = opts && opts.parent,\n\t\tel = opts && opts.el || document.createElement('canvas');\n\t\n\t//if (!parentNode) {\n\t//\tel.style.cssText = 'position: absolute; top: 0px; left: 0px; z-index: 1';\n\t//}\n\t\n\tel.width = opts.width;\n\tel.height = opts.height;\n\t\n\tvar ctx = el.getContext('2d');\n\tctx.font = '11px ' + device.defaultFontFamily;\n\tctx.getElement = function () { return el; }\n\t\n\tctx.reset = function () {}\n\t\n\tctx.clear = function () {\n\t\t//el.width = el.width;\n\t\tthis.clearRect(0, 0, el.width, el.height);\n\t};\n\t\n\tctx.clipRect = function (x, y, w, h) {\n\t\tctx.beginPath();\n\t\tctx.rect(x, y, w, h);\n\t\tctx.clip();\n\t}\n\t\n\tctx.swap = function () {};\n\tctx.execSwap = function () {};\n\t\n\tctx.circle = function (x, y, radius) {\n\t\tthis.beginPath();\n\t\tthis.arc(x, y, radius, 0, 2 * Math.PI, true);\n\t}\n\n\tvar _lastPointSprite = {\n\t\timg: null,\n\t\tcolor: null,\n\t\tcanvas: null\n\t};\n\n\tctx.drawPointSprites = function (x1, y1, x2, y2) {\n\t\tvar sprite = this.pointSprite;\n\t\tif (!sprite || !sprite.complete) { return; }\n\n\t\tvar width = sprite.width;\n\t\tvar height = sprite.height;\n\t\tvar canvas = _lastPointSprite.canvas || (_lastPointSprite.canvas = document.createElement('canvas'));\n\n\t\tif (sprite != _lastPointSprite.img || this.strokeStyle != _lastPointSprite.color) {\n\t\t\t_lastPointSprite.img = sprite;\n\t\t\t_lastPointSprite.color = this.strokeStyle;\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\tctx.fillStyle = this.strokeStyle;\n\t\t\tctx.fillRect(0, 0, width, height);\n\t\t\tctx.globalCompositeOperation = 'destination-in';\n\t\t\tctx.drawImage(sprite, 0, 0);\n\t\t}\n\n\t\t// Add points to the buffer so there are drawing points every X pixels\n\t\tvar dx = x2 - x1;\n\t\tvar dy = y2 - y1;\n\t\tvar count = Math.ceil(Math.sqrt(dx * dx + dy * dy) / this.pointSpriteStep);\n\t\tif (count < 1) { count = 1; }\n\n\t\tvar d = this.lineWidth;\n\t\tfor (var i = 0; i < count; ++i) {\n\t\t\tvar x = x1 + dx * i / count;\n\t\t\tvar y = y1 + dy * i / count;\n\t\t\tthis.drawImage(canvas, 0, 0, width, height, x - d / 2, y - d / 2, d, d);\n\t\t}\n\t}\n\t\n\tctx.roundRect = function (x, y, width, height, radius) {\n\t\tthis.beginPath();\n\t\tthis.moveTo(x,y+radius);\n\t\tthis.lineTo(x,y+height-radius);\n\t\tthis.quadraticCurveTo(x,y+height,x+radius,y+height);\n\t\tthis.lineTo(x+width-radius,y+height);\n\t\tthis.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);\n\t\tthis.lineTo(x+width,y+radius);\n\t\tthis.quadraticCurveTo(x+width,y,x+width-radius,y);\n\t\tthis.lineTo(x+radius,y);\n\t\tthis.quadraticCurveTo(x,y,x,y+radius);\n\t}\n\n\tctx.loadIdentity = function () {\n\t\tthis.setTransform(1, 0, 0, 1, 0, 0);\n\t}\n\t\n\tctx.measureText = FontRenderer.wrapMeasureText(ctx.measureText);\n\tctx.fillText = FontRenderer.wrapFillText(ctx.fillText);\n\tctx.strokeText = FontRenderer.wrapStrokeText(ctx.strokeText);\n\n\tctx.filters = {}\n\tctx.setFilters = function (filters) {\n\t\tthis.clearFilters();\n\t\tfor (var name in filters) {\n\t\t\tthis.filters[name] = filters[name];\n\t\t}\n\t}\n\n\tctx.clearFilters = function () {\n\t\tfor (var name in this.filters) {\n\t\t\tdelete this.filters[name];\n\t\t}\n\t}\n\t\n\treturn ctx;\n};\n","pre":true},"sdk/timestep/platforms/browser/FontRenderer.js":{"path":"sdk/timestep/platforms/browser/FontRenderer.js","friendlyPath":".FontRenderer","directory":"sdk/timestep/platforms/browser/","filename":"FontRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package env.browser.FontRenderer;\n *\n * Render fonts or custom fonts on a Canvas context.\n */\n\njsio(\"import ui.resource.Font as Font\");\njsio(\"import ui.Engine as Engine\");\njsio(\"import .FontBuffer as FontBuffer\");\n\njsio(\"import device\");\n\nvar _customFonts = {};\nvar _customFontInfo = {};\nvar _fontMap = {};\nvar _buffers = [];\nvar _fontBuffer = false;\nvar _origMeasureText;\n\nfunction loadCustomFontImage(customFont, index) {\n\tvar image = new Image();\n\n\timage.onload = function () {\n\t\timage.onload = null;\n\t\tcustomFont.imagesLoaded++;\n\t\tcustomFont.loaded = (customFont.imagesLoaded === customFont.imagesTotal);\n\t}\n\timage.src = 'resources/fonts/' + customFont.filename + index + '.png';\n\n\treturn image;\n}\n\nfunction findVerticalInfo(dimensions) {\n\t// A..Z, a..z, all\n\tvar ranges = [{start: 0x41, end: 0x5A}, {start: 0x61, end: 0x7A}, {start: 0x20, end: 0xFF}];\n\tvar range;\n\tvar dimension;\n\tvar found = false;\n\tvar baseline = 0;\n\tvar bottom = 0;\n\tvar i;\n\n\tfor (i = 0; i < ranges.length; i++) {\n\t\trange = ranges[i];\n\t\tfor (j = range.start; j <= range.end; j++) {\n\t\t\tdimension = dimensions[j];\n\t\t\tif (dimension) {\n\t\t\t\tbaseline = Math.max(baseline, dimension.h);\n\t\t\t\tbottom = Math.max(bottom, dimension.h);\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t}\n\t\tif (found) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\tbaseline: baseline,\n\t\tbottom: bottom\n\t};\n}\n\nfunction findHorizontalInfo(dimensions) {\n\t// a..z, A..Z\n\tvar ranges = [{start: 0x61, end: 0x7A}, {start: 0x41, end: 0x5A}, {start: 0x20, end: 0xFF}];\n\tvar range;\n\tvar dimension;\n\tvar width = 0;\n\tvar count = 0;\n\tvar i, j;\n\n\tfor (i = 0; i < ranges.length; i++) {\n\t\trange = ranges[i];\n\t\tfor (j = range.start; j <= range.end; j++) {\n\t\t\tdimension = dimensions[j];\n\t\t\tif (dimension) {\n\t\t\t\twidth += dimension.w;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\tif (count !== 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn {\n\t\twidth: width / count\n\t};\n}\n\nfunction loadingCustomFont (customFont) {\n\tif (customFont.imagesLoaded !== -1) {\n\t \treturn !customFont.loaded;\n\t}\n\n\tvar settings = customFont.settings;\n\tvar filename = settings.filename;\n\tvar images;\n\tvar image;\n\tvar info;\n\tvar i, j;\n\n\tif (_customFontInfo[filename]) {\n\t\tinfo = _customFontInfo[filename];\n\t\tcustomFont.dimensions = info.dimensions;\n\t\tcustomFont.horizontal = info.horizontal;\n\t\tcustomFont.vertical = info.vertical;\n\t} else {\n\t\t// Load from legacy .js extension or newer .json extension.\n\t\tvar basename = 'resources/fonts/' + filename;\n\t\tvar json = CACHE[basename + '.json'];\n\t\tif (json == null) {\n\t\t\tjson = CACHE[basename + '.js'];\n\t\t\tif (json) {\n\t\t\t\tjson = json.replace(/^\\s*exports\\s*=\\s*|;\\s*$/g, '');\n\t\t\t} else {\n\t\t\t\tlogger.warn('Could not load font', customFont.name, 'from cached path', basename);\n\t\t\t}\n\t\t}\n\t\tcustomFont.dimensions = JSON.parse(json);\n\t\tcustomFont.horizontal = findHorizontalInfo(customFont.dimensions);\n\t\tcustomFont.vertical = findVerticalInfo(customFont.dimensions);\n\n\t\t_customFontInfo[filename] = {\n\t\t\tdimensions: customFont.dimensions,\n\t\t\thorizontal: customFont.horizontal,\n\t\t\tvertical: customFont.vertical\n\t\t};\n\t}\n\n\tcustomFont.images = [];\n\tcustomFont.imagesLoaded = 0;\n\n\timages = customFont.images;\n\n\tswitch (customFont.type) {\n\t\tcase 'color':\n\t\t\tfor (i = 0; i < settings.count; i++) {\n\t\t\t\timages[i] = [];\n\t\t\t\timages[i].push(loadCustomFontImage(customFont, '_0_' + i));\n\t\t\t\tcustomFont.imagesTotal++;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'composite':\n\t\t\tfor (i = 1; i < 3; i++) {\n\t\t\t\timages[i - 1] = [];\n\t\t\t\tfor (j = 0; j < settings.count; j++) {\n\t\t\t\t\timages[i - 1].push(loadCustomFontImage(customFont, '_' + i + '_' + j));\n\t\t\t\t\tcustomFont.imagesTotal++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\treturn true;\n}\n\n(function () {\n\tvar manifest = window.CONFIG;\n\tif (manifest && manifest.fonts) {\n\t\tvar fonts = manifest.fonts;\n\t\tvar font;\n\t\tvar customFont;\n\t\tvar i = fonts.length;\n\n\t\twhile (i) {\n\t\t\tfont = fonts[--i];\n\t\t\tcustomFont = {\n\t\t\t\tfilename: font.filename,\n\t\t\t\tsettings: font,\n\t\t\t\timagesLoaded: -1,\n\t\t\t\timagesTotal: 0,\n\t\t\t\tloaded: false,\n\t\t\t\ttype: 'color'\n\t\t\t};\n\t\t\t_customFonts[font.contextName + ' color'] = customFont;\n\t\t\tloadingCustomFont(customFont);\n\n\t\t\tcustomFont = {\n\t\t\t\t// The difference between color- and composite-filename is in the suffix!!!\n\t\t\t\tfilename: font.filename,\n\t\t\t\tsettings: font,\n\t\t\t\timagesLoaded: -1,\n\t\t\t\timagesTotal: 0,\n\t\t\t\tloaded: false,\n\t\t\t\ttype: 'composite'\n\t\t\t}\n\t\t\t_customFonts[font.contextName + ' composite'] = customFont;\n\t\t\tloadingCustomFont(customFont);\n\t\t}\n\t}\n})();\n\nfunction getCanvas() {\n\treturn document.createElement('canvas');\n}\n\nfunction getBuffers(srcBuffers, customFont, color, type) {\n\tvar key = customFont.filename + '_' + color + '_' + type;\n\tvar dstBuffers = [];\n\tvar i;\n\n\tif (!_buffers[key]) {\n\t\t_buffers[key] = {\n\t\t\tbuffers: dstBuffers\n\t\t}\n\t\tfor (i = 0; i < srcBuffers.length; i++) {\n\t\t\tvar canvas = getCanvas(),\n\t\t\t\tctx = canvas.getContext('2d'),\n\t\t\t\twidth = srcBuffers[i].width,\n\t\t\t\theight = srcBuffers[i].height;\n\n\t\t\tdstBuffers[i] = canvas;\n\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\n\t\t\tctx.save();\n\t\t\tctx.fillStyle = color;\n\t\t\tctx.fillRect(0, 0, width, height);\n\t\t\tctx.globalCompositeOperation = 'destination-in';\n\t\t\tctx.drawImage(srcBuffers[i], 0, 0);\n\t\t\tctx.restore();\n\t\t}\n\t}\n\t\n\t_buffers[key].lastUsed = +new Date();\n\treturn _buffers[key].buffers;\n}\n\nfunction measure(ctx, fontInfo, text) {\n\tvar customFont = fontInfo.customFont;\n\tvar dimensions = customFont.dimensions;\n\tvar scale = fontInfo.scale;\n\tvar outline = (customFont.settings.outline || 0) * scale;\n\tvar tracking = (customFont.settings.tracking || 0) * scale;\n\tvar width = 0;\n\tvar failed = true;\n\n\tif (dimensions) {\n\t\tvar i = 0;\n\t\tvar j = text.length;\n\n\t\tfailed = false;\n\n\t\twhile ((i < j) && !failed) {\n\t\t\tcharacter = text.charCodeAt(i);\n\t\t\tswitch (character) {\n\t\t\t\tcase 9: // tab...\n\t\t\t\t\twidth += customFont.horizontal.width * 4 * scale;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 32: // space...\n\t\t\t\t\twidth += customFont.horizontal.width * scale;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tif (dimensions[character]) {\n\t\t\t\t\t\tcharacter = dimensions[character];\n\t\t\t\t\t\twidth += (character.ow - 2) * scale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfailed = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\twidth += tracking - outline;\n\t\t\ti++;\n\t\t}\n\t}\n\n\tif (failed) {\n\t\tvar font = ctx.font;\n\t\tctx.font = fontInfo.size.value + fontInfo.size.unit + ' ' + (ctx.defaultFontFamily || device.defaultFontFamily);\n\t\tvar result = {failed: true, width: _origMeasureText.apply(ctx, [text])};\n\t\tctx.font = font;\n\n\t\treturn result;\n\t}\n\n\treturn {failed: false, width: width + 2 * scale};\n}\n\nfunction renderCustomFont(ctx, x, y, text, color, fontInfo, index) {\n\tvar measureInfo = measure(ctx, fontInfo, text);\n\n\tif (measureInfo.failed) {\n\t\treturn false;\n\t}\n\n\tvar customFont = fontInfo.customFont;\n\tvar srcBuffers = customFont.images[index];\n\tvar dimensions = customFont.dimensions;\n\tvar scale = fontInfo.scale;\n\tvar width = measureInfo.width;\n\tvar outline = (customFont.settings.outline || 0) * scale;\n\tvar tracking = (customFont.settings.tracking || 0) * scale;\n\n\tswitch (ctx.textBaseline) {\n\t\tcase 'alphabetic':\n\t\t\ty -= customFont.vertical.baseline * scale;\n\t\t\tbreak;\n\t\tcase 'middle':\n\t\t\ty -= (customFont.vertical.bottom / 2) * scale;\n\t\t\tbreak;\n\t\tcase 'bottom':\n\t\t\ty -= customFont.vertical.bottom * scale;\n\t\t\tbreak;\n\t}\n\n\tswitch (ctx.textAlign) {\n\t\tcase 'center':\n\t\t\tx -= width / 2;\n\t\t\tbreak;\n\t\tcase 'right':\n\t\t\tx -= width;\n\t\t\tbreak;\n\t}\n\n\tvar buffer = false;\n\tvar bufferX = x;\n\tvar bufferY = y;\n\tvar character;\n\n\tif (buffer) {\n\t\tx = buffer.x;\n\t\ty = buffer.y;\n\t\tctx = buffer.ctx;\n\t}\n\n\tif (customFont.type === 'composite') {\n\t\tsrcBuffers = getBuffers(srcBuffers, customFont, color, index);\n\t}\n\n\tif (!buffer || buffer.refresh) {\n\t\tvar i = 0;\n\t\tvar j = text.length;\n\t\twhile (i < j) {\n\t\t\tcharacter = text.charCodeAt(i);\n\t\t\tswitch (character) {\n\t\t\t\tcase 9: // tab...\n\t\t\t\t\tx += customFont.horizontal.width * 4 * scale + tracking - outline;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 32: // space...\n\t\t\t\t\tx += customFont.horizontal.width * scale + tracking - outline;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcharacter = dimensions[character];\n\t\t\t\t\tctx.drawImage(\n\t\t\t\t\t\tsrcBuffers[character.i],\n\t\t\t\t\t\tcharacter.x,\n\t\t\t\t\t\tcharacter.y,\n\t\t\t\t\t\tcharacter.w,\n\t\t\t\t\t\tcharacter.h, \n\t\t\t\t\t\tx,\n\t\t\t\t\t\ty + (character.oh - 1) * scale,\n\t\t\t\t\t\t(character.w - 2) * scale,\n\t\t\t\t\t\t(character.h - 2) * scale\n\t\t\t\t\t);\n\t\t\t\t\tx += (character.ow - 2) * scale + tracking - outline;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\t}\n\n\tif (buffer) {\n\t\tthis.drawImage(\n\t\t\tbuffer.ctx.canvas,\n\t\t\tbuffer.x,\n\t\t\tbuffer.y,\n\t\t\tbuffer.width,\n\t\t\tbuffer.height,\n\t\t\tbufferX,\n\t\t\tbufferY,\n\t\t\tbuffer.width,\n\t\t\tbuffer.height\n\t\t);\n\t}\n\n\treturn true;\n};\n\nexports.findFontInfo = function (ctx) {\n\tvar font = Font.parse(ctx.font);\n\tvar name = font.getName();\n\tif (name && _customFonts[name]) {\n\t\tcustomFont = _customFonts[name];\n\t\tfont.customFont = customFont;\n\t\tfont.scale = font.getSize() / customFont.settings.size;\n\t\treturn font;\n\t}\n\n\treturn false;\n}\n\nexports.wrapMeasureText = function (origMeasureText) {\n\t_origMeasureText = origMeasureText;\n\n\treturn function (text) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\n\t\tif (!fontInfo) {\n\t\t\treturn origMeasureText.apply(this, arguments);\n\t\t}\n\t\tvar measureInfo = measure(this, fontInfo, text);\n\n\t\tif (measureInfo.failed) {\n\t\t\treturn origMeasureText.apply(this, arguments);\n\t\t}\n\t\treturn measureInfo;\n\t}\n};\n\nexports.wrapFillText = function (origFillText) {\n\treturn function (text, x, y) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\n\t\tif (!fontInfo) {\n\t\t\treturn origFillText.apply(this, arguments);\n\t\t}\n\t\tif (loadingCustomFont(fontInfo.customFont)) {\n\t\t\treturn;\n\t\t}\n\t\tif (isNaN(x)) {\n\t\t\tx = 0;\n\t\t}\n\t\tif (isNaN(y)) {\n\t\t\ty = 0;\n\t\t}\n\n\t\tif (!renderCustomFont(this, x, y, text + '', this.fillStyle, fontInfo, 0)) {\n\t\t\tvar font = this.font;\n\t\t\tthis.font = fontInfo.size.value + fontInfo.size.unit + ' ' + (this.defaultFontFamily || device.defaultFontFamily);\n\t\t\torigFillText.apply(this, [text, x, y]);\n\t\t\tthis.font = font;\n\t\t}\n\t}\n};\n\nexports.wrapStrokeText = function (origStrokeText) {\n\treturn function (text, x, y) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\n\t\tif (!fontInfo) {\n\t\t\treturn origStrokeText.apply(this, arguments);\n\t\t}\n\t\tif (loadingCustomFont(fontInfo.customFont)) {\n\t\t\treturn;\n\t\t}\n\t\tif (isNaN(x)) {\n\t\t\tx = 0;\n\t\t}\n\t\tif (isNaN(y)) {\n\t\t\ty = 0;\n\t\t}\n\n\t\tif (!renderCustomFont(this, x, y, text + '', this.strokeStyle, fontInfo, 1)) {\n\t\t\tvar font = this.font;\n\t\t\tthis.font = fontInfo.size.value + fontInfo.size.unit + ' ' + (this.defaultFontFamily || device.defaultFontFamily);\n\t\t\torigStrokeText.apply(this, [text, x, y]);\n\t\t\tthis.font = font;\n\t\t}\n\t}\n};\n\nexports.getFontBuffer = function () {\n\treturn _fontBuffer;\n};","pre":true},"sdk/timestep/ui/Engine.js":{"path":"sdk/timestep/ui/Engine.js","friendlyPath":"ui.Engine","directory":"sdk/timestep/ui/","filename":"Engine.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.Engine\n *\n * This is the game engine for timestep. It is built on a scene graph composed\n * of \"views\", and has canvas and DOM rendering backends.\n *\n * Responsibilities for the application engine includes initializing the canvas,\n * input and key listeners, game loop, animation tick, the view hierarchy and\n * rendering the scene graph.\n *\n * Not to be confused with GC.Application, the superclass exposed to games which\n * controls the game loop. A single ui.Engine is instantiated for\n * games which resides at GC.app.engine.\n *\n * @doc http://doc.gameclosure.com/api/appengine.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/appengine.md\n */\n\njsio(\"import event.Emitter as Emitter\");\n\njsio(\"import event.input.dispatch as dispatch\");\n\njsio(\"import timer\");\njsio(\"import ui.backend.ReflowManager as ReflowManager\");\n\njsio(\"import device\");\n\nvar _timers = [];\ntimer.onTick = function (dt) {\n\tvar i = _timers.length;\n\twhile (i--) {\n\t\t_timers[i](dt);\n\t}\n}\n\nvar __instance = null;\n\n/**\n * @extends event.Emitter\n */\nvar sdk_timestep_ui_Engine=__class__;var Application = exports=sdk_timestep_ui_Engine(function sdk_timestep_ui_Engine(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function (opts) {\n\t\tif (!__instance) {\n\t\t\tjsio(\"import .StackView\");\n\n\t\t\t__instance = this;\n\t\t}\n\n\t\tvar canvas = opts && opts.canvas;\n\t\tif (typeof canvas == 'string' && GLOBAL.document && document.getElementById) {\n\t\t\tcanvas = document.getElementById(canvas);\n\t\t}\n\n\t\tthis._opts = opts = merge(opts, {\n\t\t\tkeyListenerEnabled: true,\n\t\t\twidth: canvas && canvas.width || device.width,\n\t\t\theight: canvas && canvas.height || device.height,\n\t\t\tview: null,\n\t\t\tdtFixed: 0,\n\t\t\tdtMinimum: 0,\n\t\t\tclearEachFrame: true,\n\t\t\talwaysRepaint: true,\n\t\t\trepaintOnEvent: true,\n\t\t\tmergeMoveEvents: false,\n\t\t\tcontinuousInputCheck: !device.isMobileBrowser && !device.isMobile,\n\t\t\tshowFPS: false\n\t\t});\n\n\t\t_timers.push(bind(this, this._tick));\n\n\t\tthis._doubleBuffered = true;\n\t\tthis._countdown = null;\n\n\t\tif (!device.useDOM) {\n\t\t\tvar Canvas = device.get('Canvas');\n\t\t\tthis._rootElement = new Canvas({\n\t\t\t\tel: canvas, // use an existing canvas if one was provided, but wrap the 2D context\n\t\t\t\twidth: opts.width,\n\t\t\t\theight: opts.height,\n\t\t\t\toffscreen: false\n\t\t\t});\n\n\t\t\tthis._ctx = this._rootElement.getContext('2d');\n\t\t\tthis._ctx.font = '11px ' + device.defaultFontFamily;\n\t\t}\n\n\t\tthis._view = opts.view || new StackView();\n\t\tthis._view.style.update({\n\t\t\twidth: opts.width,\n\t\t\theight: opts.height\n\t\t});\n\n\t\tif (device.useDOM) {\n\t\t\tthis._rootElement = this._view.getBacking().getElement();\n\t\t}\n\n\t\t// __root is a pointer to the Engine instance that a view\n\t\t// is currently attached to.  If __root is null, the view\n\t\t// is not currently in a view hierarchy.\n\t\tthis._view.__root = this;\n\t\t\n\t\tthis._events = [];\n\n\t\tif (dispatch.KeyListener) {\n\t\t\tthis._keyListener = new dispatch.KeyListener();\n\t\t}\n\n\t\tthis._inputListener = new dispatch.InputListener({\n\t\t\tel: this._rootElement,\n\t\t\tkeyListener: this._keyListener\n\t\t});\n\n\t\tthis._reflowManager = ReflowManager.get();\n\n\t\tthis._view.setReflowManager(this._reflowManager);\n\n\t\tthis._tickBuffer = 0;\n\t\tthis._onTick = [];\n\n\t\t// configure auto-layout in the browser (expand\n\t\t// to fill the viewport)\n\t\tif (device.name == 'browser') {\n\t\t\tif (canvas) {\n\t\t\t\tdevice.width = canvas.width;\n\t\t\t\tdevice.height = canvas.height;\n\t\t\t\tdevice.screen.width = canvas.width;\n\t\t\t\tdevice.screen.height = canvas.height;\n\t\t\t} else {\n\t\t\t\tvar doc = device.get('doc');\n\t\t\t\tif (doc) {\n\t\t\t\t\tdoc.setEngine(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.updateOpts(this._opts);\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\tthis._opts = merge(opts, this._opts);\n\t\tif (this._keyListener) {\n\t\t\tthis._keyListener.setEnabled(this._opts.keyListenerEnabled);\n\t\t}\n\n\t\tif (this._opts.scaleUI) {\n\t\t\tif (Array.isArray(this._opts.scaleUI)) {\n\t\t\t\tif (this._opts.scaleUI.length != 2) {\n\t\t\t\t\tthrow new Error(\"Illegal value for engine option scaleUI: \" + this._opts.scaleUI);\n\t\t\t\t}\n\t\t\t\tthis.scaleUI(this._opts.scaleUI[0], this._opts.scaleUI[1]);\n\t\t\t} else {\n\t\t\t\tthis.scaleUI(576, 1024);\n\t\t\t}\n\t\t}\n\n\t\tif (this._opts.noReflow) {\n\t\t\tthis._reflowManager = null;\n\t\t\tthis._view.setReflowManager(null);\n\t\t}\n\n\t\tif (this._opts.showFPS) {\n\t\t\tif (!this._applicationFPS) {\n\t\t\t\tjsio(\"import ui.backend.debug.FPSView as FPSView\");\n\t\t\t\tthis._applicationFPS = new FPSView({application: this});\n\t\t\t}\n\t\t\t\n\t\t\tthis._renderFPS = bind(this._applicationFPS, this._applicationFPS.render);\n\t\t\tthis._tickFPS = bind(this._applicationFPS, this._applicationFPS.tick);\n\t\t} else {\n\t\t\tthis._renderFPS = function () {};\n\t\t\tthis._tickFPS = function () {};\n\t\t}\n\t};\n\n\tthis.scaleUI = function (w, h) {\n\t\tif (device.height > device.width) {\n\t\t\tthis._view.baseWidth = w;\n\t\t\tthis._view.baseHeight = device.height * (w / device.width);\n\t\t\tthis._view.scale = device.width / this._view.baseWidth;\n\t\t} else {\n\t\t\tthis._view.baseWidth = h;\n\t\t\tthis._view.baseHeight = device.height * (h / device.width);\n\t\t\tthis._view.scale = device.height / this._view.baseHeight;\n\t\t}\n\t\tthis._view.style.scale = this._view.scale;\n\t};\n\n\tthis.supports = function (key) {\n\t\treturn this._opts[key];\n\t};\n\n\t/* @internal */\n\tthis.getInput = function () {\n\t\treturn this._inputListener;\n\t};\n\n\tthis.getKeyListener = function () {\n\t\treturn this._keyListener;\n\t};\n\n\tthis.getEvents = function () {\n\t\treturn this._events;\n\t};\n\n\t// deprecating getCanvas...\n\tthis.getElement = this.getCanvas = function () {\n\t\treturn this._rootElement;\n\t};\n\n\tthis.getViewCtor = function () {\n\t\treturn View;\n\t};\n\n\tthis.getView = function () {\n\t\treturn this._view;\n\t};\n\n\tthis.setView = function (view) {\n\t\tthis._view = view; return this;\n\t};\n\n\tthis.getReflowManager = function () {\n\t\treturn this._reflowManager;\n\t};\n\n\tthis.show = function () {\n\t\tthis._rootElement.style.display = 'block';\n\t\treturn this;\n\t};\n\n\tthis.hide = function () {\n\t\tthis._rootElement.style.display = 'none';\n\t\treturn this;\n\t};\n\t\n\tthis.pause = function () {\n\t\tthis.stopLoop();\n\t\tif (this._keyListener) {\n\t\t\tthis._keyListener.setEnabled(false);\n\t\t}\n\t};\n\n\tthis.resume = function () {\n\t\tthis.startLoop();\n\t\tif (this._keyListener) {\n\t\t\tthis._keyListener.setEnabled(true);\n\t\t}\n\t};\n\n\tthis.stepFrame = function (n) {\n\t\tthis.pause();\n\t\tn = n || 1;\n\t\tthis._countdown = n;\n\t\tthis.resume();\n\t};\n\n\tthis.startLoop = function (dtMin) {\n\t\tif (this._running) { return; }\n\t\tthis._running = true;\n\t\t\n\t\tthis.now = 0;\n\t\ttimer.start(dtMin || this._opts.dtMinimum);\n\t\treturn this;\n\t};\n\n\tthis.stopLoop = function () {\n\t\tif (!this._running) { return; }\n\t\tthis._running = false;\n\t\t\n\t\ttimer.stop();\n\t\treturn this;\n\t};\n\n\tthis.isRunning = function () {\n\t\treturn this._running;\n\t};\n\n\tthis.doOnTick = function (cb) {\n\t\tif (arguments.length > 1) { cb = bind.apply(this, arguments); }\n\t\tthis._onTick.push(cb);\n\t};\n\n\tthis._tick = function (dt) {\n\t\t//if the countdown is defined\n\t\tif (this._countdown !== null) {\n\t\t\tthis._countdown--;\n\n\t\t\t//if below zero, stop timer\n\t\t\tif (this._countdown === -1) {\n\t\t\t\tthis.pause();\n\t\t\t\tthis._countdown = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this._ctx) {\n\t\t\tvar el = this._ctx.getElement();\n\t\t\tvar s = this._view.style;\n\t\t\tif (el && (s.width != el.width / s.scale || s.height != el.height / s.scale)) {\n\t\t\t\ts.width = el.width / s.scale;\n\t\t\t\ts.height = el.height / s.scale;\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0, cb; cb = this._onTick[i]; ++i) { cb(dt); }\n\n\t\tvar events = this._inputListener.getEvents();\n\t\tvar n = events.length;\n\n\t\tthis._events = events;\n\t\tif (this._opts._mergeMoveEvents) {\n\t\t\tvar hasMove = false;\n\t\t\tfor (var i = n - 1; i >= 0; --i) {\n\t\t\t\tif (events[i].type == dispatch.eventTypes.MOVE) {\n\t\t\t\t\tif (!hasMove) { \n\t\t\t\t\t\thasMove = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevents.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0, evt; evt = events[i]; ++i) {\n\t\t\tevt.srcApp = this;\n\t\t\tdispatch.dispatchEvent(this._view, evt);\n\t\t}\n\n\t\tif (!device.useDOM) {\n\t\t\tif (i > 0) {\n\t\t\t\tif (this._opts.repaintOnEvent) { this.needsRepaint(); }\n\t\t\t} else if (this._opts.continuousInputCheck) {\n\t\t\t\tvar prevMove = dispatch._evtHistory['input:move'];\n\t\t\t\tif (prevMove) {\n\t\t\t\t\tdispatch.dispatchEvent(this._view, new dispatch.InputEvent(prevMove.id, prevMove.type, prevMove.srcPt));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._opts.dtFixed) {\n\t\t\tthis._tickBuffer += dt;\n\t\t\twhile (this._tickBuffer >= this._opts.dtFixed) {\n\t\t\t\tthis._tickBuffer -= this._opts.dtFixed;\n\t\t\t\tthis.now += this._opts.dtFixed;\n\t\t\t\tthis.__tick(this._opts.dtFixed);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.__tick(dt);\n\t\t}\n\n\t\tif (this._reflowManager) {\n\t\t\tthis._reflowManager.startReflow(this._ctx);\n\t\t\tthis._reflowManager.setInRender(true);\n\t\t}\n\n\t\tvar doRepaint = this._opts.alwaysRepaint || this._needsRepaint;\n\t\tif (!doRepaint && this._doubleBuffered && this._doubleBufferedState > 0) {\n\t\t\t// even if we don't repaint, we need to paint at least 1 more time\n\t\t\t// for devices that use multiple buffers (like the ios, I think...)\n\t\t\t--this._doubleBufferedState;\n\t\t\tthis.render(dt);\n\t\t} else if (doRepaint) {\n\t\t\tthis._doubleBufferedState = 3;\n\t\t\tthis.render(dt);\n\t\t}\n\n\t\tthis._needsRepaint = false;\n\t\tthis._reflowManager && this._reflowManager.setInRender(false);\n\t};\n\n\tthis.render = function (dt) {\n\t\tif (this._opts.clearEachFrame) {\n\t\t\tthis._ctx && this._ctx.clear();\n\t\t}\n\n\t\tthis._view.__view.constructor.absScale = 1;\n\t\tthis._view.__view.wrapRender(this._ctx, {});\n\t\tthis.publish('Render', this._ctx);\n\n\t\tif (this._ctx) {\n\t\t\tif (DEBUG) {\n\t\t\t\tthis._renderFPS(this._ctx, dt);\n\t\t\t}\n\n\t\t\tthis._ctx.swap();\n\t\t}\n\t};\n\n\tthis.needsRepaint = function () {\n\t\tthis._needsRepaint = true;\n\t\treturn this;\n\t};\n\n\tthis.__tick = function (dt) {\n\t\tthis._tickFPS(dt);\n\t\tthis.publish('Tick', dt);\n\t\tthis._view.__view.wrapTick(dt, this);\n\t};\n\n\tvar log_counter = 0;\n\n});\n\nexports.get = function () { return __instance; };\n","pre":true},"sdk/timestep/event/input/dispatch.js":{"path":"sdk/timestep/event/input/dispatch.js","friendlyPath":"event.input.dispatch","directory":"sdk/timestep/event/input/","filename":"dispatch.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module event.input.dispatch;\n * This namespace includes functions to dispatch touch events starting from the\n * root application view, which are traced through the hierarchy to each view's\n * individual InputHandler proxy. Additionally, this namespace includes those\n * functions actually in timestep.input, like InputListener and KeyListener classes.\n */\n\njsio(\"import math.geom.Point as Point\");\njsio(\"import device\");\njsio(\"import lib.Enum\");\n\nexports.eventTypes = new lib.Enum('START', 'MOVE', 'SELECT', 'SCROLL', 'CLEAR');\nexports.VERTICAL_AXIS = 2;\nexports.HORIZONTAL_AXIS = 1;\n\n/**\n * capture/bubble event, starting from root Application view\n *  - publish <inputTypeCapture> on the way down (e.g. onInputStartCapture)\n *  - call callbacks (e.g. onInputStart) and publish <inputType> (e.g. onInputstart)\n *    on the way up, checking evt.cancelled to see if someone has cancelled the event\n */\nexports.dispatchEvent = function (root, evt) {\n\t// if (evt.type == input.eventTypes.MOVE) { var now = +new Date(); }\n\t// store the root in case an event listener wants the top-most view?\n\tevt.root = root;\n\t\n\t// SHOULD_HANDLE = LOCALIZE = 0;\n\n\t// grab the bottom-most view whose bounding box contains the evt.srcPt\n\t// also updates the evt object with a trace of localized points and views\n\texports.traceEvt(root, evt, evt.srcPt);\n\n\t// if (now) { logger.log('TRACED A', LOCALIZE, SHOULD_HANDLE) }\n\t\n\t// once we've traced the event, we know how deep it goes\n\tvar depth = evt.depth;\n\t\n\texports._evtHistory[evt.type] = evt;\n\t\n\tvar signal = exports._evtCb[evt.type] || exports.getEvtCbName(evt.type);\n\t\n\tfor (var i = depth - 1; i >= 0; --i) {\n\t\tvar view = evt.trace[i],\n\t\t\tpt = evt.pt[view.uid];\n\t\tview.publish(signal + 'Capture', evt, pt, i == 0);\n\t\tif (evt.cancelled || view.__input.blockEvents) { return; }\n\t}\n\t\n\tvar cbName = 'on' + signal;\n\tfor (var i = 0; i < depth; ++i) {\n\t\tvar view = evt.trace[i];\n\t\tif (view.__input.canHandleEvents) {\n\t\t\tvar pt = evt.pt[view.uid];\n\t\t\tif (view[cbName]) { view[cbName](evt, pt, i == 0); }\n\t\t\tview.publish(signal, evt, pt, i == 0);\n\t\t\tview._onEventPropagate(evt, pt, i == 0);\n\t\t\tif (evt.cancelled) { break; }\n\t\t}\n\t}\n}\n\n/**\n * Trace an event recursively down to the view on which the event is triggered.\n */\nexports.traceEvt = function (view, evt, pt) {\n\t// var now = +new Date();\n\tvar localPt = view.style.localizePoint(new Point(pt));\n\tvar inputHandler = view.getInput();\n\tif (!inputHandler.containsEvent(evt, localPt)) { return false; }\n\n\tvar canHandleEvents = view.getInput().canHandleEvents;\n\tif (canHandleEvents) {\n\t\tevt.depth++;\n\t\tevt.trace.unshift(view);\n\t\tevt.pt[view.uid] = localPt;\n\t}\n\t\n\tvar subviews = view.getSubviews();\n\tfor (var i = subviews.length - 1; i >= 0; --i) {\n\t\tif (subviews[i].style.visible && exports.traceEvt(subviews[i], evt, localPt)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\t\n\tif (canHandleEvents) {\n\t\tevt.target = view;\n\t\treturn true;\n\t}\n}\n\nexports._evtHistory = {};\nexports._activeInputOver = {};\n\nexports.clearOverState = function (id) {\n\tif (id) {\n\t\tvar evt = exports._activeInputOver[id];\n\t\tif (evt) {\n\t\t\tdelete exports._activeInputOver[id];\n\t\t\tvar trace = evt.trace;\n\t\t\tif (trace) {\n\t\t\t\tfor (var i = 0, view; view = trace[i]; ++i) {\n\t\t\t\t\tview.__input.onLeave(id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (var id in exports._activeInputOver) {\n\t\t\texports.clearOverState(id);\n\t\t}\n\t}\n}\n\nexports._isDragging = false;\nexports.isDragging = function () { return exports._isDragging; }\n\nexports._evtCb = {};\nexports.getEvtCbName = function (evtType) {\n\tvar name = exports.eventTypes[evtType];\n\treturn (exports._evtCb[evtType] = 'Input' + name.charAt(0) + name.substring(1).toLowerCase());\n}\n\n/**\n * Aliases for children of the timestep.input \"package\".\n */\n\nexports.InputListener = device.get('Input');\nexports.KeyListener = device.get('KeyListener');\n\njsio(\"import .InputEvent as exports.InputEvent\");\n","pre":true},"sdk/timestep/event/input/InputEvent.js":{"path":"sdk/timestep/event/input/InputEvent.js","friendlyPath":".InputEvent","directory":"sdk/timestep/event/input/","filename":"InputEvent.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.input.InputEvent;\n * This class represents an input event.\n * \n * It assumes a tree structure of View objects.  The top (root) of the\n * tree is typically the main Application view.  \n * \n * Events are assigned a root and a target.  View::dispatchEvent\n * computes the root and target from the event location (x, y).\n *\n * Propogation has two phases: capturing and bubbling.  Users \n * can mostly ignore capturing as the primary hooks are in the \n * bubbling.  Bubbling is defined as calling event handlers on\n * each view starting with 'target' and then continuing up \n * superview pointers until reaching 'root'.  Views can listen\n * to the event bubbling by adding methods such as:\n * \"input:start\" -> \"function onInputStart(evt)\"\n * \"input:drag\" -> \"function onDrag(dragEvt, moveEvt, delta)\"\n *\n * Other code can hook into a view's events by calling:\n *   myView.subscribe('input:start', function () { alert('Mouse Down'); });\n *   myView.subscribe('input:end', this, 'onChildViewClick');\n *\n * Propogation of events can be cancelled by calling evt.cancel().\n *\n * Note that onDrag is a special event that receives not only\n * a move event from an 'input:move' event, but also a custom\n * dragEvt object that contains extra data such as the start\n * position of the drag.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.input.inputevent\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio(\"import math.geom.Point as Point\");\njsio(\"import timer\");\n\nvar sdk_timestep_event_input_InputEvent=__class__;var InputEvent = exports=sdk_timestep_event_input_InputEvent(function sdk_timestep_event_input_InputEvent(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.cancelled = false; // If true, this event will not propogate\n\tthis.depth = 0; // Number of levels of the tree from root to target (inclusive)\n\t\n\t// Note that under normal usage:\n\t//   this.depth == this.trace.length\n\t//   this.root = this.trace[this.trace.length - 1]\n\t//   this.target = this.trace[0]\n\t\n\tthis.init = function (id, evtType, x, y, root, target) {\n\t\t// unique ID for a particular input - the ID should be constant for a given input\n\t\t// for example, the mouse should always have the same ID.  Each finger (touch)\n\t\t// should have the same ID throughout the touch start/move/end process\n\t\tthis.id = id; \n\t\t\n\t\t// string evtType, e.g. 'input:start'\n\t\tthis.type = evtType;\n\t\t\n\t\t// localized point coordinates, indexed by a view's uid (View::uid)\n\t\t// @internal --at least for now, concerns over performance.\n\t\tthis.point = this.pt = {};\n\t\t\n\t\t// raw (x, y) coordinates\n\t\tthis.srcPoint = this.srcPt = new Point(x, y);\n\t\t\n\t\t// list of View nodes from target to root\n\t\tthis.trace = [];\n\t\t\n\t\t// Top-most view where event is dispatched (e.g. the tree root)\n\t\tthis.root = root || null;\n\t\t\n\t\t// time of dispatch\n\t\tthis.when = timer.now;\n\t\t\n\t\t// Bottom-most view where the event occurred\n\t\tthis.target = target || null;\n\t}\n\t\n\tthis.cancel = function () {\n\t\tthis.cancelled = true;\n\t}\n\n\tthis.clone = function () {\n\t\treturn new InputEvent(this.id, this.type, this.srcPt.x, this.srcPt.y, this.root, this.target);\n\t}\n});\n","pre":true},"sdk/timestep/timer.js":{"path":"sdk/timestep/timer.js","friendlyPath":"timer","directory":"sdk/timestep/","filename":"timer.js","baseMod":"timer","basePath":"sdk/timestep/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module timer\n *\n * Implements an independent, singleton timer for use by the environment.\n * The Application Engine binds to this to generate the rendering tick.\n */\n\njsio(\"import device\");\n\nvar Timer = device.get('Timer');\n\nvar MAX_TICK = 10000; // ticks over 10 seconds will be considered too large to process\nexports.now = 0;\nexports.frames = 0;\nexports.reset = function () { this._last = null; }\nexports.tick = function (dt) {\n\ttry {\n\t\tif (dt > MAX_TICK) {\n\t\t\texports.onLargeTick(dt, MAX_TICK);\n\t\t\tdt = 1;\n\t\t}\n\t\t\n\t\texports.now += dt;\n\t\texports.frames++;\n\t\texports.onTick(dt);\n\t\tok = true;\n\t} finally {\n\t\tif (exports.debug && !ok) {\n\t\t\tapp.stopLoop()\n\t\t}\n\t}\n}\n\n/**\n * If our computer falls asleep, dt might be an insanely large number. \n * If we're running a simulation of sorts, we don't want the computer\n * to freeze while computing 1000s of simulation steps, so just drop\n * this tick.  Anyone who is interested can listen for a call to 'onLargeTick'\n */\nexports.onLargeTick = function (largeDt, threshold) {\n\tlogger.warn('Dropping large tick: ' + largeDt + '; Threshold is set at: ' + threshold);\n}\n\nexports.onTick = function (dt) {}\n\nexports.debug = false;\n\n\n// TODO: <jsio>('from iOS import start as exports.start, stop as exports.stop');\n\nexports.start = function (minDt) {\n\tthis.reset();\n\tthis.isRunning = true;\n\tdevice.get('Timer').start(exports.tick, minDt);\n}\n\nexports.stop = function () {\n\tthis.reset();\n\tthis.isRunning = false;\n\tdevice.get('Timer').stop();\n}\n\nexports.getTickProgress = function () {\n\tvar now = +new Date;\n\treturn (-(Timer.last || now) + now);\n}\n","pre":true},"sdk/timestep/ui/backend/ReflowManager.js":{"path":"sdk/timestep/ui/backend/ReflowManager.js","friendlyPath":"ui.backend.ReflowManager","directory":"sdk/timestep/ui/backend/","filename":"ReflowManager.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar DEBUG = false;\n\nif (DEBUG) {\n\tvar _debug = {\n\t\tspace: '',\n\t\tstepIn: function () { this.space += ' '; return true; },\n\t\tstepOut: function () { this.space = this.space.slice(0, this.space.length - 1); return true; },\n\t\tlog: function () { logger.log.apply(logger, [this.space].concat(Array.prototype.slice.call(arguments, 0))); return true; }\n\t};\n\tlogger.log(\"===== CREATING REFLOW MANAGER\");\n}\n\n// max reflows for any view in a given tick\nvar MAX_REFLOW_THRESHOLD = 6;\n\nvar _pool = new (Class(function () {\n\tthis._pool = [];\n\n\tthis.recycle = function (item) {\n\t\titem.count = 0;\n\t\titem.view = null;\n\t\tthis._pool.push(item);\n\t}\n\n\tthis.get = function (view) {\n\t\tvar item = this._pool.pop() || {};\n\t\titem.view = view;\n\n\t\titem.iter = 0;\n\t\titem.count = 0;\n\t\treturn item;\n\t}\n}));\n\n/**\n * The ReflowManager is the controller for view layout.  It hooks into\n * the render cycle in two places:\n *  1. at the start of a render to reflow any views that we know\n *     need layout.  This is signalled by calling calls to needsReflow\n *     on a view between render cycles that result in a call to \n *     `ReflowMgr.add`.\n *  2. during render, if the view hasn't ever been rendered, the \n *     ReflowManager is notified to initiate the buildView call\n *     and handle any reflow logic before the view's first render.\n * The ReflowManager uses a queue-like structure to resolve the reflow \n * constraints. Views notify the ReflowManager through the add(view) \n * method, which then adds the view to the queue.  During a reflow cycle,\n * the ReflowManager tracks how many iterations through the queue each \n * view actually gets reflowed.  If the number of reflows exceeds the\n * MAX_REFLOW_THRESHOLD, reflow stops for that view, preventing infinite\n * loops when reflow cycles occur.\n */\n\nvar sdk_timestep_ui_backend_ReflowManager=__class__;var ReflowManager = exports=sdk_timestep_ui_backend_ReflowManager(function sdk_timestep_ui_backend_ReflowManager(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis._pending = {};\n\t\tthis._iter = 0;\n\t}\n\n\tthis.setInRender = function (isInRender) {\n\t\tthis._isInRender = isInRender;\n\t}\n\n\tthis.add = function (view) {\n\t\tvar uid = view.uid;\n\t\tvar item = this._pending[uid] || (this._pending[uid] = _pool.get(view));\n\n\t\titem.needsReflow = true;\n\n\t\t// increment count once per reflow iteration\n\t\tif (item.iter != this._iter) {\n\t\t\titem.count++;\n\t\t\titem.iter = this._iter;\n\t\t}\n\n\t\tDEBUG && _debug.log('adding view', uid, view.style.width + 'x' + view.style.height, view.getTag());\n\n\t\tif (this._isInRender && !this._isInReflow) {\n\t\t\tthis.startReflow(this._lastCtx);\n\t\t}\n\t}\n\n\tthis._reflow = function (ctx, item) {\n\t\titem.needsReflow = false;\n\n\t\tvar view = item.view;\n\t\tvar style = view.style;\n\t\tif (!style.__firstRender) {\n\t\t\tstyle.__firstRender = true;\n\n\t\t\tDEBUG && _debug.log('calling buildView for', view.uid, '(' + view.style.width + 'x' + view.style.height + ')') && _debug.stepIn();\n\t\t\tview.buildView(ctx);\n\t\t\tDEBUG && _debug.stepOut();\n\t\t}\n\n\t\tif (view.hasListeners('Resize')) {\n\t\t\tvar w = style.width;\n\t\t\tvar h = style.height;\n\t\t\tif (style.__cachedWidth != w || style.__cachedHeight != h) {\n\t\t\t\tstyle.__cachedWidth = w;\n\t\t\t\tstyle.__cachedHeight = h;\n\t\t\t\tview.publish('Resize');\n\t\t\t}\n\t\t}\n\n\t\tif (view.__layout) { view.__layout.reflow(); }\n\t\tview.reflow(false);\n\t}\n\n\tthis.startReflow = function (ctx) {\n\t\tthis._lastCtx = ctx;\n\t\tthis._isInReflow = true;\n\t\tthis._iter = 0;\n\t\tvar count;\n\n\t\tDEBUG && _debug.stepIn();\n\n\t\t// as long as we reflowed some views, keep looping\n\t\tdo {\n\t\t\t++this._iter; // what iteration are we on? only increment a view's count once per iteration\n\n\t\t\tcount = 0;\n\t\t\tfor (var uid in this._pending) {\n\t\t\t\tvar item = this._pending[uid];\n\t\t\t\tif (item.count > MAX_REFLOW_THRESHOLD) {\n\t\t\t\t\tlogger.warn('reflow loop detected for view', item.view.uid);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (item.needsReflow) {\n\t\t\t\t\tDEBUG && _debug.log('starting reflow for view', item.view.uid, '(' + item.count + ' times)') && _debug.stepIn();\n\t\t\t\t\tthis._reflow(ctx, item);\n\t\t\t\t\tDEBUG && _debug.stepOut();\n\t\t\t\t\t++count;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tDEBUG && count && _debug.log('iteration', this._iter, 'reflowed', count, 'views');\n\t\t} while (count);\n\n\t\t// recyle items\n\t\tfor (var uid in this._pending) {\n\t\t\t_pool.recycle(this._pending[uid]);\n\t\t}\n\n\t\tthis._pending = {};\n\t\tthis._isInReflow = false;\n\n\t\tDEBUG && _debug.stepOut();\n\t}\n\n});\n\nvar _instance = null;\nexports.get = function () {\n\treturn (_instance || (_instance = new ReflowManager()));\n}\n","pre":true},"sdk/timestep/ui/StackView.js":{"path":"sdk/timestep/ui/StackView.js","friendlyPath":".StackView","directory":"sdk/timestep/ui/","filename":"StackView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.StackView;\n * Implements a view which can switch out one of several child views to display at the front.\n *\n * @doc http://doc.gameclosure.com/api/ui-stackview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/stackview.md\n */\n\njsio(\"import ui.View as View\");\njsio(\"import animate\");\n\n/**\n * @extends ui.View\n */\nvar sdk_timestep_ui_StackView=__class__;exports=sdk_timestep_ui_StackView(function sdk_timestep_ui_StackView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tlayout: 'box'\n\t\t});\n\t\tsupr(this, 'init', [opts]);\n\t\tthis.stack = [];\n\t};\n\n\tthis.getStack = function () { return this.stack; };\n\n\tthis.getCurrentView = function () {\n\t\tif (!this.stack.length) { return null; }\n\t\treturn this.stack[this.stack.length - 1];\n\t};\n\n\tthis.push = function (view, dontAnimate, reverse) {\n\t\t// don't animate the first (base) view of a stackview unless explicitly asked to\n\t\tif (!this.stack[0] && dontAnimate !== false) {\n\t\t\tdontAnimate = true;\n\t\t}\n\n\t\tvar current = this.getCurrentView();\n\t\tif (current) { this._hide(current, dontAnimate); }\n\t\tview.style.width = this.style.width / view.style.scale;\n\t\tview.style.height = this.style.height / view.style.scale;\n\t\tthis.stack.push(view);\n\t\tthis._show(view, dontAnimate, reverse);\n\t\treturn view;\n\t};\n\n\tthis._hide = function (view, dontAnimate, reverse) {\n\t\tview.publish('ViewWillDisappear');\n\t\tif (!dontAnimate) {\n\t\t\tthis.getInput().blockEvents = true;\n\t\t\tanimate(view)\n\t\t\t\t.then({x: (reverse ? 1 : -1) * this.style.width})\n\t\t\t\t.then(bind(this, function () {\n\t\t\t\t\tthis.removeSubview(view);\n\t\t\t\t\tview.publish('ViewDidDisappear');\n\t\t\t\t\tthis.getInput().blockEvents = false;\n\t\t\t\t}));\n\t\t} else {\n\t\t\tthis.removeSubview(view);\n\t\t\tview.publish('ViewDidDisappear');\n\t\t}\n\t};\n\n\tthis._show = function (view, dontAnimate, reverse) {\n\t\tview.publish('ViewWillAppear');\n\t\tview.style.visible = true;\n\t\tif (!dontAnimate) {\n\t\t\tview.style.x = (reverse ? -1 : 1) * this.style.width;\n\t\t\tthis.addSubview(view);\n\t\t\tanimate(view)\n\t\t\t\t.then({x: 0})\n\t\t\t\t.then(bind(view, 'publish', 'ViewDidAppear'));\n\t\t} else {\n\t\t\tthis.addSubview(view);\n\t\t\tview.style.x = 0;\n\t\t\tview.publish('ViewDidAppear');\n\t\t}\n\t};\n\n\tthis.hasView = function (view) {\n\t\treturn this.stack.indexOf(view) >= 0;\n\t};\n\n\tthis.remove = function (view) {\n\t\tvar i = this.stack.indexOf(view);\n\t\tif (i >= 0) {\n\t\t\tthis.stack.splice(i, 1);\n\t\t}\n\t}\n\n\tthis.pop = function (dontAnimate, reverse) {\n\t\tif (!this.stack.length) { return false; }\n\t\tvar view = this.stack.pop();\n\t\t//reverse by default\n\t\tthis._hide(view, dontAnimate, (reverse === false) ? false : true);\n\n\t\tif (this.stack.length) {\n\t\t\tthis._show(this.stack[this.stack.length - 1], dontAnimate, true);\n\t\t}\n\n\t\treturn view;\n\t};\n\n\tthis.popAll = function (dontAnimate) {\n\t\twhile (this.stack[1]) {\n\t\t\tthis.pop(dontAnimate);\n\t\t}\n\t};\n});\n","pre":true},"sdk/timestep/ui/View.js":{"path":"sdk/timestep/ui/View.js","friendlyPath":"ui.View","directory":"sdk/timestep/ui/","filename":"View.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.View;\n * The View base class.\n *\n * @doc http://doc.gameclosure.com/api/ui-view.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/view.md\n */\n\njsio(\"import device\");\njsio(\"import event.Emitter as Emitter\");\n\njsio(\"import math.geom.Point as Point\");\njsio(\"import math.geom.Rect as Rect\");\n\njsio(\"import .backend.canvas.ViewBacking\");\n\njsio(\"import ui.backend.ReflowManager as ReflowManager\");\n\njsio(\"import event.input.dispatch as dispatch\");\njsio(\"import event.input.InputHandler as InputHandler\");\n\njsio(\"import animate\");\n\njsio(\"import util.setProperty\");\n\njsio(\"import .Engine\");\n\nvar KeyListener = device.get('KeyListener');\n\nEventScheduler=__class__;var EventScheduler=EventScheduler(function EventScheduler(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis._queue = [];\n\t}\n\n\tthis.add = function (f) {\n\t\tthis._queue.push(f);\n\n\t\tif (!this._running) {\n\t\t\tthis._running = true;\n\t\t\twhile ((f = this._queue.shift())) {\n\t\t\t\tf();\n\t\t\t}\n\t\t\tthis._running = false;\n\t\t}\n\t}\n});\n\nvar scheduler = new EventScheduler();\n\n/**\n * This singleton class controls the focus of the current application. Only one\n * view can be focused at a given time.\n *\n * This doesn't correspond to native and isn't being used.\n */\nvar FocusMgr = new (Class(function () {\n\tthis.init = function (opts) {\n\t\tthis._keyListener = KeyListener && (new KeyListener());\n\t\tthis._target = null;\n\t\tthis._canChange = true;\n\t};\n\n\t/**\n\t * Focus the target, unfocusing the last target with focus.\n\t */\n\tthis.focus = function (target) {\n\t\tif (this._target != target && this._canChange) {\n\t\t\tif (this._target && this._target.onBlur) {\n\t\t\t\tthis._target.onBlur(this);\n\t\t\t}\n\n\t\t\tthis._target = target;\n\t\t\tif (target && target.onFocus) {\n\t\t\t\tthis._target.onFocus(this);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.blur = function (target) {\n\t\ttarget.onBlur && target.onBlur(this);\n\t\tthis._target = false;\n\t};\n\n\t/**\n\t * Return the keylistener used by the focus manager.\n\t */\n\tthis.getKeyListener = function () {\n\t\treturn this._keyListener;\n\t};\n\n\tthis.get = function () {\n\t\treturn this;\n\t};\n}));\n\n/**\n * Unique ID counter for all views.\n */\nvar UID = 0;\n\nvar _BackingCtor = null;\n\n/**\n * @extends event.Emitter\n */\nvar sdk_timestep_ui_View=__class__;var View = exports=sdk_timestep_ui_View(function sdk_timestep_ui_View(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\t/**\n\t * infinite: boolean, default false - if true, no bounding shape at all (e.g. infinite scroll plane)\n\t * clip: boolean, default false - if true, always clip to the region\n\t * canHandleEvents: boolean, default true - if false, this view is ignored for event handling\n\t * parent: object, if provided, sets the initial superview\n\t */\n\tthis.init = function (opts) {\n\t\tif (!opts) { opts = {}; }\n\n\t\tthis.uid = ++UID;\n\t\tthis.__input = new InputHandler(this, opts);\n\n\t\t// set with View.setDefaultViewBacking();\n\t\tthis.__view = this.style = new (opts.Backing || _BackingCtor)(this, opts);\n\n\t\tthis._filter = null;\n\t\tthis._dragOffset = {};\n\n\t\tthis.__view._view = this;\n\n\t\tvar engine = Engine.get();\n\t\tif (engine) {\n\t\t\tthis._reflowManager = engine.getReflowManager();\n\t\t}\n\n\t\tthis.updateOpts(opts);\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\topts = opts || {};\n\t\tif (this._opts) {\n\t\t\tfor (var key in opts) {\n\t\t\t\tthis._opts[key] = opts[key];\n\t\t\t}\n\t\t} else {\n\t\t\tthis._opts = opts;\n\t\t}\n\n\t\tif (opts.tag) { this.tag = opts.tag; }\n\t\tif (opts.filter) { this._filter = opts.filter; }\n\n\t\tif (opts.infinite) {\n\t\t\tthis._infinite = opts.infinite;\n\t\t}\n\n\t\tthis.style.update(opts);\n\n\t\tif (opts.superview) {\n\t\t\topts.superview.addSubview(this);\n\t\t}\n\t\t//opts.parent is deprecated, use opts.superview instead\n\t\tif (opts.parent) {\n\t\t\topts.parent.addSubview(this);\n\t\t}\n\n\t\treturn opts;\n\t};\n\n\t// --- filters ---\n\t// each filter can have multiple views\n\t// but no view can have more than one filter\n\n\t/**\n\t * Returns the filters attached to this view -- DEPRECATED\n\t */\n\tthis.getFilters = function () {\n\t\tlogger.warn(\"View.getFilters() is deprecated! Use View.getFilter() instead.\");\n\t\tvar filters = {};\n\t\tif (this._filter) {\n\t\t\tfilters[this._filter._opts.type] = this._filter;\n\t\t}\n\t\treturn filters;\n\t};\n\n\t/**\n\t * Returns the filter attached to this view.\n\t */\n\tthis.getFilter = function () {\n\t\treturn this._filter;\n\t};\n\n\t/**\n\t * Sets the filter on this view -- DEPRECATED\n\t */\n\tthis.addFilter = function (filter) {\n\t\tlogger.warn(\"View.addFilter() is deprecated! Use View.setFilter() instead.\");\n\t\tthis.setFilter(filter);\n\t};\n\n\t/**\n\t * Sets the filter on this view. Only one filter can exist on a view.\n\t */\n\tthis.setFilter = function (filter) {\n\t\tthis._filter = filter;\n\t};\n\n\t/**\n\t * Remove the filter from this view.\n\t */\n\tthis.removeFilter = function () {\n\t\tthis._filter = null;\n\t};\n\n\t// --- render/tick setters ---\n\n\t/**\n\t * Adds a hook to determine when the \"render\" property is set.\n\t */\n\tutil.setProperty(this, 'render', {\n\t\t\tvalue: undefined,\n\t\t\tcb: function () { this.__view && (this.__view.hasJSRender = true); }\n\t\t});\n\n\t/**\n\t * Adds a hook to determine when the \"tick\" property is set.\n\t */\n\tutil.setProperty(this, 'tick', {\n\t\t\tvalue: undefined,\n\t\t\tcb: function () { this.__view && (this.__view.hasJSTick = true); }\n\t\t});\n\n\t// --- animation component ---\n\n\t/**\n\t * Get an animation group from this view.\n\t */\n\tthis.getAnimation = function (groupID) {\n\t\treturn animate(this, groupID);\n\t};\n\n\t/**\n\t * @deprecated\n\t * Return an animation object for this view.\n\t */\n\tthis.animate = function (style, duration, easing) {\n\t\treturn this.getAnimation().then(style, duration, easing);\n\t};\n\n\t// --- ui focus/blur component ---\n\n\t/**\n\t * Indicate to the focus manager singleton this element is focused.\n\t */\n\tthis.focus = function () {\n\t\tFocusMgr.get().focus(this); return this;\n\t};\n\n\t/**\n\t * Indicate to the focus manager singleton this element is blurred.\n\t */\n\tthis.blur = function () {\n\t\tFocusMgr.get().blur(this);\n\t\treturn this;\n\t};\n\n\t/**\n\t * Triggered when focus is given to this view.\n\t */\n\tthis.onFocus = function () {\n\t\tthis._isFocused = true;\n\t};\n\n\t/**\n\t * Indicate to the focus manager singleton this element is blurred.\n\t */\n\tthis.onBlur = function () {\n\t\tthis._isFocused = false;\n\t};\n\n\t// --- input component ---\n\n\t/**\n\t * Returns a boolean indicating we are currently dragging this view.\n\t */\n\tthis.isDragging = function () {\n\t\treturn this.__input.isDragging();\n\t};\n\n\t/**\n\t * Start responding to touch input by dragging this view.\n\t */\n\tthis.startDrag = function (opts) {\n\t\tthis.__input.startDrag(opts);\n\t};\n\n\t/**\n\t * Return the InputHandler for this view.\n\t */\n\tthis.getInput = function () {\n\t\treturn this.__input;\n\t};\n\n\t/**\n\t * Returns a boolean indicating if a touch is on this view.\n\t */\n\tthis.isInputOver = function () {\n\t\treturn !!this.__input.overCount;\n\t};\n\n\t/**\n\t * Returns a number indicating how many touches are on this view.\n\t */\n\tthis.getInputOverCount = function () {\n\t\treturn this._inputOverCount;\n\t};\n\n\t/**\n\t * Renamed to setHandleEvents, canHandleEvents is deprecated.\n\t * @param {boolean} ignoreEvents Pass events through. Default is true.\n\t * @param {boolean=} ignoreSubviews Optional, defaults to false in InputHandler. Ignore events in childen as well.\n\t */\n\tthis.setHandleEvents = this.canHandleEvents = function (handleEvents, ignoreSubviews) {\n\t\tthis.__input.canHandleEvents = handleEvents;\n\t\t\n\t\tif (typeof ignoreEvents === 'boolean') {\n\t\t\tthis.__input.blockEvents = ignoreSubviews;\n\t\t}\n\t};\n\n\t// TODO: think about refactoring internal components and exposing them differently...\n\tthis.setIsHandlingEvents = function (canHandleEvents) {\n\t\tthis.__input.canHandleEvents = canHandleEvents;\n\t};\n\n\tthis.isHandlingEvents = function () {\n\t\treturn this.__input.canHandleEvents;\n\t};\n\n\tthis.needsRepaint = function () {\n\t\tthis._needsRepaint = true;\n\t};\n\n\tthis.needsReflow = function (force) {\n\t\tif (this.style.__firstRender || force) {\n\t\t\tthis._reflowManager && this._reflowManager.add(this);\n\t\t\tthis._needsRepaint = true;\n\t\t}\n\t};\n\n\t/**\n\t * Consumes an event targeting this view.\n\t * NOTE: Does no actual propagation.\n\t */\n\tthis._onEventPropagate = function (evt, pt, atTarget) {\n\t\tif (atTarget) {\n\t\t\tvar id = evt.id;\n\t\t\tvar lastEvt;\n\t\t\tvar i;\n\n\t\t\tswitch(evt.type) {\n\t\t\t\tcase dispatch.eventTypes.SELECT:\n\t\t\t\tcase dispatch.eventTypes.CLEAR:\n\t\t\t\t\tdispatch._evtHistory[dispatch.eventTypes.MOVE] = null;\n\t\t\t\t\tlastEvt = dispatch._activeInputOver[id];\n\t\t\t\t\tif (lastEvt) {\n\t\t\t\t\t\tdispatch.clearOverState(id);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase dispatch.eventTypes.START:\n\t\t\t\tcase dispatch.eventTypes.MOVE:\n\t\t\t\t\t// translate input:move events into two higher-level events:\n\t\t\t\t\t//   input:over and input:out\n\n\t\t\t\t\tvar target = evt.trace[0];\n\t\t\t\t\tvar view = null;\n\n\t\t\t\t\t// fire input:out events first, start with deepest node and work out\n\t\t\t\t\tlastEvt = dispatch._activeInputOver[id];\n\t\t\t\t\tif (lastEvt && target != lastEvt.trace[0]) {\n\t\t\t\t\t\tvar trace = lastEvt.trace;\n\t\t\t\t\t\tfor (i = 0, view; view = trace[i]; ++i) {\n\t\t\t\t\t\t\tif (!(view.uid in evt.pt)) {\n\t\t\t\t\t\t\t\tview.__input.onLeave(id, target == view);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!lastEvt || target != lastEvt.trace[0]) {\n\t\t\t\t\t\t// fire input:over events second, start with outermost node and go to target\n\t\t\t\t\t\tvar trace = evt.trace;\n\t\t\t\t\t\tfor (i = evt.depth - 1; i >= 0; --i) {\n\t\t\t\t\t\t\ttrace[i].__input.onEnter(id, target == view);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// update current mouse trace\n\t\t\t\t\t\tdispatch._activeInputOver[id] = evt;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.localizePoint = function (pt) {\n\t\tvar list = this.getParents();\n\t\tvar i = 0;\n\t\tlist.push(this);\n\t\twhile (list[++i]) { pt = list[i].__view.localizePoint(pt); }\n\t\treturn pt;\n\t};\n\n\t// --- view hierarchy component ---\n\n\tthis.setReflowManager = function (reflowManager) {\n\t\tthis._reflowManager = reflowManager;\n\t};\n\n\t/**\n\t * Return the subview at the given index.\n\t */\n\tthis.getSubview = function (i) {\n\t\treturn this.__view.getSubviews()[i];\n\t};\n\n\t/**\n\t * Returns an array of all subviews.\n\t */\n\tthis.getSubviews = function () {\n\t\treturn this.__view.getSubviews();\n\t};\n\n\t/**\n\t * Returns the superview of this view.\n\t */\n\tthis.getSuperview = function () {\n\t\treturn this.__view.getSuperview();\n\t};\n\n\tthis.connectEvent = function (src, name /*, args */) {\n\t\tif (!this.__subs) {\n\t\t\tthis.__subs = [];\n\n\t\t\tthis.on('ViewAdded', bind(this, '_connectEvents'));\n\t\t\tthis.on('ViewRemoved', bind(this, '_disconnectEvents'));\n\n\t\t\tif (this.__root) {\n\t\t\t\tthis._connectEvents();\n\t\t\t}\n\t\t}\n\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tthis.__subs.push([src, args]);\n\t\tif (this.__root) {\n\t\t\tsrc.on.apply(src, args);\n\t\t}\n\t}\n\n\tfunction compareSubscription (args, sub) {\n\t\t// note that args and sub may not be the same length\n\t\t// return true if all items in args match items in sub\n\t\t// (we don't care if sub has extra arguments)\n\t\tfor (var i = 0, n = args.length; i < n; ++i) {\n\t\t\tif (args[i] != sub[i]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tthis.disconnectEvent = function (src, name /*, args */) {\n\t\tif (this.__subs) {\n\t\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\t\tfor (var i = 0, sub; sub = this.__subs[i]; ++i) {\n\t\t\t\tif (sub[0] == src && compareSubscription(args, sub[1])) {\n\t\t\t\t\tsub[0].removeListener.apply(sub[0], sub[1]);\n\t\t\t\t\tthis.__subs.splice(i--, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._connectEvents = function () {\n\t\tfor (var i = 0, args; args = this.__subs[i]; ++i) {\n\t\t\targs[0].on.apply(args[0], args[1]);\n\t\t}\n\t};\n\n\tthis._disconnectEvents = function () {\n\t\tfor (var i = 0, args; args = this.__subs[i]; ++i) {\n\t\t\targs[0].removeListener.apply(args[0], args[1]);\n\t\t}\n\t};\n\n\t/**\n\t * Add a subview.\n\t */\n\tthis.addSubview = function (view) {\n\t\tif (this.__view.addSubview(view)) {\n\t\t\tview.needsRepaint();\n\t\t\tthis._reflowManager && view.needsReflow();\n\n\t\t\t// if successful, clear any residual input over count\n\t\t\tview.__input.resetOver();\n\n\t\t\tthis.publish('SubviewAdded', view);\n\t\t\tif (this.__root) {\n\t\t\t\tvar root = this.__root;\n\t\t\t\tvar viewCreated = view;\n\t\t\t\tscheduler.add(bind(this, function recurse(view) {\n\t\t\t\t\tview.__root = root;\n\t\t\t\t\tview.emit('ViewAdded', viewCreated);\n\t\t\t\t\tvar subviews = view.getSubviews();\n\t\t\t\t\tfor (var i = 0, subview; subview = subviews[i]; ++i) {\n\t\t\t\t\t\trecurse(subview);\n\t\t\t\t\t}\n\t\t\t\t}, view));\n\t\t\t}\n\t\t}\n\n\t\treturn view;\n\t};\n\n\t/**\n\t * Removes a subview.\n\t */\n\tthis.removeSubview = function (view) {\n\t\tif (this.__view.removeSubview(view)) {\n\t\t\tthis.publish('SubviewRemoved', view);\n\t\t\tif (view.__root) {\n\t\t\t\tscheduler.add(bind(this, function recurse(view) {\n\t\t\t\t\tview.__root = null;\n\t\t\t\t\tview.emit('ViewRemoved', this);\n\t\t\t\t\tvar subviews = view.getSubviews();\n\t\t\t\t\tfor (var i = 0, subview; subview = subviews[i]; ++i) {\n\t\t\t\t\t\trecurse(subview);\n\t\t\t\t\t}\n\t\t\t\t}, view));\n\t\t\t}\n\t\t}\n\n\t\treturn view;\n\t};\n\n\t/**\n\t * Removes this view from its parent.\n\t */\n\tthis.removeFromSuperview = function () {\n\t\tvar superview = this.__view.getSuperview();\n\t\tif (superview) {\n\t\t\tsuperview.removeSubview(this);\n\t\t}\n\t};\n\n\t/**\n\t * Removes all subviews from this view.\n\t */\n\tthis.removeAllSubviews = function () {\n\t\tvar subviews = this.getSubviews();\n\t\tvar i = subviews.length;\n\t\twhile (i--) {\n\t\t\tthis.removeSubview(subviews[i]);\n\t\t}\n\t};\n\n\t// legacy implementation shim\n\tutil.setProperty(this, '_superview', {get: this.getSuperview, set: function () {}});\n\tutil.setProperty(this, '_subviews', {get: this.getSubviews, set: function () {}});\n\n\t// --- onResize callbacks ---\n\n\tthis.reflow = function () {\n\t};\n\n\t// ---\n\n\t/**\n\t * Get the root application for this view.\n\t */\n\tthis.getApp = function () {\n\t\tvar top = this;\n\t\tvar next;\n\t\tdo {\n\t\t\tnext = top.__view.getSuperview();\n\t\t} while (next && (top = next));\n\t\treturn top.__root;\n\t};\n\n\t/**\n\t * Returns an array of all ancestors of the current view.\n\t */\n\tthis.getParents = function () {\n\t\tvar list = [this];\n\t\tvar next;\n\t\tdo {\n\t\t\tnext = list[0].__view.getSuperview();\n\t\t} while (next && list.unshift(next));\n\n\t\tlist.pop();\n\t\treturn list;\n\t};\n\n\t/**\n\t * @interface\n\t */\n\tthis.buildView = function () {};\n\n\t/**\n\t * Determine if this view contains a point.\n\t */\n\tthis.containsLocalPoint = function (pt) {\n\t\tif (this._infinite) { return true; }  // infinite plane\n\n\t\tvar s = this.style,\n\t\t\tw = s.width,\n\t\t\th = s.height;\n\n\t\tif (w > 0 && h > 0) {\n\t\t\treturn pt.x <= w && pt.y <= h && pt.x >= 0 && pt.y >= 0;\n\t\t} else if (w > 0) {\n\t\t\treturn pt.x <= w && pt.y >= h && pt.x >= 0 && pt.y <= 0;\n\t\t} else if (h > 0) {\n\t\t\treturn pt.x >= w && pt.y <= h && pt.x <= 0 && pt.y >= 0;\n\t\t} else {\n\t\t\treturn pt.x >= w && pt.y >= h && pt.x <= 0 && pt.y <= 0;\n\t\t}\n\t};\n\n\t/**\n\t * Return the bounding shape for this view. The shape is defined in the\n\t * options object when this view was constructed.\n\t */\n\tthis._boundingShape = {};\n\tthis.getBoundingShape = function (simple) {\n\t\tif (this._infinite) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\t\t\tif (!(w && h) && s.layout) {\n\t\t\t\tvar superview = this.getSuperview();\n\t\t\t\tif (superview) {\n\t\t\t\t\tvar supersize = superview.getBoundingShape(true);\n\t\t\t\t\tif (!w) {\n\t\t\t\t\t\tw = supersize.width;\n\t\t\t\t\t\tif (s.layoutWidth) {\n\t\t\t\t\t\t\tw *= parseInt(s.layoutWidth) / 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!h) {\n\t\t\t\t\t\th = supersize.height;\n\t\t\t\t\t\tif (s.layoutHeight) {\n\t\t\t\t\t\t\th *= parseInt(s.layoutHeight) / 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (simple) {\n\t\t\t\tthis._boundingShape.x = s.x;\n\t\t\t\tthis._boundingShape.y = s.y;\n\t\t\t\tthis._boundingShape.width = w * s.scale;\n\t\t\t\tthis._boundingShape.height = h * s.scale;\n\t\t\t\treturn this._boundingShape;\n\t\t\t}\n\t\t\treturn new Rect(s.x, s.y, w * s.scale, h * s.scale);\n\t\t}\n\t};\n\n\t/**\n\t * Given a rectangle and a parent view, compute the location of\n\t * the rectangle in this view's coordinate space.\n\t * WARNING: only works with non-rotated rectangles.\n\t * TODO Make it work with rotated rectangles!\n\t */\n\tthis.getRelativeRegion = function (region, parent) {\n\t\tvar offset = this.getPosition(parent || region.src);\n\t\treturn new Rect((region.x - offset.x) / offset.scale,\n\t\t\t\t\t\t(region.y - offset.y)  / offset.scale,\n\t\t\t\t\t\tregion.width / offset.scale,\n\t\t\t\t\t\tregion.height / offset.scale);\n\t};\n\n\t/**\n\t * Return a fully defined position, rotation, size, and scale for this view.\n\t */\n\tthis.getPosition = function (/* optional */ relativeTo) {\n\t\tvar abs = new Point(),\n\t\t\tview = this,\n\t\t\tr = 0,\n\t\t\ts = this.style,\n\t\t\tw = s.width,\n\t\t\th = s.height,\n\t\t\tc = 1;\n\n\t\twhile (view && view != relativeTo) {\n\t\t\tvar scale = view.style.scale;\n\n\t\t\t//translate to anchor point\n\t\t\tabs.add(\n\t\t\t\t-(view.style.anchorX),\n\t\t\t\t-(view.style.anchorY)\n\t\t\t);\n\n\t\t\t//scale and rotate\n\t\t\tabs.rotate(view.style.r);\n\t\t\tabs.scale(scale);\n\n\t\t\t//translate back\n\t\t\tabs.add(\n\t\t\t\tview.style.anchorX + view.style.x + view.style.offsetX,\n\t\t\t\tview.style.anchorY + view.style.y + view.style.offsetY\n\t\t\t);\n\n\t\t\tr += view.style.r;\n\t\t\tw *= scale;\n\t\t\th *= scale;\n\t\t\tc *= scale;\n\t\t\tview = view.__view.getSuperview();\n\t\t}\n\n\t\treturn {\n\t\t\tx: abs.x,\n\t\t\ty: abs.y,\n\t\t\tr: r % (2 * Math.PI),\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t\tscale: c,\n\t\t\tanchorX: this.style.anchorX,\n\t\t\tanchorY: this.style.anchorY\n\t\t};\n\t};\n\n\t/**\n\t * Exposes the internal implementation of the view hierarchy\n\t */\n\tthis.getBacking = function () {\n\t\treturn this.__view;\n\t};\n\n\t/**\n\t * Sets the visibility to true. Triggers repaint.\n\t */\n\tthis.show = function () {\n\t\tthis.style.visible = true;\n\t\tthis.needsRepaint();\n\t};\n\n\t/**\n\t * Sets the visibility to false. Triggers repaint.\n\t */\n\tthis.hide = function () {\n\t\tthis.style.visible = false;\n\t\tthis.needsRepaint();\n\t};\n\n\t/**\n\t * Return a human-readable tag for this view.\n\t */\n\tthis.toString = this.getTag = function () {\n\t\tvar cls = \"View\";\n\n\t\tif (DEBUG) {\n\t\t\t// check the cached name\n\t\t\tif (this.__tagClassName) {\n\t\t\t\tcls = this.__tagClassName;\n\t\t\t} else {\n\t\t\t\t// generate the classname\n\t\t\t\tcls = this.constructor.name;\n\n\t\t\t\tif (!cls) {\n\t\t\t\t\tcls = this.constructor.toString().match(/^function ([^(]+)/)[1];\n\t\t\t\t}\n\n\t\t\t\tif (cls) {\n\t\t\t\t\tcls = cls.substr(cls.lastIndexOf(\"_\") + 1);\n\t\t\t\t}\n\n\t\t\t\tthis.__tagClassName = cls || 'unknown';\n\t\t\t}\n\t\t}\n\n\t\treturn cls + this.uid + (this.tag ? ':' + this.tag : '');\n\t};\n});\n\nvar _extensions = [];\nView.addExtension = function (ext) {\n\text.extend(View.BackingCtor);\n\t_extensions.push(ext);\n};\n\nView.setDefaultViewBacking = function (ViewBackingCtor) {\n\t_BackingCtor = View.BackingCtor = ViewBackingCtor;\n\t_extensions.forEach(function (ext) { ext.extend(_BackingCtor); });\n};\n\n// default view backing is canvas\nView.setDefaultViewBacking(backend.canvas.ViewBacking);\n","pre":true},"sdk/timestep/ui/backend/canvas/ViewBacking.js":{"path":"sdk/timestep/ui/backend/canvas/ViewBacking.js","friendlyPath":".backend.canvas.ViewBacking","directory":"sdk/timestep/ui/backend/canvas/","filename":"ViewBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.canvas.ViewStyle;\n *\n * Models the style object of the canvas View.\n */\n\njsio(\"import ..strPad\");\njsio(\"import ..BaseBacking\");\njsio(\"import util.setProperty as setProperty\");\n\nvar _styleKeys = {};\n\nvar sdk_timestep_ui_backend_canvas_ViewBacking=__class__;var ViewBacking = exports=sdk_timestep_ui_backend_canvas_ViewBacking(function sdk_timestep_ui_backend_canvas_ViewBacking(){return this.init&&this.init.apply(this,arguments)},BaseBacking, function () {\n\t\n\tthis.constructor.absScale = 1;\n\n\tthis.init = function (view) {\n\t\tthis._view = view;\n\t\tthis._subviews = [];\n\t}\n\n\tthis.getSuperview = function () { return this._superview; }\n\tthis.getSubviews = function () {\n\t\tif (this._needsSort) { this._needsSort = false; this._subviews.sort(); }\n\t\tvar subviews = [];\n\t\tvar backings = this._subviews;\n\t\tvar n = backings.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tsubviews[i] = backings[i]._view;\n\t\t}\n\n\t\treturn subviews;\n\t}\n\n\tvar ADD_COUNTER = 900000;\n\tthis.addSubview = function (view) {\n\t\tvar backing = view.__view;\n\t\tvar superview = backing._superview;\n\t\tif (superview == this._view) { return false; }\n\t\tif (superview) { superview.__view.removeSubview(view); }\n\n\t\tvar n = this._subviews.length;\n\t\tthis._subviews[n] = backing;\n\n\t\tbacking._superview = this._view;\n\t\tbacking._setAddedAt(++ADD_COUNTER);\n\n\t\tif (n && backing.__sortKey < this._subviews[n - 1].__sortKey) {\n\t\t\tthis._needsSort = true;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tthis.removeSubview = function (targetView) {\n\t\tvar index = this._subviews.indexOf(targetView.__view);\n\t\tif (index != -1) {\n\t\t\tthis._subviews.splice(index, 1);\n\t\t\t// this._view.needsRepaint();\n\n\t\t\ttargetView.__view._superview = null;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tthis.wrapTick = function (dt, app) {\n\t\tthis._view.tick && this._view.tick(dt, app);\n\n\t\tfor (var i = 0, view; view = this._subviews[i]; ++i) {\n\t\t\tview.wrapTick(dt, app);\n\t\t}\n\n\t\t// TODO: support partial repaints?\n\t\t// if (this._view._needsRepaint) {\n\t\t// \tthis._view._needsRepaint = false;\n\t\t// \tapp.needsRepaint();\n\t\t// }\n\t}\n\n\tthis.wrapRender = function (ctx, opts) {\n\t\tif (!this.visible) { return; }\n\t\t\n\t\tif (!this.__firstRender) { this._view.needsReflow(true); }\n\t\tif (this._needsSort) { this._needsSort = false; this._subviews.sort(); }\n\t\t\n\t\tvar width = this._width;\n\t\tvar height = this._height;\n\t\tif (width < 0 || height < 0) { return; }\n\n\t\tctx.save();\n\t\t\n\t\tctx.translate(this.x + this.anchorX + this.offsetX, this.y + this.anchorY + this.offsetY);\n\t\t\n\t\tif (this.r) { ctx.rotate(this.r); }\n\t\t\n\t\t// clip this render to be within its view;\n\t\tif (this.scale != 1) {\n\t\t\tctx.scale(this.scale, this.scale);\n\t\t\tViewBacking.absScale *= this.scale;\n\t\t}\n\n\t\tthis.absScale = ViewBacking.absScale;\n\t\t\n\t\tif (this.opacity != 1) { ctx.globalAlpha *= this.opacity; }\n\n\t\tctx.translate(-this.anchorX, -this.anchorY);\n\n\t\tif (this.clip) { ctx.clipRect(0, 0, width, height); }\n\t\t\n\t\tvar filters = {};\n\t\tvar filter = this._view.getFilter();\n\t\tif (filter) {\n\t\t\tfilters[filter._opts.type] = filter;\n\t\t}\n\t\tctx.setFilters(filters);\n\n\t\tif (this.flipX || this.flipY) {\n\t\t\tctx.translate(\n\t\t\t\tthis.flipX ? width / 2 : 0,\n\t\t\t\tthis.flipY ? height / 2 : 0\n\t\t\t);\n\n\t\t\tctx.scale(\n\t\t\t\tthis.flipX ? -1 : 1,\n\t\t\t\tthis.flipY ? -1 : 1\n\t\t\t);\n\n\t\t\tctx.translate(\n\t\t\t\tthis.flipX ? -width / 2 : 0,\n\t\t\t\tthis.flipY ? -height / 2 : 0\n\t\t\t);\n\t\t}\n\n\t\ttry {\n\t\t\tif (this.backgroundColor) {\n\t\t\t\tctx.fillStyle = this.backgroundColor;\n\t\t\t\tctx.fillRect(0, 0, width, height);\n\t\t\t}\n\n\t\t\tvar viewport = opts.viewport;\n\t\t\tthis._view.render && this._view.render(ctx, opts);\n\t\t\tthis._renderSubviews(ctx, opts);\n\t\t\topts.viewport = viewport;\n\n\t\t} finally {\n\t\t\tctx.clearFilters();\n\t\t\tctx.restore();\n\t\t}\n\t}\n\n\tthis._renderSubviews = function (ctx, opts) {\n\t\tvar i = 0;\n\t\tvar view;\n\t\tvar subviews = this._subviews;\n\t\twhile (view = subviews[i++]) {\n\t\t\tview.wrapRender(ctx, opts);\n\t\t}\n\t}\n\n\t// this._clearCache = function () { this._cache = null; }\n\t\n\t// this.updateRadius = function () {\n\t// \tvar w = this.width * 0.5,\n\t// \t\th = this.height * 0.5;\n\t\t\n\t// \tif (!this._cache) { this._cache = {}; }\n\t// \treturn (this._cache.radius = Math.sqrt(w * w + h * h));\n\t// }\n\t\n\tthis._onResize = function (prop, value, prevValue) {\n\t\t// local properties are invalidated\n\t\t// this._cache = null;\n\t\t\n\t\t// child view properties might be invalidated\n\t\tthis._view.needsReflow();\n\t}\n\t\n\tthis._sortIndex = strPad.initialValue;\n\tthis._onZIndex = function (_, zIndex) {\n\t\tthis._sortIndex = strPad.pad(zIndex);\n\n\t\tthis._setSortKey();\n\t\tthis._view.needsRepaint();\n\n\t\tvar superview = this._view.getSuperview();\n\t\tif (superview) { superview.__view._needsSort = true; }\n\t}\n\n\tthis._setAddedAt = function (addedAt) {\n\t\tthis._addedAt = addedAt;\n\t\tthis._setSortKey();\n\t}\n\n\tthis._setSortKey = function () {\n\t\tthis.__sortKey = this._sortIndex + this._addedAt;\n\t}\n\n\t//not implemented\n\tthis._onOffsetX = function (n) {\n\t\tthis.offsetX = n * this.width / 100;\n\t};\n\n\t//not implemented\n\tthis._onOffsetY = function (n) {\n\t\tthis.offsetY = n * this.height / 100;\n\t};\n\t\n\tthis.toString = function () { return this.__sortKey; }\n});\n","pre":true},"sdk/timestep/ui/backend/strPad.js":{"path":"sdk/timestep/ui/backend/strPad.js","friendlyPath":"..strPad","directory":"sdk/timestep/ui/backend/","filename":"strPad.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar LEN = 8;\nvar MAX = 99999999;\nvar MIN = -99999999;\nvar PAD = \"00000000\";\n\nexports.initialValue = PAD;\n\nexports.pad = function (val) {\n\tval = ~~val;\n\n\tif (val < MIN) { val = MIN; }\n\tif (val > MAX) { val = MAX; }\n\tif (val < 0) {\n\t\tval *= -1;\n\t\treturn '-' + PAD.substring(0, LEN - ('' + val).length) + val;\n\t} else {\n\t\treturn PAD.substring(0, LEN - ('' + val).length) + val;\n\t}\n};\n","pre":true},"sdk/timestep/ui/backend/BaseBacking.js":{"path":"sdk/timestep/ui/backend/BaseBacking.js","friendlyPath":"..BaseBacking","directory":"sdk/timestep/ui/backend/","filename":"BaseBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\njsio(\"import util.setProperty as setProperty\");\n\nvar sdk_timestep_ui_backend_BaseBacking=__class__;var BaseBacking = exports=sdk_timestep_ui_backend_BaseBacking(function sdk_timestep_ui_backend_BaseBacking(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\t// required methods:\n\t//\n\t// this._onResize = function () {};\n\t// this._onZIndex = function () {};\n\n\tvar styleKeys = this.constructor.styleKeys = {};\n\n\t// keys map to properties\n\tvar BASE_STYLE_PROPS = {\n\t\t'x': {value: 0},\n\t\t'y': {value: 0},\n\t\t'offsetX': {value: 0}, //translate\n\t\t'offsetY': {value: 0},\n\t\t'offsetXPercent': {value: undefined, cb: '_onOffsetX'}, //not implemented\n\t\t'offsetYPercent': {value: undefined, cb: '_onOffsetY'},\n\t\t'anchorX': {value: 0}, //rotation and scale\n\t\t'anchorY': {value: 0},\n\t\t'centerAnchor': {value: false},\n\t\t'width': {cb: '_onResize'},\n\t\t'height': {cb: '_onResize'},\n\t\t'r': {value: 0},\n\t\t'opacity': {value: 1},\n\t\t'zIndex': {value: 0, cb: '_onZIndex'},\n\t\t// 'radius': {\n\t\t// \tget: function () {\n\t\t// \t\treturn this._cache && 'radius' in this._cache ? this._cache.radius : this.updateRadius();\n\t\t// \t}\n\t\t// },\n\t\t'scale': {value: 1},\n\t\t'flipX': {value: false},\n\t\t'flipY': {value: false},\n\t\t'visible': {value: true},\n\t\t'shadowColor': {value: 'black'}, //only has an effect in TextView??\n\t\t'clip': {value: false},\n\t\t'backgroundColor': {value: undefined}\n\t};\n\t\n\tthis.constructor.addProperty = function (key, def) {\n\t\tstyleKeys[key] = true;\n\t\tsetProperty(this.prototype, key, def);\n\t}\n\n\tfor (var key in BASE_STYLE_PROPS) {\n\t\tthis.constructor.addProperty(key, BASE_STYLE_PROPS[key]);\n\t}\n\n\tthis.localizePoint = function (pt) {\n\t\tpt.x -= this.x + this.anchorX + this.offsetX;\n\t\tpt.y -= this.y + this.anchorY + this.offsetY;\n\t\tif (this.r) { pt.rotate(-this.r); }\n\t\tpt.scale(1 / this.scale);\n\t\tpt.x += this.anchorX;\n\t\tpt.y += this.anchorY;\n\t\treturn pt;\n\t}\n\n\tthis.copy = function () {\n\t\tvar copy = {};\n\t\tfor (var key in styleKeys) {\n\t\t\tcopy[key] = this[key];\n\t\t}\n\n\t\treturn copy;\n\t}\n\t\n\tthis.update = function (style) {\n\t\tfor (var i in style) {\n\t\t\tif (style.hasOwnProperty(i) && styleKeys.hasOwnProperty(i)) {\n\t\t\t\tthis[i] = style[i];\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n});\n","pre":true},"sdk/timestep/event/input/InputHandler.js":{"path":"sdk/timestep/event/input/InputHandler.js","friendlyPath":"event.input.InputHandler","directory":"sdk/timestep/event/input/","filename":"InputHandler.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.input.InputHandler;\n * An event handler proxy for an individual view. This handles dispatching\n * of events onto the actual view itself, as well as determining if the view\n * is the actual target of a propagated event. \n */\n\njsio(\"import math.geom.Point as Point\");\njsio(\"import event.input.dispatch as dispatch\");\n\nvar sdk_timestep_event_input_InputHandler=__class__;var InputHandler = exports=sdk_timestep_event_input_InputHandler(function sdk_timestep_event_input_InputHandler(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\t// ---- start mouseover\n\tthis.startCount = 0;\n\tthis.dragCount = 0;\n\tthis.overCount = 0;\n\tthis.canHandleEvents = true;\n\tthis.blockEvents = false;\n\n\tthis.init = function (view, opts) {\n\t\tthis.view = view;\n\n\t\tif ('canHandleEvents' in opts) {\n\t\t\tthis.canHandleEvents = opts.canHandleEvents;\n\t\t}\n\n\t\tif ('blockEvents' in opts) {\n\t\t\tthis.blockEvents = opts.blockEvents;\n\t\t}\n\t}\n\t\n\tthis.containsEvent = function (evt, localPt) {\n\t\t// block events must be false\n\t\treturn !this.blockEvents && (!this.view._superview   // top-view captures all events\n\t\t\t\t|| this.view.containsLocalPoint(localPt));\n\t}\n\n\tthis.onEnter = function (id, atTarget) {\n\t\tvar view = this.view;\n\t\tvar over = this._over || (this._over = {});\n\t\tif (id in over) { return; }\n\t\t\n\t\tover[id] = true;\n\t\tthis.overCount++;\n\t\t\n\t\tif (view.onInputOver) { view.onInputOver(over, this.overCount, atTarget); }\n\t\tview.publish('InputOver', over, this.overCount, atTarget);\n\t}\n\t\n\tthis.onLeave = function (id, atTarget) {\n\t\tvar view = this.view;\n\t\tvar over = this._over || (this._over = {});\n\t\tif (!(id in over)) { return; }\n\t\t\n\t\tdelete over[id];\n\t\t--this.overCount;\n\t\t\n\t\tif (view.onInputOut) { view.onInputOut(over, this.overCount, atTarget); }\n\t\tview.publish('InputOut', over, this.overCount, atTarget);\n\t}\n\t\n\tthis.resetOver = function () {\n\t\tdelete this._over;\n\t\tthis.overCount = 0;\n\t}\n\t\n\t// ---- end mouseover\n\t\n\t\n\t// ---- start drag\n\t\n\tthis.startDrag = function (opts) {\n\t\topts = opts || {};\n\t\tvar view = this.view;\n\t\tvar inputStartEvt = opts.inputStartEvt || opts.inputStartEvent || dispatch._evtHistory[dispatch.eventTypes.START];\n\t\tvar id = inputStartEvt.id;\n\t\t\n\t\t// dedup drags from same input ID\n\t\tvar dragging = this._isDragging || (this._isDragging = {});\n\t\tif (dragging[id]) { return; }\n\t\tdragging[id] = true;\n\t\t\n\t\t++this.dragCount;\n\t\t++this.startCount;\n\n\t\tvar root = inputStartEvt.root;\n\t\tvar dragEvt = new dispatch.InputEvent(inputStartEvt.id, 'input:drag', inputStartEvt.srcPt.x, inputStartEvt.srcPt.y, root, view);\n\t\t\n\t\tdragEvt.didDrag = false;\n\t\tdragEvt.radius = opts.radius * opts.radius || 0;\n\t\t\n\t\troot.subscribe('InputMoveCapture', this, 'onDragStart', dragEvt);\n\t\troot.subscribe('InputSelectCapture', this, 'onDragStop', dragEvt);\n\t}\n\t\n\tthis.isDragging = function () { return this.dragCount && dispatch._isDragging; }\n\t\n\tthis.onDragStart = function (dragEvt, moveEvt) {\n\t\t// have we exceeded the move radius?\n\t\tvar dx = moveEvt.srcPt.x - dragEvt.srcPt.x;\n\t\tvar dy = moveEvt.srcPt.y - dragEvt.srcPt.y;\n\t\tif (dx * dx + dy * dy <= dragEvt.radius) { return; }\n\n\t\tif (dragEvt.didDrag) {\n\t\t\treturn;\n\t\t}\n\t\tdragEvt.didDrag = true;\n\t\t--this.startCount;\n\t\t\n\t\tvar view = this.view;\n\t\t\n\t\t// no longer need to listen for move events for onDragStart\n\t\tif (this.startCount == 0) {\n\t\t\tdragEvt.root.unsubscribe('InputMoveCapture', this, 'onDragStart');\n\t\t}\n\t\t\n\t\t// want to fire onDragStart with the current point equal to the initial point \n\t\t// even though the user has moved away by now\n\t\tdragEvt.currPt = dragEvt.srcPt;\n\t\tdragEvt.localPt = view.localizePoint(new Point(dragEvt.currPt));\n\n\t\tif (view.onDragStart) { view.onDragStart(dragEvt); }\n\t\tview.publish('DragStart', dragEvt);\n\t\t\n\t\t// future move events should be captured by _onDrag\n\t\t// we should also call _onDrag now to handle the current move event delta\n\t\tdragEvt.root.subscribe('InputMoveCapture', this, 'onDrag', dragEvt);\n\t\tthis.onDrag(dragEvt, moveEvt);\n\t}\n\t\n\tthis.onDrag = function (dragEvt, moveEvt) {\n\t\tif (dragEvt.id != moveEvt.id\n\t\t\t\t|| moveEvt.srcPt.x == dragEvt.currPt.x && moveEvt.srcPt.y == dragEvt.currPt.y) { return; }\n\n\t\tvar view = this.view;\n\t\t\n\t\tdragEvt.prevPt = dragEvt.currPt;\n\t\tdragEvt.currPt = moveEvt.srcPt;\n\n\t\tdragEvt.prevLocalPt = dragEvt.localPt;\n\t\tdragEvt.localPt = view.localizePoint(new Point(dragEvt.currPt));\n\n\t\tvar delta = Point.subtract(dragEvt.localPt, dragEvt.prevLocalPt);\n\n\t\tdispatch._isDragging = true;\n\n\t\tif (view.onDrag) { view.onDrag(dragEvt, moveEvt, delta); }\n\t\tview.publish('Drag', dragEvt, moveEvt, delta);\n\t\t\n\t\t//moveEvt.cancel();\n\t}\n\t\n\tthis.onDragStop = function (dragEvt, selectEvt) {\n\t\tvar id = dragEvt.id;\n\t\tvar dragging = this._isDragging || (this._isDragging = {});\n\t\tif (!dragging[id] || dragEvt.id != selectEvt.id) { return; }\n\t\t\n\t\tdelete dragging[id];\n\t\t--this.dragCount;\n\n\t\tif (!this.dragCount) {\n\t\t\tdragEvt.root.unsubscribe('InputMoveCapture', this, 'onDragStart');\n\t\t\tdragEvt.root.unsubscribe('InputMoveCapture', this, 'onDrag');\n\t\t\tdragEvt.root.unsubscribe('InputSelectCapture', this, 'onDragStop');\n\t\t\tdispatch._isDragging = false;\n\t\t}\n\t\t\n\t\tif (dragEvt.didDrag) {\n\t\t\tvar view = this.view;\n\t\t\t\n\t\t\t// a subscription can later 'uncancel' the selectEvt by setting 'selectEvt.cancelled = false;'\n\t\t\tselectEvt.cancel();\n\t\t\t\n\t\t\tif (view.onDragStop) { view.onDragStop(dragEvt, selectEvt); }\n\t\t\tview.publish('DragStop', dragEvt, selectEvt);\n\t\t}\n\t}\n\t\n\t// ---- end drag\n});\n","pre":true},"sdk/timestep/animate.js":{"path":"sdk/timestep/animate.js","friendlyPath":"animate","directory":"sdk/timestep/","filename":"animate.js","baseMod":"animate","basePath":"sdk/timestep/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module animate\n * Import the DOM/Canvas implementation of animate. Also define the transition function aliases.\n *\n * @doc http://doc.gameclosure.com/api/animate.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/animate.md\n */\n\njsio(\"import ui.backend.canvas.animate as exports\");\n","pre":true},"sdk/timestep/ui/backend/canvas/animate.js":{"path":"sdk/timestep/ui/backend/canvas/animate.js","friendlyPath":"ui.backend.canvas.animate","directory":"sdk/timestep/ui/backend/canvas/","filename":"animate.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.animate;\n *\n * Canvas animate namespace and functions.\n */\n\njsio(\"import event.Emitter as Emitter\");\njsio(\"import animate.transitions as transitions\");\njsio(\"import timer\");\n\nvar anim_uid = 0;\n\nexports = function (subject, groupId) {\n\n\t// TODO: we have a circular import, so do the Engine import on first use\n\tif (typeof Engine == 'undefined') {\n\t\tjsio(\"import ui.Engine as Engine\");\n\t\tjsio(\"import ui.View as View\");\n\t}\n\n\tvar groupId = groupId || 0,\n\t\tgroup = groups[groupId] || (groups[groupId] = new Group()),\n\t\tanimID = subject.__anim_id || (subject.__anim_id = '__anim_' + (++anim_uid)),\n\t\tanim = group.get(animID);\n\n\tif (!anim) {\n\t\tanim = subject instanceof View\n\t\t\t\t? new ViewAnimator(subject, group)\n\t\t\t\t: new Animator(subject, group);\n\n\t\tgroup.add(animID, anim);\n\t}\n\n\treturn anim;\n}\n\nexports.getViewAnimator = function () {\n\treturn ViewAnimator;\n};\n\nexports.setViewAnimator = function (ctor) {\n\tViewAnimator = ctor;\n};\n\nGroup=__class__;var Group=Group(function Group(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function () {\n\t\tthis._anims = {};\n\t\tthis._pending = [];\n\t};\n\n\tthis.get = function (id) { return this._anims[id]; };\n\n\tthis.add = function (id, q) {\n\t\tthis._anims[id] = q;\n\t\tq.id = id;\n\t\treturn q;\n\t};\n\n\tthis.isActive = function () {\n\t\tfor (var id in this._anims) {\n\t\t\tif (this._anims[id].hasFrames()) { return true; }\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tthis.onAnimationFinish = function (anim) {\n\t\tdelete this._anims[anim.id];\n\n\t\tif (!this.isActive()) {\n\t\t\t// if called from a Finish event, republish it\n\t\t\tthis.publish('Finish');\n\t\t}\n\t};\n});\n\nvar groups = {\n\t0: new Group()\n};\n\nexports.getGroup = function (i) {\n\treturn groups[i || 0];\n};\n\nvar TRANSITIONS = [\n\ttransitions.easeInOut, // 0: default\n\ttransitions.linear,    // 1\n\ttransitions.easeIn,    // 2\n\ttransitions.easeOut,   // 3\n\ttransitions.easeInOut, // 4\n\ttransitions.bounce     // 5\n];\n\nexports.linear = 1;\nexports.easeIn = 2;\nexports.easeOut = 3;\nexports.easeInOut = 4;\nexports.bounce = 5;\n\nfunction getTransition(n) {\n\treturn (typeof n == 'function' ? n : TRANSITIONS[n | 0]);\n}\n\nFrame=__class__;var Frame=Frame(function Frame(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tthis.subject = opts.subject;\n\t\tthis.target = opts.target;\n\t\tthis.duration = opts.duration || 0;\n\t\tthis.transition = getTransition(opts.transition);\n\t\tthis.onTick = opts.onTick;\n\t};\n\n\tthis.exec = function () {};\n\tthis.onInterrupt = function () {};\n});\n\nCallbackFrame=__class__;var CallbackFrame=CallbackFrame(function CallbackFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n\tthis.exec = function (tt, t) {\n\t\tthis.target.apply(this.subject, arguments);\n\t};\n});\n\n// a wait frame is just a frame that does nothing... so we\n// don't need to do anything!\nvar WaitFrame = Frame;\n\nObjectFrame=__class__;var ObjectFrame=ObjectFrame(function ObjectFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n\tthis.exec = function (tt, t, debug) {\n\t\tif (!this.base) {\n\t\t\tthis.base = {};\n\t\t\tfor (var key in this.target) {\n\t\t\t\tthis.base[key] = this.subject[key];\n\t\t\t}\n\t\t}\n\n\t\tfor (var key in this.target) {\n\t\t\tthis.subject[key] = (this.target[key] - this.base[key]) * tt + this.base[key];\n\t\t}\n\n\t\tif (debug) {\n\t\t\tvar changed = {};\n\t\t\tfor (var key in this.target) {\n\t\t\t\tchanged[key] = this.subject[key] + ' -> ' + this.target[key];\n\t\t\t}\n\t\t\tlogger.log(this.duration, tt, JSON.stringify(changed));\n\t\t}\n\t};\n});\n\n// a ViewStyleFrame updates a view's style in exec\nViewStyleFrame=__class__;var ViewStyleFrame=ViewStyleFrame(function ViewStyleFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n\n\tthis._resolvedDeltas = false;\n\n\tthis.init = function (opts) {\n\t\tthis.subject = opts.subject;\n\t\tthis.target = merge({}, opts.target);\n\t\tthis.duration = opts.duration === 0 ? 0 : (opts.duration || 500);\n\t\tthis.transition = getTransition(opts && opts.transition);\n\t\tthis.onTick = opts.onTick;\n\t};\n\n\tthis.resolveDeltas = function (againstStyle) {\n\t\tvar style = this.target;\n\t\tthis._resolvedDeltas = true;\n\t\tfor (var key in style) {\n\t\t\tvar baseKey = key.substring(1);\n\t\t\tif (key.charAt(0) == 'd' && !(key in againstStyle) && (baseKey in againstStyle)) {\n\t\t\t\tstyle[baseKey] = style[key] + againstStyle[baseKey];\n\t\t\t\tdelete style[key];\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.exec = function (tt, t, debug) {\n\t\tvar oldStyle = this._baseStyle || (this._baseStyle = this.subject.style.copy()),\n\t\t\tnewStyle = this.target;\n\n\t\tif (!this._resolvedDeltas) { this.resolveDeltas(this._baseStyle); }\n\n\t\tvar oldStyle = this._baseStyle;\n\t\tfor (var key in newStyle) {\n\t\t\tif (key in oldStyle) {\n\t\t\t\tthis.subject.style[key] = (newStyle[key] - oldStyle[key]) * tt + oldStyle[key];\n\t\t\t}\n\t\t}\n\n\t\tthis.subject.needsRepaint();\n\n\t\tif (debug) {\n\t\t\tvar changed = {};\n\t\t\tfor (var key in newStyle) {\n\t\t\t\tchanged[key] = this.subject.style[key] + ' -> ' + newStyle[key];\n\t\t\t}\n\t\t\tlogger.log(timer.now, this.duration, tt, JSON.stringify(changed));\n\t\t}\n\t};\n\n\tthis.onInterrupt = function (newFrame) {\n\t\t// var preStyle = this.subject.style.copy();\n\n\t\t// You might want to resolve any deltas against the post-committed style.\n\t\t// But I think this should be off by default.  You can commit the style,\n\t\t// resolve your deltas, then restore the old style yourself if you want.\n\t\t// I don't think you _always_ want this to be the behavior?\n\t\t//\n\t\t// this.commit(true);\n\t\t// newFrame.resolveDeltas(this.subject.style);\n\n\t\t// If you're animating multiple properties, and you've only\n\t\t// interrupted some of them, you may want the rest to continue.\n\t\t// This only looks good if the timing is the same too -- to do\n\t\t// this properly, you'd have to branch animations based on the\n\t\t// style property being animated...\n\t\t//\n\t\t// for (var i in ViewStyle.keys) {\n\t\t// \tif (postCommitStyle[i] != preStyle[i] && !(i in newStyle)) {\n\t\t// \t\tnewStyle[i] = postCommitStyle[i];\n\t\t// \t}\n\t\t// }\n\n\t\t// this.subject.style.update(preStyle);\n\t};\n});\n\nexports.Animator=__class__;var Animator = exports.Animator=exports.Animator(function exports_Animator(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\tthis.init = function (subject, group) {\n\t\tthis.subject = subject;\n\t\tthis._group = group;\n\t\tthis.clear();\n\t\tthis._isPaused = false;\n\t};\n\n\tthis.clear = function () {\n\t\tthis._elapsed = 0;\n\t\tthis._queue = [];\n\t\tthis._unschedule();\n\t\treturn this;\n\t};\n\n\t// this.getQueue = function () { return this._queue; }\n\n\t// Careful: pause will *not* fire the finish event, so anything pending the end of the\n\t// animation will have to wait until the animation is resumed.\n\tthis.pause = function () {\n\t\tif (!this._isPaused) {\n\t\t\tthis._isPaused = true;\n\t\t\tthis._unschedule();\n\t\t}\n\t};\n\n\tthis.resume = function () {\n\t\tif (this._isPaused) {\n\t\t\tthis._isPaused = false;\n\t\t\tthis._schedule();\n\t\t}\n\t};\n\n\tthis._schedule = function () {\n\t\tif (!this._isScheduled) {\n\t\t\tthis._isScheduled = true;\n\t\t\tEngine.get().subscribe('Tick', this, 'onTick');\n\t\t}\n\t};\n\n\tthis._unschedule = function () {\n\t\tif (this._isScheduled) {\n\t\t\tthis._isScheduled = false;\n\t\t\tEngine.get().unsubscribe('Tick', this, 'onTick');\n\t\t}\n\t};\n\n\tthis.isPaused = function () { return this._isPaused; };\n\tthis.hasFrames = function () { return !!this._queue[0]; };\n\n\tthis.wait = function (duration) {\n\t\treturn this.then(new WaitFrame({duration: duration}));\n\t};\n\n\tthis.buildFrame = function (opts) {\n\t\tif (typeof opts.target == 'function') {\n\t\t\treturn new CallbackFrame(opts);\n\t\t}\n\n\t\tif (typeof opts.target == 'object') {\n\t\t\treturn new ObjectFrame(opts);\n\t\t}\n\n\t\treturn new WaitFrame(opts);\n\t};\n\n\tthis.now = function (target, duration, transition, onTick) {\n\t\ttransition = transition || (this._queue[0] ? exports.easeOut : exports.easeInOut);\n\n\t\tvar nextFrame = target instanceof Frame\n\t\t\t\t? target\n\t\t\t\t: this.buildFrame({\n\t\t\t\t\t\tsubject: this.subject,\n\t\t\t\t\t\ttarget: target,\n\t\t\t\t\t\tduration: duration,\n\t\t\t\t\t\ttransition: transition,\n\t\t\t\t\t\tonTick: onTick\n\t\t\t\t\t});\n\n\t\tvar frame = this._queue[0];\n\t\tframe && frame.onInterrupt(nextFrame);\n\n\t\tthis.clear();\n\t\treturn this.then(nextFrame);\n\t};\n\n\tthis.then = function (target, duration, transition, onTick) {\n\t\tvar nextFrame = target instanceof Frame\n\t\t\t\t? target\n\t\t\t\t: this.buildFrame({\n\t\t\t\t\t\tsubject: this.subject,\n\t\t\t\t\t\ttarget: target,\n\t\t\t\t\t\tduration: duration,\n\t\t\t\t\t\ttransition: transition,\n\t\t\t\t\t\tonTick: onTick\n\t\t\t\t\t});\n\n\t\tif (!this._queue.length) {\n\t\t\tthis._elapsed = 0;\n\t\t}\n\n\t\tthis._queue.push(nextFrame);\n\t\tthis._schedule();\n\t\treturn this;\n\t};\n\n\tthis.debug = function () { this._debug = true; return this; };\n\n\tthis.commit = function () {\n\t\tthis._elapsed = 0;\n\t\tfor (var i = 0, p; p = this._queue[i]; ++i) {\n\t\t\tthis._elapsed += p.duration;\n\t\t}\n\n\t\tthis.next();\n\t\treturn this;\n\t};\n\n\tthis.onTick = function (dt) {\n\t\tif (!this._isScheduled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._elapsed += dt;\n\t\tthis.next();\n\n\t\tif (!this._isScheduled) {\n\t\t\tthis._group.onAnimationFinish(this);\n\t\t}\n\t};\n\n\tthis.next = function () {\n\t\tvar p,\n\t\t\ttarget;\n\n\t\tif (!this._queue[0]) { return; }\n\n\t\twhile ((p = this._queue[0])) {\n\t\t\tvar frameFinished = this._elapsed >= p.duration,\n\t\t\t\tt = frameFinished ? 1 : this._elapsed / p.duration,\n\t\t\t\ttt = p.transition(t);\n\n\t\t\tif (frameFinished) {\n\t\t\t\tthis._elapsed -= p.duration;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tp.exec(tt, t, this._debug);\n\t\t\t\tif (p.onTick) { p.onTick.call(p.subject, tt, t); }\n\t\t\t} finally {\n\t\t\t\t// if we haven't modified the queue in a callback, remove the frame if it is finished\n\t\t\t\tif (frameFinished && p == this._queue[0]) {\n\t\t\t\t\tthis._queue.shift();\n\t\t\t\t}\n\n\t\t\t\t// if we got paused during a callback or the\n\t\t\t\t// frame is not finished yet, don't continue\n\t\t\t\tif (!frameFinished || this._isPaused) { return; }\n\t\t\t}\n\t\t}\n\n\t\t// nothing left in the queue!\n\t\tthis._unschedule();\n\t};\n});\n\nViewAnimator=__class__;var ViewAnimator=ViewAnimator(function ViewAnimator(){return this.init&&this.init.apply(this,arguments)},Animator, function (supr) {\n\tthis.buildFrame = function (opts) {\n\t\tif (typeof opts.target == 'object') {\n\t\t\treturn new ViewStyleFrame(opts);\n\t\t}\n\n\t\treturn supr(this, 'buildFrame', arguments);\n\t};\n});\n","pre":true},"sdk/timestep/animate/transitions.js":{"path":"sdk/timestep/animate/transitions.js","friendlyPath":"animate.transitions","directory":"sdk/timestep/animate/","filename":"transitions.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module animate.transitions\n *\n * Transition functions for use by the animate features. These aren't referenced\n * directly by the animate namespace, but by numerical reference.\n *\n * @doc http://doc.gameclosure.com/api/animate.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/animate.md\n */\n\nexports.linear = function (n) { return n; }\nexports.easeIn = function (n) { return n * n; }\nexports.easeInOut = function (n) { return (n *= 2) < 1 ? 0.5 * n * n * n : 0.5 * ((n -= 2) * n * n + 2); }\nexports.easeOut = function (n) { return n * (2 - n); }\n","pre":true},"sdk/timestep/ui/backend/debug/FPSView.js":{"path":"sdk/timestep/ui/backend/debug/FPSView.js","friendlyPath":"ui.backend.debug.FPSView","directory":"sdk/timestep/ui/backend/debug/","filename":"FPSView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.debug.FPSView;\n *\n * The view which renders the FPS when showFPS is set to true on the\n * Application options.\n *\n * TODO Move to debug package.\n */\n\njsio(\"import device\");\njsio(\"import lib.Enum as Enum\");\n\njsio(\"import math.geom.Rect as Rect\");\njsio(\"import math.geom.intersect as intersect\");\n\njsio(\"import event.input.dispatch as dispatch\");\n\nvar viewModes = new Enum('FPS', 'DT');\n\nfunction strokeRect(ctx, rect, color) {\n\tctx.fillStyle = color;\n\tctx.fillRect(rect.x, rect.y, 1, rect.height);\n\tctx.fillRect(rect.x, rect.y, rect.width, 1);\n\tctx.fillRect(rect.x + rect.width - 1, rect.y, 1, rect.height);\n\tctx.fillRect(rect.x, rect.y + rect.height - 1, rect.width, 1);\n};\n\nfunction fillRect(ctx, rect, color) {\n\tctx.fillStyle = color;\n\tctx.fillRect(rect.x, rect.y, rect.width, rect.height);\n};\n\nGraph=__class__;var Graph=Graph(function Graph(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tvar Canvas = device.get('Canvas');\n\n\t\tthis._width = opts.width;\n\t\tthis._height = opts.height;\n\n\t\tthis._maxValue = opts.maxValue;\n\t\tthis._backgroundColor = opts.backgroundColor;\n\t\tthis._colors = opts.colors;\n\t\tthis._axisColor = opts.axisColor;\n\n\t\tthis._canvas = new Canvas({width: opts.width, height: opts.height});\n\t\tthis._ctx = this._canvas.getContext('2d');\n\t\tthis._ctx.fillStyle = opts.backgroundColor;\n\t\tthis._ctx.fillRect(0, 0, opts.width, opts.height);\n\n\t\tthis._offset = 0;\n\t\tthis._index = 0;\n\t};\n\n\tthis.addValues = function (values, timeAxis) {\n\t\tvar ctx = this._ctx,\n\t\t\twidth = this._width,\n\t\t\theight = this._height,\n\t\t\tvalue,\n\t\t\tmaxValue = this._maxValue,\n\t\t\tx = (this._offset + this._index) % width,\n\t\t\ty = this._height,\n\t\t\tn,\n\t\t\ti, j;\n\n\t\tctx.fillStyle = this._backgroundColor;\n\t\tctx.fillRect(x, 0, 2, height);\n\n\t\ti = values.length;\n\t\twhile (i) {\n\t\t\tvalue = values[--i];\n\t\t\tif (value > maxValue) {\n\t\t\t\tvalue = maxValue;\n\t\t\t}\n\t\t\tn = ~~(value / maxValue *  height);\n\t\t\tctx.fillStyle = this._colors[i];\n\t\t\tctx.fillRect(x, height - n, 2, n);\n\t\t}\n\n\t\tctx.fillStyle = this._axisColor;\n\t\tif (timeAxis) {\n\t\t\tctx.fillRect(x, 0, 1, height);\n\t\t}\n\t\tctx.fillRect(x, 25, 2, 1);\n\t\tctx.fillRect(x, 50, 2, 1);\n\t\tctx.fillRect(x, 75, 2, 1);\n\n\t\tif (this._index < width) {\n\t\t\tthis._index += 2;\n\t\t} else {\n\t\t\tthis._offset += 2;\n\t\t\tif (this._offset >= width) {\n\t\t\t\tthis._offset = 0;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.render = function (ctx, x, y) {\n\t\tvar offset = this._offset,\n\t\t\twidth = this._width,\n\t\t\theight = this._height;\n\n\t\tif (offset === 0) {\n\t\t\tctx.drawImage(this._canvas, 0, 0, width, height, x, y, width, height);\n\t\t} else {\n\t\t\tctx.drawImage(this._canvas, offset, 0, width - offset, height, x, y, width - offset, height);\n\t\t\tctx.drawImage(this._canvas, 0, 0, offset, height, width - offset + x, y, offset, height);\n\t\t}\n\t};\n});\n\nvar sdk_timestep_ui_backend_debug_FPSView=__class__;exports=sdk_timestep_ui_backend_debug_FPSView(function sdk_timestep_ui_backend_debug_FPSView(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tthis._application = opts.application;\n\n\t\tthis._time = +(new Date()) + 1000;\n\t\tthis._frames = 0;\n\t\tthis._fps = 20;\n\t\tthis._dt = 10;\n\n\t\tthis._minimized = true;\n\n\t\tvar width = 200,\n\t\t\theight = 100;\n\n\t\tthis._rectTop = new Rect(1, 1, width, 16);\n\t\tthis._rectMin = new Rect(0, 0, 24, 15);\n\t\tthis._rectMax = new Rect(0, 0, width + 2, height + 17);\n\t\tthis._rect = this._rectMin;\n\n\t\tthis._rectFPS = new Rect(141, 1, 30, 15);\n\t\tthis._rectDT = new Rect(171, 1, 30, 15);\n\n\t\tthis._borderColor = 'rgb(100,100,150)';\n\t\tthis._backgroundColor = '#17182E';\n\t\tthis._textColor = '#FFFFFF';\n\n\t\tthis._viewMode = viewModes.DT;\n\n\t\tthis._graphs = {}\n\t\tthis._graphs[viewModes.FPS] = new Graph({\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tmaxValue: 60,\n\t\t\tbackgroundColor: this._backgroundColor,\n\t\t\tcolors: ['rgba(170,170,252,0.3)', 'rgb(170,170,252)'],\n\t\t\taxisColor: '#FFFFFF'\n\t\t});\n\t\tthis._graphs[viewModes.DT] = new Graph({\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tmaxValue: 66,\n\t\t\tbackgroundColor: this._backgroundColor,\n\t\t\tcolors: ['rgba(255,0,0,0.5)', 'rgb(254,255,170)'],\n\t\t\taxisColor: '#FFFFFF'\n\t\t});\n\t};\n\n\tthis.tick = function (dt) {\n\t\tvar time = +(new Date());\n\t\tif (time > this._time) {\n\t\t\tthis._time = time + 1000;\n\t\t\tthis._fps = this._frames;\n\t\t\tthis._frames = 1;\n\t\t} else {\n\t\t\tthis._frames++;\n\t\t}\n\n\t\tvar events = this._application.getEvents();\n\t\tif (events.length) {\n\t\t\tthis._handleEvents(events);\n\t\t}\n\n\t\tthis._dt = this._dt * 0.8 + dt * 0.2;\n\n\t\tif (!this._minimized) {\n\t\t\tswitch (this._viewMode) {\n\t\t\t\tcase viewModes.DT:\n\t\t\t\t\tthis._graphs[viewModes.DT].addValues([this._dt, dt], (this._frames === 1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase viewModes.FPS:\n\t\t\t\t\tthis._graphs[viewModes.FPS].addValues([this._fps, 1000 / dt], (this._frames === 1));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._handleEvents = function (events) {\n\t\tvar types = dispatch.eventTypes;\n\t\tvar i = events.length;\n\n\t\twhile (i) {\n\t\t\tvar event = events[--i];\n\t\t\tswitch (event.type) {\n\t\t\t\tcase types.START:\n\t\t\t\t\tif (intersect.ptAndRect(event.srcPt, this._rect)) {\n\t\t\t\t\t\tif (this._minimized) {\n\t\t\t\t\t\t\tthis._minimized = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (intersect.ptAndRect(event.srcPt, this._rectFPS)) {\n\t\t\t\t\t\t\t\tthis._viewMode = viewModes.FPS;\n\t\t\t\t\t\t\t} else if (intersect.ptAndRect(event.srcPt, this._rectDT)) {\n\t\t\t\t\t\t\t\tthis._viewMode = viewModes.DT;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis._minimized = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._rect = this._minimized ? this._rectMin : this._rectMax;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.render = function (ctx) {\n\t\tctx.save();\n\n\t\tctx.textBaseline = 'top';\n\t\tctx.textAlign = 'center';\n\t\tctx.font = '12px Verdana';\n\n\t\tif (this._minimized) {\n\t\t\tfillRect(ctx, this._rect, this._backgroundColor);\n\t\t} else {\n\t\t\tfillRect(ctx, this._rectTop, this._backgroundColor);\n\t\t\tthis._graphs[this._viewMode].render(ctx, 1, 17);\n\t\t\tctx.fillStyle = this._borderColor;\n\t\t\tctx.fillRect(0, 16, this._rect.width, 1);\n\n\t\t\tvar fpsMode = (this._viewMode === viewModes.FPS),\n\t\t\t\tdtMode = (this._viewMode === viewModes.DT);\n\n\t\t\tfillRect(ctx, this._rectFPS, fpsMode ? this._borderColor : this._backgroundColor);\n\t\t\tctx.fillStyle = fpsMode ? this._textColor : this._borderColor;\n\t\t\tctx.fillText('FPS', this._rectFPS.x + this._rectFPS.width / 2, 0);\n\n\t\t\tfillRect(ctx, this._rectDT, dtMode ? this._borderColor : this._backgroundColor);\n\t\t\tctx.fillStyle = dtMode ? this._textColor : this._borderColor;\n\t\t\tctx.fillText('DT', this._rectDT.x + this._rectDT.width / 2, 0);\n\t\t}\n\n\t\tstrokeRect(ctx, this._rect, this._borderColor);\n\n\t\tctx.fillStyle = this._textColor;\n\t\tctx.fillText(this._fps, 12, 0);\n\n\t\tctx.restore();\n\t};\n\n\tthis.getFPS = function () {\n\t\treturn this._fps;\n\t};\n});\n","pre":true},"sdk/timestep/platforms/browser/FontBuffer.js":{"path":"sdk/timestep/platforms/browser/FontBuffer.js","friendlyPath":".FontBuffer","directory":"sdk/timestep/platforms/browser/","filename":"FontBuffer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package env.browser.FontBuffer;\n *\n * ??? What the hell is this\n */\n\njsio(\"import device\");\n\nvar randomColorElement = function () {\n\tvar e = Math.floor(Math.random() * 255).toString(16);\n\treturn ((e.length === 1) ? '0' : '') + e;\n};\n\nvar randomColor = function () {\n\treturn '#' + randomColorElement() + randomColorElement() + randomColorElement();\n};\n\nvar sdk_timestep_platforms_browser_FontBuffer=__class__;var FontBuffer = exports=sdk_timestep_platforms_browser_FontBuffer(function sdk_timestep_platforms_browser_FontBuffer(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\t// 8 * 24\n\t\t// 10 * 32\n\t\t// 8 * 64\n\t\tvar lineSizes = [{size: 24, count: 8}, {size: 32, count: 10}, {size: 64, count: 8}],\n\t\t\tlineSize,\n\t\t\tlines,\n\t\t\titem,\n\t\t\ty = 0,\n\t\t\ti, j;\n\n\t\tthis._canvas = document.createElement('canvas');\n\t\tthis._canvas.width = 1024;\n\t\tthis._canvas.height = 1024;\n\t\tthis._ctx = this._canvas.getContext('2d');\n\n\t\tthis._list = [];\n\t\tfor (i = 0; i < lineSizes.length; i++) {\n\t\t\tlines = [];\n\t\t\tlineSize = lineSizes[i];\n\n\t\t\tfor (j = 0; j < lineSize.count; j++) {\n\t\t\t\titem = {\n\t\t\t\t\tprevious: null,\n\t\t\t\t\tnext: null,\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: 1024,\n\t\t\t\t\theight: 0,\n\t\t\t\t\thash: null,\n\t\t\t\t\tframe: 0,\n\t\t\t\t\trefresh: true,\n\t\t\t\t\tctx: this._ctx\n\t\t\t\t};\n\t\t\t\tlines.push(item);\n\t\t\t\ty += lineSize.size;\n\t\t\t}\n\n\t\t\tthis._list.push({\n\t\t\t\tsize: lineSize.size,\n\t\t\t\tlines: lines\n\t\t\t});\n\t\t}\n\n\t\tthis._hashMap = {};\n\n\t\tthis._currentFrame = 0;\n\t\tthis._frameTimeout = 3;\n\n\t\tjsio('import ui.Engine').get().subscribe('Tick', this, this._onTick);\n\t};\n\n\tthis._onTick = function (dt) {\n\t\tthis._currentFrame++;\n\n\t\tvar remove,\n\t\t\tcurrentFrame = this._currentFrame,\n\t\t\tframeTimeout = this._frameTimeout,\n\t\t\tlist = this._list,\n\t\t\tlines,\n\t\t\titem,\n\t\t\ti, j, k, l;\n\n\t\tfor (i = 0, j = list.length; i < j; i++) {\n\t\t\tlines = list[i].lines;\n\t\t\tfor (k = 0, l = lines.length; k < l; k++) {\n\t\t\t\titem = lines[k];\n\t\t\t\twhile (item) {\n\t\t\t\t\tif (item.hash === null) {\n\t\t\t\t\t\tif (item.next && (item.next.hash === null)) {\n\t\t\t\t\t\t\titem.width += item.next.width;\n\t\t\t\t\t\t\titem.next = item.next.next;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (currentFrame > item.frame + frameTimeout) {\n\t\t\t\t\t\tthis._ctx.fillStyle = randomColor();\n\t\t\t\t\t\tthis._ctx.fillRect(item.x, item.y, item.width, item.height);\n\t\t\t\t\t\t// Remove old item...\n\t\t\t\t\t\tdelete(this._hashMap[item.hash]);\n\t\t\t\t\t\titem.hash = null;\n\t\t\t\t\t}\n\t\t\t\t\titem = item.next;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.alloc = function (opts) {\n\t\tvar requestHeight = opts.height,\n\t\t\trequestWidth = opts.width + 3, // Add some extra pixels to allow color bleeding...\n\n\t\t\tstrokeStyle = opts.strokeStyle || '',\n\t\t\tfillStyle = opts.fillStyle || '',\n\t\t\tfont = opts.font || '',\n\t\t\thash = strokeStyle + '_' + fillStyle + '_' + font + '_' + opts.text,\n\n\t\t\tlist = this._list,\n\t\t\tlines,\n\t\t\titem = this._hashMap[hash],\n\t\t\ti, j, k, l;\n\n\t\tif (item) {\n\t\t\titem.frame = this._currentFrame;\n\t\t\titem.refresh = false;\n\t\t\treturn item;\n\t\t}\n\n\t\tfor (i = 0, j = list.length; i < j; i++) {\n\t\t\tif (requestHeight <= list[i].size) {\n\t\t\t\tlines = list[i].lines;\n\t\t\t\tfor (k = 0, l = lines.length; k < l; k++) {\n\t\t\t\t\titem = lines[k];\n\t\t\t\t\twhile (item) {\n\t\t\t\t\t\tif ((requestWidth <= item.width) && (item.hash === null)) {\n\t\t\t\t\t\t\tif (requestWidth !== item.width) {\n\t\t\t\t\t\t\t\t//console.log('request:', requestWidth, 'width:', item.width, 'rest:', item.width - requestWidth);\n\t\t\t\t\t\t\t\titem.next = {\n\t\t\t\t\t\t\t\t\tprevious: item,\n\t\t\t\t\t\t\t\t\tnext: item.next,\n\t\t\t\t\t\t\t\t\tx: item.x + requestWidth,\n\t\t\t\t\t\t\t\t\ty: item.y,\n\t\t\t\t\t\t\t\t\twidth: item.width - requestWidth,\n\t\t\t\t\t\t\t\t\thash: null,\n\t\t\t\t\t\t\t\t\tframe: 0,\n\t\t\t\t\t\t\t\t\tctx: this._ctx\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\titem.frame = this._currentFrame;\n\t\t\t\t\t\t\titem.hash = hash;\n\t\t\t\t\t\t\titem.width = requestWidth;\n\t\t\t\t\t\t\titem.height = requestHeight;\n\t\t\t\t\t\t\titem.refresh = true;\n\n\t\t\t\t\t\t\tthis._ctx.clearRect(item.x, item.y, requestWidth, requestHeight);\n\n\t\t\t\t\t\t\tthis._hashMap[hash] = item;\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t\titem = item.next;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tthis.getCanvas = function () {\n\t\treturn this._canvas;\n\t};\n});\n","pre":true},"sdk/timestep/platforms/browser/dev_error.js":{"path":"sdk/timestep/platforms/browser/dev_error.js","friendlyPath":".dev_error","directory":"sdk/timestep/platforms/browser/","filename":"dev_error.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.dev_error;\n *\n * Displays a developer error.\n *\n * ??? TODO move to a debug package.\n */\n\nexports.render = function (e) {\n\tlogger.error(\"unhandled tick exception\");\n\tlogger.error(e.stack);\n\t\n\tvar c = document.getElementsByTagName('canvas');\n\tfor (var i = 0, el; el = c[i]; ++i) {\n\t\trender(el.getContext('2d'), e);\n\t}\n}\n\nfunction render(ctx, e) {\n\tctx.fillStyle = \"rgb(0, 0, 255)\";\n\tctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\n\tvar x = 30, y = 40;\n\n\tctx.fillStyle = \"#FFF\";\n\tctx.font = \"bold 12px Monaco,\\\"Bitstream Vera Sans Mono\\\",\\\"Lucida Console\\\",Terminal,monospace\";\n\tfunction drawLine(msg) {\n\t\tctx.fillText(msg, x, y);\n\t\ty += 20;\n\t}\n\t\n\tdrawLine(e.message);\n\ty += 40;\n\te.stack.split('\\n').map(drawLine);\n}\n","pre":true},"sdk/timestep/platforms/browser/FlashAPI.js":{"path":"sdk/timestep/platforms/browser/FlashAPI.js","friendlyPath":".FlashAPI","directory":"sdk/timestep/platforms/browser/","filename":"FlashAPI.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\"use import\";\n\njsio(\"import lib.PubSub\");\njsio(\"import .SoundManager\");\njsio(\"from util.underscore import _\");\n\nvar soundManager = new SoundManager();\nsoundManager.url = 'media/swf';\nsoundManager.flashVersion = 9;\nsoundManager.useMovieStar = true;\nsoundManager.debugMode = false;\nsoundManager.consoleOnly = true;\nsoundManager.useHighPerformance = true;\nsoundManager.useFastPolling = true;\n\n/**\n * @extends lib.PubSub\n */\nvar sdk_timestep_platforms_browser_FlashAPI=__class__;var AudioAPI = exports=sdk_timestep_platforms_browser_FlashAPI(function sdk_timestep_platforms_browser_FlashAPI(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\tthis.init = function (opts) {\n\n\t\topts = merge(opts, {\n\t\t\tmap: {},\n\t\t\tbackground: []\n\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\t\tvar path = opts.path;\n\t\tthis._map = {};\n\n\t\t_.each(opts.background, function (name) {\n\t\t\topts.map[name] = {'name': name}\n\t\t}, this);\n\t\t\n\t\tsoundManager.onready(bind(this, function () {\n\t\t\tlogger.log('SoundManager onReady');\n\t\t\tfor (key in opts.map) {\n\t\t\t\tlogger.log('SoundManager key: ', key);\n\t\t\t\tvar url = 'media/audio/'  + key + '.mp3';\n\t\t\t\tvar k = this._map[key] = soundManager.createSound({\n\t\t\t\t\tid: key,\n\t\t\t\t\tbufferTime: 3,\n\t\t\t\t\turl: url\n\t\t\t\t});\n\t\t\t\tk.load();\n\t\t\t}\n\n\t\t\tthis.publish('Ready');\n\t\t}));\n\t}\n\t\n\tthis.canPlay = function (name) {\n\t\treturn (name in this._map);\n\t}\n\t\n\tthis.setVolume = function (volume) {\n\t\tthis._soundPlaying && soundManager.setVolume(this._soundPlaying, volume);\n\t\tthis._backgroundSoundPlaying && soundManager.setVolume(this._backgroundSoundPlaying, volume);\n\t}\n\n\tthis.setMuted = function (muted) {\n\t\tthis.muted = muted;\n\t\tif (muted) {\n\t\t\tthis.setVolume(0);\n\t\t}\n\t}\n\n\tthis.play = function (name, volume, channel) {\n\t\tif (!this.canPlay(name)) { return; }\n\t\tif (this.muted) { return; }\n\t\tif (volume === undefined) {\n\t\t\tvolume = 1.0;\n\t\t}\n\t\tthis._soundPlaying = name;\n\t\tthis._map[name].setVolume(volume * 100 | 0);\n\t\tthis._map[name].play();\n\t}\n\n\tthis.pause = function () {\n\t\tthis._map[this._soundPlaying].pause();\n\t\tthis._soundPlaying = null;\n\t}\n\n\tthis.playBackgroundMusic = function (name, volume) {\n\t\tif (!this.canPlay(name)) { return; }\n\t\tif (this.muted) { return; }\n\t\tif (volume === undefined) {\n\t\t\tvolume = 1.0;\n\t\t}\n\t\tthis._backgroundSoundPlaying = name;\n\t\tthis._map[name].setVolume(volume * 100 | 0);\n\t\tthis._map[name].play();\n\t}\n\n\tthis.pauseBackgroundMusic = function () {\n\t\tif (!this._backgroundSoundPlaying) { return; }\n\t\tthis._map[this._backgroundSoundPlaying].pause();\n\t\tthis._backgroundSoundPlaying = null;\n\t}\n});\n","pre":true},"sdk/timestep/platforms/browser/SoundManager.js":{"path":"sdk/timestep/platforms/browser/SoundManager.js","friendlyPath":".SoundManager","directory":"sdk/timestep/platforms/browser/","filename":"SoundManager.js","src":"/*\r\n * @license\r\n * SoundManager 2: JavaScript Sound for the Web\r\n * ----------------------------------------------\r\n * http://schillmania.com/projects/soundmanager2/\r\n *\r\n * Copyright (c) 2007, Scott Schiller. All rights reserved.\r\n * Code provided under the BSD License:\r\n * http://schillmania.com/projects/soundmanager2/license.txt\r\n *\r\n * V2.97a.20110801\r\n*/\r\n\r\n/*global window, SM2_DEFER, sm2Debugger, console, document, navigator, setTimeout, setInterval, clearInterval, Audio */\r\n/*jslint regexp: true, sloppy: true, white: true, nomen: true, plusplus: true */\r\n\r\nvar SoundManager = exports = function SoundManager(smURL, smID) {\r\n\r\n  this.flashVersion = 8;             // version of flash to require, either 8 or 9. Some API features require Flash 9.\r\n  this.debugMode = true;             // enable debugging output (div#soundmanager-debug, OR console if available+configured)\r\n  this.debugFlash = false;           // enable debugging output inside SWF, troubleshoot Flash/browser issues\r\n  this.useConsole = true;            // use firebug/safari console.log()-type debug console if available\r\n  this.consoleOnly = false;          // if console is being used, do not create/write to #soundmanager-debug\r\n  this.waitForWindowLoad = false;    // force SM2 to wait for window.onload() before trying to call soundManager.onload()\r\n  this.nullURL = 'about:blank';      // path to \"null\" (empty) MP3 file, used to unload sounds (Flash 8 only)\r\n  this.allowPolling = true;          // allow flash to poll for status update (required for whileplaying() events, peak, sound spectrum functions to work.)\r\n  this.useFastPolling = false;       // uses lower flash timer interval for higher callback frequency, best combined with useHighPerformance\r\n  this.useMovieStar = true;          // enable support for Flash 9.0r115+ (codename \"MovieStar\") MPEG4 audio formats (AAC, M4V, FLV, MOV etc.)\r\n  this.bgColor = '#ffffff';          // movie (.swf) background color, eg. '#000000'\r\n  this.useHighPerformance = false;   // position:fixed flash movie can help increase js/flash speed, minimize lag\r\n  this.flashPollingInterval = null;  // msec for polling interval. Defaults to 50 unless useFastPolling = true.\r\n  this.flashLoadTimeout = 1000;      // msec to wait for flash movie to load before failing (0 = infinity)\r\n  this.wmode = null;                 // string: flash rendering mode - null, transparent, opaque (last two allow layering of HTML on top)\r\n  this.allowScriptAccess = 'always'; // for scripting the SWF (object/embed property), either 'always' or 'sameDomain'\r\n  this.useFlashBlock = false;        // *requires flashblock.css, see demos* - allow recovery from flash blockers. Wait indefinitely and apply timeout CSS to SWF, if applicable.\r\n  this.useHTML5Audio = true;         // Beta feature: Use HTML5 Audio() where API is supported (most Safari, Chrome versions), Firefox (no MP3/MP4.) Ideally, transparent vs. Flash API where possible.\r\n  this.html5Test = /^(probably|maybe)$/i; // HTML5 Audio() format support test. Use /^probably$/i; if you want to be more conservative.\r\n  this.preferFlash = true;           // (experimental) if true and flash support present, will try to use flash for MP3/MP4 as needed since HTML5 audio support is still quirky in browsers.\r\n\r\n  this.audioFormats = {\r\n    /*\r\n     * determines HTML5 support + flash requirements.\r\n     * if no support for a \"required\" format, SM2 will fail to start.\r\n     * flash fallback is used for MP3 or MP4 if HTML5 can't play it (or if preferFlash = true)\r\n     * multiple MIME types may be tested while trying to get a positive canPlayType() response.\r\n    */\r\n    'mp3': {\r\n      'type': ['audio/mpeg; codecs=\"mp3\"', 'audio/mpeg', 'audio/mp3', 'audio/MPA', 'audio/mpa-robust'],\r\n      'required': true\r\n    },\r\n    'mp4': {\r\n      'related': ['aac','m4a'], // additional formats under the MP4 container\r\n      'type': ['audio/mp4; codecs=\"mp4a.40.2\"', 'audio/aac', 'audio/x-m4a', 'audio/MP4A-LATM', 'audio/mpeg4-generic'],\r\n      'required': false\r\n    },\r\n    'ogg': {\r\n      'type': ['audio/ogg; codecs=vorbis'],\r\n      'required': false\r\n    },\r\n    'wav': {\r\n      'type': ['audio/wav; codecs=\"1\"', 'audio/wav', 'audio/wave', 'audio/x-wav'],\r\n      'required': false\r\n    }\r\n  };\r\n\r\n  this.defaultOptions = {\r\n    'autoLoad': false,             // enable automatic loading (otherwise .load() will be called on demand with .play(), the latter being nicer on bandwidth - if you want to .load yourself, you also can)\r\n    'stream': true,                // allows playing before entire file has loaded (recommended)\r\n    'autoPlay': false,             // enable playing of file as soon as possible (much faster if \"stream\" is true)\r\n    'loops': 1,                    // how many times to repeat the sound (position will wrap around to 0, setPosition() will break out of loop when >0)\r\n    'onid3': null,                 // callback function for \"ID3 data is added/available\"\r\n    'onload': null,                // callback function for \"load finished\"\r\n    'whileloading': null,          // callback function for \"download progress update\" (X of Y bytes received)\r\n    'onplay': null,                // callback for \"play\" start\r\n    'onpause': null,               // callback for \"pause\"\r\n    'onresume': null,              // callback for \"resume\" (pause toggle)\r\n    'whileplaying': null,          // callback during play (position update)\r\n    'onstop': null,                // callback for \"user stop\"\r\n    'onfailure': null,             // callback function for when playing fails\r\n    'onfinish': null,              // callback function for \"sound finished playing\"\r\n    'onbeforefinish': null,        // callback for \"before sound finished playing (at [time])\"\r\n    'onbeforefinishtime': 5000,    // offset (milliseconds) before end of sound to trigger beforefinish (eg. 1000 msec = 1 second)\r\n    'onbeforefinishcomplete': null,// function to call when said sound finishes playing\r\n    'onjustbeforefinish': null,    // callback for [n] msec before end of current sound\r\n    'onjustbeforefinishtime': 200, // [n] - if not using, set to 0 (or null handler) and event will not fire.\r\n    'multiShot': true,             // let sounds \"restart\" or layer on top of each other when played multiple times, rather than one-shot/one at a time\r\n    'multiShotEvents': false,      // fire multiple sound events (currently onfinish() only) when multiShot is enabled\r\n    'position': null,              // offset (milliseconds) to seek to within loaded sound data.\r\n    'pan': 0,                      // \"pan\" settings, left-to-right, -100 to 100\r\n    'type': null,                  // MIME-like hint for file pattern / canPlay() tests, eg. audio/mp3\r\n    'usePolicyFile': false,        // enable crossdomain.xml request for audio on remote domains (for ID3/waveform access)\r\n    'volume': 100                  // self-explanatory. 0-100, the latter being the max.\r\n  };\r\n\r\n  this.flash9Options = {      // flash 9-only options, merged into defaultOptions if flash 9 is being used\r\n    'isMovieStar': null,      // \"MovieStar\" MPEG4 audio mode. Null (default) = auto detect MP4, AAC etc. based on URL. true = force on, ignore URL\r\n    'usePeakData': false,     // enable left/right channel peak (level) data\r\n    'useWaveformData': false, // enable sound spectrum (raw waveform data) - WARNING: CPU-INTENSIVE: may set CPUs on fire.\r\n    'useEQData': false,       // enable sound EQ (frequency spectrum data) - WARNING: Also CPU-intensive.\r\n    'onbufferchange': null,   // callback for \"isBuffering\" property change\r\n    'ondataerror': null       // callback for waveform/eq data access error (flash playing audio in other tabs/domains)\r\n  };\r\n\r\n  this.movieStarOptions = { // flash 9.0r115+ MPEG4 audio options, merged into defaultOptions if flash 9+movieStar mode is enabled\r\n    'bufferTime': 3,        // seconds of data to buffer before playback begins (null = flash default of 0.1 seconds - if AAC playback is gappy, try increasing.)\r\n    'serverURL': null,      // rtmp: FMS or FMIS server to connect to, required when requesting media via RTMP or one of its variants\r\n    'onconnect': null,      // rtmp: callback for connection to flash media server\r\n    'duration': null        // rtmp: song duration (msec)\r\n  };\r\n\r\n  this.version = null;\r\n  this.versionNumber = 'V2.97a.20110801';\r\n  this.movieURL = null;\r\n  this.url = (smURL || null);\r\n  this.altURL = null;\r\n  this.swfLoaded = false;\r\n  this.enabled = false;\r\n  this.o = null;\r\n  this.movieID = 'sm2-container';\r\n  this.id = (smID || 'sm2movie');\r\n  this.swfCSS = {\r\n    'swfBox': 'sm2-object-box',\r\n    'swfDefault': 'movieContainer',\r\n    'swfError': 'swf_error', // SWF loaded, but SM2 couldn't start (other error)\r\n    'swfTimedout': 'swf_timedout',\r\n    'swfLoaded': 'swf_loaded',\r\n    'swfUnblocked': 'swf_unblocked', // or loaded OK\r\n    'sm2Debug': 'sm2_debug',\r\n    'highPerf': 'high_performance',\r\n    'flashDebug': 'flash_debug'\r\n  };\r\n  this.oMC = null;\r\n  this.sounds = {};\r\n  this.soundIDs = [];\r\n  this.muted = false;\r\n  this.debugID = 'soundmanager-debug';\r\n  this.debugURLParam = /([#?&])debug=1/i;\r\n  this.specialWmodeCase = false;\r\n  this.didFlashBlock = false;\r\n\r\n  this.filePattern = null;\r\n  this.filePatterns = {\r\n    'flash8': /\\.mp3(\\?.*)?$/i,\r\n    'flash9': /\\.mp3(\\?.*)?$/i\r\n  };\r\n\r\n  this.baseMimeTypes = /^\\s*audio\\/(?:x-)?(?:mp(?:eg|3))\\s*(?:$|;)/i; // mp3\r\n  this.netStreamMimeTypes = /^\\s*audio\\/(?:x-)?(?:mp(?:eg|3))\\s*(?:$|;)/i; // mp3, mp4, aac etc.\r\n  this.netStreamTypes = ['aac', 'flv', 'mov', 'mp4', 'm4v', 'f4v', 'm4a', 'mp4v', '3gp', '3g2']; // Flash v9.0r115+ \"moviestar\" formats\r\n  this.netStreamPattern = new RegExp('\\\\.(' + this.netStreamTypes.join('|') + ')(\\\\?.*)?$', 'i');\r\n  this.mimePattern = this.baseMimeTypes;\r\n\r\n  this.features = {\r\n    'buffering': false,\r\n    'peakData': false,\r\n    'waveformData': false,\r\n    'eqData': false,\r\n    'movieStar': false\r\n  };\r\n\r\n  this.sandbox = {\r\n    // <d>\r\n    'type': null,\r\n    'types': {\r\n      'remote': 'remote (domain-based) rules',\r\n      'localWithFile': 'local with file access (no internet access)',\r\n      'localWithNetwork': 'local with network (internet access only, no local access)',\r\n      'localTrusted': 'local, trusted (local+internet access)'\r\n    },\r\n    'description': null,\r\n    'noRemote': null,\r\n    'noLocal': null\r\n    // </d>\r\n  };\r\n\r\n  this.hasHTML5 = (typeof Audio !== 'undefined' && typeof new Audio().canPlayType !== 'undefined'); // switch for handling logic\r\n\r\n  // stores canPlayType() results, etc. treat as read-only.\r\n  this.html5 = {\r\n    // mp3: boolean\r\n    // mp4: boolean\r\n    'usingFlash': null // set if/when flash fallback is needed\r\n  };\r\n\r\n  // format support\r\n  this.flash = {\r\n    // mp3: boolean\r\n    // mp4: boolean\r\n  };\r\n\r\n  this.html5Only = false;   // determined at init time\r\n  this.ignoreFlash = false; // used for special cases (eg. iPad/iPhone/palm OS?)\r\n\r\n  /*\r\n   * a few private internals\r\n  */\r\n\r\n  var SMSound,\r\n  _s = this, _sm = 'soundManager', _smc = _sm+'::', _h5 = 'HTML5::', _id, _ua = navigator.userAgent, _win = window, _wl = _win.location.href.toString(), _fV = this.flashVersion, _doc = document, _doNothing, _init, _on_queue = [], _debugOpen = true, _debugTS, _didAppend = false, _appendSuccess = false, _didInit = false, _disabled = false, _windowLoaded = false, _wDS, _wdCount = 0, _initComplete, _mixin, _addOnEvent, _processOnEvents, _initUserOnload, _delayWaitForEI, _waitForEI, _setVersionInfo, _handleFocus, _strings, _initMovie, _dcLoaded, _didDCLoaded, _getDocument, _createMovie, _catchError, _setPolling, _initDebug, _debugLevels = ['log', 'info', 'warn', 'error'], _defaultFlashVersion = 8, _disableObject, _failSafely, _normalizeMovieURL, _oRemoved = null, _oRemovedHTML = null, _str, _flashBlockHandler, _getSWFCSS, _toggleDebug, _loopFix, _policyFix, _complain, _idCheck, _waitingForEI = false, _initPending = false, _smTimer, _onTimer, _startTimer, _stopTimer, _needsFlash = null, _featureCheck, _html5OK, _html5CanPlay, _html5Ext,  _dcIE, _testHTML5, _event, _slice = Array.prototype.slice, _useGlobalHTML5Audio = false, _hasFlash, _detectFlash, _badSafariFix, _html5_events, _showSupport,\r\n  _is_iDevice = _ua.match(/(ipad|iphone|ipod)/i), _likesHTML5 = (_ua.match(/(mobile|pre\\/|xoom)/i) || _is_iDevice), _isIE = _ua.match(/msie/i), _isWebkit = _ua.match(/webkit/i), _isSafari = (_ua.match(/safari/i) && !_ua.match(/chrome/i)), _isOpera = (_ua.match(/opera/i)), \r\n  _isBadSafari = (!_wl.match(/usehtml5audio/i) && !_wl.match(/sm2\\-ignorebadua/i) && _isSafari && _ua.match(/OS X 10_6_([3-7])/i)), // Safari 4 and 5 occasionally fail to load/play HTML5 audio on Snow Leopard 10.6.3 through 10.6.7 due to bug(s) in QuickTime X and/or other underlying frameworks. :/ Confirmed bug. https://bugs.webkit.org/show_bug.cgi?id=32159\r\n  _hasConsole = (typeof console !== 'undefined' && typeof console.log !== 'undefined'), _isFocused = (typeof _doc.hasFocus !== 'undefined'?_doc.hasFocus():null), _tryInitOnFocus = (_isSafari && typeof _doc.hasFocus === 'undefined'), _okToDisable = !_tryInitOnFocus, _flashMIME = /(mp3|mp4|mpa)/i,\r\n  _overHTTP = (_doc.location?_doc.location.protocol.match(/http/i):null),\r\n  _http = (!_overHTTP ? 'http:' : '');\r\n\r\n  this.useAltURL = !_overHTTP; // use altURL if not \"online\"\r\n  this._global_a = null;\r\n\r\n  if (_likesHTML5) {\r\n    // prefer HTML5 for mobile + tablet-like devices, probably more reliable vs. flash at this point.\r\n    _s.useHTML5Audio = true;\r\n    _s.preferFlash = false;\r\n    if (_is_iDevice) {\r\n      // by default, use global feature. iOS onfinish() -> next may fail otherwise.\r\n      _s.ignoreFlash = true;\r\n      _useGlobalHTML5Audio = true;\r\n    }\r\n  }\r\n\r\n  /*\r\n   * public soundManager API\r\n  */\r\n\r\n  this.ok = function () {\r\n    return (_needsFlash?(_didInit && !_disabled):(_s.useHTML5Audio && _s.hasHTML5));\r\n  };\r\n\r\n  this.supported = this.ok; // legacy\r\n\r\n  this.getMovie = function (smID) {\r\n    return _isIE?_win[smID]:(_isSafari?_id(smID) || _doc[smID]:_id(smID));\r\n  };\r\n\r\n  this.createSound = function (oOptions) {\r\n    var _cs = _sm+'.createSound(): ',\r\n    thisOptions = null, oSound = null, _tO = null;\r\n    if (!_didInit || !_s.ok()) {\r\n      _complain(_cs + _str(!_didInit?'notReady':'notOK'));\r\n      return false;\r\n    }\r\n    if (arguments.length === 2) {\r\n      // function overloading in JS! :) ..assume simple createSound(id,url) use case\r\n      oOptions = {\r\n        'id': arguments[0],\r\n        'url': arguments[1]\r\n      };\r\n    }\r\n    thisOptions = _mixin(oOptions); // inherit from defaultOptions\r\n    _tO = thisOptions; // alias\r\n    // <d>\r\n    if (_tO.id.toString().charAt(0).match(/^[0-9]$/)) {\r\n      _s._wD(_cs + _str('badID', _tO.id), 2);\r\n    }\r\n    _s._wD(_cs + _tO.id + ' (' + _tO.url + ')', 1);\r\n    // </d>\r\n    if (_idCheck(_tO.id, true)) {\r\n      _s._wD(_cs + _tO.id + ' exists', 1);\r\n      return _s.sounds[_tO.id];\r\n    }\r\n\r\n    function make() {\r\n      thisOptions = _loopFix(thisOptions);\r\n      _s.sounds[_tO.id] = new SMSound(_tO);\r\n      _s.soundIDs.push(_tO.id);\r\n      return _s.sounds[_tO.id];\r\n    }\r\n\r\n    if (_html5OK(_tO)) {\r\n      oSound = make();\r\n      _s._wD('Loading sound '+_tO.id+' via HTML5');\r\n      oSound._setup_html5(_tO);\r\n    } else {\r\n      if (_fV > 8 && _s.useMovieStar) {\r\n        if (_tO.isMovieStar === null) {\r\n          _tO.isMovieStar = ((_tO.serverURL || (_tO.type?_tO.type.match(_s.netStreamPattern):false)||_tO.url.match(_s.netStreamPattern))?true:false);\r\n        }\r\n        if (_tO.isMovieStar) {\r\n          _s._wD(_cs + 'using MovieStar handling');\r\n        }\r\n        if (_tO.isMovieStar) {\r\n          if (_tO.usePeakData) {\r\n            _wDS('noPeak');\r\n            _tO.usePeakData = false;\r\n          }\r\n          if (_tO.loops > 1) {\r\n            _wDS('noNSLoop');\r\n          }\r\n        }\r\n      }\r\n      _tO = _policyFix(_tO, _cs);\r\n      oSound = make();\r\n      if (_fV === 8) {\r\n        _s.o._createSound(_tO.id, _tO.onjustbeforefinishtime, _tO.loops||1, _tO.usePolicyFile);\r\n      } else {\r\n        _s.o._createSound(_tO.id, _tO.url, _tO.onjustbeforefinishtime, _tO.usePeakData, _tO.useWaveformData, _tO.useEQData, _tO.isMovieStar, (_tO.isMovieStar?_tO.bufferTime:false), _tO.loops||1, _tO.serverURL, _tO.duration||null, _tO.autoPlay, true, _tO.autoLoad, _tO.usePolicyFile);\r\n        if (!_tO.serverURL) {\r\n          // We are connected immediately\r\n          oSound.connected = true;\r\n          if (_tO.onconnect) {\r\n            _tO.onconnect.apply(oSound);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!_tO.serverURL && (_tO.autoLoad || _tO.autoPlay)) {\r\n        oSound.load(_tO); // call load for non-rtmp streams\r\n      }\r\n    }\r\n    if (!_tO.serverURL && _tO.autoPlay) { // rtmp will play in onconnect\r\n      oSound.play();\r\n    }\r\n    return oSound;\r\n  };\r\n\r\n  this.destroySound = function (sID, _bFromSound) {\r\n    // explicitly destroy a sound before normal page unload, etc.\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    var oS = _s.sounds[sID], i;\r\n    oS._iO = {}; // Disable all callbacks while the sound is being destroyed\r\n    oS.stop();\r\n    oS.unload();\r\n    for (i = 0; i < _s.soundIDs.length; i++) {\r\n      if (_s.soundIDs[i] === sID) {\r\n        _s.soundIDs.splice(i, 1);\r\n        break;\r\n      }\r\n    }\r\n    if (!_bFromSound) {\r\n      // ignore if being called from SMSound instance\r\n      oS.destruct(true);\r\n    }\r\n    oS = null;\r\n    delete _s.sounds[sID];\r\n    return true;\r\n  };\r\n\r\n  this.load = function (sID, oOptions) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].load(oOptions);\r\n  };\r\n\r\n  this.unload = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].unload();\r\n  };\r\n\r\n  this.play = function (sID, oOptions) {\r\n    var fN = _sm+'.play(): ';\r\n    if (!_didInit || !_s.ok()) {\r\n      _complain(fN + _str(!_didInit?'notReady':'notOK'));\r\n      return false;\r\n    }\r\n    if (!_idCheck(sID)) {\r\n      if (!(oOptions instanceof Object)) {\r\n        oOptions = {\r\n          url: oOptions\r\n        }; // overloading use case: play('mySound','/path/to/some.mp3');\r\n      }\r\n      if (oOptions && oOptions.url) {\r\n        // overloading use case, create+play: .play('someID',{url:'/path/to.mp3'});\r\n        _s._wD(fN + 'attempting to create \"' + sID + '\"', 1);\r\n        oOptions.id = sID;\r\n        return _s.createSound(oOptions).play();\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    return _s.sounds[sID].play(oOptions);\r\n  };\r\n\r\n  this.start = this.play; // just for convenience\r\n\r\n  this.setPosition = function (sID, nMsecOffset) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].setPosition(nMsecOffset);\r\n  };\r\n\r\n  this.stop = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    _s._wD(_sm+'.stop(' + sID + ')', 1);\r\n    return _s.sounds[sID].stop();\r\n  };\r\n\r\n  this.stopAll = function () {\r\n    var oSound;\r\n    _s._wD(_sm+'.stopAll()', 1);\r\n    for (oSound in _s.sounds) {\r\n      if (_s.sounds.hasOwnProperty(oSound)) {\r\n        _s.sounds[oSound].stop(); // apply only to sound objects\r\n      }\r\n    }\r\n  };\r\n\r\n  this.pause = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].pause();\r\n  };\r\n\r\n  this.pauseAll = function () {\r\n    var i;\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _s.sounds[_s.soundIDs[i]].pause();\r\n    }\r\n  };\r\n\r\n  this.resume = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].resume();\r\n  };\r\n\r\n  this.resumeAll = function () {\r\n    var i;\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _s.sounds[_s.soundIDs[i]].resume();\r\n    }\r\n  };\r\n\r\n  this.togglePause = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].togglePause();\r\n  };\r\n\r\n  this.setPan = function (sID, nPan) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].setPan(nPan);\r\n  };\r\n\r\n  this.setVolume = function (sID, nVol) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].setVolume(nVol);\r\n  };\r\n\r\n  this.mute = function (sID) {\r\n    var fN = _sm+'.mute(): ',\r\n    i = 0;\r\n    if (typeof sID !== 'string') {\r\n      sID = null;\r\n    }\r\n    if (!sID) {\r\n      _s._wD(fN + 'Muting all sounds');\r\n      for (i = _s.soundIDs.length; i--;) {\r\n        _s.sounds[_s.soundIDs[i]].mute();\r\n      }\r\n      _s.muted = true;\r\n    } else {\r\n      if (!_idCheck(sID)) {\r\n        return false;\r\n      }\r\n      _s._wD(fN + 'Muting \"' + sID + '\"');\r\n      return _s.sounds[sID].mute();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  this.muteAll = function () {\r\n    _s.mute();\r\n  };\r\n\r\n  this.unmute = function (sID) {\r\n    var fN = _sm+'.unmute(): ', i;\r\n    if (typeof sID !== 'string') {\r\n      sID = null;\r\n    }\r\n    if (!sID) {\r\n      _s._wD(fN + 'Unmuting all sounds');\r\n      for (i = _s.soundIDs.length; i--;) {\r\n        _s.sounds[_s.soundIDs[i]].unmute();\r\n      }\r\n      _s.muted = false;\r\n    } else {\r\n      if (!_idCheck(sID)) {\r\n        return false;\r\n      }\r\n      _s._wD(fN + 'Unmuting \"' + sID + '\"');\r\n      return _s.sounds[sID].unmute();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  this.unmuteAll = function () {\r\n    _s.unmute();\r\n  };\r\n\r\n  this.toggleMute = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].toggleMute();\r\n  };\r\n\r\n  this.getMemoryUse = function () {\r\n    // flash-only\r\n    var ram = 0;\r\n    if (_s.o && _fV !== 8) {\r\n      ram = parseInt(_s.o._getMemoryUse(), 10);\r\n    }\r\n    return ram;\r\n  };\r\n\r\n  this.disable = function (bNoDisable) {\r\n    // destroy all functions\r\n    var i;\r\n    if (typeof bNoDisable === 'undefined') {\r\n      bNoDisable = false;\r\n    }\r\n    if (_disabled) {\r\n      return false;\r\n    }\r\n    _disabled = true;\r\n    _wDS('shutdown', 1);\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _disableObject(_s.sounds[_s.soundIDs[i]]);\r\n    }\r\n    _initComplete(bNoDisable); // fire \"complete\", despite fail\r\n    _event.remove(_win, 'load', _initUserOnload);\r\n    return true;\r\n  };\r\n\r\n  this.canPlayMIME = function (sMIME) {\r\n    var result;\r\n    if (_s.hasHTML5) {\r\n      result = _html5CanPlay({type:sMIME});\r\n    }\r\n    if (!_needsFlash || result) {\r\n      // no flash, or OK\r\n      return result;\r\n    } else {\r\n      return (sMIME?(sMIME.match(_s.mimePattern)?true:false):null);\r\n    }\r\n  };\r\n\r\n  this.canPlayURL = function (sURL) {\r\n    var result;\r\n    if (_s.hasHTML5) {\r\n      result = _html5CanPlay({url: sURL});\r\n    }\r\n    if (!_needsFlash || result) {\r\n      // no flash, or OK\r\n      return result;\r\n    } else {\r\n      return (sURL?(sURL.match(_s.filePattern)?true:false):null);\r\n    }\r\n  };\r\n\r\n  this.canPlayLink = function (oLink) {\r\n    if (typeof oLink.type !== 'undefined' && oLink.type) {\r\n      if (_s.canPlayMIME(oLink.type)) {\r\n        return true;\r\n      }\r\n    }\r\n    return _s.canPlayURL(oLink.href);\r\n  };\r\n\r\n  this.getSoundById = function (sID, suppressDebug) {\r\n    if (!sID) {\r\n      throw new Error(_sm+'.getSoundById(): sID is null/undefined');\r\n    }\r\n    var result = _s.sounds[sID];\r\n    if (!result && !suppressDebug) {\r\n      _s._wD('\"' + sID + '\" is an invalid sound ID.', 2);\r\n    }\r\n    return result;\r\n  };\r\n\r\n  this.onready = function (oMethod, oScope) {\r\n    var sType = 'onready';\r\n    if (oMethod && oMethod instanceof Function) {\r\n      if (_didInit) {\r\n        _s._wD(_str('queue', sType));\r\n      }\r\n      if (!oScope) {\r\n        oScope = _win;\r\n      }\r\n      _addOnEvent(sType, oMethod, oScope);\r\n      _processOnEvents();\r\n      return true;\r\n    } else {\r\n      throw _str('needFunction', sType);\r\n    }\r\n  };\r\n\r\n  this.ontimeout = function (oMethod, oScope) {\r\n    var sType = 'ontimeout';\r\n    if (oMethod && oMethod instanceof Function) {\r\n      if (_didInit) {\r\n        _s._wD(_str('queue', sType));\r\n      }\r\n      if (!oScope) {\r\n        oScope = _win;\r\n      }\r\n      _addOnEvent(sType, oMethod, oScope);\r\n      _processOnEvents({type:sType});\r\n      return true;\r\n    } else {\r\n      throw _str('needFunction', sType);\r\n    }\r\n  };\r\n\r\n  this._writeDebug = function (sText, sType, bTimestamp) {\r\n    // pseudo-private console.log()-style output\r\n    // <d>\r\n    var sDID = 'soundmanager-debug', o, oItem, sMethod;\r\n    if (!_s.debugMode) {\r\n      return false;\r\n    }\r\n    if (typeof bTimestamp !== 'undefined' && bTimestamp) {\r\n      sText = sText + ' | ' + new Date().getTime();\r\n    }\r\n    if (_hasConsole && _s.useConsole) {\r\n      sMethod = _debugLevels[sType];\r\n      if (typeof console[sMethod] !== 'undefined') {\r\n        console[sMethod](sText);\r\n      } else {\r\n        console.log(sText);\r\n      }\r\n      if (_s.useConsoleOnly) {\r\n        return true;\r\n      }\r\n    }\r\n    try {\r\n      o = _id(sDID);\r\n      if (!o) {\r\n        return false;\r\n      }\r\n      oItem = _doc.createElement('div');\r\n      if (++_wdCount % 2 === 0) {\r\n        oItem.className = 'sm2-alt';\r\n      }\r\n      if (typeof sType === 'undefined') {\r\n        sType = 0;\r\n      } else {\r\n        sType = parseInt(sType, 10);\r\n      }\r\n      oItem.appendChild(_doc.createTextNode(sText));\r\n      if (sType) {\r\n        if (sType >= 2) {\r\n          oItem.style.fontWeight = 'bold';\r\n        }\r\n        if (sType === 3) {\r\n          oItem.style.color = '#ff3333';\r\n        }\r\n      }\r\n      // o.appendChild(oItem); // top-to-bottom\r\n      o.insertBefore(oItem, o.firstChild); // bottom-to-top\r\n    } catch(e) {\r\n      // oh well\r\n    }\r\n    o = null;\r\n    // </d>\r\n    return true;\r\n  };\r\n  this._wD = this._writeDebug; // alias\r\n\r\n  this._debug = function () {\r\n    // <d>\r\n    var i, j;\r\n    _wDS('currentObj', 1);\r\n    for (i = 0, j = _s.soundIDs.length; i < j; i++) {\r\n      _s.sounds[_s.soundIDs[i]]._debug();\r\n    }\r\n    // </d>\r\n  };\r\n\r\n  this.reboot = function () {\r\n    // attempt to reset and init SM2\r\n    _s._wD(_sm+'.reboot()');\r\n    if (_s.soundIDs.length) {\r\n      _s._wD('Destroying ' + _s.soundIDs.length + ' SMSound objects...');\r\n    }\r\n    var i, j;\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _s.sounds[_s.soundIDs[i]].destruct();\r\n    }\r\n    // trash ze flash\r\n    try {\r\n      if (_isIE) {\r\n        _oRemovedHTML = _s.o.innerHTML;\r\n      }\r\n      _oRemoved = _s.o.parentNode.removeChild(_s.o);\r\n      _s._wD('Flash movie removed.');\r\n    } catch(e) {\r\n      // uh-oh.\r\n      _wDS('badRemove', 2);\r\n    }\r\n    // actually, force recreate of movie.\r\n    _oRemovedHTML = _oRemoved = _needsFlash = null;\r\n    _s.enabled = _didDCLoaded = _didInit = _waitingForEI = _initPending = _didAppend = _appendSuccess = _disabled = _s.swfLoaded = false;\r\n    _s.soundIDs = _s.sounds = [];\r\n    _s.o = null;\r\n    for (i in _on_queue) {\r\n      if (_on_queue.hasOwnProperty(i)) {\r\n        for (j = _on_queue[i].length; j--;) {\r\n          _on_queue[i][j].fired = false;\r\n        }\r\n      }\r\n    }\r\n    _s._wD(_sm + ': Rebooting...');\r\n    _win.setTimeout(_s.beginDelayedInit, 20);\r\n  };\r\n\r\n  this.getMoviePercent = function () {\r\n    return (_s.o && typeof _s.o.PercentLoaded !== 'undefined' ? _s.o.PercentLoaded() : null);\r\n  };\r\n\r\n  this.beginDelayedInit = function () {\r\n    _windowLoaded = true;\r\n    _dcLoaded();\r\n    setTimeout(function () {\r\n      if (_initPending) {\r\n        return false;\r\n      }\r\n      _createMovie();\r\n      _initMovie();\r\n      _initPending = true;\r\n      return true;\r\n    }, 20);\r\n    _delayWaitForEI();\r\n  };\r\n\r\n  this.destruct = function () {\r\n    _s._wD(_sm+'.destruct()');\r\n    _s.disable(true);\r\n  };\r\n\r\n  /*\r\n   * internal HTML5 event handling\r\n  */\r\n\r\n  function _html5_event(oFn) {\r\n    // wrap html5 event handlers so we don't call them on destroyed sounds\r\n    return function (e) {\r\n      if (!this._t || !this._t._a) {\r\n        if (this._t && this._t.sID) {\r\n          _s._wD(_h5+'ignoring '+e.type+': '+this._t.sID);\r\n        } else {\r\n          _s._wD(_h5+'ignoring '+e.type);\r\n        }\r\n        return null;\r\n      } else {\r\n        return oFn.call(this, e);\r\n      }\r\n    };\r\n  }\r\n\r\n  _html5_events = {\r\n\r\n    // HTML5 event-name-to-handler map\r\n    abort: _html5_event(function (e) {\r\n      _s._wD(_h5+'abort: '+this._t.sID);\r\n    }),\r\n\r\n    // enough has loaded to play\r\n    canplay: _html5_event(function (e) {\r\n      if (this._t._html5_canplay) {\r\n        // this event has already fired. ignore.\r\n        return true;\r\n      }\r\n      this._t._html5_canplay = true;\r\n      _s._wD(_h5+'canplay: '+this._t.sID+', '+this._t.url);\r\n      this._t._onbufferchange(0);\r\n      var position1K = (!isNaN(this._t.position)?this._t.position/1000:null);\r\n      // set the position if position was set before the sound loaded\r\n      if (this._t.position && this.currentTime !== position1K) {\r\n        _s._wD(_h5+'canplay: setting position to '+position1K);\r\n        try {\r\n          this.currentTime = position1K;\r\n        } catch(ee) {\r\n          _s._wD(_h5+'setting position failed: '+ee.message, 2);\r\n        }\r\n      }\r\n    }),\r\n\r\n    load: _html5_event(function (e) {\r\n      if (!this._t.loaded) {\r\n        this._t._onbufferchange(0);\r\n        // should be 1, and the same\r\n        this._t._whileloading(this._t.bytesTotal, this._t.bytesTotal, this._t._get_html5_duration());\r\n        this._t._onload(true);\r\n      }\r\n    }),\r\n\r\n    emptied: _html5_event(function (e) {\r\n      _s._wD(_h5+'emptied: '+this._t.sID);\r\n    }),\r\n\r\n    ended: _html5_event(function (e) {\r\n      _s._wD(_h5+'ended: '+this._t.sID);\r\n      this._t._onfinish();\r\n    }),\r\n\r\n    error: _html5_event(function (e) {\r\n      _s._wD(_h5+'error: '+this.error.code);\r\n      // call load with error state?\r\n      this._t._onload(false);\r\n    }),\r\n\r\n    loadeddata: _html5_event(function (e) {\r\n      var t = this._t,\r\n          bytesTotal = t.bytesTotal || 1; // at least 1 byte, so math works\r\n      _s._wD(_h5+'loadeddata: '+this._t.sID);\r\n      if (!t._loaded && !_isSafari) { // safari seems to nicely report progress events, eventually totalling 100%\r\n        t.duration = t._get_html5_duration();\r\n        // fire whileloading() with 100% values\r\n        t._whileloading(bytesTotal, bytesTotal, t._get_html5_duration());\r\n        t._onload(true);\r\n      }\r\n    }),\r\n\r\n    loadedmetadata: _html5_event(function (e) {\r\n      _s._wD(_h5+'loadedmetadata: '+this._t.sID);\r\n    }),\r\n\r\n    loadstart: _html5_event(function (e) {\r\n      _s._wD(_h5+'loadstart: '+this._t.sID);\r\n      // assume buffering at first\r\n      this._t._onbufferchange(1);\r\n    }),\r\n\r\n    play: _html5_event(function (e) {\r\n      _s._wD(_h5+'play: '+this._t.sID+', '+this._t.url);\r\n      // once play starts, no buffering\r\n      this._t._onbufferchange(0);\r\n    }),\r\n\r\n    // TODO: verify if this is actually implemented anywhere yet.\r\n    playing: _html5_event(function (e) {\r\n      _s._wD(_h5+'playing: '+this._t.sID+', '+this._t.url);\r\n      // once play starts, no buffering\r\n      this._t._onbufferchange(0);\r\n    }),\r\n\r\n    progress: _html5_event(function (e) {\r\n\r\n      if (this._t.loaded) {\r\n        return false;\r\n      }\r\n\r\n      var i, j, str, buffered = 0,\r\n          isProgress = (e.type === 'progress'),\r\n          ranges = e.target.buffered,\r\n          loaded = (e.loaded||0), // firefox 3.6 implements e.loaded/total (bytes)\r\n          total = (e.total||1);\r\n\r\n      if (ranges && ranges.length) {\r\n\r\n        // if loaded is 0, try TimeRanges implementation as % of load\r\n        // https://developer.mozilla.org/en/DOM/TimeRanges\r\n        for (i=ranges.length; i--;) {\r\n          buffered = (ranges.end(i) - ranges.start(i));\r\n        }\r\n\r\n        // linear case, buffer sum; does not account for seeking and HTTP partials / byte ranges\r\n        loaded = buffered/e.target.duration;\r\n\r\n        // <d>\r\n        if (isProgress && ranges.length > 1) {\r\n          str = [];\r\n          j = ranges.length;\r\n          for (i=0; i<j; i++) {\r\n            str.push(e.target.buffered.start(i) +'-'+ e.target.buffered.end(i));\r\n          }\r\n          _s._wD(_h5+'progress: timeRanges: '+str.join(', '));\r\n        }\r\n        // </d>\r\n\r\n        if (isProgress && !isNaN(loaded)) {\r\n          _s._wD(_h5+'progress: '+this._t.sID+': ' + Math.floor(loaded*100)+'% loaded');\r\n        }\r\n\r\n      }\r\n\r\n      if (!isNaN(loaded)) {\r\n\r\n        this._t._onbufferchange(0); // if progress, likely not buffering\r\n        this._t._whileloading(loaded, total, this._t._get_html5_duration());\r\n\r\n        if (loaded && total && loaded === total) {\r\n          // in case \"onload\" doesn't fire (eg. gecko 1.9.2)\r\n          _html5_events.load.call(this, e);\r\n        }\r\n\r\n      }\r\n\r\n    }),\r\n\r\n    ratechange: _html5_event(function (e) {\r\n      _s._wD(_h5+'ratechange: '+this._t.sID);\r\n    }),\r\n\r\n    suspend: _html5_event(function (e) {\r\n      // download paused/stopped, may have finished (eg. onload)\r\n      _s._wD(_h5+'suspend: '+this._t.sID);\r\n      _html5_events.progress.call(this, e);\r\n    }),\r\n\r\n    stalled: _html5_event(function (e) {\r\n      _s._wD(_h5+'stalled: '+this._t.sID);\r\n    }),\r\n\r\n    timeupdate: _html5_event(function (e) {\r\n      this._t._onTimer();\r\n    }),\r\n\r\n    waiting: _html5_event(function (e) { // see also: seeking\r\n      _s._wD(_h5+'waiting: '+this._t.sID);\r\n      // playback faster than download rate, etc.\r\n      this._t._onbufferchange(1);\r\n    })\r\n\r\n  };\r\n\r\n  /*\r\n   * SMSound() (sound object) instance\r\n  */\r\n\r\n  SMSound = function (oOptions) {\r\n\r\n    var _t = this, _resetProperties, _stop_html5_timer, _start_html5_timer;\r\n    this.sID = oOptions.id;\r\n    this.url = oOptions.url;\r\n    this.options = _mixin(oOptions);\r\n    this.instanceOptions = this.options; // per-play-instance-specific options\r\n    this._iO = this.instanceOptions; // short alias\r\n    // assign property defaults\r\n    this.pan = this.options.pan;\r\n    this.volume = this.options.volume;\r\n    this._lastURL = null;\r\n    this.isHTML5 = false;\r\n    this._a = null;\r\n\r\n    // --- public methods ---\r\n\r\n    this.id3 = {};\r\n\r\n    this._debug = function () {\r\n      // <d>\r\n      // pseudo-private console.log()-style output\r\n      if (_s.debugMode) {\r\n        var stuff = null, msg = [], sF, sfBracket, maxLength = 64;\r\n        for (stuff in _t.options) {\r\n          if (_t.options[stuff] !== null) {\r\n            if (_t.options[stuff] instanceof Function) {\r\n              // handle functions specially\r\n              sF = _t.options[stuff].toString();\r\n              sF = sF.replace(/\\s\\s+/g, ' '); // normalize spaces\r\n              sfBracket = sF.indexOf('{');\r\n              msg.push(' ' + stuff + ': {' + sF.substr(sfBracket + 1, (Math.min(Math.max(sF.indexOf('\\n') - 1, maxLength), maxLength))).replace(/\\n/g, '') + '... }');\r\n            } else {\r\n              msg.push(' ' + stuff + ': ' + _t.options[stuff]);\r\n            }\r\n          }\r\n        }\r\n        _s._wD('SMSound() merged options: {\\n' + msg.join(', \\n') + '\\n}');\r\n      }\r\n      // </d>\r\n    };\r\n\r\n    // <d>\r\n    this._debug();\r\n    // </d>\r\n\r\n    this.load = function (oOptions) {\r\n      var oS = null;\r\n      if (typeof oOptions !== 'undefined') {\r\n        _t._iO = _mixin(oOptions, _t.options);\r\n        _t.instanceOptions = _t._iO;\r\n      } else {\r\n        oOptions = _t.options;\r\n        _t._iO = oOptions;\r\n        _t.instanceOptions = _t._iO;\r\n        if (_t._lastURL && _t._lastURL !== _t.url) {\r\n          _wDS('manURL');\r\n          _t._iO.url = _t.url;\r\n          _t.url = null;\r\n        }\r\n      }\r\n      if (!_t._iO.url) {\r\n        _t._iO.url = _t.url;\r\n      }\r\n      _s._wD('SMSound.load(): ' + _t._iO.url, 1);\r\n      if (_t._iO.url === _t.url && _t.readyState !== 0 && _t.readyState !== 2) {\r\n        _wDS('onURL', 1);\r\n        return _t;\r\n      }\r\n      _t._lastURL = _t.url;\r\n      _t.loaded = false;\r\n      _t.readyState = 1;\r\n      _t.playState = 0;\r\n      if (_html5OK(_t._iO)) {\r\n        oS = _t._setup_html5(_t._iO);\r\n        if (!oS._called_load) {\r\n          _s._wD(_h5+'load: '+_t.sID);\r\n          _t._html5_canplay = false;\r\n          oS.load();\r\n          oS._called_load = true;\r\n          if (_t._iO.autoPlay) {\r\n            _t.play();\r\n          }\r\n        } else {\r\n          _s._wD(_h5+'ignoring request to load again: '+_t.sID);\r\n        }\r\n      } else {\r\n        try {\r\n          _t.isHTML5 = false;\r\n          _t._iO = _policyFix(_loopFix(_t._iO));\r\n          if (_fV === 8) {\r\n            _s.o._load(_t.sID, _t._iO.url, _t._iO.stream, _t._iO.autoPlay, (_t._iO.whileloading?1:0), _t._iO.loops||1, _t._iO.usePolicyFile);\r\n          } else {\r\n            _s.o._load(_t.sID, _t._iO.url, _t._iO.stream?true:false, _t._iO.autoPlay?true:false, _t._iO.loops||1, _t._iO.autoLoad?true:false, _t._iO.usePolicyFile);\r\n          }\r\n        } catch(e) {\r\n          _wDS('smError', 2);\r\n          _debugTS('onload', false);\r\n          _catchError({type:'SMSOUND_LOAD_JS_EXCEPTION', fatal:true});\r\n        }\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.unload = function () {\r\n      // Flash 8/AS2 can't \"close\" a stream - fake it by loading an empty MP3\r\n      // Flash 9/AS3: Close stream, preventing further load\r\n      if (_t.readyState !== 0) {\r\n        _s._wD('SMSound.unload(): \"' + _t.sID + '\"');\r\n        if (!_t.isHTML5) {\r\n          if (_fV === 8) {\r\n            _s.o._unload(_t.sID, _s.nullURL);\r\n          } else {\r\n            _s.o._unload(_t.sID);\r\n          }\r\n        } else {\r\n          _stop_html5_timer();\r\n          if (_t._a) {\r\n            // abort()-style method here, stop loading? (doesn't exist?)\r\n            _t._a.pause();\r\n            _t._a.src = ''; // https://developer.mozilla.org/En/Using_audio_and_video_in_Firefox#Stopping_the_download_of_media\r\n          }\r\n        }\r\n        // reset load/status flags\r\n        _resetProperties();\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.destruct = function (_bFromSM) {\r\n      _s._wD('SMSound.destruct(): \"' + _t.sID + '\"');\r\n      if (!_t.isHTML5) {\r\n        // kill sound within Flash\r\n        // Disable the onfailure handler\r\n        _t._iO.onfailure = null;\r\n        _s.o._destroySound(_t.sID);\r\n      } else {\r\n        _stop_html5_timer();\r\n        if (_t._a) {\r\n          // abort()-style method here, stop loading? (doesn't exist?)\r\n          _t._a.pause();\r\n          _t._a.src = ''; // https://developer.mozilla.org/En/Using_audio_and_video_in_Firefox#Stopping_the_download_of_media\r\n          if (!_useGlobalHTML5Audio) {\r\n            _t._remove_html5_events();\r\n          }\r\n          _t._a._t = null; // break potential circular reference\r\n          _t._a = null;\r\n        }\r\n      }\r\n      if (!_bFromSM) {\r\n        _s.destroySound(_t.sID, true); // ensure deletion from controller\r\n      }\r\n    };\r\n\r\n    this.play = function (oOptions, _updatePlayState) {\r\n      var fN = 'SMSound.play(): ', allowMulti, a;\r\n      _updatePlayState = _updatePlayState === undefined ? true : _updatePlayState; // default to true\r\n      if (!oOptions) {\r\n        oOptions = {};\r\n      }\r\n      _t._iO = _mixin(oOptions, _t._iO);\r\n      _t._iO = _mixin(_t._iO, _t.options);\r\n      _t.instanceOptions = _t._iO;\r\n      if (_t._iO.serverURL && !_t.connected) {\r\n        if (!_t.getAutoPlay()) {\r\n          _s._wD(fN+' Netstream not connected yet - setting autoPlay');\r\n          _t.setAutoPlay(true);\r\n        }\r\n        return _t; // play will be called in _onconnect()\r\n      }\r\n      if (_html5OK(_t._iO)) {\r\n        _t._setup_html5(_t._iO);\r\n        _start_html5_timer();\r\n      }\r\n      if (_t.playState === 1 && !_t.paused) {\r\n        allowMulti = _t._iO.multiShot;\r\n        if (!allowMulti) {\r\n          _s._wD(fN + '\"' + _t.sID + '\" already playing (one-shot)', 1);\r\n          return _t;\r\n        } else {\r\n          _s._wD(fN + '\"' + _t.sID + '\" already playing (multi-shot)', 1);\r\n        }\r\n      }\r\n      if (!_t.loaded) {\r\n        if (_t.readyState === 0) {\r\n          _s._wD(fN + 'Attempting to load \"' + _t.sID + '\"', 1);\r\n          // try to get this sound playing ASAP\r\n          if (!_t.isHTML5) {\r\n            _t._iO.autoPlay = true; // assign directly because setAutoPlay() increments the instanceCount\r\n          }\r\n          _t.load(_t._iO);\r\n        } else if (_t.readyState === 2) {\r\n          _s._wD(fN + 'Could not load \"' + _t.sID + '\" - exiting', 2);\r\n          return _t;\r\n        } else {\r\n          _s._wD(fN + '\"' + _t.sID + '\" is loading - attempting to play..', 1);\r\n        }\r\n      } else {\r\n        _s._wD(fN + '\"' + _t.sID + '\"');\r\n      }\r\n      if (!_t.isHTML5 && _fV === 9 && _t.position > 0 && _t.position === _t.duration) {\r\n        // flash 9 needs a position reset if play() is called while at the end of a sound.\r\n        _s._wD(fN + '\"' + _t.sID + '\": Sound at end, resetting to position:0');\r\n        _t._iO.position = 0;\r\n      }\r\n      /*\r\n       * Streams will pause when their buffer is full if they are being loaded.\r\n       * In this case paused is true, but the song hasn't started playing yet.\r\n       * If we just call resume() the onplay() callback will never be called.\r\n       * So only call resume() if the position is > 0.\r\n       * Another reason is because options like volume won't have been applied yet.\r\n      */\r\n      if (_t.paused && _t.position && _t.position > 0) { // https://gist.github.com/37b17df75cc4d7a90bf6\r\n        _s._wD(fN + '\"' + _t.sID + '\" is resuming from paused state',1);\r\n        _t.resume();\r\n      } else {\r\n        _s._wD(fN+'\"'+ _t.sID+'\" is starting to play');\r\n        _t.playState = 1;\r\n        _t.paused = false;\r\n        if (!_t.instanceCount || _t._iO.multiShotEvents || (!_t.isHTML5 && _fV > 8 && !_t.getAutoPlay())) {\r\n          _t.instanceCount++;\r\n        }\r\n        _t.position = (typeof _t._iO.position !== 'undefined' && !isNaN(_t._iO.position)?_t._iO.position:0);\r\n        if (!_t.isHTML5) {\r\n          _t._iO = _policyFix(_loopFix(_t._iO));\r\n        }\r\n        if (_t._iO.onplay && _updatePlayState) {\r\n          _t._iO.onplay.apply(_t);\r\n          _t._onplay_called = true;\r\n        }\r\n        _t.setVolume(_t._iO.volume, true);\r\n        _t.setPan(_t._iO.pan, true);\r\n        if (!_t.isHTML5) {\r\n          _s.o._start(_t.sID, _t._iO.loops || 1, (_fV === 9?_t._iO.position:_t._iO.position / 1000));\r\n        } else {\r\n          _start_html5_timer();\r\n          a = _t._setup_html5();\r\n          _t.setPosition(_t._iO.position);\r\n          a.play();\r\n        }\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.start = this.play; // just for convenience\r\n\r\n    this.stop = function (bAll) {\r\n      if (_t.playState === 1) {\r\n        _t._onbufferchange(0);\r\n        _t.resetOnPosition(0);\r\n        if (!_t.isHTML5) {\r\n          _t.playState = 0;\r\n        }\r\n        _t.paused = false;\r\n        if (_t._iO.onstop) {\r\n          _t._iO.onstop.apply(_t);\r\n        }\r\n        if (!_t.isHTML5) {\r\n          _s.o._stop(_t.sID, bAll);\r\n          // hack for netStream: just unload\r\n          if (_t._iO.serverURL) {\r\n            _t.unload();\r\n          }\r\n        } else {\r\n          if (_t._a) {\r\n            _t.setPosition(0); // act like Flash, though\r\n            _t._a.pause(); // html5 has no stop()\r\n            _t.playState = 0;\r\n            _t._onTimer(); // and update UI\r\n            _stop_html5_timer();\r\n            _t.unload();\r\n          }\r\n        }\r\n        _t.instanceCount = 0;\r\n        _t._iO = {};\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.setAutoPlay = function (autoPlay) {\r\n      _s._wD('sound '+_t.sID+' turned autoplay ' + (autoPlay ? 'on' : 'off'));\r\n      _t._iO.autoPlay = autoPlay;\r\n      if (!_t.isHTML5) {\r\n        _s.o._setAutoPlay(_t.sID, autoPlay);\r\n        if (autoPlay) {\r\n          // only increment the instanceCount if the sound isn't loaded (TODO: verify RTMP)\r\n          if (!_t.instanceCount && _t.readyState === 1) {\r\n            _t.instanceCount++;\r\n            _s._wD('sound '+_t.sID+' incremented instance count to '+_t.instanceCount);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.getAutoPlay = function () {\r\n      return _t._iO.autoPlay;\r\n    };\r\n\r\n    this.setPosition = function (nMsecOffset) {\r\n      if (nMsecOffset === undefined) {\r\n        nMsecOffset = 0;\r\n      }\r\n      // Use the duration from the instance options, if we don't have a track duration yet.\r\n      var original_pos, position, position1K,\r\n          offset = (_t.isHTML5 ? Math.max(nMsecOffset,0) : Math.min(_t.duration || _t._iO.duration, Math.max(nMsecOffset, 0))); // position >= 0 and <= current available (loaded) duration\r\n      original_pos = _t.position;\r\n      _t.position = offset;\r\n      position1K = _t.position/1000;\r\n      _t.resetOnPosition(_t.position);\r\n      _t._iO.position = offset;\r\n      if (!_t.isHTML5) {\r\n        position = (_fV === 9 ? _t.position : position1K);\r\n        if (_t.readyState && _t.readyState !== 2) {\r\n          _s.o._setPosition(_t.sID, position, (_t.paused || !_t.playState)); // if paused or not playing, will not resume (by playing)\r\n        }\r\n      } else if (_t._a) {\r\n        // Set the position in the canplay handler if the sound is not ready yet\r\n        if (_t._html5_canplay) {\r\n          if (_t._a.currentTime !== position1K) {\r\n            /*\r\n             * DOM/JS errors/exceptions to watch out for:\r\n             * if seek is beyond (loaded?) position, \"DOM exception 11\"\r\n             * \"INDEX_SIZE_ERR\": DOM exception 1\r\n            */\r\n            _s._wD('setPosition('+position1K+'): setting position');\r\n            try {\r\n              _t._a.currentTime = position1K;\r\n              if (_t.playState === 0 || _t.paused) {\r\n                // allow seek without auto-play/resume\r\n                _t._a.pause();\r\n              }\r\n            } catch(e) {\r\n              _s._wD('setPosition('+position1K+'): setting position failed: '+e.message, 2);\r\n            }\r\n          }\r\n        } else {\r\n          _s._wD('setPosition('+position1K+'): delaying, sound not ready');\r\n        }\r\n      }\r\n      if (_t.isHTML5) {\r\n        if (_t.paused) { // if paused, refresh UI right away\r\n          _t._onTimer(true); // force update\r\n        }\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.pause = function (bCallFlash) {\r\n      if (_t.paused || (_t.playState === 0 && _t.readyState !== 1)) {\r\n        return _t;\r\n      }\r\n      _s._wD('SMSound.pause()');\r\n      _t.paused = true;\r\n      if (!_t.isHTML5) {\r\n        if (bCallFlash || bCallFlash === undefined) {\r\n          _s.o._pause(_t.sID);\r\n        }\r\n      } else {\r\n        _t._setup_html5().pause();\r\n        _stop_html5_timer();\r\n      }\r\n      if (_t._iO.onpause) {\r\n        _t._iO.onpause.apply(_t);\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    /*\r\n     * When auto-loaded streams pause on buffer full they have a playState of 0.\r\n     * We need to make sure that the playState is set to 1 when these streams \"resume\".\r\n     * When a paused stream is resumed, we need to trigger the onplay() callback if it\r\n     * hasn't been called already. In this case since the sound is being played for the\r\n     * first time, I think it's more appropriate to call onplay() rather than onresume().\r\n    */\r\n    this.resume = function () {\r\n      if (!_t.paused) {\r\n        return _t;\r\n      }\r\n      _s._wD('SMSound.resume()');\r\n      _t.paused = false;\r\n      _t.playState = 1;\r\n      if (!_t.isHTML5) {\r\n        if (_t._iO.isMovieStar) {\r\n          // Bizarre Webkit bug (Chrome reported via 8tracks.com dudes): AAC content paused for 30+ seconds(?) will not resume without a reposition.\r\n          _t.setPosition(_t.position);\r\n        }\r\n        _s.o._pause(_t.sID); // flash method is toggle-based (pause/resume)\r\n      } else {\r\n        _t._setup_html5().play();\r\n        _start_html5_timer();\r\n      }\r\n      if (!_t._onplay_called && _t._iO.onplay) {\r\n        _t._iO.onplay.apply(_t);\r\n        _t._onplay_called = true;\r\n      } else if (_t._iO.onresume) {\r\n        _t._iO.onresume.apply(_t);\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.togglePause = function () {\r\n      _s._wD('SMSound.togglePause()');\r\n      if (_t.playState === 0) {\r\n        _t.play({\r\n          position: (_fV === 9 && !_t.isHTML5 ? _t.position : _t.position / 1000)\r\n        });\r\n        return _t;\r\n      }\r\n      if (_t.paused) {\r\n        _t.resume();\r\n      } else {\r\n        _t.pause();\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.setPan = function (nPan, bInstanceOnly) {\r\n      if (typeof nPan === 'undefined') {\r\n        nPan = 0;\r\n      }\r\n      if (typeof bInstanceOnly === 'undefined') {\r\n        bInstanceOnly = false;\r\n      }\r\n      if (!_t.isHTML5) {\r\n        _s.o._setPan(_t.sID, nPan);\r\n      } // else { no HTML5 pan? }\r\n      _t._iO.pan = nPan;\r\n      if (!bInstanceOnly) {\r\n        _t.pan = nPan;\r\n        _t.options.pan = nPan;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.setVolume = function (nVol, bInstanceOnly) {\r\n      if (typeof nVol === 'undefined') {\r\n        nVol = 100;\r\n      }\r\n      if (typeof bInstanceOnly === 'undefined') {\r\n        bInstanceOnly = false;\r\n      }\r\n      if (!_t.isHTML5) {\r\n        _s.o._setVolume(_t.sID, (_s.muted && !_t.muted) || _t.muted?0:nVol);\r\n      } else if (_t._a) {\r\n        _t._a.volume = Math.max(0, Math.min(1, nVol/100)); // valid range: 0-1\r\n      }\r\n      _t._iO.volume = nVol;\r\n      if (!bInstanceOnly) {\r\n        _t.volume = nVol;\r\n        _t.options.volume = nVol;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.mute = function () {\r\n      _t.muted = true;\r\n      if (!_t.isHTML5) {\r\n        _s.o._setVolume(_t.sID, 0);\r\n      } else if (_t._a) {\r\n        _t._a.muted = true;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.unmute = function () {\r\n      _t.muted = false;\r\n      var hasIO = typeof _t._iO.volume !== 'undefined';\r\n      if (!_t.isHTML5) {\r\n        _s.o._setVolume(_t.sID, hasIO?_t._iO.volume:_t.options.volume);\r\n      } else if (_t._a) {\r\n        _t._a.muted = false;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.toggleMute = function () {\r\n      return (_t.muted?_t.unmute():_t.mute());\r\n    };\r\n\r\n    this.onposition = function (nPosition, oMethod, oScope) {\r\n      // TODO: allow for ranges, too? eg. (nPosition instanceof Array)\r\n      _t._onPositionItems.push({\r\n        position: nPosition,\r\n        method: oMethod,\r\n        scope: (typeof oScope !== 'undefined'?oScope:_t),\r\n        fired: false\r\n      });\r\n      return _t;\r\n    };\r\n\r\n    this.processOnPosition = function () {\r\n      var i, item, j = _t._onPositionItems.length;\r\n      if (!j || !_t.playState || _t._onPositionFired >= j) {\r\n        return false;\r\n      }\r\n      for (i=j; i--;) {\r\n        item = _t._onPositionItems[i];\r\n        if (!item.fired && _t.position >= item.position) {\r\n          item.method.apply(item.scope,[item.position]);\r\n          item.fired = true;\r\n          _s._onPositionFired++;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    this.resetOnPosition = function (nPosition) {\r\n      // reset \"fired\" for items interested in this position\r\n      var i, item, j = _t._onPositionItems.length;\r\n      if (!j) {\r\n        return false;\r\n      }\r\n      for (i=j; i--;) {\r\n        item = _t._onPositionItems[i];\r\n        if (item.fired && nPosition <= item.position) {\r\n          item.fired = false;\r\n          _s._onPositionFired--;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    /*\r\n     * private internals\r\n    */\r\n\r\n    _start_html5_timer = function () {\r\n      if (_t.isHTML5) {\r\n        _startTimer(_t);\r\n      }\r\n    };\r\n\r\n    _stop_html5_timer = function () {\r\n      if (_t.isHTML5) {\r\n        _stopTimer(_t);\r\n      }\r\n    };\r\n\r\n    _resetProperties = function () {\r\n      _t._onPositionItems = [];\r\n      _t._onPositionFired = 0;\r\n      _t._hasTimer = null;\r\n      _t._onplay_called = false;\r\n      _t._a = null;\r\n      _t._html5_canplay = false;\r\n      _t.bytesLoaded = null;\r\n      _t.bytesTotal = null;\r\n      _t.position = null;\r\n      _t.duration = (_t._iO && _t._iO.duration?_t._iO.duration:null);\r\n      _t.durationEstimate = null;\r\n      _t.failures = 0;\r\n      _t.loaded = false;\r\n      _t.playState = 0;\r\n      _t.paused = false;\r\n      _t.readyState = 0; // 0 = uninitialised, 1 = loading, 2 = failed/error, 3 = loaded/success\r\n      _t.muted = false;\r\n      _t.didBeforeFinish = false;\r\n      _t.didJustBeforeFinish = false;\r\n      _t.isBuffering = false;\r\n      _t.instanceOptions = {};\r\n      _t.instanceCount = 0;\r\n      _t.peakData = {\r\n        left: 0,\r\n        right: 0\r\n      };\r\n      _t.waveformData = {\r\n        left: [],\r\n        right: []\r\n      };\r\n      _t.eqData = []; // legacy: 1D array\r\n      _t.eqData.left = [];\r\n      _t.eqData.right = [];\r\n    };\r\n\r\n    _resetProperties();\r\n\r\n    /*\r\n     * pseudo-private SMSound internals\r\n    */\r\n\r\n    this._onTimer = function (bForce) {\r\n      // HTML5-only _whileplaying() etc.\r\n      var time, x = {};\r\n      if (_t._hasTimer || bForce) {\r\n        if (_t._a && (bForce || ((_t.playState > 0 || _t.readyState === 1) && !_t.paused))) { // TODO: May not need to track readyState (1 = loading)\r\n          _t.duration = _t._get_html5_duration();\r\n          _t.durationEstimate = _t.duration;\r\n          time = _t._a.currentTime?_t._a.currentTime*1000:0;\r\n          _t._whileplaying(time,x,x,x,x);\r\n          return true;\r\n        } else {\r\n         _s._wD('_onTimer: Warn for \"'+_t.sID+'\": '+(!_t._a?'Could not find element. ':'')+(_t.playState === 0?'playState bad, 0?':'playState = '+_t.playState+', OK'));\r\n          return false;\r\n        }\r\n      }\r\n    };\r\n\r\n    this._get_html5_duration = function () {\r\n      var d = (_t._a ? _t._a.duration*1000 : (_t._iO ? _t._iO.duration : undefined)),\r\n          result = (d && !isNaN(d) && d !== Infinity ? d : (_t._iO ? _t._iO.duration : null));\r\n      return result;\r\n    };\r\n\r\n    this._setup_html5 = function (oOptions) {\r\n      var _iO = _mixin(_t._iO, oOptions), d = decodeURI,\r\n          _a = _useGlobalHTML5Audio ? _s._global_a : _t._a,\r\n          _dURL = d(_iO.url),\r\n          _oldIO = (_a && _a._t ? _a._t.instanceOptions : null);\r\n      if (_a) {\r\n        if (_a._t && _oldIO.url === _iO.url && (!_t._lastURL || (_t._lastURL === _oldIO.url))) {\r\n          return _a; // same url, ignore request\r\n        }\r\n        _s._wD('setting new URL on existing object: ' + _dURL + (_t._lastURL ? ', old URL: ' + _t._lastURL : ''));\r\n        /*\r\n         * \"First things first, I, Poppa..\" (reset the previous state of the old sound, if playing)\r\n         * Fixes case with devices that can only play one sound at a time\r\n         * Otherwise, other sounds in mid-play will be terminated without warning and in a stuck state\r\n        */\r\n        if (_useGlobalHTML5Audio && _a._t && _a._t.playState && _iO.url !== _oldIO.url) {\r\n          _a._t.stop();\r\n        }\r\n        _resetProperties(); // new URL, so reset load/playstate and so on\r\n        _a.src = _iO.url;\r\n        _t.url = _iO.url;\r\n        _t._lastURL = _iO.url;\r\n        _a._called_load = false;\r\n      } else {\r\n        _s._wD('creating HTML5 Audio() element with URL: '+_dURL);\r\n        _a = new Audio(_iO.url);\r\n        _a._called_load = false;\r\n        if (_useGlobalHTML5Audio) {\r\n          _s._global_a = _a;\r\n        }\r\n      }\r\n      _t.isHTML5 = true;\r\n      _t._a = _a; // store a ref on the track\r\n      _a._t = _t; // store a ref on the audio\r\n      _t._add_html5_events();\r\n      _a.loop = (_iO.loops>1?'loop':'');\r\n      if (_iO.autoLoad || _iO.autoPlay) {\r\n        _a.autobuffer = 'auto'; // early HTML5 implementation (non-standard)\r\n        _a.preload = 'auto'; // standard\r\n        _t.load();\r\n        _a._called_load = true;\r\n      } else {\r\n        _a.autobuffer = false; // early HTML5 implementation (non-standard)\r\n        _a.preload = 'none'; // standard\r\n      }\r\n      _a.loop = (_iO.loops>1?'loop':''); // boolean instead of \"loop\", for webkit? - spec says string. http://www.w3.org/TR/html-markup/audio.html#audio.attrs.loop\r\n      return _a;\r\n    };\r\n\r\n    this._add_html5_events = function () {\r\n\r\n      if (_t._a._added_events) {\r\n        return false;\r\n      }\r\n\r\n      var f;\r\n\r\n      function add(oEvt, oFn, bCapture) {\r\n        return _t._a ? _t._a.addEventListener(oEvt, oFn, bCapture||false) : null;\r\n      }\r\n\r\n      _s._wD(_h5+'adding event listeners: '+_t.sID);\r\n      _t._a._added_events = true;\r\n\r\n      for (f in _html5_events) {\r\n        if (_html5_events.hasOwnProperty(f)) {\r\n          add(f, _html5_events[f]);\r\n        }\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    this._remove_html5_events = function () {\r\n\r\n      // Remove event listeners\r\n\r\n      var f;\r\n\r\n      function remove(oEvt, oFn, bCapture) {\r\n        return (_t._a ? _t._a.removeEventListener(oEvt, oFn, bCapture||false) : null);\r\n      }\r\n\r\n      _s._wD(_h5+'removing event listeners: '+_t.sID);\r\n      _t._a._added_events = false;\r\n\r\n      for (f in _html5_events) {\r\n        if (_html5_events.hasOwnProperty(f)) {\r\n          remove(f, _html5_events[f]);\r\n        }\r\n      }\r\n\r\n    };\r\n\r\n    /*\r\n     * pseudo-private event internals\r\n    */\r\n\r\n    this._onload = function (nSuccess) {\r\n      var fN = 'SMSound._onload(): ', loadOK = (nSuccess?true:false);\r\n      _s._wD(fN + '\"' + _t.sID + '\"' + (loadOK?' loaded.':' failed to load? - ' + _t.url), (loadOK?1:2));\r\n      // <d>\r\n      if (!loadOK && !_t.isHTML5) {\r\n        if (_s.sandbox.noRemote === true) {\r\n          _s._wD(fN + _str('noNet'), 1);\r\n        }\r\n        if (_s.sandbox.noLocal === true) {\r\n          _s._wD(fN + _str('noLocal'), 1);\r\n        }\r\n      }\r\n      // </d>\r\n      _t.loaded = loadOK;\r\n      _t.readyState = loadOK?3:2;\r\n      _t._onbufferchange(0);\r\n      if (_t._iO.onload) {\r\n        _t._iO.onload.apply(_t, [loadOK]);\r\n      }\r\n      return true;\r\n    };\r\n\r\n    this._onbufferchange = function (nIsBuffering) {\r\n      var fN = 'SMSound._onbufferchange()';\r\n      if (_t.playState === 0) {\r\n        // ignore if not playing\r\n        return false;\r\n      }\r\n      if ((nIsBuffering && _t.isBuffering) || (!nIsBuffering && !_t.isBuffering)) {\r\n        return false;\r\n      }\r\n      _t.isBuffering = (nIsBuffering === 1);\r\n      if (_t._iO.onbufferchange) {\r\n        _s._wD(fN + ': ' + nIsBuffering);\r\n        _t._iO.onbufferchange.apply(_t);\r\n      }\r\n      return true;\r\n    };\r\n\r\n    /*\r\n     * flash-only method, should fire only once at most\r\n     * at this point we just recreate failed sounds rather than trying to reconnect\r\n    */\r\n    this._onfailure = function (msg, level, code) {\r\n      _t.failures++;\r\n      _s._wD('SMSound._onfailure(): \"'+_t.sID+'\" count '+_t.failures);\r\n      if (_t._iO.onfailure && _t.failures === 1) {\r\n        _t._iO.onfailure(_t, msg, level, code);\r\n      } else {\r\n        _s._wD('SMSound._onfailure(): ignoring');\r\n      }\r\n    };\r\n\r\n    this._onbeforefinish = function () {\r\n      if (!_t.didBeforeFinish) {\r\n        _t.didBeforeFinish = true;\r\n        if (_t._iO.onbeforefinish) {\r\n          _s._wD('SMSound._onbeforefinish(): \"' + _t.sID + '\"');\r\n          _t._iO.onbeforefinish.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._onjustbeforefinish = function (msOffset) {\r\n      if (!_t.didJustBeforeFinish) {\r\n        _t.didJustBeforeFinish = true;\r\n        if (_t._iO.onjustbeforefinish) {\r\n          _s._wD('SMSound._onjustbeforefinish(): \"' + _t.sID + '\"');\r\n          _t._iO.onjustbeforefinish.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._onfinish = function () {\r\n      var _io_onfinish = _t._iO.onfinish; // store local copy before it gets trashed..\r\n      _t._onbufferchange(0);\r\n      _t.resetOnPosition(0);\r\n      if (_t._iO.onbeforefinishcomplete) {\r\n        _t._iO.onbeforefinishcomplete.apply(_t);\r\n      }\r\n      // reset some state items\r\n      _t.didBeforeFinish = false;\r\n      _t.didJustBeforeFinish = false;\r\n      if (_t.instanceCount) {\r\n        _t.instanceCount--;\r\n        if (!_t.instanceCount) {\r\n          // reset instance options\r\n          _t.playState = 0;\r\n          _t.paused = false;\r\n          _t.instanceCount = 0;\r\n          _t.instanceOptions = {};\r\n          _t._iO = {};\r\n          _stop_html5_timer();\r\n        }\r\n        if (!_t.instanceCount || _t._iO.multiShotEvents) {\r\n          // fire onfinish for last, or every instance\r\n          if (_io_onfinish) {\r\n            _s._wD('SMSound._onfinish(): \"' + _t.sID + '\"');\r\n            _io_onfinish.apply(_t);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this._whileloading = function (nBytesLoaded, nBytesTotal, nDuration, nBufferLength) {\r\n      _t.bytesLoaded = nBytesLoaded;\r\n      _t.bytesTotal = nBytesTotal;\r\n      _t.duration = Math.floor(nDuration);\r\n      _t.bufferLength = nBufferLength;\r\n      if (!_t._iO.isMovieStar) {\r\n        if (_t._iO.duration) {\r\n          // use options, if specified and larger\r\n          _t.durationEstimate = (_t.duration > _t._iO.duration) ? _t.duration : _t._iO.duration;\r\n        } else {\r\n          _t.durationEstimate = parseInt((_t.bytesTotal / _t.bytesLoaded) * _t.duration, 10);\r\n        }\r\n        if (_t.durationEstimate === undefined) {\r\n          _t.durationEstimate = _t.duration;\r\n        }\r\n        if (_t.readyState !== 3 && _t._iO.whileloading) {\r\n          _t._iO.whileloading.apply(_t);\r\n        }\r\n      } else {\r\n        _t.durationEstimate = _t.duration;\r\n        if (_t.readyState !== 3 && _t._iO.whileloading) {\r\n          _t._iO.whileloading.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._whileplaying = function (nPosition, oPeakData, oWaveformDataLeft, oWaveformDataRight, oEQData) {\r\n      if (isNaN(nPosition) || nPosition === null) {\r\n        return false; // flash safety net\r\n      }\r\n      _t.position = nPosition;\r\n      _t.processOnPosition();\r\n      if (!_t.isHTML5 && _fV > 8) {\r\n        if (_t._iO.usePeakData && typeof oPeakData !== 'undefined' && oPeakData) {\r\n          _t.peakData = {\r\n            left: oPeakData.leftPeak,\r\n            right: oPeakData.rightPeak\r\n          };\r\n        }\r\n        if (_t._iO.useWaveformData && typeof oWaveformDataLeft !== 'undefined' && oWaveformDataLeft) {\r\n          _t.waveformData = {\r\n            left: oWaveformDataLeft.split(','),\r\n            right: oWaveformDataRight.split(',')\r\n          };\r\n        }\r\n        if (_t._iO.useEQData) {\r\n          if (typeof oEQData !== 'undefined' && oEQData && oEQData.leftEQ) {\r\n            var eqLeft = oEQData.leftEQ.split(',');\r\n            _t.eqData = eqLeft;\r\n            _t.eqData.left = eqLeft;\r\n            if (typeof oEQData.rightEQ !== 'undefined' && oEQData.rightEQ) {\r\n              _t.eqData.right = oEQData.rightEQ.split(',');\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (_t.playState === 1) {\r\n        // special case/hack: ensure buffering is false if loading from cache (and not yet started)\r\n        if (!_t.isHTML5 && _s.flashVersion === 8 && !_t.position && _t.isBuffering) {\r\n          _t._onbufferchange(0);\r\n        }\r\n        if (_t._iO.whileplaying) {\r\n          _t._iO.whileplaying.apply(_t); // flash may call after actual finish\r\n        }\r\n        if ((_t.loaded || (!_t.loaded && _t._iO.isMovieStar)) && _t._iO.onbeforefinish && _t._iO.onbeforefinishtime && !_t.didBeforeFinish && _t.duration - _t.position <= _t._iO.onbeforefinishtime) {\r\n          _t._onbeforefinish();\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    this._onid3 = function (oID3PropNames, oID3Data) {\r\n      // oID3PropNames: string array (names)\r\n      // ID3Data: string array (data)\r\n      _s._wD('SMSound._onid3(): \"' + this.sID + '\" ID3 data received.');\r\n      var oData = [], i, j;\r\n      for (i = 0, j = oID3PropNames.length; i < j; i++) {\r\n        oData[oID3PropNames[i]] = oID3Data[i];\r\n      }\r\n      _t.id3 = _mixin(_t.id3, oData);\r\n      if (_t._iO.onid3) {\r\n        _t._iO.onid3.apply(_t);\r\n      }\r\n    };\r\n\r\n    // flash + RTMP\r\n    this._onconnect = function (bSuccess) {\r\n      var fN = 'SMSound._onconnect(): ';\r\n      bSuccess = (bSuccess === 1);\r\n      _s._wD(fN+'\"'+_t.sID+'\"'+(bSuccess?' connected.':' failed to connect? - '+_t.url), (bSuccess?1:2));\r\n      _t.connected = bSuccess;\r\n      if (bSuccess) {\r\n        _t.failures = 0;\r\n        if (_idCheck(_t.sID)) {\r\n          if (_t.getAutoPlay()) {\r\n            _t.play(undefined, _t.getAutoPlay()); // only update the play state if auto playing\r\n          } else if (_t._iO.autoLoad) {\r\n            _t.load();\r\n          }\r\n        }\r\n        if (_t._iO.onconnect) {\r\n          _t._iO.onconnect.apply(_t,[bSuccess]);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._ondataerror = function (sError) {\r\n      // flash 9 wave/eq data handler\r\n      if (_t.playState > 0) { // hack: called at start, and end from flash at/after onfinish()\r\n        _s._wD('SMSound._ondataerror(): ' + sError);\r\n        if (_t._iO.ondataerror) {\r\n          _t._iO.ondataerror.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n  }; // SMSound()\r\n\r\n  /*\r\n   * private soundManager internals\r\n  */\r\n\r\n  _getDocument = function () {\r\n    return (_doc.body || _doc._docElement || _doc.getElementsByTagName('div')[0]);\r\n  };\r\n\r\n  _id = function (sID) {\r\n    return _doc.getElementById(sID);\r\n  };\r\n\r\n  _mixin = function (oMain, oAdd) {\r\n    // non-destructive merge\r\n    var o1 = {}, i, o2, o;\r\n    for (i in oMain) { // clone c1\r\n      if (oMain.hasOwnProperty(i)) {\r\n        o1[i] = oMain[i];\r\n      }\r\n    }\r\n    o2 = (typeof oAdd === 'undefined'?_s.defaultOptions:oAdd);\r\n    for (o in o2) {\r\n      if (o2.hasOwnProperty(o) && typeof o1[o] === 'undefined') {\r\n        o1[o] = o2[o];\r\n      }\r\n    }\r\n    return o1;\r\n  };\r\n\r\n  _event = (function () {\r\n\r\n    var old = (_win.attachEvent),\r\n    evt = {\r\n      add: (old?'attachEvent':'addEventListener'),\r\n      remove: (old?'detachEvent':'removeEventListener')\r\n    };\r\n\r\n    function getArgs(oArgs) {\r\n      var args = _slice.call(oArgs), len = args.length;\r\n      if (old) {\r\n        args[1] = 'on' + args[1]; // prefix\r\n        if (len > 3) {\r\n          args.pop(); // no capture\r\n        }\r\n      } else if (len === 3) {\r\n        args.push(false);\r\n      }\r\n      return args;\r\n    }\r\n\r\n    function apply(args, sType) {\r\n      var element = args.shift(),\r\n          method = [evt[sType]];\r\n      if (old) {\r\n        element[method](args[0], args[1]);\r\n      } else {\r\n        element[method].apply(element, args);\r\n      }\r\n    }\r\n\r\n    function add() {\r\n      apply(getArgs(arguments), 'add');\r\n    }\r\n\r\n    function remove() {\r\n      apply(getArgs(arguments), 'remove');\r\n    }\r\n\r\n    return {\r\n      'add': add,\r\n      'remove': remove\r\n    };\r\n\r\n  }());\r\n\r\n  _html5OK = function (iO) {\r\n    return (!iO.serverURL && (iO.type?_html5CanPlay({type:iO.type}):_html5CanPlay({url:iO.url})||_s.html5Only)); // Use type, if specified. If HTML5-only mode, no other options, so just give 'er\r\n  };\r\n\r\n  _html5CanPlay = function (o) {\r\n\r\n    /*\r\n     * try to find MIME, test and return truthiness\r\n     * o = {\r\n     *  url: '/path/to/an.mp3',\r\n     *  type: 'audio/mp3'\r\n     * }\r\n    */\r\n\r\n    if (!_s.useHTML5Audio || !_s.hasHTML5) {\r\n      return false;\r\n    }\r\n\r\n    var url = (o.url || null),\r\n        mime = (o.type || null),\r\n        aF = _s.audioFormats,\r\n        result,\r\n        offset,\r\n        fileExt,\r\n        item;\r\n\r\n    function preferFlashCheck(kind) {\r\n      // whether flash should play a given type\r\n      return (_s.preferFlash && _hasFlash && !_s.ignoreFlash && (typeof _s.flash[kind] !== 'undefined' && _s.flash[kind]));\r\n    }\r\n\r\n    // account for known cases like audio/mp3\r\n    if (mime && _s.html5[mime] !== 'undefined') {\r\n      return (_s.html5[mime] && !preferFlashCheck(mime));\r\n    }\r\n\r\n    if (!_html5Ext) {\r\n      _html5Ext = [];\r\n      for (item in aF) {\r\n        if (aF.hasOwnProperty(item)) {\r\n          _html5Ext.push(item);\r\n          if (aF[item].related) {\r\n            _html5Ext = _html5Ext.concat(aF[item].related);\r\n          }\r\n        }\r\n      }\r\n      _html5Ext = new RegExp('\\\\.('+_html5Ext.join('|')+')(\\\\?.*)?$','i');\r\n    }\r\n\r\n    fileExt = (url ? url.toLowerCase().match(_html5Ext) : null); // TODO: Strip URL queries, etc.\r\n\r\n    if (!fileExt || !fileExt.length) {\r\n      if (!mime) {\r\n        return false;\r\n      } else {\r\n        // audio/mp3 -> mp3, result should be known\r\n        offset = mime.indexOf(';');\r\n        fileExt = (offset !== -1?mime.substr(0,offset):mime).substr(6); // strip \"audio/X; codecs..\"\r\n      }\r\n    } else {\r\n      fileExt = fileExt[1]; // match the raw extension name - \"mp3\", for example\r\n    }\r\n\r\n    if (fileExt && typeof _s.html5[fileExt] !== 'undefined') {\r\n      // result known\r\n      return (_s.html5[fileExt] && !preferFlashCheck(fileExt));\r\n    } else {\r\n      mime = 'audio/'+fileExt;\r\n      result = _s.html5.canPlayType({type:mime});\r\n      _s.html5[fileExt] = result;\r\n      // _s._wD('canPlayType, found result: '+result);\r\n      return (result && _s.html5[mime] && !preferFlashCheck(mime));\r\n    }\r\n\r\n  };\r\n\r\n  _testHTML5 = function () {\r\n\r\n    if (!_s.useHTML5Audio || typeof Audio === 'undefined') {\r\n      return false;\r\n    }\r\n\r\n    // double-whammy: Opera 9.64 throws WRONG_ARGUMENTS_ERR if no parameter passed to Audio(), and Webkit + iOS happily tries to load \"null\" as a URL. :/\r\n    var a = (typeof Audio !== 'undefined' ? (_isOpera ? new Audio(null) : new Audio()) : null),\r\n        item, support = {}, aF, i;\r\n\r\n    function _cp(m) {\r\n      var canPlay, i, j, isOK = false;\r\n      if (!a || typeof a.canPlayType !== 'function') {\r\n        return false;\r\n      }\r\n      if (m instanceof Array) {\r\n        // iterate through all mime types, return any successes\r\n        for (i=0, j=m.length; i<j && !isOK; i++) {\r\n          if (_s.html5[m[i]] || a.canPlayType(m[i]).match(_s.html5Test)) {\r\n            isOK = true;\r\n            _s.html5[m[i]] = true;\r\n            // if flash can play and preferred, also mark it for use.\r\n            _s.flash[m[i]] = !!(_s.preferFlash && _hasFlash && m[i].match(_flashMIME));\r\n          }\r\n        }\r\n        return isOK;\r\n      } else {\r\n        canPlay = (a && typeof a.canPlayType === 'function' ? a.canPlayType(m) : false);\r\n        return !!(canPlay && (canPlay.match(_s.html5Test)));\r\n      }\r\n    }\r\n\r\n    // test all registered formats + codecs\r\n    aF = _s.audioFormats;\r\n    for (item in aF) {\r\n      if (aF.hasOwnProperty(item)) {\r\n        support[item] = _cp(aF[item].type);\r\n        support['audio/'+item] = support[item]; // write back generic type too, eg. audio/mp3\r\n        // assign flash\r\n        if (_s.preferFlash && !_s.ignoreFlash && item.match(_flashMIME)) {\r\n          _s.flash[item] = true;\r\n        } else {\r\n          _s.flash[item] = false;\r\n        }\r\n        // assign result to related formats, too\r\n        if (aF[item] && aF[item].related) {\r\n          for (i=aF[item].related.length; i--;) {\r\n            support['audio/'+aF[item].related[i]] = support[item]; // eg. audio/m4a\r\n            _s.html5[aF[item].related[i]] = support[item];\r\n            _s.flash[aF[item].related[i]] = support[item];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    support.canPlayType = (a?_cp:null);\r\n    _s.html5 = _mixin(_s.html5, support);\r\n    return true;\r\n\r\n  };\r\n\r\n  _strings = {\r\n    // <d>\r\n    notReady: 'Not loaded yet - wait for soundManager.onload()/onready()',\r\n    notOK: 'Audio support is not available.',\r\n    domError: _smc + 'createMovie(): appendChild/innerHTML call failed. DOM not ready or other error.',\r\n    spcWmode: _smc + 'createMovie(): Removing wmode, preventing known SWF loading issue(s)',\r\n    swf404: _sm + ': Verify that %s is a valid path.',\r\n    tryDebug: 'Try ' + _sm + '.debugFlash = true for more security details (output goes to SWF.)',\r\n    checkSWF: 'See SWF output for more debug info.',\r\n    localFail: _sm + ': Non-HTTP page (' + _doc.location.protocol + ' URL?) Review Flash player security settings for this special case:\\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/',\r\n    waitFocus: _sm + ': Special case: Waiting for focus-related event..',\r\n    waitImpatient: _sm + ': Getting impatient, still waiting for Flash%s...',\r\n    waitForever: _sm + ': Waiting indefinitely for Flash (will recover if unblocked)...',\r\n    needFunction: _sm + ': Function object expected for %s',\r\n    badID: 'Warning: Sound ID \"%s\" should be a string, starting with a non-numeric character',\r\n    noMS: 'MovieStar mode not enabled. Exiting.',\r\n    currentObj: '--- ' + _sm + '._debug(): Current sound objects ---',\r\n    waitEI: _smc + 'initMovie(): Waiting for ExternalInterface call from Flash..',\r\n    waitOnload: _sm + ': Waiting for window.onload()',\r\n    docLoaded: _sm + ': Document already loaded',\r\n    onload: _smc + 'initComplete(): calling soundManager.onload()',\r\n    onloadOK: _sm + '.onload() complete',\r\n    init: _smc + 'init()',\r\n    didInit: _smc + 'init(): Already called?',\r\n    flashJS: _sm + ': Attempting to call Flash from JS..',\r\n    noPolling: _sm + ': Polling (whileloading()/whileplaying() support) is disabled.',\r\n    secNote: 'Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html',\r\n    badRemove: 'Warning: Failed to remove flash movie.',\r\n    noPeak: 'Warning: peakData features unsupported for movieStar formats',\r\n    shutdown: _sm + '.disable(): Shutting down',\r\n    queue: _sm + ': Queueing %s handler',\r\n    smFail: _sm + ': Failed to initialise.',\r\n    smError: 'SMSound.load(): Exception: JS-Flash communication failed, or JS error.',\r\n    fbTimeout: 'No flash response, applying .'+_s.swfCSS.swfTimedout+' CSS..',\r\n    fbLoaded: 'Flash loaded',\r\n    fbHandler: _smc+'flashBlockHandler()',\r\n    manURL: 'SMSound.load(): Using manually-assigned URL',\r\n    onURL: _sm + '.load(): current URL already assigned.',\r\n    badFV: _sm + '.flashVersion must be 8 or 9. \"%s\" is invalid. Reverting to %s.',\r\n    as2loop: 'Note: Setting stream:false so looping can work (flash 8 limitation)',\r\n    noNSLoop: 'Note: Looping not implemented for MovieStar formats',\r\n    needfl9: 'Note: Switching to flash 9, required for MP4 formats.',\r\n    mfTimeout: 'Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case',\r\n    mfOn: 'mobileFlash::enabling on-screen flash repositioning',\r\n    policy: 'Enabling usePolicyFile for data access'\r\n    // </d>\r\n  };\r\n\r\n  _str = function () { // o [,items to replace]\r\n    // <d>\r\n    var args = _slice.call(arguments), // real array, please\r\n    o = args.shift(), // first arg\r\n    str = (_strings && _strings[o]?_strings[o]:''), i, j;\r\n    if (str && args && args.length) {\r\n      for (i = 0, j = args.length; i < j; i++) {\r\n        str = str.replace('%s', args[i]);\r\n      }\r\n    }\r\n    return str;\r\n    // </d>\r\n  };\r\n\r\n  _loopFix = function (sOpt) {\r\n    // flash 8 requires stream = false for looping to work\r\n    if (_fV === 8 && sOpt.loops > 1 && sOpt.stream) {\r\n      _wDS('as2loop');\r\n      sOpt.stream = false;\r\n    }\r\n    return sOpt;\r\n  };\r\n\r\n  _policyFix = function (sOpt, sPre) {\r\n    if (sOpt && !sOpt.usePolicyFile && (sOpt.onid3 || sOpt.usePeakData || sOpt.useWaveformData || sOpt.useEQData)) {\r\n      _s._wD((sPre || '') + _str('policy'));\r\n      sOpt.usePolicyFile = true;\r\n    }\r\n    return sOpt;\r\n  };\r\n\r\n  _complain = function (sMsg) {\r\n    if (typeof console !== 'undefined' && typeof console.warn !== 'undefined') {\r\n      console.warn(sMsg);\r\n    } else {\r\n      _s._wD(sMsg);\r\n    }\r\n  };\r\n\r\n  _doNothing = function () {\r\n    return false;\r\n  };\r\n\r\n  _disableObject = function (o) {\r\n    var oProp;\r\n    for (oProp in o) {\r\n      if (o.hasOwnProperty(oProp) && typeof o[oProp] === 'function') {\r\n        o[oProp] = _doNothing;\r\n      }\r\n    }\r\n    oProp = null;\r\n  };\r\n\r\n  _failSafely = function (bNoDisable) {\r\n    // general failure exception handler\r\n    if (typeof bNoDisable === 'undefined') {\r\n      bNoDisable = false;\r\n    }\r\n    if (_disabled || bNoDisable) {\r\n      _wDS('smFail', 2);\r\n      _s.disable(bNoDisable);\r\n    }\r\n  };\r\n\r\n  _normalizeMovieURL = function (smURL) {\r\n    var urlParams = null;\r\n    if (smURL) {\r\n      if (smURL.match(/\\.swf(\\?.*)?$/i)) {\r\n        urlParams = smURL.substr(smURL.toLowerCase().lastIndexOf('.swf?') + 4);\r\n        if (urlParams) {\r\n          return smURL; // assume user knows what they're doing\r\n        }\r\n      } else if (smURL.lastIndexOf('/') !== smURL.length - 1) {\r\n        smURL = smURL + '/';\r\n      }\r\n    }\r\n    return (smURL && smURL.lastIndexOf('/') !== - 1?smURL.substr(0, smURL.lastIndexOf('/') + 1):'./') + _s.movieURL;\r\n  };\r\n\r\n  _setVersionInfo = function () {\r\n\r\n    if (_fV !== 8 && _fV !== 9) {\r\n      _s._wD(_str('badFV', _fV, _defaultFlashVersion));\r\n      _s.flashVersion = _defaultFlashVersion;\r\n    }\r\n    var isDebug = (_s.debugMode || _s.debugFlash?'_debug.swf':'.swf'); // debug flash movie, if applicable\r\n    if (_s.useHTML5Audio && !_s.html5Only && _s.audioFormats.mp4.required && _s.flashVersion < 9) {\r\n      _s._wD(_str('needfl9'));\r\n      _s.flashVersion = 9;\r\n    }\r\n    _fV = _s.flashVersion; // short-hand for internal use\r\n    _s.version = _s.versionNumber + (_s.html5Only?' (HTML5-only mode)':(_fV === 9?' (AS3/Flash 9)':' (AS2/Flash 8)'));\r\n    // set up default options\r\n    if (_fV > 8) {\r\n      _s.defaultOptions = _mixin(_s.defaultOptions, _s.flash9Options);\r\n      _s.features.buffering = true;\r\n    }\r\n    if (_fV > 8 && _s.useMovieStar) {\r\n      // flash 9+ support for movieStar formats as well as MP3\r\n      _s.defaultOptions = _mixin(_s.defaultOptions, _s.movieStarOptions);\r\n      _s.filePatterns.flash9 = new RegExp('\\\\.(mp3|' + _s.netStreamTypes.join('|') + ')(\\\\?.*)?$', 'i');\r\n      _s.mimePattern = _s.netStreamMimeTypes;\r\n      _s.features.movieStar = true;\r\n    } else {\r\n      _s.useMovieStar = false;\r\n      _s.features.movieStar = false;\r\n    }\r\n    _s.filePattern = _s.filePatterns[(_fV !== 8?'flash9':'flash8')];\r\n    _s.movieURL = (_fV === 8?'soundmanager2.swf':'soundmanager2_flash9.swf').replace('.swf',isDebug);\r\n    _s.features.peakData = _s.features.waveformData = _s.features.eqData = (_fV > 8);\r\n  };\r\n\r\n  _setPolling = function (bPolling, bHighPerformance) {\r\n    if (!_s.o || !_s.allowPolling) {\r\n      return false;\r\n    }\r\n    _s.o._setPolling(bPolling, bHighPerformance);\r\n  };\r\n\r\n  _initDebug = function () {\r\n    if (_s.debugURLParam.test(_wl)) {\r\n      _s.debugMode = true; // allow force of debug mode via URL\r\n    }\r\n    // <d>\r\n    if (_id(_s.debugID)) {\r\n      return false;\r\n    }\r\n    var oD, oDebug, oTarget, oToggle, tmp;\r\n    if (_s.debugMode && !_id(_s.debugID) && ((!_hasConsole || !_s.useConsole) || (_s.useConsole && _hasConsole && !_s.consoleOnly))) {\r\n      oD = _doc.createElement('div');\r\n      oD.id = _s.debugID + '-toggle';\r\n      oToggle = {\r\n        'position': 'fixed',\r\n        'bottom': '0px',\r\n        'right': '0px',\r\n        'width': '1.2em',\r\n        'height': '1.2em',\r\n        'lineHeight': '1.2em',\r\n        'margin': '2px',\r\n        'textAlign': 'center',\r\n        'border': '1px solid #999',\r\n        'cursor': 'pointer',\r\n        'background': '#fff',\r\n        'color': '#333',\r\n        'zIndex': 10001\r\n      };\r\n      oD.appendChild(_doc.createTextNode('-'));\r\n      oD.onclick = _toggleDebug;\r\n      oD.title = 'Toggle SM2 debug console';\r\n      if (_ua.match(/msie 6/i)) {\r\n        oD.style.position = 'absolute';\r\n        oD.style.cursor = 'hand';\r\n      }\r\n      for (tmp in oToggle) {\r\n        if (oToggle.hasOwnProperty(tmp)) {\r\n          oD.style[tmp] = oToggle[tmp];\r\n        }\r\n      }\r\n      oDebug = _doc.createElement('div');\r\n      oDebug.id = _s.debugID;\r\n      oDebug.style.display = (_s.debugMode?'block':'none');\r\n      if (_s.debugMode && !_id(oD.id)) {\r\n        try {\r\n          oTarget = _getDocument();\r\n          oTarget.appendChild(oD);\r\n        } catch(e2) {\r\n          throw new Error(_str('domError')+' \\n'+e2.toString());\r\n        }\r\n        oTarget.appendChild(oDebug);\r\n      }\r\n    }\r\n    oTarget = null;\r\n    // </d>\r\n  };\r\n\r\n  _idCheck = this.getSoundById;\r\n\r\n  // <d>\r\n  _wDS = function (o, errorLevel) {\r\n    if (!o) {\r\n      return '';\r\n    } else {\r\n      return _s._wD(_str(o), errorLevel);\r\n    }\r\n  };\r\n\r\n  // last-resort debugging option\r\n  if (_wl.indexOf('sm2-debug=alert') + 1 && _s.debugMode) {\r\n    _s._wD = function (sText) {window.alert(sText);};\r\n  }\r\n\r\n  _toggleDebug = function () {\r\n    var o = _id(_s.debugID),\r\n    oT = _id(_s.debugID + '-toggle');\r\n    if (!o) {\r\n      return false;\r\n    }\r\n    if (_debugOpen) {\r\n      // minimize\r\n      oT.innerHTML = '+';\r\n      o.style.display = 'none';\r\n    } else {\r\n      oT.innerHTML = '-';\r\n      o.style.display = 'block';\r\n    }\r\n    _debugOpen = !_debugOpen;\r\n  };\r\n\r\n  _debugTS = function (sEventType, bSuccess, sMessage) {\r\n    // troubleshooter debug hooks\r\n    if (typeof sm2Debugger !== 'undefined') {\r\n      try {\r\n        sm2Debugger.handleEvent(sEventType, bSuccess, sMessage);\r\n      } catch(e) {\r\n        // oh well\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n  // </d>\r\n\r\n  _getSWFCSS = function () {\r\n    var css = [];\r\n    if (_s.debugMode) {\r\n      css.push(_s.swfCSS.sm2Debug);\r\n    }\r\n    if (_s.debugFlash) {\r\n      css.push(_s.swfCSS.flashDebug);\r\n    }\r\n    if (_s.useHighPerformance) {\r\n      css.push(_s.swfCSS.highPerf);\r\n    }\r\n    return css.join(' ');\r\n  };\r\n\r\n  _flashBlockHandler = function () {\r\n    // *possible* flash block situation.\r\n    var name = _str('fbHandler'),\r\n        p = _s.getMoviePercent(),\r\n        css = _s.swfCSS,\r\n        error = {type:'FLASHBLOCK'};\r\n    if (_s.html5Only) {\r\n      return false;\r\n    }\r\n    if (!_s.ok()) {\r\n      if (_needsFlash) {\r\n        // make the movie more visible, so user can fix\r\n        _s.oMC.className = _getSWFCSS() + ' ' + css.swfDefault + ' ' + (p === null?css.swfTimedout:css.swfError);\r\n        _s._wD(name+': '+_str('fbTimeout')+(p?' ('+_str('fbLoaded')+')':''));\r\n      }\r\n      _s.didFlashBlock = true;\r\n      _processOnEvents({type:'ontimeout', ignoreInit:true, error:error}); // fire onready(), complain lightly\r\n      _catchError(error);\r\n    } else {\r\n      // SM2 loaded OK (or recovered)\r\n      if (_s.didFlashBlock) {\r\n        _s._wD(name+': Unblocked');\r\n      }\r\n      if (_s.oMC) {\r\n        _s.oMC.className = [_getSWFCSS(), css.swfDefault, css.swfLoaded + (_s.didFlashBlock?' '+css.swfUnblocked:'')].join(' ');\r\n      }\r\n    }\r\n  };\r\n\r\n  _addOnEvent = function (sType, oMethod, oScope) {\r\n    if (typeof _on_queue[sType] === 'undefined') {\r\n      _on_queue[sType] = [];\r\n    }\r\n    _on_queue[sType].push({\r\n      'method': oMethod,\r\n      'scope': (oScope || null),\r\n      'fired': false\r\n    });\r\n  };\r\n\r\n  _processOnEvents = function (oOptions) {\r\n    if (!oOptions) { // assume onready, if unspecified\r\n      oOptions = {\r\n        type: 'onready'\r\n      };\r\n    }\r\n    if (!_didInit && oOptions && !oOptions.ignoreInit) {\r\n      // not ready yet.\r\n      return false;\r\n    }\r\n    if (oOptions.type === 'ontimeout' && _s.ok()) {\r\n      // invalid case\r\n      return false;\r\n    }\r\n    var status = {\r\n          success: (oOptions && oOptions.ignoreInit?_s.ok():!_disabled)\r\n        },\r\n        srcQueue = (oOptions && oOptions.type?_on_queue[oOptions.type]||[]:[]), // queue specified by type, or none\r\n        queue = [], i, j,\r\n        args = [status],\r\n        canRetry = (_needsFlash && _s.useFlashBlock && !_s.ok());\r\n    if (oOptions.error) {\r\n      args[0].error = oOptions.error;\r\n    }\r\n    for (i = 0, j = srcQueue.length; i < j; i++) {\r\n      if (srcQueue[i].fired !== true) {\r\n        queue.push(srcQueue[i]);\r\n      }\r\n    }\r\n    if (queue.length) {\r\n      _s._wD(_sm + ': Firing ' + queue.length + ' '+oOptions.type+'() item' + (queue.length === 1?'':'s'));\r\n      for (i = 0, j = queue.length; i < j; i++) {\r\n        if (queue[i].scope) {\r\n          queue[i].method.apply(queue[i].scope, args);\r\n        } else {\r\n          queue[i].method.apply(this, args);\r\n        }\r\n        if (!canRetry) { // flashblock case doesn't count here\r\n          queue[i].fired = true;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _initUserOnload = function () {\r\n    _win.setTimeout(function () {\r\n      if (_s.useFlashBlock) {\r\n        _flashBlockHandler();\r\n      }\r\n      _processOnEvents();\r\n      // call user-defined \"onload\", scoped to window\r\n      if (_s.onload instanceof Function) {\r\n        _wDS('onload', 1);\r\n        _s.onload.apply(_win);\r\n        _wDS('onloadOK', 1);\r\n      }\r\n      if (_s.waitForWindowLoad) {\r\n        _event.add(_win, 'load', _initUserOnload);\r\n      }\r\n    },1);\r\n  };\r\n\r\n  _detectFlash = function () {\r\n\r\n    // hat tip: Flash Detect library (BSD, (C) 2007) by Carl \"DocYes\" S. Yestrau - http://featureblend.com/javascript-flash-detection-library.html / http://featureblend.com/license.txt\r\n\r\n    if (_hasFlash !== undefined) {\r\n      // this work has already been done.\r\n      return _hasFlash;\r\n    }\r\n\r\n    var hasPlugin = false, n = navigator, nP = n.plugins, obj, type, types, AX = _win.ActiveXObject;\r\n\r\n    if (nP && nP.length) {\r\n\r\n      type = 'application/x-shockwave-flash';\r\n      types = n.mimeTypes;\r\n      if (types && types[type] && types[type].enabledPlugin && types[type].enabledPlugin.description) {\r\n        hasPlugin = true;\r\n      }\r\n\r\n    } else if (typeof AX !== 'undefined') {\r\n\r\n      try {\r\n        obj = new AX('ShockwaveFlash.ShockwaveFlash');\r\n      } catch(e) {\r\n        // oh well\r\n      }\r\n      hasPlugin = (!!obj);\r\n\r\n    }\r\n\r\n    _hasFlash = hasPlugin;\r\n\r\n    return hasPlugin;\r\n\r\n  };\r\n\r\n  _featureCheck = function () {\r\n\r\n    var needsFlash, item,\r\n        isSpecial = (_ua.match(/iphone os (1|2|3_0|3_1)/i)?true:false); // iPhone <= 3.1 has broken HTML5 audio(), but firmware 3.2 (iPad) + iOS4 works.\r\n\r\n    if (isSpecial) {\r\n      _s.hasHTML5 = false; // has Audio(), but is broken; let it load links directly.\r\n      _s.html5Only = true; // ignore flash case, however\r\n      if (_s.oMC) {\r\n        _s.oMC.style.display = 'none';\r\n      }\r\n      return false;\r\n    }\r\n\r\n    if (_s.useHTML5Audio) {\r\n      if (!_s.html5 || !_s.html5.canPlayType) {\r\n        _s._wD('SoundManager: No HTML5 Audio() support detected.');\r\n        _s.hasHTML5 = false;\r\n        return true;\r\n      } else {\r\n        _s.hasHTML5 = true;\r\n      }\r\n      if (_isBadSafari) {\r\n        _s._wD(_smc+'Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - '+(!_hasFlash?' would use flash fallback for MP3/MP4, but none detected.':'will use flash fallback for MP3/MP4, if available'),1);\r\n        if (_detectFlash()) {\r\n          return true;\r\n        }\r\n      }\r\n    } else {\r\n      // flash needed (or, HTML5 needs enabling.)\r\n      return true;\r\n    }\r\n\r\n    for (item in _s.audioFormats) {\r\n      if (_s.audioFormats.hasOwnProperty(item)) {\r\n        if ( (_s.audioFormats[item].required && !_s.html5.canPlayType(_s.audioFormats[item].type)) || _s.flash[item] || _s.flash[_s.audioFormats[item].type]) {\r\n          // flash may be required, or preferred for this format\r\n          needsFlash = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    // sanity check..\r\n    if (_s.ignoreFlash) {\r\n      needsFlash = false;\r\n    }\r\n\r\n    _s.html5Only = (_s.hasHTML5 && _s.useHTML5Audio && !needsFlash);\r\n\r\n    return (!_s.html5Only);\r\n\r\n  };\r\n\r\n  _startTimer = function (oSound) {\r\n    if (!oSound._hasTimer) {\r\n      oSound._hasTimer = true;\r\n    }\r\n  };\r\n\r\n  _stopTimer = function (oSound) {\r\n    if (oSound._hasTimer) {\r\n      oSound._hasTimer = false;\r\n    }\r\n  };\r\n\r\n  _catchError = function (options) {\r\n    options = (typeof options !== 'undefined' ? options : {});\r\n    if (_s.onerror instanceof Function) {\r\n      _s.onerror.apply(_win, [{type:(typeof options.type !== 'undefined' ? options.type : null)}]);\r\n    }\r\n    if (typeof options.fatal !== 'undefined' && options.fatal) {\r\n      _s.disable();\r\n    }\r\n  };\r\n\r\n  _badSafariFix = function () {\r\n    // special case: \"bad\" Safari (OS X 10.3 - 10.7) must fall back to flash for MP3/MP4\r\n    if (!_isBadSafari || !_detectFlash()) {\r\n      return false; // doesn't apply\r\n    }\r\n    var aF = _s.audioFormats, i, item;\r\n    for (item in aF) {\r\n      if (aF.hasOwnProperty(item)) {\r\n        if (item === 'mp3' || item === 'mp4') {\r\n          _s._wD(_sm+': Using flash fallback for '+item+' format');\r\n          _s.html5[item] = false;\r\n          // assign result to related formats, too\r\n          if (aF[item] && aF[item].related) {\r\n            for (i = aF[item].related.length; i--;) {\r\n              _s.html5[aF[item].related[i]] = false;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /*\r\n   * pseudo-private flash/ExternalInterface methods\r\n  */\r\n\r\n  this._setSandboxType = function (sandboxType) {\r\n    // <d>\r\n    var sb = _s.sandbox;\r\n    sb.type = sandboxType;\r\n    sb.description = sb.types[(typeof sb.types[sandboxType] !== 'undefined'?sandboxType:'unknown')];\r\n    _s._wD('Flash security sandbox type: ' + sb.type);\r\n    if (sb.type === 'localWithFile') {\r\n      sb.noRemote = true;\r\n      sb.noLocal = false;\r\n      _wDS('secNote', 2);\r\n    } else if (sb.type === 'localWithNetwork') {\r\n      sb.noRemote = false;\r\n      sb.noLocal = true;\r\n    } else if (sb.type === 'localTrusted') {\r\n      sb.noRemote = false;\r\n      sb.noLocal = false;\r\n    }\r\n    // </d>\r\n  };\r\n\r\n  this._externalInterfaceOK = function (flashDate) {\r\n    // flash callback confirming flash loaded, EI working etc.\r\n    // flashDate = approx. timing/delay info for JS/flash bridge\r\n    if (_s.swfLoaded) {\r\n      return false;\r\n    }\r\n    var eiTime = new Date().getTime();\r\n    _s._wD(_smc+'externalInterfaceOK()' + (flashDate?' (~' + (eiTime - flashDate) + ' ms)':''));\r\n    _debugTS('swf', true);\r\n    _debugTS('flashtojs', true);\r\n    _s.swfLoaded = true;\r\n    _tryInitOnFocus = false;\r\n    if (_isBadSafari) {\r\n      _badSafariFix();\r\n    }\r\n    if (_isIE) {\r\n      // IE needs a timeout OR delay until window.onload - may need TODO: investigating\r\n      setTimeout(_init, 100);\r\n    } else {\r\n      _init();\r\n    }\r\n  };\r\n\r\n  /*\r\n   * private initialization helpers\r\n  */\r\n\r\n  _createMovie = function (smID, smURL) {\r\n\r\n    if (_didAppend && _appendSuccess) {\r\n      return false; // ignore if already succeeded\r\n    }\r\n\r\n    function _initMsg() {\r\n      _s._wD('-- SoundManager 2 ' + _s.version + (!_s.html5Only && _s.useHTML5Audio?(_s.hasHTML5?' + HTML5 audio':', no HTML5 audio support'):'') + (!_s.html5Only ? (_s.useMovieStar?', MovieStar mode':'') + (_s.useHighPerformance?', high performance mode, ':', ') + (( _s.flashPollingInterval ? 'custom (' + _s.flashPollingInterval + 'ms)' : (_s.useFastPolling?'fast':'normal')) + ' polling') + (_s.wmode?', wmode: ' + _s.wmode:'') + (_s.debugFlash?', flash debug mode':'') + (_s.useFlashBlock?', flashBlock mode':'') : '') + ' --', 1);\r\n    }\r\n\r\n    if (_s.html5Only) {\r\n      // 100% HTML5 mode\r\n      _setVersionInfo();\r\n      _initMsg();\r\n      _s.oMC = _id(_s.movieID);\r\n      _init();\r\n      // prevent multiple init attempts\r\n      _didAppend = true;\r\n      _appendSuccess = true;\r\n      return false;\r\n    }\r\n\r\n    // flash path\r\n    var remoteURL = (smURL || _s.url),\r\n    localURL = (_s.altURL || remoteURL),\r\n    swfTitle = 'JS/Flash audio component (SoundManager 2)',\r\n    oEmbed, oMovie, oTarget = _getDocument(), tmp, movieHTML, oEl, extraClass = _getSWFCSS(), s, x, sClass, side = 'auto', isRTL = null, html = _doc.getElementsByTagName('html')[0];\r\n\r\n    isRTL = (html && html.dir && html.dir.match(/rtl/i));\r\n    smID = (typeof smID === 'undefined'?_s.id:smID);\r\n\r\n    function param(name, value) {\r\n      return '<param name=\"'+name+'\" value=\"'+value+'\" />';\r\n    }\r\n\r\n    // safety check for legacy (change to Flash 9 URL)\r\n    _setVersionInfo();\r\n    _s.url = _normalizeMovieURL(_overHTTP?remoteURL:localURL);\r\n    smURL = _s.url;\r\n\r\n    _s.wmode = (!_s.wmode && _s.useHighPerformance && !_s.useMovieStar?'transparent':_s.wmode);\r\n\r\n    if (_s.wmode !== null && (_ua.match(/msie 8/i) || (!_isIE && !_s.useHighPerformance)) && navigator.platform.match(/win32|win64/i)) {\r\n      /*\r\n       * extra-special case: movie doesn't load until scrolled into view when using wmode = anything but 'window' here\r\n       * does not apply when using high performance (position:fixed means on-screen), OR infinite flash load timeout\r\n       * wmode breaks IE 8 on Vista + Win7 too in some cases, as of January 2011 (?)\r\n      */\r\n      _s.specialWmodeCase = true;\r\n      _wDS('spcWmode');\r\n      _s.wmode = null;\r\n    }\r\n\r\n    oEmbed = {\r\n      'name': smID,\r\n      'id': smID,\r\n      'src': smURL,\r\n      'width': side,\r\n      'height': side,\r\n      'quality': 'high',\r\n      'allowScriptAccess': _s.allowScriptAccess,\r\n      'bgcolor': _s.bgColor,\r\n      'pluginspage': _http+'//www.macromedia.com/go/getflashplayer',\r\n      'title': swfTitle,\r\n      'type': 'application/x-shockwave-flash',\r\n      'wmode': _s.wmode,\r\n      'hasPriority': 'true' // http://help.adobe.com/en_US/as3/mobile/WS4bebcd66a74275c36cfb8137124318eebc6-7ffd.html\r\n    };\r\n\r\n    if (_s.debugFlash) {\r\n      oEmbed.FlashVars = 'debug=1';\r\n    }\r\n\r\n    if (!_s.wmode) {\r\n      delete oEmbed.wmode; // don't write empty attribute\r\n    }\r\n\r\n    if (_isIE) {\r\n\r\n      // IE is \"special\".\r\n      oMovie = _doc.createElement('div');\r\n      movieHTML = [\r\n        '<object id=\"' + smID + '\" data=\"' + smURL + '\" type=\"' + oEmbed.type + '\" title=\"' + oEmbed.title +'\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"' + _http+'//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0\" width=\"' + oEmbed.width + '\" height=\"' + oEmbed.height + '\">',\r\n        param('movie', smURL),\r\n        param('AllowScriptAccess', _s.allowScriptAccess),\r\n        param('quality', oEmbed.quality),\r\n        (_s.wmode? param('wmode', _s.wmode): ''),\r\n        param('bgcolor', _s.bgColor),\r\n        param('hasPriority', 'true'),\r\n        (_s.debugFlash ? param('FlashVars', oEmbed.FlashVars) : ''),\r\n        '</object>'\r\n      ].join('');\r\n\r\n    } else {\r\n\r\n      oMovie = _doc.createElement('embed');\r\n      for (tmp in oEmbed) {\r\n        if (oEmbed.hasOwnProperty(tmp)) {\r\n          oMovie.setAttribute(tmp, oEmbed[tmp]);\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    _initDebug();\r\n    extraClass = _getSWFCSS();\r\n    oTarget = _getDocument();\r\n\r\n    if (oTarget) {\r\n\r\n      _s.oMC = (_id(_s.movieID) || _doc.createElement('div'));\r\n\r\n      if (!_s.oMC.id) {\r\n\r\n        _s.oMC.id = _s.movieID;\r\n        _s.oMC.className = _s.swfCSS.swfDefault + ' ' + extraClass;\r\n        s = null;\r\n        oEl = null;\r\n\r\n        if (!_s.useFlashBlock) {\r\n          if (_s.useHighPerformance) {\r\n            // on-screen at all times\r\n            s = {\r\n              'position': 'fixed',\r\n              'width': '8px',\r\n              'height': '8px',\r\n              // >= 6px for flash to run fast, >= 8px to start up under Firefox/win32 in some cases. odd? yes.\r\n              'bottom': '0px',\r\n              'left': '0px',\r\n              'overflow': 'hidden'\r\n            };\r\n          } else {\r\n            // hide off-screen, lower priority\r\n            s = {\r\n              'position': 'absolute',\r\n              'width': '6px',\r\n              'height': '6px',\r\n              'top': '-9999px',\r\n              'left': '-9999px'\r\n            };\r\n            if (isRTL) {\r\n              s.left = Math.abs(parseInt(s.left,10))+'px';\r\n            }\r\n          }\r\n        }\r\n\r\n        if (_isWebkit) {\r\n          _s.oMC.style.zIndex = 10000; // soundcloud-reported render/crash fix, safari 5\r\n        }\r\n\r\n        if (!_s.debugFlash) {\r\n          for (x in s) {\r\n            if (s.hasOwnProperty(x)) {\r\n              _s.oMC.style[x] = s[x];\r\n            }\r\n          }\r\n        }\r\n\r\n        try {\r\n          if (!_isIE) {\r\n            _s.oMC.appendChild(oMovie);\r\n          }\r\n          oTarget.appendChild(_s.oMC);\r\n          if (_isIE) {\r\n            oEl = _s.oMC.appendChild(_doc.createElement('div'));\r\n            oEl.className = _s.swfCSS.swfBox;\r\n            oEl.innerHTML = movieHTML;\r\n          }\r\n          _appendSuccess = true;\r\n        } catch(e) {\r\n          throw new Error(_str('domError')+' \\n'+e.toString());\r\n        }\r\n\r\n      } else {\r\n\r\n        // SM2 container is already in the document (eg. flashblock use case)\r\n        sClass = _s.oMC.className;\r\n        _s.oMC.className = (sClass?sClass+' ':_s.swfCSS.swfDefault) + (extraClass?' '+extraClass:'');\r\n        _s.oMC.appendChild(oMovie);\r\n        if (_isIE) {\r\n          oEl = _s.oMC.appendChild(_doc.createElement('div'));\r\n          oEl.className = _s.swfCSS.swfBox;\r\n          oEl.innerHTML = movieHTML;\r\n        }\r\n        _appendSuccess = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _didAppend = true;\r\n    _initMsg();\r\n    _s._wD(_smc+'createMovie(): Trying to load ' + smURL + (!_overHTTP && _s.altURL?' (alternate URL)':''), 1);\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  _initMovie = function () {\r\n\r\n    if (_s.html5Only) {\r\n      _createMovie();\r\n      return false;\r\n    }\r\n\r\n    // attempt to get, or create, movie\r\n    if (_s.o) {\r\n      return false; // may already exist\r\n    }\r\n\r\n    _s.o = _s.getMovie(_s.id); // inline markup\r\n\r\n    if (!_s.o) {\r\n      if (!_oRemoved) {\r\n        // try to create\r\n        _createMovie(_s.id, _s.url);\r\n      } else {\r\n        // try to re-append removed movie after reboot()\r\n        if (!_isIE) {\r\n          _s.oMC.appendChild(_oRemoved);\r\n        } else {\r\n          _s.oMC.innerHTML = _oRemovedHTML;\r\n        }\r\n        _oRemoved = null;\r\n        _didAppend = true;\r\n      }\r\n      _s.o = _s.getMovie(_s.id);\r\n    }\r\n\r\n    if (_s.o) {\r\n      _wDS('waitEI');\r\n    }\r\n\r\n    if (_s.oninitmovie instanceof Function) {\r\n      setTimeout(_s.oninitmovie, 1);\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  _delayWaitForEI = function () {\r\n    setTimeout(_waitForEI, 1000);\r\n  };\r\n\r\n  _waitForEI = function () {\r\n\r\n    if (_waitingForEI) {\r\n      return false;\r\n    }\r\n\r\n    _waitingForEI = true;\r\n    _event.remove(_win, 'load', _delayWaitForEI);\r\n\r\n    if (_tryInitOnFocus && !_isFocused) {\r\n      // giant Safari 3.1 hack - assume mousemove = focus given lack of focus event\r\n      _wDS('waitFocus');\r\n      return false;\r\n    }\r\n\r\n    var p;\r\n    if (!_didInit) {\r\n      p = _s.getMoviePercent();\r\n      _s._wD(_str('waitImpatient', (p === 100?' (SWF loaded)':(p > 0?' (SWF ' + p + '% loaded)':''))));\r\n    }\r\n\r\n    setTimeout(function () {\r\n\r\n      p = _s.getMoviePercent();\r\n\r\n      if (!_didInit) {\r\n        _s._wD(_sm + ': No Flash response within expected time.\\nLikely causes: ' + (p === 0?'Loading ' + _s.movieURL + ' may have failed (and/or Flash ' + _fV + '+ not present?), ':'') + 'Flash blocked or JS-Flash security error.' + (_s.debugFlash?' ' + _str('checkSWF'):''), 2);\r\n        if (!_overHTTP && p) {\r\n          _wDS('localFail', 2);\r\n          if (!_s.debugFlash) {\r\n            _wDS('tryDebug', 2);\r\n          }\r\n        }\r\n        if (p === 0) {\r\n          // if 0 (not null), probably a 404.\r\n          _s._wD(_str('swf404', _s.url));\r\n        }\r\n        _debugTS('flashtojs', false, ': Timed out' + _overHTTP?' (Check flash security or flash blockers)':' (No plugin/missing SWF?)');\r\n      }\r\n\r\n      // give up / time-out, depending\r\n      if (!_didInit && _okToDisable) {\r\n        if (p === null) {\r\n          // SWF failed. Maybe blocked.\r\n          if (_s.useFlashBlock || _s.flashLoadTimeout === 0) {\r\n            if (_s.useFlashBlock) {\r\n              _flashBlockHandler();\r\n            }\r\n            _wDS('waitForever');\r\n          } else {\r\n            // old SM2 behaviour, simply fail\r\n            _failSafely(true);\r\n          }\r\n\r\n        } else {\r\n          // flash loaded? Shouldn't be a blocking issue, then.\r\n          if (_s.flashLoadTimeout === 0) {\r\n             _wDS('waitForever');\r\n          } else {\r\n            _failSafely(true);\r\n          }\r\n        }\r\n      }\r\n\r\n    }, _s.flashLoadTimeout);\r\n\r\n  };\r\n\r\n  _handleFocus = function () {\r\n    function cleanup() {\r\n      _event.remove(_win, 'focus', _handleFocus);\r\n      _event.remove(_win, 'load', _handleFocus);\r\n    }\r\n    if (_isFocused || !_tryInitOnFocus) {\r\n      cleanup();\r\n      return true;\r\n    }\r\n    _okToDisable = true;\r\n    _isFocused = true;\r\n    _s._wD(_smc+'handleFocus()');\r\n    if (_isSafari && _tryInitOnFocus) {\r\n      _event.remove(_win, 'mousemove', _handleFocus);\r\n    }\r\n    // allow init to restart\r\n    _waitingForEI = false;\r\n    cleanup();\r\n    return true;\r\n  };\r\n\r\n  _initComplete = function (bNoDisable) {\r\n    if (_didInit) {\r\n      return false;\r\n    }\r\n    if (_s.html5Only) {\r\n      // all good.\r\n      _s._wD('-- SoundManager 2: loaded --');\r\n      _didInit = true;\r\n      _initUserOnload();\r\n      _debugTS('onload', true);\r\n      return true;\r\n    }\r\n    var wasTimeout = (_s.useFlashBlock && _s.flashLoadTimeout && !_s.getMoviePercent()),\r\n        error;\r\n    if (!wasTimeout) {\r\n      _didInit = true;\r\n      if (_disabled) {\r\n        error = {type: (!_hasFlash && _needsFlash ? 'NO_FLASH' : 'INIT_TIMEOUT')};\r\n      }\r\n    }\r\n    _s._wD('-- SoundManager 2 ' + (_disabled?'failed to load':'loaded') + ' (' + (_disabled?'security/load error':'OK') + ') --', 1);\r\n    if (_disabled || bNoDisable) {\r\n      if (_s.useFlashBlock && _s.oMC) {\r\n        _s.oMC.className = _getSWFCSS() + ' ' + (_s.getMoviePercent() === null?_s.swfCSS.swfTimedout:_s.swfCSS.swfError);\r\n      }\r\n      _processOnEvents({type:'ontimeout', error:error});\r\n      _debugTS('onload', false);\r\n      _catchError(error);\r\n      return false;\r\n    } else {\r\n      _debugTS('onload', true);\r\n    }\r\n    _event.add(_win, 'unload', _doNothing); // prevent browser from showing cached state via back button, because flash will be dead\r\n    if (_s.waitForWindowLoad && !_windowLoaded) {\r\n      _wDS('waitOnload');\r\n      _event.add(_win, 'load', _initUserOnload);\r\n      return false;\r\n    } else {\r\n      if (_s.waitForWindowLoad && _windowLoaded) {\r\n        _wDS('docLoaded');\r\n      }\r\n      _initUserOnload();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _showSupport = function () {\r\n\r\n    var item, tests = [];\r\n    if (_s.useHTML5Audio && _s.hasHTML5) {\r\n      for (item in _s.audioFormats) {\r\n        if (_s.audioFormats.hasOwnProperty(item)) {\r\n          tests.push(item + ': ' + _s.html5[item] + (!_s.html5[item] && _hasFlash && _s.flash[item] ? ' (using flash)' : (_s.preferFlash && _s.flash[item] && _hasFlash ? ' (preferring flash)': (!_s.html5[item] ? ' (' + (_s.audioFormats[item].required ? 'required, ':'') + 'and no flash support)' : ''))));\r\n        }\r\n      }\r\n      _s._wD('-- SoundManager 2: HTML5 support tests ('+_s.html5Test+'): '+tests.join(', ')+' --',1);\r\n    }\r\n\r\n  };\r\n\r\n  _init = function () {\r\n\r\n    _wDS('init');\r\n\r\n    // called after onload()\r\n    if (_didInit) {\r\n      _wDS('didInit');\r\n      return false;\r\n    }\r\n\r\n    function _cleanup() {\r\n      _event.remove(_win, 'load', _s.beginDelayedInit);\r\n    }\r\n\r\n    if (_s.html5Only) {\r\n      if (!_didInit) {\r\n        // we don't need no steenking flash!\r\n        _cleanup();\r\n        _s.enabled = true;\r\n        _initComplete();\r\n      }\r\n      return true;\r\n    }\r\n\r\n    // flash path\r\n    _initMovie();\r\n\r\n    try {\r\n      _wDS('flashJS');\r\n      _s.o._externalInterfaceTest(false); // attempt to talk to Flash\r\n      if (!_s.allowPolling) {\r\n        _wDS('noPolling', 1);\r\n      } else {\r\n        _setPolling(true, (_s.flashPollingInterval || (_s.useFastPolling ? 10 : 50)));\r\n      }\r\n      if (!_s.debugMode) {\r\n        _s.o._disableDebug();\r\n      }\r\n      _s.enabled = true;\r\n      _debugTS('jstoflash', true);\r\n    } catch(e) {\r\n      _s._wD('js/flash exception: ' + e.toString());\r\n      _debugTS('jstoflash', false);\r\n      _catchError({type:'JS_TO_FLASH_EXCEPTION', fatal:true});\r\n      _failSafely(true); // don't disable, for reboot()\r\n      _initComplete();\r\n      return false;\r\n    }\r\n\r\n    _initComplete();\r\n    // event cleanup\r\n    _cleanup();\r\n    return true;\r\n\r\n  };\r\n\r\n  _dcLoaded = function () {\r\n    if (_didDCLoaded) {\r\n      return false;\r\n    }\r\n    _didDCLoaded = true;\r\n    _initDebug();\r\n\r\n    /*\r\n     * Temporary feature: allow force of HTML5 via URL params: sm2-usehtml5audio=0 or 1\r\n     * Ditto for sm2-preferFlash, too.\r\n    */\r\n    // <d>\r\n    (function () {\r\n      var a = 'sm2-usehtml5audio=', l = _wl.toLowerCase(), b = null,\r\n      a2 = 'sm2-preferflash=', b2 = null, hasCon = (typeof console !== 'undefined' && typeof console.log !== 'undefined');\r\n      if (l.indexOf(a) !== -1) {\r\n        b = (l.charAt(l.indexOf(a)+a.length) === '1');\r\n        if (hasCon) {\r\n          console.log((b?'Enabling ':'Disabling ')+'useHTML5Audio via URL parameter');\r\n        }\r\n        _s.useHTML5Audio = b;\r\n      }\r\n      if (l.indexOf(a2) !== -1) {\r\n        b2 = (l.charAt(l.indexOf(a2)+a2.length) === '1');\r\n        if (hasCon) {\r\n          console.log((b2?'Enabling ':'Disabling ')+'preferFlash via URL parameter');\r\n        }\r\n        _s.preferFlash = b2;\r\n      }\r\n    }());\r\n    // </d>\r\n\r\n    if (!_hasFlash && _s.hasHTML5) {\r\n      _s._wD('SoundManager: No Flash detected'+(!_s.useHTML5Audio?', enabling HTML5.':'. Trying HTML5-only mode.'));\r\n      _s.useHTML5Audio = true;\r\n      // make sure we aren't preferring flash, either\r\n      // TODO: preferFlash should not matter if flash is not installed. Currently, stuff breaks without the below tweak.\r\n      _s.preferFlash = false;\r\n    }\r\n\r\n    _testHTML5();\r\n    _s.html5.usingFlash = _featureCheck();\r\n    _needsFlash = _s.html5.usingFlash;\r\n\r\n    _showSupport();\r\n\r\n    if (!_hasFlash && _needsFlash) {\r\n      _s._wD('SoundManager: Fatal error: Flash is needed to play some required formats, but is not available.');\r\n      // TODO: Fatal here vs. timeout approach, etc.\r\n      _s.flashLoadTimeout = 1; // hack: fail sooner.\r\n    }\r\n\r\n    if (_doc.removeEventListener) {\r\n      _doc.removeEventListener('DOMContentLoaded', _dcLoaded, false);\r\n    }\r\n    _initMovie();\r\n    return true;\r\n  };\r\n\r\n  _dcIE = function () {\r\n    if (_doc.readyState === 'complete') {\r\n      _dcLoaded();\r\n      _doc.detachEvent('onreadystatechange', _dcIE);\r\n    }\r\n    return true;\r\n  };\r\n\r\n  // sniff up-front\r\n  _detectFlash();\r\n\r\n  // focus and window load, init (primarily flash-driven)\r\n  _event.add(_win, 'focus', _handleFocus);\r\n  _event.add(_win, 'load', _handleFocus);\r\n  _event.add(_win, 'load', _delayWaitForEI);\r\n  if (_isSafari && _tryInitOnFocus) {\r\n    _event.add(_win, 'mousemove', _handleFocus); // massive Safari 3.1 focus hack\r\n  }\r\n\r\n  if (_doc.addEventListener) {\r\n    _doc.addEventListener('DOMContentLoaded', _dcLoaded, false);\r\n  } else if (_doc.attachEvent) {\r\n    _doc.attachEvent('onreadystatechange', _dcIE);\r\n  } else {\r\n    // no add/attachevent support - safe to assume no JS -> Flash either\r\n    _debugTS('onload', false);\r\n    _catchError({type:'NO_DOM2_EVENTS', fatal:true});\r\n  }\r\n\r\n  if (_doc.readyState === 'complete') {\r\n    setTimeout(_dcLoaded,100);\r\n  }\r\n\r\n} // SoundManager()\r\n","pre":true},"sdk/jsio/util/underscore.js":{"path":"sdk/jsio/util/underscore.js","friendlyPath":"util.underscore","directory":"sdk/jsio/util/","filename":"underscore.js","src":"//     Underscore.js 1.2.1\n//     (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.\n//     Underscore is freely distributable under the MIT license.\n//     Portions of Underscore are inspired or borrowed from Prototype,\n//     Oliver Steele's Functional, and John Resig's Micro-Templating.\n//     For all details and documentation:\n//     http://documentcloud.github.com/underscore\n(function() {\n\n  // Baseline setup\n  // --------------\n  // Establish the root object, `window` in the browser, or `global` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Establish the object that gets returned to break out of a loop iteration.\n  var breaker = {};\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype,\n      ObjProto = Object.prototype,\n      FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var slice = ArrayProto.slice,\n      unshift = ArrayProto.unshift,\n      toString = ObjProto.toString,\n      hasOwnProperty = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n  nativeForEach = ArrayProto.forEach,\n      nativeMap = ArrayProto.map,\n      nativeReduce = ArrayProto.reduce,\n      nativeReduceRight = ArrayProto.reduceRight,\n      nativeFilter = ArrayProto.filter,\n      nativeEvery = ArrayProto.every,\n      nativeSome = ArrayProto.some,\n      nativeIndexOf = ArrayProto.indexOf,\n      nativeLastIndexOf = ArrayProto.lastIndexOf,\n      nativeIsArray = Array.isArray,\n      nativeKeys = Object.keys,\n      nativeBind = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) {\n    return new wrapper(obj);\n  };\n\n  // Export the Underscore object for **Node.js** and **\"CommonJS\"**, with\n  // backwards-compatibility for the old `require()` API. If we're not in\n  // CommonJS, add `_` to the global object.\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else if (typeof define === 'function' && define.amd) {\n    // Register as a named module with AMD.\n    define('underscore', function() {\n      return _;\n    });\n  } else {\n    // Exported as a string, for Closure Compiler \"advanced\" mode.\n    root['_'] = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.2.1';\n\n  // Collection Functions\n  // --------------------\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles objects with the built-in `forEach`, arrays, and raw objects.\n  // Delegates to **ECMAScript 5**'s native `forEach` if available.\n  var each = _.each = _.forEach = function(obj, iterator, context) {\n    if (obj == null) return;\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, l = obj.length; i < l; i++) {\n        if (i in obj && iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      for (var key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n          if (iterator.call(context, obj[key], key, obj) === breaker) return;\n        }\n      }\n    }\n  };\n\n  // Return the results of applying the iterator to each element.\n  // Delegates to **ECMAScript 5**'s native `map` if available.\n  _.map = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n    each(obj, function(value, index, list) {\n      results[results.length] = iterator.call(context, value, index, list);\n    });\n    return results;\n  };\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.\n  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {\n    var initial = memo !== void 0;\n    if (obj == null) obj = [];\n    if (nativeReduce && obj.reduce === nativeReduce) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);\n    }\n    each(obj, function(value, index, list) {\n      if (!initial) {\n        memo = value;\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, value, index, list);\n      }\n    });\n    if (!initial) throw new TypeError(\"Reduce of empty array with no initial value\");\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.\n  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {\n    if (obj == null) obj = [];\n    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {\n      if (context) iterator = _.bind(iterator, context);\n      return memo !== void 0 ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);\n    }\n    var reversed = (_.isArray(obj) ? obj.slice() : _.toArray(obj)).reverse();\n    return _.reduce(reversed, iterator, memo, context);\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, iterator, context) {\n    var result;\n    any(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Delegates to **ECMAScript 5**'s native `filter` if available.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);\n    each(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    each(obj, function(value, index, list) {\n      if (!iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Delegates to **ECMAScript 5**'s native `every` if available.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, iterator, context) {\n    var result = true;\n    if (obj == null) return result;\n    if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);\n    each(obj, function(value, index, list) {\n      if (!(result = result && iterator.call(context, value, index, list))) return breaker;\n    });\n    return result;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Delegates to **ECMAScript 5**'s native `some` if available.\n  // Aliased as `any`.\n  var any = _.some = _.any = function(obj, iterator, context) {\n    iterator = iterator || _.identity;\n    var result = false;\n    if (obj == null) return result;\n    if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);\n    each(obj, function(value, index, list) {\n      if (result |= iterator.call(context, value, index, list)) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if a given value is included in the array or object using `===`.\n  // Aliased as `contains`.\n  _.include = _.contains = function(obj, target) {\n    var found = false;\n    if (obj == null) return found;\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n    found = any(obj, function(value) {\n      if (value === target) return true;\n    });\n    return found;\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    return _.map(obj, function(value) {\n      return (method.call ? method || value : value[method]).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, function(value) {\n      return value[key];\n    });\n  };\n\n  // Return the maximum element or (element-based computation).\n  _.max = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj)) return Math.max.apply(Math, obj);\n    if (!iterator && _.isEmpty(obj)) return -Infinity;\n    var result = {\n      computed: -Infinity\n    };\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed >= result.computed && (result = {\n        value: value,\n        computed: computed\n      });\n    });\n    return result.value;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj)) return Math.min.apply(Math, obj);\n    if (!iterator && _.isEmpty(obj)) return Infinity;\n    var result = {\n      computed: Infinity\n    };\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed < result.computed && (result = {\n        value: value,\n        computed: computed\n      });\n    });\n    return result.value;\n  };\n\n  // Shuffle an array.\n  _.shuffle = function(obj) {\n    var shuffled = [],\n        rand;\n    each(obj, function(value, index, list) {\n      if (index == 0) {\n        shuffled[0] = value;\n      } else {\n        rand = Math.floor(Math.random() * (index + 1));\n        shuffled[index] = shuffled[rand];\n        shuffled[rand] = value;\n      }\n    });\n    return shuffled;\n  };\n\n  // Sort the object's values by a criterion produced by an iterator.\n  _.sortBy = function(obj, iterator, context) {\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value: value,\n        criteria: iterator.call(context, value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria,\n          b = right.criteria;\n      return a < b ? -1 : a > b ? 1 : 0;\n    }), 'value');\n  };\n\n  // Groups the object's values by a criterion. Pass either a string attribute\n  // to group by, or a function that returns the criterion.\n  _.groupBy = function(obj, val) {\n    var result = {};\n    var iterator = _.isFunction(val) ? val : function(obj) {\n      return obj[val];\n    };\n    each(obj, function(value, index) {\n      var key = iterator(value, index);\n      (result[key] || (result[key] = [])).push(value);\n    });\n    return result;\n  };\n\n  // Use a comparator function to figure out at what index an object should\n  // be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iterator) {\n    iterator || (iterator = _.identity);\n    var low = 0,\n        high = array.length;\n    while (low < high) {\n      var mid = (low + high) >> 1;\n      iterator(array[mid]) < iterator(obj) ? low = mid + 1 : high = mid;\n    }\n    return low;\n  };\n\n  // Safely convert anything iterable into a real, live array.\n  _.toArray = function(iterable) {\n    if (!iterable) return [];\n    if (iterable.toArray) return iterable.toArray();\n    if (_.isArray(iterable)) return slice.call(iterable);\n    if (_.isArguments(iterable)) return slice.call(iterable);\n    return _.values(iterable);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    return _.toArray(obj).length;\n  };\n\n  // Array Functions\n  // ---------------\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head`. The **guard** check allows it to work\n  // with `_.map`.\n  _.first = _.head = function(array, n, guard) {\n    return (n != null) && !guard ? slice.call(array, 0, n) : array[0];\n  };\n\n  // Returns everything but the last entry of the array. Especcialy useful on\n  // the arguments object. Passing **n** will return all the values in\n  // the array, excluding the last N. The **guard** check allows it to work with\n  // `_.map`.\n  _.initial = function(array, n, guard) {\n    return slice.call(array, 0, array.length - ((n == null) || guard ? 1 : n));\n  };\n\n  // Get the last element of an array. Passing **n** will return the last N\n  // values in the array. The **guard** check allows it to work with `_.map`.\n  _.last = function(array, n, guard) {\n    return (n != null) && !guard ? slice.call(array, array.length - n) : array[array.length - 1];\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail`.\n  // Especially useful on the arguments object. Passing an **index** will return\n  // the rest of the values in the array from that index onward. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = function(array, index, guard) {\n    return slice.call(array, (index == null) || guard ? 1 : index);\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, function(value) {\n      return !!value;\n    });\n  };\n\n  // Return a completely flattened version of an array.\n  _.flatten = function(array, shallow) {\n    return _.reduce(array, function(memo, value) {\n      if (_.isArray(value)) return memo.concat(shallow ? value : _.flatten(value));\n      memo[memo.length] = value;\n      return memo;\n    }, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    return _.difference(array, slice.call(arguments, 1));\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted, iterator) {\n    var initial = iterator ? _.map(array, iterator) : array;\n    var result = [];\n    _.reduce(initial, function(memo, el, i) {\n      if (0 == i || (isSorted === true ? _.last(memo) != el : !_.include(memo, el))) {\n        memo[memo.length] = el;\n        result[result.length] = array[i];\n      }\n      return memo;\n    }, []);\n    return result;\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = function() {\n    return _.uniq(_.flatten(arguments, true));\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays. (Aliased as \"intersect\" for back-compat.)\n  _.intersection = _.intersect = function(array) {\n    var rest = slice.call(arguments, 1);\n    return _.filter(_.uniq(array), function(item) {\n      return _.every(rest, function(other) {\n        return _.indexOf(other, item) >= 0;\n      });\n    });\n  };\n\n  // Take the difference between one array and another.\n  // Only the elements present in just the first array will remain.\n  _.difference = function(array, other) {\n    return _.filter(array, function(value) {\n      return !_.include(other, value);\n    });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function() {\n    var args = slice.call(arguments);\n    var length = _.max(_.pluck(args, 'length'));\n    var results = new Array(length);\n    for (var i = 0; i < length; i++) results[i] = _.pluck(args, \"\" + i);\n    return results;\n  };\n\n  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),\n  // we need this function. Return the position of the first occurrence of an\n  // item in an array, or -1 if the item is not included in the array.\n  // Delegates to **ECMAScript 5**'s native `indexOf` if available.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i, l;\n    if (isSorted) {\n      i = _.sortedIndex(array, item);\n      return array[i] === item ? i : -1;\n    }\n    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item);\n    for (i = 0, l = array.length; i < l; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.\n  _.lastIndexOf = function(array, item) {\n    if (array == null) return -1;\n    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) return array.lastIndexOf(item);\n    var i = array.length;\n    while (i--) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = arguments[2] || 1;\n\n    var len = Math.max(Math.ceil((stop - start) / step), 0);\n    var idx = 0;\n    var range = new Array(len);\n\n    while (idx < len) {\n      range[idx++] = start;\n      start += step;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n  // Reusable constructor function for prototype setting.\n  var ctor = function() {};\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Binding with arguments is also known as `curry`.\n  // Delegates to **ECMAScript 5**'s native `Function.bind` if available.\n  // We check for `func.bind` first, to fail fast when `func` is undefined.\n  _.bind = function bind(func, context) {\n    var bound, args;\n    if (func.bind === nativeBind && nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\n    if (!_.isFunction(func)) throw new TypeError;\n    args = slice.call(arguments, 2);\n    return bound = function() {\n      if (!(this instanceof bound)) return func.apply(context, args.concat(slice.call(arguments)));\n      ctor.prototype = func.prototype;\n      var self = new ctor;\n      var result = func.apply(self, args.concat(slice.call(arguments)));\n      if (Object(result) === result) return result;\n      return self;\n    };\n  };\n\n  // Bind all of an object's methods to that object. Useful for ensuring that\n  // all callbacks defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var funcs = slice.call(arguments, 1);\n    if (funcs.length == 0) funcs = _.functions(obj);\n    each(funcs, function(f) {\n      obj[f] = _.bind(obj[f], obj);\n    });\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memo = {};\n    hasher || (hasher = _.identity);\n    return function() {\n      var key = hasher.apply(this, arguments);\n      return hasOwnProperty.call(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));\n    };\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function() {\n      return func.apply(func, args);\n    }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time.\n  _.throttle = function(func, wait) {\n    var timeout, context, args, throttling, finishThrottle;\n    finishThrottle = _.debounce(function() {\n      throttling = false;\n    }, wait);\n    return function() {\n      context = this;\n      args = arguments;\n      var throttler = function() {\n        timeout = null;\n        func.apply(context, args);\n        finishThrottle();\n      };\n      if (!timeout) timeout = setTimeout(throttler, wait);\n      if (!throttling) func.apply(context, args);\n      if (finishThrottle) finishThrottle();\n      throttling = true;\n    };\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds.\n  _.debounce = function(func, wait) {\n    var timeout;\n    return function() {\n      var context = this,\n          args = arguments;\n      var throttler = function() {\n        timeout = null;\n        func.apply(context, args);\n      };\n      clearTimeout(timeout);\n      timeout = setTimeout(throttler, wait);\n    };\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = function(func) {\n    var ran = false,\n        memo;\n    return function() {\n      if (ran) return memo;\n      ran = true;\n      return memo = func.apply(this, arguments);\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return function() {\n      var args = [func].concat(slice.call(arguments));\n      return wrapper.apply(this, args);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var funcs = slice.call(arguments);\n    return function() {\n      var args = slice.call(arguments);\n      for (var i = funcs.length - 1; i >= 0; i--) {\n        args = [funcs[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  };\n\n  // Returns a function that will only be executed after being called N times.\n  _.after = function(times, func) {\n    return function() {\n      if (--times < 1) {\n        return func.apply(this, arguments);\n      }\n    };\n  };\n\n  // Object Functions\n  // ----------------\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = nativeKeys ||\n  function(obj) {\n    if (obj !== Object(obj)) throw new TypeError('Invalid object');\n    var keys = [];\n    for (var key in obj) if (hasOwnProperty.call(obj, key)) keys[keys.length] = key;\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    return _.map(obj, _.identity);\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      for (var prop in source) {\n        if (source[prop] !== void 0) obj[prop] = source[prop];\n      }\n    });\n    return obj;\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      for (var prop in source) {\n        if (obj[prop] == null) obj[prop] = source[prop];\n      }\n    });\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Internal recursive comparison function.\n\n\n  function eq(a, b, stack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the Harmony `egal` proposal: http://wiki.ecmascript.org/doku.php?id=harmony:egal.\n    if (a === b) return a !== 0 || 1 / a == 1 / b;\n    // A strict comparison is necessary because `null == undefined`.\n    if ((a == null) || (b == null)) return a === b;\n    // Unwrap any wrapped objects.\n    if (a._chain) a = a._wrapped;\n    if (b._chain) b = b._wrapped;\n    // Invoke a custom `isEqual` method if one is provided.\n    if (_.isFunction(a.isEqual)) return a.isEqual(b);\n    if (_.isFunction(b.isEqual)) return b.isEqual(a);\n    // Compare object types.\n    var typeA = typeof a;\n    if (typeA != typeof b) return false;\n    // Optimization; ensure that both values are truthy or falsy.\n    if (!a != !b) return false;\n    // `NaN` values are equal.\n    if (_.isNaN(a)) return _.isNaN(b);\n    // Compare string objects by value.\n    var isStringA = _.isString(a),\n        isStringB = _.isString(b);\n    if (isStringA || isStringB) return isStringA && isStringB && String(a) == String(b);\n    // Compare number objects by value.\n    var isNumberA = _.isNumber(a),\n        isNumberB = _.isNumber(b);\n    if (isNumberA || isNumberB) return isNumberA && isNumberB && +a == +b;\n    // Compare boolean objects by value. The value of `true` is 1; the value of `false` is 0.\n    var isBooleanA = _.isBoolean(a),\n        isBooleanB = _.isBoolean(b);\n    if (isBooleanA || isBooleanB) return isBooleanA && isBooleanB && +a == +b;\n    // Compare dates by their millisecond values.\n    var isDateA = _.isDate(a),\n        isDateB = _.isDate(b);\n    if (isDateA || isDateB) return isDateA && isDateB && a.getTime() == b.getTime();\n    // Compare RegExps by their source patterns and flags.\n    var isRegExpA = _.isRegExp(a),\n        isRegExpB = _.isRegExp(b);\n    if (isRegExpA || isRegExpB) {\n      // Ensure commutative equality for RegExps.\n      return isRegExpA && isRegExpB && a.source == b.source && a.global == b.global && a.multiline == b.multiline && a.ignoreCase == b.ignoreCase;\n    }\n    // Ensure that both values are objects.\n    if (typeA != 'object') return false;\n    // Arrays or Arraylikes with different lengths are not equal.\n    if (a.length !== b.length) return false;\n    // Objects with different constructors are not equal.\n    if (a.constructor !== b.constructor) return false;\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n    var length = stack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (stack[length] == a) return true;\n    }\n    // Add the first object to the stack of traversed objects.\n    stack.push(a);\n    var size = 0,\n        result = true;\n    // Deep compare objects.\n    for (var key in a) {\n      if (hasOwnProperty.call(a, key)) {\n        // Count the expected number of properties.\n        size++;\n        // Deep compare each member.\n        if (!(result = hasOwnProperty.call(b, key) && eq(a[key], b[key], stack))) break;\n      }\n    }\n    // Ensure that both objects contain the same number of properties.\n    if (result) {\n      for (key in b) {\n        if (hasOwnProperty.call(b, key) && !size--) break;\n      }\n      result = !size;\n    }\n    // Remove the first object from the stack of traversed objects.\n    stack.pop();\n    return result;\n  }\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b, []);\n  };\n\n  // Is a given array, string, or object empty?\n  // An \"empty\" object has no enumerable own-properties.\n  _.isEmpty = function(obj) {\n    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;\n    for (var key in obj) if (hasOwnProperty.call(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType == 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray ||\n  function(obj) {\n    return toString.call(obj) == '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    return obj === Object(obj);\n  };\n\n  // Is a given variable an arguments object?\n  if (toString.call(arguments) == '[object Arguments]') {\n    _.isArguments = function(obj) {\n      return toString.call(obj) == '[object Arguments]';\n    };\n  } else {\n    _.isArguments = function(obj) {\n      return !!(obj && hasOwnProperty.call(obj, 'callee'));\n    };\n  }\n\n  // Is a given value a function?\n  _.isFunction = function(obj) {\n    return toString.call(obj) == '[object Function]';\n  };\n\n  // Is a given value a string?\n  _.isString = function(obj) {\n    return toString.call(obj) == '[object String]';\n  };\n\n  // Is a given value a number?\n  _.isNumber = function(obj) {\n    return toString.call(obj) == '[object Number]';\n  };\n\n  // Is the given value `NaN`?\n  _.isNaN = function(obj) {\n    // `NaN` is the only value for which `===` is not reflexive.\n    return obj !== obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false || toString.call(obj) == '[object Boolean]';\n  };\n\n  // Is a given value a date?\n  _.isDate = function(obj) {\n    return toString.call(obj) == '[object Date]';\n  };\n\n  // Is the given value a regular expression?\n  _.isRegExp = function(obj) {\n    return toString.call(obj) == '[object RegExp]';\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Utility Functions\n  // -----------------\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iterators.\n  _.identity = function(value) {\n    return value;\n  };\n\n  // Run a function **n** times.\n  _.times = function(n, iterator, context) {\n    for (var i = 0; i < n; i++) iterator.call(context, i);\n  };\n\n  // Escape a string for HTML interpolation.\n  _.escape = function(string) {\n    return ('' + string).replace(/&(?!\\w+;|#\\d+;|#x[\\da-f]+;)/gi, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#x27;').replace(/\\//g, '&#x2F;');\n  };\n\n  // Add your own custom functions to the Underscore object, ensuring that\n  // they're correctly added to the OOP wrapper as well.\n  _.mixin = function(obj) {\n    each(_.functions(obj), function(name) {\n      addToWrapper(name, _[name] = obj[name]);\n    });\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = idCounter++;\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate: /<%([\\s\\S]+?)%>/g,\n    interpolate: /<%=([\\s\\S]+?)%>/g,\n    escape: /<%-([\\s\\S]+?)%>/g\n  };\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  _.template = function(str, data) {\n    var c = _.templateSettings;\n    var tmpl = 'var __p=[],print=function(){__p.push.apply(__p,arguments);};' + 'with(obj||{}){__p.push(\\'' + str.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\\\\'\").replace(c.escape, function(match, code) {\n      return \"',_.escape(\" + code.replace(/\\\\'/g, \"'\") + \"),'\";\n    }).replace(c.interpolate, function(match, code) {\n      return \"',\" + code.replace(/\\\\'/g, \"'\") + \",'\";\n    }).replace(c.evaluate || null, function(match, code) {\n      return \"');\" + code.replace(/\\\\'/g, \"'\").replace(/[\\r\\n\\t]/g, ' ') + \"__p.push('\";\n    }).replace(/\\r/g, '\\\\r').replace(/\\n/g, '\\\\n').replace(/\\t/g, '\\\\t') + \"');}return __p.join('');\";\n    var func = new Function('obj', tmpl);\n    return data ? func(data) : func;\n  };\n\n  // The OOP Wrapper\n  // ---------------\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n  var wrapper = function(obj) {\n    this._wrapped = obj;\n  };\n\n  // Expose `wrapper.prototype` as `_.prototype`\n  _.prototype = wrapper.prototype;\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj, chain) {\n    return chain ? _(obj).chain() : obj;\n  };\n\n  // A method to easily add functions to the OOP wrapper.\n  var addToWrapper = function(name, func) {\n    wrapper.prototype[name] = function() {\n      var args = slice.call(arguments);\n      unshift.call(args, this._wrapped);\n      return result(func.apply(_, args), this._chain);\n    };\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    wrapper.prototype[name] = function() {\n      method.apply(this._wrapped, arguments);\n      return result(this._wrapped, this._chain);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    wrapper.prototype[name] = function() {\n      return result(method.apply(this._wrapped, arguments), this._chain);\n    };\n  });\n\n  // Start chaining a wrapped Underscore object.\n  wrapper.prototype.chain = function() {\n    this._chain = true;\n    return this;\n  };\n\n  // Extracts the result from a wrapped and chained object.\n  wrapper.prototype.value = function() {\n    return this._wrapped;\n  };\n\n})();","pre":true},"sdk/timestep/platforms/browser/initialize.js":{"path":"sdk/timestep/platforms/browser/initialize.js","friendlyPath":".initialize","directory":"sdk/timestep/platforms/browser/","filename":"initialize.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import device\");\njsio(\"from util.browser import $\");\n\ndevice.registerDevice('browser', 'platforms.browser');\nexports.init = function () {\n\n\tvar onResize;\n\n\tif (device.isMobileBrowser) {\n\t\tdevice.setUseDOM(true);\n\n\t\tvar screen = device.screen;\n\t\tif (device.isIOS || device.isAndroid) {\n\t\t\t\n\t\t\tvar _isFocused = false;\n\t\t\twindow.addEventListener('focus', function (e) {\n\t\t\t\tvar tag = e.target.tagName;\n\t\t\t\tif (tag == 'TEXTAREA' || tag == 'INPUT') {\n\t\t\t\t\t_isFocused = true;\n\t\t\t\t}\n\t\t\t}, true);\n\t\t\t\n\t\t\tdocument.addEventListener('blur', function (e) {\n\t\t\t\tif (_isFocused) {\n\t\t\t\t\t_isFocused = false;\n\t\t\t\t}\n\t\t\t}, true);\n\t\t\t\n\t\t\tdevice.hideAddressBar = function () {\n\t\t\t\tif (_isFocused || !device.isMobileBrowser || !(device.isIOS || device.isAndroid)) { return; }\n\t\t\t\tif (device.isIOS) {\n\t\t\t\t\twindow.scrollTo(0, 1);\n\t\t\t\t\twindow.scrollTo(0, 0);\n\t\t\t\t} else {\n\t\t\t\t\twindow.scrollTo(0, -1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (!CONFIG.unlockViewport) {\n\t\t\t\twindow.addEventListener('touchstart', bind(device, 'hideAddressBar'), true);\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar lastWidth, lastHeight, lastOrientation;\n\t\tonResize = function () {\n\t\t\tif (device.isIOS) {\n\t\t\t\tdevice.hideAddressBar();\n\t\t\t}\n\t\t\t\n\t\t\tvar w = window.outerWidth;\n\t\t\tvar h = window.outerHeight;\n\t\t\tvar o = window.orientation;\n\t\t\tif (lastWidth == w && lastHeight == h && lastOrientation == o) { return; }\n\t\t\t\n\t\t\tlastWidth = w;\n\t\t\tlastHeight = h;\n\t\t\tlastOrientation = o;\n\t\t\t\n\t\t\tvar isPortrait = screen.isPortrait = (h > w);\n\t\t\tvar isLandscape = screen.isLandscape = !screen.isPortrait;\n\t\t\t\n\t\t\tvar totalW = (isPortrait ? screen.width : screen.height);\n\t\t\tvar totalH = (isPortrait ? screen.height : screen.width);\n\t//\t\tdocument.body.style.height = Math.max(screen.width, screen.height) + 'px';\n\t//\t\tdevice.hideAddressBar();\n\n\t\t\tvar innerWidth = window.innerWidth;\n\t\t\tvar innerHeight = window.innerHeight;\n\t\t\tif (device.width != innerWidth || device.height != innerHeight || device.orientation != o) {\n\t\t\t\tdevice.width = innerWidth;\n\t\t\t\tdevice.height = innerHeight;\n\t\t\t\tdevice.orientation = o;\n\t\t\t\tdevice.screen.publish('Resize', device.width, device.height, device.orientation);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tonResize = function () {\n\t\t\tvar doc = window.document,\n\t\t\t\twidth = window.innerWidth || (doc.clientWidth || doc.clientWidth),\n\t\t\t\theight = window.innerHeight || (doc.clientHeight || doc.clientHeight);\n\t\t\t\n\t\t\tif (width != device.width || height != device.height) {\n\t\t\t\tdevice.width = width;\n\t\t\t\tdevice.height = height;\n\t\t\t\tdevice.screen.width = width;\n\t\t\t\tdevice.screen.height = height;\n\n\t\t\t\tif (width > height) {\n\t\t\t\t\tdevice.screen.isPortrait = false;\n\t\t\t\t\tdevice.screen.isLandscape = true;\n\t\t\t\t\tdevice.screen.orientation = 'landscape';\n\t\t\t\t} else {\n\t\t\t\t\tdevice.screen.isPortrait = true;\n\t\t\t\t\tdevice.screen.isLandscape = false;\n\t\t\t\t\tdevice.screen.orientation = 'portrait';\n\t\t\t\t}\n\n\t\t\t\tdevice.screen.publish('Resize', width, height);\n\t\t\t}\n\t\t}\n\t}\n\n\t$.onEvent(window, 'resize', onResize, false);\n\t$.onEvent(window, 'orientationchange', onResize, false);\n\n\tonResize();\n};\n","pre":true},"sdk/timestep/platforms/browser/Input.js":{"path":"sdk/timestep/platforms/browser/Input.js","friendlyPath":".Input","directory":"sdk/timestep/platforms/browser/","filename":"Input.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.Input;\n *\n * This is imported as timestep.input.InputListener. This binds touch or mouse\n * events on the document (depending on what's specified in device). \n * Additionally, if a canvas option is passed in or setElement(el) is called,\n * mouse over/out and start events are attached to the element. Used on the\n * canvas as well as DOM bindings.\n */\n\njsio(\"import device\");\njsio(\"from util.browser import $\");\n\njsio(\"import event.input.dispatch as input\");\nvar eventTypes = input.eventTypes;\n\n// import ...FPSCounter;\n\nvar UID = -1;\n\nvar sdk_timestep_platforms_browser_Input=__class__;exports=sdk_timestep_platforms_browser_Input(function sdk_timestep_platforms_browser_Input(){return this.init&&this.init.apply(this,arguments)},function (supr) {\n\t\n\tthis.init = function (opts) {\n\n\t\tif (device.simulatingMobileNative || device.simulatingMobileBrowser) { this._simulateMobile = true; }\n\t\t\n\t\tthis._evtQueue = [];\n\t\t\n\t\tif (opts.el) {\n\t\t\tif (device.isMobileBrowser) {\n\t\t\t\tthis._toggleNode = $({parent:document.body});\n\t\t\t}\n\t\t\tthis.setElement(opts.el);\n\t\t}\n\n\t\t// Mouseover/out events do not fire for mobile browsers\n\t\t// that are driven solely by touch events, so in mobile\n\t\t// browsers, assume the canvas should always handle events.\n\t\t// Otherwise, only handle events if the mouse is over the\n\t\t// canvas.\n\t\tthis._isOver = false;\n\n\t\t// disable the key listener on focus of input elements\n\t\tthis._keyListener = opts.keyListener;\n\n\t\tif (device.useDOM) {\n\t\t\t$.onEvent(document, device.events.start, this, 'handleMouse', eventTypes.START);\n\t\t}\n\t\t\n\t\tthis.enable();\n\t\t\n\t\t// this._evtFps = new FPSCounter({name: \"mouse events\"});\n\t\t\n\t\tthis._hasFocus = false;\n\t\tif (document.addEventListener) {\n\t\t\tdocument.addEventListener('focus', bind(this, 'onFocusCapture'), true);\n\t\t\tdocument.addEventListener('blur', bind(this, 'onBlurCapture'), true);\n\t\t}\n\t}\n\n\tthis.enable = function () {\n\t\tthis._handleMove = $.onEvent(document, device.events.move, this, 'handleMouse', eventTypes.MOVE);\n\t\tthis._handleSelect = $.onEvent(document, device.events.end, this, 'handleMouse', eventTypes.SELECT);\n\t\tthis._handleScroll = $.onEvent(window, 'DOMMouseScroll', this, 'handleMouse', eventTypes.SCROLL); // FF\n\t\tthis._handleWheel = $.onEvent(window, 'mousewheel', this, 'handleMouse', eventTypes.SCROLL); // webkit\n\t};\n\n\tthis.disable = function () {\n\t\tif (this._handleMove) {\n\t\t\tthis._handleMove();\n\t\t\tthis._handleMove = false;\n\t\t}\n\t\tif (this._handleSelect) {\n\t\t\tthis._handleSelect();\n\t\t\tthis._handleSelect = false;\n\t\t}\n\t\tif (this._handleScroll) {\n\t\t\tthis._handleScroll();\n\t\t\tthis._handleScroll = false;\n\t\t}\n\t\tif (this._handleWheel) {\n\t\t\tthis._handleWheel();\n\t\t\tthis._handleWheel = false;\n\t\t}\n\t};\n\t\n\tthis.onFocusCapture = function (e) {\n\t\tvar tag = e.target.tagName;\n\t\tif (tag == 'TEXTAREA' || tag == 'INPUT') {\n\t\t\tthis._hasFocus = e.target;\n\t\t\tthis._keyListener && this._keyListener.setEnabled(false);\n\t\t}\n\t}\n\t\n\tthis.onBlurCapture = function (e) {\n\t\tif (this._hasFocus) {\n\t\t\tthis._hasFocus = null;\n\t\t\tthis._keyListener && this._keyListener.setEnabled(true);\n\t\t}\n\t}\n\t\n\tthis.setElement = function (el) {\n\t\tthis._el = el;\n\t\t\n\t\tif (this._elEvents) {\n\t\t\tfor(var i = 0, detach; detach = this._elEvents[i]; ++i) {\n\t\t\t\tdetach();\n\t\t\t}\n\t\t}\n\t\t\n\t\tel.ondragstart = function () { return false; }\n\t\tel.onselectstart = function () { return false; }\n\t\t\n\t\tthis._elEvents = [];\n\t\t\n\t\tif (!device.useDOM) {\n\t\t\tthis._elEvents.push($.onEvent(el, device.events.start, this, 'handleMouse', eventTypes.START));\n\t\t}\n\t\t\n\t\tif (!device.isMobileBrowser && !device.isNative) {\n\t\t\tthis._elEvents.push($.onEvent(el, 'mouseover', this, 'onMouseOver'));\n\t\t\tthis._elEvents.push($.onEvent(el, 'mouseout', this, 'onMouseOut'));\n\t\t}\n\t}\n\t\n\tthis.onMouseOver = function () { this._isOver = true; }\n\tthis.onMouseOut = function () { this._isOver = false; }\n\tthis.onMouseDown = function () { this._isMouseDown = true; }\n\tthis.onMouseUp = function () { this._isMouseUp = true; }\n\t\n\tthis.getEvents = function () { return this._evtQueue.splice(0, this._evtQueue.length); }\n\t\n\tthis.allowScrollEvents = function (allowScrollEvents) { this._allowScrollEvents = allowScrollEvents; }\n\t\n\tvar empty = function () {};\n\n\tthis.handleMouse = function (type, evt, recursive) {\n\t\tvar target = evt.target;\n\t\tif (this._hasFocus && this._hasFocus == target || target && target.getAttribute && target.getAttribute('noCapture')) { return; }\n\t\t\n\t\t// if (!recursive) {\n\t\t// \t// remove the empty callback to log the raw mouse event fps\n\t\t// \tthis._evtFps.tick(empty);\n\t\t// }\n\t\t\n\t\tvar isMobileBrowser = device.isMobileBrowser;\n\t\t\n\t\tif (!device.useDOM && !isMobileBrowser && !this._isDown && this._el && evt.target != this._el) { return; }\n\t\t\n\t\t// Cancel all events that occur on the canvas.  Optionally, pass scroll events\n\t\t// through to the page (apps that don't care about handling scroll events may\n\t\t// want to pass them through for easier browser debugging).\n\t\tif (isMobileBrowser) {\n\t\t\t$.stopEvent(evt);\n\t\t\tevt.returnValue = false;\n\t\t} else if (this._isOver && (!this._allowScrollEvents || type != eventTypes.SCROLL)) {\n\t\t\tif (evt.stopPropagation) { evt.stopPropagation(); }\n\t\t\tif (type != eventTypes.START) {\n\t\t\t\t$.stopEvent(evt);\n\t\t\t\tevt.returnValue = false;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// On ios devices, this event could correspond to multiple touches.  We recall\n\t\t// ourselves with each changed touch independently.\n\t\tif (evt.touches) {\n\t\t\tfor (var i = 0, t; t = evt.changedTouches[i]; ++i) {\n\t\t\t\tthis.handleMouse(type, t, true);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar x, y;\n\t\t// Figure out where in the canvas the event fired.\n\t\t// if (isMobileBrowser) {\n\t\t// \tpt = {\n\t\t// \t\tx: evt.pageX,\n\t\t// \t\ty: evt.pageY\n\t\t// \t};\n\t\t// } else \n\t\tif ('offsetX' in evt && !device.useDOM) {\n\t\t\t// Chrome makes life easy.  offsetX/offsetY is w.r.t. the target, which\n\t\t\t// for us should be the canvas.\n\t\t\tx = evt.offsetX;\n\t\t\ty = evt.offsetY;\n\t\t} else if (this._el.getBoundingClientRect) {\n\t\t\t// It's not too hard in other browsers that support getBoundingClientRect.\n\t\t\t// Get the absolute position of the canvas and do the math.\n\t\t\tvar rect = this._el.getBoundingClientRect();\n\t\t\tx = evt.pageX - rect.left;\n\t\t\ty = evt.pageY - rect.top;\n\t\t} else {\n\t\t\t// Without boundingClientRect, life is hard.  This is the general\n\t\t\t// idea, but we need to loop for offsetParent/scrollLeft/scrollTop\n\t\t\t// to be at least partially complete.  Other libraries handle this\n\t\t\t// better, but the code complexity for that is huge.\n\t\t\t// \n\t\t\t// TODO: older browsers will fail cause this code is buggy and untested?\n\t\t\tvar offsetX, offsetY, parent = this._el;\n\t\t\twhile (parent) {\n\t\t\t\toffsetX += parent.offsetTop;\n\t\t\t\toffsetY += parent.offsetLeft;\n\t\t\t\tparent = parent.parentNode;\n\t\t\t}\n\t\t\t\n\t\t\tx = evt.pageX - offsetX;\n\t\t\ty = evt.pageY - offsetY;\n\t\t}\n\t\t\n\t\tvar id = evt.identifier || UID;\n\t\t\n\t\tif (this._simulateMobile) {\n\t\t\tswitch (type) {\n\t\t\t\tcase eventTypes.START:\n\t\t\t\t\tthis._moveOK = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase eventTypes.MOVE:\n\t\t\t\t\tif (!this._moveOK) { return; }\n\t\t\t\t\tbreak;\n\t\t\t\tcase eventTypes.SELECT:\n\t\t\t\t\tthis._moveOK = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (type == eventTypes.START) {\n\t\t\tthis._isDown = true;\n\t\t} else if (type == eventTypes.SELECT) {\n\t\t\tthis._isDown = false;\n\t\t\t\n\t\t\tif (this._toggleNode) {\n\t\t\t\tdocument.body.removeChild(this._toggleNode);\n\t\t\t\tdocument.body.appendChild(this._toggleNode);\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar inputEvent = new input.InputEvent(id, type, x, y);\n\t\tif (device.useDOM) {\n\t\t\twhile (target && !target._view) {\n\t\t\t\ttarget = target.parentNode;\n\t\t\t}\n\t\t\tif (!target) { return; }\n\t\t\tinputEvent.target = target._view;\n\t\t}\n\t\t\n\t\tif (type == eventTypes.SCROLL) {\n\t\t\t// try to normalize scroll events! :-(\n\t\t\t\n\t\t\t// some browsers send both horizontal and vertical offsets in one event! nice!\n\t\t\t// other browsers don't. This is awful, since this is the least common denominator!\n\t\t\t// so we have to send two events even if the browser only sends one.\n\t\t\tif ('wheelDeltaX' in evt) {\n\t\t\t\t// default to Y\n\t\t\t\tinputEvent.scrollDelta = evt.wheelDeltaY / 120;\n\t\t\t\tinputEvent.scrollAxis = input.VERTICAL_AXIS;\n\n\t\t\t\t// if we also have X, then send it as a separate event\n\t\t\t\tif (evt.wheelDeltaX && evt.wheelDeltaY) {\n\t\t\t\t\tvar e = inputEvent.clone();\n\t\t\t\t\te.scrollDelta = evt.wheelDeltaX / 120;\n\t\t\t\t\te.scrollAxis = input.HORIZONTAL_AXIS;\n\t\t\t\t\tthis._evtQueue.push(e);\n\t\t\t\t} else if (evt.wheelDeltaX) {\n\t\t\t\t\t// we only have one of (X, Y) and it's X, so use X\n\t\t\t\t\tinputEvent.scrollDelta = evt.wheelDeltaX / 120;\n\t\t\t\t\tinputEvent.scrollAxis = input.HORIZONTAL_AXIS;\n\t\t\t\t}\n\n\t\t\t} else if (evt.detail) {\n\t\t\t\tinputEvent.scrollDelta = -evt.detail;\n\t\t\t\tinputEvent.scrollAxis = 'axis' in evt ? evt.axis == evt.VERTICAL_AXIS ? input.VERTICAL_AXIS : input.HORIZONTAL_AXIS : input.VERTICAL_AXIS;\n\t\t\t} else if (evt.wheelDelta) { // IE/Opera\n\t\t\t\tinputEvent.scrollDelta = (window.opera ? 1 : -1) * evt.wheelDelta / 120;\n\t\t\t\tinputEvent.scrollAxis = input.VERTICAL_AXIS;\n\t\t\t}\n\t\t}\n\n\t\tthis._evtQueue.push(inputEvent);\n\t}\n\t\n});\n","pre":true},"sdk/timestep/platforms/browser/InputPrompt.js":{"path":"sdk/timestep/platforms/browser/InputPrompt.js","friendlyPath":".InputPrompt","directory":"sdk/timestep/platforms/browser/","filename":"InputPrompt.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.InputPrompt;\n *\n * Prompt the user manually for input.\n *\n * ??? TODO Move this to debug, probably. A native modal prompt has no place\n *          in game code.\n */\nvar KeyboardTypes = {\n\tDefault: 0,                // Default type for the current input method.\n    NumbersAndPunctuation: 2,  // Numbers and assorted punctuation.\n    URL: 3,                    // A type optimized for URL entry (shows . / .com prominently).\n    NumberPad: 4,              // A number pad (0-9). Suitable for PIN entry.\n    PhonePad: 5,               // A phone pad (1-9, *, 0, #, with letters under the numbers).\n    EmailAddress: 7,           // A type optimized for multiple email address entry (shows space @ . prominently).\n    DecimalPad: 8\n}\n\nvar sdk_timestep_platforms_browser_InputPrompt=__class__;exports=sdk_timestep_platforms_browser_InputPrompt(function sdk_timestep_platforms_browser_InputPrompt(){return this.init&&this.init.apply(this,arguments)},function () {\n\tvar defaults = {\n\t\tonChange: function () {},\n\t\ttitle: '',\n\t\tmessage: '',\n\t\tvalue: '',\n\t\tprompt: ''\n\t}\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, defaults);\n\t\tthis.onChange = opts.onChange;\n\t\tthis.onSubmit = opts.onSubmit;\n\t\tthis._value = opts.value;\n\t\tthis._message = opts.title || opts.message || opts.prompt;\n\t};\n\n\tthis.show = function () {\n\t\tvar value = window.prompt(this._message, this._value);\n\t\tif (value !== null) { // returns null if user presses cancel\n\t\t\tthis._value = value;\n\t\t\tthis.onChange && this.onChange(value);\n\t\t\tthis.onSubmit && this.onSubmit(value);\n\t\t} else {\n\t\t\t// TODO: do something else on cancel?\n\t\t\tthis.onChange && this.onChange(value);\n\t\t}\n\t};\n\n\tthis.getValue = function () {\n\t\treturn this._value;\n\t};\n\n\tthis.setValue = function (value) {\n\t\tthis._value = value;\n\t\treturn this;\n\t};\n\n\tthis.setMessage = function (message) {\n\t\tthis._message = message;\n\t\treturn this;\n\t};\n\n\tthis.setOkButton = function (value) {\n\t\tthis._okText = value;\n\t\treturn this;\n\t}\n\n\tthis.setCancelButton = function (value) {\n\t\tthis._cancelText = value;\n\t\treturn this;\n\t}\n\n\tthis.setKeyboardType = function(keyboardType) {\n\t\tlogger.warn('Setting keyboard type in the browser does nothing');\n\t\treturn this;\n\t};\n\n\tthis.requestFocus = function() { this.show(); return this; }\n\n\tthis.closeEditField = function() {}\n\n\tthis.setHint = function() {}\n\n\tthis.refresh = function() {}\n});\n\nexports.showStatusBar = function() {};\nexports.hideStatusBar = function() {};\nexports.KeyboardTypes = KeyboardTypes;\n","pre":true},"sdk/timestep/platforms/browser/KeyListener.js":{"path":"sdk/timestep/platforms/browser/KeyListener.js","friendlyPath":".KeyListener","directory":"sdk/timestep/platforms/browser/","filename":"KeyListener.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.KeyListener;\n *\n * Listen to pressed keys and expose them using a altogether too public API.\n * An independent KeyListener is exposed for the Application Engine and any\n * Views with a Focus Manager.\n */\n\njsio(\"import lib.PubSub as PubSub\");\njsio(\"import lib.Enum\");\n\njsio(\"import event.input.keys as keyConstants\");\njsio(\"import device\");\njsio(\"import timer\");\n\njsio(\"from util.browser import $\");\n\nvar gListenerSingleton = null;\nvar gCancelKeys = lib.Enum(keyConstants.SPACE, keyConstants.LEFT, keyConstants.RIGHT, keyConstants.UP, keyConstants.DOWN);\n\nvar sdk_timestep_platforms_browser_KeyListener=__class__;exports=sdk_timestep_platforms_browser_KeyListener(function sdk_timestep_platforms_browser_KeyListener(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (el, events) {\n\t\tif (gListenerSingleton) { return gListenerSingleton; }\n\t\tgListenerSingleton = this;\n\t\t\n\t\tthis._el = el = el || document;\n\t\tthis._events = [];\n\t\tthis._shortcuts = [];\n\t\tthis._isEnabled = true;\n\t\tthis._keyMap = {};\n\t\t\n\t\t$.onEvent(el, 'keydown', this, 'onKeyDown');\n\t\t$.onEvent(el, 'keypress', this, 'onKeyPress');\n\t\t$.onEvent(el, 'keyup', this, 'onKeyUp');\n\t\t$.onEvent(window, 'blur', this, 'liftAll');\n\t}\n\t\n\tthis.setEnabled = function (isEnabled) { this._isEnabled = isEnabled; }\n\n\tthis.captureShortcut = function (shortcut) {\n\t\tthis._shortcuts.push(shortcut);\n\t}\n\t\n\tthis.getPressed = function () { return this._keyMap; }\n\n\tthis.onKeyDown = function (e) {\n\t\t\n\t\tif (!this._isEnabled) { return; }\n\t\t\n\t\tvar evt = {\n\t\t\tcode: e.keyCode,\n\t\t\tctrl: e.ctrlKey,\n\t\t\tshift: e.shiftKey,\n\t\t\talt: e.altKey,\n\t\t\tmeta: e.metaKey, // for mac keyboards\n\t\t\tlifted: false,\n\t\t\tdt: timer.getTickProgress()\n\t\t};\n\t\t\n\t\tif (evt.ctrl || evt.shift || evt.alt || evt.meta) {\n\t\t\tvar captured = false;\n\t\t\tfor (var i = 0, s; s = this._shortcuts[i]; ++i) {\n\t\t\t\tif (s.compare(evt)) {\n\t\t\t\t\ts.publish('Down', evt);\n\t\t\t\t\tcaptured = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (captured) { $.stopEvent(e); }\n\t\t\treturn;\n\t\t} else {\n\t\t\t// MUST cancel event if we're enabled to prevent browser\n\t\t\t// default behaviors (e.g. scrolling)\n\t\t\t$.stopEvent(e);\n\t\t}\n\t\t\n\t\t// We already know that key is down; ignore repeat events.\n\t\tif (e.keyCode in this._keyMap) { return; }\n\t\t\n\t\tthis._events.push(evt);\n\t\tthis._keyMap[e.keyCode] = +new Date();\n\t}\n\t\n\tthis.liftAll = function () {\n\t\tvar progressDt = timer.getTickProgress();\n\t\tfor (var code in this._keyMap) {\n\t\t\tthis._events.push({\n\t\t\t\tcode: code,\n\t\t\t\tlifted: true,\n\t\t\t\tdt: progressDt\n\t\t\t});\n\t\t}\n\t\tthis._keyMap = {};\n\t}\n\t\n\tthis.onKeyUp = function (e) {\n\t\tvar progressDt = timer.getTickProgress();\n\t\tdelete this._keyMap[e.keyCode];\n\t\tthis._events.push({\n\t\t\tcode: e.keyCode,\n\t\t\tlifted: true,\n\t\t\tdt: progressDt\n\t\t});\n\t\t$.stopEvent(e);\n\t}\n\t\n\tthis.onKeyPress = function (e) {\n\t\tif (!this._isEnabled) { return; }\n\t\tif (e.keyCode in gCancelKeys) {\n\t\t\t$.stopEvent(e);\n\t\t}\n\t}\n\t\n\tthis.peekEvents = function () { return this._events; }\n\tthis.popEvents = function () { return this._events.splice(0, this._events.length); }\n});\n\n// TODO: for maximum compatibility, especially with foreign keyboards, this needs to be inferred from the browser.  I think we can rely on a single DOM key event to get the constants in most browsers.\nmerge(exports.prototype, keyConstants);\n\nexports.Shortcut=__class__;exports.Shortcut=exports.Shortcut(function exports_Shortcut(){return this.init&&this.init.apply(this,arguments)},PubSub, function () {\n\tthis.init = function (keyCode, ctrl, shift, alt, meta) {\n\t\tthis.ctrl = !!ctrl;\n\t\tthis.shift = !!shift;\n\t\tthis.alt = !!alt;\n\t\tthis.meta = !!meta;\n\t\tthis.code = !!keyCode;\n\t}\n\t\n\tthis.compare = function (shortcut) {\n\t\treturn this.ctrl == shortcut.ctrl \n\t\t\t&& this.alt == shortcut.alt\n\t\t\t&& this.meta == shortcut.meta\n\t\t\t&& this.shift == shortcut.shift\n\t\t\t&& this.code == shortcut.code;\n\t}\n});\n","pre":true},"sdk/timestep/event/input/keys.js":{"path":"sdk/timestep/event/input/keys.js","friendlyPath":"event.input.keys","directory":"sdk/timestep/event/input/","filename":"keys.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module event.input.keys\n * Map browser keycodes to corresponding keys.\n */\n\nexports = {\n\tBACKSPACE: 8,\n\tTAB: 9,\n\tENTER: 13,\n\tSHIFT: 16,\n\tCTRL: 17,\n\tALT: 18,\n\tPAUSE: 19,\n\tBREAK: 19,\n\tCAPS: 20,\n\tCAPS_LOCK: 20,\n\tESCAPE: 27,\n\tSPACE: 32,\n\tPAGE_UP: 33,\n\tPAGE_DOWN: 34,\n\tEND: 35,\n\tHOME: 36,\n\tLEFT: 37,\n\tUP: 38,\n\tRIGHT: 39,\n\tDOWN: 40,\n\tPRINT_SCREEN: 44,\n\tINSERT: 45,\n\tDELETE: 46,\n\tMETA_LEFT: 91,\n\tWIN_LEFT: 91,\n\tMETA_RIGHT: 92,\n\tWIN_RIGHT: 92,\n\tSELECT: 93,\n\tEQUAL: 187,\n\tMINUS: 189,\n\tF1: 112,\n\tF2: 113,\n\tF3: 114,\n\tF4: 115,\n\tF5: 116,\n\tF6: 117,\n\tF7: 118,\n\tF8: 119,\n\tF9: 120,\n\tF10: 121,\n\tF11: 122,\n\tF12: 123,\n\tMUTE: 173,\n\tVOL_DOWN: 174,\n\tVOL_UP: 175,\n\tFORWARD: 176,\n\tBACK: 177,\n\tSTOP: 178,\n\tPLAY_PAUSE: 179\n};\n","pre":true},"sdk/timestep/platforms/browser/MobileBrowserAPI.js":{"path":"sdk/timestep/platforms/browser/MobileBrowserAPI.js","friendlyPath":"platforms.browser.MobileBrowserAPI","directory":"sdk/timestep/platforms/browser/","filename":"MobileBrowserAPI.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.PubSub\");\njsio(\"import device\");\njsio(\"from util.underscore import _\");\n\n/**\n * @extends lib.PubSub\n */\nvar sdk_timestep_platforms_browser_MobileBrowserAPI=__class__;var AudioAPI = exports=sdk_timestep_platforms_browser_MobileBrowserAPI(function sdk_timestep_platforms_browser_MobileBrowserAPI(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\n\tvar defaults = {\n\t\toneChannelOnly: device.isMobileBrowser,\n\t\tcompiledFilename: 'compiled'\n\t};\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, defaults);\n\t\tsupr(this, 'init', [opts]);\n\t\tthis._opts = opts;\n\t\tthis._map = opts.map;\n\t\tthis._audios = {};\n\t\tthis.oneChannelOnly = opts.oneChannelOnly;\n\n\t\tsetInterval(bind(this, '_ontimeupdate'), 200);\n\t\t\n\t\tif (!this.oneChannelOnly) {\n\t\t\t_.each(opts.background, function (name) {\n\t\t\t\topts.map[name] = {'name': name}\n\t\t\t}, this);\n\t\t}\n\n\t\t// Install the event listener right away. Set usecapture=true so that\n\t\t// nothing else will affect us from intercepting this event.\n\n\t\tthis._load();\n\t\tif (this.oneChannelOnly) {\n\t\t\tthis._boundLoadHandler = bind(this, '_playFirst');\n\t\t\tdocument.body.addEventListener(device.events.start, \n\t\t\t\t\t\t\t\t\t\t   this._boundLoadHandler, true);\n\t\t}\n\t\twindow.addEventListener('pagehide', bind(this, 'pause'), false);\n\t}\n\n\tthis._createChannel = function (name, src) {\n\t\tvar audio = new Audio(src);\n\t\tthis._audios[name] = audio;\n\n\t\taudio.addEventListener('error', bind(this, '_onerror'));\n\t\taudio.addEventListener('timeupdate', bind(this, '_ontimeupdate'));\n\n\t\taudio.load();\n\t}\n\n\tthis.setMuted = function (muted) {\n\t\tthis.muted = muted;\n\t\tif (muted) {\n\t\t\tthis.setVolume(0);\n\t\t}\n\t}\n\t\n\tthis.setVolume = function (volume) {\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\taudio.volume = volume;\n\t\t});\n\t}\n\n\tthis.unload = function () {\n\t\tthis.pause();\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\taudio.src = '';\n\t\t}, this);\n\t\t// TODO remove event listeners\n\t}\n\n\tthis._load = function () {\n\t\n\t\tthis._audios = {};\n\t\tvar path = this._opts.path.replace(/\\/$/, '');\n\t\tif (this.oneChannelOnly) {\n\t\t\tthis._createChannel('AUDIO', path + '/' + this._opts.compiledFilename + '.m4a');\n\t\t} else {\n\t\t\tfor (var key in this._map) if (this._map.hasOwnProperty(key)) {\n\t\t\t\tif (key == 'SILENCE') { continue; }\n\t\t\t\tthis._createChannel(key, path + '/' + key + '.mp3');\n\t\t\t}\n\t\t}\n\n\t\tlogger.info('now loading', this._opts.src);\n\n\t\tif (!this._publishedReady) {\n\t\t\tthis.publish('Ready'); // this is as close as we'll get with multiple sounds\n\t\t\tthis._publishedReady = true;\n\t\t}\n\t}\n\n\tthis._playFirst = function () {\n\t\tdocument.body.removeEventListener(device.events.start, \n\t\t\t\t\t\t\t\t\t\t  this._boundLoadHandler, true);\n\t\t\n\t\tthis._audios['AUDIO'].play();\n\t}\n\n\tthis._ontimeupdate = function (evt) {\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\tif (audio.paused && !audio._pausedOnce) {\n\t\t\t\taudio.pause();\n\t\t\t\taudio._pausedOnce = true;\n\t\t\t\taudio._ready = true;\n\t\t\t}\n\n\t\t\tif (this.oneChannelOnly) {\n\t\t\t\tif (!this._nowPlaying || audio.currentTime >= this._nowPlaying.end) {\n\t\t\t\t\tthis.play('SILENCE');\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\n\t}\n\t\n\tthis._onerror = function (event) {\n\t\tvar s = '';\n\t\tfor (var key in event) {\n\t\t\ts += event[key] + ' ';\n\t\t}\n\t\tlogger.info('ERROR', s);\n\t\t// this.unload();\n\t\t// this.publish('AudioError', event);\n\t\t// this._status = 'error';\n\t}\n\n\tthis.canPlay = function (name) {\n\t\tif (!this._map[name]) { return false; }\n\n\t\tvar requiredEnd = null;\n\t\tif (this.oneChannelOnly) {\n\t\t\trequiredEnd = this._map[name].end;\n\t\t\tname = 'AUDIO';\n\t\t}\n\t\tvar audio = this._audios[name];\n\t\tif (!audio) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// if (!audio._ready) {\n\t\t// \treturn; // try downloading the whole file...\n\t\t// }\n\t\tif (audio._ready || !requiredEnd) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tvar end = audio.seekable.end()\n\t\t\t\treturn (requiredEnd <= end);\n\t\t\t} catch(e) {\n\t\t\t\tlogger.log(e);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.play = function (name, volume, loop) {\t\t\n\t\tif (this.muted) { return; }\n\n\t\tif (volume === undefined) {\n\t\t\tvolume = 1.0;\n\t\t}\n\t\tif (!this.canPlay(name)) {\n\t\t\tlogger.info('Not ready yet');\n\t\t\treturn;\n\t\t}\n\n\t\tvar audio = this._audios[this.oneChannelOnly ? 'AUDIO' : name];\n\t\ttry {\n\t\t\tif (!audio.paused) {\n\t\t\t\taudio.pause(); // it glitches if you move currentTime while playing?\n\t\t\t}\n\t\t\tvar startTime = 0;\n\t\t\tif (this.oneChannelOnly && this._map[name].start != null) {\n\t\t\t\tstartTime = this._map[name].start;\n\t\t\t}\n\t\t\tif (audio.currentTime != startTime) {\n\t\t\t\t// logger.log('SEEK to play',name, startTime, 'from',audio.currentTime); // \n\t\t\t\taudio.currentTime = startTime;\n\t\t\t}\n\t\t\taudio.volume = volume;\n\t\t\taudio.play();\n\t\t\tthis._nowPlaying = this._map[name];\n\t\t} catch(e) {\n\t\t\t\n\t\t}\n\t}\n\t\n\tthis.pause = function () {\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\taudio.pause();\n\t\t}, this);\n\t}\n\n\tthis.playBackgroundMusic = function (name, volume) {\n\t\tif (this.muted) { return; }\n\n\t\tif (this.oneChannelOnly) {\n\t\t\treturn false; // cannot play bg music here.\n\t\t}\n\n\t\tthis._backgroundSoundPlaying = name;\n\t\tthis.play(name, volume);\n\t}\n\n\tthis.pauseBackgroundMusic = function () {\n\t\tif (!this._backgroundSoundPlaying) { return; }\n\t\tthis._audios[this._backgroundSoundPlaying].pause();\n\t}\n\n});\n","pre":true},"sdk/timestep/platforms/browser/StatusBar.js":{"path":"sdk/timestep/platforms/browser/StatusBar.js","friendlyPath":".StatusBar","directory":"sdk/timestep/platforms/browser/","filename":"StatusBar.js","src":"exports.show = function () {\n\n}\n\nexports.hide = function () {\n\n}\n\nexports.getHeight = function () {\n\treturn 0;\n}","pre":true},"sdk/timestep/platforms/browser/TextBox.js":{"path":"sdk/timestep/platforms/browser/TextBox.js","friendlyPath":".TextBox","directory":"sdk/timestep/platforms/browser/","filename":"TextBox.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\"use import\";\n\n/**\n * package timestep.env.browser.TextBox;\n *\n * A textbox for inputting user data.\n */\n\njsio(\"from util.browser import $\");\n\nvar sdk_timestep_platforms_browser_TextBox=__class__;exports=sdk_timestep_platforms_browser_TextBox(function sdk_timestep_platforms_browser_TextBox(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\tvar defaultStyle = {\n\t\tpadding: 0,\n\t\tlineHeight: 1.4,\n\t\tborder: 'none',\n\t\tdisplay: 'none',\n\t\ttextAlign: 'center',\n\t\tverticalAlign: 'middle',\n\t\tfontSize: 16,\n\t\tfontFamily: null,\n\t\tfontWeight: '',\n\t\topacity: 1,\n\t\tposition: \"absolute\",\n\t\tbackgroundColor: \"transparent\",\n\t\ttop: 0,\n\t\tleft: 0\n\t};\n\t\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tcolor: 'black',\n\t\t\theight: 20\n\t\t});\n\n\t\tvar style = merge({}, defaultStyle);\n\t\tif (opts.color) { style.color = opts.color; }\n\t\t\n\t\tthis._el = $({\n\t\t\ttag: opts.multiLine ? \"textarea\" : \"input\",\n\t\t\tattrs: {type: \"text\"}, \n\t\t\tstyle: style\n\t\t});\n\n\t\t$.onEvent(this._el, 'blur', this, 'onBlur');\n\t\t$.onEvent(this._el, 'focus', this, 'onFocus');\n\t\t$.onEvent(this._el, 'change', this, 'onChange');\n\t\t$.onEvent(this._el, 'click', this, 'onClick');\n\t}\n\t\n\tthis.onBlur = \n\tthis.onFocus =\n\tthis.onChange =\n\tthis.onClick = function () {}\n\t\n\tthis.destroy = function () {\n\t\t$.remove(this._el);\n\t\tthis._el = null;\n\t}\n\t\n\tthis.setApp = function (app) {\n\t\tif (app != this._app || !this._el.parentNode) {\n\t\t\tthis._app = app;\n\t\t\tvar canvas = app._ctx.canvas;\n\t\t\tlogger.log('setting parent', this._el);\n\t\t\tcanvas.parentNode.appendChild(this._el);\n\t\t}\n\t}\n\t\n\tthis.change = function () {\n\t\t\n\t}\n\t\n\tthis.click = function () {\n\t}\n\t\n\tthis.selectAll = function () {\n\t\tthis._el.focus();\n\t\tthis._el.select();\n\t}\n\t\n\tthis.show = function () { $.show(this._el); }\n\tthis.hide = function () { $.hide(this._el); }\n\t\n\tthis.setValue = function (value) { this._el.value = value; return this; }\n\tthis.setOpacity = function (o) { this._el.style.opacity = o; return this; }\n\tthis.setType = function (type) { this._el.type = type; return this; }\n\tthis.setVisible = function (isVisible) { return this[isVisible ? 'show': ' hide'](); }\n\tthis.getX = function () { return parseInt(this._el.style.left); }\n\tthis.getY = function () { return parseInt(this._el.style.top); }\n\tthis.getWidth = function () { return this._el.offsetWidth; }\n\tthis.getHeight = function () { return this._el.offsetHeight; }\n\tthis.getValue = function () { return this._el.value; }\n\tthis.getOpacity = function () { return this._el.style.opacity; }\n\tthis.getType = function () { return this._el.type; }\n\tthis.getVisible = function () { return this._el.parentNode && this._el.style.display == 'block'; }\n\t\n\tthis.setPosition = function (p) { this._el.style.top = p.y + 'px'; this._el.style.left = p.x + 'px'; }\n\tthis.getPosition = function () { return {x: this.getX(), y: this.getY()}; }\n\t\n\tthis.setDimensions = function (d) { this._el.style.width = d.width + 'px'; this._el.style.height = d.height + 'px'; return this; }\n\tthis.getDimensions = function () { return {width: this.getWidth(), height: this.getHeight()}; }\n});\n","pre":true},"sdk/timestep/platforms/browser/TextInput.js":{"path":"sdk/timestep/platforms/browser/TextInput.js","friendlyPath":".TextInput","directory":"sdk/timestep/platforms/browser/","filename":"TextInput.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\"use import\";\n\n/**\n * package timestep.env.browser.TextInput;\n *\n * A textbox for inputting user data.\n */\n\njsio(\"import lib.PubSub\");\njsio(\"from util.browser import $\");\n\n/**\n * @extends lib.PubSub\n */\nvar sdk_timestep_platforms_browser_TextInput=__class__;exports=sdk_timestep_platforms_browser_TextInput(function sdk_timestep_platforms_browser_TextInput(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\tthis.init = function (opts) {\n\t\tthis._el = $({\n\t\t\ttag: 'input',\n\t\t\tparent: document.body,\n\t\t\tstyle: {\n\t\t\t\tposition: 'absolute',\n\t\t\t\tleft: '-100px',\n\t\t\t\ttop: '-100px'\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\ttype: 'text',\n\t\t\t\tvalue: opts && opts.value || ''\n\t\t\t}\n\t\t});\n\t\tthis._value = this._el.value;\n\t\tthis._selectionStart = 0;\n\t\tthis._selectionEnd = 0;\n\t\t\n\t\t$.onEvent(this._el, 'keydown', this, 'checkValue');\n\t\t$.onEvent(this._el, 'keyup', this, 'checkValue');\n\t\t$.onEvent(this._el, 'keypress', this, 'checkValue');\n\t\t$.onEvent(this._el, 'focus', this, 'onFocus');\n\t\t$.onEvent(this._el, 'blur', this, 'onBlur');\n\t}\n\t\n\tthis.onFocus = function () { this.publish('Focus'); }\n\tthis.onBlur = function () { this.publish('Blur'); }\n\t\n\tthis.checkValue = function (evt) {\n\t\tvar target = evt.target,\n\t\t\tstart = target.selectionStart,\n\t\t\tend = target.selectionEnd;\n\t\t\n\t\tvar value = this._el.value;\n\t\t\n\t\tif (value != this._value) {\n\t\t\tthis.publish('ChangeValue', value);\n\t\t\tthis._value = value;\n\t\t}\n\t\t\n\t\tif (start != this._selectionStart) {\n\t\t\tthis._selectionStart = start;\n\t\t\tthis.publish('ChangeSelectionStart', start);\n\t\t}\n\t\t\n\t\tif (end != this._selectionEnd) {\n\t\t\tthis._selectionEnd = end;\n\t\t\tthis.publish('ChangeSelectionEnd', end);\n\t\t}\n\t}\n\t\n\tthis.focus = function () { logger.log('focus'); this._el.focus(); }\n\tthis.blur = function () { this._el.blur(); }\n});\n\n\n// Set desired tab- defaults to four space softtab\nvar tab = '    ',\n\ttabLength = 4;\n\nArray.prototype.map.call(document.getElementsByTagName('textarea'), function (el) {\n\tel.addEventListener('keydown', checkTab, false);\n});\n\nfunction checkTab(evt) {\n\tvar t = evt.target;\n\tvar ss = t.selectionStart;\n\tvar se = t.selectionEnd;\n \n\t// Tab key - insert tab expansion\n\tif (evt.keyCode == 9) {\n\t\tevt.preventDefault();\n\t\t\n\t\tif (evt.shiftKey) {\n\t\t\t// Special case of multi line selection\n\t\t\tif (ss != se && t.value.slice(ss,se).indexOf('\\n') != -1) {\n\t\t\t\t// In case selection was not of entire lines (e.g. selection begins in the middle of a line)\n\t\t\t\t// we ought to tab at the beginning as well as at the start of every following line.\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\t\t\t\tvar pre = t.value.slice(0, i);\n\t\t\t\tvar post = t.value.slice(se, t.value.length);\n\t\t\t\tvar sel = t.value.slice(i, se).replace(\n\t\t\t\t\tnew RegExp('(^|\\n)' + tab, 'g'),\n\t\t\t\t\tfunction (match) {\n\t\t\t\t\t\tse -= tab.length;\n\t\t\t\t\t\tif (match.charAt(0) == '\\n') {\n\t\t\t\t\t\t\treturn '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tss -= tab.length;\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\tt.value = pre.concat(sel).concat(post);\n\n\t\t\t\tt.selectionStart = ss;\n\t\t\t\tt.selectionEnd = se;\n\t\t\t} else {\n\t\t\t\t// \"Normal\" case (no selection or selection on one line only)\n\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\t\t\t\tif (t.value.substring(i, i + tab.length) == tab) {\n\t\t\t\t\tt.value = t.value.slice(0, i).concat(t.value.slice(i + tab.length, t.value.length));\n\t\t\t\t\tif (ss == se) {\n\t\t\t\t\t\tt.selectionStart = t.selectionEnd = ss - (ss == i ? 0 : tab.length);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt.selectionStart = ss - (ss == i ? 0 : tab.length);\n\t\t\t\t\t\tt.selectionEnd = se - tab.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Special case of multi line selection\n\t\t\tif (ss != se && t.value.slice(ss,se).indexOf(\"\\n\") != -1) {\n\t\t\t\t// In case selection was not of entire lines (e.g. selection begins in the middle of a line)\n\t\t\t\t// we ought to tab at the beginning as well as at the start of every following line.\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\t\t\t\tvar pre = t.value.slice(0, i);\n\t\t\t\tvar post = t.value.slice(se, t.value.length);\n\t\t\t\tvar sel = t.value.slice(i, se).replace(/\\n/g, function () {\n\t\t\t\t\tse += tab.length;\n\t\t\t\t\treturn '\\n' + tab;\n\t\t\t\t});\n\t\t\t\tt.value = pre.concat(tab).concat(sel).concat(post);\n\n\t\t\t\tt.selectionStart = ss + tab.length;\n\t\t\t\tt.selectionEnd = se + tab.length;\n\t\t\t} else {\n\t\t\t\t// \"Normal\" case (no selection or selection on one line only)\n\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\n\t\t\t\tt.value = t.value.slice(0, i).concat(tab).concat(t.value.slice(i, t.value.length));\n\n\t\t\t\tif (ss == se) {\n\t\t\t\t\tt.selectionStart = t.selectionEnd = ss + tab.length;\n\t\t\t\t} else {\n\t\t\t\t\tt.selectionStart = ss + tab.length;\n\t\t\t\t\tt.selectionEnd = se + tab.length;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (evt.shiftKey || evt.metaKey || evt.ctrlKey) {\n\t\treturn;\n\t} else if (evt.keyCode == 8 && t.value.slice(ss - tabLength, ss) == tab) {\n\t\t// Backspace key - delete preceding tab expansion, if exists\n\t\tevt.preventDefault();\n\t\t\n\t\tt.value = t.value.slice(0,ss - tabLength).concat(t.value.slice(ss,t.value.length));\n\t\tt.selectionStart = t.selectionEnd = ss - tab.length;\n\t} else if (evt.keyCode == 46 && t.value.slice(se, se + tabLength) == tab) {\n\t\t// Delete key - delete following tab expansion, if exists\n\t\tevt.preventDefault();\n\t\t\n\t\tt.value = t.value.slice(0,ss).concat(t.value.slice(ss + tabLength,t.value.length));\n\t\tt.selectionStart = t.selectionEnd = ss;\n\t} else if (evt.keyCode == 37 && t.value.slice(ss - tabLength, ss) == tab) {\n\t\t// Left/right arrow keys - move across the tab in one go\n\t\tevt.preventDefault();\n\t\tt.selectionStart = t.selectionEnd = ss - tabLength;\n\t} else if (evt.keyCode == 39 && t.value.slice(ss, ss + tabLength) == tab) {\n\t\tevt.preventDefault();\n\t\tt.selectionStart = t.selectionEnd = ss + tabLength;\n\t}\n}\n","pre":true},"sdk/timestep/platforms/browser/Timer.js":{"path":"sdk/timestep/platforms/browser/Timer.js","friendlyPath":".Timer","directory":"sdk/timestep/platforms/browser/","filename":"Timer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.Timer;\n *\n * System timer exposed to the device.\n */\n\nvar _onTick = null,\n\tdisableRequestAnimFrame = false,\n\tdisablePostMessage = true,\n\tasFastAsPossible = false,\n\tMIN_DT = 16;\n\nif (window.postMessage) {\n\tfunction postMessageCb(evt) { if (evt.data == 'timestep.TICK') { onFrame(); }}\n\t\n\tif (window.addEventListener) {\n\t\twindow.addEventListener('message', postMessageCb, false);\n\t} else {\n\t\twindow.attachEvent('onmessage', postMessageCb);\n\t}\n} else {\n\tdisablePostMessage = true;\n\ttickNow = sendTimeoutNow;\n}\n\nfunction sendPostMessage() { window.postMessage('timestep.TICK', '*'); }\nfunction sendTimeout() { setTimeout(onFrame, MIN_DT); }\nfunction sendTimeoutNow() { setTimeout(onFrame, 0); }\n\nvar fastDriver = sendTimeoutNow,\n\tmainDriver = sendTimeout;\n\nif (asFastAsPossible) {\n\tif (!disablePostMessage) {\n\t\tfastDriver = mainDriver = sendPostMessage;\n\t} else {\n\t\tmainDriver = sendTimeoutNow;\n\t}\n} else {\n\tvar reqAnim = !disableRequestAnimFrame && (\n\t\t\t\t\twindow.requestAnimationFrame\n\t\t\t\t|| window.webkitRequestAnimationFrame\n\t\t\t\t|| window.mozRequestAnimationFrame\n\t\t\t\t|| window.oRequestAnimationFrame\n\t\t\t\t|| window.msRequestAnimationFrame);\n\t\n\tif (reqAnim) {\n\t\tfastDriver = mainDriver = reqAnim;\n\t} else if (!disablePostMessage) {\n\t\tfastDriver = sendPostMessage;\n\t}\n}\n\n/*\nvar frameDts = [];\nvar print = false, frames = 0, lastPrint = 0;\nsetInterval(function () { print = true; }, 1000)\n\nvar slow = 0, fast = 0;\n*/\n\nfunction onFrame() {\n\tif (_onTick) {\n\t\tvar now = +new Date(),\n\t\t\tdt = now - (exports.last || now);\n\t\t\n\t\texports.last = now;\n\t\t\n\t\t//try {\n\t\t\t_onTick(dt);\n\t\t/*} catch (e) {\n\t\t\tif (window.DEV_MODE) {\n\t\t\t\tvar err = '.dev_error';\n\t\t\t\tjsio('import ' + err).render(e);\n\t\t\t\texports.stop();\n\t\t\t}\n\t\t}*/\n\n\t\t/*\n\t\tframeDts.push(dt);\n\t\tvar delay = +new Date() - now;\n\t\t++frames;\n\t\tif (print) {\n\t\t\tlogger.log(fast, slow, JSON.stringify(frameDts), now - lastPrint, dt, frames, delay);\n\t\t\tframeDts = [];\n\t\t\tlastPrint = now;\n\t\t\tprint = false;\n\t\t\tframes = 0;\n\t\t\tslow = 0;\n\t\t\tfast = 0;\n\t\t}\n\t\t*/\n\t\t\n\t\tif (dt > MIN_DT) {\n\t\t//\t++fast;\n\t\t\tfastDriver.call(window, onFrame);\n\t\t} else {\n\t\t//\t++slow;\n\t\t\tmainDriver.call(window, onFrame);\n\t\t}\n\t}\n}\n\nexports.last = null;\n\nexports.start = function (onTick) {\n\t_onTick = onTick;\n\tmainDriver.call(window, onFrame);\n}\n\nexports.stop = function () { _onTick = null; }\n","pre":true},"sdk/timestep/platforms/browser/EditText.js":{"path":"sdk/timestep/platforms/browser/EditText.js","friendlyPath":".EditText","directory":"sdk/timestep/platforms/browser/","filename":"EditText.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"from util.browser import $\");\njsio(\"import squill.Widget\");\n\nInputField=__class__;var InputField=InputField(function InputField(){return this.init&&this.init.apply(this,arguments)},squill.Widget, function (supr) {\n\n    this._def = {\n        tag: 'input',\n        parent: document.body,\n        style: {\n            position: 'absolute',\n            zIndex: '10000',\n            bottom: '0px',\n            left: '0px',\n            right: '0px'\n        }\n    }\n\n    this.buildWidget = function () {\n        this.initKeyEvents();\n        this.initFocusEvents();\n    }\n\n    this.setValue = function (value) {\n        this._el.value = value;\n        this._prevValue = value;\n    }\n\n    this.setCursor = function (cursorPos) {\n        this._el.selectionStart = this._el.selectionEnd = cursorPos;\n    }\n\n    this.setPlaceholder = function (placeholder) {\n        this._el.placeholder = placeholder;\n    }\n\n    this.setMaxLength = function (maxLength) {\n        this._el.maxlength = maxLength;\n    }\n\n    this.show = function () {\n        supr(this, 'show', arguments);\n\n        this._el.focus();\n    }\n\n    this.onKeyUp = function (evt) {\n        var el = this._el;\n        _focused && _focused.onChange(el.value, this._prevValue, el.selectionStart, el.selectionEnd);\n        this._prevValue = el.value;\n        if (evt.keyCode == 13) {\n            _focused && _focused.closeEditField();\n        }\n    }\n\n    this.getValue = function () { return this._el.value; }\n\n    this.onBlur = function (evt) {\n        this.hide();\n        _focused = null;\n        //_focused && _focused.closeEditField();\n    }\n\n})\n\nvar _input = new InputField();\n_input.hide();\n\nvar _focused = null;\n\nvar sdk_timestep_platforms_browser_EditText=__class__;exports=sdk_timestep_platforms_browser_EditText(function sdk_timestep_platforms_browser_EditText(){return this.init&&this.init.apply(this,arguments)},function () {\n\n    var defaults = {\n        hint: '',\n        inputType: 'default', // default | number | phone | password | capital\n        maxLength: -1\n    }\n\n\tthis.init = function (opts) {\n\t\tthis._opts = merge(opts, defaults);\n\n        this._textEditView = opts.textEditView;\n        this.onFocusChange = opts.onFocusChange || function() {};\n        this.onSubmit = opts.onSubmit || function () {}\n\t}\n\n    this.onChange = function (value, prevValue, cursorPos, selectionEnd) {\n        this._value = value;\n        if (this._opts.onChange) {\n            this._opts.onChange(value, prevValue, cursorPos);\n        }\n    }\n\n    this.getValue = function () {\n        return this._value;\n    }\n\n    this.setValue = function (value) {\n        this._value = value;\n        this.onChange(value);\n    }\n\n    this.requestFocus = function() {\n        if (_focused !== this) {\n            if (_focused != null) {\n                _focused.removeFocus(); \n            }\n\n            this.onFocusChange(true);\n        }\n\n        _focused = this; \n    }\n\n    this.closeEditField = function() {\n        console.log(\"TextEditView editText removeFocus\");\n        if (_focused != null) {\n            _focused.removeFocus();\n        }\n\n        _input.hide();\n        // NATIVE.inputPrompt.hideSoftKeyboard(); \n     }\n\n    this.refresh = function(value, hasBack, hasForward, cursorPos) {\n\n        _input.setCursor(cursorPos);\n    \t_input.setValue(value);\n        _input.setPlaceholder(this._opts.hint);\n        _input.setMaxLength(this._opts.maxLength);\n        _input.show();\n\n    \t/*\n    \tif (hasBack) {\n\t\t\t_backButton.onSelect = bind(this, function () {\n\t\t\t\tthis._textEditView.focusPrevious());\n\t\t\t});\n\t\t\t_backButton.disabled = false;\n\t\t} else {\n\t\t\t_backButton.disabled = true;\n\t\t}\n\n    \tif (hasForward) {\n\t\t\t_forwardButton.onSelect = bind(this, function () {\n\t\t\t\tthis._textEditView.focusNext());\n\t\t\t});\n\t\t\t_forwardButton.disabled = false;\n\t\t} else {\n\t\t\t_forwardButton.disabled = true;\n\t\t}\n\n\t\t*/\n    }\n\n    this.hasFocus = function() {\n        return this == _focused;\n    }\n\n    this.removeFocus = function() {\n        this.onFocusChange(false);\n        this.onSubmit(_input.getValue());\n        if (_focused == this) {\n            _focused = null;    \n        }\n    }\n\n    this.setHint = function(hint) {\n        this._opts.hint = hint;\n    }\n});\n","pre":true},"sdk/squill/Widget.js":{"path":"sdk/squill/Widget.js","friendlyPath":"squill.Widget","directory":"sdk/squill/","filename":"Widget.js","baseMod":"squill","basePath":"sdk/","src":"jsio(\"from util.browser import $\");\njsio(\"import .Element, .Events, .global\");\njsio(\"import .i18n\");\njsio(\"import .Delegate\");\njsio(\"from .__imports__ import classes as WIDGET_CLASSES\");\n\nvar uid = 0;\n\nfunction shallowCopy(p) {\n\tvar o = {};\n\tfor(var i in p) {\n\t\tif(p.hasOwnProperty(i)) {\n\t\t\to[i] = p[i];\n\t\t}\n\t}\n\treturn o;\n}\n\nWidgetSet=__class__;var WidgetSet=WidgetSet(function WidgetSet(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (target) {\n\t\tthis._target = target;\n\t\tthis.events = [];\n\t}\n\n\tthis.hasWidget = function (id) { return !!this._target[id]; };\n\n\tthis.addWidget = function (id, widget) {\n\t\tthis._target[id] = widget;\n\t};\n\n\tthis.addSubscription  = function(widget, signal /* ... args */) {\n\t\tif (this._target.dispatchEvent) {\n\t\t\twidget.subscribe.apply(widget, [signal, this._target, 'dispatchEvent'].concat(Array.prototype.slice.call(arguments, 2)));\n\t\t}\n\t}\n});\n\nvar sdk_squill_Widget=__class__;var Widget = exports=sdk_squill_Widget(function sdk_squill_Widget(){return this.init&&this.init.apply(this,arguments)},[Element, Events], function() {\n\tthis._css = 'widget';\n\tthis._name = '';\n\n\tthis.__getDef__ = function () {\n\t\tvar protoDef = this.constructor.prototype._def;\n\t\tvar cls = this.constructor;\n\t\tvar def;\n\t\twhile ((cls = cls.prototype.__parentClass__)) {\n\t\t\tif (cls.prototype.hasOwnProperty('_def')) {\n\t\t\t\tif (!def) { def = protoDef || {}; }\n\n\t\t\t\tcopyDef(def, cls.prototype._def);\n\t\t\t}\n\t\t}\n\n\t\t// no parent classes were merged in?\n\t\tif (!def) { def = protoDef || {}; }\n\n\t\t// handle base _def\n\t\tif (this.hasOwnProperty('_def')) {\n\t\t\tcopyDef(def, this._def);\n\t\t}\n\n\t\tfunction copyDef (target, src) {\n\t\t\tfor (var key in src) {\n\t\t\t\tif (key == 'attrs' || key == 'style') {\n\t\t\t\t\ttarget[key] = merge(target[key], src[key]);\n\t\t\t\t} if (key == 'className' && target.className) {\n\t\t\t\t\ttarget.className = src.className + ' ' + target.className;\n\t\t\t\t} else if (key == 'children' && target.children) {\n\t\t\t\t\ttarget.children = src.children.concat(target.children);\n\t\t\t\t} else if (!target.hasOwnProperty(key)) {\n\t\t\t\t\ttarget[key] = src[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn def;\n\t}\n\n\tthis.init = function(opts) {\n\t\topts = opts || {};\n\n\t\tthis._id = opts.id;\n\n\t\tthis._children = [];\n\n\t\t// ===\n\t\t// merge this._def and opts\n\n\t\tvar def = this._def = this.__getDef__();\n\n\t\t// className merges\n\t\tif (def.className) {\n\t\t\topts.className = opts.className ? opts.className + \" \" + def.className : def.className;\n\t\t}\n\n\t\tif (def.attrs) {\n\t\t\topts.attrs = merge(opts.attrs, def.attrs);\n\t\t}\n\n\t\tif (def.style) {\n\t\t\topts.style = merge(opts.style, def.style);\n\t\t}\n\t\t\n\t\t// opts take precedence over def\n\t\tthis._opts = opts;\n\t\tfor (var name in def) {\n\t\t\tif (name != 'children' && !opts.hasOwnProperty(name) && def.hasOwnProperty(name)) {\n\t\t\t\topts[name] = def[name];\n\t\t\t}\n\t\t}\n\n\t\t// delete opts.children;\n\n\t\t// end merge\n\t\t// ===\n\n\t\tif (opts.name) { this._name = opts.name; }\n\t\tif (opts.delegate) { this.delegate = opts.delegate; }\n\t\tif (opts.controller) { this.controller = opts.controller; }\n\n\t\tif (opts.parent) {\n\t\t\tvar parent = this._parent = opts.parent;\n\t\t\tvar hasWidgetParent = parent instanceof Widget;\n\t\t\tif (hasWidgetParent) {\n\t\t\t\tvar widgetParent = opts.parent;\n\t\t\t\topts.parent = parent.getContainer();\n\t\t\t} else if (!parent.appendChild) {\n\t\t\t\tdelete opts.parent;\n\t\t\t}\n\t\t\t\n\t\t\tthis.build(opts.el);\n\t\t\t\n\t\t\tif (hasWidgetParent) {\n\t\t\t\twidgetParent.addWidget(this);\n\t\t\t}\n\t\t} else if (opts.el) {\n\t\t\tthis.build(opts.el);\n\t\t}\n\t};\n\n\tthis.getId = function () {\n\t\treturn this._id || (this._el && this._el.id);\n\t}\n\n\tthis.build = function (el) {\n\t\tif (!this._el || this._el != el) {\n\t\t\tvar opts = this._opts;\n\t\t\tvar children = opts.children;\n\t\t\t\n\t\t\tif (children) { delete opts.children; }\n\t\t\tthis._el = $.create(this._opts);\n\t\t\tif (children) { opts.children = children; }\n\n\t\t\tthis.buildContent();\n\t\t}\n\t\t\n\t\treturn this;\n\t}\n\n\tthis.getParent = function() { return this._parent; };\n\n\tthis.setParent = function(parent) {\n\t\tthis._parent = parent;\n\t\tvar el = parent && (parent.getContainer && parent.getContainer() || parent.appendChild && parent || null);\n\t\tif (el) {\n\t\t\tif (!this._el) {\n\t\t\t\tthis._opts.parent = el;\n\t\t\t\tthis.build();\n\t\t\t} else {\n\t\t\t\tel.appendChild(this._el);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getChildren = function() {\n\t\treturn this._children;\n\t};\n\n\tthis.forEachDescend = function (cb, ctx) {\n\t\tvar n = this._children.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tvar child = this._children[i];\n\t\t\tcb.call(ctx, child);\n\t\t\tif (child.forEachDescend) {\n\t\t\t\tchild.forEachDescend(cb, ctx);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getFirstChild = function() {\n\t\treturn (this._children && this._children.length) ? this._children[0] : null;\n\t};\n\n\tthis.dispatchEvent = function(target, evt) {\n\t\tthis.delegate.call(this, target, evt);\n\t};\n\n\tthis.addElement = function (el) {\n\t\tthis._el.appendChild(el);\n\t}\n\n\tthis.addWidget = function(def, result) {\n\t\tif (!this._el) { this.build(); }\n\n\t\t// def is either a Widget or a definition for a Widget\n\t\tif (!(def instanceof Widget)) {\n\t\t\t// if it is not yet a widget, make it (or make a DOM node)\n\t\t\tvar opts = merge({}, def, {parent: this.getContainer(), __result: result});\n\t\t\tif (opts.children) {\n\t\t\t\tvar children = opts.children;\n\t\t\t\tdelete opts.children;\n\t\t\t}\n\n\t\t\tvar el;\n\t\t\tif ('type' in opts && !opts.type) {\n\t\t\t\tlogger.warn('Did you forget to provide a type?', opts);\n\t\t\t}\n\t\t\t\n\t\t\tif (!opts.type || typeof opts.type == 'string') {\n\t\t\t\tif (WIDGET_CLASSES[opts.type]) {\n\t\t\t\t\tvar Constructor = jsio('import ' + WIDGET_CLASSES[opts.type]);\n\t\t\t\t\tel = new Constructor(opts);\n\t\t\t\t} else {\n\t\t\t\t\tswitch (opts.type) {\n\t\t\t\t\t\tcase 'checkbox':\n\t\t\t\t\t\t\tjsio(\"import .CheckBox\");\n\t\t\t\t\t\t\tel = new CheckBox(opts);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'image':\n\t\t\t\t\t\t\tel = $(merge({tag: 'img'}, opts));\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'button':\n\t\t\t\t\t\t\tif (typeof TextButton == 'undefined') {\n\t\t\t\t\t\t\t\tjsio(\"import .TextButton\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tel = new TextButton(opts);\n\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\tresult.addSubscription(el, 'Select', opts.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'select':\n\t\t\t\t\t\t\tjsio(\"import .SelectBox\");\n\t\t\t\t\t\t\tel = new SelectBox(opts);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tel = $(opts);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tel = new opts.type(opts);\n\t\t\t}\n\t\t\t\n\t\t\tif (result && opts.id && !result.hasWidget(opts.id)) {\n\t\t\t\tresult.addWidget(opts.id, el);\n\t\t\t}\n\t\t} else {\n\t\t\tel = def;\n\t\t}\n\t\t\n\t\tif (el instanceof Widget) {\n\t\t\tif (!el.getParent()) { el.setParent(this); }\n\t\t\tthis._children.push(el);\n\t\t}\n\n\t\tif (children) {\n\t\t\tif (el.buildChildren) {\n\t\t\t\tif (!result) { result = new WidgetSet(el); }\n\t\t\t\tel.buildChildren(children, result);\n\t\t\t} else {\n\t\t\t\tfor (var i = 0, c; c = children[i]; ++i) {\n\t\t\t\t\tthis.addWidget(merge({parent: el}, c), result);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn el;\n\t};\n\n\tthis.getContainer = function() { return this._el; };\n\tthis.getName = function() { return this._name; };\n\tthis.setName = function(name) { this._name = name; };\n\n\tthis.buildContent = function() {\n\t\tvar opts = this._opts;\n\n\t\tif (global.getWidgetPrefix() !== null) {\n\t\t\t$.addClass(this._el, global.getWidgetPrefix() + this._css);\n\t\t}\n\n\t\tif (!this.delegate) { this.delegate = new Delegate(); }\n\n\t\t// TODO: what's this doing here?\n\t\tif (opts.errorLabel) {\n\t\t\tthis._errorLabel = $.create({html: opts.errorLabel, className: global.getWidgetPrefix() + 'textInputErrorLabel', parent: this._el});\n\t\t}\n\n\t\tvar def = this._def;\n\n\t\t// def items always go on the widget\n\t\tif (def && def.children) {\n\t\t\tvar localRes = new WidgetSet(this);\n\t\t\tthis.buildChildren(def.children, localRes);\n\t\t}\n\n\t\tvar result = opts.__result || new WidgetSet(this);\n\n\t\t// opts items sometimes go on the widget\n\t\tif (opts.children) {\n\t\t\tthis.buildChildren(opts.children, result);\n\t\t}\n\n\t\tthis.buildWidget(this._el, result);\n\t};\n\n\tthis.buildChildren = function(children, result) {\n\t\tfor (var i = 0, n = children.length; i < n; ++i) {\n\t\t\tthis.addWidget(children[i], result);\n\t\t}\n\t};\n\n\tthis.buildWidget = function() {};\n\n\t// TODO: what's this doing here?\n\tthis.errors = function() {\n\t\treturn this.validators.map(function(item){\n\t\t\tif (item.isValid == false){\n\t\t\t\treturn item.message;\n\t\t\t}\n\t\t});\n\t};\n\n\t// TODO: what's this doing here?\n\tthis.validate = function() {\n\t\tvar isValid = true;\n\t\tfor (var i = 0, len = this.validators.length; i < len; ++i) {\n\t\t\tvar v = this.validators[i];\n\t\t\tisValid = isValid && (v.isValid = v.call(this));\n\t\t}\n\t\treturn (this._isValid = isValid);\n\t};\n\n\t// TODO: what's this doing here?\n\tthis._isValid = true;\n\tthis.isValid = function() { return this._isValid; }\n\tthis.validators = [];\n\n\tthis.getI18n = function(key, id) {\n\t\tvar src = key in this._opts\n\t\t\t? this._opts\n\t\t\t: i18n.get(id || this._opts.id);\n\t\t\n\t\treturn src && src[key] || '';\n\t};\n\n\tthis.getElement = function() {\n\t\tif (!this._el) { this.build(); }\n\t\treturn this._el;\n\t};\n\n\tthis.onBeforeShow = function() {\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onBeforeShow.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.onShow = function() {\n\t\tthis._isShowing = true;\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onShow.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.onBeforeHide = function() {\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onBeforeHide.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.onHide = function() {\n\t\tthis._isShowing = false;\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onHide.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.isShowing = function() { return this._isShowing; }\n\n\tthis.show = function() {\n\t\tthis.onBeforeShow();\n\t\t$.show(this.getElement());\n\t\tthis.onShow();\n\t};\n\n\tthis.hide = function() {\n\t\tthis.onBeforeHide();\n\t\t$.hide(this.getElement());\n\t\tthis.onHide();\n\t};\n\n\tthis.remove = function() {\n\t\tthis.onBeforeHide();\n\t\t$.remove(this.getElement());\n\t\tthis.onHide();\n\t};\n\n\tthis.putHere = function() {\n\t\tif(!this._el) { this.build(); }\n\t\t\n\t\tvar id = 'jsioWidgetId' + (++uid);\n\t\tglobal.getTargetDocument().write('<div id=\"'+id+'\"></div>');\n\t\tsetTimeout(bind(this, _replaceNode, id), 0);\n\t\t\n\t\treturn this;\n\t};\n\n\tfunction _replaceNode(id) {\n\t\tvar el = $.id(id);\n\t\tel.parentNode.insertBefore(this._el, el);\n\t\tel.parentNode.removeChild(el);\n\t};\n\n\tthis.appendTo = function(parent) {\n\t\tif(parent) {\n\t\t\tvar parent = $.id(parent);\n\t\t\tif(!this._el) { this.build(); }\n\t\t\tparent.appendChild(this._el);\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.onclick = function(f) { $.onEvent(this._el, 'click', f); return this; };\n});\n\nvar map = {};\nvar lowerCaseMap = {}\nWidget.register = function(cls, name) {\n\tif (name in map) { throw Error(\"A widget with name '\" + name + \"' is already registered\"); }\n\tmap[name] = cls;\n\tlowerCaseMap[name.toLowerCase()] = cls;\n};\n\nWidget.get = function(name) {\n\treturn lowerCaseMap[name.toLowerCase()];\n}\n\nWidget.WidgetSet = WidgetSet;\n","pre":true},"sdk/squill/Element.js":{"path":"sdk/squill/Element.js","friendlyPath":".Element","directory":"sdk/squill/","filename":"Element.js","src":"\"use import\";\n\njsio(\"import lib.PubSub\");\njsio(\"from util.browser import $\");\n\nvar sdk_squill_Element=__class__;var Element = exports=sdk_squill_Element(function sdk_squill_Element(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function(supr) {\n\tthis.init = function(opts) {\n\t\tthis._opts = JS.merge(opts, {\n\t\t\twin: window,\n\t\t\ttag: 'div'\n\t\t});\n\t}\n\t\n\tthis.build = function() {\n\t\tif (!this._el) {\n\t\t\tif (this._opts.el) {\n\t\t\t\tthis._el = this._opts.el;\n\t\t\t\t$.apply(this._el, this._opts);\n\t\t\t} else {\n\t\t\t\tthis._el = $.create(this._opts);\n\t\t\t}\n\t\t\n\t\t\tthis.buildContent();\n\t\t}\n\t\t\n\t\treturn this;\n\t}\n\t\n\tthis.getId = function() { return this._el && this._el.id || this._opts && this._opts.id; }\n\t\n\tthis.buildContent = function() {}\n\t\n\tthis.destroy = function() {\n\t\tif (!this._el) { return; }\n\t}\n\t\n\tthis.getElement = function() { return this._el || this.build()._el; }\n\t\n\tthis.appendChild = function(el) {\n\t\tif (!this._el) { this.build(); }\n\t\tthis._el.appendChild(el instanceof Element ? el._el : el);\n\t\t\n\t\treturn this;\n\t}\n\t\n\tthis.appendTo = function(el) {\n\t\tif (!this._el) { this.build(); }\n\t\t\n\t\tif (el instanceof Element) {\n\t\t\tel.appendChild(this);\n\t\t} else {\n\t\t\tel.appendChild(this._el);\n\t\t}\n\t\t\n\t\treturn this;\n\t}\n\t\n\tthis.setPos = function(x, y) {\n\t\tthis._el.style.x = x + 'px';\n\t\tthis._el.style.y = y + 'px';\n\t}\n\t\n\tthis.center = function() {\n\t\tvar dim = $(window);\n\t\tthis.setPos(Math.max(0, dim.width - this._el.offsetWidth) / 2, Math.max(0, dim.height - this._el.offsetHeight) / 2);\n\t}\n\t\n\tthis.remove = function() { $.remove(this._el); }\n});\n","pre":true},"sdk/squill/Events.js":{"path":"sdk/squill/Events.js","friendlyPath":".Events","directory":"sdk/squill/","filename":"Events.js","src":"\"use import\";\n\njsio(\"from util.browser import $\");\njsio(\"import .Drag\");\njsio(\"import lib.PubSub\");\n\nvar sdk_squill_Events=__class__;exports=sdk_squill_Events(function sdk_squill_Events(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\tvar SLICE = Array.prototype.slice;\n\n\tvar isMobile = /(iPod|iPhone|iPad|Android)/i.test(navigator.userAgent);\n\n\tthis.event = function(el, name, handler) {\n\t\tif (!this._eventEnabled) { this._eventEnabled = {}; }\n\t\tvar args = [this, handler].concat(SLICE.call(arguments, 3)),\n\t\t\thandler = bind.apply(this, args),\n\t\t\tevents = this._eventEnabled;\n\t\t\n\t\tevents[name] = true;\n\t\t$.onEvent(el, name, function() {\n\t\t\tif (events[name]) {\n\t\t\t\treturn handler.apply(this, arguments);\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.isDragging = function() {\n\t\treturn this._isDragging || false;\n\t};\n\n\tthis.initDragEvents = function(el) {\n\t\tif (!this.__drag) {\n\t\t\tvar d = this.__drag = new Drag();\n\t\t\td.subscribe('DragStart', this, 'onDragStart');\n\t\t\td.subscribe('Drag', this, 'onDrag');\n\t\t\td.subscribe('DragStop', this, 'onDragStop');\n\t\t}\n\t\t\n\t\tvar startDrag = bind(this.__drag, 'startDrag');\n\t\tif (!el) { el = this._el; }\n\t\tif (el.addEventListener) { el.addEventListener('touchstart', startDrag, true); }\n\t\t$.onEvent(el, 'mousedown', startDrag);\n\t};\n\n\tthis.initMouseEvents = function(el) {\n\t\tel = el || this._el;\n\t\t\n\t\tif (isMobile) {\n\t\t\tthis.event(el, 'touchstart', '_onTouchStart');\n\t\t\tthis.event(el, 'touchend', '_onTouchEnd');\n\t\t} else {\n\t\t\tthis.event(el, 'mouseover', 'onMouseOver');\n\t\t\tthis.event(el, 'mousemove', 'onMouseMove');\n\t\t\tthis.event(el, 'mouseout', 'onMouseOut');\n\t\t\tthis.event(el, 'mousedown', 'onMouseDown');\n\t\t\tthis.event(el, 'mouseup', 'onMouseUp');\n\t\t\tthis.event(el, 'click', 'onClick');\n\t\t}\n\t\t\n\t\treturn this;\n\t};\n\n\tthis.initFocusEvents = function(el) {\n\t\tel = el || this._el;\n\t\tthis.event(el, 'focus', 'onFocus');\n\t\tthis.event(el, 'blur', 'onBlur');\n\t\treturn this;\n\t};\n\n\tthis.initKeyEvents = function(el) {\n\t\tel = el || this._el;\n\t\tthis.event(el, 'keydown', 'onKeyDown');\n\t\tthis.event(el, 'keypress', 'onKeyPress');\n\t\tthis.event(el, 'keyup', 'onKeyUp');\n\t\treturn this;\n\t}\n\t\n\tthis._onTouchStart = function(e) {\n\t\tthis.onMouseOver(e);\n\t\tthis.onMouseDown(e);\n\t};\n\n\tthis._onTouchEnd = function(e) {\n\t\tthis.onMouseUp(e);\n\t\tthis.onClick(e);\n\t\tthis.onMouseOut(e);\n\t};\n\n\tthis.onMouseOver = function(e) {\n\t\tif (!this._enableMouseEvents) \n\t\tthis._isOver = true;\n\t\tthis.publish('Over', e);\n\t};\n\n\tthis.onMouseMove = function(e) {\n\t\tif (!this._enableMouseEvents) \n\t\tthis.publish('Move', e);\n\t};\n\n\tthis.onMouseOut = function(e) {\n\t\tthis._isOver = false;\n\t\tthis.publish('Out', e);\n\t};\n\n\tthis.onMouseDown = function(e) {\n\t\tthis._isDown = true;\n\t\tthis.publish('Down', e);\n\t\treturn false;\n\t};\n\n\tthis.onMouseUp = function(e) {\n\t\tthis._isDown = false;\n\t\tthis.publish('Up', e);\n\t\treturn false;\n\t};\n\n\tthis.onClick = function(e) {\n\t\tthis.publish('Select', e);\n\t\treturn false;\n\t};\n\n\tthis.onFocus = function(e) {\n\t\tthis._isFocused = true;\n\t\tthis.publish('Focus', e);\n\t};\n\n\tthis.onBlur = function(e) {\n\t\tthis._isFocused = false;\n\t\tthis.publish('Blur', e);\n\t};\n\n\tthis.onKeyUp = function(e) {\n\t\tthis.publish('KeyUp', e);\n\t};\n\n\tthis.onKeyPress = function(e) {\n\t\tthis.publish('KeyPress', e);\n\t};\n\n\tthis.onKeyDown = function(e) {\n\t\tthis.publish('KeyDown', e);\n\t};\n\n\tthis.onDragStart = function(dragEvt) {};\n\tthis.onDrag = function(dragEvt, moveEvt) {};\n\tthis.onDragStop = function(dragEvt, upEvt) {};\n});\n","pre":true},"sdk/squill/Drag.js":{"path":"sdk/squill/Drag.js","friendlyPath":".Drag","directory":"sdk/squill/","filename":"Drag.js","src":"jsio(\"import lib.PubSub\");\njsio(\"import math.geom.Point as Point\");\njsio(\"from util.browser import $\");\n\nvar gCurrentDrag = [],\n\tgCurrentMouse = {x: 0, y: 0};\n\nfunction resolveMouse(e) {\n\tif (e.touches) { return resolveMouse(e.touches[0]); }\n\t\n\tif ('pageX' in e) {\n\t\tgCurrentMouse.x = e.pageX;\n\t\tgCurrentMouse.y = e.pageY;\n\t} else { // looks like IE\n\t\tvar doc = document.documentElement,\n\t\t\tbody = document.body;\n\t\t\n\t\tgCurrentMouse.x = e.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n\t\tgCurrentMouse.y = e.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop  || body && body.clientTop  || 0);\n\t}\n}\n\nvar _active = false;\n\nfunction gAddItem(item) {\n\tgRemoveItem(item);\n\tgCurrentDrag.push(item);\n\t_active = true;\n}\n\nfunction gRemoveItem(item) {\n\tfor (var i = 0, len = gCurrentDrag.length; i < len; ++i) {\n\t\tif (gCurrentDrag[i] == item) {\n\t\t\tgCurrentDrag.splice(i, 1);\n\t\t\t--i;\n\t\t}\n\t}\n\t\n\tif (!gCurrentDrag[0]) { _active = false; }\n}\n\nfunction onMove(e) {\n\tif (!_active) { return; }\n\t\n\tresolveMouse(e);\n\tfor (var i = 0, len = gCurrentDrag.length; i < len; ++i) {\n\t\tgCurrentDrag[i].onMouseMove(e);\n\t}\n\t\n}\n\nfunction onUp(e) {\n\tif (!_active) { return; }\n\t\n\tfor (var i = 0, len = gCurrentDrag.length; i < len; ++i) {\n\t\tgCurrentDrag[i].onMouseUp(e);\n\t}\n}\n\nif ('ontouchstart' in window && document.addEventListener) {\n\tdocument.addEventListener('touchstart', resolveMouse, true);\n\tdocument.addEventListener('touchmove', onMove, true);\n\tdocument.addEventListener('touchend', onUp, true);\n} else {\n\tdocument.addEventListener('mousedown', resolveMouse, true);\n\tdocument.addEventListener('mousemove', onMove, true);\n\tdocument.addEventListener('mouseup', onUp, true);\n}\n\nvar sdk_squill_Drag=__class__;exports=sdk_squill_Drag(function sdk_squill_Drag(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function(supr) {\n\n\tthis.init = function(params) {\n\t\tthis._isActive = false;\n\t}\n\n\t// data is an optional object that will be added to dragEvt.data.\n\t// This allows the caller of startDrag to pass along arbitrary objects\n\t// to the DragStart, Drag, and DragStop events, since the receiver\n\t// can just read data off of the event object (first argument).\n\tthis.startDrag = function(params, data) {\n\t\tvar e = this._evt = new exports.DragEvent();\n\t\tthis._evt.data = data;\n\t\tthis._evt.params = merge(params, {\n\t\t\t/* addInScroll: true, */ // TODO?\n\t\t\tthreshold: 5\n\t\t});\n\t\t\n\t\te.srcPt = new Point(gCurrentMouse);\n\t\te.currPt = new Point(gCurrentMouse);\n\t\tgAddItem(this);\n\t}\n\t\n\tthis.onMouseMove = function(moveEvt) {\n\t\tvar dragEvt = this._evt,\n\t\t\tabsDelta = Point.subtract(gCurrentMouse, dragEvt.srcPt);\n\t\t\n\t\tif (!this._isActive && absDelta.getMagnitude() > dragEvt.params.threshold) {\n\t\t\tthis._isActive = true;\n\t\t\tthis.setIframesEnabled(false);\n\t\t\tthis.publish('DragStart', dragEvt);\n\t\t}\n\t\t\n\t\tif (this._isActive) {\n\t\t\t$.stopEvent(moveEvt);\n\t\t\t\n\t\t\tdragEvt.prevPt = dragEvt.currPt;\n\t\t\tdragEvt.currPt = new Point(gCurrentMouse);\n\t\t\tthis.publish('Drag', dragEvt, moveEvt, Point.subtract(dragEvt.currPt, dragEvt.prevPt));\n\t\t}\n\t}\n\t\n\tthis.onMouseUp = function(upEvt) {\n\t\tgRemoveItem(this);\n\t\tif (this._isActive) {\n\t\t\t\n\t\t\t$.stopEvent(upEvt);\n\t\t\tthis._isActive = false;\n\t\t\tthis.setIframesEnabled(true);\n\t\t\tthis.publish('DragStop', this._evt, upEvt);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tthis.setIframesEnabled = function (isEnabled) {\n\t\t$(\"iframe\").forEach(function (iframe) {\n\t\t\ttry {\n\t\t\t\tif (isEnabled) {\n\t\t\t\t\tiframe.style.pointerEvents = iframe.__squill_drag_pointer_events;\n\t\t\t\t} else {\n\t\t\t\t\tiframe.__squill_drag_pointer_events = getComputedStyle(iframe).getPropertyValue('pointerEvents');\n\t\t\t\t\tiframe.style.pointerEvents = 'none';\n\t\t\t\t}\n\t\t\t} catch (e) {};\n\t\t});\n\t}\n});\n\nexports.DragEvent=__class__;exports.DragEvent=exports.DragEvent(function exports_DragEvent(){return this.init&&this.init.apply(this,arguments)},function() {});\n","pre":true},"sdk/squill/global.js":{"path":"sdk/squill/global.js","friendlyPath":".global","directory":"sdk/squill/","filename":"global.js","src":"var gWidgetPrefix = 'squill-';\nvar gWin = window;\nvar gDoc = document;\n\nexports.setTargetWindow = function(w) { gWin = w; gDoc = w.document; }\nexports.getTargetWindow = function() { return gWin; }\nexports.getTargetDocument = function() { return gDoc; }\n\nexports.setWidgetPrefix = function(p) { gWidgetPrefix = p; }\nexports.getWidgetPrefix = function() { return gWidgetPrefix; }\n","pre":true},"sdk/squill/i18n.js":{"path":"sdk/squill/i18n.js","friendlyPath":".i18n","directory":"sdk/squill/","filename":"i18n.js","src":"var gLang = null;\n\nexports.setLang = function(lang) { gLang = lang; }\nexports.get = function(key) {\n\treturn gLang && gLang.get(key);\n}\n\nexports.Language=__class__;exports.Language=exports.Language(function exports_Language(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(dict) { this._dict = dict; }\n\tthis.add = function(key, value) { this._dict[key] = value; }\n\tthis.get = function(key) { return this._dict[key]; }\n});\n","pre":true},"sdk/squill/Delegate.js":{"path":"sdk/squill/Delegate.js","friendlyPath":".Delegate","directory":"sdk/squill/","filename":"Delegate.js","src":"var sdk_squill_Delegate=__class__;var Delegate = exports=sdk_squill_Delegate(function sdk_squill_Delegate(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(def) {\n\t\tdef && def(this);\n\t}\n\t\n\tthis.extend = function(def) {\n\t\tvar delegate = new Delegate(def);\n\t\tdelegate.parent = this;\n\t\treturn delegate;\n\t}\n\t\n\tthis.call = function(ctx, name) {\n\t\tif (this[name]) {\n\t\t\treturn this[name].apply(ctx, Array.prototype.slice.call(arguments, 1));\n\t\t} else if (this.parent) {\n\t\t\tthis.parent.call(ctx, name);\n\t\t}\n\t}\n});\n","pre":true},"sdk/squill/__imports__.js":{"path":"sdk/squill/__imports__.js","friendlyPath":".__imports__","directory":"sdk/squill/","filename":"__imports__.js","pre":true,"src":"exports.classes = {\n\talpha: '.Alpha',\n\tlabel: '.Label',\n\tlist: '.List',\n\ttext: '.TextInput',\n\ttextarea: '.TextArea',\n\tpassword: '.TextInput',\n\tscroller: '.Scroller',\n\tcanvas: '.Canvas',\n\tslider: '.Slider',\n\tcolor: '.Color',\n\tvcenter: '.VerticalCenter',\n\ttreelist: '.TreeList',\n\tgraph: '.Graph',\n\tselect: '.SelectBox',\n};\n\n\nexports.resolve = function(env, opts) {\n\tvar imports = [];\n\t\n\tif (env == 'browser') {\n\t\tfor (var key in exports.classes) {\n\t\t\timports.push(exports.classes[key]);\n\t\t}\n\t}\n\t\n\treturn imports;\n}\n"},"sdk/squill/CheckBox.js":{"path":"sdk/squill/CheckBox.js","friendlyPath":".CheckBox","directory":"sdk/squill/","filename":"CheckBox.js","src":"\"use import\";\n\njsio(\"import .Widget\");\njsio(\"from util.browser import $\");\n\nvar sdk_squill_CheckBox=__class__;var CheckBox = exports=sdk_squill_CheckBox(function sdk_squill_CheckBox(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._def = {\n\t\ttag: 'label',\n\t\tchildren: [\n\t\t\t{id: 'checkbox', tag: 'input', attrs: {type: 'checkbox'}},\n\t\t\t{tag: 'span', id: 'label', text: ''}\n\t\t]\n\t};\n\t\n\tthis.buildWidget = function() {\n\t\tthis.setLabel(this._opts.label || '');\n\t\tif (this._opts.name) {\n\t\t\tthis.setName(this._opts.name);\n\t\t}\n\t\t\n\t\tif (this._opts.value) {\n\t\t\tthis.setValue(this._opts.value);\n\t\t}\n\t\t\n\t\tthis.initMouseEvents(this.checkbox);\n\t\t$.onEvent(this.checkbox, 'change', this, '_onCheck');\n\n\t\tif (this._opts.__result) {\n\t\t\tthis._opts.__result.addSubscription(this, 'Select', this._opts.id);\n\t\t}\n\t}\n\t\n\tthis._onCheck = function() {\n\t\tthis.publish('Check', this.isChecked());\n\t\tthis.emit('change', this.isChecked());\n\t}\n\t\n\tthis.setLabel = function (label) { $.setText(this.label, label); }\n\tthis.setName = function (name) { this.checkbox.name = name; }\n\tthis.setValue = function (value) { this.checkbox.checked = !!value; }\n\n\tthis.isChecked = function () { return this.checkbox.checked; }\n\tthis.setChecked = function (isChecked) { this.checkbox.checked = isChecked; }\n\t\n\tthis.getValue = function () { return this.isChecked() ? this.checkbox.value : null; }\n});\n","pre":true},"sdk/squill/TextButton.js":{"path":"sdk/squill/TextButton.js","friendlyPath":".TextButton","directory":"sdk/squill/","filename":"TextButton.js","src":"\"use import\";\n\njsio(\"import .Button, .Widget\");\njsio(\"from util.browser import $\");\n\nvar sdk_squill_TextButton=__class__;var TextButton = exports=sdk_squill_TextButton(function sdk_squill_TextButton(){return this.init&&this.init.apply(this,arguments)},Button, function(supr) {\n\tthis._type = 'text-button';\n\t\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\t\t$.setText(el, this.getI18n('label') || this.getI18n('text'));\n\t\t\n\t\tthis.initMouseEvents(el);\n\t\tthis.initKeyEvents(el);\n\t}\n\t\n\tthis.setLabel = function(label) {\n\t\tthis._opts.label = label;\n\t\tif(this._el) { $.setText(this._el, label); }\n\t}\n});\n\nWidget.register(TextButton, 'TextButton');\n","pre":true},"sdk/squill/Button.js":{"path":"sdk/squill/Button.js","friendlyPath":".Button","directory":"sdk/squill/","filename":"Button.js","src":"\"use import\";\n\njsio(\"from util.browser import $\");\njsio(\"import .Widget\");\n\njsio(\"import .hint as hint\");\n\nvar sdk_squill_Button=__class__;var Button = exports=sdk_squill_Button(function sdk_squill_Button(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'btn';\n\tthis._type = 'button';\n\n\tthis.init = function(params) {\n\t\tparams = merge(params, {tag: 'button', isEnabled: true});\n\t\tthis._isEnabled = params.isEnabled;\n\t\tsupr(this, 'init', [params]);\n\t\tthis._hint = params.hint;\n\t};\n\n\tthis.create = function() {\n\t\tthis._opts.style = JS.merge(this._opts.style, {\n\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\tdisplay: 'block'\n\t\t\t});\n\t\t\n\t\tsupr(this, 'create', arguments);\n\t};\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\t\t\n\t\tthis.initMouseEvents(el);\n\t\tthis.initKeyEvents(el);\n\t\t\n\t\tel.style.userSelect = 'none';\n\t\tel.style.MozUserSelect = 'none'; // Mozilla\n\t\tel.style.KhtmlUserSelect = 'none'; // Safari\n\t\tel.unselectable = 'on'; // IE\n\t};\n\n\tthis._setHintTimeout = function(e) {\n\t\tif (!this._hint) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hintTimeout && clearTimeout(this._hintTimeout);\n\t\tthis._hintTimeout = setTimeout(\n\t\t\tbind(\n\t\t\t\tthis,\n\t\t\t\tfunction() {\n\t\t\t\t\thint.show(e.pageX + 12, e.pageY + 14, this._hint);\n\t\t\t\t}\n\t\t\t),\n\t\t\t300\n\t\t);\n\t};\n\n\tthis.onMouseOver = function(e) {\n\t\tthis._setHintTimeout(e);\n\t};\n\n\tthis.onMouseMove = function(e) {\n\t\tthis._setHintTimeout(e);\n\t};\n\n\tthis.onMouseOut = function(e) {\n\t\thint.hide();\n\t\tthis._hintTimeout && clearTimeout(this._hintTimeout);\n\t};\n\n\tthis.onClick = function(e) {\n\t\t$.stopEvent(e);\n\t\tif (!this._isEnabled) { return; }\n\n\t\tif (this._opts.onClick) {\n\t\t\tthis._opts.onClick(e, this);\n\t\t}\n\t\t\n\t\tsupr(this, 'onClick', arguments);\n\t};\n\n\tthis.captureOnEnter = function(widget) {\n\t\twidget.subscribe('KeyDown', this, 'onKeyDown');\n\t\twidget.subscribe('KeyUp', this, 'onKeyUp');\n\t};\n\n\tthis.onKeyDown = function(e) {\n\t\tif (e.keyCode == 13) { $.stopEvent(e); this.onMouseDown(); }\n\t};\n\n\tthis.onKeyUp = function(e) {\n\t\tif (e.keyCode == 13) { $.stopEvent(e); this.onMouseUp(); this.onClick(e); }\n\t};\n\t\n\tthis.show = function() {\n\t\tthis.onBeforeShow();\n\t\tthis.getElement().style.display = 'inline-block';\n\t\tthis.onShow();\n\t};\n\n\tthis.setEnabled = function(isEnabled) {\n\t\tif (this._isEnabled != isEnabled) {\n\t\t\tthis._isEnabled = isEnabled;\n\t\t\tif (!isEnabled) {\n\t\t\t\t$.addClass(this._el, 'disabled')\n\t\t\t} else {\n\t\t\t\t$.removeClass(this._el, 'disabled')\n\t\t\t}\n\t\t}\n\t};\n});\n\n","pre":true},"sdk/squill/hint.js":{"path":"sdk/squill/hint.js","friendlyPath":".hint","directory":"sdk/squill/","filename":"hint.js","src":"\"use import\";\n\njsio(\"from util.browser import $\");\n\nvar hint = $({parent: document.body, className: 'hint'});\n\nexports.show = function(x, y, text) {\n\thint.innerHTML = text;\n\thint.style.left = x + 'px';\n\thint.style.top = y + 'px';\n\thint.style.display = 'block';\n\n\tconsole.log(text);\n\tif (x + hint.offsetWidth >= document.width) {\n\t\thint.style.left = (x - hint.offsetWidth) + 'px';\n\t}\n};\n\nexports.hide = function() {\n\thint = hint || $({\n\t\tparent: document.body,\n\t\tclassName: 'graphHint'\n\t});\n\n\thint.style.display = 'none';\n};\n\nvar setHintTimeout = function(evt) {\n\tevt.target.hintTimeout && clearTimeout(evt.target.hintTimeout);\n\tevt.target.hintTimeout = setTimeout(\n\t\tbind(\n\t\t\tthis,\n\t\t\tfunction() {\n\t\t\t\texports.show(evt.pageX + 12, evt.pageY + 14, evt.target.hintText);\n\t\t\t}\n\t\t),\n\t\t300\n\t);\n};\n\nexports.add = function(el, text) {\n\tel.hintText = text;\n\n\t$.onEvent(el, 'mouseover', setHintTimeout);\n\t$.onEvent(el, 'mousemove', setHintTimeout);\n\t$.onEvent(\n\t\tel,\n\t\t'mouseout',\n\t\tfunction(evt) {\n\t\t\texports.hide();\n\t\t\tevt.target.hintTimeout && clearTimeout(evt.target.hintTimeout);\n\t\t}\n\t);\n}","pre":true},"sdk/squill/SelectBox.js":{"path":"sdk/squill/SelectBox.js","friendlyPath":".SelectBox","directory":"sdk/squill/","filename":"SelectBox.js","src":"jsio(\"import .Widget\");\njsio(\"import squill.models.DataSource as DataSource\");\n\njsio(\"from util.browser import $\");\n\nvar sdk_squill_SelectBox=__class__;var SelectBox = exports=sdk_squill_SelectBox(function sdk_squill_SelectBox(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._def = {\n\t\ttag: 'select'\n\t};\n\n\tthis.init = function(opts) {\n\t\topts = merge(opts, {\n\t\t\trenderer: bind(this, 'defaultRenderer')\n\t\t});\n\n\t\tthis._items = {};\n\t\tif (opts.dataSource) { this.setDataSource(opts.dataSource); }\n\t\tsupr(this, 'init', arguments);\n\t}\n\t\n\tthis.buildWidget = function() {\n\t\tif (this._opts.name) {\n\t\t\tthis.setName(this._opts.name);\n\t\t}\n\n\t\tif (!this._dataSource) {\n\t\t\tthis.setDataSource(new DataSource());\n\t\t}\n\t\t\n\t\tif (this._opts.items) {\n\t\t\tvar uid = 1;\n\t\t\tvar items = this._opts.items.map(function (item) {\n\t\t\t\tif (typeof item != 'object') {\n\t\t\t\t\treturn {id: typeof item == 'string' ? item : uid++, value: item};\n\t\t\t\t} else {\n\t\t\t\t\tif (!item.id) {\n\t\t\t\t\t\titem.id =   'value' in item ? item.value :\n\t\t\t\t\t\t\t\t\t'title' in item ? item.title :\n\t\t\t\t\t\t\t\t\t(uid++);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._dataSource.add(items);\n\t\t}\n\n\t\tif ('value' in this._opts) {\n\t\t\tthis.setValue(this._opts.value);\n\t\t}\n\n\t\tthis.initMouseEvents(this._el);\n\t\t$.onEvent(this._el, 'change', this, '_onSelect');\n\t}\n\t\n\tthis._onSelect = function() {\n\t\tvar item = this._dataSource.get(this.getValue());\n\t\tif (item) {\n\t\t\tthis.publish('change', item);\n\t\t}\n\t}\n\n\tthis.setDataSource = function(dataSource) {\n\t\tif (this._dataSource) {\n\t\t\tthis._dataSource.unsubscribe('Update', this);\n\t\t\tthis._dataSource.unsubscribe('Remove', this);\n\t\t}\n\t\tthis._dataSource = dataSource;\n\t\tthis._dataSource.subscribe('Update', this, 'onUpdateItem');\n\t\tthis._dataSource.subscribe('Remove', this, 'onRemoveItem');\n\t\tthis._dataSource.forEach(function(item, key) {\n\t\t\tthis.onUpdateItem(key, item);\n\t\t}, this);\n\t}\n\t\n\tthis.defaultRenderer = function(item) {\n\t\tvar key = this._dataSource.getKey();\n\t\treturn item.displayName || item.label || item.title || item.text || item[key];\n\t}\n\t\n\tthis.onUpdateItem = function(id, item) {\n\t\tvar el = this._items[id];\n\t\tvar keyField = this._dataSource.getKey();\n\n\t\tif (typeof(item) === 'string') {\n\t\t\tvar o = {};\n\t\t\to[keyField] = item;\n\t\t\titem = o;\n\t\t}\n\n\t\tif (!el) {\n\t\t\tvar el = this._items[id] = $.create({tag: 'option'});\n\t\t\t$.insertBefore(this._el, el);\n\t\t}\n\n\t\tel.setAttribute('value', item[keyField]);\n\t\tvar renderer = this._opts.renderer;\n\t\tel.innerText = (typeof renderer === 'string' ? item[renderer] : renderer(item))\n\t\tel.value = item[keyField];\n\t}\n\t\n\tthis.onRemoveItem = function(id) {\n\t\tvar el = this._items[id];\n\t\tvar prevValue = this.getValue();\n\t\tif (el) {\n\t\t\t$.remove(el);\n\t\t\tdelete this._items[id];\n\t\t}\n\t\tvar newValue = this.getValue();\n\t\tif (newValue != prevValue) {\n\t\t\tthis._onSelect(); // the old value was removed, so select a new one\n\t\t}\n\t}\n\n\n\tthis.setName = function(name) { this._el.name = name; }\n\tthis.setValue = function(value) { this._el.value = value; }\n\n\tthis.getValue = function() { return this._el.value; }\n});\n","pre":true},"sdk/squill/models/DataSource.js":{"path":"sdk/squill/models/DataSource.js","friendlyPath":"squill.models.DataSource","directory":"sdk/squill/models/","filename":"DataSource.js","src":"\"use import\";\n\njsio(\"import lib.Callback\");\njsio(\"import .BasicDataSource as BasicDataSource\");\n\nvar sdk_squill_models_DataSource=__class__;var DataSource = exports=sdk_squill_models_DataSource(function sdk_squill_models_DataSource(){return this.init&&this.init.apply(this,arguments)},BasicDataSource, function(supr) {\n\n\tvar defaults = {\n\t\tkey: 'id'\n\t};\n\n\tthis.init = function(opts) {\n\t\tthis._opts = opts = merge(opts, defaults);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._byIndex = [];\n\t\tthis._byID = {};\n\t\tthis._ctor = opts.ctor;\n\t\tthis._reverse = opts.reverse;\n\n\t\tthis.length = 0;\n\n\t\tthis.onLoad = new lib.Callback();\n\n\t\tthis.setSorter(opts.sorter);\n\t\tthis.setPersistence(opts.persistence);\n\n\t\tthis._changeDataSave = false;\n\t\tthis._changeData = {\n\t\t\tupdated: [], \n\t\t\tupdatedHash: {},\n\t\t\tremoved: [],\n\t\t\tremovedHash: {}\n\t\t};\n\t};\n\n\tthis.setPersistence = function(persistence) {\n\t\tthis._persistence = persistence;\n\t\tif (persistence) {\n\t\t\tthis.onLoad.clear();\n\t\t\tpersistence.load(this, this.onLoad.chain());\n\t\t}\n\t}\n\n\tthis._saveChanges = function(type, key) {\n\t\tif (this._changeDataSave && !this._changeData[type + 'Hash'][key]) {\n\t\t\tthis._changeData[type + 'Hash'][key] = true;\n\t\t\tthis._changeData[type].push(key);\n\t\t}\n\t};\n\t\n\tthis.getFilteredDataSource = function(filterFn) {\n\t\tvar ds = new DataSource(this._opts);\n\t\tthis.forEach(function (item) {\n\t\t\tif (filterFn(item)) {\n\t\t\t\tds.add(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.subscribe('Update', function (id, item) {\n\t\t\tif (filterFn(item)) {\n\t\t\t\tds.add(item);\n\t\t\t} else {\n\t\t\t\tds.remove(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.subscribe('Remove', function (id, item) { ds.remove(item); });\n\t\treturn ds;\n\t};\n\n\tthis.signalUpdate = function(type, item, id) {\n\t\tif (item[this.key] === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tswitch (type) {\n\t\t\tcase 'UPDATE':\n\t\t\t\tthis._saveChanges('updated', item[this.key]);\n\t\t\t\tthis.publish('Update', item[this.key], item);\n\t\t\t\tbreak;\n\n\t\t\tcase 'REMOVE':\n\t\t\t\tthis._saveChanges('removed', item[this.key]);\n\t\t\t\tthis.publish('Remove', id, item);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tvar toStringSort = function() {\n\t\treturn this._sortKey;\n\t};\n\t// NEVER CHANGE THE ID OF AN ITEM WITHOUT REMOVING IT FROM THE DATASOURCE FIRST.\n\t// Love, Jeff Hubbard and Marcus Cavanaugh\n\n\tthis.updated = \n\tthis.add = function(item) {\n\t\tif (isArray(item)) {\n\t\t\tfor (var i = 0, len = item.length; i < len; ++i) {\n\t\t\t\titem[i] && this.add(item[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tvar id = item[this.key];\n\n\t\t\t// note: not the same as `if (!id) { ... }`\n\t\t\tif (id == null) { return; }\n\n\t\t\tvar index = null;\n\t\t\tif (this._byID[id]) {\n\t\t\t\tfor (var i = 0, _item; _item = this._byIndex[i]; ++i) {\n\t\t\t\t\tif (_item[this.key] == id) {\n\t\t\t\t\t\tif (typeof _item.update == 'function') {\n\t\t\t\t\t\t\t_item.update(item);\n\t\t\t\t\t\t\titem = _item;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tindex = this.length++;\n\t\t\t}\n\n\t\t\t// if we're adding it to the array:\n\t\t\tif (index !== null) {\n\n\t\t\t\t// make sure it's an instance of the specified class\n\t\t\t\tif (this._ctor && !(item instanceof this._ctor)) {\n\t\t\t\t\titem = new this._ctor(item);\n\t\t\t\t}\n\n\t\t\t\tthis._byIndex[index] = item;\n\t\t\t}\n\n\t\t\tthis._byID[id] = item;\n\n\t\t\tthis.signalUpdate('UPDATE', item);\n\n\t\t\tif (this._sorter) {\n\t\t\t\titem._sortKey = this._sorter(item);\n\t\t\t\titem.toString = toStringSort;\n\t\t\t}\n\t\t}\n\n\t\treturn item;\n\t};\n\t\n\tthis.remove = function(id) {\n\t\tif (typeof id == 'object') { id = id[this.key]; }\n\t\tif (id == null) { return; }\n\n\t\tif (this._byID[id]) {\n\t\t\tthis.signalUpdate('REMOVE', this._byID[id], id);\n\t\t\tdelete this._byID[id];\n\t\t\tfor (var i = 0, item; item = this._byIndex[i]; ++i) {\n\t\t\t\tif (item[this.key] == id) {\n\t\t\t\t\t--this.length;\n\t\t\t\t\treturn this._byIndex.splice(i, 1)[0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.keepOnly = function(list) {\n\t\tthis.compare(list, function(dataSource, local, remote) {\n\t\t\tif (!remote) {\n\t\t\t\tdataSource.remove(local);\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.clear = function() {\n\t\tvar index = this._byIndex;\n\n\t\tthis._byIndex = [];\n\t\tthis._byID = {};\n\t\tthis.length = 0;\n\n\t\tfor (var i = 0, item; item = index[i]; ++i) {\n\t\t\tthis.signalUpdate('REMOVE', item, item[this.key]);\n\t\t}\n\t};\n\n\tthis.getCount = function() {\n\t\treturn this.length;\n\t};\n\n\tthis.setSorter = function(sorter) {\n\t\tthis._sorter = sorter;\n\t\tif (sorter) {\n\t\t\tfor (var i = 0, item; item = this._byIndex[i]; ++i) {\n\t\t\t\titem._sortKey = sorter(item);\n\t\t\t\titem.toString = toStringSort;\n\t\t\t}\n\t\t}\n\t\tthis.sort();\n\t\treturn this;\n\t};\n\n\tthis.contains = function(id) {\n\t\treturn !!this._byID[id];\n\t};\n\n\tthis.getKey = function() {\n\t\treturn this.key;\n\t}\n\n\tthis.get = this.getItemForID = function(id) {\n\t\treturn this._byID[id] || null;\n\t};\n\n\tthis.getItemForIndex = function(index) {\n\t\treturn this._byIndex[index];\n\t};\n\n\tthis.sort = function() {\n\t\tthis._byIndex.sort();\n\t\tthis._reverse && this._byIndex.reverse();\n\t};\n\n\tthis.forEach = this.each = function(cb, context) {\n\t\tfor (var i = 0; i < this.length; ++i) {\n\t\t\tif (cb.call(context, this._byIndex[i], i)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.toJSON = function() {\n\t\treturn {\n\t\t\tkey: this.key,\n\t\t\titems: this._byIndex\n\t\t};\n\t};\n\n\tthis.fromJSON = function(data) {\n\t\tthis.clear();\n\t\tvar key = this.key = data.key;\n\t\tthis.add(data.items);\n\t};\n\n\tthis.toArray = function() { return this._byIndex.slice(0); }\n\n\tthis.beginChanges = function() {\n\t\tthis._changeDataSave = true;\n\t\tthis._changeData = {\n\t\t\tupdated: [], \n\t\t\tupdatedHash: {},\n\t\t\tremoved: [],\n\t\t\tremovedHash: {}\n\t\t};\n\t};\n\n\tthis.saveChanges = function() {\n\t\tthis._changeDataSave = false;\n\t\tif (this._persistence) {\n\t\t\tvar changeData = this._changeData,\n\t\t\t\ti, j;\n\n\t\t\tthis._persistence.remove(changeData.removed);\n\n\t\t\tif (changeData.updated.length) {\n\t\t\t\tvar updateList = [];\n\t\t\t\tfor (i = 0, j = changeData.updated.length; i < j; i++) {\n\t\t\t\t\tupdateList.push(this._byID[changeData.updated[i]]);\n\t\t\t\t}\n\t\t\t\tthis._persistence.update(updateList);\n\t\t\t}\n\n\t\t\tthis._persistence.commit();\n\t\t}\n\t};\n\n\tthis.load = function(cb) {\n\t\tif (this._persistence) {\n\t\t\tthis._persistence.load(this, function(err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.log('error loading', JSON.stringify(err));\n\t\t\t\t}\n\t\t\t\tcb && cb(err);\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.save = function() {\n\t\tif (this._persistence) {\n\t\t\tthis._persistence.save(this);\n\t\t}\n\t}\n\n\tthis.compare = function(dict, cb) {\n\t\tvar key = this.key;\n\n\t\t// create a key-indexed copy of dict to run the comparison against\n\t\tvar compareTo = {};\n\t\tif (isArray(dict)) {\n\t\t\tfor (var i = 0, n = dict.length; i < n; ++i) {\n\t\t\t\tcompareTo[dict[i][key]] = dict[i];\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var k in dict) {\n\t\t\t\tcompareTo[k] = dict[k];\n\t\t\t}\n\t\t}\n\n\t\t// first, compare all items in the index to the dict items\n\t\tvar items = this._byIndex.slice(0);\n\t\tfor (var i = 0, item; item = items[i]; ++i) {\n\t\t\tvar k = item[key];\n\t\t\tcb.call(this, this, item, compareTo[k]);\n\t\t\tdelete compareTo[k];\n\t\t}\n\n\t\t// then, for any remaining dict items, they don't exist in the local version\n\t\tfor (var k in compareTo) {\n\t\t\tcb.call(this, this, null, compareTo[k]);\n\t\t}\n\t}\n\n\tthis.filter = function(filter) {\n\t\tvar result = new DataSource({key: this.key});\n\t\tvar key;\n\t\tvar item;\n\t\tvar match;\n\t\tvar i;\n\t\tvar j = this.length;\n\n\t\tresult.key = this.key;\n\t\tfor (i = 0; i < j; ++i) {\n\t\t\titem = this._byIndex[i];\n\t\t\tmatch = true;\n\t\t\tfor (key in filter) {\n\t\t\t\tif ((typeof item[key] == 'string') && (item[key].toLowerCase().indexOf(filter[key]) == -1)) {\n\t\t\t\t\tmatch = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (match) {\n\t\t\t\tresult.add(item);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n});\n","pre":true},"sdk/squill/models/BasicDataSource.js":{"path":"sdk/squill/models/BasicDataSource.js","friendlyPath":".BasicDataSource","directory":"sdk/squill/models/","filename":"BasicDataSource.js","src":"\"use import\";\n\njsio(\"import lib.PubSub as PubSub\");\n\nvar sdk_squill_models_BasicDataSource=__class__;var BasicDataSource = exports=sdk_squill_models_BasicDataSource(function sdk_squill_models_BasicDataSource(){return this.init&&this.init.apply(this,arguments)},PubSub, function(supr) {\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis.key = this._key = opts.key;\n\t\tthis._channel = opts.channel;\n\t\tthis._hasRemote = opts.hasRemote;\n\t};\n\n\tthis.getKey = function() {\n\t\treturn this._key;\n\t};\n});","pre":true},"sdk/timestep/ui/backend/sound/HTML5API.js":{"path":"sdk/timestep/ui/backend/sound/HTML5API.js","friendlyPath":"ui.backend.sound.HTML5API","directory":"sdk/timestep/ui/backend/sound/","filename":"HTML5API.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// An API for playing named sounds. Sounds can be given a single file source\n// or multiple sources which will be chosen at random at play time. Sounds may\n// also be given a default volume and loop boolean.\n//\n// Only one background sound can be played at a time. They are streamed, not\n// preloaded, on native.\n\njsio(\"import event.Emitter as Emitter\");\njsio(\"import util.path\");\njsio(\"import device\");\n\n// \"Extend\" the local instance of Audio objects.\nRawAudio=__class__;var RawAudio=RawAudio(function RawAudio(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tvar audio = new Audio();\n\n\t\t// we can't really extend an HTML5 audio object in a browser, so\n\t\t// do our best...\n\t\tvar proto = RawAudio.prototype;\n\t\tfor (var i in proto) {\n\t\t\tif (!audio[i] && proto.hasOwnProperty(i)) {\n\t\t\t\taudio[i] = RawAudio.prototype[i];\n\t\t\t}\n\t\t}\n\n\t\taudio.oldPlay = audio.play;\n\t\taudio.play = function() {\n\t\t\tif (audio.readyState == 4) {\n\t\t\t\taudio.oldPlay();\n\t\t\t} else {\n\t\t\t\tsetTimeout(audio.play, 32);\n\t\t\t}\n\t\t};\n\n\t\t// Hook into accessibility features.\n\t\tGLOBAL.ACCESSIBILITY.subscribe('MuteChange', this, function () {\n\t\t\taudio.muted = GLOBAL.ACCESSIBILITY.muted;\n\t\t});\n\n\t\taudio.muted = GLOBAL.ACCESSIBILITY.muted;\n\n\t\treturn audio;\n\t};\n\n\t// add a stop method that resets the current time\n\tthis.stop = function () {\n\t\ttry {\n\t\t\t// html5 Audio object\n\t\t\tif (!this.paused) { this.pause(); }\n\n\t\t\t// if we have the NETWORK_LOADING flag, only restart currentTime if the sound has loaded.\n\t\t\t// http://scottdowne.wordpress.com/2010/08/17/no-more-exceptions/\n\t\t\tif ((!('NETWORK_LOADING' in this)\n\t\t\t\t\t|| this.networkState != this.NETWORK_LOADING\n\t\t\t\t\t|| this.networkState != this.NETWORK_NO_SOURCE)\n\t\t\t\t\t&& !isNaN(this.duration)) {\n\t\t\t\tthis.currentTime = 0;\n\t\t\t}\n\t\t} catch (e) {}\n\t};\n});\n\n/**\n * A sound object that can play one of a collection of audio sources.\n */\nMultiSound=__class__;var MultiSound=MultiSound(function MultiSound(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (soundManager, name, opts) {\n\t\tthis._soundManager = soundManager;\n\t\tthis._name = name;\n\n\t\t// if a list of file names is given in sources, load them as alternative\n\t\t// clips for this sound. Else, assume the only clip for this sound\n\t\t// is the file with its same name\n\t\topts = typeof opts == 'string' ? {sources: [opts]} : (opts || {});\n\t\tvar srcList = opts.sources || [name];\n\t\tvar sources = this._sources = [];\n\n\t\tvar basePath = soundManager.getPath();\n\t\tvar ext = soundManager.getExt();\n\t\tvar extTestExp = new RegExp(ext + '$', 'i');\n\n\t\tvar loop = opts.loop !== undefined ? opts.loop : opts.background;\n\t\tvar volume = opts.volume !== undefined ? opts.volume : 1.0;\n\n\t\tvar isPaused = bind(this, 'isPaused');\n\n\t\t// html5 hack for web browsers\n\t\tvar _checkPauseOnPlay = function (src) {\n\t\t\t\tthis.removeEventListener(arguments.callee);\n\t\t\t\tif (isPaused()) {\n\t\t\t\t\tthis.pause();\n\t\t\t\t}\n\t\t\t};\n\n\t\tfor (var i = 0, src; src = srcList[i]; ++i) {\n\n\t\t\t// file paths are relative to the base path\n\t\t\tvar fullPath = util.path.join(basePath, opts.path, src);\n\n\t\t\t// append the extension if not already provided\n\t\t\tif (!extTestExp.test(fullPath)) {\n\t\t\t\tfullPath += ext;\n\t\t\t}\n\n\t\t\tvar audio = new RawAudio();\n\t\t\taudio.loop = loop;\n\t\t\taudio.volume = volume;\n\t\t\taudio.isBackgroundMusic = opts.background;\n\t\t\taudio.src = fullPath;\n\t\t\taudio.preload = ((audio.readyState != 4) || (soundManager._preload && !opts.background)) ? \"auto\" : \"none\";\n\n\t\t\t// If you pause or mute an html5 audio object in the browser\n\t\t\t// before the sound is ready, it will play anyway.  Here, we\n\t\t\t// check the pause status when the audio starts playing.\n\t\t\tif (audio.addEventListener) {\n\t\t\t\taudio.addEventListener('playing', _checkPauseOnPlay);\n\t\t\t}\n\n\t\t\tsources.push(audio);\n\t\t\tif (audio.isBackgroundMusic && window.NATIVE) {\n\t\t\t\tNATIVE.sound.registerMusic(fullPath, audio);\n\t\t\t}\n\t\t}\n\n\t\tthis.loop = loop;\n\t\tthis.isBackgroundMusic = opts.background;\n\t};\n\n\tthis.setVolume = function (volume) {\n\t\tfor (var i = 0, src; src = this._sources[i]; ++i) {\n\t\t\tsrc.volume = volume;\n\t\t}\n\t};\n\n\tthis.stop = function () {\n\t\tfor (var i = 0, src; src = this._sources[i]; ++i) {\n\t\t\tsrc.stop();\n\t\t}\n\t};\n\n\tthis.pause = function () {\n\t\tthis._isPaused = true;\n\n\t\tfor (var i = 0, src; src = this._sources[i]; ++i) {\n\t\t\tsrc.pause();\n\t\t}\n\t};\n\n\tthis.isPaused = function () {\n\t\treturn this._isPaused;\n\t};\n\n\tthis.isPlaying = function () {\n\t\tvar isPlaying = false;\n\t\tif (this._lastSrc) {\n\t\t\tvar cur = this._lastSrc.currentTime;\n\t\t\tvar dur = this._lastSrc.duration;\n\t\t\t// NaN duration means the duration isn't loaded yet,\n\t\t\t// meaning the sound was started very recently. Since\n\t\t\t// this._lastSrc is defined, we know that the sound has\n\t\t\t// been played, so it's playing unless it's paused :)\n\t\t\tif (isNaN(dur) || cur < dur) {\n\t\t\t\tisPlaying = !this.isPaused();\n\t\t\t}\n\t\t}\n\t\treturn isPlaying;\n\t};\n\n\tthis.getDuration = function () {\n\t\treturn this._lastSrc && this._lastSrc.duration || 0;\n\t};\n\n\tthis.getTime = function () {\n\t\treturn this._lastSrc ? this._lastSrc.currentTime : 0;\n\t};\n\n\tthis.setTime = function (t) {\n\t\tif (this._lastSrc && this.isBackgroundMusic && t != undefined) {\n\t\t\tif (this._lastSrc.duration) {\n\t\t\t\tthis._lastSrc.currentTime = t;\n\t\t\t} else {\n\t\t\t\tsetTimeout(bind(this, 'setTime', t + 0.01), 10);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.play = function (opts) {\n\t\topts = opts || {};\n\t\tif (!this._isPaused) {\n\t\t\tthis.stop();\n\t\t} else {\n\t\t\tthis._isPaused = false;\n\t\t}\n\n\t\tvar src = this._getRandom();\n\t\tsrc.loop = opts.loop || this.loop;\n\t\tsrc.play();\n\t\t\n\t\tif (src.muted) {\n\t\t\t// Chrome bug? Audio objects with muted set before they\n\t\t\t// are played won't be muted, so toggle the mute state\n\t\t\t// twice after calling play.\n\t\t\tsrc.muted = false;\n\t\t\tsrc.muted = true;\n\t\t}\n\t\tthis._lastSrc = src;\n\t\tthis.setTime(opts.time);\n\t\tif (opts.duration) {\n\t\t\tsetTimeout(bind(this, function () {\n\t\t\t\tthis.pause();\n\t\t\t}), opts.duration * 1000);\n\t\t}\n\t};\n\n\tthis._getRandom = function () {\n\t\tvar index = Math.random() * this._sources.length | 0;\n\t\treturn this._sources[index];\n\t};\n});\n\n/**\n * @extends event.Emitter\n */\nvar sdk_timestep_ui_backend_sound_HTML5API=__class__;exports=sdk_timestep_ui_backend_sound_HTML5API(function sdk_timestep_ui_backend_sound_HTML5API(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = opts || {};\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis.setPath(opts.path);\n\n\t\t//opts.map is deprecated in favor of opts.files\n\t\tthis._map = opts.files || opts.map;\n\t\tthis._preload = opts.preload;\n\t\tthis._sounds = {};\n\t\tthis._isMusicMuted = false;\n\t\tthis._areEffectsMuted = false;\n\t\tthis._currentMusic = null;\n\n\t\tif (opts.persist) {\n\t\t\tthis.persistState(opts.persist);\n\t\t}\n\n\t\t// determine whether browser supports mp3 or ogg. Default to mp3 if\n\t\t// both are supported. Native will return true for everything, but\n\t\t// on native, we store ogg files as .mp3 files, so return .mp3...\n\t\tvar sound = new Audio();\n\t\tthis._ext = sound.canPlayType(\"audio/mpeg\") ? '.mp3'\n\t\t\t: sound.canPlayType(\"audio/ogg\") ? '.ogg' : '';\n\n\t\tif (!this._ext) {\n\t\t\tthis._ext = '.mp3';\n\t\t\tlogger.log('warning: could not determine sound support type');\n\t\t}\n\n\t\t// add sounds to the audio API's list of sounds and\n\t\t// preload them if appropriate\n\t\tfor (var key in this._map) {\n\t\t\tvar item = this._map[key];\n\t\t\tthis.addSound(key, item);\n\t\t}\n\t};\n\n\tthis.getExt = function () { return this._ext; };\n\n\tthis.getPath = function (name) {\n\t\treturn (name) ? this._sounds[name].path : this._path;\n\t};\n\n\tthis.setPath = function (path) {\n\t\tif (path) {\n\t\t\tpath = path.replace(/\\/$/, '');\n\t\t}\n\n\t\tthis._path = path || '';\n\t};\n\n\tthis.addSound = function (name, opts) {\n\t\tthis._sounds[name] = new MultiSound(this, name, opts);\n\t};\n\n\t/* @internal for now\n\t */\n\tthis.persistState = function (key) {\n\t\tthis._key = key;\n\n\t\tvar value = localStorage.getItem(this._key);\n\t\tif (value) { try { value = JSON.parse(value); } catch (e) {} }\n\t\tif (value) {\n\t\t\tlogger.log('restoring audio api state');\n\t\t\tthis.setMusicMuted(value.isMusicMuted);\n\t\t\tthis.setEffectsMuted(value.areEffectsMuted);\n\t\t}\n\t};\n\n\t/* @internal for now\n\t */\n\tthis._persist = function () {\n\t\tif (this._key) {\n\t\t\tlocalStorage.setItem(this._key, JSON.stringify({\n\t\t\t\t\tisMusicMuted: this._isMusicMuted,\n\t\t\t\t\tareEffectsMuted: this._areEffectsMuted\n\t\t\t\t}));\n\t\t}\n\t};\n\n\tthis.getMuted = function () { return this._isMusicMuted && this._areEffectsMuted; };\n\tthis.getMusicMuted = function () { return this._isMusicMuted; };\n\tthis.getEffectsMuted = function () { return this._areEffectsMuted; };\n\n\t// global mute\n\tthis.setMuted = function (isMuted) {\n\t\tthis.setMusicMuted(isMuted);\n\t\tthis.setEffectsMuted(isMuted);\n\t};\n\n\tthis.setMusicMuted = function (isMusicMuted) {\n\t\t// if (isMusicMuted == this._isMusicMuted) { return; }\n\t\tthis._isMusicMuted = isMusicMuted;\n\t\tthis._persist();\n\n\t\t// resume music on unmute\n\t\tif (this._currentMusic) {\n\t\t\tif (isMusicMuted) {\n\t\t\t\tthis._currentMusic.pause();\n\t\t\t} else {\n\t\t\t\tthis._currentMusic.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.setEffectsMuted = function (areEffectsMuted) {\n\t\tif (areEffectsMuted == this._areEffectsMuted) { return; }\n\t\tthis._areEffectsMuted = areEffectsMuted;\n\t\tthis._persist();\n\n\t\tif (areEffectsMuted) {\n\t\t\tfor (var key in this._sounds) {\n\t\t\t\tvar sound = this._sounds[key];\n\t\t\t\tif (!sound.isBackgroundMusic) {\n\t\t\t\t\tsound.stop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.setVolume = function (name, volume) {\n\t\tvar sound = this._sounds[name];\n\t\tif (sound) {\n\t\t\tsound.setVolume(volume);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tthis.getVolume = function (name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (sound) {\n\t\t\tvar elem = sound._sources[0]; //first audio element\n\t\t\treturn Math.round(10 * elem.volume) / 10; //round to nearest tenth\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tthis.setTime = function (name, t) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) {\n\t\t\tlogger.log(\"warning: no sound of that name\");\n\t\t\treturn false;\n\t\t}\n\n\t\tsound.setTime(t);\n\t};\n\n\tthis.getTime = function (name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) {\n\t\t\tlogger.log(\"warning: no sound of that name\");\n\t\t\treturn false;\n\t\t}\n\n\t\treturn sound.getTime();\n\t};\n\n\tthis.getDuration = function (name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) {\n\t\t\tlogger.log(\"warning: no sound of that name\");\n\t\t\treturn false;\n\t\t}\n\n\t\treturn sound.getDuration();\n\t};\n\n\tthis.play = function (name, opts) {\n\t\tvar sound = this._sounds[name];\n\t\topts = opts || {};\n\t\tif (!sound) {\n\t\t\tlogger.log(\"warning: no sound of that name\");\n\t\t\treturn false;\n\t\t}\n\n\t\tvar isBackgroundMusic = sound.isBackgroundMusic;\n\t\tif (isBackgroundMusic) {\n\t\t\t// some platforms enforce only one simultaneous background music\n\t\t\t// (native) while others do not.  Enforce it always.\n\t\t\tif (this._currentMusic) {\n\t\t\t\tthis._currentMusic.stop();\n\t\t\t}\n\n\t\t\tthis._currentMusic = sound;\n\n\t\t\t// if we're muted, make sure to resume the music if we unmute\n\t\t\tif (!this._isMusicMuted) {\n\t\t\t\tsound.play(opts);\n\t\t\t}\n\t\t} else if (!this._areEffectsMuted) {\n\t\t\tsound.play(opts);\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tthis.pause = function (name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) { return false; }\n\n\t\t// if we're muted and we pause the current music,\n\t\t// don't resume the music on unmute.\n\t\tif (this._currentMusic == sound) {\n\t\t\tthis._currentMusic = null;\n\t\t}\n\n\t\tsound.pause();\n\n\t\treturn true;\n\t};\n\n\tthis.stop = function (name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) { return false; }\n\n\t\t// if we're muted and we pause the current music,\n\t\t// don't resume the music on unmute.\n\t\tif (this._currentMusic == sound) {\n\t\t\tthis._currentMusic = null;\n\t\t}\n\n\t\tsound.stop();\n\n\t\treturn true;\n\t};\n\n\tthis.isPaused = function (name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) {\n\t\t\tlogger.log(\"warning: no sound of that name\");\n\t\t\treturn false;\n\t\t}\n\n\t\treturn sound.isPaused();\n\t};\n\n\tthis.isPlaying = function (name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) {\n\t\t\tlogger.log(\"warning: no sound of that name\");\n\t\t\treturn false;\n\t\t}\n\n\t\treturn sound.isPlaying();\n\t};\n\n\t// @deprecated\n\tthis.playBackgroundMusic = this.play;\n\n\t// @deprecated\n\tthis.pauseBackgroundMusic = function () {\n\t\tthis._currentMusic && this._currentMusic.pause();\n\t};\n});\n","pre":true},"sdk/jsio/util/path.js":{"path":"sdk/jsio/util/path.js","friendlyPath":"util.path","directory":"sdk/jsio/util/","filename":"path.js","baseMod":"util","basePath":"sdk/jsio","pre":true,"src":"var util = jsio.__jsio.__util;\n\nexports.join = util.buildPath;\nexports.resolveRelativePath = util.resolveRelativePath;\nexports.splitPath = util.splitPath;\nexports.makeRelativePath = util.makeRelativePath;\nexports.splitExt = function(path) {\n\tvar res = exports.splitPath(path);\n\tvar i = res.filename.lastIndexOf('.');\n\tif (i == -1) {\n\t\tres.basename = res.filename;\n\t\tres.ext = '';\n\t} else {\n\t\tres.basename = res.filename.substring(0, i);\n\t\tres.ext = res.filename.substring(i);\n\t}\n\treturn res;\n}"},"sdk/timestep/platforms/native/initialize.js":{"path":"sdk/timestep/platforms/native/initialize.js","friendlyPath":"platforms.native.initialize","directory":"sdk/timestep/platforms/native/","filename":"initialize.js","baseMod":"platforms","basePath":"sdk/timestep/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import device\");\n\ndevice.registerDevice('tealeaf', 'platforms.native');\nexports.init = function () {\n\t// TODO: any init?\n}\n\n//TODO do fonts in a better way and then remove this entirely\nif (!NATIVE.gl.initialized) {\n\tNATIVE.gl.initialized = true;\n\t\n\tif (NATIVE.gl.fonts) {\n\t\tvar data = NATIVE.gl.fonts;\n\t\tvar boldRe = /(bold|W6|wide)/i;\n\t\tvar italicRe = /(italic|oblique)/i;\n\t\tvar mediumRe = /(medium)/i;\n\t\tvar lightRe = /(light)/i;\n\n\t\tvar fontMap = {};\n\t\tfor (var family in data) {\n\t\t\tvar fonts = data[family];\n\t\t\tvar familyMap = {};\n\t\t\n\t\t\tvar keys = fonts.map(function (font) {\n\t\t\t\tvar captures = /[\\-]{1,1}(\\w+)/.exec(font);\n\t\t\t\tvar style = captures ? captures[1] : null;\n\t\t\t\tif (!style) {\n\t\t\t\t\treturn 'normal';\n\t\t\t\t}\n\t\t\t\tif (boldRe.test(style)) {\n\t\t\t\t\tif (italicRe.test(style)) {\n\t\t\t\t\t\treturn 'bolditalic';\n\t\t\t\t\t}else{\n\t\t\t\t\t\treturn 'bold'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(italicRe.test(style)) {\n\t\t\t\t\treturn 'italic';\n\t\t\t\t}\n\t\t\t\tif(mediumRe.test(style) && data[family].some(function (item) {\n\t\t\t\t\treturn lightRe.test(item);\n\t\t\t\t})) {\n\t\t\t\t\treturn 'bold';\n\t\t\t\t}\n\t\t\t\treturn 'normal';\n\t\t\t});\n\n\t\t\tfor (var i = 0, style; style = keys[i]; ++i) {\n\t\t\t\tfamilyMap[style] = fonts[i];\n\t\t\t}\n\t\t\tfontMap[family] = familyMap;\n\t \t}\n\t\tNATIVE.gl.fonts = fontMap;\n\t}\n}\n","pre":true},"sdk/timestep/platforms/native/Input.js":{"path":"sdk/timestep/platforms/native/Input.js","friendlyPath":".Input","directory":"sdk/timestep/platforms/native/","filename":"Input.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import event.input.InputEvent as InputEvent\");\n\nvar sdk_timestep_platforms_native_Input=__class__;exports=sdk_timestep_platforms_native_Input(function sdk_timestep_platforms_native_Input(){return this.init&&this.init.apply(this,arguments)},function () {\n\tif (NATIVE.timestep && NATIVE.timestep.getEvents) {\n\t\tif (!NATIVE.timestep.InputEvent) {\n\t\t\tNATIVE.timestep.InputEvent = InputEvent;\n\t\t}\n\n\t\tthis.getEvents = function () {\n\t\t\treturn NATIVE.timestep.getEvents();\n\t\t}\n\t} else {\n\t\tthis.getEvents = function () {\n\t\t\tvar raw = NATIVE.input.getTouchEvents(),\n\t\t\t\tevts = [];\n\t\t\t\n\t\t\tvar j = 0;\n\t\t\tfor(var i = 0, e; e = raw[i]; ++i) {\n\t\t\t\tevts[j++] = new InputEvent(e.id, e.type, e.pt);\n\t\t\t\tif (e.type == 'input:select') {\n\t\t\t\t\tevts[j++] = new InputEvent(e.id, 'input:clear', e.pt.x, e.pt.y);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn evts;\n\t\t}\n\t}\n});\n","pre":true},"sdk/timestep/platforms/native/InputPrompt.js":{"path":"sdk/timestep/platforms/native/InputPrompt.js","friendlyPath":".InputPrompt","directory":"sdk/timestep/platforms/native/","filename":"InputPrompt.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar activeInputs = {};\n\nvar KeyboardTypes = {\n\tDefault: 0,                // Default type for the current input method.\n\tNumbersAndPunctuation: 2,  // Numbers and assorted punctuation.\n\tURL: 3,                    // A type optimized for URL entry (shows . / .com prominently).\n\tNumberPad: 4,              // A number pad (0-9). Suitable for PIN entry.\n\tPhonePad: 5,               // A phone pad (1-9, *, 0, #, with letters under the numbers).\n\tEmailAddress: 7,           // A type optimized for multiple email address entry (shows space @ . prominently).\n\tDecimalPad: 8\n}\n\nNATIVE.input.subscribe('Submit', function (evt) {\n\tvar input = activeInputs[evt.id];\n\n\tif (input) {\n\t\tinput.setValue(evt.text);\n\t\tinput.onChange && input.onChange(evt.text);\n\t\tinput.onSubmit && input.onSubmit(evt.text);\n\t}\n});\n\nNATIVE.input.subscribe('Cancel', function (evt) {\n\tvar input = activeInputs[evt.id];\n\n\tif (input) {\n\t\tinput.onChange && input.onChange(input.getValue());\n\t\tdelete activeInputs[evt.id];\n\t}\n});\n\nvar sdk_timestep_platforms_native_InputPrompt=__class__;exports=sdk_timestep_platforms_native_InputPrompt(function sdk_timestep_platforms_native_InputPrompt(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\topts = opts || {};\n\t\tthis.onChange = opts.onChange;\n\t\tthis.onSubmit = opts.onSubmit;\n\t\tthis._okText = 'okText' in opts ? (opts.okText || '') : 'ok';\n\t\tthis._cancelText = 'cancelText' in opts ? (opts.cancelText || '') : 'cancel';\n\t\tthis._value = opts.value != undefined ? opts.value : '';\n\t\tthis._title = opts.title != undefined ? opts.title : '';\n\t\tthis._message = opts.prompt != undefined ? opts.prompt : '';\n\t\tthis._autoShowKeyboard = opts.autoShowKeyboard !== undefined ? opts.autoShowKeyboard : false;\n\t\tthis._isPassword = opts.isPassword !== undefined ? opts.isPassword : false;\n\t\tif (typeof opts.keyboardType === 'string') {\n\t\t\topts.keyboardType = KeyboardTypes[opts.keyboardType];\n\t\t}\n\t\tthis._keyboardType = opts.keyboardType !== undefined ? opts.keyboardType : KeyboardTypes.default;\n\t\tthis._id = -1;\n\t};\n\n\tthis.show = function () {\n\t\tthis._id = NATIVE.input.openPrompt(\n\t\t\t\tthis._title,\n\t\t\t\tthis._message,\n\t\t\t\tthis._okText,\n\t\t\t\tthis._cancelText,\n\t\t\t\tthis._value,\n\t\t\t\tthis._autoShowKeyboard,\n\t\t\t\tthis._isPassword,\n\t\t\t\tthis._keyboardType);\n\n\t\tactiveInputs[this._id] = this;\n\t\treturn this;\n\t};\n\n\tthis.setOkButton = function (value) {\n\t\tthis._okText = value;\n\t\treturn this;\n\t}\n\n\tthis.setCancelButton = function (value) {\n\t\tthis._cancelText = value;\n\t\treturn this;\n\t}\n\n\tthis.setValue = function (value) {\n\t\tthis._value = value;\n\t\treturn this;\n\t};\n\n\tthis.setKeyboardType = function (keyboardType) {\n\t\tthis._keyboardType = keyboardType;\n\t\treturn this;\n\t};\n\n\tthis.getValue = function () {\n\t\treturn this._value;\n\t};\n\n\tthis.setMessage = function (message) {\n\t\tthis._message = message;\n\t\treturn this;\n\t};\n\n\tthis.requestFocus = function () { this.show(); return this; }\n\n\tthis.closeEditField = function () {};\n\n\tthis.refresh = function () {};\n});\n\nexports.KeyboardTypes = KeyboardTypes;\n","pre":true},"sdk/timestep/platforms/native/StatusBar.js":{"path":"sdk/timestep/platforms/native/StatusBar.js","friendlyPath":".StatusBar","directory":"sdk/timestep/platforms/native/","filename":"StatusBar.js","src":"\nexports.show = function() {\n\tNATIVE.statusBar && NATIVE.statusBar.showStatusBar && NATIVE.statusBar.showStatusBar();\n};\n\nexports.hide = function() {\n\tNATIVE.statusBar && NATIVE.statusBar.hideStatusBar && NATIVE.statusBar.hideStatusBar();\n};\n\nexports.getHeight = function () {\n\treturn NATIVE.statusBar && NATIVE.statusBar.statusBarHeight;\n}\n","pre":true},"sdk/timestep/platforms/native/KeyListener.js":{"path":"sdk/timestep/platforms/native/KeyListener.js","friendlyPath":".KeyListener","directory":"sdk/timestep/platforms/native/","filename":"KeyListener.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar sdk_timestep_platforms_native_KeyListener=__class__;exports=sdk_timestep_platforms_native_KeyListener(function sdk_timestep_platforms_native_KeyListener(){return this.init&&this.init.apply(this,arguments)},'timestep.KeyListener', function (logger, supr) {\n\tthis.init = function () {\n\t\tthis._shortcuts = [];\n\t\tthis._events = [];\n\t}\n\n\n\tthis.setEnabled = function (isEnabled) { this._isEnabled = isEnabled; }\n\n\tthis.captureShortcut = function (shortcut) {\n\t\tthis._shortcuts.push(shortcut);\n\t}\n\t\n\tthis.getPressed = function () { return {}; }\n\n\tthis.onKeyDown = function (e) {\n\t\t\n\t}\n\t\n\tthis.liftAll = function () {\n\t}\t\n\tthis.onKeyUp = function (e) {\n\t}\n\t\n\tthis.onKeyPress = function (e) {\n\t}\n\t\n\tthis.peekEvents = function () { return this._events; }\n\tthis.popEvents = function () { return this._events.splice(0, this._events.length); }\n});\n\n","pre":true},"sdk/timestep/platforms/native/TextBox.js":{"path":"sdk/timestep/platforms/native/TextBox.js","friendlyPath":".TextBox","directory":"sdk/timestep/platforms/native/","filename":"TextBox.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar sdk_timestep_platforms_native_TextBox=__class__;exports=sdk_timestep_platforms_native_TextBox(function sdk_timestep_platforms_native_TextBox(){return this.init&&this.init.apply(this,arguments)},function () {\n\tvar T = NATIVE.textbox;\n\tvar SLICE = Array.prototype.slice;\n\t\n\tvar defaults = {\n\t\tx: 0,\n\t\ty: 0,\n\t\twidth: 100,\n\t\theight: 30,\n\t\ttext: \"\",\n\t\tcolor: \"white\"\n\t};\t\n\tthis.init = function (opts) {\n\t\tlogger.log(\"in init\");\n\t\topts = merge(opts, defaults);\n\t\tlogger.log('making a textbox with opts', JSON.stringify(opts));\n\t\tthis._id = T.create(opts.x, opts.y, opts.width, opts.height, opts.text);\n\t}\n\t\n\tvar methods = ['destroy', 'show', 'hide', 'setValue', 'setOpacity', 'setType', 'setVisible',\n\t\t'getX', 'getY', 'getWidth', 'getHeight', 'getValue', 'getOpacity', 'getType', 'getVisible'];\n\t\n\tfor (var i = 0, m; m = methods[i]; ++i) {\n\t\tbind(this, function (m) {\n\t\t\t// getters return the value, setters return this\n\t\t\tif (/^get/.test(m)) {\n\t\t\t\tthis[m] = function () { return T[m].apply(T, [this._id].concat(SLICE.call(arguments, 0))); };\n\t\t\t} else {\n\t\t\t\tthis[m] = function () { T[m].apply(T, [this._id].concat(SLICE.call(arguments, 0))); return this; };\n\t\t\t}\n\t\t})(m);\n\t}\n\t\n\tthis.setPosition = function (p) { T.setPosition(this._id, p.x, p.y); return this; }\n\tthis.getPosition = function () { return {x: this.getX(), y: this.getY()}; }\n\t\n\tthis.setDimensions = function (d) { T.setDimensions(this._id, d.width, d.height); return this; }\n\tthis.getDimensions = function () { return {width: this.getWidth(), height: this.getHeight()}; }\n\n\tthis.setApp = function () {}\n\n\tthis.setOpacity = function (opacity) {\n\t\tT.setOpacity(this._id, opacity);\n\t}\n\n\tthis.setVisible = function (isVisible) {\n\t\tif (isVisible) {\n\t\t\tT.show(this._id); \n\t\t} else {\n\t\t\tT.hide(this._id);\n\t\t}\n\t}\n\n\tthis.setValue = function (text) {\n\t\tT.setValue(this._id, text);\n\t}\n});\n","pre":true},"sdk/timestep/platforms/native/Timer.js":{"path":"sdk/timestep/platforms/native/Timer.js","friendlyPath":".Timer","directory":"sdk/timestep/platforms/native/","filename":"Timer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports.start = function (onTick) {\n\tNATIVE.timer.start(function () {\n\t\tvar now = +new Date(),\n\t\t\tdt = now - (exports.last || now);\n\t\t\n\t\texports.last = now;\n\t\tonTick(dt);\n\t});\n}\n\nexports.last = null;\n\n// NOTE: The timer is stopped automatically so this is just a stub\nexports.stop = function () { }\n","pre":true},"sdk/timestep/platforms/native/EditText.js":{"path":"sdk/timestep/platforms/native/EditText.js","friendlyPath":".EditText","directory":"sdk/timestep/platforms/native/","filename":"EditText.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import device\");\n\nvar focused;\n\nNATIVE.input.subscribe('KeyUp', function(evt) {\n    if (focused != null) {\n        focused._value = evt.text;\n        focused.onChange(evt.text, evt.prevText, evt.cursorPos);\n    }\n});\n\nNATIVE.input.subscribe('FocusNext', function(evt) {\n    if (evt.next && focused && focused._textEditView && focused._textEditView._forwardTextEditView) {\n        focused._textEditView._forwardTextEditView.requestFocus();\n    } else if (!evt.next && focused && focused._textEditView && focused._textEditView._backTextEditView) {\n        focused._textEditView._backTextEditView.requestFocus();\n    }\n});\n\nNATIVE.input.subscribe('Submit', function(evt) {\n    focused && focused.closeEditField();\n});\n\nvar sdk_timestep_platforms_native_EditText=__class__;exports=sdk_timestep_platforms_native_EditText(function sdk_timestep_platforms_native_EditText(){return this.init&&this.init.apply(this,arguments)},function() {\n\n    var defaults = {\n        hint: '',\n        inputType: 'default', // default | number | phone | password | capital\n        maxLength: -1,\n        inputReturnButton: 'default' // default (return) | go | google | join | next | route | search | send | yahoo | done | emergencycall,\n    }\n\n    this.init = function(opts) {\n        console.log('instantiate EditText with hint: ' + opts.hint);\n        this._opts = merge(opts, defaults);\n        this._textEditView = opts.textEditView;\n        this.onFocusChange = opts.onFocusChange || function() {};\n        this.onSubmit = opts.onSubmit || function () {}\n    };\n\n    this.onChange = function (value, prevValue, cursorPos) {\n        this._value = value;\n        if (this._opts.onChange) {\n            this._opts.onChange(value, prevValue, cursorPos);\n        }\n    }\n\n    this.getValue = function () { return this._value; }\n\n    this.setValue = function (value) {\n        this._value = value;\n        this.onChange(value);\n    }\n\n    this.requestFocus = function() {\n        if (focused !== this) {\n            if (focused != null) focused.removeFocus();\n            this.onFocusChange(true);\n        }\n\n        focused = this; \n    }\n\n    this.closeEditField = function() {\n        console.log(\"TextEditView editText removeFocus\");\n        if (focused != null) {\n            focused.removeFocus();\n        }\n\n        NATIVE.input.hideKeyboard();\n     }\n\n    this.refresh = function(currentVal, hasBack, hasForward, cursorPos) {\n        NATIVE.input.showKeyboard(currentVal || \"\",\n                                            this._opts.hint,\n                                            hasBack,\n                                            hasForward,\n                                            this._opts.inputType,\n                                            this._opts.inputReturnButton,\n                                            this._opts.maxLength,\n                                            cursorPos);\n    }\n\n    this.hasFocus = function() {\n        return focused == this;\n    }\n\n    this.removeFocus = function() {\n        this.onFocusChange(false);\n        this.onSubmit(this._value);\n        if (focused == this) {\n            focused = null;\n        }\n    }\n\n    this.setHint = function(hint) {\n        this._opts.hint = hint;\n    }\n\n});\n","pre":true},"sdk/timestep/ui/backend/canvas/ImageView.js":{"path":"sdk/timestep/ui/backend/canvas/ImageView.js","friendlyPath":".backend.canvas.ImageView","directory":"sdk/timestep/ui/backend/canvas/","filename":"ImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.ImageView;\n *\n * canvas.ImageView implementation.\n */\n\njsio(\"import util.path\");\njsio(\"import std.uri as URI\");\n\njsio(\"import ui.View as View\")\njsio(\"import ui.resource.Image as Image\");\n\nvar imageCache = {};\n\n/**\n * @extends ui.View\n */\nvar sdk_timestep_ui_backend_canvas_ImageView=__class__;var ImageView = exports=sdk_timestep_ui_backend_canvas_ImageView(function sdk_timestep_ui_backend_canvas_ImageView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\t/** \n\t * Options:\n\t *   autoSize - See .setImage()\n\t */\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\topts = merge(opts, {\n\t\t\timage: null,\n\t\t\tautoSize: false\n\t\t});\n\t\t\n\t\tthis._autoSize = opts.autoSize;\n\t\t\n\t\tif (opts.image) {\n\t\t\tthis.setImage(opts.image);\n\t\t}\n\t};\n\n\t/**\n\t * Return this view's Image object.\n\t */\n\n\tthis.getImage = function () {\n\t\treturn this._img;\n\t};\n\n\tthis.getImageFromCache = function(url, forceReload) {\n\t\tvar img;\n\t\tif (!forceReload) {\n\t\t\timg = imageCache[url];\n\t\t}\n\t\tif (!img) {\n\t\t\timageCache[url] = img = new Image({\n\t\t\t\turl: url,\n\t\t\t\tforceReload: !!forceReload\n\t\t\t});\n\t\t}\n\t\treturn img;\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\tvar opts = supr(this, 'updateOpts', arguments);\n\t\t\n\t\tif ('autoSize' in opts) {\n\t\t\tthis._autoSize = !!opts.autoSize;\n\t\t}\n\n\t\tif (opts.image) {\n\t\t\tthis.setImage(opts.image);\n\t\t}\n\n\t\treturn opts;\n\t}\n\n\t/**\n\t * Set the image of the view from an Image object or string.\n\t * Options:\n\t *   autoSize - Automatically set view size from image dimensions.\n\t */\n\n\tthis.setImage = function (img, opts) {\n\t\tvar forceReload = opts && opts.forceReload;\n\t\tif (typeof img == 'string') {\n\t\t\timg = this.getImageFromCache(img, forceReload);\n\t\t}\n\n\t\tthis._img = img;\n\n\t\tif (this._img) {\n\t\t\tthis._autoSize = opts && ('autoSize' in opts) ? opts.autoSize : this._autoSize;\n\t\t\tif (this._autoSize) {\n\t\t\t\t// sprited resources will know their dimensions immediately\n\t\t\t\tif (this._img.getWidth() > 0 && this._img.getHeight() > 0) {\n\t\t\t\t\tthis.autoSize();\n\t\t\t\t} else {\n\t\t\t\t\t// non-sprited resources need to load first\n\t\t\t\t\tthis._img.doOnLoad(this, 'autoSize');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._img.doOnLoad(this, 'needsRepaint');\n\t\t}\n\t};\n\n\t/**\n\t * Pass a function to load once the Image object is loaded, or a list of\n\t * arguments that call lib.Callback::run() implicitly.\n\t */\n\t\n\tthis.doOnLoad = function () {\n\t\tif (arguments.length == 1) {\n\t\t\tthis._img.doOnLoad(this, arguments[0]);\n\t\t} else {\n\t\t\tthis._img.doOnLoad.apply(this._img, arguments);\n\t\t}\n\t\treturn this;\n\t};\n\n\t/**\n\t * Automatically resize the view to the size of the image.\n\t */\n\t\n\tthis.autoSize = function () {\n\t\tif (this._img) {\n\t\t\tthis.style.width = this._img.getWidth();\n\t\t\tthis.style.height = this._img.getHeight();\n\n\t\t\tif (this.style.fixedAspectRatio) {\n\t\t\t\tthis.style.enforceAspectRatio(this.style.width, this.style.height);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get original width of the Image object.\n\t */\n\t\n\tthis.getOrigWidth = this.getOrigW = function () {\n\t\treturn this._img.getOrigW();\n\t};\n\n\t/**\n\t * Get original height of the Image object.\n\t */\n\n\tthis.getOrigHeight = this.getOrigH = function () {\n\t\treturn this._img.getOrigH();\n\t};\n\n\t/**\n\t * Render this image onto a canvas.\n\t */\n\n\tthis.render = function (ctx) {\n\t\tif (!this._img) { return; }\n\n\t\tvar s = this.style;\n\t\tvar w = s.width;\n\t\tvar h = s.height;\n\t\tthis._img.render(ctx, 0, 0, w, h);\n\t}\n\n\t/**\n\t * Return a human-readable tag for this view.\n\t */\n\n\tvar _loc = window.location.toString();\n\tvar _host = window.location.hostname;\n\t\n\tthis.getTag = function () {\n\t\tvar tag;\n\t\tif (this._img) {\n\t\t\tvar url = this._img.getOriginalURL();\n\t\t\tif (this._cachedTag && url == this._cachedTag.url) {\n\t\t\t\ttag = this._cachedTag.tag;\n\t\t\t} else {\n\t\t\t\tvar uri = URI.relativeTo(url, _loc);\n\t\t\t\tvar host = uri.getHost();\n\t\t\t\ttag = util.path.splitExt(uri.getFile()).basename + (host && host != _host ? ':' + host : '');\n\n\t\t\t\tthis._cachedTag = {\n\t\t\t\t\turl: url,\n\t\t\t\t\ttag: tag\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\treturn (tag || '') + ':ImageView' + this.uid;\n\t}\n});\n","pre":true},"sdk/timestep/ui/backend/canvas/TextView.js":{"path":"sdk/timestep/ui/backend/canvas/TextView.js","friendlyPath":".backend.canvas.TextView","directory":"sdk/timestep/ui/backend/canvas/","filename":"TextView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.TextView;\n *\n * canvas.TextView implementation.\n */\n\njsio(\"import ui.View as View\");\njsio(\"import ui.layout.Padding as Padding\");\njsio(\"import device\");\njsio(\"import .util.FragmentBuffer as FragmentBuffer\");\njsio(\"import .TextFlow\");\n\njsio(\"import ...legacySettings as legacySettings\");\n\nvar messageFont = true; // Report first font error message\n\nvar textViewID = 1;\n\n/**\n * @extends ui.View\n */\nvar sdk_timestep_ui_backend_canvas_TextView=__class__;var TextView = exports=sdk_timestep_ui_backend_canvas_TextView(function sdk_timestep_ui_backend_canvas_TextView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tvar DEPRECATED = {\n\t\tmultiline: { replacement: \"wrap\" },\n\t\ttextAlign: { replacement: \"horizontalAlign\" },\n\t\tlineWidth: { replacement: \"strokeWidth\" },\n\t\tstrokeStyle: { replacement: \"strokeColor\" },\n\t\toutlineColor: { replacement: \"strokeColor\" }\n\t};\n\n\tvar defaults = {\n\t\t// layout properties...\n\t\twrap: false,\n\t\tautoSize: false,\n\t\tautoFontSize: true,\n\t\tpadding: new Padding(0),\n\t\tlineHeight: 1.2,\n\n\t\t// font properties...\n\t\tcolor: \"#000000\",\n\t\tfontFamily: device.defaultFontFamily,\n\t\tfontWeight: \"\",\n\t\tsize: 128,\n\t\tstrokeWidth: 2,\n\t\tstrokeColor: null,\n\t\tshadowColor: null,\n\n\t\t// alignment properties...\n\t\tverticalAlign: \"middle\",\n\t\thorizontalAlign: \"center\",\n\n\t\t// misc properties...\n\t\tbuffer: false, // GLOBAL.NATIVE && !device.simulatingMobileNative,\n\t\tbackgroundColor: null\n\t};\n\n\tvar clearCache = {\n\t\t// basic widget properties...\n\t\twidth: true,\n\t\theight: true,\n\n\t\t// layout properties...\n\t\twrap: true,\n\t\tautoSize: true,\n\t\tautoFontSize: true,\n\t\tpadding: true,\n\t\tlineHeight: true,\n\n\t\t// font properties...\n\t\tcolor: false,\n\t\tfontFamily: true,\n\t\tfontWeight: true,\n\t\tsize: true,\n\t\tstrokeWidth: true,\n\t\tstrokeColor: false,\n\t\tshadowColor: false,\n\n\t\t// alignment properties...\n\t\tverticalAlign: true,\n\t\thorizontalAlign: true,\n\n\t\t// misc properties...\n\t\tbackgroundColor: false,\n\t\ttext: true\n\t};\n\tvar clearCacheKeys = Object.keys(clearCache);\n\n\tvar hashItems = {\n\t\t// font properties...\n\t\tcolor: true,\n\t\tfontFamily: true,\n\t\tfontWeight: true,\n\t\tsize: true,\n\t\tstrokeWidth: true,\n\t\tstrokeColor: false,\n\t\tshadowColor: false,\n\n\t\t// misc properties...\n\t\tbackgroundColor: true,\n\t\ttext: true\n\t};\n\tvar hashItemsKeys = Object.keys(hashItems);\n\n\tvar savedOpts = [\n\t\t\"width\",\n\t\t\"height\",\n\t\t\"size\"\n\t];\n\n\tvar fontBuffer = new FragmentBuffer();\n\n\tfontBuffer.onGetHash = function (desc) {\n\t\treturn desc.textView.getHash();\n\t};\n\n\tthis.init = function (opts) {\n\t\tthis._opts = {};\n\t\tthis._optsLast = {};\n\t\tthis.updateCache();\n\n\t\tthis._textFlow = new TextFlow({target: this});\n\t\tthis._textFlow.subscribe(\"ChangeWidth\", this, \"onChangeWidth\");\n\t\tthis._textFlow.subscribe(\"ChangeHeight\", this, \"onChangeHeight\");\n\t\tthis._textFlow.subscribe(\"ChangeSize\", this, \"onChangeSize\");\n\n\t\tsupr(this, 'init', [merge(opts, defaults)]);\n\n\t\tthis._id = textViewID++;\n\t};\n\n\tthis.onChangeWidth = function (width) {\n\t\tthis.updateOpts({width: width}, true);\n\t};\n\n\tthis.onChangeHeight = function (height) {\n\t\tthis.updateOpts({height: height}, true);\n\t};\n\n\tthis.onChangeSize = function (size, ctx) {\n\t\tthis.updateOpts({size: size}, true);\n\t\tif (ctx) {\n\t\t\tctx.font = this._opts.fontWeight + \" \" + this._opts.size + \"px \" + this._opts.fontFamily;\n\t\t}\n\t};\n\n\t// These options might have been changed to make the text fit, restore them...\n\tthis._restoreOpts = function () {\n\t\tvar optsLast = this._optsLast;\n\t\tvar optsKey;\n\t\tvar i = savedOpts.length;\n\t\twhile (i) {\n\t\t\toptsKey = savedOpts[--i];\n\t\t\tif (optsKey in optsLast) {\n\t\t\t\tthis._opts[optsKey] = optsLast[optsKey];\n\t\t\t}\n\t\t}\n\t};\n\n\t// Check if the cache should be updated...\n\tthis._checkOpts = function (opts) {\n\t\tvar optsLast = this._optsLast;\n\t\tvar optsKey;\n\t\tvar i = clearCacheKeys.length;\n\n\t\tthis._cacheUpdate = this._cacheUpdate || !Object.keys(this._opts).length;\n\t\tif (this._cacheUpdate) {\n\t\t\tthis._hash = false;\n\t\t}\n\t\twhile (i) {\n\t\t\toptsKey = clearCacheKeys[--i];\n\t\t\tif ((optsKey in opts) && clearCache[optsKey] && (optsLast[optsKey] !== opts[optsKey])) {\n\t\t\t\tthis._cacheUpdate = true;\n\t\t\t}\n\t\t\tif (optsKey in opts) {\n\t\t\t\toptsLast[optsKey] = opts[optsKey];\n\t\t\t} else if (optsKey in this._opts) {\n\t\t\t\toptsLast[optsKey] = this._opts[optsKey];\n\t\t\t} else {\n\t\t\t\toptsLast[optsKey] = defaults[optsKey];\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._checkDeprecatedOpts = function (opts) {\n\t\topts.allowVerticalSizing = !legacySettings.disableVerticalAutoSize;\n\t\tfor (var k in DEPRECATED) {\n\t\t\tif (k in opts) {\n\t\t\t\tvar dep = DEPRECATED[k];\n\t\t\t\tif (DEBUG && !dep.hasWarned) {\n\t\t\t\t\tconsole.warn(\"TextView opts.\" + k + \" is deprecated, please use \" + dep.replacement + \"...\");\n\t\t\t\t\tdep.hasWarned = true;\n\t\t\t\t}\n\t\t\t\topts[dep.replacement] = opts[k];\n\t\t\t}\n\t\t}\n\t\tvar font = opts.font;\n\t\tif (font) {\n\t\t\tif (DEBUG && messageFont) {\n\t\t\t\tconsole.warn(\"TextView opts.font is deprecated, please use fontFamily and size...\");\n\t\t\t\tmessageFont = false;\n\t\t\t}\n\t\t\twhile (font.length && (font[0] === \" \")) {\n\t\t\t\tfont = font.substr(1 - font.length);\n\t\t\t}\n\t\t\tvar i = font.indexOf(' ');\n\t\t\tif (i !== -1) {\n\t\t\t\topts.size = parseInt(font.substr(0, i).replace(/[pxtem\\s]/gi, \"\"), 10);\n\t\t\t\topts.fontFamily = font.substr(i + 1 - font.length);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.updateCache = function () {\n\t\tthis._cacheUpdate = true;\n\t\tthis._hash = false;\n\t};\n\n\tthis.updateOpts = function (opts, dontCheck) {\n\t\tif (this._opts.buffer) {\n\t\t\tfontBuffer.releaseBin(this.getHash());\n\t\t}\n\t\tthis.updateCache();\n\n\t\tthis._checkDeprecatedOpts(opts);\n\n\t\tif (\"padding\" in opts) {\n\t\t\tthis.style.padding = new Padding(opts.padding);\n\t\t}\n\n\t\tif (!dontCheck) {\n\t\t\tthis._restoreOpts();\n\t\t\tthis._checkOpts(opts);\n\t\t\tif (this._cacheUpdate) {\n\t\t\t\topts.hash = false;\n\t\t\t} else {\n\t\t\t\tsupr(this, \"updateOpts\", arguments);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\topts = supr(this, \"updateOpts\", arguments);\n\n\t\t(\"text\" in opts) && this.setText(opts.text);\n\t\t!dontCheck && this._textFlow.setOpts(this._opts);\n\n\t\treturn opts;\n\t};\n\n\tthis._updateCtx = function (ctx) {\n\t\tvar opts = this._opts;\n\n\t\tctx.textAlign = \"left\";\n\t\tctx.textBaseline = \"top\";\n\t\tctx.fillStyle = opts.color;\n\t\tctx.font = opts.fontWeight + \" \" + opts.size + \"px \" + opts.fontFamily;\n\t\tctx.lineWidth = this.getStrokeWidth();\n\t};\n\n\tthis._renderToCtx = function (ctx, offsetX, offsetY) {\n\t\tvar opts = this._opts;\n\t\tvar cache = this._textFlow.getCache();\n\t\tvar maxWidth = opts.autoFontSize ? this._textFlow.getActualWidth() : 1000000;\n\t\tvar item;\n\t\tvar word;\n\t\tvar color = opts.color;\n\t\tvar strokeColor = opts.strokeColor;\n\t\tvar shadowColor = opts.shadowColor;\n\t\tvar lineOffset = this.getStrokeWidth() * 0.5;\n\t\tvar x, y;\n\t\tvar i = cache.length;\n\n\t\tif (legacySettings.textViewColor && this.color) {\n\t\t\tcolor = this.color;\n\t\t}\n\n\t\tthis._updateCtx(ctx);\n\n\t\tif (strokeColor) {\n\t\t\tctx.strokeStyle = strokeColor;\n\t\t}\n\n\t\twhile (i) {\n\t\t\titem = cache[--i];\n\t\t\tword = item.word;\n\n\t\t\tx = offsetX + item.x;\n\t\t\ty = offsetY + item.y;\n\n\t\t\tif (strokeColor) {\n\t\t\t\tctx.strokeText(word, x + lineOffset, y + lineOffset, maxWidth);\n\t\t\t}\n\t\t\tif (shadowColor) {\n\t\t\t\tctx.fillStyle = shadowColor;\n\t\t\t\tctx.fillText(word, x + lineOffset, y + lineOffset, maxWidth);\n\t\t\t}\n\n\t\t\tctx.fillStyle = color;\n\t\t\tctx.fillText(word, x + lineOffset, y + lineOffset, maxWidth);\n\t\t}\n\t};\n\n\tthis._renderBuffer = function (ctx) {\n\t\tvar fontBufferCtx = fontBuffer.getContext();\n\t\tvar offsetRect = this._textFlow.getOffsetRect();\n\t\tvar width = offsetRect.width;\n\t\tvar height = offsetRect.height;\n\t\tvar cache = this._textFlow.getCache();\n\t\tvar desc;\n\n\t\tif (width && height) {\n\t\t\tthis._opts.lineCount = cache[cache.length - 1].line;\n\t\t\toffsetRect.text = this._opts.text;\n\t\t\toffsetRect.textView = this;\n\t\t\t// When we support clearing offscreen buffers then this line can be activated instead of the next one...\n\t\t\t// desc = fontBuffer.getPositionForText(offsetRect) || fontBuffer.getPositionForText(offsetRect);\n\t\t\tdesc = fontBuffer.getPositionForText(offsetRect);\n\t\t\tif (desc != null) {\n\t\t\t\tif (this._cacheUpdate) {\n\t\t\t\t\tfontBufferCtx.clearRect(desc.x, desc.y, desc.width, desc.height);\n\t\t\t\t\tthis._renderToCtx(fontBufferCtx, desc.x - offsetRect.x, desc.y - offsetRect.y);\n\t\t\t\t}\n\t\t\t\tctx.drawImage(fontBuffer.getCanvas(), desc.x, desc.y, width, height, offsetRect.x, offsetRect.y, width, height);\n\t\t\t} else {\n\t\t\t\tthis._opts.buffer = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.computeSize = function (ctx) {\n\t\tif (this._cacheUpdate) {\n\t\t\tthis._updateCtx(ctx);\n\t\t\tvar opts = this._opts;\n\t\t\tthis._textFlow.reflow(ctx, 1 + (opts.autoFontSize ? 4 : 0) + (opts.autoSize ? 2 : 0) + (opts.wrap ? 1 : 0));\n\t\t}\n\t}\n\n\tthis.render = function (ctx) {\n\t\tthis.computeSize(ctx);\n\t\tif (!this._textFlow.getCache().length) {\n\t\t\tthis._cacheUpdate = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._opts.buffer) {\n\t\t\tthis._renderBuffer(ctx);\n\t\t} else {\n\t\t\tvar strokeWidthOffset = -this.getStrokeWidth()/2;\n\t\t\tthis._renderToCtx(ctx, strokeWidthOffset, strokeWidthOffset);\n\t\t}\n\n\t\tthis._cacheUpdate = false;\n\t};\n\n\tthis.clearBuffers = function () {\n\t\tfontBuffer.clearBuffer();\n\t};\n\n\tthis.getFontBuffer = function () {\n\t\treturn fontBuffer;\n\t};\n\n\tthis.setText = function (textData) {\n\t\tvar text = (textData != undefined) ? textData.toString() : \"\";\n\n\t\tif (this._opts.text != text) {\n\t\t\tif (this._opts.buffer) {\n\t\t\t\tfontBuffer.releaseBin(this.getHash());\n\t\t\t}\n\n\t\t\tthis._restoreOpts();\n\t\t\tthis._opts.text = text;\n\t\t\tthis.updateCache();\n\t\t\tthis.needsRepaint();\n\t\t}\n\t};\n\n\tthis.getStrokeWidth = function () {\n\t\treturn this._opts.strokeColor ? this._opts.strokeWidth : 0;\n\t};\n\n\tthis.getText = function () {\n\t\treturn this._opts.text;\n\t};\n\n\tthis.getTag = function () {\n\t\treturn \"TextView\" + this.uid + \":\" + (this.tag || (this._opts.text || \"\").substring(0, 20));\n\t};\n\n\tthis.getOpts = function () {\n\t\treturn this._opts;\n\t};\n\n\tthis.getHash = function () {\n\t\tif (!this._hash) {\n\t\t\tthis._hash = \"\";\n\n\t\t\tvar opts = this._opts;\n\t\t\tvar i = hashItemsKeys.length;\n\t\t\twhile (i) {\n\t\t\t\tthis._hash += opts[hashItemsKeys[--i]];\n\t\t\t}\n\t\t}\n\t\treturn this._hash;\n\n\t\t// When we support clearing offscreen buffers we can use this instead of the code above...\n\t\t// return 't' + this._id;\n\t};\n\n\tthis.reflow = function () {\n\t\tthis._restoreOpts();\n\t\tthis._cacheUpdate = true;\n\t};\n});\n\nexports.clearBuffers = TextView.prototype.clearBuffers;\nexports.getFontBuffer = TextView.prototype.getFontBuffer;\n","pre":true},"sdk/timestep/ui/layout/Padding.js":{"path":"sdk/timestep/ui/layout/Padding.js","friendlyPath":"ui.layout.Padding","directory":"sdk/timestep/ui/layout/","filename":"Padding.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.layout.Padding;\n *\n * A simple class to express padding views.\n */\n\nPadding=__class__;exports = Padding=Padding(function Padding(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init =\n\tthis.update = function (args) {\n\t\tif (args instanceof Padding) {\n\t\t\tthis.top = args.top;\n\t\t\tthis.right = args.right;\n\t\t\tthis.bottom = args.bottom;\n\t\t\tthis.left = args.left;\n\t\t\treturn;\n\t\t}\n\t\tif (typeof args == 'string') {\n\t\t\targs = args.split(/\\s+/).map(function (piece) { return parseFloat(piece); });\n\t\t}\n\n\t\tif (!args || !args.length) { args = [args || 0]; }\n\n\t\tswitch (args.length) {\n\t\t\tcase 1:\n\t\t\t\tthis.left = this.right = this.top = this.bottom = args[0];\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.top = this.bottom = args[0];\n\t\t\t\tthis.left = this.right = args[1];\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.top = args[0];\n\t\t\t\tthis.left = this.right = args[1];\n\t\t\t\tthis.bottom = args[2];\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tthis.top = args[0];\n\t\t\t\tthis.right = args[1];\n\t\t\t\tthis.bottom = args[2];\n\t\t\t\tthis.left = args[3];\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tthis.getVertical = function () { return this.top + this.bottom; }\n\tthis.getHorizontal = function () { return this.left + this.right; }\n\n\tthis.toString = function () { return [this.top, this.right, this.bottom, this.left].join(' '); }\n});","pre":true},"sdk/timestep/ui/backend/canvas/util/FragmentBuffer.js":{"path":"sdk/timestep/ui/backend/canvas/util/FragmentBuffer.js","friendlyPath":".util.FragmentBuffer","directory":"sdk/timestep/ui/backend/canvas/util/","filename":"FragmentBuffer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import device\");\njsio(\"import .FragmentBin\");\njsio(\"import .SortedLinkedList as SortedList\");\n\nvar sdk_timestep_ui_backend_canvas_util_FragmentBuffer=__class__;var FragmentBuffer = exports=sdk_timestep_ui_backend_canvas_util_FragmentBuffer(function sdk_timestep_ui_backend_canvas_util_FragmentBuffer(){return this.init&&this.init.apply(this,arguments)},function () {\n\tvar debug = false;\n\tthis.init = function (opts) {\n\t\tthis.opts = merge(opts, {});\n\t\tthis._cache = {};\n\t\tthis._decriptions = [];\n\t\twindow.addEventListener('pageshow', bind(this, 'clearBuffer'), false);\n\t};\n\n\tvar sort = function (a, b) {\n\t\treturn a.size() > b.size();\n\t};\n\n\tthis._build = function () {\n\t    var Canvas = device.get('Canvas');\n        this._canvas = new Canvas({width: 1024, height: 1024});\n        this._ctx = this.getCanvas().getContext('2d');\n\t\tthis._ctx.clearRect(0, 0, 1024, 1024);\n\t\tthis._ctx.textAlign = 'left';\n\t\tthis._ctx.textBaseline = 'middle';\n\t\tthis._ctx.globalCompositeOperation = 'source-over';\n\t\tthis._binList = new SortedList(sort);\n\t\tvar head = new FragmentBin({\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 1024,\n\t\t\theight: 1024\n\t\t});\n\t\tthis._binList.insert(head);\n\t\tdebug && window.open().document.body.appendChild(this._canvas);\n\t};\n\n\tthis.getCanvas = function () {\n\t\tif (!this._canvas) {\n\t\t\tthis._build();\n\t\t}\n\t\treturn this._canvas;\n\t};\n\n\tthis.getContext = function () {\n\t\tif (!this._ctx) {\n\t\t\tthis._build();\n\t\t}\n\t\treturn this._ctx;\n\t};\n\n\tthis.onGetHash = function (description) {\n\t\tthrow Error('onGetHash should be implemented.');\n\t};\n\n\tvar randomColor = function () {\n\t\tvar color = 'rgba(' +\n\t\t\t\t\t(Math.random()*255).toFixed() + ',' +\n\t\t\t\t\t(Math.random()*255).toFixed() + ',' +\n\t\t\t\t\t(Math.random()*255).toFixed() + ',' +\n\t\t\t\t\t'1)';\n\t\treturn color;\n\t};\n\n\tthis._insertText = function (description) {\n\t\tvar width = Math.ceil(description.width) + 1;\n\t\tvar height = Math.ceil(description.height) + 1;\n\t\tvar iter = this._binList.iterator();\n\t\tvar bin = null;\n\t\tvar found = false;\n\t\twhile (iter.hasNext() && !found) {\n\t\t\tbin = iter.next();\n\t\t\tif (!bin.filled && bin.width >= width && bin.height >= height) {\n\t\t\t\tfound = true;\n\t\t\t} else {\n\t\t\t\t//we don't want to insert in filled bins\n\t\t\t\tbin = null;\n\t\t\t}\n\t\t}\n\t\tif (bin) {\n\t\t\tnewBins = bin.split(width, height);\n\t\t\tfor (var i = 0; i < newBins.length; i++) {\n\t\t\t\tthis._binList.insert(newBins[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tlogger.log('buffer full, further TextViews will not be cached');\n\t\t\t// When we support clearing buffers then this should be enabled again...\n\t\t\t// this.clearBuffer();\n\t\t}\n\n\t\treturn bin;\n\t};\n\n\t/**\n\t* debugging code to verify overlapping bins aren't created.\n\t*/\n\tvar rectIntersectsRect = function (r1, r2) {\n\t\tvar ax1 = r1.x;\n\t\tvar ax2 = r1.x + r1.width;\n\t\tvar ay1 = r1.y;\n\t\tvar ay2 = r1.y + r1.height;\n\t\tvar bx1 = r2.x;\n\t\tvar bx2 = r2.x + r2.width;\n\t\tvar by1 = r2.y;\n\t\tvar by2 = r2.y + r2.height;\n\t\treturn ax1 < bx2 && ax2 > bx1 && ay1 < by2 && ay2 > by1;\n\t};\n\n\tvar debugCheck = function (bin, list) {\n\t\tif (!bin) { return;}\n\t\tvar iter = list.iterator();\n\t\tvar ok = true;\n\t\twhile (iter.hasNext() && ok) {\n\t\t\tvar next = iter.next();\n\t\t\tok = next == bin || !rectIntersectsRect(next, bin);\n\t\t\tif (!ok) {\n\t\t\t\tlogger.error('rect overlaps');\n\t\t\t\tlogger.error(iter.current(), bin);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getPositionForText = function (description) {\n\t\tvar hash = this.onGetHash(description);\n\t\tvar width = Math.ceil(description.width) + 1;\n\n\t\tif (!this._cache[hash] && width > 0) {\n\t\t\tthis._cache[hash] = this._insertText(description, false);\n\t\t\tthis._decriptions.push(description);\n\t\t}\n\t\tif (debug && false) {\n\t\t\tdebugCheck(description, this._binList);\n\t\t}\n\t\treturn this._cache[hash];\n\t};\n\n\tthis.releaseBin = function (hash) {\n\t\tif (this._cache[hash]) {\n\t\t\t// When we support clearin buffers then this should be enabled again...\n\t\t\t// this._cache[hash].filled = false;\n\t\t\t// delete this._cache[hash];\n\t\t}\n\t};\n\n\tthis.clearBuffer = function () {\n\t\tthis._cache = {};\n\t\tthis._binList = new SortedList(sort);\n\t\tthis._binList.insert(new FragmentBin({\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 1024,\n\t\t\theight: 1024\n\t\t}));\n\t\tthis._ctx && this._ctx.clearRect(0, 0, 1024, 1024);\n\t\twhile (this._decriptions.length) {\n\t\t\tthis._decriptions.pop().textView.updateCache();\n\t\t}\n\t};\n});","pre":true},"sdk/timestep/ui/backend/canvas/util/FragmentBin.js":{"path":"sdk/timestep/ui/backend/canvas/util/FragmentBin.js","friendlyPath":".FragmentBin","directory":"sdk/timestep/ui/backend/canvas/util/","filename":"FragmentBin.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * TextBins are used in the FragmentBuffer caching of TextViews.\n **/\nvar sdk_timestep_ui_backend_canvas_util_FragmentBin=__class__;var FragmentBin = exports=sdk_timestep_ui_backend_canvas_util_FragmentBin(function sdk_timestep_ui_backend_canvas_util_FragmentBin(){return this.init&&this.init.apply(this,arguments)},'TextBin', function (logger, supr) {\n\tthis.init = function (opts) {\n\t\tthis.width = opts.width;\n\t\tthis.height = opts.height;\n\t\tthis.x = opts.x;\n\t\tthis.y = opts.y;\n\t};\n\n\tthis.size = function () {\n\t\treturn this.width * this.height;\n\t};\n\n\tthis.split = function (x, y) {\n\t\tvar newBins = [this];\n\t\tif (this.width > 10 && this.height > 10) {\n\t\t\tif (this.height - y > 10) {\n\t\t\t\tvar bin1 = new FragmentBin({\n\t\t\t\t\tx: this.x,\n\t\t\t\t\ty: this.y + y,\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\theight: this.height - y\n\t\t\t\t});\n\t\t\t\tnewBins.push(bin1);\n\t\t\t}\n\t\t\tif (this.width - x > 10) {\n\t\t\t\tvar bin2 = new FragmentBin({\n\t\t\t\t\tx: this.x + x,\n\t\t\t\t\ty: this.y,\n\t\t\t\t\twidth: this.width - x,\n\t\t\t\t\theight: y\n\t\t\t\t});\n\t\t\t\tnewBins.push(bin2);\n\t\t\t}\n\t\t}\n\t\tthis.width = x;\n\t\tthis.height = y;\n\t\tthis.filled = true;\n\n\t\treturn newBins;\n\t};\n});","pre":true},"sdk/timestep/ui/backend/canvas/util/SortedLinkedList.js":{"path":"sdk/timestep/ui/backend/canvas/util/SortedLinkedList.js","friendlyPath":".SortedLinkedList","directory":"sdk/timestep/ui/backend/canvas/util/","filename":"SortedLinkedList.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nIterator=__class__;var Iterator=Iterator(function Iterator(){return this.init&&this.init.apply(this,arguments)},'Iterator', function (logger, supr) {\n\tthis.init = this.update = function (list) {\n\t\tthis._list = list || this._list;\n\t\tthis._current = list.head;\n\t\tthis._count = 0;\n\t};\n\n\tthis.next = function () {\n\t\tvar data = this._current.data;\n\t\tthis._current = this._current.next;\n\t\tthis._count++;\n\t\treturn data;\n\t};\n\n\tthis.current = function () {\n\t\treturn this._current.data;\n\t};\n\n\tthis.insertBefore = function (data) {\n\t\tthis._current.insertBefore(data);\t\n\t\tthis._list.count++;\n\t};\n\n\tthis.insertAfter = function (data) {\n\t\tthis._current.insertAfter(data);\t\n\t\tthis._list.count++;\n\t};\n\n\tthis.remove = function () {\n\t\tthis._current.prev.remove();\n\t\tif (this._current.prev == this._current) {\n\t\t\tthis._list.head = null;\n\t\t}\n\t\tthis._list.count--;\n\t};\n\n\tthis.hasNext = function () {\n\t\treturn this._count < this._list.count;\n\t};\n\n\tthis.atHead = function () {\n\t\treturn this._current == this._list.head;\n\t};\n});\n\nItem=__class__;var Item=Item(function Item(){return this.init&&this.init.apply(this,arguments)},'Item', function (logger, supr) {\n\tthis.init = function (data, prev, next) {\n\t\tthis.data = data;\n\t\tthis.prev = prev || this; \n\t\tthis.next = next || this;\n\t};\n\n\tthis.insertBefore = function (data) {\n\t\tvar item = new Item(data, this.prev, this);\n\t\tthis.prev.next = item;\n\t\tthis.prev = item;\n\t};\n\t\n\tthis.insertAfter = function (data) {\n\t\tvar item = new Item(data, this, this.next);\n\t\tthis.next.prev = item;\n\t\tthis.next = item;\n\t};\n\n\tthis.remove = function () {\n\t\tthis.prev.next = this.next;\n\t\tthis.next.prev = this.prev;\n\t};\n});\n\nvar sdk_timestep_ui_backend_canvas_util_SortedLinkedList=__class__;exports=sdk_timestep_ui_backend_canvas_util_SortedLinkedList(function sdk_timestep_ui_backend_canvas_util_SortedLinkedList(){return this.init&&this.init.apply(this,arguments)},'SortedLinkedList', function (logger, supr) {\n\tthis.init = function (comparator) {\n\t\tthis.head = null;\n\t\tthis._comparator = comparator;\n\t\tthis.count = 0;\n\t};\n\n\tthis.append = function (data) {\n\t\tthis._head.insertAfter(data);\n\t\tthis.count++;\n\t};\n\n\tthis.insert = function (data) {\n\t\tif (!this.head) {\n\t\t\tthis.head = new Item(data);\n\t\t\tthis.count++;\n\t\t} else {\n\t\t\tvar i = this.iterator();\n\t\t\tvar d = i.current();\t\n\t\t\tvar found = false;\n\t\t\twhile (i.hasNext() && !found) {\n\t\t\t\tfound = !this._comparator(data, d);\n\t\t\t\tif (!found) {\n\t\t\t\t\ti.next();\t\n\t\t\t\t\td = i.current();\n\t\t\t\t}\n\t\t\t}\n\t\t\ti.insertBefore(data);\n\t\t\tif (found && i.atHead()) {\n\t\t\t\tthis.head = this.head.prev;\t\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.iterator = function () {\n\t\treturn new Iterator(this);\n\t};\n});\n","pre":true},"sdk/timestep/ui/backend/canvas/TextFlow.js":{"path":"sdk/timestep/ui/backend/canvas/TextFlow.js","friendlyPath":".TextFlow","directory":"sdk/timestep/ui/backend/canvas/","filename":"TextFlow.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.Enum as Enum\");\njsio(\"import lib.PubSub as PubSub\");\n\nvar textFlowMode = Enum(\n\t\"NONE\",\n\t\"WRAP\",\n\t\"AUTOSIZE\",\n\t\"AUTOSIZE_WRAP\",\n\t\"AUTOFONTSIZE\",\n\t\"AUTOFONTSIZE_WRAP\",\n\t\"AUTOFONTSIZE_AUTOSIZE\",\n\t\"AUTOFONTSIZE_WRAP_AUTOSIZE\"\n);\n\nvar sdk_timestep_ui_backend_canvas_TextFlow=__class__;var TextFlow = exports=sdk_timestep_ui_backend_canvas_TextFlow(function sdk_timestep_ui_backend_canvas_TextFlow(){return this.init&&this.init.apply(this,arguments)},PubSub, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, \"init\", arguments);\n\n\t\tthis._target = opts.target;\n\t\tthis._lineWidth = 0;\n\t\tthis._line = [];\n\t\tthis._lines = [];\n\n\t\tthis._cache = [];\n\t\tthis._cacheSize = 0;\n\n\t\tthis._maxWordWidth = 0;\n\t\tthis._maxWidth = 0;\n\t\tthis._maxHeight = 0;\n\n\t\tthis._heightFound = 0;\n\n\t\tthis._offsetRect = {x: 0, y: 0, width: 0, height: 0};\n\t};\n\n\t// Split the text into a list containing the word and the width of the word...\n\tthis._lineSplit = function (ctx) {\n\t\tvar opts = this._opts;\n\t\tvar spaceWidth = opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar text = opts.text || \"\";\n\t\tvar words = \n\t\t\t\topts.wrapCharacter\n\t\t\t\t\t? text.replace(/\\t/g, \" \").match(/\\S[。，]?|[\\n]/g) || []\n\t\t\t\t\t: (opts.wrap || (opts.horizontalAlign === \"justify\")) \n\t\t\t\t\t\t? (text.replace(/\\t/g, \" \").match(/\\S+|[\\n]| +(?= )/g) || [])\n\t\t\t\t\t\t: text.split(\"\\n\");\n\t\tvar word;\n\t\tvar currentWord = 0;\n\t\tvar wordCount = words.length;\n\n\t\tthis._line = [];\n\t\tthis._lineWidth = 0;\n\t\tthis._maxWordWidth = 0;\n\n\t\tif ((opts.hardWrap || exports.hardWrap) && (words.length === 1) && (ctx.measureText(text).width > this.getActualWidth())) {\n\t\t\twords = [];\n\n\t\t\tvar actualWidth = this.getActualWidth();\n\t\t\tvar s = \"\";\n\t\t\tvar i = 0;\n\n\t\t\twhile (i < text.length) {\n\t\t\t\tvar c = text[i++];\n\t\t\t\tif (ctx.measureText(s + c).width >= actualWidth) {\n\t\t\t\t\twords.push(s);\n\t\t\t\t\ts = c;\n\t\t\t\t} else {\n\t\t\t\t\ts += c;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (s !== \"\") {\n\t\t\t\twords.push(s);\n\t\t\t}\n\t\t\twordCount = words.length;\n\t\t}\n\n\t\twhile (currentWord < wordCount) {\n\t\t\tword = {word: words[currentWord], width: ctx.measureText(words[currentWord]).width, line: 1};\n\t\t\tthis._line.push(word);\n\t\t\tthis._lineWidth += word.width + spaceWidth;\n\t\t\tthis._maxWordWidth = Math.max(this._maxWordWidth, word.width);\n\t\t\tcurrentWord++;\n\t\t}\n\t\tthis._lineWidth -= spaceWidth;\n\t};\n\n\tthis._measureWords = function (ctx) {\n\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar currentWord = 0;\n\t\tvar wordCount = this._line.length;\n\n\t\tthis._lineWidth = 0;\n\t\tthis._maxWordWidth = 0;\n\n\t\twhile (currentWord < wordCount) {\n\t\t\tword = this._line[currentWord];\n\t\t\tword.line = 1;\n\t\t\tword.width = ctx.measureText(word.word).width;\n\t\t\tthis._lineWidth += word.width + spaceWidth;\n\t\t\tthis._maxWordWidth = Math.max(this._maxWordWidth, word.width);\n\t\t\tcurrentWord++;\n\t\t}\n\t\tthis._lineWidth -= spaceWidth;\n\t};\n\n\t// Split the single line into multiple lines which fit into the available width...\n\tthis._wrap = function (ctx, width) {\n\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar word;\n\t\tvar currentWidth = 0;\n\t\tvar lines = [];\n\t\tvar line = [];\n\t\tvar s = \"\";\n\n\t\tthis._lines = lines;\n\t\tthis._maxWidth = 0;\n\n\t\tvar currentWord = 0;\n\t\tvar wordCount = this._line.length;\n\n\t\tif (this._opts.horizontalAlign === \"justify\") {\n\t\t\twhile (currentWord < wordCount) {\n\t\t\t\tword = this._line[currentWord++];\n\t\t\t\tcurrentWidth += word.width + spaceWidth;\n\t\t\t\tif (word.word === \"\\n\") {\n\t\t\t\t\tlines.push(line);\n\t\t\t\t\tline = [];\n\t\t\t\t\tcurrentWidth = 0;\n\t\t\t\t} else if (currentWidth > width) {\n\t\t\t\t\tline.length && lines.push(line);\n\t\t\t\t\tline = [word];\n\t\t\t\t\tcurrentWidth = word.width + spaceWidth;\n\t\t\t\t} else {\n\t\t\t\t\tline.push(word);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tline.length && lines.push(line);\n\t\t} else {\n\t\t\t// Note: this algorithm isn't 100% accurate because we are going\n\t\t\t// to use the cumulative width of the line (sum up widths of all\n\t\t\t// measured words plus space widths), which on some platforms will\n\t\t\t// actually be slightly longer than the actual line length.  Usually\n\t\t\t// we're only off by a few pixels, so it doesn't matter.  However,\n\t\t\t// if we remeasured each line after computing the full line length,\n\t\t\t// we'd end up with a shorter line than we expected, and if we then\n\t\t\t// resize our view to fit the width and try to wrap text again, we'd\n\t\t\t// find that the width of the line is now longer than the width of \n\t\t\t// the view, resulting in the line wrapping shorter than the previous\n\t\t\t// time (unnecessarily).  Additionally, this extra measure is \n\t\t\t// expensive, so we'll just use our rough approximation. \n\t\t\twhile (currentWord < wordCount) {\n\t\t\t\tword = this._line[currentWord++];\n\t\t\t\t// currentWidth = ctx.measureText(s).width;\n\t\t\t\tif (word.word === \"\\n\") {\n\t\t\t\t\tlines.push([{word: s, width: currentWidth, line: lines.length}]);\n\t\t\t\t\ts = \"\";\n\t\t\t\t} else {\n\t\t\t\t\tvar isLineEmpty = !s.length;\n\t\t\t\t\tvar hasSpace = !isLineEmpty && !this._opts.wrapCharacter;\n\t\t\t\t\tvar offset = hasSpace ? spaceWidth : 0;\n\t\t\t\t\tif (currentWidth + word.width + offset > width) {\n\t\t\t\t\t\tvar wordWidth = word.width;\n\n\t\t\t\t\t\t// if word is longer than the entire line width\n\t\t\t\t\t\tif (wordWidth > width) {\n\t\t\t\t\t\t\tvar current = word.word;\n\n\t\t\t\t\t\t\t// split word into lines\n\t\t\t\t\t\t\tvar wordPiece = \"\";\n\t\t\t\t\t\t\tfor (var i = 0, n = current.length; i < n; ++i) {\n\t\t\t\t\t\t\t\tif ((isLineEmpty && !wordPiece) || ctx.measureText(wordPiece + current[i]).width + offset + currentWidth <= width) {\n\t\t\t\t\t\t\t\t\twordPiece += current[i];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvar line = s + (hasSpace ? \" \" : \"\") + wordPiece;\n\t\t\t\t\t\t\t\t\tcurrentWidth = ctx.measureText(line).width;\n\t\t\t\t\t\t\t\t\tlines.push([{word: line, width: currentWidth, line: lines.length}]);\n\t\t\t\t\t\t\t\t\tcurrentWidth = 0;\n\t\t\t\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t\t\t\t\ts = \"\";\n\t\t\t\t\t\t\t\t\tisLineEmpty = true;\n\t\t\t\t\t\t\t\t\thasSpace = false;\n\t\t\t\t\t\t\t\t\twordPiece = \"\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (wordPiece) {\n\t\t\t\t\t\t\t\tvar line = s + (hasSpace ? \" \" : \"\") + wordPiece;\n\t\t\t\t\t\t\t\tcurrentWidth = ctx.measureText(line).width;\n\t\t\t\t\t\t\t\tlines.push([{word: line, width: currentWidth, line: lines.length}]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t(!isLineEmpty) && lines.push([{word: s, width: currentWidth, line: lines.length}]);\n\t\t\t\t\t\t\ts = word.word;\n\t\t\t\t\t\t\tcurrentWidth = word.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ts += (hasSpace ? \" \" : \"\") + word.word;\n\t\t\t\t\t\tcurrentWidth += word.width + offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (s !== \"\") {\n\t\t\t\tlines.push([{word: s, width: currentWidth, line: lines.length}]);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._getLineSize = function (lineCount) {\n\t\tvar opts = this._opts;\n\t\treturn ((lineCount <= 1) ? 1 : opts.lineHeight) * opts.size;\n\t};\n\n\t// Calculate the position of each word on the line...\n\tthis._wordFlow = function (ctx) {\n\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar lines = this._lines;\n\n\t\tthis._cache = [];\n\t\tthis._cacheSize = 0;\n\n\t\tthis._maxWidth = 0;\n\t\tthis._maxHeight = 0;\n\n\t\tvar currentLine = 0;\n\t\tvar lineCount = lines.length;\n\t\tvar lineSize = this._getLineSize(lineCount);\n\t\tvar y = 0;\n\n\t\twhile (currentLine < lineCount) {\n\t\t\tvar line = lines[currentLine++];\n\t\t\tvar currentWord = 0;\n\t\t\tvar wordCount = line.length;\n\t\t\tvar x = 0;\n\n\t\t\twhile (currentWord < wordCount) {\n\t\t\t\tvar word = line[currentWord++];\n\n\t\t\t\tword.x = x;\n\t\t\t\tword.y = y;\n\t\t\t\tword.line = currentLine;\n\t\t\t\tthis._cache[this._cacheSize++] = word;\n\n\t\t\t\tx += word.width + spaceWidth;\n\t\t\t}\n\n\t\t\ty += lineSize;\n\t\t\tx -= spaceWidth;\n\n\t\t\tthis._maxWidth = Math.max(this._maxWidth, x);\n\t\t\tthis._maxHeight = Math.max(this._maxHeight, y);\n\t\t}\n\t};\n\n\t// Check if the given width fits into the available size, if not the resize the font...\n\tthis._checkWidth = function (ctx, width) {\n\t\tif (this._opts.text === \"\") {\n\t\t\treturn false;\n\t\t}\n\t\tvar opts = this._opts;\n\n\t\tif (width > this.getActualWidth()) {\n\t\t\tvar size = (opts.size * this._target.style.width / width) | 0;\n\t\t\t(opts.size !== size) && this.publish(\"ChangeSize\", size, ctx);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tthis._checkHeight = function (ctx, loSize, hiSize, cb) {\n\t\tif (this._opts.text === \"\") {\n\t\t\treturn;\n\t\t}\n\t\tif (Math.abs(hiSize - loSize) < 2) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar pivot = Math.max((loSize + hiSize) >> 1, 1);\n\t\tthis.publish(\"ChangeSize\", pivot, ctx);\n\t\tcb();\n\t\tif (pivot === 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar opts = this._opts;\n\t\tvar lineSize = this._getLineSize(this._lines.length);\n\t\tif ((this._lines.length * lineSize > this.getActualHeight())) {\n\t\t\tthis._checkHeight(ctx, loSize, pivot, cb);\n\t\t} else {\n\t\t\tthis._heightFound = opts.size;\n\t\t\tthis._checkHeight(ctx, pivot, hiSize, cb);\n\t\t}\n\t};\n\n\tthis._horizontalAlign = function (ctx) {\n\t\tvar paddingLeft = this.getPaddingLeft();\n\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar div = {left: -1, center: 2, right: 1, justify: 3}[this._opts.horizontalAlign];\n\t\tvar cache = this._cache;\n\t\tvar actualWidth = this.getActualWidth();\n\t\tvar width;\n\t\tvar offset;\n\t\tvar line;\n\t\tvar x;\n\n\t\tif (!cache.length) {\n\t\t\treturn;\n\t\t}\n\t\tif (div === 3) {\n\t\t\tspaceWidth = 0;\n\t\t}\n\n\t\tvar firstWordOnLine;\n\t\tvar currentWord = 0;\n\t\tvar wordCount = cache.length;\n\t\twhile (currentWord < wordCount) {\n\t\t\tfirstWordOnLine = currentWord;\n\t\t\tline = cache[currentWord].line;\n\t\t\twidth = 0;\n\t\t\twhile ((currentWord < wordCount) && (line === cache[currentWord].line)) {\n\t\t\t\twidth += cache[currentWord].width + spaceWidth;\n\t\t\t\tcurrentWord++;\n\t\t\t}\n\t\t\tif (div === -1) { // left...\n\t\t\t\twhile (firstWordOnLine < currentWord) {\n\t\t\t\t\tcache[firstWordOnLine++].x += paddingLeft;\n\t\t\t\t}\n\t\t\t} else if (div === 3) { // justify...\n\t\t\t\toffset = (line < cache[cache.length - 1].line) ? (actualWidth - width) / (currentWord - firstWordOnLine - 1) : spaceWidth;\n\t\t\t\tx = paddingLeft;\n\t\t\t\twhile (firstWordOnLine < currentWord) {\n\t\t\t\t\tcache[firstWordOnLine].x = x;\n\t\t\t\t\tx += cache[firstWordOnLine].width + offset;\n\t\t\t\t\tfirstWordOnLine++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toffset = (actualWidth - width + spaceWidth) / div + paddingLeft;\n\t\t\t\twhile (firstWordOnLine < currentWord) {\n\t\t\t\t\tcache[firstWordOnLine++].x += offset;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._verticalAlign = function () {\n\t\tvar lineCount = this._lines.length;\n\t\tvar div = {top: -1, middle: 2, bottom: 1}[this._opts.verticalAlign];\n\t\tvar cache = this._cache;\n\t\tvar actualHeight = this.getActualHeight();\n\t\tvar offset;\n\t\tvar i = cache.length;\n\n\t\tif (!cache.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (div === -1) {\n\t\t\toffset = this.getPaddingTop();\n\t\t} else {\n\t\t\tvar lineSize = this._getLineSize(lineCount);\n\t\t\toffset = (actualHeight - lineCount * lineSize) / div + this.getPaddingTop();\n\t\t}\n\t\twhile (i) {\n\t\t\tcache[--i].y += offset;\n\t\t}\n\n\t\tthis._offsetRect.y += offset;\n\t};\n\n\tthis.reflow = function (ctx, mode) {\n\t\tvar opts = this._opts;\n\t\tvar actualWidth = this.getActualWidth();\n\t\tvar actualHeight = this.getActualHeight();\n\n\t\tthis._lineSplit(ctx);\n\n\t\tswitch (mode) {\n\t\t\tcase textFlowMode.NONE:\n\t\t\t\tthis._lines = [this._line];\n\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.WRAP:\n\t\t\t\tthis._wrap(ctx, actualWidth);\n\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOSIZE:\n\t\t\tcase textFlowMode.AUTOFONTSIZE_AUTOSIZE:\n\t\t\t\tthis._lines = [this._line];\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\tif (this._opts.fitWidth || actualWidth < this._maxWidth) {\n\t\t\t\t\tthis.publish(\"ChangeWidth\", this._maxWidth + this.getHorizontalPadding());\n\t\t\t\t}\n\n\t\t\t\tif (this._opts.fitHeight || actualHeight < this._maxHeight) {\n\t\t\t\t\tthis.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOSIZE_WRAP:\n\t\t\t\tthis._wrap(ctx, actualWidth);\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\tif (this._opts.fitWidth || actualWidth < this._maxWidth) {\n\t\t\t\t\tthis.publish(\"ChangeWidth\", this._maxWidth + this.getHorizontalPadding());\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this._opts.fitHeight  || actualHeight < this._maxHeight) {\n\t\t\t\t\tthis.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOFONTSIZE:\n\t\t\t\tthis._checkWidth(ctx, this._lineWidth) && this._lineSplit(ctx);\n\t\t\t\tthis._lines = [this._line];\n\t\t\t\t// Don't use the lineHeight here because it's a single line\n\t\t\t\tif (opts.allowVerticalSizing && opts.size > this.getActualHeight()) {\n\t\t\t\t\tvar cb = bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\tthis._measureWords(ctx);\n\t\t\t\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tthis._checkHeight(ctx, 1, opts.size, cb);\n\t\t\t\t\tthis.publish(\"ChangeSize\", this._heightFound, ctx);\n\t\t\t\t\tcb();\n\t\t\t\t} else {\n\t\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOFONTSIZE_WRAP:\n\t\t\t\tthis._wrap(ctx, actualWidth);\n\t\t\t\tif (this._checkWidth(ctx, this._maxWordWidth)) {\n\t\t\t\t\tthis._lineSplit(ctx);\n\t\t\t\t\tthis._wrap(ctx, actualWidth);\n\t\t\t\t}\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\tvar lineCount = this._lines.length;\n\t\t\t\tvar lineSize = this._getLineSize(lineCount);\n\t\t\t\tif (opts.allowVerticalSizing && lineCount * lineSize > this.getActualHeight()) {\n\t\t\t\t\tvar cb = bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\tthis._measureWords(ctx);\n\t\t\t\t\t\t\tthis._wrap(ctx, actualWidth);\n\t\t\t\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tthis._checkHeight(ctx, 1, opts.size, cb);\n\t\t\t\t\tthis.publish(\"ChangeSize\", this._heightFound, ctx);\n\t\t\t\t\tcb();\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOFONTSIZE_WRAP_AUTOSIZE:\n\t\t\t\tthis._wrap(ctx, actualWidth);\n\t\t\t\tif (this._checkWidth(ctx, this._maxWordWidth)) {\n\t\t\t\t\tthis._lineSplit(ctx);\n\t\t\t\t\tthis._wrap(ctx, actualWidth);\n\t\t\t\t}\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\t(actualHeight < this._maxHeight) && this.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar cache = this._cache;\n\t\tvar lastCacheItem = cache[cache.length - 1];\n\n\t\tif (!cache.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar strokeWidth = this._target.getStrokeWidth();\n\t\tvar lineSize = Math.ceil(opts.size * opts.lineHeight + strokeWidth);\n\t\tthis._offsetRect.x = this.getPaddingLeft();\n\t\tthis._offsetRect.y = this.getPaddingTop();\n\t\tthis._offsetRect.width = this.getActualWidth();\n\t\tthis._offsetRect.height = lastCacheItem.line * lineSize;\n\n\t\tthis._horizontalAlign(ctx);\n\t\tthis._verticalAlign();\n\n\t\tif (lastCacheItem.line === 1) {\n\t\t\tthis._offsetRect.x = cache[0].x;\n\t\t\tthis._offsetRect.width = lastCacheItem.x + lastCacheItem.width - cache[0].x;\n\t\t}\n\n\t\tthis._offsetRect.width += strokeWidth;\n\t};\n\n\tthis.setOpts = function (opts) {\n\t\tthis._opts = opts;\n\t};\n\n\tthis.getCache = function () {\n\t\treturn this._cache;\n\t};\n\n\tthis.getHorizontalPadding = function () {\n\t\tvar padding = this._target.style.padding;\n\n\t\treturn padding.left + padding.right;\n\t};\n\n\tthis.getPaddingLeft = function () {\n\t\treturn this._target.style.padding.left;\n\t};\n\n\tthis.getActualWidth = function () {\n\t\treturn this._target.style.width - this.getHorizontalPadding();\n\t};\n\n\tthis.getVerticalPadding = function () {\n\t\tvar padding = this._target.style.padding;\n\n\t\treturn padding.top + padding.bottom;\n\t};\n\n\tthis.getPaddingTop = function () {\n\t\treturn this._target.style.padding.top;\n\t};\n\n\tthis.getActualHeight = function () {\n\t\treturn this._target.style.height - this.getVerticalPadding();\n\t};\n\n\tthis.getOffsetRect = function () {\n\t\treturn this._offsetRect;\n\t};\n});\n","pre":true},"sdk/timestep/ui/legacySettings.js":{"path":"sdk/timestep/ui/legacySettings.js","friendlyPath":"...legacySettings","directory":"sdk/timestep/ui/","filename":"legacySettings.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports = {\n\tdisableVerticalAutoSize: false,\n\ttextViewColor: false // use this.color in TextView if true\n}\n","pre":true},"sdk/timestep/ui/backend/canvas/ViewDebugger.js":{"path":"sdk/timestep/ui/backend/canvas/ViewDebugger.js","friendlyPath":".backend.canvas.ViewDebugger","directory":"sdk/timestep/ui/backend/canvas/","filename":"ViewDebugger.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import std.js as JS\");\n\nvar sdk_timestep_ui_backend_canvas_ViewDebugger=__class__;exports=sdk_timestep_ui_backend_canvas_ViewDebugger(function sdk_timestep_ui_backend_canvas_ViewDebugger(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\tthis.init = function (target, opts) {\n\t\tthis._target = target;\n\t\tthis._opts = opts = JS.merge(opts, {\n\t\t\ttrackClicks: false,\n\t\t\toutline: false,\n\t\t\tflash: false\n\t\t});\n\t\t\n\t\tthis.outline = opts.outline;\n\t\tthis.trackClicks = opts.trackClicks;\n\t\tthis.flash = opts.flash;\n\t\t\n\t\tthis._flashState = 0;\n\t\tthis._nextFlash = 0;\n\t}\n\t\n\tthis.preRender = function (ctx) {\n\t\tif (!this._time) { this._time = +new Date(); }\n\t\tvar prevTime = this._time;\n\t\tthis._time = +new Date();\n\t\tthis._dt = this._time - prevTime;\n\t\t\n\t\tvar s = this._target.style;\n\t\tif (this.outline) {\n\t\t\tctx.save();\n\t\t\tctx.globalAlpha = 0.2;\n\t\t\tctx.strokeStyle = 'black';\n\t\t\tctx.lineWidth = 1.0;\n\t\t\tctx.strokeRect(0, 0, s.width, s.height);\n\t\t\tctx.restore();\n\t\t}\n\t}\n\t\n\tthis.postRender = function (ctx) {\n\t\t\tvar s = this._target.style;\n\n\t\tvar t = this._target;\n\t\tif (this.trackClicks) {\n\t\t\tfor (var i = t._clicks.length - 1; i >= 0; --i) {\n\t\t\t\tvar c = t._clicks[i];\n\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, ' + c.o + ')');\n\t\t\t\tc.o -= 0.4 * this._dt / 1000;\n\t\t\t\tif (c.o > 0) {\n\t\t\t\t\tctx.circle(c.x, c.y, 15);\n\t\t\t\t\tctx.fill();\n\t\t\t\t} else {\n\t\t\t\t\tt._clicks.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (this.flash) {\n\t\t\tswitch(this._flashState) {\n\t\t\t\tcase 0:\n\t\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, 0.5)');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, 0)');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tctx.setFillStyle('rgba(255, 255, 255, 0.5)');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, 0)');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tvar now = +new Date();\n\t\t\tif (now > this._nextFlash) {\n\t\t\t\tthis._flashState = (this._flashState + 1) % 4;\n\t\t\t\tthis._nextFlash = now + 300;\n\t\t\t}\n\t\t\t\n\t\t\tctx.fillRect(0, 0, t.style.width, t.style.height);\n\t\t}\n\t}\n});\n","pre":true},"sdk/timestep/ui/init.js":{"path":"sdk/timestep/ui/init.js","friendlyPath":"ui.init","directory":"sdk/timestep/ui/","filename":"init.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import .View\");\njsio(\"import .layout.BackingExtension\");\njsio(\"import .Engine\");","pre":true},"sdk/timestep/ui/layout/BackingExtension.js":{"path":"sdk/timestep/ui/layout/BackingExtension.js","friendlyPath":".layout.BackingExtension","directory":"sdk/timestep/ui/layout/","filename":"BackingExtension.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import ..View\");\njsio(\"import ..backend.strPad as strPad\");\njsio(\"import ..backend.BaseBacking\");\njsio(\"import .BoxLayout\");\njsio(\"import .LinearLayout\");\njsio(\"import .Padding\");\n\njsio(\"import util.setProperty\");\n\nvar layoutProps = {\n\t\t'layout': {value: false, cb: '_onSetLayout'},\n\t\t'inLayout': {value: true, cb: '_onInLayout'},\n\t\t'order': {value: 0, cb: '_onOrder'},\n\t\t'direction': {value: 'down', cb: '_onLayoutChange'},\n\t\t'flex': {value: 0, cb: '_onLayoutChange'},\n\t\t'halign': {value: 'start'}, 'halignSelf': {value: undefined},\n\t\t'valign': {value: 'start'}, 'valignSelf': {value: undefined},\n\n\t\t'centerX': {value: false},\n\t\t'centerY': {value: false},\n\n\t\t'top': {value: undefined, cb: '_onLayoutChange'},\n\t\t'right': {value: undefined, cb: '_onLayoutChange'},\n\t\t'bottom': {value: undefined, cb: '_onLayoutChange'},\n\t\t'left': {value: undefined, cb: '_onLayoutChange'},\n\n\t\t'justifyContent': {value: 'start', cb: '_onLayoutChange'},\n\t\t'sizeContainerToFit': {value: false, cb: '_onLayoutChange'},\n\n\t\t'minWidth': {value: undefined, cb: '_onLayoutChange'},\n\t\t'minHeight': {value: undefined, cb: '_onLayoutChange'},\n\t\t'maxWidth': {value: undefined, cb: '_onLayoutChange'},\n\t\t'maxHeight': {value: undefined, cb: '_onLayoutChange'},\n\n\t\t'layoutWidth': {value: undefined, cb: '_onLayoutChange'},\n\t\t'layoutHeight': {value: undefined, cb: '_onLayoutChange'},\n\n\t\t'fixedAspectRatio': {value: false, cb: '_onFixedAspectRatio'},\n\t\t'aspectRatio': {value: null, cb: '_onLayoutChange'},\n\n\t\t'margin': {value: null, cb: '_onMarginChange'}\n\t};\n\nfor (var key in layoutProps) {\n\tbackend.BaseBacking.addProperty(key, layoutProps[key]);\n}\n\nutil.setProperty(backend.BaseBacking.prototype, 'padding', {\n\tget: function () {\n\t\treturn this._padding || (this._padding = new Padding());\n\t},\n\tset: function (value) {\n\t\tif (this._padding) {\n\t\t\tthis._padding.update(value);\n\t\t} else {\n\t\t\tthis._padding = new Padding(value);\n\t\t}\n\n\t\tthis._onLayoutChange();\n\t}\n});\n\nView.addExtension({\n\textend: function (ViewBacking) {\n\n\t\tvar proto = ViewBacking.prototype;\n\n\t\tproto._sortOrder = strPad.initialValue;\n\t\tproto._onOrder = function (_, order) {\n\t\t\tthis._sortOrder = strPad.pad(order);\n\t\t\tthis._onLayoutChange();\n\t\t};\n\t\t\n\t\tproto._onMarginChange = function (key, value) {\n\t\t\tif (this._cachedMargin) {\n\t\t\t\tthis._cachedMargin.update(value);\n\t\t\t} else {\n\t\t\t\tthis._cachedMargin = new Padding(value);\n\t\t\t}\n\n\t\t\tthis.top = this._cachedMargin.top;\n\t\t\tthis.bottom = this._cachedMargin.bottom;\n\t\t\tthis.left = this._cachedMargin.left;\n\t\t\tthis.right = this._cachedMargin.right;\n\n\t\t\tthis._onLayoutChange();\n\t\t}\n\n\t\tproto._onFixedAspectRatio = function (key, value) {\n\t\t\tif (value) {\n\t\t\t\tthis.updateAspectRatio();\n\t\t\t}\n\t\t}\n\n\t\tproto.updateAspectRatio = function (w, h) {\n\t\t\tthis.aspectRatio = (w || this.width) / (h || this.height);\n\t\t}\n\n\t\tproto.enforceAspectRatio = function(iw, ih, isTimeout) {\n\t\t\tif (iw && ih) {\n\t\t\t\tthis.updateAspectRatio(iw, ih);\n\t\t\t}\n\t\t\tvar parent = this._view.getSuperview();\n\t\t\tvar opts = this._view._opts;\n\t\t\tiw = iw || opts.width;\n\t\t\tih = ih || opts.height;\n\t\t\tif (opts.width) {\n\t\t\t\tiw = opts.width;\n\t\t\t\tih = opts.width / this.aspectRatio;\n\t\t\t}\n\t\t\telse if (opts.height) {\n\t\t\t\tih = opts.height;\n\t\t\t\tiw = opts.height * this.aspectRatio;\n\t\t\t}\n\t\t\telse if (parent) {\n\t\t\t\tif (opts.layoutWidth && parent.style.width) {\n\t\t\t\t\tiw = parent.style.width * parseFloat(opts.layoutWidth) / 100;\n\t\t\t\t\tih = iw / this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (opts.layoutHeight && parent.style.height) {\n\t\t\t\t\tih = parent.style.height * parseFloat(opts.layoutHeight) / 100;\n\t\t\t\t\tiw = ih * this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (this.flex && parent.style.direction == 'horizontal' && this.width) {\n\t\t\t\t\tiw = this.width;\n\t\t\t\t\tih = iw / this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (this.flex && parent.style.direction == 'vertical' && this.height) {\n\t\t\t\t\tih = this.height;\n\t\t\t\t\tiw = ih * this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (!isTimeout) {\n\t\t\t\t\tsetTimeout(bind(this, 'enforceAspectRatio', iw, ih, true), 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.width = iw;\n\t\t\tthis.height = ih;\n\t\t};\n\n\t\tproto._onSetLayout = function (key, which) {\n\t\t\tswitch (which) {\n\t\t\t\tcase 'linear':\n\t\t\t\t\tthis._view.__layout = new LinearLayout({view: this._view});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'box':\n\t\t\t\t\tthis._view.__layout = new BoxLayout({view: this._view});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\tproto._onInLayout = function (key, value) {\n\t\t\tvar layout = this._superview && this._superview.__layout;\n\t\t\tif (layout) {\n\t\t\t\tif (value) {\n\t\t\t\t\tlayout.add(this._view);\n\t\t\t\t} else {\n\t\t\t\t\tlayout.remove(this._view);\n\t\t\t\t\tthis._view.needsReflow();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// var isPercent = /%$/;\n\t\t// proto._onLayoutSizeChange = function (key, value, oldValue) {\n\t\t// \t// Subscribes a view to parent resize events when the view is in the hierarchy and\n\t\t// \t// contains a percentage height or width.\n\t\t// \t//\n\t\t// \t// NOTE: a view only sets up resize listeners once -- if layoutWidth is set to a percent and then reset\n\t\t// \t// to not have a percent, it will still get reflow events when its superview resizes.  We could\n\t\t// \t// remove the listeners once the view no longer has percentages.\n\t\t// \tif (!this._hasResizeListeners && (isPercent.test(this._layoutWidth) || isPercent.test(this._layoutHeight))) {\n\t\t// \t\tthis._hasResizeListeners = true;\n\t\t// \t\tthis._view.on('ViewAdded', bind(this, function () {\n\t\t// \t\t\tif (this.__superviewResize) {\n\t\t// \t\t\t\tthis.__superviewResize();\n\t\t// \t\t\t}\n\t\t\t\t\t\n\t\t// \t\t\tvar superview = this._view.getSuperview();\n\t\t// \t\t\tvar onResize = bind(this._view, 'needsReflow');\n\t\t// \t\t\tsuperview.on('Resize', onResize);\n\t\t\t\t\t\n\t\t// \t\t\tthis.__superviewResize = bind(this, function () {\n\t\t// \t\t\t\tthis.__superviewResize = null;\n\t\t// \t\t\t\tsuperview.removeListener('Resize', onResize);\n\t\t// \t\t\t});\n\t\t// \t\t}));\n\t\t\t\t\n\t\t// \t\tthis._view.on('ViewRemoved', bind(this, function (superview) {\n\t\t// \t\t\tif (this.__superviewResize) { this.__superviewResize(); }\n\t\t// \t\t}));\n\t\t// \t}\n\t\t\t\n\t\t// \tthis._onLayoutChange();\n\t\t// }\n\n\t\tproto._onLayoutChange = function () {\n\t\t\tvar superview = this.getSuperview();\n\t\t\tif (superview && superview.__layout) {\n\t\t\t\tsuperview.needsReflow();\n\t\t\t}\n\n\t\t\tthis._view.needsReflow();\n\t\t}\n\t}\n});\n","pre":true},"sdk/timestep/ui/layout/BoxLayout.js":{"path":"sdk/timestep/ui/layout/BoxLayout.js","friendlyPath":".BoxLayout","directory":"sdk/timestep/ui/layout/","filename":"BoxLayout.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar sdk_timestep_ui_layout_BoxLayout=__class__;var BoxLayout = exports=sdk_timestep_ui_layout_BoxLayout(function sdk_timestep_ui_layout_BoxLayout(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar cls = this.constructor;\n\n\tthis.reflowsChildren = false;\n\n\tthis.init = function (opts) {\n\t\tthis._view = opts.view;\n\n\t\tcls.initParentListener(opts.view);\n\t}\n\n\tthis.reflow = function (force) {\n\t\tvar view = this._view;\n\t\tvar sv = view.getSuperview();\n\t\tvar style = view.style;\n\n\t\tif (sv && (force || !style.inLayout || !sv.style.layout || sv.__layout && !sv.__layout.reflowsChildren)) {\n\t\t\tcls.reflowX(view, sv.style.width);\n\t\t\tcls.reflowY(view, sv.style.height);\n\t\t}\n\n\n\t}\n\n\tcls.addParentListener = function (view) {\n\t\tif (view.style.__removeSuperviewResize) {\n\t\t\tview.style.__removeSuperviewResize();\n\t\t}\n\n\t\t// reflow on parent view resize\n\t\tvar onResize = bind(view, 'needsReflow');\n\t\tvar superview = view.getSuperview();\n\t\tsuperview && superview.on('Resize', onResize);\n\n\t\t// store a closure to unsubscribe this event\n\t\tview.style.__removeSuperviewResize = bind(view.style, function () {\n\t\t\tthis.__removeSuperviewResize = null;\n\t\t\tsuperview && superview.removeListener('Resize', onResize);\n\t\t});\n\t}\n\n\tcls.initParentListener = function (view) {\n\t\tif (view.__root) { this.addParentListener(view); }\n\n\t\tview.on('ViewAdded', bind(this, 'addParentListener', view));\n\t\tview.on('ViewRemoved', bind(view.style, function () {\n\t\t\tthis.__removeSuperviewResize && this.__removeSuperviewResize();\n\t\t}));\n\t}\n\n\tcls.reflowX = function (view, svWidth, padding) {\n\t\tif (!svWidth) { return; }\n\n\t\tvar s = view.style;\n\t\tvar availWidth = (svWidth - (padding && padding.getHorizontal() || 0));\n\n\t\t// compute the width\n\t\tvar w = 0;\n\t\tif (s.layoutWidth == 'wrapContent') {\n\t\t\t// find the maximal right edge\n\t\t\tvar views = view.getSubviews();\n\t\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\t\tvar right = v.style.x + v.style.width * v.style.scale;\n\t\t\t\tif (right > w) {\n\t\t\t\t\tw = right;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tvar sv = view.getSuperview();\n\t\t\tw = s.right != undefined && s.left != undefined ? availWidth / s.scale - (s.left || 0) - (s.right || 0)\n\t\t\t\t: (s.layoutWidth && s.layoutWidth.charAt(s.layoutWidth.length-1) == '%') ? (availWidth / s.scale) * (parseFloat(s.layoutWidth) / 100)\n\t\t\t\t: view._opts.width ? view._opts.width\n\t\t\t\t: s.aspectRatio ? (view._opts.height || s.height) * s.aspectRatio\n\t\t\t\t: (sv.style.direction == \"horizontal\" && typeof s.flex == \"number\") ? availWidth * s.flex / sv._flexSum\n\t\t\t\t: view._opts.autoSize ? s.width\n\t\t\t\t: availWidth / s.scale || s.width;\n\t\t}\n\n\t\tif (s.centerX) { s.x = (availWidth - s.scale * w) / 2 + (padding && padding.left || 0); }\n\t\tif (s.left == undefined && s.right != undefined) { s.x = availWidth - s.scale * w - s.right - (padding && padding.right || 0); }\n\t\tif (s.left != undefined) { s.x = s.left + (padding && padding.left || 0); }\n\n\t\ts.width = w;\n\n\t\tif (s.centerAnchor) {\n\t\t\ts.anchorX = w / 2;\n\t\t}\n\t}\n\n\tcls.reflowY = function (view, svHeight, padding) {\n\t\tif (!svHeight) { return; }\n\n\t\tvar s = view.style;\n\t\tvar availHeight = (svHeight - (padding && padding.getVertical() || 0));\n\n\t\t// compute the height\n\t\tvar h = 0;\n\t\tif (s.layoutHeight == 'wrapContent') {\n\t\t\t// find the maximal right edge\n\t\t\tvar views = view.getSubviews();\n\t\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\t\tvar bottom = v.style.y + v.style.height * v.style.scale;\n\t\t\t\tif (bottom > h) {\n\t\t\t\t\th = bottom;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tvar sv = view.getSuperview();\n\t\t\th = s.top != undefined && s.bottom != undefined ? availHeight / s.scale - (s.top || 0) - (s.bottom || 0)\n\t\t\t\t: (s.layoutHeight && s.layoutHeight.charAt(s.layoutHeight.length-1) == '%') ? (availHeight / s.scale) * (parseFloat(s.layoutHeight) / 100)\n\t\t\t\t: view._opts.height ? view._opts.height\n\t\t\t\t: s.aspectRatio ? (view._opts.width || s.width) / s.aspectRatio\n\t\t\t\t: (sv.style.direction == \"vertical\" && typeof s.flex == \"number\") ? availHeight * s.flex / sv._flexSum\n\t\t\t\t: view._opts.autoSize ? s.height\n\t\t\t\t: availHeight / s.scale || s.height;\n\t\t}\n\n\t\tif (s.centerY) { s.y = (availHeight - s.scale * h) / 2 + (padding && padding.top || 0); }\n\t\tif (s.top == undefined && s.bottom != undefined) { s.y = availHeight - s.scale * h - s.bottom - (padding && padding.bottom || 0); }\n\t\tif (s.top != undefined) { s.y = s.top + (padding && padding.top || 0); }\n\n\t\ts.height = h;\n\n\t\tif (s.centerAnchor) {\n\t\t\ts.anchorY = h / 2;\n\t\t}\n\t}\n});\n\n","pre":true},"sdk/timestep/ui/layout/LinearLayout.js":{"path":"sdk/timestep/ui/layout/LinearLayout.js","friendlyPath":".LinearLayout","directory":"sdk/timestep/ui/layout/","filename":"LinearLayout.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.layout.LinearLayout;\n *\n * A class to direct the layout of its parent view, set through opts.parent.\n */\n\njsio(\"import ui.layout.Padding as Padding\");\n\njsio(\"import .BoxLayout\");\n\nvar DEBUG = false;\n\n// TODO: native\n// TODO: Resize event on width/height change\n// TODO: reflow on subview visibility change\n\nvar sdk_timestep_ui_layout_LinearLayout=__class__;exports=sdk_timestep_ui_layout_LinearLayout(function sdk_timestep_ui_layout_LinearLayout(){return this.init&&this.init.apply(this,arguments)},BoxLayout, function (supr) {\n\n\t// set to true to tell other layouts not to try to control the child layout\n\tthis.reflowsChildren = true;\n\n\tthis.init = function (opts) {\n\t\tthis._view = opts.view;\n\t\tthis._view.subscribe('SubviewAdded', this, '_onSubviewAdded');\n\t\tthis._view.subscribe('SubviewRemoved', this, '_onSubviewRemoved');\n\n\t\tthis.setDirection(opts.isVertical ? 'vertical' : 'horizontal');\n\n\t\tthis._views = [];\n\t\tvar subviews = this._view.getSubviews();\n\t\tfor (var i = 0, view; view = subviews[i]; ++i) {\n\t\t\tif (view.style.inLayout) {\n\t\t\t\tthis._views.push(this._initLayoutView(view));\n\t\t\t}\n\t\t}\n\n\t\tthis._forwardEvents();\n\n\t\tthis._debug = DEBUG;\n\t}\n\n\tthis._onSubviewRemoved = function (view) {\n\t\tif (view.style.inLayout) {\n\t\t\tthis.remove(view);\n\t\t}\n\t}\n\n\tthis._onSubviewAdded = function (view) {\n\t\tif (view.style.inLayout) {\n\t\t\tthis.add(view);\n\t\t}\n\t}\n\n\tthis.debug = function () { this._debug = true; return this; }\n\n\t/**\n\t * Set which language to use, for horizontal or vertical layout.\n\t * @param String direction One of \"horizontal\" or \"vertical\".\n\t */\n\n\tthis.setDirection = function (direction) {\n\t\tthis._direction = direction;\n\n\t\tvar isVertical = direction == 'vertical';\n\t\tthis._propPos = isVertical ? 'y' : 'x';\n\t\tthis._propPosOpp = isVertical ? 'x' : 'y';\n\t\tthis._propDim = isVertical ? 'height' : 'width';\n\t\tthis._minPropDim = isVertical ? 'minHeight' : 'minWidth';\n\t\tthis._maxPropDim = isVertical ? 'maxHeight' : 'maxWidth';\n\t\tthis._propDimOpp = isVertical ? 'width' : 'height';\n\t\tthis._propSideA = isVertical ? 'top' : 'left';\n\t\tthis._propSideB = isVertical ? 'bottom' : 'right';\n\n\t\tthis._flexProp = isVertical ? 'vflex' : 'hflex';\n\n\t\tthis._view.needsReflow();\n\t\treturn this;\n\t}\n\n\tthis.getDirection = function () { return this._direction; }\n\n\t/**\n\t * Events to proxy to the parent view from this layout.\n\t */\n\tthis._events = ['ViewWillAppear', 'ViewDidAppear', 'ViewWillDisappear', 'ViewDidDisappear'];\n\n\tthis._forwardEvents = function () {\n\t\tfor (var i = 0, a; a = this._events[i]; ++i) {\n\t\t\tthis._view.subscribe(a, this, '_forwardSignal', a);\n\t\t}\n\t};\n\n\tthis._events = ['ViewWillAppear', 'ViewDidAppear', 'ViewWillDisappear', 'ViewDidDisappear'];\n\n\t/**\n\t * Emit events on the children. Variable arguments.\n\t */\n\n\tthis._forwardSignal = function () {\n\t\tfor (var i = 0, v; v = this._views[i]; ++i) {\n\t\t\tv.view.publish.apply(v.view, arguments);\n\t\t}\n\t};\n\n\t/**\n\t * Initialize a subview controlled by this layout.\n\t */\n\n\tthis._initLayoutView = function (view) {\n\t\tview.style.inLayout = true;\n\n\t\tthis._debug && logger.log(this._view.uid, 'adding view', view.uid, this._propDim, view.style[this._propDim]);\n\n\t\tthis._view.connectEvent(view, 'Resize', bind(this, 'reflow'));\n\n\t\treturn {\n\t\t\tview: view,\n\t\t\tindex: 0,\n\t\t\ttoString: toStringSort\n\t\t};\n\t};\n\n\tfunction toStringSort () {\n\t\treturn this.view.style._sortOrder + this.index;\n\t}\n\n\t/**\n\t * Return the size of this element (in its cardinal direction).\n\t */\n\n\tthis.getSize = function () {\n\t\treturn this._size;\n\t};\n\n\t/**\n\t * Return the index of a subview.\n\t */\n\n\tthis.getViewIndex = function (view) {\n\t\tfor (var i = 0, d; d = this._views[i]; ++i) {\n\t\t\tif (d.view == view) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\t/**\n\t * Add an array of subviews to this element in batch (prevent reflow each\n\t * time).\n\t */\n\n\tthis.addSubviews = function (views) {\n\t\tthis._debug && logger.log(this._view.uid, \"adding\", views.length, \"views\");\n\t\tif (isArray(views)) {\n\t\t\tfor (var i = 0, n = views.length; i < n; ++i) {\n\t\t\t\tvar view = views[i];\n\t\t\t\tif (view) {\n\t\t\t\t\tthis._views.push(this._initLayoutView(view));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._view.needsReflow();\n\t\t} else {\n\t\t\tthis.insertBefore(views);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Return the list of subviews controlled by this layout.\n\t */\n\n\tthis.getSubviews = function () {\n\t\treturn this._views.map(function (v) { return v.view; });\n\t};\n\n\t/**\n\t * Remove a subview controlled by this layout.\n\t */\n\n\tthis.remove = function (view) {\n\t\tvar i = this.getViewIndex(view);\n\t\tif (i != -1) {\n\t\t\tthis._views.splice(i, 1);\n\t\t\tthis._view.disconnectEvent(view, 'Resize');\n\t\t\tthis._view.needsReflow();\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Insert a subview before another subview in this hierarchy.\n\t */\n\n\tthis.add =\n\tthis.insertBefore = function (view, before) {\n\n\t\tif (this.getViewIndex(view) != -1) { return; }\n\n\t\tvar item = this._initLayoutView(view);\n\t\tvar added = false;\n\t\tif (before) {\n\t\t\tvar i = this.getViewIndex(before);\n\t\t\tif (i != -1) {\n\t\t\t\tthis._views.splice(i, 0, item);\n\t\t\t\tadded = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!added) {\n\t\t\tthis._views.push(item);\n\t\t}\n\n\t\tthis._view.needsReflow();\n\t}\n\n\t/**\n\t * Insert a subview after another subview in this hierarchy.\n\t */\n\n\tthis.insertAfter = function (view, after) {\n\n\t\tif (this.getViewIndex(view) != -1) { return; }\n\n\t\tvar item = this._initLayoutView(view);\n\t\tvar added = false;\n\t\tif (after) {\n\t\t\tvar i = this.getViewIndex(after);\n\t\t\tif (i != -1) {\n\t\t\t\tthis._views.splice(i + 1, 0, item);\n\t\t\t\tadded = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!added) {\n\t\t\tthis._views.unshift(item);\n\t\t}\n\n\t\tthis._view.needsReflow();\n\t}\n\n\t/**\n\t * Reflow logic.\n\t */\n\n\tthis.reflow = function () {\n\t\tsupr(this, 'reflow', arguments);\n\n\t\t// style.order is first, then default to standard view sort order\n\t\tvar n = 0;\n\t\tfor (var i = 0, v; v = this._views[i]; ++i) {\n\t\t\tif (v.view.style.visible) {\n\t\t\t\t// TODO: this won't work on native\n\t\t\t\tv.index = v.view.style.__sortKey;\n\n\t\t\t\t++n;\n\t\t\t}\n\t\t}\n\n\t\tif (!n) { return; }\n\n\t\tthis._views.sort();\n\n\t\tif (DEBUG) {\n\t\t\tvar uid = this._view.uid;\n\t\t\t// _debug.views[uid] = +new Date();\n\t\t}\n\n\t\tvar layoutStyle = this._view.style;\n\t\tif (layoutStyle.direction != this._direction) {\n\t\t\tthis.setDirection(layoutStyle.direction);\n\t\t}\n\n\t\tvar scale = this._view.getPosition().scale;\n\n\t\tvar isVertical = this._direction == 'vertical';\n\t\tvar propDim = this._propDim;\n\t\tvar propDimOpp = this._propDimOpp;\n\t\tvar minPropDim = this._minPropDim;\n\t\tvar propA = this._propSideA;\n\t\tvar propB = this._propSideB;\n\t\tvar padding = layoutStyle.padding;\n\t\tvar paddingSum = padding && (isVertical ? padding.getVertical() : padding.getHorizontal()) || 0;\n\t\tvar parentDim = layoutStyle[propDim];\n\t\tvar views = this._views;\n\n\t\tthis._debug && logger.log('reflow() view', uid + ':', views.length, 'subview(s)');\n\n\t\t// compute the total size of the fixed views and count\n\t\t// how many dynamically sized views we have\n\t\tvar sum = 0;\n\t\tvar flexSum = 0;\n\t\tvar paddingOpp = padding && (isVertical ? padding.getHorizontal() : padding.getVertical()) || 0;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tvar s = v.view.style;\n\t\t\tif (!s.visible) { continue; }\n\n\t\t\tv.margins = (s[propA] || 0) + (s[propB] || 0);\n\n\t\t\tif (isVertical && s.layoutHeight && s.layoutHeight.charAt(s.layoutHeight.length-1) == '%') {\n\t\t\t\tsum += parentDim * parseFloat(s.layoutHeight) / 100;\n\t\t\t} else if (!isVertical && s.layoutWidth && s.layoutWidth.charAt(s.layoutWidth.length-1) == '%') {\n\t\t\t\tsum += parentDim * parseFloat(s.layoutWidth) / 100;\n\t\t\t} else if (s.flex) {\n\t\t\t\tflexSum += s.flex;\n\t\t\t\tv.baseSize = s[minPropDim] || 0;\n\t\t\t\tsum += v.baseSize;\n\t\t\t} else {\n\t\t\t\tsum += (s[propDim] || 0) * s.scale + v.margins;\n\t\t\t}\n\n\t\t\t// LinearViews should reflow the opposite direction\n\t\t\tif (padding) {\n\t\t\t\ts.x = padding.left;\n\t\t\t\ts.y = padding.top;\n\t\t\t}\n\t\t}\n\t\tthis._view._flexSum = flexSum;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tBoxLayout.reflowX(v.view, layoutStyle.width, padding);\n\t\t\tBoxLayout.reflowY(v.view, layoutStyle.height, padding);\n\t\t}\n\n\t\tif (flexSum && parentDim == undefined) { return; }\n\n\t\t// compute available space\n\t\tvar availableSpace = parentDim - paddingSum;\n\t\tif (availableSpace < 0) { return; }\n\n\t\t// if there's a flex subview or (?), the total size is the availableSpace\n\t\t// otherwise the totalSize is the sum of the subview sizes\n\t\tvar justifyContent = layoutStyle.justifyContent;\n\t\tvar totalSize = (flexSum || justifyContent != 'start' ? availableSpace : sum) + paddingSum;\n\t\tvar flexSize = availableSpace - sum;\n\n\t\t//\n\t\tvar layoutDim = isVertical ? 'layoutHeight' : 'layoutWidth';\n\t\tif (!flexSum && layoutStyle[layoutDim] == 'wrapContent') {\n\t\t\tthis._debug && logger.log('  view', uid, '(sizing to fit)', propDim, '=', totalSize + 'px', '(' + paddingSum + 'px padding)');\n\t\t\tlayoutStyle[propDim] = totalSize;\n\t\t}\n\n\t\t// compute the space for each flexible view\n\t\tvar flexUsed = 0;\n\t\tvar balance = 0;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tvar s = v.view.style;\n\t\t\tif (!s.visible) { continue; }\n\n\t\t\tif (s.flex) {\n\t\t\t\t// compute the ideal space for the flex view\n\t\t\t\tvar idealSpace = v.baseSize + flexSize * (s.flex / flexSum) / s.scale + balance;\n\n\t\t\t\t// round to the nearest screen pixel (take into account the global scale of the layout view)\n\t\t\t\tvar roundedSpace = Math.round(idealSpace / scale) * scale;\n\n\t\t\t\t// propogate the balance into the next view space computation\n\t\t\t\tbalance = idealSpace - roundedSpace;\n\n\t\t\t\t// store the actual space for the view, which is the computed space minus the margins\n\t\t\t\tv.dim = roundedSpace - v.margins;\n\n\t\t\t\t// account for maximal bound\n\t\t\t\tif (v.dim > s[this._maxPropDim]) {\n\t\t\t\t\tv.dim = s[this._maxPropDim];\n\t\t\t\t}\n\n\t\t\t\t// keep track of used flex space\n\t\t\t\tflexUsed += roundedSpace;\n\t\t\t}\n\t\t}\n\n\t\tvar flexRemaining = flexSize - flexUsed;\n\n\t\t// set the position of the views\n\t\tvar pos = padding && padding[propA] || 0;\n\t\tvar gap = 0;\n\t\tif (flexRemaining > 0) {\n\t\t\t// there's unused space, so justify our views\n\t\t\tswitch (justifyContent) {\n\t\t\t\tcase 'end':\n\t\t\t\t\tpos += flexRemaining;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'center':\n\t\t\t\t\tpos += flexRemaining / 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'space':\n\t\t\t\t\tgap = flexRemaining / (n - 1) || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'space-outside':\n\t\t\t\t\tgap = flexRemaining / (n + 1) || 0;\n\t\t\t\t\tpos += gap;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'start':\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// position and size views!\n\t\tvar propPos = this._propPos;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tvar s = v.view.style;\n\t\t\tif (!s.visible) { continue; }\n\n\t\t\t// set position\n\t\t\ts[propPos] = pos + (s[propA] || 0);\n\n\t\t\tthis._debug && logger.log('  view', uid, 'layout subview', v.view.uid, propPos, '=', s[propPos]);\n\n\t\t\tif (s.flex) {\n\t\t\t\t// set width\n\t\t\t\ts[propDim] = v.dim;\n\t\t\t\tif (s.aspectRatio) {\n\t\t\t\t\ts.enforceAspectRatio()\n\t\t\t\t}\n\n\t\t\t\tthis._debug && logger.log('  view', uid, 'layout subview', v.view.uid, propDim, '=', s[propDim]);\n\t\t\t}\n\n\t\t\t// advance position\n\t\t\tpos += gap + (s[propDim] || 0) * s.scale + v.margins;\n\t\t}\n\n\t\tif (this._size != totalSize) {\n\t\t\tthis._size = totalSize;\n\t\t\tthis._view.publish('LayoutResize', totalSize);\n\t\t}\n\t};\n});\n\n","pre":true},"sdk/gc/native/common.js":{"path":"sdk/gc/native/common.js","friendlyPath":".common","directory":"sdk/gc/native/","filename":"common.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports.install = function (TeaLeaf, hostname) {\n    logger.log('installing native support');\n\n\tjsio(\"import device\");\n\tjsio(\"import lib.PubSub\");\n\tjsio(\"import .Window\");\n\tjsio(\"import .Document\");\n\tjsio(\"import .localStorage\");\n\tjsio(\"import .events\");\n\tjsio(\"import .launchInfo\");\n\tjsio(\"import .plugins\");\n\tjsio(\"import .screen\");\n\tjsio(\"import .Image\");\n\tImage.install();\n\tjsio(\"import .XMLHttpRequest\");\n\tXMLHttpRequest.install();\n\tjsio(\"import .Audio\");\n\tAudio.install();\n\n\tjsio(\"import platforms.native.Canvas\");\n\n\tif(NATIVE.device.native_info) {\n\t\tNATIVE.device.info = JSON.parse(NATIVE.device.native_info);\n\t}\n\n\tjsio(\"import .timestep\");\n\ttimestep.install();\n\n\t// publisher for the overlay UIWebView\n\tNATIVE.overlay.delegate = new lib.PubSub();\n\tCONFIG.splash = CONFIG.splash || {};\n\tvar oldHide = CONFIG.splash.hide || function () {};\n\tCONFIG.splash.hide = function (cb) {\n\t\tif (NATIVE.doneLoading instanceof Function) {\n\t\t\tNATIVE.doneLoading();\n\t\t}\n\n\t\tif (oldHide instanceof Function) {\n\t\t\toldHide();\n\t\t}\n\n\t\tcb && cb();\n\t};\n}\n","pre":true},"sdk/gc/native/Window.js":{"path":"sdk/gc/native/Window.js","friendlyPath":".Window","directory":"sdk/gc/native/","filename":"Window.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\"use import\";\n\njsio(\"import lib.PubSub\");\n\nvar _evts = new lib.PubSub();\n\nwindow.open = window.open || window.setLocation;\n\nwindow.addEventListener = function (evtName, cb, isBubble) {\n\t_evts.subscribe(evtName, window, cb);\n}\n\nwindow.removeEventListener = function (evtName, cb, isBubble) {\n\t_evts.unsubscribe(evtName, window, cb);\n}\n\nwindow.__fireEvent = function (name, evt) {\n\tif (!evt) { evt = {}; }\n\tevt.type = name;\n\t_evts.publish(name, evt);\n}\n","pre":true},"sdk/gc/native/Document.js":{"path":"sdk/gc/native/Document.js","friendlyPath":".Document","directory":"sdk/gc/native/","filename":"Document.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nif (typeof document == 'undefined') {\n\tGLOBAL.document = {};\n}\n\nif (!document.createElement) {\n\tvar handlers = {};\n\t\n\tdocument.createElement = function (type) {\n\t\ttype = type.toUpperCase(); \n\t\tif (type in handlers) {\n\t\t\treturn handlers[type]();\n\t\t}\n\t}\n\t\n\tdocument.__registerCreateElementHandler = function (type, cb) {\n\t\ttype = type.toUpperCase();\n\t\thandlers[type] = cb;\n\t}\n}\n","pre":true},"sdk/gc/native/localStorage.js":{"path":"sdk/gc/native/localStorage.js","friendlyPath":".localStorage","directory":"sdk/gc/native/","filename":"localStorage.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/*\njsio(\"import device\");\n\nif (device.isIOS && GLOBAL.Proxy) {\n\tvar _ls = {\n\t\tlength: 0,\n\t\tgetItem: NATIVE.localStorage.getItem,\n\t\tsetItem:function (key, value) {logger.log('setting item', value, 'for key', key); NATIVE.localStorage.setItem(key, value.toString()); },\n\t\tremoveItem: NATIVE.localStorage.removeItem,\n\t\tclear: NATIVE.localStorage.clear,\n\t\tkey: NATIVE.localStorage.key\n\t};\n\n\tvar localStorageHandler = {\n\t\tget: function (proxy, name) {\n\t\t\treturn _ls[name] || NATIVE.localStorage.getItem(name); \n\t\t},\n\t\tset: function (proxy, name, value) {\n\t\t\tif (NATIVE.localStorage.setItem(name, value.toString())) {\n\t\t\t\t_ls.length++;\n\t\t\t}\n\t\t}\n\t};\n\n\tif (typeof localStorage == 'undefined') {\n\t\tGLOBAL.localStorage = Proxy.create(localStorageHandler);\n\t}\n} else {*/\n\tGLOBAL.localStorage = {\n\t\tsetItem: function (key, value) { NATIVE.localStorage.setItem(key.toString(), value.toString()); },\n\t\tgetItem: function (key) { return NATIVE.localStorage.getItem(key.toString() || null); },\n\t\tremoveItem: function (key) { NATIVE.localStorage.removeItem(key.toString()); },\n\t\tclear: function () { NATIVE.localStorage.clear(); },\n\t\tkey: function () { logger.log('ERROR: localStorage.key() unimplemented'); return null }\n\t};\n//}\n","pre":true},"sdk/gc/native/events.js":{"path":"sdk/gc/native/events.js","friendlyPath":".events","directory":"sdk/gc/native/","filename":"events.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nhandlers = {};\n\nNATIVE.events = {};\nNATIVE.events.registerHandler = function (name, handler) {\n\thandlers[name] = handler;\n}\n\nNATIVE.events.dispatchEvent = function (evt) {\n\tvar e = evt;\n\tif (typeof e == 'string') {\n\t\te = JSON.parse(e);\n\t}\n\n\tvar handler = handlers[e.name];\n\tif (handler) {\n\t\thandler(e);\n\t}\n}\n\njsio('import .input');\njsio('import .plugins');\njsio('import .overlay');\njsio('import .purchase');\njsio('import .pauseResume');\njsio('import .offscreenBuffer');\njsio('import .dialog');\njsio('import .log');\njsio('import .imageLoading');\njsio('import .soundLoading');\njsio('import .backButton');\njsio('import .online');\njsio('import .inputPrompt');\njsio('import .rotation');\n","pre":true},"sdk/gc/native/input.js":{"path":"sdk/gc/native/input.js","friendlyPath":".input","directory":"sdk/gc/native/","filename":"input.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar inputQueue = [];\n\nif (NATIVE.events.setResponder) {\n\tNATIVE.events.setResponder(inputQueue);\n}\n\nNATIVE.input.getTouchEvents = function () {\n\treturn inputQueue.splice(0, inputQueue.length);\n}\n","pre":true},"sdk/gc/native/plugins.js":{"path":"sdk/gc/native/plugins.js","friendlyPath":".plugins","directory":"sdk/gc/native/","filename":"plugins.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.Callback\");\njsio(\"import lib.PubSub\");\n\nvar pluginsPubSub = new lib.PubSub();\nNATIVE.plugins.publish = bind(pluginsPubSub, 'publish');\nNATIVE.plugins.subscribe = bind(pluginsPubSub, 'subscribe');\nNATIVE.plugins.subscribeOnce = bind(pluginsPubSub, 'subscribeOnce');\nNATIVE.plugins.unsubscribe = bind(pluginsPubSub, 'unsubscribe');\n\nNATIVE.events.registerHandler('plugins', function (evt) {\n\tNATIVE.plugins.publish('Plugins', evt.data);\n});\n","pre":true},"sdk/gc/native/overlay.js":{"path":"sdk/gc/native/overlay.js","friendlyPath":".overlay","directory":"sdk/gc/native/","filename":"overlay.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('overlay', function (evt) {\n\tif (NATIVE.overlay.delegate) {\n\t\tif (NATIVE.overlay.delegate.publish instanceof Function) {\n\t\t\tNATIVE.overlay.delegate.publish('message', evt.event);\n\t\t}\n\t}\n});\n","pre":true},"sdk/gc/native/purchase.js":{"path":"sdk/gc/native/purchase.js","friendlyPath":".purchase","directory":"sdk/gc/native/","filename":"purchase.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('purchase', function (evt) {\n\tvar state = evt.state,\n\t\tproduct = evt.product,\n\t\torder = evt.order,\n\t\tnotifyId = evt.notifyId;\n\tif (NATIVE.purchase.onResult(state, product, order)) {\n\t\tNATIVE.purchase.confirmPurchase(notifyId);\n\t}\n});\n","pre":true},"sdk/gc/native/pauseResume.js":{"path":"sdk/gc/native/pauseResume.js","friendlyPath":".pauseResume","directory":"sdk/gc/native/","filename":"pauseResume.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('pause', bind(window, '__fireEvent', 'pagehide'));\n\nNATIVE.events.registerHandler('resume', function () {\n\t// reset any cached loading events\n\tjsio(\"import ui.resource.Image as Image\");\n\tif (Image.__clearCache__) {\n\t\tImage.__clearCache__();\n\t}\n\n\twindow.__fireEvent('pageshow');\n});\n","pre":true},"sdk/gc/native/offscreenBuffer.js":{"path":"sdk/gc/native/offscreenBuffer.js","friendlyPath":".offscreenBuffer","directory":"sdk/gc/native/","filename":"offscreenBuffer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('redrawOffscreenBuffers', bind(window, '__fireEvent', 'redrawOffscreenBuffers'));\n","pre":true},"sdk/gc/native/dialog.js":{"path":"sdk/gc/native/dialog.js","friendlyPath":".dialog","directory":"sdk/gc/native/","filename":"dialog.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\"use import\";\n\nvar dialogId = 0;\nvar dialogCallbacks = {};\n\nNATIVE.dialogs.showDialog = function (title, text, image, buttons) {\n\tvar labels = [], callbacks = [], cbs = [];\n\tvar len = buttons.length;\n\tfor(var i = 0; i < len; i++) {\n\t\tlabels[i] = buttons[i].label;\n\t\tcallbacks[i] = buttons[i].callback;\n\t}\n\tfor(var i = 0; i < len; i++) {\n\t\tcbs[i] = dialogId;\n\t\tdialogCallbacks[dialogId] = callbacks[i];\n\t\tdialogId++;\n\t}\n\tNATIVE.dialogs._showDialog(title, text, image, labels, cbs);\n};\n\nNATIVE.dialogs.showUpdate = function (title, text, confirmLabel, denyLabel, image, callback) {\n\ttitle = title || CONFIG.title + ' has been updated!';\n\ttext = text || \"There's an update for \" + CONFIG.title + \"! Do you want to apply it?\";\n\tconfirmLabel = confirmLabel || 'OK';\n\tdenyLabel = denyLabel || 'Not now';\n\tvar ok = { label: confirmLabel, callback: function () { callback(); } };\n\tvar notnow = { label: denyLabel, callback: function () {} };\n\tNATIVE.dialogs.showDialog(title, text, image, [ok, notnow]);\n};\n\n\nNATIVE.dialogs.showCrossPromo = function (appID, displayName, image) {\n\tvar title = \"Try \" + displayName + \"!\";\n\tvar msg = \"We noticed you've enjoyed \" + CONFIG.title + \" and we think you might enjoy \" + displayName + \". Do you want to try it?\";\n\timage = image || null;\n\tvar sure = { label: 'Sure!', callback: function () { NATIVE.startGame(appID); } };\n\tvar nothanks = { label: 'Maybe layer', callback: function () { /* do nothing */ } };\n\tNATIVE.dialogs.showDialog(title, msg, image, [sure, nothanks]);\n};\n\nNATIVE.dialogs.showAppRater = function (title, text, image) {\n\ttitle = title || \"Rate \" + CONFIG.title;\n\ttext = text || \"It looks like you're enjoying \" + CONFIG.title + \". Please take a moment to rate it. Thanks!\";\n\tif (!image) {\n\t\tvar splash = CONFIG.splash;\n\t\timage = splash.landscape768;\n\t\tif (!image) image = splash.landscape1536;\n\t\tif (!image) image = splash.portrait480;\n\t\tif (!image) image = splash.portrait960;\n\t\tif (!image) image = splash.portrait1024;\n\t\tif (!image) image = splash.portrait1136;\n\t\tif (!image) image = splash.portrait2048;\n\t}\n\tvar rateme = { label: title, callback: function () { GLOBAL.setLocation(NATIVE.market.url); } };\n\tvar nothanks = { label: \"No thanks\", callback: function () {} };\n\tvar remindme = { label: \"Remind me later\", callback: function () {} };\n\tNATIVE.dialogs.showDialog(title, text, image, [rateme, remindme, nothanks]);\n};\n\nNATIVE.events.registerHandler('dialogButtonClicked', function (evt) {\n\tvar cb = dialogCallbacks[evt.id];\n\tif(cb && cb instanceof Function) {\n\t\tcb();\n\t\tdelete dialogCallbacks[evt.id];\n\t}\n});\n","pre":true},"sdk/gc/native/log.js":{"path":"sdk/gc/native/log.js","friendlyPath":".log","directory":"sdk/gc/native/","filename":"log.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('log', function (evt) {\n\tlogger.error(evt.message);\n});\n","pre":true},"sdk/gc/native/imageLoading.js":{"path":"sdk/gc/native/imageLoading.js","friendlyPath":".imageLoading","directory":"sdk/gc/native/","filename":"imageLoading.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar loadingImages = {};\n\nNATIVE.camera.getPicture = function (size, id) {\n\tsize = size || 64;\n\tid = id || NATIVE.camera.getNextId();\n\tvar src = '@CAMERA' + id + '-' + size;\n\tvar image = new Image();\n\timage.src = src;\n\treturn image;\n};\n\nNATIVE.gallery.choosePicture = function (size, id) {\n\tsize = size || 64;\n\tid = id || NATIVE.gallery.getNextId();\n\tvar src = '@GALLERYPHOTO' + id + '-' + size;\n\tvar image = new Image();\n\timage.src = src;\n\treturn image;\n};\n\nNATIVE.gl.loadImage = function (image) {\n\tvar texData = NATIVE.gl._loadImage(image._src);\n\tif (texData) {\n\t\tsetTimeout(function () {\n\t\t\timage._onload(texData.width, texData.height, texData.name);\n\t\t}, 0);\n\t} else {\n\t\tif (!loadingImages[image._src]) {\n\t\t\tloadingImages[image._src] = [];\n\t\t}\n\t\tloadingImages[image._src].push(image);\n\t}\n}\n\nNATIVE.events.registerHandler('imageLoaded', function (evt) {\n\n\tvar logURL = evt.url;\n\tif (logURL.substring(0, 11) == 'data:image/') {\n\t\tlogURL = '<base64>';\n\t}\n\n\tlogger.debug('imageLoaded:', logURL, evt.originalWidth + 'x' + evt.originalHeight, '(' + evt.width + 'x' + evt.height + ')');\n\n\tvar images = loadingImages[evt.url];\n\tdelete loadingImages[evt.url];\n\n\tif (images) { \n\t\timages.forEach(function (image) { \n\t\t\timage._onload(evt.originalWidth, evt.originalHeight, evt.glName);\n\t\t\tGLOBAL.GC && GC.app && GC.app.engine && GC.app.engine.needsRepaint();\n\t\t});\n\t}\n});\n\nNATIVE.events.registerHandler('imageError', function (evt) {\n\tvar images = loadingImages[evt.url];\n\tif (images) {\n\t\timages.forEach(function (image) {\n\t\t\tif (image._onerror) {\n\t\t\t\timage._onerror();\n\t\t\t}\n\t\t});\n\t\tdelete images[evt.url];\n\t}\n});\n","pre":true},"sdk/gc/native/soundLoading.js":{"path":"sdk/gc/native/soundLoading.js","friendlyPath":".soundLoading","directory":"sdk/gc/native/","filename":"soundLoading.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler('soundLoaded', function (evt) {\n\tlogger.log('sound loaded with url', evt.url);\n\tvar loadedSound = sounds[evt.url];\n\tif (loadedSound && !loadedSound.complete) {\n\t\tloadedSound.complete = true;\n\t\tloadedSound.onload();\n\t\tdelete sounds[evt.url];\n\t}\n});\n\n\nNATIVE.events.registerHandler('soundError', function (evt) {\n\tlogger.log('sound with url', evt.url, 'failed to load');\n\tvar failedSound = sounds[evt.url];\n\tif (failedSound) {\n\t\tfailedSound.onerror();\n\t}\n});\n\nNATIVE.events.registerHandler('soundDuration', function (evt) {\n\tlogger.log('sound with url', evt.url, 'is', evt.duration, 'seconds long');\n\tif (evt.url in songs) {\n\t\tsongs[evt.url].duration = evt.duration;\n\t\tsongs[evt.url].durationMilliseconds = evt.duration * 1000;\n\t}\n});\n\nvar sounds = {};\nSound=__class__;var Sound=Sound(function Sound(){return this.init&&this.init.apply(this,arguments)},function (supr) {\n\tthis.init = function (opts) {\n\t\tthis.src = opts.src || null;\n\t\tthis.complete = opts.complete || null;\n\t}\n\n\tthis.onload = this.onerror = function () {}\n});\nNATIVE.sound.preloadSound = function (url) {\n\tNATIVE.sound.loadSound(url);\n\tsounds[url] = new Sound({\n\t\tsrc: url,\n\t\tcomplete: false,\n\t});\n\treturn sounds[url];\n}\n\nvar songs = {};\nNATIVE.sound.registerMusic = function (url, sound) {\n\tsongs[url] = sound;\n}","pre":true},"sdk/gc/native/backButton.js":{"path":"sdk/gc/native/backButton.js","friendlyPath":".backButton","directory":"sdk/gc/native/","filename":"backButton.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.PubSub\");\n\nNATIVE.backButton = new lib.PubSub();\n\n/**\n * Register back button event. Calls NATIVE.onBackButton, and\n * sends game activity to the back unless NATIVE.onBackButton\n * returns true.\n */\nNATIVE.events.registerHandler('backButton', function (evt) {\n\tif (NATIVE.onBackButton) {\n\t\tvar result = NATIVE.onBackButton();\n\t\t\n\t\tlogger.log('back button pushed');\n\n\t\tif ( result === false && typeof NATIVE.sendActivityToBack === 'function' ) {\n\t\t\tNATIVE.sendActivityToBack();\n\t\t}\n\t} else {\n\t\tNATIVE.backButton.emit('pressed');\n\t}\n});\n","pre":true},"sdk/gc/native/online.js":{"path":"sdk/gc/native/online.js","friendlyPath":".online","directory":"sdk/gc/native/","filename":"online.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.events.registerHandler(\"networkStatus\", function (evt) {\n\t// evt.type is either \"online\" or \"offline\"\n\twindow.__fireEvent(evt.type, evt);\n});\n","pre":true},"sdk/gc/native/inputPrompt.js":{"path":"sdk/gc/native/inputPrompt.js","friendlyPath":".inputPrompt","directory":"sdk/gc/native/","filename":"inputPrompt.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.PubSub\");\n\nmerge(NATIVE.input, lib.PubSub.prototype);\n\nconsole.log(NATIVE.input, NATIVE.input.openPrompt);\n\nNATIVE.events.registerHandler('InputKeyboardSubmit', function (evt) {\n\tNATIVE.input.publish('Submit', evt);\n});\n\nNATIVE.events.registerHandler('InputKeyboardCancel', function (evt) {\n\tNATIVE.input.publish('Cancel', evt);\n});\n\nNATIVE.events.registerHandler('InputKeyboardKeyUp', function (evt) {\n    NATIVE.input.publish('KeyUp', evt);\n});\n\nNATIVE.events.registerHandler('InputKeyboardFocusNext', function (evt) {\n    NATIVE.input.publish('FocusNext', evt);\n});\n\nNATIVE.events.registerHandler('keyboardScreenResize', bind(window, '__fireEvent', 'keyboardScreenResize'));\n","pre":true},"sdk/gc/native/rotation.js":{"path":"sdk/gc/native/rotation.js","friendlyPath":".rotation","directory":"sdk/gc/native/","filename":"rotation.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * Does nothing by default.\n */\nNATIVE.onRotation = function () {};\n\n\n/**\n * Register rotation event. Calls NATIVE.onRotation.\n */\nNATIVE.events.registerHandler('rotate', function (evt) {\n\tNATIVE.onRotation(evt);\n});\n","pre":true},"sdk/gc/native/launchInfo.js":{"path":"sdk/gc/native/launchInfo.js","friendlyPath":".launchInfo","directory":"sdk/gc/native/","filename":"launchInfo.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nNATIVE.launch = {};\n\nNATIVE.events.registerHandler('launchType', function (evt) {\n\tNATIVE.launch.type = evt.type;\n\tNATIVE.launch.data = evt.data || null;\n});\n","pre":true},"sdk/gc/native/screen.js":{"path":"sdk/gc/native/screen.js","friendlyPath":".screen","directory":"sdk/gc/native/","filename":"screen.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import device\");\n\nNATIVE.screen.onResize = function (width, height) {\n\tlogger.log('native screen resize', width, height);\n\twindow.screen.width = width;\n\twindow.screen.height= height;\n\tdevice.screen.publish('Resize', width, height);\n\tif (width > height) {\n\t\tdevice.screen.isPortrait = false;\n\t\tdevice.screen.isLandscape = true;\n\t\tdevice.screen.orientation = 'landscape';\n\t} else {\n\t\tdevice.screen.isPortrait = true;\n\t\tdevice.screen.isLandscape = false;\n\t\tdevice.screen.orientation = 'portrait';\n\t}\n\tdevice.screen.width = width;\n\tdevice.screen.height = height;\n\tdevice.width = width;\n\tdevice.height = height;\n\t\n\tdevice.screen.publish('Resize', width, height);\n\tlogger.log('onResize', JSON.stringify(device.screen));\n}\n","pre":true},"sdk/gc/native/Image.js":{"path":"sdk/gc/native/Image.js","friendlyPath":".Image","directory":"sdk/gc/native/","filename":"Image.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.PubSub\");\njsio(\"import util.setProperty\");\n\nvar sdk_gc_native_Image=__class__;var Image = exports=sdk_gc_native_Image(function sdk_gc_native_Image(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\n\tthis.init = function (src, width, height, glname) {\n\t\tthis._src = src || \"\";\n\t\tthis.width = width || undefined;\n\t\tthis.height = height || undefined;\n\t\tthis.__gl_name = glname || undefined;\n\t\tthis.complete = false;\n\t\tthis._fireReload = false;\n\t}\n\n\tutil.setProperty(this, 'src', {\n\t\tset: function (value) {\n\t\t\tif (!value) {\n\t\t\t\tlogger.error('empty src set on an image!');\n\t\t\t\tthis._onerror();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._src = value;\n\t\t\tNATIVE.gl.loadImage(this);\n\t\t}\n\t});\n\n\tthis._onload = function (width, height, gl_name) {\n\t\tlogger.log('onload called with', width, height, gl_name);\n\t\tthis.complete = true;\n\t\tthis.width = this.originalWidth = width;\n\t\tthis.height = this.originalHeight = height;\n\t\tthis.__gl_name = gl_name;\n\t\tif (!this._fireReload) {\n\t\t\tthis._fireReload = true;\n\t\t\tthis.onload && this.onload();\n\t\t\tthis.publish('load', {type: 'load'});\n\t\t} else {\n\t\t\tthis.onreload && this.onreload();\n\t\t\tthis.publish('reload', {type: 'reload'});\n\t\t}\n\t}\n\n\tthis._onerror = function () {\n\t\tthis.onerror();\n\t\tthis.publish('error', {type: 'error'});\n\t}\n\n\tthis.reload = function () {\n\t\tthis._fireReload = true;\n\t\tNATIVE.gl.loadImage(this);\n\t}\n\n\tthis.destroy = function () {\n\t\tif (this.__gl_name) {\n\t\t\tNATIVE.gl.deleteTexture(this.__gl_name);\n\t\t}\n\t}\n\n\tthis.addEventListener = function (type, callback, useCapture) { this.subscribe(type, this, callback); }\n\tthis.removeEventListener = function (type, callback, useCapture) { this.unsubscribe(type, this, callback); }\n\n\tthis.onload = this.onerror = this.onreload = function () {}\n});\n\n\nexports.install = function () {\n\tGLOBAL.Image = Image;\n}\n","pre":true},"sdk/gc/native/XMLHttpRequest.js":{"path":"sdk/gc/native/XMLHttpRequest.js","friendlyPath":".XMLHttpRequest","directory":"sdk/gc/native/","filename":"XMLHttpRequest.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nXMLHttpRequest=__class__;var XMLHttpRequest=XMLHttpRequest(function XMLHttpRequest(){return this.init&&this.init.apply(this,arguments)},function () {\n\tvar state = {\n\t\t\"UNSENT\": 0,\n\t\t\"OPENED\": 1,\n\t\t\"HEADERS_RECEIVED\": 2,\n\t\t\"LOADING\": 3,\n\t\t\"DONE\": 4\n\t};\n\tthis.init = function () {\n\t\tthis.readyState = state.UNSENT;\n\t\tthis.responseText = null;\n\t\tthis._requestHeaders = {};\n\t\tthis.__id = id;\n\t}\n\n\tthis.open = function (method, url, async) {\n\t\tthis._method = method;\n\t\tthis._url = '' + url;\n\t\tthis._async = async || false;\n\t\tthis.readyState = state.OPENED;\n\t\tthis.status = 0;\n\n\t\tif (!this._async) {\n\t\t\tlogger.warn(\"synchronous xhrs not supported\");\n\t\t}\n\t}\n\n\tthis.getResponseHeader = function (name) { return this._responseHeaders[name]; }\n\n\tthis.getAllResponseHeaders = function () { return this._responseHeaders; }\n\t\n\tthis.setRequestHeader = function (name, value) {\n\t\tthis._requestHeaders[name] = value;\n\t}\n\n\tthis.send = function (data) {\n\t\tthis._data = data || \"\";\n\t\txhrs[id++] = this;\n\t\tNATIVE.xhr.send(this._method, this._url, this._async, this._data, 0, this.__id, this._requestHeaders);\n\t}\n\n\tthis.uploadFile = function (filename) {\n\t\tthis._filename = filename;\n\t\txhrs[id++] = this;\n\t\tNATIVE.xhr.uploadFile(this.__id, this._filename, this._url, this._async, this._requestHeaders);\n\t}\n\n\tthis._onreadystatechange = function (state, status, response) {\n\t\tthis.readyState = state;\n\t\tthis.status = status;\n\t\tthis.responseText = response || null;\n        this.response = response || null;\n\t\tif (typeof this.onreadystatechange === 'function') {\n\t\t\tthis.onreadystatechange();\n\t\t}\n\t}\n\n\tthis.onreadystatechange = function () {}\n});\n\nvar xhrs = {};\nvar id = 0;\n\nexports.install = function () {\n\tGLOBAL.XMLHttpRequest = XMLHttpRequest;\n\tNATIVE.events.registerHandler('xhr', function (evt) {\n\t\tvar xhr = xhrs[evt.id];\n\t\tif (xhr) {\n\t\t\tvar headers = {};\n\t\t\tfor(var i = 0, len = evt.headerKeys.length; i < len; i++) {\n\t\t\t\theaders[evt.headerKeys[i]] = evt.headerValues[i];\n\t\t\t}\n\t\t\txhr._responseHeaders = headers;\n\t\t\txhr._onreadystatechange(evt.state, evt.status, evt.response);\n\t\t}\n\t\tdelete xhrs[evt.id];\n\t});\n\n}\n","pre":true},"sdk/gc/native/Audio.js":{"path":"sdk/gc/native/Audio.js","friendlyPath":".Audio","directory":"sdk/gc/native/","filename":"Audio.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar lastbg;\n\nvar sdk_gc_native_Audio=__class__;var Audio = exports=sdk_gc_native_Audio(function sdk_gc_native_Audio(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function (url) {\n\t\tthis._startedLoad = false;\n\t\tthis._src = \"\";\n\t\tthis.autoplay = false;\n\t\tthis.preload = \"auto\";\n\t\tthis._volume = 1;\n\t\tthis.loop = false;\n\t\tthis._startTime = 0;\n\t\tthis._et = 0;\n\t\tthis.readyState = 4;\n\t\tif (url) {\n\t\t\tthis.src = url;\n\t\t}\n\t};\n\n\tthis._updateElapsed = function () {\n\t\tif (this._startTime > 0) {\n\t\t\tvar now = Date.now();\n\t\t\tthis._et += (now - this._startTime);\n\t\t\tvar dur = this.durationMilliseconds;\n\t\t\tif (this.loop && !isNaN(dur) && this._et > dur) {\n\t\t\t\tthis._et %= dur;\n\t\t\t}\n\t\t\tthis._startTime = now;\n\t\t}\n\t};\n\n\tthis.__defineSetter__(\"src\", function (url) {\n\t\tlogger.log(\"audio source is \", url);\n\t\tthis._src = url;\n\n\t\t// wait one frame in case preload gets set\n\t\tsetTimeout(bind(this, function () {\n\t\t\tif ((this.autoplay || this.preload == \"auto\") && !this.isBackgroundMusic) {\n\t\t\t\tthis.load();\n\t\t\t}\n\n\t\t\tif (this.autoplay) {\n\t\t\t\tthis.play();\n\t\t\t}\n\t\t}), 0);\n\t});\n\n\tthis.__defineGetter__(\"src\", function () {\n\t\treturn this._src;\n\t});\n\n\tthis.__defineSetter__(\"volume\", function (volume) {\n\t\tthis._volume = volume;\n\t\tif (!this.isBackgroundMusic || this == lastbg) {\n\t\t\tNATIVE.sound.setVolume(this._src, volume);\n\t\t}\n\t});\n\n\tthis.__defineGetter__(\"currentTime\", function () {\n\t\tthis._updateElapsed();\n\t\treturn this._et / 1000;\n\t});\n\n\tthis.__defineSetter__(\"currentTime\", function (t) {\n\t\tthis._et = t * 1000;\n\t\tthis._startTime = Date.now();\n\t\tif (this == lastbg) {\n\t\t\tNATIVE.sound.seekTo(this._src, t);\n\t\t}\n\t});\n\n\tthis.canPlayType = function (type) {\n\t\treturn true;\n\t};\n\n\tthis.load = function (thenPlay) {\n\t\tif (this.isBackgroundMusic) {\n\t\t\t// Background music should not be preloaded like normal sounds\n\t\t\treturn;\n\t\t}\n\t\tvar s = NATIVE.sound.preloadSound(this._src);\n\t\tif (thenPlay) {\n\t\t\ts.onload = bind(this, '_play');\n\t\t}\n\t\tthis._startedLoad = true;\n\t};\n\n\tthis._play = function () {\n\t\tNATIVE.sound.playSound(\n\t\t\tthis._src,\n\t\t\tthis._volume,\n\t\t\t(this.loop === \"loop\" || this.loop === true)\n\t\t);\n\t\tthis._startTime = Date.now();\n\t};\n\n\tthis.play = function () {\n\t\tthis.paused = false;\n\t\tif (this.isBackgroundMusic) {\n\t\t\tlastbg = this;\n\t\t\tthis._startedLoad = true;\n\t\t\tthis._startTime = Date.now();\n\t\t\tNATIVE.sound.playBackgroundMusic(this._src, this._volume, this.loop);\n\t\t} else if (!this._startedLoad) {\n\t\t\tthis.load(true);\n\t\t} else {\n\t\t\tthis._play();\n\t\t}\n\t};\n\n\tthis.pause = function () {\n\t\tif (this.paused) { return; }\n\t\tthis.paused = true;\n\n\t\tif (this._startedLoad) {\n\t\t\tif (!this.isBackgroundMusic || this == lastbg) {\n\t\t\t\tNATIVE.sound.pauseSound(this._src);\n\t\t\t}\n\t\t\tthis._updateElapsed();\n\t\t\tthis._startTime = 0;\n\t\t}\n\t};\n\n\tthis.stop = function () {\n\t\tif (this._startedLoad) {\n\t\t\tif (!this.isBackgroundMusic || this == lastbg) {\n\t\t\t\tNATIVE.sound.stopSound(this._src);\n\t\t\t}\n\t\t}\n\n\t\tthis.reset();\n\t};\n\n\tthis.reset = function () {\n\t\tthis._et = 0;\n\t\tthis._startTime = 0;\n\t};\n\n\tthis.destroy = function () {\n\t\tif (this == lastbg) {\n\t\t\tlastbg = undefined;\n\t\t}\n\n\t\tNATIVE.sound.destroySound(this._src);\n\t}\n\n});\n\nexports.install = function () {\n\tGLOBAL.Audio = Audio;\n}\n","pre":true},"sdk/gc/native/timestep.js":{"path":"sdk/gc/native/timestep.js","friendlyPath":".timestep","directory":"sdk/gc/native/","filename":"timestep.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import device\");\n\nvar hasNativeViews = GLOBAL.NATIVE && NATIVE.timestep && NATIVE.timestep.View;\n\nvar VIEW_TYPES = {\n\tDEFAULT: 0,\n\tIMAGE_VIEW: 1\n};\n\nfunction installNativeView() {\n\t// extend the timestep View class\n\tjsio(\"import .timestep.NativeView\");\n\ttimestep.NativeView.install();\n\n\tjsio(\"import ui.View as View\");\n\tView.setDefaultViewBacking(NATIVE.timestep.View);\n\n\t// extend the timestep ViewBacking class\n\tjsio(\"import .timestep.NativeViewBacking\");\n\ttimestep.NativeViewBacking.install();\n\n\tjsio(\"import .timestep.NativeImageView\");\n\ttimestep.NativeImageView.install();\n\n\tvar animate = device.importUI('animate');\n\tanimate.setViewAnimator(NATIVE.timestep.Animator);\n\tmerge(NATIVE.timestep.Animator.prototype, {\n\t\tsubscribe: function () {},\n\t\tpause: function () {},\n\t\tresume: function () {},\n\t\t__finish: function () {},\n\t\t_isRunning: function () {}\n\t});\n\t\n\t// add some properties to View and ImageView to defer to native rendering\n\tjsio(\"import ui.View as View\");\n\tView.prototype.__type = VIEW_TYPES.DEFAULT;\n\n\tjsio(\"import ui.ImageView as ImageView\");\n\tImageView.prototype.__type = VIEW_TYPES.IMAGE_VIEW;\n\tImageView.prototype.render.HAS_NATIVE_IMPL = true;\n\n\tlogger.log(\"USING NATIVE VIEWS\");\n}\n\nlogger.log(typeof GLOBAL.CONFIG, GLOBAL.CONFIG && CONFIG.disableNativeViews);\n\nif (GLOBAL.CONFIG && CONFIG.disableNativeViews || !hasNativeViews) {\n\tlogger.log(\"USING JS VIEWS\");\n\texports.install = function () {};\n} else {\n\texports.install = installNativeView;\n}\n","pre":true},"sdk/gc/native/timestep/NativeView.js":{"path":"sdk/gc/native/timestep/NativeView.js","friendlyPath":".timestep.NativeView","directory":"sdk/gc/native/timestep/","filename":"NativeView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// monkey patch the View prototype (object composition)\n\njsio(\"from ui.filter import Filter\");\n\nexports.install = function () {\n\tjsio(\"import ui.View as View\");\n\n\tvar proto = View.prototype;\n\n\tproto.setFilter = function (filter) {\n\t\tthis.removeFilter();\n\t\tthis._filter = filter;\n\t\tfilter.setView(this);\n\t\tfilter.update();\n\t};\n\n\tproto.removeFilter = function () {\n\t\tif (this._filter) {\n\t\t\tthis._filter.removeView(this);\n\t\t\tthis._filter = null;\n\t\t\tthis.__view.filterType = 0;\n\t\t\tthis.__view.filterColor = 'rgba(0,0,0,0)';\n\t\t}\n\t};\n};\n","pre":true},"sdk/gc/native/timestep/NativeViewBacking.js":{"path":"sdk/gc/native/timestep/NativeViewBacking.js","friendlyPath":".timestep.NativeViewBacking","directory":"sdk/gc/native/timestep/","filename":"NativeViewBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// ensure that the ViewBacking update and copy methods\n// are present on the native View prototype\nexports.install = function () {\n\tjsio(\"import device\");\n\tjsio(\"import ui.backend.BaseBacking as BaseBacking\");\n\n\tvar ViewBacking = device.importUI('ViewBacking');\n\n\tvar proto = NATIVE.timestep.View.prototype;\n\t\n\tif (proto) {\n\n\t\tvar srcProto = ViewBacking.prototype;\n\n\t\tproto.__proto__ = BaseBacking.prototype;\n\n\t\tif (!proto.copy) {\n\t\t\tproto.copy = srcProto.copy;\n\t\t}\n\n\t\tif (!proto.localizePoint && proto.localizePt) {\n\t\t\tproto.localizePoint = proto.localizePt;\n\t\t}\n\t}\n};\n","pre":true},"sdk/gc/native/timestep/NativeImageView.js":{"path":"sdk/gc/native/timestep/NativeImageView.js","friendlyPath":".timestep.NativeImageView","directory":"sdk/gc/native/timestep/","filename":"NativeImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports.install = function () {\n\tjsio(\"import ui.ImageView as ImageView\");\n\n\tvar proto = ImageView.prototype;\n\tvar setImage = proto.setImage;\n\n\tproto.setImage = function (img, opts) {\n\t\tif (opts && opts.forceReload && typeof img == 'string') {\n\t\t\tNATIVE.gl.deleteTexture(img);\n\t\t}\n\t\tvar retVal = setImage.apply(this, arguments);\n\t\t\n\t\tif (this._img) {\n\t\t\tNATIVE.timestep.setImageOnImageView(this.__view, this._img.getMap());\n\t\t}\n\t\t\n\t\treturn retVal\n\t}\n}\n","pre":true},"sdk/timestep/ui/ImageView.js":{"path":"sdk/timestep/ui/ImageView.js","friendlyPath":"ui.ImageView","directory":"sdk/timestep/ui/","filename":"ImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ImageView;\n * Import the ImageView from the Canvas/DOM rendering backend.\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio(\"import device\");\nexports = device.importUI('ImageView');\n","pre":true},"sdk/gc/native/socketTransport.js":{"path":"sdk/gc/native/socketTransport.js","friendlyPath":".socketTransport","directory":"sdk/gc/native/","filename":"socketTransport.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import net.interfaces')\njsio('import .reader')\n\nfunction onError(opts) {\n\tlogger.log('SOCKET ERROR: ', JSON.stringify(opts));\n}\n\nvar sockets = {};\n\nNATIVE.events.registerHandler('socketOpened', function (evt) {\n\tvar socket = sockets[evt.id];\n\tif (socket) {\n\t\tsocket.onConnect();\n\t}\n\n});\nNATIVE.events.registerHandler('socketClosed', function (evt) {\n\tvar socket = sockets[evt.id];\n\tif (socket) {\n\t\tsocket.onClose();\n\t}\n\tdelete sockets[evt.id];\n});\n\nNATIVE.events.registerHandler('socketError', function (evt) {\n\tvar socket = sockets[evt.id];\n\tif (socket) {\n\t\tsocket.onError(evt.message);\n\t}\n});\n\nNATIVE.events.registerHandler('socketRead', function (evt) {\n\tvar socket = sockets[evt.id];\n\tif (socket) {\n\t\tsocket.reader.read(evt.data);\n\t}\n});\n\n\nexports.Transport=__class__;exports.Transport=exports.Transport(function exports_Transport(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Transport, function () {\n\tthis.init = function (socket) {\n\t\tthis._socket = socket;\n\t}\n\t\n\tthis.makeConnection = function (protocol) {\n\t\tthis._socket.onRead  = function (data) {\n\t\t\ttry { \n\t\t\t\tprotocol.dataReceived.apply(protocol, arguments); \n\t\t\t} catch (e) { \n\t\t\t\tlogger.log(e, e.stack, arguments[0])\n\t\t\t}\n\t\t};\n\n\t\tthis._socket.onError = bind(protocol, 'onError');\n\t\tthis._socket.onClose = bind(protocol, 'connectionLost');\n\t}\n\t\n\tthis.write = function (data) {\n\t\tthis._socket.send(data);\n\t}\n\n\tthis.loseConnection = function () {\n\t\tthis._socket.close();\n\t}\n});\n\n//TODO add timeout\n\nexports.Socket = function (host, port) {\n\tvar socket = new NATIVE.Socket(host, port);\n\tsocket.reader = new reader.Reader(bind(socket, 'onRead'));\n\tsockets[socket.__id] = socket;\n\treturn socket;\n}\n\nexports.Connector=__class__;exports.Connector=exports.Connector(function exports_Connector(){return this.init&&this.init.apply(this,arguments)},'ios.socket', net.interfaces.Connector, function () {\n\tthis.connect = function () {\n\t\tthis._state = net.interfaces.STATE.CONNECTING;\n\t\t\n\t\tvar host = this._opts.host,\n\t\t\tport = this._opts.port,\n\t\t\ttimeout = this._opts.connectTimeout,\n\t\t\tsocket = new exports.Socket(host, port, timeout);\n\t\t\n\t    logger.log('connecting to', host, port, timeout);\n\t\tsocket.onConnect = bind(this, 'onSocketConnect', socket);\n\t\tsocket.onError = bind(this, function (err) {\n\t\t\tlogger.error(err);\n\t\t\tthis.onDisconnect();\n\t\t});\n\t}\n\t\n\tthis.onSocketConnect = function (socket) {\n\t    logger.log('connected!')\n\t\tthis.onConnect(new exports.Transport(socket));\n\t}\n});\n\n","pre":true},"sdk/jsio/net/interfaces.js":{"path":"sdk/jsio/net/interfaces.js","friendlyPath":"net.interfaces","directory":"sdk/jsio/net/","filename":"interfaces.js","baseMod":"net","basePath":"sdk/jsio","src":"// Sort of like a twisted protocol\njsio('import net');\njsio('import lib.Enum as Enum');\n\nvar ctx = jsio.__env.global;\n\nexports.Protocol=__class__;exports.Protocol=exports.Protocol(function exports_Protocol(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.connectionMade = function(isReconnect) {}\n\tthis.dataReceived = function(data) {}\n\tthis.connectionLost = function(reason) {}\n\t\n\tthis._connectionMade = function() {\n\t\tthis._isConnected = true;\n\t\tthis.connectionMade.apply(this, arguments);\n\t}\n\n\tthis._connectionLost = function() {\n\t\tthis._isConnected = true;\n\t\tthis.connectionLost.apply(this, arguments);\n\t}\n\n\tthis._isConnected = false;\n\tthis.isConnected = function() {\n\t\treturn !!this._isConnected;\n\t}\n\t\n\t\n});\n\nexports.Client=__class__;exports.Client=exports.Client(function exports_Client(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(protocol) {\n\t\tthis._protocol = protocol;\n\t}\n\t\n\tthis.connect = function(transportName, opts) {\n\t\tthis._remote = new this._protocol();\n\t\tthis._remote._client = this;\n\t\tnet.connect(this._remote, transportName, opts);\n\t}\n});\n\n// Sort of like a twisted factory\nexports.Server=__class__;exports.Server=exports.Server(function exports_Server(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(protocolClass) {\n\t\tthis._protocolClass = protocolClass;\n\t}\n\n\tthis.buildProtocol = function() {\n\t\treturn new this._protocolClass();\n\t}\n\t\n\tthis.listen = function(how, port) {\n\t\treturn net.listen(this, how, port);\n\t}\n});\n\nexports.Transport=__class__;exports.Transport=exports.Transport(function exports_Transport(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis._encoding = 'plain'\n\tthis.write = function(data, encoding) {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n\tthis.getPeer = function() {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n\tthis.setEncoding = function(encoding) {\n\t\tthis._encoding = encoding;\n\t}\n\tthis.getEncoding = function() {\n\t\treturn this._encoding;\n\t}\n});\n\nexports.Listener=__class__;exports.Listener=exports.Listener(function exports_Listener(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(server, opts) {\n\t\tthis._server = server;\n\t\tthis._opts = opts || {};\n\t}\n\t\n\tthis.onConnect = function(transport) {\n\t\t//try {\n\t\t\tvar p = this._server.buildProtocol();\n\t\t\tp.transport = transport;\n\t\t\tp.server = this._server;\n\t\t\ttransport.protocol = p;\n\t\t\ttransport.makeConnection(p);\n\t\t\tp._connectionMade();\n\t\t//} catch(e) {\n\t\t//\tlogger.error(e);\n\t\t//}\n\t}\n\t\n\tthis.listen = function() { throw new Error('Abstract class'); }\n\tthis.stop = function() {}\n});\n\nexports.STATE = Enum('INITIAL', 'DISCONNECTED', 'CONNECTING', 'CONNECTED');\nexports.Connector=__class__;exports.Connector=exports.Connector(function exports_Connector(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(protocol, opts) {\n\t\tthis._protocol = protocol;\n\t\tthis._opts = opts;\n\t\tthis._state = exports.STATE.INITIAL;\n\t}\n\t\n\tthis.getState = function() { return this._state; }\n\t\n\tthis.onConnect = function(transport) {\n\t\tthis._state = exports.STATE.CONNECTED;\n\n\t\ttransport.makeConnection(this._protocol);\n\t\tthis._protocol.transport = transport;\n\t\ttry {\n\t\t\tthis._protocol._connectionMade();\n\t\t} catch(e) {\n\t\t\tthrow logger.error(e);\n\t\t}\n\t}\n\t\n\tthis.onDisconnect = function(err) {\n\t\tvar wasConnected = this._state == exports.STATE.CONNECTED;\n\t\tthis._state = exports.STATE.DISCONNECTED;\n\t\t\n\t\ttry {\n\t\t\tthis._protocol._connectionLost(err, wasConnected);\n\t\t} catch(e) {\n\t\t\tthrow logger.error(e);\n\t\t}\n\t}\n\t\n\tthis.getProtocol = function() { return this._protocol; }\n});\n","pre":true},"sdk/jsio/net.js":{"path":"sdk/jsio/net.js","friendlyPath":"net","directory":"sdk/jsio/","filename":"net.js","src":"jsio('import net.env');\njsio('import std.JSON as JSON');\n\nJSON.createGlobal(); // create the global JSON object if it doesn't already exist\n\n/**\n * @namespace\n */\n\nexports.listen = function(server, transportName, opts) {\n\tif (!transportName) {\n\t\tthrow logger.error('No transport provided for net.listen');\n\t}\n\t\n\tvar ctor = typeof transportName == 'string' ? net.env.getListener(transportName) : transportName,\n\t\tlistener = new ctor(server, opts);\n\n\tlistener.listen();\n\treturn listener;\n}\n\nexports.connect = function(protocolInstance, transportName, opts) {\n\tvar ctor = typeof transportName == 'string' ? net.env.getConnector(transportName) : transportName,\n\t\tconnector = new ctor(protocolInstance, opts);\n\tconnector.connect();\n\treturn connector;\n}\n\nexports.quickServer = function(protocolClass) {\n\tjsio('import net.interfaces');\n\treturn new net.interfaces.Server(protocolClass);\n}\n","pre":true},"sdk/jsio/net/env.js":{"path":"sdk/jsio/net/env.js","friendlyPath":"net.env","directory":"sdk/jsio/net/","filename":"env.js","src":"function getObj(objectName, transportName, envName) {\n\t\n\ttry {\n\t\tvar DYNAMIC_IMPORT_ENV = 'from .env.' + (envName || jsio.__env.name) + '.' + transportName + ' import ' + objectName + ' as result';\n\t\tjsio(DYNAMIC_IMPORT_ENV);\n\t} catch(e) {\n\t\tthrow logger.error('Invalid transport (', transportName, ') or environment (', envName, ')');\n\t}\n\treturn result;\n}\n\nexports.getListener = bind(this, getObj, 'Listener');\nexports.getConnector = bind(this, getObj, 'Connector');\n","pre":true},"sdk/jsio/std/JSON.js":{"path":"sdk/jsio/std/JSON.js","friendlyPath":"std.JSON","directory":"sdk/jsio/std/","filename":"JSON.js","src":"// Based on json2.js (version 2009-09-29) http://www.JSON.org/json2.js\n// exports createGlobal, stringify, parse, stringifyDate\n\n/**\n * if a global JSON object doesn't exist, create one\n */\nexports.createGlobal = function() {\n\tif(typeof JSON == 'undefined') { JSON = {}; }\n\tif(typeof JSON.stringify !== 'function') {\n\t\tJSON.stringify = exports.stringify;\n\t}\n\tif(typeof JSON.parse !== 'function') {\n\t\tJSON.parse = exports.parse;\n\t}\n};\n\n;(function() {\n\tvar cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n\t\tescapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n\t\tgap,\n\t\tindent,\n\t\tmeta = {\t// table of character substitutions\n\t\t\t'\\b': '\\\\b',\n\t\t\t'\\t': '\\\\t',\n\t\t\t'\\n': '\\\\n',\n\t\t\t'\\f': '\\\\f',\n\t\t\t'\\r': '\\\\r',\n\t\t\t'\"' : '\\\\\"',\n\t\t\t'\\\\': '\\\\\\\\'\n\t\t},\n\t\trep;\n\t\n\tfunction quote(string) {\n\t\t// quote the string if it doesn't contain control characters, quote characters, and backslash characters\n\t\t// otherwise, replace those characters with safe escape sequences\n\t\tescapable.lastIndex = 0;\n\t\treturn escapable.test(string)\n\t\t\t? '\"' + string.replace(escapable, function (a) {\n\t\t\t\t\tvar c = meta[a];\n\t\t\t\t\treturn typeof c === 'string' ? c : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n\t\t\t\t}) + '\"'\n\t\t\t: '\"' + string + '\"';\n\t}\n\t\n\t// Produce a string from holder[key].\n\tfunction str(key, holder) {\n\t\tvar mind = gap, value = holder[key];\n\t\t\n\t\t// If the value has a toJSON method, call it to obtain a replacement value.\n\t\tif (value && typeof value === 'object' && typeof value.toJSON === 'function') {\n\t\t\tvalue = value.toJSON(key);\n\t\t}\n\t\t\n\t\t// If we were called with a replacer function, then call the replacer to\n\t\t// obtain a replacement value.\n\t\tif (typeof rep === 'function') { value = rep.call(holder, key, value); }\n\t\t\n\t\tswitch (typeof value) {\n\t\t\tcase 'string':\n\t\t\t\treturn quote(value);\n\t\t\tcase 'number':\n\t\t\t\t// JSON numbers must be finite\n\t\t\t\treturn isFinite(value) ? String(value) : 'null';\n\t\t\tcase 'boolean':\n\t\t\t\treturn String(value);\n\t\t\tcase 'object': // object, array, date, null\n\t\t\t\tif (value === null) { return 'null'; } // typeof null == 'object'\n\t\t\t\tif (value.constructor === Date) { return exports.stringifyDate(value); }\n\t\t\t\n\t\t\t\tgap += indent;\n\t\t\t\tvar partial = [];\n\t\t\t\t\n\t\t\t\t// Is the value an array?\n\t\t\t\tif (value.constructor === Array) {\n\t\t\t\t\tvar length = value.length;\n\t\t\t\t\tfor (var i = 0; i < length; i += 1) {\n\t\t\t\t\t\tpartial[i] = str(i, value) || 'null';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in brackets.\n\t\t\t\t\tvar v = partial.length === 0 ? '[]' :\n\t\t\t\t\t\tgap ? '[\\n' + gap +\n\t\t\t\t\t\t\t\tpartial.join(',\\n' + gap) + '\\n' +\n\t\t\t\t\t\t\t\t\tmind + ']' :\n\t\t\t\t\t\t\t  '[' + partial.join(',') + ']';\n\t\t\t\t\tgap = mind;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (rep && typeof rep === 'object') { // rep is an array\n\t\t\t\t\tvar length = rep.length;\n\t\t\t\t\tfor (var i = 0; i < length; i += 1) {\n\t\t\t\t\t\tvar k = rep[i];\n\t\t\t\t\t\tif (typeof k === 'string') {\n\t\t\t\t\t\t\tvar v = str(k, value);\n\t\t\t\t\t\t\tif (v) {\n\t\t\t\t\t\t\t\tpartial.push(quote(k) + (gap ? ': ' : ':') + v);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else { // iterate through all of the keys in the object.\n\t\t\t\t\tfor (var k in value) {\n\t\t\t\t\t\tif (Object.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\t\tvar v = str(k, value);\n\t\t\t\t\t\t\tif (v) {\n\t\t\t\t\t\t\t\tpartial.push(quote(k) + (gap ? ': ' : ':') + v);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Join all of the member texts together, separated with commas,\n\t\t\t\t// and wrap them in braces.\n\t\t\t\tvar v = partial.length === 0 ? '{}' :\n\t\t\t\t\tgap ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' +\n\t\t\t\t\t\t\tmind + '}' : '{' + partial.join(',') + '}';\n\t\t\t\tgap = mind;\n\t\t\t\treturn v;\n\t\t}\n\t}\n\n\n\t/**\n\t * The stringify method takes a value and an optional replacer, and an optional\n\t * space parameter, and returns a JSON text. The replacer can be a function\n\t * that can replace values, or an array of strings that will select the keys.\n \t * A default replacer method can be provided. Use of the space parameter can\n\t * produce text that is more easily readable.\n\t */\n\texports.stringify = function (value, replacer, space) {\n\t\tgap = '';\n\t\tindent = '';\n\t\t\n\t\t// If the space parameter is a number, make an indent string containing that many spaces.\n\t\tif (typeof space === 'number') {\n\t\t\tfor (var i = 0; i < space; i += 1) {\n\t\t\t\tindent += ' ';\n\t\t\t}\n\t\t} else if (typeof space === 'string') {\n\t\t\tindent = space;\n\t\t}\n\t\t\n\t\t// If there is a replacer, it must be a function or an array.\n\t\trep = replacer;\n\t\tif (replacer && typeof replacer !== 'function' &&\n\t\t\t\t(typeof replacer !== 'object' ||\n\t\t\t\t typeof replacer.length !== 'number')) {\n\t\t\tthrow new Error('JSON stringify: invalid replacer');\n\t\t}\n\t\t\n\t\t// Make a fake root object containing our value under the key of ''.\n\t\t// Return the result of stringifying the value.\n\t\treturn str('', {'': value});\n\t};\n\t\n\texports.stringifyDate = function(d) {\n\t\tvar year = d.getUTCFullYear(),\n\t\t\tmonth = d.getUTCMonth() + 1,\n\t\t\tday = d.getUTCDate(),\n\t\t\thours = d.getUTCHours(),\n\t\t\tminutes = d.getUTCMinutes(),\n\t\t\tseconds = d.getUTCSeconds(),\n\t\t\tms = d.getUTCMilliseconds();\n\t\t\n\t\tif (month < 10) { month = '0' + month; }\n\t\tif (day < 10) { day = '0' + day; }\n\t\tif (hours < 10) { hours = '0' + hours; }\n\t\tif (minutes < 10) { minutes = '0' + minutes; }\n\t\tif (seconds < 10) { seconds = '0' + seconds; }\n\t\tif (ms < 10) { ms = '00' + ms; }\n\t\telse if (ms < 100) { ms = '0' + ms; }\n\n\t\treturn '\"' + year\n\t\t\t+ '-' + month\n\t\t\t+ '-' + day\n\t\t\t+ 'T' + hours\n\t\t\t+ ':' + minutes\n\t\t\t+ ':' + seconds\n\t\t\t+ '.' + ms\n\t\t\t+ 'Z\"';\n\t}\n\t\n\t/**\n\t * The parse method takes a text and an optional reviver function, and returns\n\t * a JavaScript value if the text is a valid JSON text.\n\t */\n\texports.parse = function (text, reviver) {\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\n\t\tcx.lastIndex = 0;\n\t\tif (cx.test(text)) {\n\t\t\ttext = text.replace(cx, function (a) {\n\t\t\t\treturn '\\\\u' +\n\t\t\t\t\t('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n\t\t\t});\n\t\t}\n\t\t\n\t\t// In the second stage, we run the text against regular expressions that look\n\t\t// for non-JSON patterns. We are especially concerned with '()' and 'new'\n\t\t// because they can cause invocation, and '=' because it can cause mutation.\n\t\t// But just to be safe, we want to reject all unexpected forms.\n\n\t\t// We split the second stage into 4 regexp operations in order to work around\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\n\t\t// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n\t\t// replace all simple value tokens with ']' characters. Third, we delete all\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\n\t\t// we look to see that the remaining characters are only whitespace or ']' or\n\t\t// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n\t\tif (/^[\\],:{}\\s]*$/\n\t\t\t\t.test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n\t\t\t\t.replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n\t\t\t\t.replace(/(?:^|:|,)(?:\\s*\\[)+/g, '')))\n\t\t{\n\t\t\tvar j = eval('(' + text + ')');\n\t\t\tif(!reviver) {\n\t\t\t\treturn j;\n\t\t\t} else {\n\t\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\n\t\t\t\t// each name/value pair to a reviver function for possible transformation.\n\t\t\t\tvar walk = function(holder, key) {\n\t\t\t\t\t// The walk method is used to recursively walk the resulting structure so\n\t\t\t\t\t// that modifications can be made.\n\t\t\t\t\tvar k, v, value = holder[key];\n\t\t\t\t\tif (value && typeof value === 'object') {\n\t\t\t\t\t\tfor (k in value) {\n\t\t\t\t\t\t\tif (Object.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\t\t\tv = walk(value, k);\n\t\t\t\t\t\t\t\tif (v !== undefined) {\n\t\t\t\t\t\t\t\t\tvalue[k] = v;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdelete value[k];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn reviver.call(holder, key, value);\n\t\t\t\t}\n\t\t\t\treturn walk({'': j}, '');\n\t\t\t}\n\t\t}\n\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\n\t\tthrow new SyntaxError('JSON.parse');\n\t};\n}());","pre":true},"sdk/gc/native/reader.js":{"path":"sdk/gc/native/reader.js","friendlyPath":".reader","directory":"sdk/gc/native/","filename":"reader.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar json_chars = {'[':']','{':'}','\"':'\"'};\nvar allowed_modes = ['stream', 'json', 'delimiter'];\nexports.Reader=__class__;exports.Reader=exports.Reader(function exports_Reader(){return this.init&&this.init.apply(this,arguments)},function () {\n    this.init = function (cb, rmode, delim) {\n        this._buff = \"\";\n        this._unclosed = [];\n        this._checked = 0;\n        this._name = null;\n        this.setCb(cb);\n        this.setMode(rmode || 'stream', delim);\n    };\n\n    this.setCb = function (func) {\n        this._cb = func;\n    };\n\n    this.setMode = function (mode, delim) {\n        if (allowed_modes.indexOf(mode) == -1) {\n            throw new Error(\"illegal read mode:\", mode);\n        }\n        this._mode = mode;\n        this._delim = mode == 'delimiter' ? delim : null;\n    };\n\n    this.read = function (data) {\n        this._buff += data;\n        this._separate_events();\n    };\n\n    this._escaped = function (i) {\n        if (i == 0 || this._buff.charAt(i - 1) != '\\\\') {\n            return false;\n        }\n        return ! this._escaped(i - 1);\n    };\n\n    this._separate_events = function () {\n        var frame;\n        switch (this._mode) {\n            case 'json':\n                while (this._buff.length > this._checked) {\n                    var last_unclosed = this._unclosed.length ?\n                        this._unclosed[this._unclosed.length-1] : null;\n                    var next_char = this._buff.charAt(this._checked);\n                    if (this._unclosed.length > 0 && next_char == last_unclosed) {\n                        if (! (next_char == '\"' && this._escaped(this._checked)) ) {\n                            this._unclosed.pop();\n                        }\n                    }\n                    else if (next_char in json_chars && last_unclosed != '\"') {\n                        this._unclosed.push(json_chars[next_char]);\n                    }\n                    this._checked += 1;\n                    if (this._buff && this._unclosed.length == 0) {\n                        frame = JSON.parse(this._buff.slice(0, this._checked));\n                        this._buff = this._buff.slice(this._checked);\n                        this._checked = 0;\n                        break;\n                    }\n                }\n                break;\n            case 'delimiter':\n                var sep = this._buff.indexOf(this._delim);\n                if (sep == -1) {\n                    break;\n                }\n                frame = this._buff.slice(0, sep);\n                this._buff = this._buff.slice(sep + this._delim.length);\n                break;\n            case 'stream':\n            default:\n                frame = this._buff.slice();\n                this._buff = \"\";\n                break;\n        }\n        if (frame) {\n            this._cb(frame);\n            this._separate_events();\n        }\n    };\n});","pre":true},"sdk/gc/debugging/connect.js":{"path":"sdk/gc/debugging/connect.js","friendlyPath":"..debugging.connect","directory":"sdk/gc/debugging/","filename":"connect.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// this whole file should not get included in release\nif (DEBUG) {\n\tjsio(\"import net\");\n\tjsio(\"import net.protocols.Cuppa\");\n\n\tjsio(\"import ._DEBUG\");\n\n\tvar _conn;\n\tGLOBAL._DEBUG = new _DEBUG();\n\n\texports.getConn = function () { return _conn; }\n\n\texports.connect = function (opts, cb) {\n\t\tvar transport = opts && opts.transport;\n\t\tvar connectOpts = opts && opts.opts;\n\n\t\tif (!transport) {\n\t\t\tif (window.parent != window) {\n\t\t\t\t// in iframe\n\t\t\t\ttransport = 'postmessage';\n\t\t\t\tconnectOpts = {\n\t\t\t\t\tport: '__debug_timestep_inspector__',\n\t\t\t\t\twin: window.parent\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// assume we're on a mobile device\n\t\t\t\ttransport = 'csp';\n\t\t\t\tconnectOpts = {\n\t\t\t\t\turl: 'http://' + window.location.host + '/plugins/native_debugger/mobile_csp'\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t_conn = new DebugConn();\n\t\t_conn.onConnect(bind(GLOBAL, cb, _conn));\n\t\tnet.connect(_conn, transport, connectOpts);\n\n\t\treturn _conn;\n\t}\n\nDebugConn=__class__;\tvar DebugConn=DebugConn(function DebugConn(){return this.init&&this.init.apply(this,arguments)},net.protocols.Cuppa, function (supr) {\n\n\t\tthis.init = function () {\n\t\t\tsupr(this, 'init', arguments);\n\n\t\t\tthis._clients = [];\n\t\t}\n\n\t\tthis.setApp = function (app) {\n\t\t\tthis._clients.forEach(function (client) {\n\t\t\t\tif (client.setApp) {\n\t\t\t\t\tclient.setApp(app);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.addClient = function (client) {\n\t\t\tthis._clients.push(client);\n\t\t\tclient.setConn(this);\n\t\t}\n\n\t\tthis.initLogProxy = function () {\n\t\t\tjsio(\"import .logProxy\");\n\t\t\tlogProxy.install(this);\n\t\t}\n\n\t\tthis.initRemoteEval = function () {\n\t\t\tjsio(\"import .remoteEval\");\n\t\t\tremoteEval.install(this);\t\t\n\t\t}\n\t});\n}\n","pre":true},"sdk/jsio/net/protocols/Cuppa.js":{"path":"sdk/jsio/net/protocols/Cuppa.js","friendlyPath":"net.protocols.Cuppa","directory":"sdk/jsio/net/protocols/","filename":"Cuppa.js","src":"\"use import\";\n\njsio(\"import lib.Callback\");\njsio(\"import lib.PubSub\");\n\njsio(\"from net.protocols.rtjp import RTJPProtocol\");\n\nError=__class__;var Error=Error(function Error(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(protocol, id, msg, details, requestId) {\n\t\tthis.id = id;\n\t\tthis.msg = msg;\n\t\tthis.details = details;\n\t\tthis.requestId = requestId;\n\t}\n});\n\nRPCRequest=__class__;var RPCRequest=RPCRequest(function RPCRequest(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(protocol, id) {\n\t\tthis.protocol = protocol;\n\t\tthis.id = id;\n\t\tthis._onError = new lib.Callback();\n\t\tthis._onSuccess = new lib.Callback();\n\t}\n\n\tthis.onError = function() { this._onError.forward(arguments); }\n\tthis.onSuccess = function() { this._onSuccess.forward(arguments); }\n\t\n\tthis.bindLater = function(l) {\n\t\tvar args = [].slice(arguments, 1);\n\t\tthis._onError.forward([l, l.fail].concat(args));\n\t\tthis._onSuccess.forward([l, l.succed].concat(args));\n\t\treturn l;\n\t}\n\t\n\t\n});\n\nReceivedRequest=__class__;var ReceivedRequest=ReceivedRequest(function ReceivedRequest(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.type = \"request\"\n\n\tthis.init = function(protocol, id, name, args, target) {\n\t\tthis.protocol = protocol\n\t\tthis.id = id;\n\t\tthis.name = name\n\t\tthis.responded = false;\n\t\tthis.args = args;\n\t\tthis.target = target;\n\t}\n\n\tthis.error = function(msg, details) {\n\t\tif (this.responded) { throw new Error(\"already responded\"); }\n\t\tif (this._timer) { \n\t\t\tclearTimeout(this._timer); \n\t\t\tthis._timer = null; \n\t\t}\n\t\targs = {\n\t\t\tid: this.id,\n\t\t\tmsg: msg + \"\"\n\t\t}\n\t\tif (details !== undefined) { args.details = details }\n\t\tthis.responded = true;        \n\t\tthis.protocol.sendFrame('ERROR', args);\n\t}\n\n\tthis.respond = function(args) {\n\t\tif (this.responded) { throw new Error(\"already responded\"); }\n\t\tif (this._timer) { \n\t\t\tclearTimeout(this._timer); \n\t\t\tthis._timer = null; \n\t\t}\n\t\tthis.responded = true;\n\t\tthis.protocol.sendFrame('RESPONSE', {\n\t\t\tid: this.id,\n\t\t\targs: args == undefined ? {} : args // python cuppa ignores responses with undefined args\n\t\t});\n\t}\n\t\n\tthis.timeoutAfter = function(duration, msg) {\n\t\tif (this.responded) { return; }\n\t\tif (this._timer) { clearTimeout(this._timer); }\n\t\tthis._timer = setTimeout(bind(this, '_timeout', msg), duration);\n\t}\n\t\n\tthis._timeout = function(msg) {\n\t\tif (!this.responded) {\n\t\t\tthis.error(msg);\n\t\t}\n\t}\n    \n});\n\nReceivedEvent=__class__;var ReceivedEvent=ReceivedEvent(function ReceivedEvent(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(protocol, id, name, args, target) {\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.args = args;\n\t\tthis.target = target;\n\t}\n});\n\n/**\n * @extends net.protocols.rtjp.RTJPProtocol;\n */\nvar sdk_jsio_net_protocols_Cuppa=__class__;exports=sdk_jsio_net_protocols_Cuppa(function sdk_jsio_net_protocols_Cuppa(){return this.init&&this.init.apply(this,arguments)},RTJPProtocol, function(supr) {\n\tthis.init = function() {\n\t\tsupr(this, 'init', arguments);\n\t\t\n\t\tthis._onConnect = new lib.Callback();\n\t\tthis._onDisconnect = new lib.Callback();\n\t\t\n\t\tthis._requests = {};\n\t\t\n\t\tthis.onEvent = new lib.PubSub();\n\t\tthis.onRequest = new lib.PubSub();\n\t}\n\t\n\tthis.disconnect = function() { this.transport.loseConnection(); }\n\t\n\t// pass something to call (ctx, method, args...) when connected\n\tthis.onConnect = function() { this._onConnect.forward(arguments); }\n\tthis.onDisconnect = function() { this._onDisconnect.forward(arguments); }\n\t\n\tthis.reset = function() {\n\t\tthis._onConnect.reset();\n\t\tthis._onDisconnect.reset();\n\t}\n\t\n\t// called when we're connected\n\tthis.connectionMade = function() {\n\t\tthis._isConnected = true;\n\t\tthis._onConnect.fire();\n\t}\n\t\n\tthis.connectionLost = function(err) {\n\t\tfor (var i in this._requests) {\n\t\t\tvar req = this._requests[i];\n\t\t\tdelete this._requests[i];\n\t\t\treq._onError.fire(err);\n\t\t}\n\t\t\n\t\tthis._isConnected = false;\n\t\tthis._onDisconnect.fire(err);\n\t}\n\t\n\tthis.sendRequest = function(name, args, target, cb) {\n\t\tif (arguments.length > 4) { // allow bound functions (e.g. [this, 'onResponse', 123])\n\t\t\tcb = bind.apply(GLOBAL, Array.prototype.slice.call(arguments, 3));\n\t\t}\n\t\t\n\t\tvar frameArgs = {\n\t\t\tname: name,\n\t\t\targs: args\n\t\t};\n\t\t\n\t\tif (target) { frameArgs.target = target; }\n\t\t\n\t\tvar id = this.sendFrame('RPC', frameArgs),\n\t\t\treq = this._requests[id] = new RPCRequest(this, id);\n\t\t\n\t\tif (cb) {\n\t\t\treq.onSuccess(GLOBAL, cb, false); // will call cb(false, args...)\n\t\t\treq.onError(GLOBAL, cb); // will call cb(err)\n\t\t}\n\t\t\n\t\treturn req;\n\t}\n\t\n\tthis.sendEvent = function(name, args, target) {\n\t\tthis.sendFrame('EVENT', {name: name, args: args, target: target || null});\n\t}\n\t\n\tthis.frameReceived = function(id, name, args) {\n\t\tlogger.debug('RECEIVED', id, name, args);\n\t\tswitch(name.toUpperCase()) {\n\t\t\tcase 'RESPONSE':\n\t\t\t\tvar req = this._requests[args.id];\n\t\t\t\tif (!req) { return; }\n\t\t\t\tdelete this._requests[args.id];\n\t\t\t\treq._onSuccess.fire(args.args);\n\t\t\t\tbreak;\n\t\t\tcase 'ERROR':\n\t\t\t\tvar msg = args.msg || 'unknown',\n\t\t\t\t\trequestId = args.id,\n\t\t\t\t\treq = this._requests[requestId],\n\t\t\t\t\terr = new Error(this, id, msg, args.details, requestId);\n\t\t\t\t\n\t\t\t\tif (!req) {\n\t\t\t\t\treturn this.errorReceived && this.errorReceived(err);\n\t\t\t\t} else {\n\t\t\t\t\tdelete this._requests[requestId];\n\t\t\t\t\treq._onError.fire(err);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'RPC':\n\t\t\tcase 'EVENT':\n\t\t\t\tif (!args.name) {\n\t\t\t\t\treturn self.sendFrame('ERROR', { 'id': args.id || id, 'msg': 'missing \"name\"' });\n\t\t\t\t}\n\t\t\t\tvar frameArgs = args.args || {},\n\t\t\t\t\ttarget = args.target || null,\n\t\t\t\t\tisRPC = name.toUpperCase() == 'RPC',\n\t\t\t\t\treqCtor = isRPC ? ReceivedRequest : ReceivedEvent,\n\t\t\t\t\tpubTarget = isRPC ? this.onRequest : this.onEvent,\n\t\t\t\t\treq = new reqCtor(this, args.id || id, args.name, frameArgs, target);\n\t\t\t\t\n\t\t\t\tpubTarget.publish(req.name, req);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n});\n","pre":true},"sdk/jsio/net/protocols/rtjp.js":{"path":"sdk/jsio/net/protocols/rtjp.js","friendlyPath":"net.protocols.rtjp","directory":"sdk/jsio/net/protocols/","filename":"rtjp.js","src":"jsio('import net.interfaces');\njsio('from net.protocols.delimited import DelimitedProtocol');\n\n/**\n * @extends net.protocols.delimited.DelimitedProtocol\n */\nexports.RTJPProtocol=__class__;exports.RTJPProtocol=exports.RTJPProtocol(function exports_RTJPProtocol(){return this.init&&this.init.apply(this,arguments)},DelimitedProtocol, function(supr) {\n\tthis.init = function() {\n\t\tvar delimiter = '\\r\\n';\n\t\tsupr(this, 'init', [delimiter]);\n\t\tthis.frameId = 0;\n\t}\n\n\tthis.connectionMade = function() {\n\t\tif (this._client && this._client.connectionMade) { this._client.connectionMade(); }\n\t\tlogger.debug(\"connectionMade\");\n\t}\n\t\n\tvar error = function(e) {\n\t\tlogger.error(e);\n\t}\n\t\n\t// Inherit and overwrite\n\tthis.frameReceived = function(id, name, args) {\n\t}\n\n\t// Public\n\tthis.sendFrame = function(name, args) {\n\t\tif (!args) {\n\t\t\targs = {}\n\t\t}\n\t\tlogger.debug('sendFrame', name, JSON.stringify(args));\n\t\tthis.sendLine(JSON.stringify([++this.frameId, name, args]));\n\t\treturn this.frameId;\n\t}\n\n\tthis.lineReceived = function(line) {\n\t\ttry {\n\t\t\tvar frame = JSON.parse(line);\n\t\t\tif (frame.length != 3) {\n\t\t\t\treturn error.call(this, \"Invalid frame length\");\n\t\t\t}\n\t\t\tif (typeof(frame[0]) != \"number\") {\n\t\t\t\treturn error.call(this, \"Invalid frame id\");\n\t\t\t}\n\t\t\tif (typeof(frame[1]) != \"string\") {\n\t\t\t\treturn error.call(this, \"Invalid frame name\");\n\t\t\t}\n\t\t\tlogger.debug(\"frameReceived:\", frame[0], frame[1], JSON.stringify(frame[2]));\n\t\t} catch(e) {\n\t\t\terror.call(this, e);\n\t\t}\n\t\t\n\t\tif (frame) {\n\t\t\tthis.frameReceived(frame[0], frame[1], frame[2]);\n\t\t}\n\t}\n\n\tthis.connectionLost = function() {\n\t\tlogger.debug('conn lost');\n\t}\n});\n\n\n\n","pre":true},"sdk/jsio/net/protocols/delimited.js":{"path":"sdk/jsio/net/protocols/delimited.js","friendlyPath":"net.protocols.delimited","directory":"sdk/jsio/net/protocols/","filename":"delimited.js","src":"jsio('import net.interfaces');\n\n/**\n * @extends net.interfaces.Protocol\n */\nexports.DelimitedProtocol=__class__;exports.DelimitedProtocol=exports.DelimitedProtocol(function exports_DelimitedProtocol(){return this.init&&this.init.apply(this,arguments)},net.interfaces.Protocol, function(supr) {\n\n\tthis.init = function(delimiter) {\n\t\tif (!delimiter) {\n\t\t\tdelimiter = '\\r\\n'\n\t\t}\n\t\tthis.delimiter = delimiter;\n\t\tthis.buffer = \"\"\n\t}\n\t\n\tthis.connectionMade = function() {\n\t\tlogger.debug('connectionMade');\n\t}\n\t\n\tthis.dataReceived = function(data) {\n\t\tif (!data) { return; }\n\t\tlogger.debug('dataReceived:(' + data.length + ')', data);\n\t\tlogger.debug('last 2:', JSON.stringify(data.slice(data.length-2)));\n\t\tthis.buffer += data;\n\t\tvar i;\n\t\twhile ((i = this.buffer.indexOf(this.delimiter)) != -1) {\n\t\t\tvar line = this.buffer.slice(0, i);\n\t\t\tthis.buffer = this.buffer.slice(i + this.delimiter.length);\n\t\t\tthis.lineReceived(line);\n\t\t}\n\t}\n\n\tthis.lineReceived = function(line) {\n\t\tlogger.debug('Not implemented, lineReceived:', line);\n\t}\n\tthis.sendLine = function(line) {\n\t\tlogger.debug('WRITE:', JSON.stringify(line + this.delimiter));\n\t\tthis.transport.write(line + this.delimiter);\n\t}\n\tthis.connectionLost = function() {\n\t\tlogger.debug('connectionLost');\n\t}\n});\n\n","pre":true},"sdk/gc/debugging/_DEBUG.js":{"path":"sdk/gc/debugging/_DEBUG.js","friendlyPath":"._DEBUG","directory":"sdk/gc/debugging/","filename":"_DEBUG.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// this whole file should not get included in release\nif (DEBUG) {\n\n\t/*\n\t * Tools for traversing views from the JS console.\n\t * This class ends up being in the global scope:\n\t *   GLOBAL._DEBUG = new exports();\n\t */\nvar sdk_gc_debugging__DEBUG=__class__;\texports=sdk_gc_debugging__DEBUG(function sdk_gc_debugging__DEBUG(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\t\tthis.traverse = function (f) { return GC.app && this.traverseView(f, GC.app.view); }\n\t\tthis.traverseView = function (f, view) {\n\t\t\treturn {\n\t\t\t\tuid: view.uid,\n\t\t\t\tdata: f(view),\n\t\t\t\tsubviews: view.getSubviews().map(bind(this, 'traverseView', f))\n\t\t\t};\n\t\t}\n\n\t\tthis.find = function (f) { return GC.app && this.findView(f, GC.app.view); }\n\t\tthis.findView = function (f, view) {\n\t\t\tif (f(view)) { return view; }\n\t\t\tvar subviews = view.getSubviews();\n\t\t\tfor (var i = 0, sub; sub = subviews[i]; ++i) {\n\t\t\t\tvar res = this.findView(f, sub);\n\t\t\t\tif (res) { return res; }\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.getViewByID = function (uid) { return this.find(function (view) { return view.uid == uid; }); }\n\n\t\tthis.pack = function () { return GC.app && this.packView(GC.app.view); }\n\t\tthis.packView = function (view) {\n\t\t\tjsio(\"import ui.ImageView\");\n\t\t\tjsio(\"import ui.TextView\");\n\n\t\t\treturn this.traverseView(function (view) {\n\n\t\t\t\tif (view instanceof ui.ImageView) {\n\t\t\t\t\tvar img = view.getImage();\n\t\t\t\t\tif (img) {\n\t\t\t\t\t\tvar imageData = img.getMap();\n\t\t\t\t\t\timageData.type = 'ImageView';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (view instanceof ui.TextView) {\n\t\t\t\t\tvar text = view.getText();\n\t\t\t\t}\n\n\t\t\t\tvar s = view.style;\n\t\t\t\treturn {\n\t\t\t\t\tx: s.x,\n\t\t\t\t\ty: s.y,\n\t\t\t\t\twidth: s.width,\n\t\t\t\t\theight: s.height,\n\t\t\t\t\tscale: s.scale,\n\t\t\t\t\timage: imageData,\n\t\t\t\t\ttext: text,\n\t\t\t\t\tvisible: s.visible,\n\t\t\t\t\topacity: s.opacity,\n\t\t\t\t\ttag: view.getTag()\n\t\t\t\t};\n\t\t\t}, view);\n\t\t}\n\n\t\tthis.unpack = function (data) {\n\t\t\tjsio(\"import ui.View\");\n\t\t\tjsio(\"import ui.ImageView\");\n\t\t\tjsio(\"import ui.resource.Image\");\n\t\t\tjsio(\"import ui.TextView\");\n\n\t\t\tfunction buildView (superview, data) {\n\t\t\t\tvar view;\n\n\t\t\t\tvar opts = data.data;\n\t\t\t\tif (opts.image) {\n\t\t\t\t\tvar img = opts.image;\n\t\t\t\t\tview = new ui.ImageView({\n\t\t\t\t\t\tx: opts.x,\n\t\t\t\t\t\ty: opts.y,\n\t\t\t\t\t\twidth: opts.width,\n\t\t\t\t\t\theight: opts.height,\n\t\t\t\t\t\tscale: opts.scale,\n\n\t\t\t\t\t\tscaleMethod: img.scaleMethod,\n\t\t\t\t\t\tslices: img.slices,\n\n\t\t\t\t\t\tsuperview: superview,\n\t\t\t\t\t\timage: new ui.resource.Image({\n\t\t\t\t\t\t\turl: img.url,\n\t\t\t\t\t\t\tsourceX: img.x,\n\t\t\t\t\t\t\tsourceY: img.y,\n\t\t\t\t\t\t\tsourceW: img.width,\n\t\t\t\t\t\t\tsourceH: img.height,\n\t\t\t\t\t\t\tmarginTop: img.marginTop,\n\t\t\t\t\t\t\tmarginRight: img.marginRight,\n\t\t\t\t\t\t\tmarginBottom: img.marginBottom,\n\t\t\t\t\t\t\tmarginLeft: img.marginLeft\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tvisible: opts.visible,\n\t\t\t\t\t\topacity: opts.opacity,\n\t\t\t\t\t\ttag: opts.tag\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tview = new (opts.text ? ui.TextView : ui.View)({\n\t\t\t\t\t\tx: opts.x,\n\t\t\t\t\t\ty: opts.y,\n\t\t\t\t\t\twidth: opts.width,\n\t\t\t\t\t\theight: opts.height,\n\t\t\t\t\t\ttext: opts.text,\n\t\t\t\t\t\tsuperview: superview,\n\t\t\t\t\t\tscale: opts.scale,\n\t\t\t\t\t\tvisible: opts.visible,\n\t\t\t\t\t\topacity: opts.opacity,\n\t\t\t\t\t\ttag: opts.tag\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tview.uid = data.uid;\n\n\t\t\t\tfor (var i = 0, sub; sub = data.subviews[i]; ++i) {\n\t\t\t\t\tbuildView(view, sub);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tGC.app.view.updateOpts(data.data);\n\t\t\tfor (var i = 0, sub; sub = data.subviews[i]; ++i) {\n\t\t\t\tbuildView(GC.app.view, sub);\n\t\t\t}\n\t\t}\n\n\t\tthis.eachView = function (list, f) {\n\t\t\tfor (var i = 0, n = list.length; i < n; ++i) {\n\t\t\t\tvar view = this.getViewByID(list[i]);\n\t\t\t\tif (view) {\n\t\t\t\t\tf(view, list[i]);\n\t\t\t\t} else {\n\t\t\t\t\tlogger.warn('view', list[i], 'not found');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.hideViews = function (/* id1, id2, id3, ... */) {\n\t\t\tthis.eachView(arguments, function (view) { view.style.visible = false; });\n\t\t}\n\n\t\tthis.showViews = function (/* id1, id2, id3, ... */) {\n\t\t\tthis.eachView(arguments, function (view) { view.style.visible = true; });\n\t\t}\n\n\t\tthis.hideAllViews = function () {\n\t\t\tthis.traverse(function (view) { view.style.visible = false; });\n\t\t}\n\n\t\tthis.showAllViews = function () {\n\t\t\tthis.traverse(function (view) { view.style.visible = true; });\n\t\t}\n\n\t\tthis.hideViewRange = function (a, b) {\n\t\t\tvar range = [];\n\t\t\tfor (var i = a; i < b; ++i) {\n\t\t\t\trange.push(i);\n\t\t\t}\n\n\t\t\tthis.hideViews.apply(this, range);\n\t\t}\n\n\t\tthis.showViewRange = function (a, b) {\n\t\t\tvar range = [];\n\t\t\tfor (var i = a; i < b; ++i) {\n\t\t\t\trange.push(i);\n\t\t\t}\n\n\t\t\tthis.showViews.apply(this, range);\n\t\t}\n\t});\n}","pre":true},"sdk/timestep/ui/TextView.js":{"path":"sdk/timestep/ui/TextView.js","friendlyPath":"ui.TextView","directory":"sdk/timestep/ui/","filename":"TextView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.TextView;\n * Import the Canvas/DOM implementation of TextView.\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.textview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\njsio(\"import device\");\n\nexports = device.importUI('TextView');\n","pre":true},"sdk/gc/debugging/logProxy.js":{"path":"sdk/gc/debugging/logProxy.js","friendlyPath":".logProxy","directory":"sdk/gc/debugging/","filename":"logProxy.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// this whole file should not get included in release\nif (DEBUG) {\n\tfunction stringify(value) {\n\t\tif (value === null) {\n\t\t\treturn 'null';\n\t\t} else if (typeof value == 'object') {\n\t\t\tif (isArray(value)) {\n\t\t\t\tvalue = value.slice(0);\n\t\t\t\tfor (var i = 0, n = value.length; i < n; ++i) {\n\t\t\t\t\tvalue[i] = stringify(value[i]);\n\t\t\t\t}\n\t\t\t\treturn '[' + value.join(', ') + ']';\n\t\t\t} else if (value.__class__) {\n\t\t\t\treturn '[object ' + value.__class__ + ']';\n\t\t\t} else {\n\t\t\t\treturn Object.prototype.toString.call(value);\n\t\t\t}\n\t\t} else {\n\t\t\treturn String(value);\n\t\t}\n\t}\n\n\tvar _logBuffer = [];\n\tvar _isInstalled = false;\n\tvar _isEnabled = true;\n\n\t// insert a hook into the js.io logging system so that calls to logger get routed over the network\n\texports.install = function (conn) {\n\t\tif (_isInstalled) { return; }\n\t\t_isInstalled = true;\n\n\t\tjsio(\"import base\");\n\n\t\tvar oldLog = base.log;\n\n\t\t// don't buffer logs if we haven't connected within 10 seconds\n\t\tvar timeout = setTimeout(function () { _isEnabled = false; }, 10000);\n\t\tconn.onConnect(function () {\n\t\t\tclearTimeout(timeout);\n\t\t\texports.flushBuffer();\n\t\t});\n\n\t\tvar isLocked = false;\n\t\tbase.log = function () {\n\t\t\tif (_isEnabled && !isLocked) {\n\t\t\t\tisLocked = true; // prevent recursive loops if sendEvent decides to log stuff\n\n\t\t\t\t// convert arguments to strings\n\t\t\t\tvar n = arguments.length;\n\t\t\t\tvar args = new Array(n);\n\t\t\t\tfor (var i = 0; i < n; ++i) {\n\t\t\t\t\targs[i] = stringify(arguments[i]);\n\t\t\t\t}\n\n\t\t\t\t// buffer log lines\n\t\t\t\tif (!conn || !conn.isConnected()) {\n\t\t\t\t\t_logBuffer.push(args);\n\t\t\t\t} else {\n\t\t\t\t\t// flush logs\n\t\t\t\t\tif (_logBuffer[0]) {\n\t\t\t\t\t\tfor (var i = 0, log; log = _logBuffer[i]; ++i) {\n\t\t\t\t\t\t\tconn.sendEvent('LOG', log);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t_logBuffer = [];\n\t\t\t\t\t}\n\n\t\t\t\t\t// send log\n\t\t\t\t\tconn.sendEvent('LOG', args);\n\t\t\t\t}\n\n\t\t\t\tisLocked = false;\n\t\t\t}\n\n\t\t\treturn oldLog.apply(this, arguments);\n\t\t};\n\t}\n\n\texports.flushBuffer = function () {\n\t\t// we timed out, so bail\n\t\tif (!_logBuffer) { return conn.close(); }\n\n\t\t// if we buffered log messages, send them\n\t\tvar n = _logBuffer.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tconn.sendEvent('LOG', _logBuffer[i]);\n\t\t}\n\n\t\t_logBuffer = [];\n\t}\n}\n","pre":true},"sdk/gc/debugging/remoteEval.js":{"path":"sdk/gc/debugging/remoteEval.js","friendlyPath":".remoteEval","directory":"sdk/gc/debugging/","filename":"remoteEval.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// this whole file should not get included in release\nif (DEBUG) {\n\n\tvar _isInstalled = false;\n\n\texports.install = function (conn) {\n\t\tif (_isInstalled) { return; }\n\t\t_isInstalled = true;\n\n\t\tconn.onError = function (err) {\n\t\t\tlogger.log('log protocol error:', err);\n\t\t}\n\t\t\n\t\tconn.onConnect(function () {\n\t\t\tconn.sendEvent(\"HANDSHAKE\", {\n\t\t\t\t\"type\": jsio.__env.name,\n\t\t\t\t\"appID\": CONFIG.appID,\n\t\t\t\t\"version\": CONFIG.version,\n\t\t\t\t\"title\": CONFIG.title,\n\t\t\t\t\"shortName\": CONFIG.shortName,\n\t\t\t\t\"userAgent\": navigator.userAgent,\n\t\t\t\t\"device\": GLOBAL.NATIVE ? NATIVE.device : null\n\t\t\t});\n\n\t\t\tlogger.log('DEBUGGING CONNECTION MADE');\n\t\t});\n\n\t\tconn.onDisconnect(function () {\n\t\t\tlogger.log('DEBUGGING CONNECTION LOST');\n\t\t});\n\n\t\tconn.onRequest.subscribe('EVAL', this, function (req) {\n\t\t\ttry {\n\t\t\t\tvar value;\n\t\t\t\tif (GLOBAL.NATIVE && NATIVE.eval) {\n\t\t\t\t\tvalue = NATIVE.eval(req.args, \"[console]\");\n\t\t\t\t} else {\n\t\t\t\t\tvalue = window.eval(req.args, \"[console]\");\n\t\t\t\t}\n\n\t\t\t\treq.respond(stringify(value));\n\t\t\t} catch (e) {\n\t\t\t\treq.error(e.name + \": \" + e.message);\n\t\t\t}\n\t\t});\n\t}\n}\n","pre":true},"sdk/gc/debugging/TimestepInspector.js":{"path":"sdk/gc/debugging/TimestepInspector.js","friendlyPath":"..debugging.TimestepInspector","directory":"sdk/gc/debugging/","filename":"TimestepInspector.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// this whole file should not get included in release\nif (DEBUG) {\n\tjsio(\"import device\");\n\tjsio(\"import math.geom.Point as Point\");\n\tjsio(\"import ui.resource.Image as Image\");\n\tjsio(\"import ui.ImageView as ImageView\");\n\n\tjsio(\"import .OverlayRenderer\");\n\n\t// mapping for reading/writing style properties on a view\n\t// map: inspector id -> style property\n\tvar _propMap = {\n\t\trelX: 'x',\n\t\trelY: 'y',\n\t\trelR: 'r',\n\t\trelWidthPercent: 'widthPercent',\n\t\trelHeightPercent: 'heightPercent',\n\t\trelWidth: 'width',\n\t\trelHeight: 'height',\n\t\trelScale: 'scale',\n\t\topacity: 'opacity',\n\t\tzIndex: 'zIndex',\n\t\tvisible: 'visible',\n\t\tanchorX: 'anchorX',\n\t\tanchorY: 'anchorY',\n\t\toffsetX: 'offsetX',\n\t\toffsetY: 'offsetY',\n\t\tclip: 'clip',\n\t\tlayout: 'layout',\n\t\tinLayout: 'inLayout',\n\t\ttop: 'top',\n\t\tleft: 'left',\n\t\tbottom: 'bottom',\n\t\tright: 'right',\n\t\tflex: 'flex',\n\t\tdirection: 'direction',\n\t\tjustifyContent: 'justifyContent',\n\t\torder: 'order',\n\n\t\tlayoutWidth: 'layoutWidth',\n\t\tlayoutHeight: 'layoutHeight',\n\t\tcenterX: 'centerX',\n\t\tcenterY: 'centerY',\n\t\tminWidth: 'minWidth',\n\t\tminHeight: 'minHeight',\n\t\tmaxWidth: 'maxWidth',\n\t\tmaxHeight: 'maxHeight',\n\t};\n\n\tvar dispatchWindowEvent = function(eventName) {\n\t\tvar e = document.createEvent('Event');\n\t\te.initEvent(eventName, true, true);\n\t\twindow.dispatchEvent(e);\n\t};\n\nvar sdk_gc_debugging_TimestepInspector=__class__;\texports=sdk_gc_debugging_TimestepInspector(function sdk_gc_debugging_TimestepInspector(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\tthis.init = function (conn) {\n\t\t\tthis._overlay = new OverlayRenderer();\n\t\t};\n\n\t\tthis.setConn = function (conn) {\n\t\t\tthis._conn = conn;\n\n\t\t\tif (CONFIG.splash) {\n\t\t\t\tvar prevHide = CONFIG.splash.hide;\n\t\t\t\tCONFIG.splash.hide = bind(this, function () {\n\t\t\t\t\tprevHide && prevHide.apply(this, arguments);\n\t\t\t\t\tif (this._conn) {\n\t\t\t\t\t\tthis._conn.onConnect(this, function () {\n\t\t\t\t\t\t\tthis._conn.sendEvent('HIDE_LOADING_IMAGE');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconn.onEvent.subscribe('BATCH', this, function (evt) {\n\t\t\t\tvar i;\n\t\t\t\tfor (i in evt.args) {\n\t\t\t\t\tconn.onEvent.publish(evt.args[i].name, evt.args[i].args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconn.onEvent.subscribe('SET_NAME', this, function (evt) {\n\t\t\t\tGLOBAL._name = evt.args.name;\n\t\t\t\tlogging.setPrefix(evt.args.name + ': ');\n\t\t\t});\n\n\t\t\tvar _homeScreen = false;\n\t\t\tconn.onEvent.subscribe('HOME_BUTTON', this, function () {\n\t\t\t\tif (!GC) return;\n\n\t\t\t\tvar app = GC.app;\n\n\t\t\t\tif (this._homeScreen) {\n\t\t\t\t\tdispatchWindowEvent('pageshow');\n\t\t\t\t\tapp.engine.resume();\n\t\t\t\t} else {\n\t\t\t\t\tdispatchWindowEvent('pagehide');\n\t\t\t\t\tapp.engine.pause();\n\n\t\t\t\t\tvar canvas = document.getElementsByTagName('canvas');\n\t\t\t\t\tif (canvas.length) {\n\t\t\t\t\t\tcanvas = canvas[0];\n\t\t\t\t\t\tif (canvas.getContext) {\n\t\t\t\t\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\t\t\t\t\tctx.fillStyle = '#000000';\n\t\t\t\t\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._homeScreen ^= true;\n\t\t\t});\n\n\t\t\tconn.onEvent.subscribe('BACK_BUTTON', this, function (evt) {\n\t\t\t\tGLOBAL.NATIVE.backButton.emit('pressed');\n\t\t\t});\n\n\t\t\tconn.onRequest.subscribe('SCREENSHOT', this, function (req) {\n\t\t\t\tvar canv = GC.app.engine.getElement();\n\t\t\t\tif (canv && canv.toDataURL) {\n\t\t\t\t\treq.respond({\n\t\t\t\t\t\twidth: canv.width,\n\t\t\t\t\t\theight: canv.height,\n\t\t\t\t\t\tcanvasImg: canv.toDataURL('image/png')\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treq.error({\n\t\t\t\t\t\tNOT_SUPPORTED: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconn.onEvent.subscribe('MUTE', this, function (evt) {\n\t\t\t\tGLOBAL.ACCESSIBILITY.mute(evt.args.shouldMute);\n\t\t\t});\n\n\t\t\tvar _paused = false;\n\t\t\tconn.onEvent.subscribe('PAUSE', this, function () {\n\t\t\t\tif (!GC) return;\n\t\t\t\tvar app = GC.app;\n\n\t\t\t\tif (_paused) {\n\t\t\t\t\tapp.engine.resume();\n\t\t\t\t\tthis._overlay.stopTick();\n\t\t\t\t} else {\n\t\t\t\t\tapp.engine.pause();\n\t\t\t\t\tthis._overlay.startTick();\n\t\t\t\t}\n\t\t\t\t_paused = !_paused;\n\t\t\t});\n\n\t\t\tconn.onEvent.subscribe('STEP', this, function () {\n\t\t\t\tif (!GC) return;\n\t\t\t\tvar app = GC.app;\n\n\t\t\t\tapp.engine.stepFrame();\n\t\t\t\t_paused = true;\n\t\t\t});\n\n\t\t\tvar _input = null;\n\t\t\tconn.onRequest.subscribe('ADD_MOUSE_EVT', this, function (req) {\n\t\t\t\tif (!_input) { _input = new DebugInputHandler(conn); }\n\t\t\t\treq.respond();\n\t\t\t});\n\n\t\t\tconn.onRequest.subscribe('REMOVE_MOUSE_EVT', this, function (req) {\n\t\t\t\tif (_input) { _input.destroy(); }\n\t\t\t\treq.respond();\n\t\t\t});\n\n\t\t\tconn.onEvent.subscribe('SET_HIGHLIGHT', this, function (req) {\n\t\t\t\tthis._overlay.setHighlight(req.args.uid);\n\t\t\t\t//this._overlay.render();\n\t\t\t});\n\n\t\t\tconn.onEvent.subscribe('SET_SELECTED', this, function (req) {\n\t\t\t\tthis._overlay.setSelected(req.args.uid);\n\t\t\t\t//this._overlay.render();\n\t\t\t});\n\n\t\t\tfunction findBetterTag (view) {\n\t\t\t\tvar parent = view.getSuperview();\n\t\t\t\tfor (var key in parent) {\n\t\t\t\t\tif (parent[key] === view) {\n\t\t\t\t\t\treturn key;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconn.onRequest.subscribe('GET_ROOT_UID', this, function (req) {\n\t\t\t\treq.respond({uid: GC.app.uid});\n\t\t\t});\n\n\t\t\tconn.onRequest.subscribe('GET_VIEW', this, function (req) {\n\t\t\t\tvar view = _DEBUG.getViewByID(req.args.uid);\n\t\t\t\tif (!view) {\n\t\t\t\t\treq.error('no view with id' + req.args.uid, {VIEW_NOT_FOUND: true});\n\t\t\t\t} else {\n\t\t\t\t\tvar sup = view.getSuperview();\n\n\t\t\t\t\t//create the optimal tag\n\t\t\t\t\tvar tag = view.getTag && view.getTag() || view.toString();\n\t\t\t\t\tvar betterTag = findBetterTag(view);\n\t\t\t\t\tif (betterTag) tag = betterTag + \":\" + tag;\n\n\t\t\t\t\treq.respond({\n\t\t\t\t\t\tuid: view.uid,\n\t\t\t\t\t\tsuperviewID: sup && sup.uid,\n\t\t\t\t\t\ttag: tag,\n\t\t\t\t\t\tsubviewIDs: view.getSubviews().map(function (view) { return view.uid; })\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconn.onRequest.subscribe('REPLACE_IMAGE', this, function (req) {\n\t\t\t\tvar args = req.args;\n\t\t\t\tvar imgData = args.imgData;\n\t\t\t\tvar uid = args.uid;\n\n\t\t\t\tvar view = _DEBUG.getViewByID(uid);\n\t\t\t\tvar newImg = new Image();\n\n\t\t\t\tnewImg._srcImg.addEventListener(\"load\", function () {\n\t\t\t\t\tvar map = newImg._map;\n\t\t\t\t\tmap.width = newImg._srcImg.width,\n\t\t\t\t\tmap.height = newImg._srcImg.height,\n\t\t\t\t\tmap.x = 0;\n\t\t\t\t\tmap.y = 0;\n\t\t\t\t\tview.setImage(newImg);\n\t\t\t\t\tview.needsRepaint();\n\t\t\t\t}, false);\n\n\t\t\t\tnewImg._srcImg.src = imgData;\n\t\t\t});\n\n\t\t\tconn.onRequest.subscribe('GET_VIEW_PROPS', this, function (req) {\n\t\t\t\tvar args = req.args;\n\t\t\t\tvar view = _DEBUG.getViewByID(args.uid);\n\t\t\t\tif (!view) {\n\t\t\t\t\treturn req.error(\"VIEW_NOT_FOUND\");\n\t\t\t\t}\n\n\t\t\t\tvar s = view.style;\n\t\t\t\tvar p = view.getPosition();\n\t\t\t\tvar layout = view.__layout;\n\t\t\t\tvar ret = {};\n\t\t\t\tfor (var key in _propMap) {\n\t\t\t\t\tret[key] = s[_propMap[key]];\n\t\t\t\t}\n\n\t\t\t\tmerge(ret, {\n\t\t\t\t\tabsX: p.x,\n\t\t\t\t\tabsY: p.y,\n\t\t\t\t\tabsR: p.r,\n\t\t\t\t\tabsWidth: p.width,\n\t\t\t\t\tabsHeight: p.height,\n\t\t\t\t\tabsScale: p.scale,\n\n\t\t\t\t\tsubviews: layout && (typeof layout.getSubviews == 'function') && layout.getSubviews().length,\n\t\t\t\t\tdirection: layout && (typeof layout.getDirection == 'function') && layout.getDirection(),\n\t\t\t\t\tpadding: s.padding && s.padding.toString()\n\t\t\t\t});\n\n\t\t\t\tfor (var key in ret) {\n\t\t\t\t\tif (ret[key] == undefined) {\n\t\t\t\t\t\tret[key] = '-';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tret.isImageView = view instanceof ImageView;\n\n\t\t\t\tif (ret.isImageView) {\n\t\t\t\t\tret.imagePath = view._opts.image || (view._img && view._img._map && view._img._map.url);\n\t\t\t\t\tif (ret.imagePath && ret.imagePath._map) {\n\t\t\t\t\t\tret.imagePath = ret.imagePath._map.url;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tret.uuid = args.uid;\n\n\t\t\t\tret.description = (view.constructor.name || 'View') + ' ' + args.uid + '\\n' + view.getTag();\n\n\t\t\t\treq.respond(ret);\n\t\t\t});\n\n\t\t\tconn.onRequest.subscribe('SET_VIEW_PROP', this, function (req) {\n\t\t\t\tvar args = req.args;\n\t\t\t\tvar view = _DEBUG.getViewByID(args.uid);\n\t\t\t\tif (!view) {\n\t\t\t\t\treturn req.error(\"VIEW_NOT_FOUND\");\n\t\t\t\t}\n\n\t\t\t\tvar key = args.key;\n\t\t\t\tvar value = args.value;\n\t\t\t\tif (key in _propMap) {\n\t\t\t\t\tview.style[_propMap[key]] = value;\n\t\t\t\t} else {\n\t\t\t\t\tswitch (key) {\n\t\t\t\t\t\tcase 'absX': break;\n\t\t\t\t\t\tcase 'absY': view.style.y = value; break;\n\t\t\t\t\t\tcase 'absWidth': view.style.width = value; break;\n\t\t\t\t\t\tcase 'absHeight': view.style.height = value; break;\n\t\t\t\t\t\tcase 'absScale': view.style.scale = value; break;\n\t\t\t\t\t\tcase 'padding': view.style.padding = value; break;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar _pollTimer = null;\n\t\t\tvar _pollView = null;\n\n\t\t\tconn.onEvent.subscribe('POLL_VIEW_POSITION', this, function (evt) {\n\n\t\t\t\tfunction poll() {\n\t\t\t\t\tif (_pollView) {\n\t\t\t\t\t\tvar eventData = _pollView.getPosition();\n\t\t\t\t\t\teventData.uid = _pollView.uid;\n\n\t\t\t\t\t\tconn.sendEvent('POLL_VIEW_POSITION', eventData);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_pollView = _DEBUG.getViewByID(evt.args.uid);\n\t\t\t\tif (!_pollTimer && _pollView) {\n\t\t\t\t\t_pollTimer = setInterval(poll, 100);\n\t\t\t\t}\n\n\t\t\t\tif (!_pollView) {\n\t\t\t\t\tclearInterval(poll);\n\t\t\t\t\t_pollTimer = null;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.setApp = function (app) {\n\t\t\tthis._conn.sendEvent('APP_READY', {uid: app.view.uid});\n\t\t\tapp.engine.unsubscribe('Render', this);\n\t\t\tapp.engine.subscribe('Render', this._overlay, 'render');\n\t\t}\n\t});\n\n\nDebugInputHandler=__class__;\tvar DebugInputHandler=DebugInputHandler(function DebugInputHandler(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\t\tjsio(\"import device\");\n\t\tvar _simulateMouseMove = device.simulating && document.body.addEventListener;\n\n\t\tthis.init = function (conn) {\n\t\t\tthis.conn = conn;\n\t\t\tthis.onMouseMoveCapture = bind(this, this.onMouseMoveCapture);\n\t\t\tthis.setShiftDown = bind(this, this.setShiftDown);\n\t\t\tthis.onContextMenu = bind(this, this.onContextMenu);\n\n\t\t\tif (_simulateMouseMove) {\n\t\t\t\twindow.addEventListener('mousemove', this.onMouseMoveCapture, true);\n\n\t\t\t}\n\n\t\t\t//exports._overlay.setSize(GC.app.view.style.width, GC.app.view.style.height);\n\n\t\t\t//hacky hack to determine if the shift was set or not\n\t\t\twindow.addEventListener('mousedown', this.setShiftDown, true);\n\t\t\twindow.addEventListener('contextmenu', this.onContextMenu, true);\n\n\t\t\tGC.app.view.subscribe('InputMoveCapture', this, 'onInputMoveCapture');\n\t\t\t//GC.app.view.subscribe('InputStartCapture', this, 'onInputSelectCapture');\n\t\t}\n\n\t\tthis.setShiftDown = function (e) {\n\t\t\tif (e.which === 3 || e.button === 2) {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis._shiftDown = !!e.shiftKey;\n\n\t\t\tif (this._shiftDown) {\n\t\t\t\tthis.onInputSelectCapture(e);\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tjsio(\"import event.input.dispatch as dispatch\");\n\n\t\tthis.onContextMenu = function (e) {\n\t\t\tvar data = {\n\t\t\t\tpt: {x: e.pageX, y: e.pageY}\n\t\t\t};\n\n\t\t\t//get the views under the pointer\n\t\t\tvar clickEvt = {pt: [], trace: [], depth: 0};\n\t\t\tvar clickPt = new Point(e.pageX, e.pageY);\n\t\t\tdispatch.traceEvt(GC.app.view, clickEvt, clickPt);\n\n\t\t\tif (!clickEvt.trace.length) return;\n\t\t\tdata.active = clickEvt.trace[0].uid;\n\n\t\t\t//get the views under the pointer\n\t\t\tvar mockEvt = {pt: [], trace: [], depth: 0};\n\t\t\tvar mockPt = new Point(e.pageX, e.pageY);\n\n\t\t\tthis.traceEvt(GC.app.view, mockEvt, mockPt);\n\n\t\t\tdata.trace = [];\n\t\t\t//convert to small objects\n\t\t\tfor (var i = mockEvt.trace.length - 1, item; item = mockEvt.trace[i]; --i) {\n\t\t\t\tdata.trace.push({\n\t\t\t\t\tuid: item.view.uid,\n\t\t\t\t\ttag: item.view.getTag(),\n\t\t\t\t\tdepth: item.depth\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.conn.sendEvent('INPUT_TRACE', data);\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.destroy = function () {\n\t\t\tif (_simulateMouseMove) {\n\t\t\t\twindow.removeEventListener('mousedown', this.onMouseDownCapture, true);\n\t\t\t}\n\n\t\t\twindow.removeEventListener('mousedown', this.setShiftDown, true);\n\t\t\tGC.app.view.unsubscribe('InputMoveCapture', this, 'onInputMoveCapture');\n\t\t\t//GC.app.view.unsubscribe('InputStartCapture', this, 'onInputSelectCapture');\n\t\t}\n\n\t\tthis.onInputMoveCapture = function (evt, pt, allEvt, allPt) {\n\t\t\tvar trace = [];\n\n\t\t\t//loop backwards through the trace\n\t\t\tfor (var i = evt.trace.length - 1, view; view = evt.trace[i]; --i) {\n\t\t\t\ttrace.push(view.uid);\n\n\t\t\t\tvar superview = view.getSuperview();\n\t\t\t\twhile (superview && superview != evt.trace[i + 1]) {\n\t\t\t\t\ttrace.push(superview.uid);\n\t\t\t\t\tsuperview = superview.getSuperview();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar data = {\n\t\t\t\tx: pt.x,\n\t\t\t\ty: pt.y,\n\t\t\t\ttrace: trace\n\t\t\t};\n\n\t\t\tthis.conn.sendEvent('INPUT_MOVE', data);\n\t\t}\n\n\t\tthis.onInputSelectCapture = function (e) {\n\t\t\t//only send event if shift click\n\n\n\t\t\tvar evt = {pt: [], trace: [], depth: 0};\n\t\t\tvar pt = new Point(e.pageX, e.pageY);\n\t\t\tdispatch.traceEvt(GC.app.view, evt, pt);\n\n\t\t\tvar trace = [];\n\t\t\tfor (var i = evt.trace.length - 1, view; view = evt.trace[i]; --i) {\n\t\t\t\ttrace.push(view.uid);\n\n\t\t\t\tvar superview = view.getSuperview();\n\t\t\t\twhile (superview && superview != evt.trace[i + 1]) {\n\t\t\t\t\ttrace.push(superview.uid);\n\t\t\t\t\tsuperview = superview.getSuperview();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar data = {\n\t\t\t\tx: pt.x,\n\t\t\t\ty: pt.y,\n\t\t\t\ttrace: trace\n\t\t\t};\n\n\t\t\tthis.conn.sendEvent('INPUT_SELECT', data);\n\t\t}\n\n\t\tthis.traceEvt = function (view, evt, pt, depth) {\n\t\t\tdepth = depth || 0;\n\n\t\t\tvar localPt = view.style.localizePoint(new Point(pt));\n\n\t\t\t//if the point is contained add it to the trace\n\t\t\tif (view.containsLocalPoint(localPt)) {\n\t\t\t\tevt.trace.unshift({view: view, depth: depth});\n\t\t\t\tevt.pt[view.uid] = localPt;\n\t\t\t}\n\n\t\t\tvar subviews = view.getSubviews();\n\t\t\tfor (var i = subviews.length - 1; i >= 0; --i) {\n\t\t\t\tif (subviews[i].style.visible) {\n\t\t\t\t\t\tthis.traceEvt(subviews[i], evt, localPt, depth + 1);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (subviews.length === 0) {\n\t\t\t\tevt.target = view;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\n\t\tthis.onMouseMoveCapture = function (e) {\n\t\t\t//$.stopEvent(e);\n\n\t\t\t//get the event to the active target\n\t\t\tvar mockEvt = {pt: [], trace: [], depth: 0};\n\t\t\tvar mockPt = new Point(e.pageX, e.pageY);\n\t\t\tdispatch.traceEvt(GC.app.view, mockEvt, mockPt);\n\n\t\t\tthis.onInputMoveCapture(mockEvt, mockPt);\n\t\t}\n\t});\n}\n","pre":true},"sdk/gc/debugging/OverlayRenderer.js":{"path":"sdk/gc/debugging/OverlayRenderer.js","friendlyPath":".OverlayRenderer","directory":"sdk/gc/debugging/","filename":"OverlayRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// this whole file should not get included in release\nif (DEBUG) {\n\tjsio(\"import device\");\n\nvar sdk_gc_debugging_OverlayRenderer=__class__;\tvar OverlayRenderer = exports=sdk_gc_debugging_OverlayRenderer(function sdk_gc_debugging_OverlayRenderer(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\t\n\t\t// store the views we need to render\n\t\tthis._highlightViewUID = null;\n\t\tthis.setHighlight = function (uid) { this._highlightViewUID = uid; }\n\n\t\tthis._selectedViewUID = null;\n\t\tthis.setSelected = function (uid) { this._selectedViewUID = uid; }\n\n\t\tvar tick = 0;\n\t\tvar maxColor = 255;\n\t\tvar minColor = 100;\n\n\t\t//render the highlighted view\n\t\tvar _now = +new Date();\n\t\tvar _t = 0;\n\t\tfunction renderHighlight (pos, ctx) {\n\t\t\tif (!ctx) { return; }\n\t\t\tctx.save();\n\t\t\tctx.translate(pos.x, pos.y);\n\t\t\tctx.rotate(pos.r);\n\n\t\t\t// pulsate the blue\n\t\t\ttick += -(_now - (_now = new Date()));\n\n\t\t\tvar weight = (Math.sin(2 * Math.PI * tick / 1000) + 1) / 2;\n\t\t\tvar val = (weight * (maxColor - minColor)) + minColor | 0;\n\n\n\t\t\tvar color = '0,' + (val * .7 | 0) + ',' + (val | 0);\n\n\t\t\tctx.strokeStyle = 'rgba(' + color + ', 0.7)';\n\t\t\tctx.strokeRect(0, 0, pos.width, pos.height);\n\t\t\tctx.fillStyle = 'rgba(' + color + ', 0.6)';\n\t\t\tctx.fillRect(0, 0, pos.width, pos.height);\n\n\t\t\t//draw the cross hair\n\t\t\t//ctx.fillStyle = 'rgb(' + val + ',' + val + ',' + val +')';\n\t\t\tvar opacity = weight * (1 - 0.4) + 0.4;\n\t\t\tctx.fillStyle = 'rgba(255,255,255,' + (opacity.toFixed(2)) +')';\n\t\t\tctx.translate(pos.anchorX, pos.anchorY);\n\t\t\tctx.rotate(tick / 500);\n\n\t\t\tctx.fillRect(-0.5, -7, 1, 14);\n\t\t\tctx.fillRect(-7, -0.5, 14, 1);\n\n\t\t\tctx.restore();\n\t\t};\n\n\t\tfunction renderSelected (pos, ctx) {\n\t\t\tif (!ctx) { return; }\n\n\t\t\tctx.save();\n\t\t\tctx.translate(pos.x, pos.y);\n\t\t\tctx.rotate(pos.r);\n\t\t\tctx.strokeStyle = \"red\";\n\t\t\tctx.lineWidth = 1;\n\t\t\tctx.strokeRect(-0.5, -0.5, pos.width + 1, pos.height + 1);\n\t\t\tctx.restore();\n\t\t};\n\n\t\tif (!device.isMobile) {\n\t\t\tvar element = document.createElement('x');\n\t\t\tvar documentElement = document.documentElement;\n\t\t\tvar getComputedStyle = window.getComputedStyle;\n\t\t\tvar supportsPointerEvents = false;\n\t\t\tif (element && ('pointerEvents' in element.style)) {\n\t\t\t\telement.style.pointerEvents = 'auto';\n\t\t\t\telement.style.pointerEvents = 'x';\n\t\t\t\tdocumentElement.appendChild(element);\n\t\t\t\tsupportsPointerEvents = getComputedStyle && getComputedStyle(element, '').pointerEvents === 'auto';\n\t\t\t\tdocumentElement.removeChild(element);\n\t\t\t}\n\n\t\t\tif (device.simulating && document.body && document.body.appendChild && supportsPointerEvents) {\n\t\t\t\tvar canvas = new (device.get('Canvas'))();\n\t\t\t\tcanvas.style.cssText = 'position: absolute; left: 0; top: 0; z-index: 1000; pointer-events: none;';\n\t\t\t\tdocument.body.appendChild(canvas);\n\n\t\t\t\tthis.constructor.ctx = canvas.getContext('2d');\n\t\t\t}\n\t\t}\n\n\t\t// used to drive renderer separately when app is paused\n\t\tthis.startTick = function () {\n\t\t\tthis.stopTick();\n\t\t\tthis._tick = setInterval(bind(this, 'render'), 1000 / 30);\n\t\t};\n\n\t\t// used to stop renderer's timer when app is unpaused\n\t\tthis.stopTick = function () {\n\t\t\tif (this._tick) {\n\t\t\t\tclearInterval(this._tick);\n\t\t\t}\n\t\t};\n\n\t\tthis.setEnabled = function (isEnabled) {\n\t\t\tthis._isEnabled = isEnabled;\n\t\t\tif (OverlayRenderer.ctx) {\n\t\t\t\tOverlayRenderer.ctx.clear();\n\t\t\t}\n\t\t};\n\n\t\tthis.render = function (ctx) {\n\t\t\tif (!ctx) { return; }\n\t\t\t// if (!this._isEnabled) { return; }\n\n\t\t\t// on simulated devices, we have our own canvas\n\t\t\t// so size it to fit the screen (clearing it too)\n\t\t\tif (OverlayRenderer.ctx) {\n\t\t\t\tctx = OverlayRenderer.ctx;\n\t\t\t\tctx.canvas.width = device.screen.width;\n\t\t\t\tctx.canvas.height = device.screen.height;\n\t\t\t}\n\n\t\t\t// render highlighted views\n\t\t\tif (this._highlightViewUID !== null) {\n\t\t\t\tvar view = _DEBUG.getViewByID(this._highlightViewUID);\n\t\t\t\tvar pos = view && view.getPosition();\n\t\t\t\tif (pos) renderHighlight(pos, ctx);\n\t\t\t}\n\n\t\t\t// render selected views\n\t\t\tif (this._selectedViewUID !== null) {\n\t\t\t\tvar view = _DEBUG.getViewByID(this._selectedViewUID);\n\t\t\t\tvar pos = view && view.getPosition();\n\t\t\t\tif (pos) renderSelected(pos, ctx);\n\t\t\t}\n\t\t};\n\t});\n}\n\n","pre":true},"sdk/gc/API.js":{"path":"sdk/gc/API.js","friendlyPath":"gc.API","directory":"sdk/gc/","filename":"API.js","src":"/** @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// Import this before importing GC\n// _api.client.init sets up the GC object for the client apis\n\njsio(\"import lib.PubSub\");\njsio(\"import lib.Callback\");\njsio(\"import std.uri as URI\");\njsio(\"import ui.Engine\");\njsio(\"import ui.View\");\njsio(\"import ui.StackView\");\n\njsio(\"import device\");\n\nif (device.simulatingMobileNative) {\n\tjsio('import .debugging.nativeShim');\n}\n\nif (!GLOBAL.CONFIG) { GLOBAL.CONFIG = {}; }\nif (!GLOBAL.DEBUG) { GLOBAL.DEBUG = false; }\n\nif (GLOBAL.CONFIG.isMuted) {\n\tjsio(\"import AudioManager\");\n\tGLOBAL.ACCESSIBILITY.mute(true);\n}\n\nvar sdk_gc_API=__class__;exports=sdk_gc_API(function sdk_gc_API(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\n\tvar ua = navigator.userAgent;\n\tthis.isNative = /TeaLeaf/.test(ua);\n\tif (this.isNative) {\n\t\tthis.isIOS = /iPhone OS/.test(ua);\n\t\tthis.isAndroid = /Android/.test(ua);\n\t} else if (/(iPod|iPhone|iPad)/i.test(ua)) {\n\t\tthis.isMobileBrowser = true;\n\t\tthis.isIOS = true;\n\t\tthis.isUIWebView = !/Safari/.test(ua);\n\t} else if (/Android/.test(ua)) {\n\t\tthis.isMobileBrowser = true;\n\t\tthis.isAndroid = true;\n\t} else {\n\t\tthis.isDesktop = true;\n\t\tthis.isFacebook = GLOBAL.CONFIG.isFacebookApp;\n\t}\n\n\tthis.init = function (opts) {\n\t\tif (DEBUG) {\n\t\t\tif (GLOBAL.window && window.top) {\n\t\t\t\ttry {\n\t\t\t\t\twindow.top.GC = GLOBAL.GC;\n\t\t\t\t} catch (e) {\n\t\t\t\t\t//window.top is read-only in firefox\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (GLOBAL.ADDON_SOCIAL && ADDON_SOCIAL) {\n\t\t\tjsio(\"import GCSocial.GCSocial\", {suppressErrors: true});\n\t\t\tthis.social = GCSocial.GCSocial;\n\t\t\t\n\t\t\tGLOBAL.gcsocial = this.social; // deprecated\n\n\t\t\tthis.social.init({\n\t\t\t\tappID: GLOBAL.CONFIG.appID,\n\t\t\t\tshortName: GLOBAL.CONFIG.shortName,\n\t\t\t\tinviteURLTemplate: GLOBAL.CONFIG.inviteURLTemplate,\n\t\t\t\tendpoint: GLOBAL.CONFIG.servicesURL,\n\t\t\t});\n\n\t\t\tthis.track = gcsocial.tracker;\n\t\t}\n\n\t\twindow.addEventListener('pageshow', bind(this, '_onShow'), false);\n\n\t\twindow.addEventListener('pagehide', bind(this, '_onHide'), false);\n\n\t\tthis.isOnline = navigator.onLine;\n\n\t\twindow.addEventListener('online', bind(this, function () {\n\t\t\tif (!this.isOnline) {\n\t\t\t\tthis.isOnline = true;\n\t\t\t\tthis.publish('OnlineStateChanged', true);\n\t\t\t}\n\t\t}), false);\n\n\t\twindow.addEventListener('offline', bind(this, function () {\n\t\t\tif (this.isOnline) {\n\t\t\t\tthis.isOnline = false;\n\t\t\t\tthis.publish('OnlineStateChanged', false);\n\t\t\t}\n\t\t}), false);\n\n\t\t// var uri = new URI(window.location);\n\t\t// var campaign = uri.query('campaign') || \"NO CAMPAIGN\";\n\t\t//\n\t\t// XXX: The following lines cause a DOMException in some browsers\n\t\t// because we're using a <base> tag, which doesn't resolve the URL relative correctly.\n\t\t//get rid of it in case the game uses something\n\t\t// if (window.history && window.history.replaceState) {\n\t\t// \thistory.replaceState(null, null, uri.toString().replace(\"?campaign=\" + campaign, \"\"));\n\t\t// }\n\t\t//\n\t\t// if (!localStorage.getItem(\"campaignID\")) {\n\t\t// \tlocalStorage.setItem(\"campaignID\", campaign)\n\t\t// }\n\n\n\t\tif (CONFIG.version) {\n\t\t\tlogger.log('Version', CONFIG.version);\n\t\t}\n\t}\n\n\tGLOBAL.GC = new this.constructor();\n\n\tGC.Application = ui.StackView;\n\n\t// this.track({\n\t// \tname: \"campaignID\",\n\t// \tcategory: \"campaign\",\n\t// \tsubcategory: \"id\",\n\t// \tdata: campaign\n\t// });\n\n\tjsio(\"import .UI\");\n\tGC.ui = new UI();\n\n\t// import .OverlayAPI;\n\t// GC.overlay = new OverlayAPI(this.env);\n\t\n\tvar map;\n\n\ttry {\n\t\tif (GLOBAL.CACHE) {\n\t\t\tmap = JSON.parse(GLOBAL.CACHE['spritesheets/map.json']);\n\t\t}\n\t} catch (e) {\n\t\tlogger.warn(\"spritesheet map failed to parse\", e);\n\t}\n\t\t\n\tjsio(\"import ui.resource.loader\");\n\tGC.resources = ui.resource.loader;\n\tGC.resources.setMap(map);\n\n\tif (GC.env == 'browser') { setTimeout(bind(this, '_onShow'), 0); }\n\n\tthis._onHide = function () {\n\t\t// signal to the app that the window is going away\n\t\tthis.app && this.app.onPause && this.app.onPause();\n\n\t\tthis.publish('Hide');\n\t\tthis.publish('AfterHide');\n\n\t\tif (this.tracker) {\n\t\t\tthis.tracker.endSession();\n\t\t}\n\t};\n\n\tthis._onShow = function () {\n\t\tthis.app && this.app.onResume && this.app.onResume();\n\n\t\tthis.publish('Show');\n\t\tthis.publish('AfterShow');\n\t}\n\n\tthis.buildApp = function (entry) {\n\t\tjsio(\"import src.Application as Application\");\n\n\t\tApplication.prototype.__root = true;\n\t\tthis.app = new Application();\n\t\tthis.buildEngine(merge({view: this.app}, this.app._settings));\n\t\treturn this.app;\n\t}\n\n\tthis.buildEngine = function (opts) {\n\t\tif (!opts) { opts = {}; }\n\t\tif (!opts.entry) { opts.entry = 'launchUI'; }\n\n\t\tvar view = opts.view;\n\t\tif (!view) {\n\t\t\tthrow \"a timestep.Engine must be created with a root view\";\n\t\t}\n\n\t\tif (!(view instanceof ui.View)) {\n\t\t\tthrow \"src/Application.js must export a Class that inherits from ui.View\";\n\t\t}\n\n\t\tview.subscribe('onLoadError', this, '_onAppLoadError');\n\n\t\tvar launch;\n\t\tif (typeof view[opts.entry] == 'function') {\n\t\t\tlaunch = bind(view, opts.entry);\n\t\t}\n\n\t\tview.view = view; // legacy, deprecated\n\t\tview.engine = new ui.Engine(opts);\n\t\tview.engine.show();\n\t\tview.engine.startLoop();\n\n\t\tview.initUI && view.initUI();\n\n\t\tvar settings = view._settings || {};\n\t\tvar preload = settings.preload;\n\t\tvar autoHide = CONFIG.splash && (CONFIG.splash.autoHide !== false);\n\t\tif (preload && preload.length) {\n\t\t\tvar cb = new lib.Callback();\n\t\t\tfor (var i = 0, group; group = preload[i]; ++i) {\n\t\t\t\tGC.resources.preload(group, cb.chain());\n\t\t\t}\n\n\t\t\t// note that hidePreloader takes a null cb argument to avoid\n\t\t\t// forwarding the preloader result as the callback\n\t\t\tif (autoHide) { cb.run(GC, 'hidePreloader', null); }\n\t\t\tif (launch) { cb.run(launch); }\n\t\t} else {\n\t\t\tif (autoHide) { GC.hidePreloader(); }\n\t\t\tlaunch && launch();\n\t\t}\n\t};\n\n\tthis._onAppLoadError = function (error) {\n\t\tlogger.error('encountered error when creating src Application: ', JSON.stringify(error));\n\t\tvar splash = CONFIG.splash;\n\t\tif (splash && splash.onAppLoadError) {\n\t\t\tsplash.onAppLoadError(error);\n\t\t}\n\t};\n\n\tthis.hidePreloader = function (cb) {\n\t\tvar splash = CONFIG.splash;\n\t\tif (splash && splash.hide && !splash.hidden) {\n\t\t\tsplash.hide(cb);\n\t\t\tsplash.hidden = true;\n\t\t} else {\n\t\t\tcb && cb();\n\t\t}\n\t};\n});","pre":true},"sdk/gc/debugging/nativeShim.js":{"path":"sdk/gc/debugging/nativeShim.js","friendlyPath":".debugging.nativeShim","directory":"sdk/gc/debugging/","filename":"nativeShim.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import lib.PubSub\");\njsio(\"import lib.Callback\");\n\nvar testContactList = [\n];\n\n// for (var i = testContactList.length; i < 1000; ++i) {\n// \ttestContactList.push({id: i, name: username(), phones: [{number: '123456789'}]});\n// }\n\nexports.backButton = new lib.PubSub();\n\nexports.dialogs = {\n\t\n\tshowDialog: function () {\n\t\tlogger.log(\"Showing a dialog!\");\n\t},\n\n\tshowAppRater: function () {\n\t\tlogger.log(\"Showing rate dialog!\");\n\t}\n\n};\n\n\nvar _withContacts = new lib.Callback();\n_withContacts.fire();\n\nexports.contacts = merge(new lib.PubSub(), {\n\t\n\tgetContactList: function () {\n\t\treturn testContactList;\n\t},\n\n\twithContacts: function () { _withContacts.forward(arguments); },\n\n\tsendAutomatedSMS: function (phone, msg, cb) {\n\t\tlogger.log('Send Automated SMS:', phone, msg);\n\t\tcb && cb();\n\t},\n\n\tsendSMS: function (phone, msg, cb) {\n\t\tlogger.log('Send SMS:', phone, msg);\n\t\tcb && cb();\n\t},\n\n\tgetPicture: function (id) {\n\t\treturn null;\n\t},\n\t\n\tgetPictures: function (ids) {\n\t\treturn null;\n\t},\n\n\tgetPictureBase64: function (id) {\n\t\treturn null;\n\t}\n\n});\n\nvar _withPhoneNumber = new lib.Callback();\n_withPhoneNumber.fire(null);\n\nvar _withPhoneNumber = new lib.Callback();\n_withPhoneNumber.fire(null);\n\nexports.profile = {\n\tfullName: \"\",\n\n\tgetPicture: function (id) {\n\t\treturn null;\n\t},\n\n\tgetPictureBase64: function (id) {\n\t\treturn null;\n\t},\n\n\twithPhoneNumber: function () { _withPhoneNumber.forward(arguments); }\n};\n\n\nexports.sound = {\n\tplaySound: function (url, volume) {\n\t\tlogger.log('this would play a sound on native');\n\t},\n\tloadSound: function (url) {\n\t\tlogger.log('this would load a sound on native');\n\t},\n\tpauseSound: function (url) {\n\t\tlogger.log('this would pause a sound on native');\n\t},\n\tstopSound: function (url) {\n\t\tlogger.log('this would stop a sound on native');\n\t},\n\tsetVolume: function (url, volume) {\n\t\tlogger.log('this would set the volume of a sound on native');\n\t},\n\tloadBackgroundMusic: function (url) {\n\t\tlogger.log('this would load background music on native');\n\t},\n\tplayBackgroundMusic: function (url) {\n\t\tlogger.log('this would play background music on native');\n\t},\n\tregisterMusic: function (url) {\n\t\tlogger.log('this would register background music on native');\n\t}\n};\n\nexports.alerts = new lib.PubSub();\nmerge(exports.alerts, {\n\tonNotificationLoad: function () {},\n\tshowNotification: function () {\n\t\treturn -1;\n\t},\n\tshowRecurringNotification: function () {\n\t\tlogger.log(\"Setting up a recurring notification!\");\n\t\treturn -1;\n\t}\n});\n\nexports.social = new lib.PubSub();\n\n//import .auth.conn;\n//auth.conn.webAutoLogin();\n\nif (!GLOBAL.NATIVE) { GLOBAL.NATIVE = exports; }\n","pre":true},"sdk/gc/UI.js":{"path":"sdk/gc/UI.js","friendlyPath":".UI","directory":"sdk/gc/","filename":"UI.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"from util.browser import $\");\njsio(\"import std.uri\");\njsio(\"import std.js as JS\");\njsio(\"import lib.Iterator\");\njsio(\"import lib.Callback\");\njsio(\"import device\");\njsio(\"import ui.widget.Spinner as Spinner\"); \n\nvar config = window.CONFIG;\n\nlogger.log(\"ITS \", GLOBAL.HTMLCanvasElement);\nvar uiExports = {\n\tGCView: function () {\n\t\tjsio(\"import ui.View\");\n\t\treturn ui.View;\n\t},\n\tGCImage: function () {\n\t\tjsio(\"import ui.resource.Image\");\n\t\treturn ui.resource.Image;\n\t},\n\tGCImageView: function () {\n\t\tjsio(\"import ui.ImageView\");\n\t\treturn ui.ImageView;\n\t},\n\tGCCanvas: getCanvasCtor,\n\tGCSprite: function () {\n\t\tjsio(\"import ui.SpriteView\");\n\t\treturn ui.SpriteView;\n\t},\n\tGCResources: function () { // deprecated\n\t\tjsio(\"import ui.resource.loader\");\n\t\treturn ui.resource.loader;\n\t}\n};\n\nvar sdk_gc_UI=__class__;exports=sdk_gc_UI(function sdk_gc_UI(){return this.init&&this.init.apply(this,arguments)},function () {\n\tvar loader = null;\n\tthis.cssFile = function (path, cb) {\n\t\t//if (!loader) { loader = jsio('import squill.cssLoad'); }\n\n\t\t// load from cache\n\t\tvar textContent = CACHE[path];\n\t\tif (textContent) {\n\t\t\t$({tag: 'style', text: textContent, parent: document.getElementsByTagName('head')[0]});\n\t\t\tsetTimeout(cb, 0);\n\t\t}\n\t\t\n\t\t//loader.get(path, cb);\n\t}\n\t\n\tthis._spinnerCounter = 0;\n\n\tjsio(\"import device\");\n\n\tvar baseScale;\n\tif (navigator.displayMetrics) {\n\t\tbaseScale = navigator.displayMetrics.densityDpi / 160;\n\t} else if (!CONFIG.scaleDPR && device.isMobileBrowser) {\n\t\tbaseScale = 1;\n\t} else {\n\t\tbaseScale = window.devicePixelRatio || 1;\n\t}\n\n\tthis._scale = baseScale;\n\n\tthis.setTargetDensity = function (target) {\n\t\tswitch (target) {\n\t\t\tcase 'high':\n\t\t\t\tthis._scale = baseScale * 0.5;\n\t\t\t\tbreak;\n\t\t\tcase 'medium':\n\t\t\t\tthis._scale = baseScale * 0.75;\n\t\t\t\tbreak;\n\t\t\tcase 'low':\n\t\t\tdefault:\n\t\t\t\tthis._scale = baseScale;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlogger.log('scale:', this._scale);\n\t}\n\n\tthis.getScale = function () {\n\t\treturn this._scale;\n\t}\n\n\tthis.getIntValue = function (val) {\n\t\treturn Math.round(val * this._scale) / this._scale;\n\t}\n\n\tthis.showSpinner = function () {\n\t\tif (this._spinnerCounter) {\n\t\t\t++this._spinnerCounter;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar parent = GC.app.view;\n\t\tif (!parent) { return; }\n\t\t\n\t\t++this._spinnerCounter;\n\t\t\n\t\tif (!this._spinner) {\n\t\t\tvar dim = device.screen.devicePixelRatio * 50;\n\t\t\tthis._spinner = new Spinner({\n\t\t\t\twidth: dim,\n\t\t\t\theight: dim,\n\t\t\t\tx: parent.style.width / 2 - dim / 2,\n\t\t\t\ty: parent.style.height / 2 - dim / 2,\n\t\t\t\tparent: parent\n\t\t\t});\n\t\t} else {\n\t\t\tparent.addSubview(this._spinner);\n\t\t}\n\t}\n\t\n\tthis.hideSpinner = function () {\n\t\t--this._spinnerCounter;\n\t\tif (this._spinnerCounter <= 0) {\n\t\t\tthis._spinnerCounter = 0;\n\t\t\t\n\t\t\tthis._spinner && this._spinner.removeFromSuperview();\n\t\t}\n\t}\n\t\n\t// this.showDisplayNameDialog = function () {\n\t// \tthis.getDisplayNameDialog().show();\n\t// }\n\t\n\t// this.showAcceptInviteDialog = function (cb) {\n\t// \tGC.getConnection().withHandshake(this, function (err) {\n\t// \t\tif (err) { cb(err); return; }\n\t\t\t\n\t// \t\t// TODO: conn.getLoginDetails()\n\t// \t\tlogger.warn('put some real details in here');\n\n\t// \t\tvar details = {\n\t// \t\t\tfrom: 'Martin',\n\t// \t\t\tgame: 'Chess',\n\t// \t\t\tsummary: 'chess, 15 min, rated'\n\t// \t\t};\n\t\t\t\n\t// \t\tvar dialog = this.getAcceptInviteDialog();\n\t// \t\tdialog.setDetails(details);\n\t// \t\tdialog.delegate = function (action) {\n\t// \t\t\tswitch (action) {\n\t// \t\t\t\tcase 'accept':\n\t// \t\t\t\t\tGC.app.launchMultiplayerGame();\n\t// \t\t\t\t\tbreak;\n\t// \t\t\t\tcase 'decline':\n\t// \t\t\t\tdefault:\n\t// \t\t\t\t\tcb(action);\n\t// \t\t\t\t\tbreak;\n\t// \t\t\t}\n\t// \t\t};\n\t\t\t\n\t// \t\tdialog.show();\n\t\t\t\n\t// \t\tcb && cb('opened');\n\t// \t});\n\t// }\n\t\n\t// this.showChat = function () {\n\t// \tif (!this._chatMenu) {\n\t// \t\timport GCMenus.Chat;\n\t// \t\tthis._chatMenu = new GCMenus.Chat();\n\t// \t}\n\t\t\n\t// \tvar menuController = this.getMenuController();\n\t// \tif (menuController.isVisible()) {\n\t// \t\tmenuController.push(this._chatMenu);\n\t// \t} else {\n\t// \t\tmenuController.push(this._chatMenu, true);\n\t// \t\tmenuController.fadeIn();\n\t// \t\tthis._chatMenu.subscribeOnce('BeforeHide', this, function () {\n\t// \t\t\tmenuController.fadeOut();\n\t// \t\t});\n\t// \t}\n\t// }\n\t\n\t// this.alert = function (msg) {\n\t// \tthis.showDialog({title: '', message: msg});\n\t// }\n\t\n\t// this.showError = function (opts) {\n\t// \tthis.showDialog(merge(opts, {title: 'Error:', message: \"Sorry!\"}));\n\t// }\n\t\n\t// this.showDialog = function (opts) {\n\t// \timport GCDialogs.AlertDialog;\n\t// \tvar dialog = new GCDialogs.AlertDialog(opts);\n\t// \tdialog.show();\n\t// \treturn dialog;\n\t// }\n\t\n\t// this.getAcceptInviteDialog = function () {\n\t// \tif (!this._acceptInviteDialog) {\n\t// \t\timport GCDialogs.AcceptInviteDialog;\n\t// \t\tthis._acceptInviteDialog = new GCDialogs.AcceptInviteDialog();\n\t// \t}\n\t\t\n\t// \treturn this._acceptInviteDialog;\n\t// }\n\t\n\t// this.getDisplayNameDialog = function () {\n\t// \tif (!this._displayNameDialog) {\n\t// \t\timport GCDialogs.DisplayNameDialog;\n\t// \t\tthis._displayNameDialog = new GCDialogs.DisplayNameDialog();\n\t// \t}\n\t\t\n\t// \treturn this._displayNameDialog;\n\t// }\n\t\n\t// this.getParentNode = function () {\n\t// \tif (!this._parentNode) {\n\t// \t\timport timestep.doc;\n\t// \t\tthis._parentNode = timestep.doc.getElement();\n\t// \t}\n\t// \treturn this._parentNode;\n\t// }\n\t\n\t// this.showMainMenu = function (opts) {\n\t// \topts = merge(opts, {\n\t// \t\tfade: true,\n\t// \t\tbackToGame: false\n\t// \t});\n\t\t\n\t// \tvar controller = this.getMenuController();\n\t// \tvar mainMenu = this.getMainMenu();\n\t// \tmainMenu.setGameRunning(opts.backToGame);\n\t// \tcontroller.push(mainMenu);\n\t// \tif (opts.fade) { controller.fadeIn(); }\n\t// }\n\t\n\t// this.fadeOutMenus = function () { this.getMenuController().fadeOut(); }\n\t// this.fadeInMenus = function () { this.getMenuController().fadeIn(); }\n\t\n\t// this.getMenuController = function () {\n\t// \tif (!this._menuController) {\n\t// \t\timport GCMenus.MainMenu;\n\t// \t\timport squill.MenuController;\n\t// \t\tthis._menuController = new squill.MenuController({\n\t// \t\t\tcontroller: this,\n\t// \t\t\tparent: this.getParentNode(),\n\t// \t\t\tdelegate: GCMenus.MainMenu.delegate,\n\t// \t\t\tid: 'mainMenuController'\n\t// \t\t});\n\t// \t}\n\t\t\n\t// \treturn this._menuController;\n\t// }\n\t\n\t// this.getMainMenu = function () {\n\t// \tif (!this._mainMenu) {\n\t// \t\timport GCMenus.MainMenu;\n\t// \t\tthis._mainMenu = new GCMenus.MainMenu(merge(this._mainMenuOpts, {\n\t// \t\t\tsupports: {} //MANIFEST.supports\n\t// \t\t}));\n\t// \t}\n\t\t\n\t// \treturn this._mainMenu;\n\t// }\n\t\n\t// this.setMainMenuOpts = function (opts) {\n\t// \tthis._mainMenu = null;\n\t// \tthis._mainMenuOpts = merge(opts, {\n\t// \t\ttitle: 'Welcome!',\n\t// \t\timgLogo: 'resources/images/logo.png',\n\t// \t\timgSingle: 'resources/images/btnSingle.png',\n\t// \t\timgMulti: 'resources/images/btnMulti.png',\n\t// \t\tshowInvites: true,\n\t// \t\tshowGames: true,\n\t// \t\tquitGameOnShow: false\n\t// \t});\n\t\t\n\t// \treturn this;\n\t// }\n\t\n\t// this.getMainMenuOpts = function () { return this._mainMenuOpts; }\n\t\n\t// this.hideCursor = function () {\n\t// \tvar el = GC.app.getCanvas().getElement();\n\t// \tif (el) { el.style.cursor = 'none'; }\n\t// }\n\t\n\t// this.showCursor = function (name) {\n\t// \tvar el = GC.app.getCanvas().getElement();\n\t// \tif (el) { el.style.cursor = name || 'default'; }\n\t// }\n});\n\nvar cache = {};\nfor (var key in uiExports) {\n\tvar getter = bind(GLOBAL, function (key) {\n\t\t\treturn cache[key] || (cache[key] = uiExports[key]());\n\t\t}, key);\n\t\n\tif (GLOBAL.__defineGetter__) {\n\t\tGLOBAL.__defineGetter__(key, getter);\n\t} else {\n\t\tif (Object.defineProperty) {\n\t\t\tObject.defineProperty(GLOBAL, key, {get: getter});\n\t\t}\n\t}\n}\n\nfunction AsyncImageLoader(url, callback) {\n\tvar img = new ui.resource.Image({url: url});\n\timg.doOnLoad(function (success) { callback(img); });\n}\n\nfunction getCanvasCtor() {\n\tjsio(\"import device\");\n\tvar ctor = device.get('Canvas');\n\treturn ctor;\n}\n","pre":true},"sdk/jsio/lib/Iterator.js":{"path":"sdk/jsio/lib/Iterator.js","friendlyPath":"lib.Iterator","directory":"sdk/jsio/lib/","filename":"Iterator.js","src":"\"use import\";\n\n/**\n * Summary: Provides an object for iterating over the keys and values of\n * an object or array.  \n * Methods: \n *  - init(src) - src is the object to iterate over\n *  - next(): returns the current value and advances the iterator to the next value\n *  - loop(cb): iterate over all items immediately, calling cb with each item\n *  - asyncLoop(cb): iterate over all items asynchronously.  First argument to\n *     the callback is the item.  Second argument is a function `nextItem` that, \n *     when called, will cause the iterator to advance to the next element and \n *     call cb again.\n * Usage notes: asyncLoop is implemented to not be vulnerable to stack overflows.\n *     If cb immediately calls the nextItem function, it will not immediately \n *     result in a call to cb -- the stack will unwind to the asyncLoop call \n *     before continuing.\n */\n\njsio(\"import std.js as JS\");\n\nvar sdk_jsio_lib_Iterator=__class__;exports=sdk_jsio_lib_Iterator(function sdk_jsio_lib_Iterator(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(src) {\n\t\tthis._src = src;\n\t\tthis._i = 0;\n\t\t\n\t\t// a call count prevents a stack overflow if the callback in\n\t\t// an aysncloop is called repeatedly for large arrays\n\t\tthis._calls = 0;\n\t\tif (JS.isArray(src)) {\n\t\t\tthis._isArray = true;\n\t\t} else if (Object.keys) {\n\t\t\tthis._keys = Object.keys(src);\n\t\t} else {\n\t\t\tvar k = this._keys = [];\n\t\t\tfor (var i in src) { if (src.hasOwnProperty(i)) { k.push(i); } }\n\t\t}\n\t}\n\t\n\tthis.nextKey = function() {\n\t\treturn this._keys[this._i++];\n\t}\n\t\n\tthis.next = function() {\n\t\tif (this._isArray) {\n\t\t\treturn this._src[this._i++] || exports.END_OF_LOOP;\n\t\t} else {\n\t\t\tvar key = this._keys[this._i++];\n\t\t\treturn key ? this._src[key] : exports.END_OF_LOOP;\n\t\t}\n\t}\n\t\n\tthis.loop = function(cb) {\n\t\tif (arguments.length > 1) { cb = bind.apply(this, arguments); }\n\t\tvar next;\n\t\tif (this._isArray) {\n\t\t\twhile((next = this.next())) {\n\t\t\t\tcb(next);\n\t\t\t}\n\t\t} else {\n\t\t\twhile((next = this.nextKey())) {\n\t\t\t\tcb(this._src[next], next);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tthis.asyncLoop = function(cb) {\n\t\tif (arguments.length > 1) { cb = bind.apply(this, arguments); }\n\t\tthis._next = bind(this, '_onReturn', cb);\n\t\tthis._calls++;\n\t\tthis._asyncLoop(cb);\n\t}\n\t\n\tthis._asyncLoop = function(cb) {\n\t\tthis._inLoop = true;\n\t\twhile (this._calls) {\n\t\t\t--this._calls;\n\t\t\tcb(this.next(), this._next);\n\t\t}\n\t\tthis._inLoop = false;\n\t}\n\t\n\tthis._onReturn = function(cb) {\n\t\tthis._calls++;\n\t\tif (!this._inLoop) { this._asyncLoop(cb); }\n\t}\n});\n\nexports.END_OF_LOOP = new Error('jsio.Iterator.END_OF_LOOP');\n","pre":true},"sdk/timestep/ui/widget/Spinner.js":{"path":"sdk/timestep/ui/widget/Spinner.js","friendlyPath":"ui.widget.Spinner","directory":"sdk/timestep/ui/widget/","filename":"Spinner.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.widget.Spinner;\n */\njsio(\"import ui.View as View\");\n\nvar sdk_timestep_ui_widget_Spinner=__class__;exports=sdk_timestep_ui_widget_Spinner(function sdk_timestep_ui_widget_Spinner(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tvar defaults = {\n\t\tcycles: 0.5,\n\t\tradius: 10,\n\t\tspokes: 20,\n\t\tthickness: 2,\n\t\ttrail: 10,\n\t\tcolor: '#ffffff',\n\t\tbackgroundColor: 'rgba(0, 0, 0, 0.5)',\n\t\tlayout: 'box'\n\t};\n\t\n\tthis.tag = 'Spinner';\n\tthis._t = 0;\n\t\n\tthis.init = function (opts) {\n\t\tthis._opts = merge(opts, defaults);\n\t\t\n\t\tthis._step = 2 * Math.PI / this._opts.spokes;\n\t\t\n\t\tsupr(this, 'init', [this._opts]);\n\t};\n\t\n\tthis.tick = function (dt) {\n\t\tthis._t += dt;\n\t\t\n\t\tvar r = (this._t / 1000 % (1 / this._opts.cycles)) * Math.PI;\n\t\t\n\t\tvar oldR = this._r;\n\t\tthis._r = r - (r % this._step);\n\t\t\n\t\tif (oldR != r) {\n\t\t\tthis.needsRepaint();\n\t\t}\n\t}\n\t\n\tthis.render = function (ctx) {\n\t\tctx.fillStyle = this._opts.backgroundColor;\n\t\t\n\t\tvar w = this.style.width,\n\t\t\t\th = this.style.height,\n\t\t\t\tradius = this._opts.radius,\n\t\t\t\ttrail = this._opts.trail,\n\t\t\t\tthickness = this._opts.thickness,\n\t\t\t\tx, y, i, j;\n\t\t\n\t\tfor (y = 0; y < radius; ++y) {\n\t\t\tj = y + 1;\n\t\t\tx = Math.round(radius - Math.sqrt(2 * j * radius - j * j));\n\t\t\tctx.fillRect(x, y, w - 2 * x, 1);\n\t\t}\n\t\t\n\t\ty = h - radius;\n\t\tctx.fillRect(0, radius, w, y - radius);\n\t\t\n\t\tfor (i = 0; i < radius; ++i) {\n\t\t\tj = radius - i;\n\t\t\tx = Math.round(radius - Math.sqrt(2 * j * radius - j * j));\n\t\t\tctx.fillRect(x, y + i, w - 2 * x, 1);\n\t\t}\n\t\t\n\t\tctx.fillStyle = this._opts.color;\n\t\tctx.translate(w / 2, h / 2);\n\t\tw /= 2;\n\t\tctx.rotate(this._r);\n\t\t\n\t\tfor (i = 0; i < this._opts.spokes; ++i) {\n\t\t\tctx.rotate(this._step);\n\t\t\tctx.globalAlpha = Math.max(0.1, (i - trail) / trail);\n\t\t\tctx.fillRect(10, -thickness / 2, w - 15, thickness);\n\t\t}\n\t}\n});\n","pre":true},"sdk/timestep/ui/SpriteView.js":{"path":"sdk/timestep/ui/SpriteView.js","friendlyPath":"ui.SpriteView","directory":"sdk/timestep/ui/","filename":"SpriteView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.SpriteView\n * SpriteView pulls out sprited images and renders them at a given FPS\n * interval. A sprite consists of multiple *animations* (walk, run,\n * etc) which themselves consist of multiple *frames*.\n *\n * The sprite system pulls images from a given source format. Given\n * images like the following:\n *\n *     someFolder/spriteName-animationName-0001.png\n *     someFolder/spriteName-animationName-0002.png\n *\n * You'd instantiate a Sprite like so:\n * \n *     var mySprite = new SpriteView({url: \"someFolder/spriteName\"})\n * \n * The SpriteView class automatically find the images associated with that\n * sprite and generates the configuration for each of the animations.\n *\n * Then you would call this to start an animation:\n *\n *     mySprite.startAnimation(\"animationName\");\n *\n * @doc http://doc.gameclosure.com/api/ui-spriteview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/spriteview.md\n */\n\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.resource.Image as Image\");\njsio(\"import ui.resource.loader\");\n\nvar sdk_timestep_ui_SpriteView=__class__;var SpriteView = exports=sdk_timestep_ui_SpriteView(function sdk_timestep_ui_SpriteView(){return this.init&&this.init.apply(this,arguments)},\"SpriteView\", ImageView, function (logger, supr) {\n\t\n\tthis.defaults = {\n\t\turl: null, // specified as a filename prefix, without an animation name or frame count\n\t\tgroupID: \"default\",\n\t\tframeRate: 15,\n\t\tdelay: 0,\n\t\temitFrameEvents: false,\n\t\tautoStart: false,\n\t\tloop: true\n\t};\n\n\tvar GROUPS = {};\n\n\tthis.init = function (opts) {\n\t\tthis._opts = opts = merge(opts, this.defaults);\n\t\topts.visible = false;\n\t\tsupr(this, 'init', [opts]);\n\t\tthis.resetAllAnimations(opts);\n\t};\n\n\tthis.resetAllAnimations = function (opts) {\n\t\tthis.stopAnimation();\n\n\t\tthis._opts = opts = merge(opts, this.defaults);\n\n\t\tvar animations = SpriteView.allAnimations[opts.url];\n\t\t\n\t\tthis.groupID = opts.groupID;\n\t\tthis.frameRate = opts.frameRate;\n\t\t\n\t\tif (!GROUPS[this.groupID]) {\n\t\t\tGROUPS[this.groupID] = new Group();\n\t\t}\n\n\t\tthis._animations = {};\n\n\t\tif (opts.sheetData) {\n\t\t\tvar w = opts.sheetData.width || opts.width;\n\t\t\tvar h = opts.sheetData.height || opts.height;\n\t\t\tfor (var animName in opts.sheetData.anims) {\n\t\t\t\tif (!this._opts.defaultAnimation) {\n\t\t\t\t\tthis._opts.defaultAnimation = animName;\n\t\t\t\t}\n\t\t\t\tthis.loadFromSheet(animName, opts.sheetData.url, w, h,\n\t\t\t\t\topts.sheetData.offsetX || w, opts.sheetData.offsetY || h,\n\t\t\t\t\topts.sheetData.startX || 0, opts.sheetData.startY || 0,\n\t\t\t\t\topts.sheetData.anims[animName]);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var animName in animations) {\n\t\t\t\tif (!this._opts.defaultAnimation) {\n\t\t\t\t\tthis._opts.defaultAnimation = animName;\n\t\t\t\t}\n\t\t\t\tthis.addAnimation(animName, animations[animName]);\n\t\t\t}\n\t\t}\n\n\t\tif (opts.autoSize && this._opts.defaultAnimation) {\n\t\t\tvar frameImages = this._animations[this._opts.defaultAnimation].frames;\n\t\t\tif (frameImages[0]) {\n\t\t\t\tthis.style.width = frameImages[0].getWidth();\n\t\t\t\tthis.style.height = frameImages[0].getHeight();\n\t\t\t}\n\t\t}\n\n\t\topts.autoStart && this.startAnimation(this._opts.defaultAnimation, opts);\n\t};\n\n\tthis.loadFromSheet = function (animName, sheetUrl, width, height, offsetX, offsetY, startX, startY, frames) {\n\t\tvar frameImages = [];\n\t\tfor (var i = 0; i < frames.length; i++) {\n\t\t\tframeImages.push(new Image({\n\t\t\t\turl: sheetUrl,\n\t\t\t\tsourceW: width,\n\t\t\t\tsourceH: height,\n\t\t\t\tsourceX: startX + frames[i][0] * offsetX,\n\t\t\t\tsourceY: startY + frames[i][1] * offsetY\n\t\t\t}));\n\t\t}\n\t\tthis._animations[animName] = {\n\t\t\tframes: frameImages\n\t\t};\n\t};\n\n\tthis.addAnimation = function (animName, frameData) {\n\t\tif ( ! isArray(frameData) ) {\n\t\t\tframeData = SpriteView.allAnimations[frameData][animName];\n\t\t}\n\t\tvar frameImages = [];\n\t\tfor (var i = 0, frame; frame = frameData[i]; i++) {\n\t\t\tframeImages.push(this.getImageFromCache(frame.url));\n\t\t}\n\t\tthis._animations[animName] = {\n\t\t\tframes: frameImages\n\t\t};\n\t};\n\t\n\t/** Returns a ui.resource.Image for the given animation's frame. */\n\tthis.getFrame = function (animName, index) {\n\t\treturn this._animations[animName].frames[index];\n\t};\n\n\t/** Returns the number of frames in a given animation. */\n\tthis.getFrameCount = function (animName) {\n\t\treturn this._animations[animName].frames.length;\n\t};\n\n\tthis.getGroup = function (groupID) {\n\t\treturn GROUPS[groupID || this.groupID];\n\t};\n\n\t/**\n\t * Starts an animation. Default options:\n\t *     loop: false\n\t *     iterations: 1\n\t *     callback: null (called at the end of the animation)\n\t *     frame: 0 (frame to start on)\n\t *     randomFrame: false (start on a random frame of the animation)\n\t */\n\tthis.startAnimation = function (name, opts) {\n\t\topts = opts || {};\n\n\t\tif ( opts.randomFrame === true && opts.frame == null ) {\n\t\t\topts.frame = Math.random() * this._animations[name].frames.length | 0;\n\t\t}\n\n\t\tif (opts.loop === true) { opts.iterations = Infinity; }\n\n\t\tthis._iterationsLeft = opts.iterations || 1;\n\t\tthis._callback = opts.callback || null;\n\t\tthis._currentAnimationName = name;\n\t\tthis._currentFrame = opts.frame || 0;\n\t\tthis._dt = 0;\n\t\tthis._delay = 0;\n\n\t\tif (!this._animations[name]) {\n\t\t\tthrow new Error(\"Animation \" + name + \" does not exist: \" + this._opts.url + \".\");\n\t\t}\n\n\t\tif (!this.isPlaying) {\n\t\t\tGC.app.engine.subscribe('Tick', this, '_tickSprite');\n\t\t\tGROUPS[this.groupID].add(this);\n\t\t\tthis.isPlaying = this.running = true;\n\t\t\tthis.style.visible = true;\n\t\t}\n\n\t\t// align the image for the first time\n\t\tthis._tickSprite(0);\n\t};\n\n\t/** Stops the current animation. This will make the sprite invisible. */\n\tthis.stopAnimation = function () {\n\t\tif (this.isPlaying) {\n\t\t\tthis.style.visible = false;\n\t\t\tGC.app.engine.unsubscribe('Tick', this, '_tickSprite');\n\t\t\tthis.isPlaying = this.running = false;  //use isPlaying, this.running is deprecated\n\t\t\tthis.isPaused = this._isPaused = false; //use isPaused instead, _isPaused is deprecated\n\t\t\tGROUPS[this.groupID].remove(this.uid);\n\t\t}\n\t};\n\n\t/**\n\t * If this animation doesn't loop, stops the animation entirely.\n\t * Otherwise restarts the default animation. For instance, if you\n\t * had a default animation \"idle\", you could call\n\t *\n\t *     startAnimation('walk', {iterations: 2});\n\t *\n\t * and after 2 iterations of the 'walk' animation, it would go\n\t * back to the 'walk' animation.\n\t */\n\tthis.resetAnimation = function () {\n\t\tif (!this._opts.loop) {\n\t\t\tthis.stopAnimation();\n\t\t} else {\n\t\t\tthis.startAnimation(this._opts.defaultAnimation);\n\t\t}\n\t};\n\n\tthis.setFramerate = function (fps) {\n\t\tthis.frameRate = fps || 0.00001;\n\t};\n\n\tthis.pause = function () {\n\t\tthis.isPaused = this._isPaused = true;\n\t};\n\n\tthis.resume = function () {\n\t\tthis.isPaused = this._isPaused = false;\n\t};\n\n\tthis._tickSprite = function (dt) {\n\t\tif (this.isPaused) { return; }\n\n\t\tdt += this._dt;\n\n\t\tif (this._delay) {\n\t\t\tthis._delay -= dt;\n\t\t\tif (this._delay < 0) {\n\t\t\t\tthis._delay = 0;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar anim = this._animations[this._currentAnimationName];\n\t\tvar stepTime = (1000 / this.frameRate);\n\t\tvar frameSteps = dt / stepTime | 0;\n\t\tvar prevFrame = this._currentFrame;\n\t\tthis._dt = dt - frameSteps * stepTime;\n\t\tthis._currentFrame = (this._currentFrame + frameSteps) % anim.frames.length;\n\n\t\tif (this._currentFrame < 0) {\n\t\t\tthis._currentFrame += anim.frames.length;\n\t\t}\n\t\t\n\t\tif (frameSteps !== 0 || dt === 0) {\n\t\t\tvar image = this._animations[this._currentAnimationName].frames[this._currentFrame];\n\t\t\tthis.setImage(image);\n\n\t\t\tif (this._opts.emitFrameEvents) {\n\t\t\t\tfor (var i = 0; i < frameSteps; i++) {\n\t\t\t\t\tvar frame = (prevFrame + i) % anim.frames.length;\n\t\t\t\t\tthis.publish(this._currentAnimationName + '_' + frame);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tvar iterationsCompleted = (prevFrame + frameSteps) / anim.frames.length | 0;\n\t\tif (iterationsCompleted) {\n\t\t\tthis._delay = this._opts.delay;\n\t\t\tif (--this._iterationsLeft <= 0) {\n\t\t\t\tvar cb = this._callback;\n\t\t\t\tthis._callback = null;\n\n\t\t\t\tthis.resetAnimation();\n\t\t\t\tif (cb) cb();\n\t\t\t}\n\t\t}\n\t};\n});\n\nSpriteView.allAnimations = {};\nSpriteView.getGroup = SpriteView.prototype.getGroup;\n\n(function loadAnimations() {\n\t// build the animation frame map\n\tvar resourceMap = ui.resource.loader.getMap();\n\tvar allAnimations = SpriteView.allAnimations;\n\n\t// Generate the animations from the filenames in resourceMap.\n\t// These names must be sorted ascending so that the frames end up\n\t// in the correct order.\n\tvar filenames = Object.keys(resourceMap);\n\tfilenames.sort();\n\n\t// Based on the filenames, add each image to an animation map (where applicable).\n\tfor (var i in filenames) {\n\t\tvar k = filenames[i];\n\t\t// split a filename like this: /resources/images/creature-walking-0001.png\n\t\t//       into parts like this: '    animKey     '  name  ' anim  ' #  '\n\t\tvar match = /((?:.*)\\/.*?)[-_ ](.*?)[-_ ](\\d+)/.exec(k);\n\t\tif (match) {\n\t\t\tvar animKey = match[1];\n\t\t\tvar name = match[2];\n\t\t\tvar frameNumber = match[3];\n\t\t\tvar anim = (allAnimations[animKey] || (allAnimations[animKey] = {}));\n\t\t\tvar frameList = (anim[name] || (anim[name] = []));\n\t\t\tvar info = resourceMap[k];\n\t\t\tinfo.url = k;\n\t\t\tframeList.push(info);\n\t\t}\n\t}\n})();\n\n\n/**\n * Group class\n */\nGroup=__class__;var Group=Group(function Group(){return this.init&&this.init.apply(this,arguments)},jsio.__filename, function (logger) {\n\n\tthis.init = function () {\n\t\tthis.sprites = {};\n\t};\n\n\tthis.add = function (sprite) {\n\t\tthis.sprites[sprite.uid] = sprite;\n\t};\n\n\tthis.remove = function (uid) {\n\t\tdelete this.sprites[uid];\n\t};\n\n\tthis.pause = function () {\n\t\tthis._forEachSprite('pause');\n\t};\n\n\tthis.resume = function () {\n\t\tthis._forEachSprite('resume');\n\t};\n\n\tthis.stopAnimation = function () {\n\t\tthis._forEachSprite('stopAnimation');\n\t};\n\n\tthis.resetAnimation = function () {\n\t\tthis._forEachSprite('resetAnimation');\n\t};\n\n\tthis._forEachSprite = function (method) {\n\t\tfor (var i in this.sprites) {\n\t\t\tthis.sprites[i][method]();\n\t\t}\n\t};\n});\n","pre":true},"./src/Application.js":{"path":"./src/Application.js","friendlyPath":"src.Application","directory":"./src/","filename":"Application.js","baseMod":"src","basePath":".","src":"jsio(\"import ui.TextView as TextView\");\njsio(\"import plugins.weeby.Weeby as Weeby\");\n\nvar src_Application=__class__;exports=src_Application(function src_Application(){return this.init&&this.init.apply(this,arguments)},GC.Application, function () {\n\n\tthis.initUI = function () {\n\t\tvar textview = new TextView({\n\t\t\tsuperview: this.view,\n\t\t\tlayout: \"box\",\n\t\t\ttext: \"Hello, world!\",\n\t\t\tcolor: \"white\"\n\t\t});\n\t};\n\t\n\tthis.launchUI = function () {\n\t\tWeeby.getGameView();\n\t\tWeeby.launchUI();\n\t\tWeeby.on('StartGame', bind(this, 'onStartGame'));\n\n\t\tNATIVE.events.registerHandler('WeebyFinishGame', function(opts) {\n\t\t\tvar state = JSON.parse(opts.state);\n\t\t\tstate.score |= 0;\n\t\t\tif (state.currency) {\n\t\t\t\tstate.currency.common |= 0;\n\t\t\t\tstate.currency.commonSpent |= 0;\n\t\t\t\tstate.currency.premium |= 0;\n\t\t\t\tstate.currency.premiumSpent |= 0;\n\t\t\t}\n\t\t\tWeeby.finishGame(state);\n\t\t});\n\t};\n\n\tthis.onStartGame = function(opts) {\n\t\tNATIVE && NATIVE.plugins.sendEvent(\"WeebyPlugin\", 'launchExternalGame', JSON.stringify({gameType:\"unity\", state: opts}));\n\t\t//call send an intent\n\t\t//Weeby.startUnityGame();\n\t}\n});\n","pre":true},"sdk/plugins/weeby/Weeby.js":{"path":"sdk/plugins/weeby/Weeby.js","friendlyPath":"plugins.weeby.Weeby","directory":"sdk/plugins/weeby/","filename":"Weeby.js","baseMod":"plugins","basePath":"sdk/","src":"jsio(\"import event.Emitter as Emitter\");\n\njsio(\"import device\");\njsio(\"import animate\");\n\njsio(\"import ui.View as View\");\n\njsio(\"import .trackers.trackers as trackers\");\n\njsio(\"import .ui.config\");\n\njsio(\"import .weebyLocalData\");\njsio(\"import .weebyNative\");\n\njsio(\"import lib.Callback\");\n\nvar weebyController;\n\nRootViewController=__class__;var RootViewController=RootViewController(function RootViewController(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function (publicAPI) {\n\t\tthis._publicAPI = publicAPI;\n\n\t\tthis._onReady = new lib.Callback();\n\n\t\tif (DEBUG && window.parent) {\n\t\t\tjsio(\"import .weebyDebug\");\n\t\t\tweebyDebug.init({}, bind(this, '_init'));\n\t\t} else {\n\t\t\tthis._init();\n\t\t}\n\t}\n\n\tthis._init = function (err, debugAPI) {\n\t\tweebyController = jsio(\"import .weebyController\");\n\t\tweebyController.init({\n\t\t\tapi: debugAPI\n\t\t});\n\n\t\tweebyController.on('StartGame', bind(this, function (data) {\n\t\t\tif (!CONFIG.addons.weeby.gameType) {\n\t\t\t\tthis.transitionToGame();\n\t\t\t}\n\t\t\t\n\t\t\tthis._publicAPI.emit('StartGame', data);\n\t\t}));\n\n\t\tthis._onReady.fire();\n\t}\n\n\tthis.whenReady = function (method) {\n\t\tthis._onReady.forward([this, method].concat(Array.prototype.slice.call(arguments, 1)));\n\t}\n\n\tthis.getGameView = function () {\n\t\treturn this._gameView || (this._gameView = new View({\n\t\t\t\tsuperview: GC.app,\n\t\t\t\tinfinite: true,\n\t\t\t\tvisible: false,\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: device.screen.width,\n\t\t\t\theight: device.screen.height\n\t\t\t}));\n\t};\n\n\tthis.startTransition = function () {\n\t\tthis._weebyView.getInput().blockEvents = true;\n\t\tthis._gameView.getInput().blockEvents = true;\n\t\tthis._weebyView.style.clip = true;\n\t\tthis._gameView.style.clip = true;\n\t};\n\n\tthis.endTransition = function () {\n\t\tthis._weebyView.getInput().blockEvents = false;\n\t\tthis._gameView.getInput().blockEvents = false;\n\t\tthis._weebyView.style.clip = false;\n\t\tthis._gameView.style.clip = false;\n\t};\n\n\tthis.isWeebyVisible = function () {\n\t\treturn this._weebyView.style.visible;\n\t};\n\n\tthis.isGameVisible = function () {\n\t\treturn this._gameView.style.visible;\n\t};\n\n\tthis.transitionToGame = function (isAnimated) {\n\t\tvar width = GC.app.style.width;\n\n\t\tthis._gameView.style.visible = true;\n\t\tGC.app.addSubview(this._gameView);\n\n\t\tif (this.isWeebyVisible()) {\n\t\t\tthis.startTransition();\n\n\t\t\tthis._gameView.style.x = width;\n\t\t\tanimate(this._weebyView).then({x: -width});\n\t\t\tanimate(this._gameView).then({x: 0}).then(bind(this, function () {\n\t\t\t\tthis._weebyView.style.visible = false;\n\t\t\t\tthis._weebyView.removeFromSuperview();\n\t\t\t\tthis.endTransition();\n\t\t\t}));\n\t\t} else {\n\t\t\tthis._gameView.style.x = 0;\n\t\t}\n\t};\n\n\tthis.transitionToWeeby = function (isAnimated) {\n\n\t\tif (!this._weebyView) {\n\t\t\tjsio(\"import .ui.WeebyViews\");\n\t\t\tthis._weebyView = ui.WeebyViews.getInstance();\n\t\t}\n\n\t\tvar width = GC.app.style.width;\n\n\t\tthis._weebyView.style.visible = true;\n\t\tGC.app.addSubview(this._weebyView);\n\n\t\tif (this.isGameVisible()) {\n\t\t\tif (isAnimated) {\n\t\t\t\tthis.startTransition();\n\t\t\t\tthis._weebyView.style.x = -width;\n\t\t\t\tanimate(this._weebyView).then({x: 0});\n\t\t\t\tanimate(this._gameView).then({x: width}).then(bind(this, function () {\n\t\t\t\t\tthis._gameView.style.visible = false;\n\t\t\t\t\tthis._gameView.removeFromSuperview();\n\t\t\t\t\tthis.endTransition();\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tthis._weebyView.style.x = 0;\n\t\t\t\tthis._gameView.style.visible = false;\n\t\t\t\tthis._gameView.removeFromSuperview();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._weebyView.style.x = 0;\n\t\t}\n\t};\n\n\tthis.finishGame = function (data) {\n\t\tweebyController.finishGame(data);\n\t\tthis.transitionToWeeby(true);\n\t}\n\n\tthis.cancelGame = function (data) {\n\t\tweebyController.cancelGame(data);\n\t\tthis.transitionToWeeby(true);\n\t}\n});\n\nPublicAPI=__class__;var PublicAPI=PublicAPI(function PublicAPI(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\t\n\t// private static locals\n\tvar _controller;\n\n\tthis.init = function () {\n\t\t_controller = new RootViewController(this);\n\t}\n\n\tthis.getGameView = function () { return _controller.getGameView(); }\n\tthis.launchUI = function () { _controller.whenReady('transitionToWeeby'); };\n\tthis.finishGame = function (data) { _controller.whenReady('finishGame', data); };\n\tthis.cancelGame = function (data) { _controller.whenReady('cancelGame', data); };\n\n\tthis.setCommonCurrencyFromScoreEnabled = function () {\n\t};\n\n\tthis.setPremiumCurrentFromScoreEnabled = function () {\n\t};\n\n\tthis.setLivesFromScoreEnabled = function () {\n\t};\n\n\tthis.addCommonCurrency = function (commonCurrency) {\n\t\tweebyLocalData.addCommonCurrency(commonCurrency);\n\t};\n\n\tthis.addPremiumCurrency = function (premiumCurrency) {\n\t\tweebyLocalData.addPremiumCurrency(premiumCurrency);\n\t};\n\n\tthis.addLives = function (lives) {\n\t\tweebyLocalData.setLife(weebyLocalData.getLife() + lives);\n\t};\n\n\tthis.isMusicOn = function () {\n\t\treturn weebyLocalData.getMusicOn();\n\t};\n\n\tthis.isSfxOn = function () {\n\t\treturn weebyLocalData.getSfxOn();\n\t};\n\n\tthis.setMusicOn = function () {\n\t\tweebyLocalData.setMusicOn(musicOn);\n\t};\n\n\tthis.setSfxOn = function (sfxOn) {\n\t\tweebyLocalData.setSfxOn(sfxOn);\n\t};\n\n\tthis.getLevel = function () {\n\t\treturn weebyLocalData.getLevel();\n\t};\n\n\tthis.getTutorialMode = function () {\n\t\treturn weebyLocalData.getTutorialMode();\n\t};\n\n\tthis.getTutorialStep = function () {\n\t\treturn weebyLocalData.getTutorialStep();\n\t};\n\n\t// This function is deprecated\n\tthis.getHighScore = function () {\n\t\treturn weebyLocalData.getWeeklyHighScore();\n\t};\n\n\tthis.getWeeklyHighScore = function () {\n\t\treturn weebyLocalData.getWeeklyHighScore();\n\t};\n\n\tthis.getAllTimeHighScore = function () {\n\t\treturn weebyLocalData.getAllTimeHighScore();\t\n\t};\n\n\t// returns the bonus score the player would receive for score\n\tthis.getBonusForScore = function (score) {\n\t\tvar bonusScore = 0;\n\t\tif (weebyController) {\n\t\t\tvar model = weebyController.getGameModel();\n\t\t\tbonusScore = model.getBonusScore(this.getLevel(), score);\n\t\t}\n\t\treturn bonusScore;\n\t}\n\n\t// returns the raw score needed by the player to reach scoreWithBonus\n\tthis.getRawScore = function (scoreWithBonus) {\n\t\tvar rawScore = scoreWithBonus;\n\t\tif (weebyController) {\n\t\t\tvar model = weebyController.getGameModel();\n\t\t\trawScore = model.getRawScore(this.getLevel(), scoreWithBonus);\n\t\t}\n\t\treturn rawScore;\n\t}\n\n\t\n});\n\nexports = new PublicAPI();\n","pre":true},"sdk/plugins/weeby/trackers/trackers.js":{"path":"sdk/plugins/weeby/trackers/trackers.js","friendlyPath":".trackers.trackers","directory":"sdk/plugins/weeby/trackers/","filename":"trackers.js","src":"jsio(\"import .GCTracker\");\n\nTrackers=__class__;var Trackers=Trackers(function Trackers(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis._globalProperties = {};\n\t\tthis._gcTracker = new GCTracker();\n\t\tthis._gcTracker.on('StartSession', bind(this, 'onStartSession'));\n\t\tthis._gcTracker.on('EndSession', bind(this, 'onEndSession'));\n\n\t\tthis._trackers = [this._gcTracker];\n\t};\n\n\tthis.addTracker = function (tracker) {\n\t\tthis._trackers.push(tracker);\n\t\ttracker.track && tracker.track('session:start', {sessionId: this._gcTracker.getID()})\n\t};\n\n\tthis.addGlobalProperty = function(key, val) {\n\t\tthis._globalProperties[key] = val;\t\n\t};\n\n\tthis._sendToTracker = function (name, data) {\n\t\tvar trackers = this._trackers;\n\t\tvar i = trackers.length;\n\n\t\t// add global properties\n\t\tdata = data || {};\n\t\tvar keys = Object.keys(this._globalProperties);\n\t\tfor (var j = 0; j < keys.length; j++) {\n\t\t\tdata[keys[j]] = this._globalProperties[keys[j]];\n\t\t}\n\n\t\tconsole.log('--> send track: ' + name + ', data: ' + JSON.stringify(data));\n\t\twhile (i) {\n\t\t\tvar tracker = trackers[--i];\n\t\t\ttracker.track && tracker.track(name, data);\n\t\t}\n\t};\n\n\tthis.setAPI = function (api) {\n\t\tthis._api = api;\n\t\tthis._gcTracker.setAPI(api);\n\t}\n\n\tthis.track = function (name, data) {\n\t\tthis._sendToTracker(name, data)\n\t};\n\n\tthis.onStartSession = function () {\n\t\tthis._sendToTracker('session:start', {sessionId: this._gcTracker.getID()});\n\t};\n\n\tthis.onEndSession = function () {\n\t\tthis._sendToTracker('session:end', {sessionId: this._gcTracker.getID()});\n\t};\n});\n\nvar trackers = new Trackers();\n\nexports = trackers;\n","pre":true},"sdk/plugins/weeby/trackers/GCTracker.js":{"path":"sdk/plugins/weeby/trackers/GCTracker.js","friendlyPath":".GCTracker","directory":"sdk/plugins/weeby/trackers/","filename":"GCTracker.js","src":"jsio(\"import event.Emitter as Emitter\");\n\njsio(\"import .ackAjax\");\njsio(\"import .Session\");\njsio(\"import .uuid\");\n\nvar sdk_plugins_weeby_trackers_GCTracker=__class__;exports=sdk_plugins_weeby_trackers_GCTracker(function sdk_plugins_weeby_trackers_GCTracker(){return this.init&&this.init.apply(this,arguments)},Emitter, function(supr) {\n\tthis.init = function(opts) {\n\t\topts = opts || {};\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._session = null;\n\n\t\tthis._baseURL = 'http://' + window.location.host + '/simulate/addons/weeby/mock_server/v1/logs.submit-logs';\n\t\tthis._version = '0.1';\n\t\tthis._countryCode = (navigator.country || 'US').toUpperCase();\n\t};\n\n\tthis.setAPI = function (api) {\n\t\tthis._api = api;\n\n\t\tackAjax.setAuthKey(api.getAuthKey());\n\t\tapi.on('authKeyChange', bind(this, function (authKey) {\n\t\t\tackAjax.setAuthKey(authKey);\n\t\t}));\n\n\t\tthis.setHost(api.getHost());\n\t};\n\n\tthis.setHost = function (host) {\n\t\tthis._baseURL = 'http://' + host + '/v1/logs.submit-logs';\n\n\t\t// close previous session if it was found in local storage\n\t\tvar data = Session.getPreviousSession();\n\t\tif (data) {\n\t\t\tackAjax.request({\n\t\t\t\turl: this._baseURL,\n\t\t\t\tdata: {\n\t\t\t\t\tid: uuid(),\n\t\t\t\t\tname: 'session:end',\n\t\t\t\t\tdata: {},\n\t\t\t\t\tsessionID: data.sessionID,\n\t\t\t\t\tdeviceID: this._api.getAuthKey(),\n\t\t\t\t\tversion: this._version,\n\t\t\t\t\tcountry: this._countryCode,\n\t\t\t\t\ttimestamp: data.timestamp\n\t\t\t\t},\n\t\t\t\tmethod: 'post',\n\t\t\t\theaders:  {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// create a new session\n\t\tthis._createSession();\n\t};\n\n\tthis.getID = function() {\n\t\treturn this._session.getID();\n\t};\n\n\tthis._sendData = function (name, data) {\n\t\tthis._session.onSendData();\n\t\t\n\t\tackAjax.request({\n\t\t\turl: this._baseURL,\n\t\t\tdata: {\n\t\t\t\tid: uuid(),\n\t\t\t\tname: name,\n\t\t\t\tdata: data || {},\n\t\t\t\tsessionID: this._session.getID(),\n\t\t\t\tdeviceID: this._api.getAuthKey(),\n\t\t\t\tversion: this._version,\n\t\t\t\tcountry: this._countryCode,\n\t\t\t\ttimestamp: Date.now()\n\t\t\t},\n\t\t\tmethod: 'post',\n\t\t\theaders:  {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t});\n\t};\n\n\tthis._createSession = function (data) {\n\t\tthis._session = new Session({});\n\t\tthis._sendData('session:start');\n\t};\n\n\tthis._endSession = function (data) {\n\t\tthis._sendData('session:end');\n\t};\n\n\t/**\n\t * Tracks an event given a name and optional data map. The event\n\t * will be sent to the server sometime in the future when possible.\n\t * @method track\n\t * @param {string} name the name of the event\n\t * @param {object|null} [data] an optional map of {string->string} pairs\n\t * @param {object|null} [options]\n\t * @param {string} [options.deviceID] the unique ID to be used for tracking (assumes user's deviceID by default; only available for third-party services)\n\t */\n\tthis._track = function (name, data, options) {\n\t\tif (!this._session) {\n\t\t\tconsole.warn('No session set, tracking disabled.');\n\t\t\treturn;\n\t\t}\n\t\tif (typeof name !== 'string') {\n\t\t\tthrow new Error('The \"name\" parameter to GCTracker.track() must be a string.');\n\t\t}\n\t\tif (data && (isArray(data) || typeof data === 'string' || typeof data === 'number')) {\n\t\t\tthrow new Error('The \"data\" parameter to GCTracker.track() must be an object or null.');\n\t\t}\n\n\t\tif (this._session.isExpired()) {\n\t\t\tthis._endSession();\n\t\t\tthis.emit('EndSession', this._session.getID());\n\t\t\tthis._createSession();\n\t\t\tthis.emit('StartSession', this._session.getID());\n\t\t}\n\n\t\toptions = options || {};\n\t\tthis._sendData(name, data);\n\t};\n\n\tthis.track = function (name, data, options) {\n\t\tif ((name !== 'session:start') && (name !== 'session:end')) {\n\t\t\tthis._track(name, data, options);\n\t\t}\n\t};\n\n\tthis.getSessionID = function () {\n\t\treturn this._session.getID();\n\t};\n});\n","pre":true},"sdk/plugins/weeby/trackers/ackAjax.js":{"path":"sdk/plugins/weeby/trackers/ackAjax.js","friendlyPath":".ackAjax","directory":"sdk/plugins/weeby/trackers/","filename":"ackAjax.js","src":"jsio(\"import util.ajax as ajax\");\n\n/**\n * When there are less than 10 messages in the queue then each batch will be sent every 5 seconds\n */\nvar PENDING_INTERVAL = 5000;\n\n/**\n * If MAX_FAILURE_COUNT messages failed then the interval is increased to 20 seconds\n */\nvar PENDING_INTERVAL_LONG = 60000;\n\n/**\n * If there are more then 10 messages in the queue then the interval is set to: PENDING_INTERVAL_SPREAD / messageCount\n */\nvar PENDING_INTERVAL_SPREAD = 10 * 1000;\n\n/**\n * The number of consecutive failures after which the interval is increased\n */\nvar MAX_FAILURE_COUNT = 3;\n\n/**\n * If there are messages in the queue on startup then the sending will be spread over the first 5 seconds\n */\nvar RESEND_INTERVAL = 5 * 1000;\n\n/**\n * Messages older than seven days will be discarded.\n */\nvar STALE_TIME = 7 * 24 * 60 * 60 * 1000;\n\n/**\n * Maximum time between trying the send a message again\n * This is the time when a message CAN be send from the queue not when it WILL be send\n */\nvar MAX_DELTA_TIME = 60 * 60 * 1000;\n\n/**\n * Initial time for sending message, next times will be 1000, 2000, 4000...MAX_DELTA_TIME.\n */\nvar INITIAL_RETRY_TIME = 500;\n\n/**\n * The maximum number of items per batch\n */\nvar MAX_BATCH_SIZE = 30;\n\n/**\n * When a messages takes too long it blocks all other messages being send, timout\n */\n var TIMEOUT_TIME = 10 * 1000;\n\n\nAckAjax=__class__;var AckAjax=AckAjax(function AckAjax(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tthis._requests = [];\n\n\t\tthis._id = 1;\n\n\t\tthis.loadPending();\n\n\t\tthis._failedRequests = 0; // Count how many requests fail\n\n\t\tthis._sending = 0;\n\t\tthis._sendingTime = 0; // Time when the request started\n\n\t\tthis._pendingIntervalLong = PENDING_INTERVAL; // Long interval, is increased in 1s intervals with a max of PENDING_INTERVAL_LONG\n\t\tthis._pendingTimeoutLong = false; // Pending timeout is long after a number of failures in a row\n\t\tthis._pendingIndex = 0;\n\t\tthis._schedulePending();\n\t}\n\n\tthis._schedulePending = function (timeout) {\n\t\tclearTimeout(this._pendingTimeout);\n\t\tthis._pendingTimeout = setTimeout(bind(this, 'handlePending'), timeout == undefined ? PENDING_INTERVAL : timeout);\n\t};\n\n\t/**\n\t * Load the list of pending requests, remove stale requests, find the maximum id.\n\t */\n\tthis.loadPending = function () {\n\t\tvar staleTime = Date.now() - STALE_TIME;\n\t\tvar requests = localStorage.getItem('ACK_REQUESTS');\n\t\tif (requests) {\n\t\t\ttry {\n\t\t\t\trequests = JSON.parse(requests);\n\t\t\t\tthis._requests = requests;\n\n\t\t\t\tvar now = Date.now();\n\t\t\t\tvar i = requests.length;\n\t\t\t\tvar dt = Math.ceil(RESEND_INTERVAL / i); // Calculate the send interval.\n\t\t\t\twhile (i && requests.length) {\n\t\t\t\t\tvar request = requests[--i];\n\t\t\t\t\tif (request.time < staleTime) {\n\t\t\t\t\t\trequests.splice(i, 1);\n\t\t\t\t\t\ti++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trequest.nextTime = now + i * dt; // Don't send all pending requests at once.\n\t\t\t\t\t\tthis._id = Math.max(this._id, request.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._id++;\n\t\t\t} catch (error) {\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Handle a single pending message.\n\t */\n\tthis.handlePendingBatch = function () {\n\t\tvar now = Date.now();\n\t\tvar requests = this._requests;\n\t\tvar count = Math.min(requests.length, MAX_BATCH_SIZE);\n\t\tvar items = [];\n\t\tvar sentIDs = {};\n\t\tvar opts;\n\n\t\twhile (count) {\n\t\t\tthis._pendingIndex = (this._pendingIndex + 1) % requests.length;\n\t\t\trequest = requests[this._pendingIndex];\n\t\t\tif (now >= request.nextTime) {\n\t\t\t\tsentIDs[request.id] = true;\n\t\t\t\trequest.tryCount++;\n\t\t\t\trequest.nextTime = now + Math.min(INITIAL_RETRY_TIME * (1 << request.tryCount), MAX_DELTA_TIME);\n\t\t\t\topts = request.opts;\n\t\t\t\titems.push(opts.data);\n\t\t\t}\n\t\t\tcount--; // Limit the number of checks (should this be limitted further?)\n\t\t}\n\n\t\tif (items.length) {\n\t\t\t// Save the pending state before sending.\n\t\t\tthis.savePending();\n\n\t\t\tthis._sending++;\n\t\t\tthis._sendingTime = now + TIMEOUT_TIME;\n\t\t\tconsole.log('request:', items);\n\t\t\tajax.post(\n\t\t\t\t{\n\t\t\t\t\turl: opts.url,\n\t\t\t\t\tmethod: opts.method,\n\t\t\t\t\tquery: {\n\t\t\t\t\t\tkey: this._authKey,\n\t\t\t\t\t\tapp: CONFIG.appID\n\t\t\t\t\t},\n\t\t\t\t\theaders: opts.headers,\n\t\t\t\t\tdata: {items: items}\n\t\t\t\t},\n\t\t\t\tbind(this, 'onGet', sentIDs)\n\t\t\t);\n\t\t}\n\t};\n\n\t/**\n\t * Handle all pending requests.\n\t */\n\tthis.handlePending = function () {\n\t\tif (!this._authKey) { return; }\n\n\t\tvar pendingInterval = PENDING_INTERVAL;\n\n\t\tif (this._sending === 0) {\n\t\t\tvar count = this._requests.length;\n\t\t\tif (count) {\n\t\t\t\t// If more than 3 requests failed then try one and increase the interval...\n\t\t\t\tif (this._failedRequests > MAX_FAILURE_COUNT) {\n\t\t\t\t\tthis.handlePendingBatch();\n\t\t\t\t\tthis._pendingTimeoutLong = true;\n\t\t\t\t\t// Keep increasing until PENDING_INTERVAL_LONG\n\t\t\t\t\tthis._pendingIntervalLong = Math.min(this._pendingIntervalLong + 1000, PENDING_INTERVAL_LONG);\n\t\t\t\t\tpendingInterval = this._pendingIntervalLong;\n\t\t\t\t} else {\n\t\t\t\t\tthis._pendingTimeoutLong = false;\n\t\t\t\t\t// Reset to default...\n\t\t\t\t\tpendingInterval = PENDING_INTERVAL;\n\t\t\t\t\tthis._pendingIntervalLong = PENDING_INTERVAL;\n\n\t\t\t\t\t// If there are too many messages then send more messages.\n\t\t\t\t\tif (count > MAX_BATCH_SIZE) {\n\t\t\t\t\t\t// Start sending messages faster, limit the interval to approximately once every three frames.\n\t\t\t\t\t\tpendingInterval = Math.max((PENDING_INTERVAL_SPREAD / count) | 0, (1000 / 60 * 3) | 0);\n\t\t\t\t\t}\n\t\t\t\t\tthis.handlePendingBatch();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._pendingTimeoutLong = false;\n\t\t\t}\n\t\t} else if (Date.now() > this._sendingTime) { // Check for timeout...\n\t\t\tthis._sending = Math.max(this._sending - 1, 0);\n\t\t}\n\n\t\tthis._schedulePending(pendingInterval);\n\t};\n\n\tthis.savePending = function () {\n\t\tlocalStorage.setItem('ACK_REQUESTS', JSON.stringify(this._requests));\n\t};\n\n\t/**\n\t * Add a pending request.\n\t */\n\tthis.addPending = function (id, opts) {\n\t\tvar request = null;\n\n\t\ttry {\n\t\t\t// Wrap stringify in try...catch to catch circular references.\n\t\t\topts = JSON.parse(JSON.stringify(opts));\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to serialize data for request to:', opts.url);\n\t\t\topts = null;\n\t\t}\n\t\tif (opts) {\n\t\t\tvar now = Date.now();\n\t\t\tvar request = {\n\t\t\t\t\tid: id,\n\t\t\t\t\ttryCount: 1,\n\t\t\t\t\topts: opts,\n\t\t\t\t\ttime: now,\n\t\t\t\t\tnextTime: 0\n\t\t\t\t};\n\n\t\t\tthis._requests.push(request);\n\t\t\tthis.savePending();\n\t\t}\n\n\t\treturn request;\n\t};\n\n\t/**\n\t * Add a request to the queue...\n\t */\n\tthis.request = function (opts) {\n\t\tthis.addPending(this._id++, opts);\n\t\t// if ((this._sending === 0) && !this._failedRequests && !this._pendingTimeout) {\n\t\t// \tthis._schedulePending();\n\t\t// }\n\t};\n\n\tthis.setAuthKey = function (authKey) {\n\t\tthis._authKey = authKey;\n\t\tif (!this._sending) {\n\t\t\tthis._schedulePending();\n\t\t}\n\t}\n\n\tthis.removeFromQueue = function (sentIDs) {\n\t\t// The request was successfull, remove it from the queue:\n\t\tvar requests = this._requests;\n\t\tvar i = requests.length;\n\t\twhile (i) {\n\t\t\tif (requests[--i].id in sentIDs) {\n\t\t\t\trequests.splice(i, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Callback for a request, check if there's an error, if not then remove items from the queue.\n\t */\n\tthis.onGet = function (sentIDs, error, data, headers) {\n\t\tthis._sending = Math.max(this._sending - 1, 0);\n\n\t\tif (error) {\n\t\t\t// Increase the failure count, if too many attempts fail in a row the increase the interval...\n\t\t\tthis._failedRequests++;\n\n\t\t\tswitch (error.status) {\n\t\t\t\tcase 400:\n\t\t\t\tcase 500:\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\t// Success, we are online, reset the failed counter:\n\t\t\tthis._failedRequests = 0;\n\t\t\tconsole.log('success:', sentIDs);\n\n\t\t\t// If the timeout was long then the interval can be reduced again...\n\t\t\tif (this._pendingTimeoutLong) {\n\t\t\t\tthis._schedulePending();\n\t\t\t}\n\n\t\t\tthis.removeFromQueue(sentIDs);\n\t\t}\n\n\t\tthis.savePending();\n\t};\n});\n\nvar ackAjax = new AckAjax();\n\nexports.request = bind(ackAjax, 'request');\nexports.setAuthKey = bind(ackAjax, 'setAuthKey');","pre":true},"sdk/jsio/util/ajax.js":{"path":"sdk/jsio/util/ajax.js","friendlyPath":"util.ajax","directory":"sdk/jsio/util/","filename":"ajax.js","src":"jsio(\"import std.uri as URI\");\n\nvar SIMULTANEOUS = 4;\nvar _inflight = 0;\n\nvar doc;\nexports.getDoc = function() {\n\tif (doc) { return doc; }\n\ttry {\n\t\tdoc = window.ActiveXObject && new ActiveXObject('htmlfile');\n\t\tif (doc) {\n\t\t\tdoc.open().write('<html></html>');\n\t\t\tdoc.close();\n\t\t\twindow.attachEvent('onunload', function() {\n\t\t\t\ttry { doc.body.innerHTML = ''; } catch(e) {}\n\t\t\t\tdoc = null;\n\t\t\t});\n\t\t}\n\t} catch(e) {}\n\t\n\tif (!doc) { doc = document; }\n\treturn doc;\n};\n\nvar ctor = function() {\n\tvar win = window,\n\t\tdoc = exports.getDoc();\n\t//if (doc.parentWindow) { win = doc.parentWindow; }\n\t\n\treturn new (ctor = win.XMLHttpRequest ? win.XMLHttpRequest\n\t\t: function() { return win.ActiveXObject && new win.ActiveXObject('Msxml2.XMLHTTP') || null; });\n};\n\nexports.createXHR = function() { return new ctor(); }\n\nexports.post = function(opts, cb) {\n\treturn exports.get(merge({method: 'POST'}, opts), cb);\n}\n\nRequest=__class__;var Request=Request(function Request(){return this.init&&this.init.apply(this,arguments)},function() {\n\tvar _UID = 0;\n\t\n\tthis.init = function(opts, cb) {\n\t\tif (!opts || !opts.url) { logger.error('no url provided'); return; }\n\t\t\n\t\tthis.method = (opts.method || 'GET').toUpperCase();\n\t\tthis.url = opts.url;\n\t\tthis.type = opts.type;\n\t\tthis.async = opts.async;\n\t\tthis.timeout = opts.timeout;\n\t\tthis.id = ++_UID;\n\t\tthis.headers = {};\n\t\tthis.cb = cb;\n\t\t\n\t\tif (opts.headers) {\n\t\t\tfor (var key in opts.headers) if (opts.headers.hasOwnProperty(key)) {\n\t\t\t\tvar value = opts.headers[key];\n\t\t\t\tthis.headers[key] = value;\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar isObject = opts.data && typeof opts.data == 'object';\n\t\t\n\t\tif (this.method == 'GET' && opts.data) {\n\t\t\tthis.url = new URI(this.url)\n\t\t\t\t\t\t\t.addQuery(isObject ? opts.data : URI.parseQuery(opts.data))\n\t\t\t\t\t\t\t.toString();\n\t\t}\n\n\t\tif (opts.query) {\n\t\t\tthis.url = new URI(this.url)\n\t\t\t\t\t\t\t.addQuery(typeof opts.query == 'object' ? opts.query : URI.parseQuery(opts.query))\n\t\t\t\t\t\t\t.toString();\n\t\t}\n\t\t\n\t\ttry {\n\t\t\tthis.data = (this.method != 'GET' ? (isObject ? JSON.stringify(opts.data) : opts.data) : null);\n\t\t\tif (isObject && !this.headers['Content-Type']) {\n\t\t\t\tthis.headers['Content-Type'] = 'application/json';\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tcb && cb({invalidData: true}, null, '');\n\t\t\treturn;\n\t\t}\n\t}\n});\n\nvar _pending = [];\n\nexports.get = function(opts, cb) {\n\tvar request = new Request(opts, cb);\n\t\n\tif (_inflight >= SIMULTANEOUS) {\n\t\t_pending.push(request);\n\t} else {\n\t\t_send(request);\n\t}\n}\n\nfunction _sendNext() {\n\t//logger.log('====INFLIGHT', _inflight, SIMULTANEOUS, 'might send next?');\n\tif (_inflight < SIMULTANEOUS) {\n\t\tvar request = _pending.shift();\n\t\tif (request) {\n\t\t\t_send(request);\n\t\t}\n\t}\n}\n\nfunction _send(request) {\n\t++_inflight;\n\t//logger.log('====INFLIGHT', _inflight, 'sending request', request.id);\n\t\n\tvar xhr = exports.createXHR();\n\txhr.open(request.method, request.url, !(request.async == false));\n\tvar setContentType = false;\n\tfor (var key in request.headers) {\n\t\tif (key.toLowerCase() == 'content-type') { setContentType = true; }\n\t\txhr.setRequestHeader(key, request.headers[key]);\n\t}\n\n\tif (!setContentType) {\n\t\txhr.setRequestHeader('Content-Type', 'text/plain');\n\t}\n\t\n\txhr.onreadystatechange = bind(this, onReadyStateChange, request, xhr);\n\tif (request.timeout) {\n\t\trequest.timeoutRef = setTimeout(bind(this, cancel, xhr, request), request.timeout);\n\t\t//logger.log('==== setting timeout for', request.timeout, request.timeoutRef, '<<');\n\t}\n\t\n\trequest.ts = +new Date();\n\txhr.send(request.data || null);\n}\n\nfunction cancel(xhr, request) {\n\t--_inflight;\n\t// logger.log('====INFLIGHT', _inflight, 'timeout (cancelled)', request.id);\n\tif (request.timedOut) {\n\t\tlogger.log('already timed out?!');\n\t}\n\t\n\txhr.onreadystatechange = null;\n\trequest.timedOut = true;\n\tif (xhr.readyState >= xhr.HEADERS_RECEIVED) {\n\t\ttry {\n\t\t\tvar headers = xhr.getAllResponseHeaders();\n\t\t} catch (e) {}\n\t}\n\t\n\trequest.cb && request.cb({timeout: true}, null, headers);\n}\n\nfunction onReadyStateChange(request, xhr) {\n\tif (xhr.readyState != 4) { return; }\n\t\n\tif (request.timedOut) { throw 'Unexpected?!'; }\n\t\n\t--_inflight;\n\t\n\t// logger.log('====INFLIGHT', _inflight, 'received response', request.ts, request.id, (+new Date() - request.ts) / 1000);\n\tsetTimeout(_sendNext, 0);\n\t\n\tvar cb = request.cb;\n\tif ('timeoutRef' in request) {\n\t\t// logger.log('==== AJAX CLEARING TIMEOUT', request.id);\n\t\tclearTimeout(request.timeoutRef);\n\t\trequest.timeoutRef = null;\n\t}\n\t\n\t// only fire callback once\n\tif (!cb || request.handled) { return; }\n\trequest.handled = true;\n\t\n\t// .status will be 0 when requests are filled via app cache on at least iOS 4.x\n\tif (xhr.status != 200 && xhr.status != 0) {\n\t\tvar response = xhr.response;\n\t\tif (xhr.getResponseHeader('Content-Type') == 'application/json') {\n\t\t\ttry {\n\t\t\t\tresponse = JSON.parse(response);\n\t\t\t} catch(e) {\n\t\t\t}\n\t\t}\n\t\tcb({status: xhr.status, response: response}, null, xhr.getAllResponseHeaders());\n\t} else {\n\t\tvar data = xhr.responseText;\n\t\tif (request.type == 'json') {\n\t\t\tif (!data) {\n\t\t\t\tcb({status: xhr.status, response: xhr.response}, null, xhr.getAllResponseHeaders());\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(data);\n\t\t\t\t} catch(e) {\n\t\t\t\t\tcb({status: xhr.status, response: xhr.response, parseError: true}, null, xhr.getAllResponseHeaders());\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcb(null, data, xhr.getAllResponseHeaders());\n\t}\n}\n","pre":true},"sdk/plugins/weeby/trackers/Session.js":{"path":"sdk/plugins/weeby/trackers/Session.js","friendlyPath":".Session","directory":"sdk/plugins/weeby/trackers/","filename":"Session.js","src":"jsio(\"import event.Emitter as Emitter\");\n\njsio(\"import ..models.localStorageModel as localStorageModel\");\njsio(\"import .uuid\");\n\nvar STORAGE_KEY = 'ANALYTICS_LAST_TRACKED_SESSION';\n\nvar sdk_plugins_weeby_trackers_Session=__class__;exports=sdk_plugins_weeby_trackers_Session(function sdk_plugins_weeby_trackers_Session(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\topts = opts || {};\n\n\t\tthis._uuid = uuid();\n\n\t\tthis._timeoutTime = opts.timeoutTime || 15 * 1000;\n\t\tthis._startTime = Date.now();\n\n\t\tthis._isExpired = false;\n\t\tthis._aliveTime = this._startTime;\n\t\tthis._interval = setInterval(bind(this, 'onKeepAlive'), 1000);\n\t};\n\n\tthis.onKeepAlive = function () {\n\t\tvar now = Date.now();\n\t\tif (now > this._aliveTime + this._timeoutTime) {\n\t\t\tthis._interval && clearInterval(this._interval);\n\t\t\tthis._isExpired = true;\n\t\t\tconsole.log('Expired');\n\t\t\tthis.emit('Expired', this._uuid);\n\t\t} else {\n\t\t\tthis._aliveTime = now;\n\t\t}\n\t};\n\n\tthis.getKey = function () {\n\t\treturn this._authKey;\n\t}\n\n\tthis.getID = function () {\n\t\treturn this._uuid;\n\t};\n\n\tthis.getStartTime = function () {\n\t\treturn this._startTime;\n\t};\n\n\tthis.getAliveTime = function () {\n\t\treturn this._aliveTime;\n\t};\n\n\tthis.onSendData = function () {\n\t\tlocalStorageModel.setData(STORAGE_KEY, {\n\t\t\tsessionID: this._uuid,\n\t\t\ttimestamp: Date.now()\n\t\t});\n\t};\n\n\tthis.isExpired = function () {\n\t\treturn this._isExpired;\n\t};\n\n\tthis.close = function () {\n\t\tthis._interval && clearInterval(this._interval);\n\t\tthis._interval = null;\n\t};\n});\n\nexports.getPreviousSession = function () {\n\treturn localStorageModel.getData(STORAGE_KEY);\n}","pre":true},"sdk/plugins/weeby/models/localStorageModel.js":{"path":"sdk/plugins/weeby/models/localStorageModel.js","friendlyPath":"..models.localStorageModel","directory":"sdk/plugins/weeby/models/","filename":"localStorageModel.js","src":"jsio(\"import event.Emitter as Emitter\");\n\nlocalStorageModel=__class__;var localStorageModel=localStorageModel(function localStorageModel(){return this.init&&this.init.apply(this,arguments)},Emitter, function(supr) {\n\n\t// one unified local storage key per app, avoids overlap in browser\n\tvar APP_ID = CONFIG.appID || \"NO_APP_ID\",\n\t\tLOCAL_STORAGE_KEY = \"__WEEBY_LOCAL_STORAGE__\" + APP_ID;\n\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', arguments);\n\t};\n\n\tthis.getData = function(key, defaultValue) {\n\t\tvar data = localStorage.getItem(LOCAL_STORAGE_KEY + key);\n\t\tif (data !== undefined && data !== null) {\n\t\t\treturn JSON.parse(data);\n\t\t} else {\n\t\t\treturn defaultValue;\n\t\t}\n\t};\n\n\tthis.setData = function(key, value) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tlocalStorage.setItem(LOCAL_STORAGE_KEY + key, JSON.stringify(value));\n\t\t} else {\n\t\t\tthis.removeData(key);\n\t\t}\n\t};\n\n\tthis.removeData = function(key) {\n\t\tlocalStorage.removeItem(LOCAL_STORAGE_KEY + key);\n\t};\n\n\tthis.readInt = function(key, defaultValue) {\n\t\tdefaultValue = defaultValue || 0;\n\t\tvar value = this.getData(key);\n\t\tif (value === undefined) {\n\t\t\tvalue = defaultValue;\n\t\t} else if (typeof value !== 'number') {\n\t\t\tvalue = defaultValue;\n\t\t\tlogger.warn(\"Int not found in readInt, using default value for key\", key);\n\t\t} else {\n\t\t\tvar oldValue = value;\n\t\t\tvalue = parseInt(value, 10);\n\t\t\tif (value !== oldValue) {\n\t\t\t\tlogger.warn(\"Non-int value found in readInt, for key\", key);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t};\n\n\tthis.writeInt = function(key, value) {\n\t\tvalue = Math.floor(value || 0);\n\t\tthis.setData(key, value);\n\t\treturn value;\n\t};\n\n\tthis.readBool = function(key, defaultValue) {\n\t\tdefaultValue = defaultValue === undefined ? true : defaultValue;\n\t\tvar value = this.getData(key);\n\t\tif (value === undefined) {\n\t\t\tvalue = defaultValue;\n\t\t} else if (typeof value !== 'boolean') {\n\t\t\tvalue = defaultValue;\n\t\t\tlogger.warn(\"Non-boolean value in readBool, using default value for key\", key);\n\t\t}\n\t\treturn value;\n\t};\n\n\tthis.writeBool = function(key, value) {\n\t\tthis.setData(key, value || false);\n\t};\n});\n\nvar localStorageModel = new localStorageModel();\nexports = localStorageModel;\n","pre":true},"sdk/plugins/weeby/trackers/uuid.js":{"path":"sdk/plugins/weeby/trackers/uuid.js","friendlyPath":".uuid","directory":"sdk/plugins/weeby/trackers/","filename":"uuid.js","src":"/*!\nMath.uuid.js (v1.4)\nhttp://www.broofa.com\nmailto:robert@broofa.com\n\nCopyright (c) 2010 Robert Kieffer\nDual licensed under the MIT and GPL licenses.\n*/\n\n/*\n * Generate a random uuid.\n *\n * USAGE: Math.uuid(length, radix)\n *   length - the desired number of characters\n *   radix  - the number of allowable values for each character.\n *\n * EXAMPLES:\n *   // No arguments  - returns RFC4122, version 4 ID\n *   >>> Math.uuid()\n *   \"92329D39-6F5C-4520-ABFC-AAB64544E172\"\n *\n *   // One argument - returns ID of the specified length\n *   >>> Math.uuid(15)     // 15 character ID (default base=62)\n *   \"VcydxgltxrVZSTV\"\n *\n *   // Two arguments - returns ID of the specified length, and radix. (Radix must be <= 62)\n *   >>> Math.uuid(8, 2)  // 8 character ID (base=2)\n *   \"01001010\"\n *   >>> Math.uuid(8, 10) // 8 character ID (base=10)\n *   \"47473046\"\n *   >>> Math.uuid(8, 16) // 8 character ID (base=16)\n *   \"098F4D35\"\n */\n// Private array of chars to use\nvar CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\n\nexports = function (len, radix) {\n  var chars = CHARS, uuid = [], i;\n  radix = radix || chars.length;\n\n  if (len) {\n    // Compact form\n    for (i = 0; i < len; i++) uuid[i] = chars[0 | Math.random()*radix];\n  } else {\n    // rfc4122, version 4 form\n    var r;\n\n    // rfc4122 requires these characters\n    uuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\n    uuid[14] = '4';\n\n    // Fill in random data.  At i==19 set the high bits of clock sequence as\n    // per rfc4122, sec. 4.1.5\n    for (i = 0; i < 36; i++) {\n      if (!uuid[i]) {\n        r = 0 | Math.random() * 16;\n        uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\n      }\n    }\n  }\n\n  return uuid.join('');\n};","pre":true},"sdk/plugins/weeby/ui/config.js":{"path":"sdk/plugins/weeby/ui/config.js","friendlyPath":".ui.config","directory":"sdk/plugins/weeby/ui/","filename":"config.js","src":"jsio(\"import device\");\n\nexports.TRANSITION_TIME = 300;\n\nexports.IMAGE_DIR = \"addons/weeby/theme/images/\";\nexports.getThemeImageURL = function (filename) {\n\treturn exports.IMAGE_DIR + filename.replace(/^\\//, '');\n}\n\nexports.TARGET_WIDTH = 576;\n\n// fixed aspect ratio for main content area\nexports.CONTENT_RATIO = 2 / 3;\n\n// maximum aspect ratio for background image\nexports.BG_RATIO = 9 / 16;\n\n// screen attributes\nexports.ABS_WIDTH = device.screen.width;\nexports.ABS_HEIGHT = device.screen.height;\nexports.ABS_RATIO = exports.ABS_WIDTH / exports.ABS_HEIGHT;\n\n// ---\nexports.IS_LANDSCAPE = false;\n\nif (exports.IS_LANDSCAPE) {\n} else {\n\n\t// top-level scale\n\tif (exports.ABS_RATIO > exports.CONTENT_RATIO) {\n\t\t// shrink width, fit height\n\t\texports.CONTENT_HEIGHT = exports.TARGET_WIDTH / exports.CONTENT_RATIO;\n\t\texports.CONTENT_WIDTH = exports.CONTENT_HEIGHT * exports.CONTENT_RATIO;\n\t\texports.SCALE = exports.ABS_HEIGHT / exports.CONTENT_HEIGHT;\n\t} else {\n\t\t// shrink height, fit width\n\t\texports.SCALE = exports.ABS_WIDTH / exports.TARGET_WIDTH;\n\t\texports.CONTENT_WIDTH = exports.TARGET_WIDTH;\n\t\texports.CONTENT_HEIGHT = exports.CONTENT_WIDTH / exports.CONTENT_RATIO;\n\t}\n\n\t// for full screen views, compute the additional scale factor required to\n\t// stretch the view's width to the width of the screen, if necessary\n\texports.FULL_SCREEN_SCALE_RELATIVE = exports.ABS_WIDTH / exports.TARGET_WIDTH / exports.SCALE;\n\n\t// FULL_SCREEN_SCALE_RELATIVE is the scale to be applied on top of SCALE to scale\n\t// a full-screen view.  FULL_SCREEN_SCALE scales an absolute screen coordinate to the\n\t// full screen scale\n\texports.FULL_SCREEN_SCALE = exports.FULL_SCREEN_SCALE_RELATIVE * exports.SCALE;\n\texports.FULL_SCREEN_WIDTH = exports.TARGET_WIDTH;\n\texports.FULL_SCREEN_HEIGHT = exports.ABS_HEIGHT / exports.FULL_SCREEN_SCALE;\n\n\t// compute the expand-height for full-screen views (may be negative!)\n\tvar actualViewHeight = exports.FULL_SCREEN_HEIGHT;\n\tvar designedViewHeight = exports.TARGET_WIDTH / exports.CONTENT_RATIO;\n\texports.FULL_SCREEN_EXPAND_HEIGHT =  actualViewHeight - designedViewHeight;\n\n\t// compute maximum size of a view\n\t// corresponds to a view that exactly fits into the screen\n\texports.MAX_WIDTH = exports.ABS_WIDTH / exports.SCALE;\n\texports.MAX_HEIGHT = exports.ABS_HEIGHT / exports.SCALE;\n\n\t// compute the size of the fixed-aspect-ratio content and its offset\n\t// CONTENT_OFFSET_Y >= 0 since content should always fit entirely inside the screen\n\t// CONTENT_OFFSET_Y centers the content vertically\n\texports.CONTENT_OFFSET_Y = Math.max(0, exports.CONTENT_WIDTH / exports.ABS_RATIO - exports.CONTENT_HEIGHT) / 2;\n\texports.CONTENT_OFFSET_X = Math.max(0, (exports.ABS_WIDTH - exports.CONTENT_WIDTH * exports.SCALE) / 2);\n\n\texports.EXPAND_HEIGHT = exports.MAX_HEIGHT - exports.CONTENT_HEIGHT;\n}\n\nvar statusBar = device.get('StatusBar');\nexports.STATUS_BAR_HEIGHT = (statusBar.getHeight && statusBar.getHeight() || 0) / exports.SCALE;\n\n","pre":true},"sdk/plugins/weeby/weebyLocalData.js":{"path":"sdk/plugins/weeby/weebyLocalData.js","friendlyPath":".weebyLocalData","directory":"sdk/plugins/weeby/","filename":"weebyLocalData.js","src":"jsio(\"import event.Emitter as Emitter\");\n\njsio(\"import .models.localStorageModel as localStorageModel\");\n\nWeebyLocalData=__class__;var WeebyLocalData=WeebyLocalData(function WeebyLocalData(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tvar AB_TEST_KEY = 'AB_TESTS';\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis.setMaxListeners(20);\n\n\t\tthis._startCount = localStorageModel.readInt('START_COUNT', 0);\n\t\tlocalStorageModel.writeInt('START_COUNT', ++this._startCount);\n\n\t\tthis._premiumCurrency = localStorageModel.readInt('PREMIUM_CURRENCY', 500);\n\t\tthis._commonCurrency = localStorageModel.readInt('COMMON_CURRENCY', 100);\n\n\t\tthis._hasAcceptedTOS = localStorageModel.readBool('ACCEPTED_TOS', false);\n\n\t\tthis._xp = localStorageModel.readInt('XP', 0);\n\t\tthis._level = localStorageModel.readInt('LEVEL', 1);\n\n\t\tthis._sfxOn = localStorageModel.readBool('SFX_ON');\n\t\tthis._musicOn = localStorageModel.readBool('MUSIC_ON');\n\n\t\tthis._weeklyHighScore = localStorageModel.readInt('WEEKLY_HIGH_SCORE', 0);\n\t\tthis._weeklyHighScoreExpiration = localStorageModel.readInt('WEEKLY_HIGH_SCORE_EXPIRATION', 0);\n\t\tthis._allTimeHighScore = localStorageModel.readInt('ALL_TIME_HIGH_SCORE', 0);\n\n\t\tthis._life = localStorageModel.readInt('LIFE', 5);\n\n\t\tthis._sentHearts = null;\n\n\t\tthis._ladderExpiration = localStorageModel.getData('LADDER_EXPIRATION', 0);\n\n\t\t// Total number of games played\n\t\tthis._gamesPlayed = localStorageModel.readInt('GAMES_PLAYED', 0);\n\t\t\n\t\t// Time last crosspromo was shown\n\t\tthis._lastCpTime = localStorageModel.readInt('LAST_CP_TIME', 0);\n\t\t\n\t\t// Total number of games played when last crosspromo was shown\n\t\tthis._lastCpGamesPlayed = localStorageModel.readInt('LAST_CP_GAMES_PLAYED', 0);\n\t\t\n\t\t// Time last game was played (finished)\n\t\tthis._lastPlayedTime = localStorageModel.readInt('LAST_PLAYED_TIME', 0);\n\n\t\t// AB tests map\n\t\tthis._abTestMap = localStorageModel.getData(AB_TEST_KEY, {});\n\n\t\t// get the time the regen lives start and restore the timer\n\t\tthis.getLifeRegenStart();\n\t};\n\n\tthis.getXP = function () { return this._xp; };\n\n\tthis.addXP = function (value) {\n\t\tthis._xp = localStorageModel.writeInt('XP', this._xp + value);\n\t\tthis.emit('XPChanged', this._xp);\n\t};\n\n\tthis.getLevel = function () { return this._level; };\n\n\tthis.hasAcceptedTOS = function () { return this._hasAcceptedTOS; };\n\n\tthis.setTOSAccepted = function (value) {\n\t\tvar value = typeof value === 'boolean' ? value : true;\n\t\tthis._hasAcceptedTOS = value;\n\t\tlocalStorageModel.writeBool('ACCEPTED_TOS', value);\n\t};\n\n\tthis.setLevel = function (level) {\n\t\tthis._level = localStorageModel.writeInt('LEVEL', level);\n\t\tthis.emit('LevelChanged', this._level);\n\t};\n\n\tthis.setStartingCurrencies = function(common, premium) {\n\t\tif (this._startCount == 1) {\n\t\t\tthis._commonCurrency = common | 0;\n\t\t\tlocalStorageModel.writeInt('COMMON_CURRENCY', this._commonCurrency);\n\t\t\tthis._premiumCurrency = premium | 0;\n\t\t\tlocalStorageModel.writeInt('PREMIUM_CURRENCY', this._premiumCurrency);\n\t\t\tthis.emit('CurrencyChanged', this._commonCurrency, this._premiumCurrency);\n\t\t}\n\t}\n\n\tthis.getCommonCurrency = function () { return this._commonCurrency; };\n\n\tthis.addCommonCurrency = function (value) {\n\t\tthis._commonCurrency = localStorageModel.writeInt('COMMON_CURRENCY', this._commonCurrency + value);\n\t\tthis.emit('CurrencyChanged', this._commonCurrency, this._premiumCurrency);\n\t};\n\n\tthis.hasCommonCurrency = function (value) { return (this._commonCurrency >= value); };\n\n\tthis.useCommonCurrency = function (value) {\n\t\tif (value > 0 && this._commonCurrency >= value) {\n\t\t\tthis._commonCurrency = localStorageModel.writeInt('COMMON_CURRENCY', this._commonCurrency - value);\n\t\t\tthis.emit('CurrencyChanged', this._commonCurrency, this._premiumCurrency);\n\t\t\treturn true;\n\t\t}\n\t};\n\n\tthis.getPremiumCurrency = function () { return this._premiumCurrency; };\n\n\tthis.addPremiumCurrency = function (value) {\n\t\tthis._premiumCurrency = localStorageModel.writeInt('PREMIUM_CURRENCY', this._premiumCurrency + value);\n\t\tthis.emit('CurrencyChanged', this._commonCurrency, this._premiumCurrency);\n\t};\n\n\tthis.hasPremiumCurrency = function (value) { return (this._premiumCurrency >= value); };\n\n\tthis.usePremiumCurrency = function (value) {\n\t\tif (value > 0 && this._premiumCurrency >= value) {\n\t\t\tthis._premiumCurrency = localStorageModel.writeInt('PREMIUM_CURRENCY', this._premiumCurrency - value);\n\t\t\tthis.emit('CurrencyChanged', this._commonCurrency, this._premiumCurrency);\n\t\t\treturn true;\n\t\t}\n\t};\n\n\tthis.getSfxOn = function () { return this._sfxOn; };\n\n\tthis.setSfxOn = function (sfxOn) {\n\t\tif (this._sfxOn !== sfxOn) {\n\t\t\tthis._sfxOn = sfxOn;\n\t\t\tlocalStorageModel.writeBool('SFX_ON', sfxOn);\n\t\t}\n\t\treturn sfxOn;\n\t};\n\n\tthis.getMusicOn = function () { return this._musicOn; };\n\n\tthis.setMusicOn = function (musicOn) {\n\t\tif (this._musicOn !== musicOn) {\n\t\t\tthis._musicOn = musicOn;\n\t\t\tlocalStorageModel.writeBool('MUSIC_ON', musicOn);\n\t\t}\n\t\treturn musicOn;\n\t};\n\n\t// updates the expiration time for the weekly highscore. The given expirationTime should be in ms\n\tthis.updateLadderExpiration = function (expirationTime) {\n\t\t// if the expiration for the ladder has changed update it and reset the weekly highscore\n\t\tif (expirationTime != this._ladderExpiration) {\n\t\t\t// only reset the weekly high score if the expiration time for the score is in the past\n\t\t\tif (expirationTime > this._weeklyHighScoreExpiration) {\n\t\t\t\tthis._weeklyHighScore = localStorageModel.writeInt('WEEKLY_HIGH_SCORE', 0);\n\t\t\t}\n\t\t\tthis._weeklyHighScoreExpiration = localStorageModel.writeInt('WEEKLY_HIGH_SCORE_EXPIRATION', expirationTime);\n\t\t\tthis._ladderExpiration = localStorageModel.writeInt('LADDER_EXPIRATION', expirationTime);\n\t\t}\n\t};\n\n\tthis.getLadderExpiration = function (expirationTime) {\n\t\treturn this._ladderExpiration;\n\t};\n\n\tthis.getWeeklyHighScore = function () {\n\t\tthis._checkWeeklyHighScore();\n\t\treturn this._weeklyHighScore;\n\t};\n\n\tthis.getAllTimeHighScore = function () {\n\t\treturn this._allTimeHighScore;\n\t};\n\n\t// checks to see if the weekly high score should be reset\n\tthis._checkWeeklyHighScore = function () {\n\t\tvar currentTime = Date.now();\n\t\t// if we are past the expiration time then clear the highscore and set to expire in the distant future\n\t\t// this is done because we may not have received the correct expiration time from the server yet\n\t\tif (currentTime > this._weeklyHighScoreExpiration) {\n\t\t\tvar futureDate = new Date(8640000000000000)\n\t\t\tthis._weeklyHighScore = localStorageModel.writeInt('WEEKLY_HIGH_SCORE', 0);\n\t\t\tthis._weeklyHighScoreExpiration = localStorageModel.writeInt('WEEKLY_HIGH_SCORE_EXPIRATION', futureDate);\n\t\t}\n\t};\n\n\t// updates both the all time and weekly high scores for the user\n\tthis.updateHighScore = function (highScore) {\n\t\tthis._checkWeeklyHighScore();\n\t\tif (highScore > this._weeklyHighScore) {\n\t\t\tthis._weeklyHighScore = localStorageModel.writeInt('WEEKLY_HIGH_SCORE', highScore);\n\t\t}\n\n\t\tif (highScore > this._allTimeHighScore) {\n\t\t\tthis._allTimeHighScore = localStorageModel.writeInt('ALL_TIME_HIGH_SCORE', highScore);\n\t\t}\n\n\t\treturn this._allTimeHighScore;\n\t};\n\n\tthis.getLife = function () {\n\t\treturn this._life;\n\t};\n\n\tthis.addLife = function (count) {\n\t\tthis.setLife(this.getLife() + count);\n\t}\n\n\tthis.useLife = function () {\n\t\tthis.setLife(this.getLife() - 1);\n\t}\n\n\tthis.setLife = function (life) {\n\t\tvar prevLife = this._life;\n\n\t\tif (life > this._maxLives) {\n\t\t\tlife = this._maxLives;\n\t\t}\n\n\t\tthis._life = localStorageModel.writeInt('LIFE', life);\n\n\t\tif (this._life != prevLife) {\n\t\t\tif (prevLife == 5 && this._life < 5) {\n\t\t\t\tthis.setLifeRegenStart();\n\t\t\t}\n\n\t\t\tthis.updateLifeRegen();\n\t\t\tthis.emit('LifeChanged', this._life);\n\t\t}\n\t};\n\n\tthis.getMaxLives = function() {\n\t\treturn this._maxLives;\n\t};\n\n\tthis.getLifeRegenStart = function () {\n\t\tif (!this._lifeRegenStart) {\n\t\t\tthis._lifeRegenStart = localStorageModel.readInt('LIFE_REGEN_START', -1);\n\t\t\t(this._lifeRegenStart === -1) && this.setLifeRegenStart();\n\t\t\tthis._scheduleRegenStartTimer();\n\t\t\tthis.updateLifeRegen();\n\t\t}\n\t\treturn this._lifeRegenStart;\n\t};\n\n\tthis.setLifeRegenStart = function (start) {\n\t\tthis._lifeRegenStart = localStorageModel.writeInt('LIFE_REGEN_START', start || Date.now());\n\t\tthis._scheduleRegenStartTimer();\n\t};\n\n\t/*\n\t * Starts the timer for adding a life when the next one is available.\n\t * If we're at the leaderboard, the timer will be called every second,\n\t * but when we're not there, we need this background timer.\n\t */\n\tthis._scheduleRegenStartTimer = function () {\n\t\tvar endTime = this._lifeRegenStart + this._lifeRegenTime;\n\t\tvar msLeft = endTime - Date.now();\n\t\tif (msLeft > 0) {\n\t\t\tclearTimeout(this._regenTimeout);\n\t\t\tthis._regenTimeout = setTimeout(bind(this, 'updateLifeRegen'), msLeft);\n\t\t} else {\n\t\t\tthis.updateLifeRegen();\n\t\t}\n\t}\n\n\tthis.setupLifeRegen = function (lifeRegenTime, maxLives) {\n\t\tthis._lifeRegenTime = lifeRegenTime;\n\t\tthis._maxLives = maxLives;\n\t};\n\n\tthis.updateLifeRegen = function () {\n\t\tvar remainingTime = {min: -1, sec: -1};\n\n\t\tif (this._life < 5) {\n\t\t\tvar time = Date.now();\n\t\t\tvar start = this.getLifeRegenStart();\n\t\t\tvar addedLives = false;\n\t\t\tvar lives = this._life;\n\t\t\twhile (start + this._lifeRegenTime < time) {\n\t\t\t\tlives = Math.min(5, lives + 1);\n\t\t\t\tstart += this._lifeRegenTime;\n\t\t\t\taddedLives = true;\n\t\t\t}\n\n\t\t\tif (addedLives) {\n\t\t\t\tthis.setLifeRegenStart(start);\n\t\t\t}\n\n\t\t\tif (lives != this._life) {\n\t\t\t\tthis.setLife(lives);\n\t\t\t}\n\n\t\t\tvar end = start + this._lifeRegenTime;\n\t\t\tvar msLeft = end - time;\n\t\t\tvar sec = (msLeft / 1000) | 0;\n\t\t\tremainingTime.min = (sec / 60) | 0;\n\t\t\tremainingTime.sec = sec % 60;\n\t\t}\n\n\t\treturn remainingTime;\n\t};\n\n\tthis.getMSToFullLives = function () {\n\t\tvar regenLeft = this.updateLifeRegen();\n\t\tvar remainingTime = 0;\n\n\t\tif (this._life < 5) {\n\t\t\tremainingTime = (4 - this._life) * this._lifeRegenTime + regenLeft.min * 60 * 1000 + regenLeft.sec * 1000;\n\t\t}\n\n\t\treturn remainingTime;\n\t};\n\n\tthis.getEquipItems = function () {\n\t\treturn localStorageModel.getData('EQUIP') || '';\n\t};\n\n\tthis.setEquipItems = function (items) {\n\t\tlocalStorageModel.setData('EQUIP', items);\n\t};\n\n\tthis.getSentHearts = function () {\n\t\tif (!this._sentHearts) {\n\t\t\tthis._sentHearts = localStorageModel.getData('HEARTS_SENT');\n\t\t}\n\t\treturn this._sentHearts || {};\n\t};\n\n\tthis.setSentHearts = function (sentHearts) {\n\t\tthis._sentHearts = sentHearts;\n\t\tlocalStorageModel.setData('HEARTS_SENT', sentHearts);\n\t};\n\n\tthis.getGamesPlayed = function() {\n\t\treturn this._gamesPlayed;\n\t}\n\n\tthis.setGamesPlayed = function(gamesPlayed) {\n\t\tthis._gamesPlayed = gamesPlayed;\n\t\tlocalStorageModel.writeInt('GAMES_PLAYED', gamesPlayed);\n\t}\n\n\tthis.getLastPlayedTime = function() {\n\t\treturn this._lastPlayedTime;\n\t}\n\n\tthis.setLastPlayedTime = function(lastPlayedTime) {\n\t\tthis._lastPlayedTime = lastPlayedTime;\n\t\tlocalStorageModel.writeInt('LAST_PLAYED_TIME', lastPlayedTime);\n\t}\n\n\tthis.getLastCrosspromoTime = function() {\n\t\treturn this._lastCpTime;\n\t}\n\n\tthis.setLastCrosspromoTime = function(lastCpTime) {\n\t\tthis._lastCpTime = lastCpTime;\n\t\tlocalStorageModel.writeInt('LAST_CP_TIME', lastCpTime);\n\t}\n\n\tthis.getLastCrosspromoGamesPlayed = function() {\n\t\treturn this._lastCpGamesPlayed;\n\t}\n\n\tthis.setLastCrosspromoGamesPlayed = function(lastCpGamesPlayed) {\n\t\tthis._lastCpGamesPlayed = lastCpGamesPlayed;\n\t\tlocalStorageModel.writeInt('LAST_CP_GAMES_PLAYED', lastCpGamesPlayed);\n\t}\n\n\tthis.getCrosspromoRewards = function () {\n\t\tif (!this._crosspromoRewards) {\n\t\t\tthis._crosspromoRewards = localStorageModel.getData('CROSSPROMO_REWARDS');\n\t\t}\n\t\treturn this._crosspromoRewards || [];\n\t};\n\n\tthis.setCrosspromoRewards = function (crosspromoRewards) {\n\t\tthis._crosspromoRewards = crosspromoRewards;\n\t\tlocalStorageModel.setData('CROSSPROMO_REWARDS', crosspromoRewards);\n\t};\n\n\tthis.getCrosspromoTriggers = function () {\n\t\tif (!this._crosspromoTriggers) {\n\t\t\tthis._crosspromoTriggers = localStorageModel.getData('CROSSPROMO_TRIGGERS');\n\t\t}\n\t\treturn this._crosspromoTriggers || [];\n\t};\n\n\tthis.setCrosspromoBucket = function (crosspromoBucket) {\n\t\tthis._crosspromoBucket = crosspromoBucket;\n\t\tlocalStorageModel.setData('CROSSPROMO_BUCKET', crosspromoBucket);\n\t};\n\n\tthis.getCrosspromoBucket = function () {\n\t\tif (!this._crosspromoBucket) {\n\t\t\tthis._crosspromoBucket = localStorageModel.getData('CROSSPROMO_BUCKET');\n\t\t}\n\t\treturn this._crosspromoBucket;\n\t};\n\n\tthis.setCrosspromoTriggers = function (crosspromoTriggers) {\n\t\tthis._crosspromoTriggers = crosspromoTriggers;\n\t\tlocalStorageModel.setData('CROSSPROMO_TRIGGERS', crosspromoTriggers);\n\t};\n\t\n\tthis.getFirstAuth = function () {\n\t\tif (!localStorageModel.readBool('AUTH_BEFORE', false)) {\n\t\t\tlocalStorageModel.writeBool('AUTH_BEFORE', true);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tthis.getTutorialMode = function() {\n\t\treturn localStorageModel.getData('TUTORIAL_MODE', true);\n\t};\n\n\tthis.setTutorialMode = function(mode) {\n\t\tlocalStorageModel.setData('TUTORIAL_MODE', mode);\n\t};\n\n\tthis.getTutorialStep = function() {\n\t\treturn localStorageModel.getData('TUTORIAL_STEP', 1);\n\t};\n\n\tthis.setTutorialStep = function(step) {\n\t\tlocalStorageModel.setData('TUTORIAL_STEP', step);\n\t};\n\n\tthis.getShopItems = function() {\n\t\treturn localStorageModel.getData('INVENTORY', {});\n\t}\n\n\tthis.getShopItemData = function(item) {\n\t\tvar inventory = localStorageModel.getData('INVENTORY', {});\n\t\tvar data;\n\t\tif (inventory[item.id]) {\n\t\t\tdata = inventory[item.id];\n\t\t} else {\n\t\t\tdata = {\n\t\t\t\tequipped: false,\n\t\t\t\tcount: 0,\n\t\t\t\tlevel: 0,\n\t\t\t\towned: false\n\t\t\t};\n\t\t\t// if the data did not exist add it to local storage now\n\t\t\tthis.setShopItemData(item.id, data);\n\t\t}\n\t\treturn data;\n\t};\n\n\tthis.setShopItemData = function(itemId, data) {\n\t\tvar inventory = localStorageModel.getData('INVENTORY', {});\n\t\tinventory[itemId] = data;\n\t\tlocalStorageModel.setData('INVENTORY', inventory);\n\t}\n\n\tthis.setShopItemEquipped = function(item, equipped) {\n\t\t// Find the current data stored for that itemId\n\t\tvar itemData = this.getShopItemData(item);\n\t\titemData.equipped = equipped;\n\t\tthis.setShopItemData(item.id, itemData);\n\t}\n\n\tthis.purchaseShopItem = function(item) {\n\t\t// Find the current data stored for that itemId\n\t\tvar itemData = this.getShopItemData(item);\n\n\t\t// Buy the item if needed then up the level/count\n\t\tif (!itemData.owned) {\n\t\t\titemData.owned = true;\n\t\t}\n\n\t\tif (item.canLevel) {\n\t\t\titemData.level++;\n\t\t}\n\n\t\tif (item.canConsume) {\n\t\t\titemData.count++;\n\t\t}\n\n\t\tthis.setShopItemData(item.id, itemData);\n\t\treturn itemData;\n\t};\n\n\tthis.getAbTests = function() {\n\t\treturn this._abTestMap; \n\t}\n\n\tthis.setAbTests = function(map) {\n\t\tthis._abTestMap = map;\n\t\tlocalStorageModel.setData(AB_TEST_KEY, map);\n\t}\n\n});\n\nvar weebyLocalData = new WeebyLocalData();\nexports = weebyLocalData;\n","pre":true},"sdk/plugins/weeby/weebyNative.js":{"path":"sdk/plugins/weeby/weebyNative.js","friendlyPath":".weebyNative","directory":"sdk/plugins/weeby/","filename":"weebyNative.js","src":"jsio(\"import event.Emitter as Emitter\");\n\njsio(\"import lib.Callback\");\njsio(\"import device\");\njsio(\"import .ui.config\");\njsio(\"import .weebyLocalData\");\n\nWeebyNative=__class__;var WeebyNative=WeebyNative(function WeebyNative(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\n\tthis.statusBarNotification = null;\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis._registeredPush = new lib.Callback();\n\n\t\tthis._hasPlugins = NATIVE && NATIVE.plugins && true;\n\t\tthis._hasEvents = NATIVE && NATIVE.events && true;\n\t\tthis._canAutoReadAuthCode = device.isAndroid;\n\n\t\tthis._contactsCbs = [];\n\n\t\tif (this._hasEvents) {\n\n\t\t\tif (this._canAutoReadAuthCode) {\n\t\t\t\t// register handler for auth code and emit the event\n\t\t\t\tNATIVE.events.registerHandler('WeebyAuthCode', bind(this, function (data) {\n\t\t\t\t\tthis.emit('authCode', {code: data.code});\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tNATIVE.events.registerHandler('WeebyPushNotificationRegistation', bind(this, function(data) {\n\t\t\t\tif (data.success) {\n\t\t\t\t\tthis._registeredPush.fire(data.deviceToken);\n\t\t\t\t}\n\t\t\t}));\n\n            NATIVE.events.registerHandler('WeebyNotification', bind(this, function (data) {\n                var notification = {\n                                        id: data.id,\n                                        title: data.title,\n                                        message: data.message,\n                                        isLocal: data.isLocal,\n                                        fromStatusBar: data.fromStatusBar\n                                    };\n\n                if (data.fromStatusBar) {\n                    this.statusBarNotification = notification;\n                };\n\n                this.emit('notification', notification);\n            }));\n\n            NATIVE.events.registerHandler('WeebyContacts', bind(this, function (evt) {\n                var data = evt.data;\n\n                if (typeof data == 'string') {\n                \t// TODO: does android need to stringify/parse a second time?\n                \tdata = JSON.parse(data);\n                }\n\n                while (this._contactsCbs.length) {\n\t\t\t\t\tthis._contactsCbs.shift()(data.error, data.items);\n                }\n            }));\n\n            NATIVE.events.registerHandler('WeebyChatDarkLaunch', bind(this, function(data) {\n                this.emit('ChatDarkLaunch', data);\n            }));\n\n            NATIVE.events.registerHandler('WeebyChatMessage', bind(this, function(data) {\n                this.emit('ChatMessage', data);\n            }));\n\n            NATIVE.events.registerHandler('WeebyChatMessageSuccess', bind(this, function(data) {\n                this.emit('ChatMessageSuccess', data);\n            }));\n\n            NATIVE.events.registerHandler('WeebyChatMessageSent', bind(this, function(data) {\n                this.emit('ChatMessageSent', data);\n            }));\n\n            NATIVE.events.registerHandler('WeebyChatConnect', bind(this, function(data) {\n                this.emit('ChatConnect', data);\n            }));\n\n            NATIVE.events.registerHandler('WeebyCountryIso', bind(this, function(data) {\n\t\t\t\tconsole.log(\"emitting country iso event: \" + JSON.stringify(data));\n\t\t\t\tthis.emit('countryIso', data);\n\t\t\t}));\n\n\t\t\tNATIVE.events.registerHandler('WeebyPhoneNumber', bind(this, function(data) {\n\t\t\t\tthis.emit('phoneNumber', data);\n\t\t\t}));\n\n\t\t\tNATIVE.events.registerHandler('PhotoLoaded', bind(this, function(data) {\n\t\t\t\tthis.emit('PhotoLoaded', data);\n\t\t\t}));\n\n\t\t\tNATIVE.events.registerHandler('PhotoBeginLoaded', bind(this, function(data) {\n\t\t\t\tthis.emit('PhotoBeginLoaded', data);\n\t\t\t}));\n\t\t}\n\n\t\tif (NATIVE && NATIVE.backButton) {\n\t\t\tNATIVE.backButton.subscribe('pressed', this, function() {\n\t\t\t\tthis.emit('BackButton');\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.sendToBackground = function () {\n\t\tif (NATIVE && NATIVE.sendActivityToBack) {\n\t\t\tNATIVE.sendActivityToBack();\n\t\t}\n\t};\n\n\tthis.online = function() {\n\t\tthis._sendNativeEvent(\"online\", JSON.stringify({}));\n\t}\n\n\tthis.offline = function() {\n\t\tthis._sendNativeEvent(\"offline\", JSON.stringify({}));\n\t}\n\n\n\tthis.disconnectFromChatServer = function() {\n\t\tthis._sendNativeEvent(\"disconnectFromChatServer\", JSON.stringify({}));\n\t};\n\n\tthis.postDisconnectFromChatServer = function(ms) {\n\t\tthis._sendNativeEvent(\"postDisconnectFromChatServer\", JSON.stringify({ms: ms}));\n\t};\n\n\tthis.connectToChatServer = function(id, key) {\n\t\tthis._sendNativeEvent(\"connectToChatServer\", JSON.stringify({id: id, key: key}));\n\t}\n\n\tthis.sendChatMessage = function(id, message) {\n\t\tvar uuid;\n\t\t\n\t\tif (this._hasPlugins) {\n\t\t\tuuid = this._sendNativeEvent(\"sendChatMessageTo\", JSON.stringify({id: id, message: message}));\n\t\t}\n\n\t\treturn uuid;\n\t}\n\n\tthis.canAutoReadAuthCode = function () { return this._canAutoReadAuthCode; }\n\n\tthis.setAPI = function (api) {\n\t\tthis._registeredPush.run(this, function (deviceToken) {\n\t\t\tapi.registerAPNS({\n\t\t\t\ttoken: deviceToken\n\t\t\t});\n\t\t});\n\t}\n\n\tthis.getContactListAccess = function () {\n\t\tvar res;\n\t\tif (this._hasPlugins) {\n\t\t\tres = this._sendNativeEvent(\"getContactListAccess\", JSON.stringify({}));\n\t\t\ttry {\n\t\t\t\tres = JSON.parse(res);\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\treturn res && res.status || 'authorized';\n\t}\n\n\tif (DEBUG) {\n\t\tthis.debugSetContactsAccess = function (accessStatus) {\n\t\t\tthis.getContactListAccess = function () {\n\t\t\t\treturn accessStatus;\n\t\t\t}\n\t\t}\n\t}\n\n    this.getCountryIso = function (cb) {\n        if (this._hasPlugins) {\n            var res = this._sendNativeEvent(\"requestCountryIso\", JSON.stringify({}));\n            if (!device.isAndroid) {\n                var iso;\n                try {\n                    iso = JSON.parse(res).iso;\n                } catch (e) {}\n\n\t\t\t\tcb && cb({iso: iso});\n\t\t\t} else {\n\t\t\t\t// TODO: remove this once android also returns sync\n\t\t\t\tthis.once('countryIso', cb);\n\t\t\t}\n\t\t} else {\n\t\t\tcb && cb({iso: 'US'});\n\t\t}\n\t}\n\n\tthis.getPhoneNumber = function (cb) {\n\t\t// TODO: do this synchronously\n\t\tif (this._hasPlugins) {\n\t\t\tthis._sendNativeEvent(\"requestPhoneNumber\", JSON.stringify({}));\n\t\t\tthis.once('phoneNumber', cb);\n\t\t} else {\n\t\t\tcb && cb({number: null});\n\t\t}\n\t}\n\n\tthis.readContactList = function (cb) {\n\t\tthis._contactsCbs.push(cb);\n\t\tthis._sendNativeEvent(\"readContactList\", JSON.stringify({}));\n\t}\n\n\tfunction keyToUTI(key) {\n\t\t// we're using iOS pasteboard, which has very strict limits on key types\n\t\treturn key.replace(/[^a-zA-Z0-9_-]/g, '').replace(/_/g, '.').replace(/\\.+/g, '.').replace(/^\\.|\\.$/g, '');\n\t}\n\n\t// writes a value to global storage\n\t//   key : string - key to use\n\t//   value : string - value to write (must be a string!)\n\tthis.writeToGlobalStorage = function (key, value) {\n\t\tNATIVE.plugins.sendEvent(\"WeebyPlugin\", \"writeToGlobalStorage\", JSON.stringify({key: keyToUTI(key), value: value}));\n\t}\n\n\t// returns a string for the provided key\n\tthis.readFromGlobalStorage = function (key) {\n\t\tvar value = NATIVE.plugins.sendEvent(\"WeebyPlugin\", \"readFromGlobalStorage\", JSON.stringify({key: keyToUTI(key)}));\n\t\tif (!value) {\n\t\t\t// try deprecated storage read\n\t\t\tvalue = NATIVE.plugins.sendEvent(\"WeebyPlugin\", \"readFromGlobalStorage\", JSON.stringify({key: key}));\n\t\t}\n\n\t\treturn value;\n\t};\n\n\t//get the cached status bar notification, null if none exist / has already been consumed\n\tthis.getStatusBarNotification = function () {\n\t\tvar notification = this.statusBarNotification;\n\t\tthis.statusBarNotification = null;\n\t\treturn notification;\n\t}\n\n\tthis.scheduleLocalNotification = function(data) {\n\t\t//{delay long, id str, title str, message str, count(optional) int}\n\t\tthis._sendNativeEvent(\"scheduleLocalNotification\", JSON.stringify(data));\n\t}\n\n\tthis.cancelLocalNotification = function(data) {\n\t\t//{id str}\n\t\tthis._sendNativeEvent(\"cancelLocalNotification\", JSON.stringify(data));\n\t}\n\n\n\t// sets whether the app is in debug mode or not\n\tthis.setDebug = function (debug) {\n\t\tvar isDebug = false;\n\t\tif (debug) {\n\t\t\tisDebug = true;\n\t\t}\n\n\t\tif (this._hasPlugins) {\n\t\t\tthis._sendNativeEvent(\"setDebug\", JSON.stringify({isDebug: isDebug}));\n\t\t} else {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\t// set whether the user has been authed\n\tthis.setAuthed = function (authed) {\n\t\tif (this._hasPlugins) {\n\t\t\tthis._sendNativeEvent(\"setAuthed\", JSON.stringify({authed: authed}));\n\t\t} else {\n\t\t\t// do nothing\n\t\t}\n\t}\n\n\t//sends an event to native if native is valid\n\tthis._sendNativeEvent = function (functionName, argsJsonStr) {\n\t\tif (this._hasPlugins) {\n\t\t\treturn NATIVE.plugins.sendEvent(\"WeebyPlugin\", functionName, argsJsonStr);\n\t\t}\n\t}\n\n});\n\nexports = new WeebyNative();\n","pre":true},"sdk/plugins/weeby/weebyDebug.js":{"path":"sdk/plugins/weeby/weebyDebug.js","friendlyPath":".weebyDebug","directory":"sdk/plugins/weeby/","filename":"weebyDebug.js","src":"jsio(\"import .weebyStates\");\njsio(\"import .weebyController\");\njsio(\"import .weebyLocalData\");\njsio(\"import .weebyNative\");\n\nvar DEBUG_RAW_PATH = '/simulate/addons/weeby/themes/';\n\nWeebyDebugger=__class__;var WeebyDebugger=WeebyDebugger(function WeebyDebugger(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts, cb) {\n\t\tif (!opts) { return; }\n\n\t\twindow.addEventListener('message', bind(this, '_onMessage'));\n\n\t\tthis.sendEvent('HANDSHAKE', {\n\t\t\tstates: weebyStates.states\n\t\t});\n\n\t\tthis._onDebugReady = cb;\n\t\tthis._onDebugTimeout = setTimeout(function () {\n\t\t\tthis._onDebugReady = null;\n\t\t\tcb({TIMED_OUT: true});\n\t\t}, 5000);\n\t}\n\n\tthis._fetch = function (name, fallbackToBase) {\n\t\tvar res = {\n\t\t\t\ttheme: this._theme,\n\t\t\t\tcontents: jsio.__env.fetch(this._path + this._theme + this._layoutDir + name + '.ui')\n\t\t\t};\n\n\t\tif (!res.contents && fallbackToBase !== false) {\n\t\t\tres.theme = 'base';\n\t\t\tres.contents = jsio.__env.fetch(this._path + 'base' + this._layoutDir + name + '.ui');\n\t\t}\n\n\t\tif (!res.contents) {\n\t\t\tres.contents = '';\n\t\t}\n\n\t\treturn res;\n\t}\n\n\tthis._initSourceCache = function (themeName) {\n\t\tthis._themeName = themeName;\n\t\tthis._path = DEBUG_RAW_PATH;\n\t\tthis._theme = themeName;\n\t\tthis._layoutDir = '/layouts/';\n\n\t\tthis._srcCache = {};\n\t\tthis._parseCache = {};\n\n\t\tif (!this._srcCache.common) {\n\t\t\tthis._srcCache.common = this._fetch('common', false);\n\t\t}\n\t\t\n\t\tif (!this._srcCache.header) {\n\t\t\tthis._srcCache.header = this._fetch('header', false);\n\t\t}\n\n\t\tthis.sendEvent('UPDATE_COMMON', {\n\t\t\theader: {\n\t\t\t\tfileId: this._srcCache.header.theme + ':' + 'header',\n\t\t\t\tcontents: this._srcCache.header.contents\n\t\t\t},\n\t\t\tcommon: {\n\t\t\t\tfileId: this._srcCache.common.theme + ':' + 'common',\n\t\t\t\tcontents: this._srcCache.common.contents\n\t\t\t}\n\t\t});\n\t}\n\n\tthis._initMockData = function (data) {\n\t\tthis._api.debugSetIsVerified(!!data.isVerified);\n\t\tweebyLocalData.setTOSAccepted(!!data.acceptedTOS);\n\t\tweebyNative.debugSetContactsAccess(data.contactsAccess);\n\t}\n\n\tthis._setLanguage = function (language) {\n\t\tjsio(\"import .i18n\");\n\t\ti18n.setLanguage(language);\n\t}\n\n\tthis._onStateChanged = function (state) {\n\t\tif (weebyStates.details[state]) {\n\t\t\tvar filename = weebyStates.details[state].filename;\n\t\t\tif (!this._srcCache[filename]) {\n\t\t\t\tthis.getViewDef(state);\n\t\t\t}\n\n\t\t\tif (this._srcCache[filename]) {\n\t\t\t\tthis.sendEvent('UPDATE', {\n\t\t\t\t\tstate: state,\n\t\t\t\t\tid: this._srcCache[filename].theme + ':' + filename,\n\t\t\t\t\tcontents: this._srcCache[filename].contents\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tthis._onMessage = function (msg) {\n\t\tif (/^WEEBY_THEME:/.test(msg.data)) {\n\t\t\tvar evt = JSON.parse(msg.data.slice(12));\n\t\t\tthis._onEvent(evt.name, evt.data);\n\t\t}\n\t}\n\n\tthis._onEvent = function (name, data) {\n\t\tswitch (name) {\n\t\t\tcase 'HANDSHAKE':\n\n\t\t\t\tthis._initSourceCache(data.theme);\n\t\t\t\tthis._setLanguage(data.language);\n\n\t\t\t\tjsio(\"import .sdk.api as api\");\n\t\t\t\tjsio(\"import .sdk.apiMock as apiMock\");\n\n\t\t\t\tif (data.server == 'mock') {\n\t\t\t\t\tthis._api = new apiMock.Weeby({\n\t\t\t\t\t\tauthKey: data.authKey,\n\t\t\t\t\t\tappID: CONFIG.appID\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._initMockData(data);\n\t\t\t\t} else {\n\t\t\t\t\tthis._api = new api.Weeby({\n\t\t\t\t\t\tauthKey: data.authKey,\n\t\t\t\t\t\tstaging: data.server == 'staging',\n\t\t\t\t\t\tlocal: data.server == 'local',\n\t\t\t\t\t\tappID: CONFIG.appID\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tjsio(\"import .ui.WeebyViews as WeebyViews\");\n\n\t\t\t\tWeebyViews.prototype.getViewDef = bind(this, 'getViewDef');\n\n\t\t\t\tweebyController.subscribe('StateChanged', this, '_onStateChanged');\n\t\t\t\tthis._onStateChanged(weebyController.getState());\n\n\t\t\t\tif (this._onDebugReady) {\n\t\t\t\t\tconsole.log(\"HANDSHAKE: calling debugReady callback\");\n\t\t\t\t\tclearTimeout(this._onDebugTimeout);\n\t\t\t\t\tthis._onDebugReady(null, this._api);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'RELOAD':\n\t\t\t\ttry {\n\t\t\t\t\tvar pieces = data.fileId.split(':');\n\t\t\t\t\tvar theme = pieces[0];\n\t\t\t\t\tvar filename = pieces[1];\n\t\t\t\t\tthis._debugReload(filename, data.contents);\n\n\t\t\t\t\tthis.sendEvent('result', {\n\t\t\t\t\t\t\tfilename: data.filename,\n\t\t\t\t\t\t\tcontents: this._parseCache[data.filename]\n\t\t\t\t\t\t});\n\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.sendEvent('error', {\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\tdata: e.message\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'setUser':\n\t\t\t\t\n\t\t\t\tbreak;\n\n\t\t\tcase 'SET_STATE':\n\t\t\t\tvar stack = data.stack;\n\t\t\t\tif (!isArray(stack)) {\n\t\t\t\t\tstack = [stack];\n\t\t\t\t}\n\n\t\t\t\t// reset the controller state\n\t\t\t\tvar controllerStack = weebyController.__getStack();\n\t\t\t\tvar n = controllerStack.length;\n\t\t\t\tfor (var i = 0; i < n - 1; ++i) {\n\t\t\t\t\tweebyController.popState();\n\t\t\t\t}\n\n\t\t\t\tweebyController.setState(weebyStates.states[stack[0]]);\n\t\t\t\tfor (var i = 1; i < n; ++i) {\n\t\t\t\t\tweebyController.pushState(weebyStates.states[stack[i]]);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tthis.getViewDef = function (state) {\n\t\tvar filename = weebyStates.details[state].filename;\n\t\tvar def = this._parseDebugStyle(filename);\n\t\tif (def) { return def; }\n\t}\n\n\tthis.sendEvent = function (name, data) {\n\t\twindow.parent && window.parent.postMessage('WEEBY_THEME:' + JSON.stringify({\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\tdata: data\n\t\t\t\t\t}), '*');\n\t}\n\n\tjsio(\"import .ui.layouts.parser.parser as Parser\");\n\tjsio(\"import .ui.layouts.parser.evaluator as Evaluator\");\n\tjsio(\"import .ui.layouts.parser.timestep.rules as timestepRules\");\n\n\t// take a name and return the JSON for it\n\t// if it doesn't exist, returns undefined\n\tthis._parseDebugStyle = function (name) {\n\t\tif (!this._srcCache[name]) {\n\t\t\tthis._srcCache[name] = this._fetch(name);\n\t\t}\n\n\t\tif (!this._parseCache[name]) {\n\t\t\tthis._parseCache[name] = this._eval(this._srcCache[name].contents);\n\t\t}\n\n\t\treturn this._parseCache[name];\n\t}\n\n\tthis._parseCommon = function () {\n\t\treturn new Parser().parse(this._srcCache.common.contents);\n\t}\n\n\t// parses and evaluates a ui source\n\tthis._eval = function (src) {\n\t\ttry {\n\t\t\t// parse and merge in common styles\n\t\t\tvar commonStyle = this._parseCommon();\n\t\t\tvar parseTree = new Parser().parse(src);\n\t\t\tmerge(parseTree.views, commonStyle.views);\n\t\t\tmerge(parseTree.styles, commonStyle.styles);\n\n\t\t\t// evaluate to json\n\t\t\tvar result = new Evaluator(timestepRules).evaluate(parseTree);\n\t\t\tvar computedViews = timestepRules.getComputedViews(result);\n\t\t\treturn computedViews;\n\t\t} catch (e) {\n\t\t\tconsole.error(e.message);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tthis._debugRefreshTimer = null;\n\tthis._debugDelayRefresh = function () {\n\t\tclearTimeout(this._debugRefreshTimer);\n\t\tthis._debugRefreshTimer = setTimeout(bind(this, '_debugRefreshAll'), 2000);\n\t}\n\n\tthis._debugRefreshAll = function () {\n\t\t// reparse all files\n\t\tfor (var key in this._srcCache) {\n\t\t\tif (key != 'common') {\n\t\t\t\tthis._parseCache[key] = this._eval(this._srcCache[key].contents);\n\t\t\t}\n\t\t}\n\n\t\tvar controllers = WeebyViews.getInstance().getViewControllers();\n\n\t\t// remove all view controllers\n\t\tfor (var key in controllers) {\n\t\t\tvar controller = controllers[key];\n\t\t\tif (controller && controller.getView) {\n\t\t\t\tcontroller.getView().removeFromSuperview();\n\t\t\t}\n\t\t\tcontrollers[key] = null;\n\t\t}\n\n\t\t// create controllers\n\t\tWeebyViews.getInstance().createControllers();\n\n\t\t// reshow the current view\n\t\tthis._debugRefreshCurrent();\n\t}\n\n\tthis._debugRefreshCurrent = function () {\n\t\tvar rootController = WeebyViews.getInstance();\n\t\tvar controllers = rootController.getViewControllers();\n\n\t\t// remove the current view\n\t\tvar state = weebyController.getState();\n\t\tif (controllers[state]) {\n\t\t\tcontrollers[state].getView().removeFromSuperview();\n\t\t}\n\n\t\tcontrollers[state] = null;\n\n\t\t// create a new view to replace it\n\t\trootController.createControllers();\n\n\t\t// show the new view without a transition\n\t\trootController.showView(state, 'reload');\n\t}\n\n\tthis._debugReload = function (filename, contents) {\n\t\tthis._srcCache[filename].contents = contents;\n\t\tif (filename == 'common') {\n\t\t\treturn this._debugDelayRefresh();\n\t\t}\n\n\t\tvar parsedStyle = this._eval(contents);\n\t\tif (JSON.stringify(this._parseCache[filename]) != JSON.stringify(parsedStyle)) {\n\t\t\tthis._parseCache[filename] = parsedStyle;\n\n\t\t\tif (filename == 'header') {\n\t\t\t\tjsio(\"import .ui.components.WeebyViewController as WeebyViewController\");\n\t\t\t\tjsio(\"import .ui.components.StatusView as StatusView\");\n\n\t\t\t\tStatusView.setViewDef(this._parseCache['header']);\n\t\t\t\t\n\t\t\t\tvar headerController = WeebyViewController.getHeader();\n\t\t\t\theaderController.getView().removeFromSuperview();\n\t\t\t\tWeebyViewController.getBackground()._statusController = null;\n\t\t\t}\n\n\t\t\tthis._debugRefreshCurrent();\n\t\t}\n\t}\n});\n\nexports = new WeebyDebugger();","pre":true},"sdk/plugins/weeby/weebyStates.js":{"path":"sdk/plugins/weeby/weebyStates.js","friendlyPath":".weebyStates","directory":"sdk/plugins/weeby/","filename":"weebyStates.js","src":"jsio(\"import lib.Enum as Enum\");\njsio(\"import device\");\njsio(\"import .trackers.trackers as trackers\");\njsio(\"import .weebyLocalData\")\n\nvar stateData = {\n    STATE_SPLASH: {\n        filename: 'game/splash',\n\t\tinitialState: 'splash.view',\n\t\t//track: 'show:splash',\n\t\tactions: {\n\t\t\t'login': true\n\t\t},\n\t\tsubstates: [\n\t\t\t'splash.view'\n\t\t]\n    },\n\tSTATE_TOS: {\n\t\tfilename: 'auth/tos',\n\t\t//track: 'show:tos',\n\t\tinitialState: 'tos.waiting',\n\t\tactions: {\n\t\t\t'login': true,\n\t\t\t'showAcceptTos': true,\n\t\t\t'back': 'STATE_SPLASH',\n\t\t\t'game': true\n\t\t},\n\t\tsubstates: [\n\t\t\t'tos.error', // Something went wrong\n\t\t\t'tos.waiting',\n\t\t\t// 'tos.waitingTutorial',\n\t\t\t// 'tos.waitingLogin', // Waiting for user to click\n\t\t\t'tos.pending' // Waining for xhr response\n\t\t]\n\t},\n\tSTATE_VERIFY: {\n\t\tfilename: 'auth/verify',\n\t\tinitialState: 'verify.waiting',\n\t\t//track: 'show:verify',\n\t\tactions: [\n\t\t\t'login',\n\t\t\t'verify', // Verifying phone number\n\t\t\t'pickCountry',\n\t\t\t'error',\n\t\t\t'confirm',\n\t\t\t'pickPhoto',\n\t\t\t'back',\n\t\t\t'backLadder',\n\t\t\t'photoSet'\n\t\t],\n\t\tsubstates: [\n\t\t\t'verify.waiting',\n\t\t\t'verify.error',\n\t\t\t'verify.noNumber', // No number entered\n\t\t\t'verify.verifying'\n\t\t]\n\t},\n    STATE_VERIFY_VARIANT: {\n        filename: 'auth/verifyvariant',\n        initialState: 'verify.view',\n        actions: [\n            'back',\n\t\t\t'backLadder',\n\t\t\t'error',\n\t\t\t'verify' \n        ],\n        substates: [\n            'verify.view'\n        ]\n    },\n    STATE_VERIFY_PHOTO: {\n        filename: 'auth/verifyphoto',\n        initialState: 'verify.view',\n        actions: [\n            'skip',\n\t\t\t'error',\n\t\t\t'pickPhoto',\n\t\t\t'photoSet',\n            'verify'\n        ],\n        substates: [\n            'verify.view'\n        ]\n\t},\n    STATE_VERIFY_PHONE: {\n        filename: 'auth/verifyphone',\n        initialState: 'verify.view',\n        actions: [\n            'back',\n            'confirm',\n            'pickCountry',\n            'error'\n        ],\n        substates: [\n            'verify.view' \n        ]\n    },\n\tSTATE_PICK_COUNTRY: {\n\t\tfilename: 'auth/pickcountry',\n\t\tinitialState: 'pickCountry.picking',\n\t\t//track: 'show:pickCountry',\n\t\tactions: [\n\t\t\t'pick',\n\t\t\t'cancel'\n\t\t],\n\t\tsubstates: [\n\t\t\t'pickCountry.picking'\n\t\t]\n\t},\n\tSTATE_AUTH_CODE: {\n\t\tfilename: 'auth/authcode',\n\t\tinitialState: 'authcode.view',\n\t\t//track: 'show:authCode',\n\t\tactions: [\n\t\t\t'view',\n\t\t\t'back',\n\t\t\t'error',\n\t\t\t'verify'\n\t\t]\n\t},\n\tSTATE_EDIT_NAME: {\n\t\tfilename: 'profile/editname',\n\t\tinitialState: 'editName.editing',\n\t\tactions: [\n\t\t\t'verify',\n\t\t\t'cancel'\n\t\t],\n\t\tsubstates: [\n\t\t\t'editName.editing',\n\t\t\t'editName.noName',\n\t\t\t'editName.verifying'\n\t\t]\n\t},\n\tSTATE_LADDER: {\n\t\tfilename: 'game/ladder',\n\t\tinitialState: 'ladder.ladder',\n\t\tactions: [\n\t\t\t'addLives',\n\t\t\t'inbox',\n\t\t\t'play',\n\t\t\t'profile',\n\t\t\t'viewFriendProfile',\n\t\t\t'settings',\n\t\t\t'login', // login upsell\n\t\t\t'gift' // Temp because clipping does not work\n\t\t],\n\t\tsubstates: [\n\t\t\t'ladder.ladder'\n\t\t]\n\t},\n\tSTATE_EQUIP: {\n\t\tfilename: 'game/equip',\n\t\tinitialState: 'equip.equip',\n\t\ttrack: function (weebyController) {\n\t\t\ttrackers.track('show:equip');\n\t\t},\n\t\tactions: [\n\t\t\t'play',\n\t\t\t'close',\n\t\t\t'itemshop'\n\t\t],\n\t\tsubstates: [\n\t\t\t'equip.equip'\n\t\t]\n\t},\n\tSTATE_GAME: {\n\t\tinitialState: 'game',\n\t\ttrack: function (weebyController) {\n\t\t\ttrackers.track('game:start', {\n\t\t\t\tlives: weebyLocalData.getLife()\n\t\t\t});\n\t\t},\n\t\tactions: [\n\t\t\t'finishGame',\n\t\t\t'cancelGame'\n\t\t],\n\t\tsubstates: [\n\t\t\t'game.game'\n\t\t]\n\t},\n\tSTATE_GAME_RESULT: {\n\t\tfilename: 'game/gameresult',\n\t\tinitialState: 'gameresult.score',\n\t\ttrack: 'show:gameResult',\n\t\tactions: [\n\t\t\t'showRankUp',\n\t\t\t'showLevelUp',\n\t\t\t'play',\n\t\t\t'close'\n\t\t],\n\t\tsubstates: [\n\t\t\t'gameresult.score'\n\t\t]\n\t},\n\tSTATE_DIALOG_PASSED_PLAYER: {\n\t\tfilename: 'dialogs/game/passedplayer',\n\t\tinitialState: 'passedplayer.passed',\n\t\ttrack: 'show:passedPlayer',\n\t\tactions: [\n\t\t\t'close'\n\t\t],\n\t\tsubstates: [\n\t\t\t'passedplayer.passed'\n\t\t]\n\t},\n\tSTATE_DIALOG_LEVEL_UP: {\n\t\tfilename: 'dialogs/game/levelup',\n\t\tinitialState: 'levelup.waiting',\n\t\ttrack: 'show:levelUp',\n\t\tactions: [\n\t\t\t'close'\n\t\t],\n\t\tsubstates: [\n\t\t\t'levelup.waiting'\n\t\t]\n\t},\n\tSTATE_CONFIRM_FRIENDS: {\n\t\tfilename: 'game/confirmfriends',\n\t\tinitialState: 'confirmfriends.friends',\n\t\ttrack: 'show:newFriends',\n\t\tactions: [\n\t\t\t'close',\n\t\t\t'accept',\n\t\t\t'viewFriendProfile'\n\t\t],\n\t\tsubstates: [\n\t\t\t'confirmfriends.friends'\n\t\t]\n\t},\n\n\tSTATE_PROFILE: {\n\t\tfilename: 'profile/profile',\n\t\tinitialState: 'profile.main',\n\t\tactions: [\n\t\t\t'back',\n\t\t\t'edit'\n\t\t],\n\t\tsubstates: [\n\t\t\t'profile.main'\n\t\t]\n\t},\n\tSTATE_EDIT_PROFILE: {\n\t\tfilename: 'profile/editprofile',\n\t\tinitialState: 'editprofile.main',\n\t\ttrack: 'show:editProfile',\n\t\tactions: [\n\t\t\t'back',\n\t\t\t'editPhoto',\n\t\t\t'editFullname'\n\t\t],\n\t\tsubstates: [\n\t\t\t'editprofile.main'\n\t\t]\n\t},\n\tSTATE_FULLNAME_EDIT: {\n\t\tfilename: 'profile/fullnameedit',\n\t\tactions: [\n\t\t\t'back',\n\t\t\t'cancel',\n\t\t\t'fullname',\n\t\t\t'nickname'\n\t\t]\n\t},\n\tSTATE_DIALOG_FULLNAME_CONFIRM: {\n\t\tfilename: 'profile/fullnameconfirm',\n\t\talwaysPushState: true,\n\t\tactions: [\n\t\t\t'change',\n\t\t\t'cancel'\n\t\t]\n\t},\n\tSTATE_FULLNAME_VERIFY: {\n\t\tfilename: 'profile/fullnameverify',\n\t\tactions: [\n\t\t\t'change',\n\t\t\t'cancel',\n\t\t\t'back'\n\t\t]\n\t},\n\tSTATE_FULLNAME_CODE: {\n\t\tfilename: 'profile/fullnamecode',\n\t\tactions: [\n\t\t\t'confirmCode',\n\t\t\t'back'\n\t\t]\n\t},\n\tSTATE_FULLNAME_CHANGE: {\n\t\tfilename: 'profile/fullnamechange',\n\t\tactions: [\n\t\t\t'change',\n\t\t\t'cancel',\n\t\t\t'back'\n\t\t]\n\t},\n\n\tSTATE_FRIEND_LIST: {\n\t\tfilename: 'weeby/friendlist',\n\t\tinitialState: 'friendlist.main',\n\t\ttrack: 'show:friendlist',\n\t\tactions: [\n\t\t\t'back',\n\t\t\t'block',\n\t\t\t'add',\n\t\t\t'viewFriendProfile'\n\t\t]\n\t},\n\n\tSTATE_CHAT_LIST: {\n\t\tfilename: 'weeby/chatlist',\n\t\tinitialState: 'chatlist.main',\n\t\ttrack: 'show:chatlist',\n\t\tactions: [\n\t\t\t'back',\n\t\t\t'openChat'\n\t\t]\n\t},\n\n\tSTATE_CHAT: {\n\t\tfilename: 'weeby/chat',\n\t\tinitialState: 'chat.main',\n\t\ttrack: 'show:chat',\n\t\tactions: [\n\t\t\t'back'\n\t\t]\n\t},\n\n\tSTATE_GIFT: { // Temp because modal does not work...\n\t\tfilename: 'game/gift',\n\t\tinitialState: 'gift.main',\n\t\tstate: 'show:gifts',\n\t\tactions: [\n\t\t\t'accept',\n\t\t\t'close'\n\t\t],\n\t\tsubstates: [\n\t\t\t'gift.main'\n\t\t]\n\t},\n\n\tSTATE_CROSSPROMO: {\n\t\tfilename: 'game/crosspromo',\n\t\tinitialState: 'crosspromo.main',\n\t\tactions: [\n\t\t\t'install',\n\t\t\t'viewFriendProfile',\n\t\t\t'close'\n\t\t],\n\t\tsubstates: [\n\t\t\t'crosspromo.main'\n\t\t]\n\t},\n\n\t// DIALOGS\n\tSTATE_DIALOG_CROSSPROMO_REWARD : {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/game/crosspromoreward',\n\t\talwaysPushState: true,\n\t\tactions: [\n\t\t\t'close'\n\t\t]\n\t},\n\t\n\tSTATE_DIALOG_ITEM_SHOP: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/game/itemshop',\n\t\tactions: [\n\t\t\t'accept',\n\t\t\t'close',\n\t\t\t'buy'\n\t\t],\n\t\tsubstates: [\n\t\t\t'itemshop.main'\n\t\t]\n\t},\n\n\tSTATE_DIALOG_ITEM_SHOP_CONFIRM: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/game/itemshopconfirm',\n\t\talwaysPushState: true,\n\t\tactions: [\n\t\t\t'close'\n\t\t],\n\t\tsubstates: [\n\t\t\t'itemshopconfirm.main'\n\t\t]\n\t},\n\n\tSTATE_DIALOG_ACCEPT_TOS: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/auth/acceptTos',\n\t\t//track: 'show:dialogAcceptTos',\n\t\tactions: [\n\t\t\t'acceptTos'\t\n\t\t]\n\t},\n\tSTATE_DIALOG_PHOTO_PICK: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/auth/photopicker',\n        alwaysPushState: true,\n\t\t//track: 'show:dialogPhotoPick',\n\t\tactions: [\n\t\t\t'view',\n\t\t\t'photoSet',\n            'photoReturn'\n\t\t]\n\t},\n\tSTATE_DIALOG_AUTH: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/auth/auth',\n\t\talwaysPushState: true,\n\t\t//track: 'show:dialogAuth',\n\t\tactions: [\n\t\t\t'view',\n\t\t\t'ok',\n\t\t\t'verify',\n\t\t\t'voice'\n\t\t],\n\t\tsubstates: [\n\t\t\t'dialogauth.view',\n\t\t\t'dialogauth.loading',\n\t\t\t'dialogauth.verifyerror'\n\t\t]\n\t},\n\tSTATE_DIALOG_VERIFYING: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/auth/verifying',\n\t\t//track: 'show:dialogVerifying',\n\t\tactions: [\n\t\t\t'view',\n\t\t\t'edit',\n\t\t\t'enterManually',\n\t\t\t'autodetect',\n\t\t\t'finish'\n\t\t]\n\t},\n\n\tSTATE_DIALOG_ACCEPT_TERMS: {\n\t\ttype: 'dialog',\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/acceptterms',\n\t\t//track: 'show:dialogAcceptTerms'\n\t},\n\tSTATE_DIALOG_ALERT: {\n\t\ttype: 'dialog',\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/alert'\n\t},\n\tSTATE_DIALOG_GIFT_NONE: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/game/giftnone'\n\t},\n\tSTATE_DIALOG_GIFT: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/game/gift',\n\t\tstate: 'show:gifts',\n\t\tactions: [\n\t\t\t'accept',\n\t\t\t'close'\n\t\t]\n\t},\n\tSTATE_DIALOG_NOT_ENOUGH_COMMON: {\n\t\ttype: 'dialog',\n\t\talwaysPushState: true,\n\t\tactions: {\n\t\t\t'gotoCommon': 'STATE_DIALOG_SHOP_COMMON'\n\t\t},\n\t\tfilename: 'dialogs/game/notenough'\n\t},\n\tSTATE_DIALOG_NOT_ENOUGH_PREMIUM: {\n\t\ttype: 'dialog',\n\t\talwaysPushState: true,\n\t\tactions: {\n\t\t\t'gotoPremium': 'STATE_DIALOG_SHOP_PREMIUM'\n\t\t},\n\t\tfilename: 'dialogs/game/notenough'\n\t},\n\tSTATE_DIALOG_NOT_ENOUGH_LIVES: {\n\t\ttype: 'dialog',\n\t\talwaysPushState: true,\n\t\tactions: {\n\t\t\t'gotoLives': 'STATE_DIALOG_SHOP_LIVES'\n\t\t},\n\t\tfilename: 'dialogs/game/notenough'\n\t},\n\tSTATE_DIALOG_OFFLINE: {\n\t\ttype: 'dialog',\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/offline'\n\t},\n\tSTATE_DIALOG_SETTINGS: {\n\t\ttype: 'dialog',\n\t\tfilename: 'dialogs/game/settings',\n\t\ttrack: 'show:settings'\n\t},\n\tSTATE_DIALOG_SHOP_COMMON: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:stateCommon',\n\t\tactions: ['purchase'],\n\t\tfilename: 'dialogs/game/shop'\n\t},\n\tSTATE_DIALOG_SHOP_CONFIRM_COMMON: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:dialogConfirm:common',\n\t\tactions: ['purchase'],\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/shopconfirm'\n\t},\n\tSTATE_DIALOG_SHOP_COMMON_SUCCESS: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:dialogCongratulations:common',\n\t\tactions: [],\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/shopsuccess'\n\t},\n\tSTATE_DIALOG_SHOP_PREMIUM: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:statePremium',\n\t\tactions: ['purchase'],\n\t\tsubstates: [\n\t\t\t'dialogShopPremium.purchasing',\n\t\t\t'dialogShopPremium.purchased',\n\t\t\t'dialogShopPremium.purchaseFailed'\n\t\t],\n\t\tfilename: 'dialogs/game/shop'\n\t},\n\tSTATE_DIALOG_SHOP_CONFIRM_PREMIUM: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:dialogConfirm:premium',\n\t\tactions: ['purchase'],\n\t\talwaysPushState: true,\n\t\tsubstates: [\n\t\t\t'dialogShopPremium.purchasing',\n\t\t\t'dialogShopPremium.purchased',\n\t\t\t'dialogShopPremium.purchaseFailed'\n\t\t],\n\t\tfilename: 'dialogs/game/shopconfirm'\n\t},\n\tSTATE_DIALOG_SHOP_PREMIUM_SUCCESS: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:dialogCongratulations:premium',\n\t\tactions: [],\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/shopsuccess'\n\t},\n\tSTATE_DIALOG_SHOP_LIVES: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:stateLives',\n\t\tactions: ['purchase'],\n\t\tfilename: 'dialogs/game/shop'\n\t},\n\tSTATE_DIALOG_SHOP_CONFIRM_LIVES: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:dialogConfirm:lives',\n\t\tactions: ['purchase'],\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/shopconfirm'\n\t},\n\tSTATE_DIALOG_SHOP_LIVES_SUCCESS: {\n\t\ttype: 'dialog',\n\t\ttrack: 'store:dialogCongratulations:lives',\n\t\tactions: [],\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/game/shopsuccess'\n\t},\n\tSTATE_DIALOG_CHOOSE_PHOTO_SOURCE: {\n\t\ttype: 'dialog',\n\t\talwaysPushState: true,\n\t\tfilename: 'dialogs/profile/choosephotosource'\n\t},\n\tSTATE_FRIEND_PROFILE: {\n\t\ttype: 'dialog',\n\t\tfilename: 'weeby/friendprofile',\n\t\talwaysPushState: true,\n\t\tactions: [\n\t\t\t'openChat'\n\t\t]\n\t},\n\tSTATE_SOCIAL_TABS: {\n\t\tfilename: 'weeby/tabs'\n\t},\n\tSTATE_HEADER: {\n\t\tfilename: 'header'\n\t}\n};\n\nvar states = Object.keys(stateData);\n\nexports.states = Enum.apply(this, states);\nexports.details = [];\nexports.forEach = function (cb, ctx) {\n\tstates.forEach(function (key) {\n\t\tvar index = exports.states[key];\n\t\tcb.call(ctx, index, exports.details[index]);\n\t});\n}\n\nstates.forEach(function (key) {\n\tvar data = stateData[key];\n\n\t// convert actions to a dictionary\n\tif (isArray(data.actions)) {\n\t\tvar actions = data.actions;\n\t\tdata.actions = {};\n\t\tactions.forEach(function (action) {\n\t\t\tdata.actions[action] = true;\n\t\t});\n\t}\n\n\t// make sure actions is present\n\tif (!data.actions) { data.actions = {}; }\n\n\t// add default actions for dialog type\n\tif (data.type == 'dialog') {\n\t\tdata.actions.close = true;\n\t\tdata.actions.cancel = true;\n\t\tdata.actions.ok = true;\n\t}\n\n\t// construct a camel case version of the state name\n\tdata.camelCase = key\n\t\t.replace('STATE_', '')\n\t\t.toLowerCase()\n\t\t.replace(/_./g, function (match) {\n\t\t\treturn match[1].toUpperCase();\n\t\t});\n\n\t// and the capital case version for callback lookups\n\tdata.capitalCase = data.camelCase[0].toUpperCase() + data.camelCase.substring(1);\n\n\t// and create a substate hash\n\tif (isArray(data.substates)) {\n\t\tvar substates = data.substates;\n\t\tdata.substates = {};\n\t\tsubstates.forEach(function (substate) {\n\t\t\tdata.substates[substate] = true;\n\t\t});\n\t}\n\n\texports.details[exports.states[key]] = data;\n\n});\n","pre":true},"sdk/plugins/weeby/weebyController.js":{"path":"sdk/plugins/weeby/weebyController.js","friendlyPath":".weebyController","directory":"sdk/plugins/weeby/","filename":"weebyController.js","src":"jsio(\"import event.Emitter as Emitter\");\n\njsio(\"import plugins.billing.billing as billing\");\njsio(\"import plugins.amplitude.amplitude as amplitude\");\n\njsio(\"import AudioManager\");\njsio(\"import device\");\njsio(\"import std.uuid\");\n\njsio(\"import .CrosspromoManager\")\njsio(\"import .sdk.api as api\");\n\njsio(\"import ui.TextEditView as TextEditView\");\n\njsio(\"import .weebyLocalData\");\njsio(\"import .weebyNative\");\njsio(\"import .weebyStates\");\njsio(\"import .weebyAbTests\");\n\njsio(\"import .WeebyConfig\");\n\njsio(\"import .models.LeaderboardGame as LeaderboardGame\");\njsio(\"import .models.GameResult as GameResult\");\njsio(\"import .models.User as User\");\njsio(\"import .models.Social as Social\");\njsio(\"import .models.globalStorageModel as globalStorageModel\");\njsio(\"import .i18n\");\n\nvar themeConfig = CACHE['addons/weeby/theme/config.js'];\nif (themeConfig) {\n\tthemeConfig = eval('(function () { var exports = {}; ' + themeConfig + '; return exports; })()');\n}\n\njsio(\"import .trackers.trackers as trackers\");\n\n/**\n *\t  ** Important **\n *\n * To correctly implement a state handler, please read the following notes:\n *\n *\t 1. A state handler has its action verified automatically.\t\n *\t 2. It is valid for a state handler to have no action when there \n *\t\tis only one action for the state. \n *\t 3. The return value for the state handler normally indicates if an action\n *\t\twas handled.  If the state will be set asynchronously (pending a\n *\t\tserver callback), the handler can return ASYNC_STATE_CHANGE.  Otherwise\n *\t\tthe handler should return the current state (or state the controller\n *\t\tshould transition into).\n *\t 4. The controller implements a *state stack*.\tA handler can return PUSH_STATE\n *\t\tor POP_STATE.\n */\n\nvar states = weebyStates.states;\nvar stateDetails = weebyStates.details;\n\nvar MAX_TUTORIAL_STEPS = 5;\n\nvar DEBUG_OFFLINE = false; // Time after which to go offline\nvar DEBUG_SCORE = 99; // Score value to use the check passed score\n\n// Return this object in a state handler if the state handler might\n// be setting the next state asynchronously.  For example, the login\n// handler may be able to transition the state immediately if we've\n// already checked the authed and verified state against the server,\n// or it might need to wait till the API connects with the server.\nvar ASYNC_STATE_CHANGE = {};\nvar STATE_HANDLED = ASYNC_STATE_CHANGE;\nvar PUSH_STATE = {};\nvar POP_STATE = {};\nvar BACK_STATE = {};\n\nWeebyController=__class__;var WeebyController=WeebyController(function WeebyController(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function (opts) {\n\t\tif (!opts) { return; }\n\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis.setMaxListeners(100);\n\t\tthis.getLocalizedTitle();\n\n\t\tthis._state = null; // current state\n\t\tthis._history = []; // state history\n\t\tthis._stack = []; // state stack\n\n\t\tif (opts.api) {\n\t\t\tlogger.log(\"using debug API\", opts.api);\n\t\t\tthis._api = opts.api;\n\t\t} else {\n\t\t\tlogger.log(\"using release API\");\n\t\t\tthis._api = new api.Weeby({\n\t\t\t\tstaging: false,\n\t\t\t\tdebug: false,\n\t\t\t\tappID: CONFIG.appID\n\t\t\t});\n\t\t}\n\t\t// setup weeby native\n\t\tweebyNative.setAPI(this._api);\n\n\t\t// setup trackers\n\t\ttrackers.setAPI(this._api);\n\t\ttrackers.addTracker(amplitude);\n\n\t\t// setup ab tests\n\t\tweebyAbTests.setup();\n\n\t\tthis._themeConfig = themeConfig;\n\t\tthis._weebyConfig = new WeebyConfig({path: 'resources/weebyConfig.json'});\n\t\tweebyLocalData.setupLifeRegen(this._weebyConfig.getLifeRegenTime(), this._weebyConfig.getMaxLives());\n\t\tweebyLocalData.setStartingCurrencies(this._weebyConfig.getSoftCurrency().startAmount, this._weebyConfig.getHardCurrency().startAmount);\n\n\t\tthis._user = new User(this._api);\n\t\tthis._social = new Social(this._api, this._user);\n\t\tthis._gameModel = new LeaderboardGame(this._weebyConfig, this._api, this._user);\n\n\t\tthis._receivedGifts = [];\n\n\t\t// if (DEBUG_FRIENDS) {\n\t\t// \tthis._unconfirmedFriends = apiMock.TEST_CONNECTIONS;\n\t\t// } else {\n\t\t// }\n\n\t\t// if (DEBUG_LADDER) {\n\t\t// \tthis._gameModel.getLadder().setList(this._user.getID(), apiMock.TEST_LADDER_ITEMS);\n\t\t// }\n\n\t\tthis._stateUpdater = [];\n\t\tthis._stateUpdater[states.STATE_LADDER] = bind(this, '_updateLadder');\n\n\t\tif (DEBUG_OFFLINE) {\n\t\t\tsetTimeout(\n\t\t\t\tbind(this, function () {\n\t\t\t\t\tconsole.log('Test offline...');\n\t\t\t\t\tthis._api.setOffline && this._api.setOffline(true);\n\t\t\t\t}),\n\t\t\t\tDEBUG_OFFLINE\n\t\t\t);\n\t\t}\n\n\t\tthis.initSound();\n\n\t\tthis.crosspromoManager = new CrosspromoManager({\n\t\t\tweebyController: this\n\t\t});\n\n\t\t// Handle back button on android\n\t\tweebyNative.on('BackButton', bind(this, function () {\n\t\t\tif (this._state == states.STATE_GAME) {\n\t\t\t\t// defer to game\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (this._history.length) {\n\t\t\t\t\tthis.historyBack();\n\t\t\t\t} else {\n\t\t\t\t\tvar trigger = this.shouldShowCrosspromo('game:exit', 'modal1');\n\t\t\t\t\tif (trigger) {\n\t\t\t\t\t\tthis._crosspromoReturnState = this._state;\n\t\t\t\t\t\tthis.setState(states.STATE_CROSSPROMO);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tweebyNative.sendToBackground();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\ttrackers.track('app:onStart');\n\n\t\twindow.addEventListener('pageshow', bind(this, \"onAppShow\"), false);\n\t\twindow.addEventListener('pagehide', bind(this, \"onAppHide\"), false);\n\t\tthis.onAppShow();\n\n\t\tif (weebyLocalData.hasAcceptedTOS()) {\n\t\t\tthis.setState(states.STATE_LADDER);\t\n\t\t} else if (!weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant, \n\t\t\t\t\t\t\t\t\t\t  weebyAbTests.ABTest_authVariant.NO_SPLASH)) {\n\t\t\ttrackers.track(\"auth:splash\");\n\t\t\tthis.setState(states.STATE_SPLASH);\n\t\t} else {\n\t\t\t// track these two events for the sake of tracking\n\t\t\t// the same funnel for all auth variants\n\t\t\ttrackers.track('auth:splash');\n\t\t\ttrackers.track('auth:clickSplashLogin');\n\t\t\tthis.setState(states.STATE_TOS);\t\n\t\t}\n\n\t\t// If referred by a crosspromotion, make tracking call\n\t\tvar savedReferrers = globalStorageModel.getData('CROSSPROMO_REFERRERS') || {};\n\t\tvar appId = this._api.getAppID();\n\t\tif (savedReferrers[appId]) {\n\t\t\ttrackers.track('crosspromo:install', savedReferrers[appId]);\n\t\t\tsavedReferrers[appId] = null;\n\t\t\tglobalStorageModel.setData('CROSSPROMO_REFERRERS', savedReferrers);\n\t\t}\n\t\t\t\n\t};\n\n\tthis.getThemeConfig = function () { return this._themeConfig; }\n\n\tthis.onAppShow = function (event) {\n\t\ttrackers.track('app:onResume');\n\t\tif(this._state != states.STATE_GAME && this._state != states.STATE_VERIFY) {\n\t\t\tvar trigger = this.shouldShowCrosspromo('game:start', 'modal1');\n\t\t\tif(trigger) {\n\t\t\t\tthis._crosspromoReturnState = this._state;\n\t\t\t\tthis.setState(states.STATE_CROSSPROMO);\n\t\t\t}\n\t\t}\n\n\t\tif (this.crosspromoManager) {\n\t\t\tthis.crosspromoManager.checkPendingRewards();\n\t\t}\n\n\n\t\tweebyNative.cancelLocalNotification({id: \"ENERGY_FULL_NOTIFICATION\"});\n\t\tthis.resetComeBackNotifications();\n\t}\n\n\tthis.onAppHide = function (event) {\n\t\tthis.resetComeBackNotifications();\n\t\tthis.resetEnergyNotification();\n\t\ttrackers.track('app:onPause');\n\t}\n\n\tthis.getLocalizedTitle = function() {\n\t\tvar title = CONFIG.title;\n\t\tif (CONFIG.titles) {\n\t\t\tvar lang = i18n.getLanguage();\n\t\t\tif (lang) {\n\t\t\t\tvar localizedTitle = CONFIG.titles[lang.replace('_', '-')];\n\t\t\t\tif (localizedTitle) {\n\t\t\t\t\ttitle = localizedTitle;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn title;\n\t}\n\n\tthis.resetComeBackNotifications = function () {\n\t\t// Scheduling a notification with the same id resets it\n\t\tvar millisecondsInDay = 24 * 60 * 60 * 1000;\n\t\t\n\t\tvar notifs = this._weebyConfig.getNotifications();\n\t\tvar title = this.getLocalizedTitle();\n\n\t\tif(notifs && notifs.notif1Day) {\n\t\t\tweebyNative.scheduleLocalNotification({\n\t\t\t\tid: \"COME_BACK_NOTIFICATION_1_DAY\",\n\t\t\t\tdelay: 1 * millisecondsInDay,\n\t\t\t\ttitle: title,\n\t\t\t\tmessage: notifs.notif1Day\n\t\t\t});\n\t\t}\n\n\t\tif(notifs && notifs.notif3Day) {\n\t\t\tweebyNative.scheduleLocalNotification({\n\t\t\t\tid: \"COME_BACK_NOTIFICATION_3_DAY\",\n\t\t\t\tdelay: 3 * millisecondsInDay,\n\t\t\t\ttitle: title,\n\t\t\t\tmessage: notifs.notif3Day\n\t\t\t});\n\t\t}\n\n\t\tif(notifs && notifs.notif5Day) {\n\t\t\tweebyNative.scheduleLocalNotification({\n\t\t\t\tid: \"COME_BACK_NOTIFICATION_5_DAY\",\n\t\t\t\tdelay: 5 * millisecondsInDay,\n\t\t\t\ttitle: title,\n\t\t\t\tmessage: notifs.notif5Day\n\t\t\t});\n\t\t}\n\t}\n\n\tthis.resetEnergyNotification = function () {\n\t\t// Scheduling a notification with the same id resets it\n\t\tvar notifs = this._weebyConfig.getNotifications();\n\t\tvar time = weebyLocalData.getMSToFullLives();\n\t\tvar title = this.getLocalizedTitle();\n\t\tif(notifs && notifs.notifEnergyRefill && time) {\n\t\t\tweebyNative.scheduleLocalNotification({\n\t\t\t\tid: \"ENERGY_FULL_NOTIFICATION\",\n\t\t\t\tdelay: time,\n\t\t\t\ttitle: title,\n\t\t\t\tmessage: notifs.notifEnergyRefill\n\t\t\t});\n\t\t}\n\t}\n\n\tthis.throwUnhandledAction = function (name, action) {\n\t\tthis.throwError('Unknown action \"' + action + '\" in ' + name);\n\t};\n\n\tthis.throwError = function () {\n\t\tvar msg = Array.prototype.join.call(arguments, ' ');\n\t\tif (DEBUG) {\n\t\t\tthrow new Error(msg);\n\t\t} else {\n\t\t\tlogger.error(msg);\n\t\t}\n\t};\n\n\tthis.initSound = function () {\n\t\tvar songs = this._weebyConfig.getSongs();\n\t\tvar song = songs.leaderboard;\n\t\tvar files = {};\n\n\t\tfiles[song] = {\n\t\t\tvolume: 1,\n\t\t\tloop: true,\n\t\t\tbackground: true\n\t\t};\n\t\tthis._sound = new AudioManager({\n\t\t\tpath: 'resources/sounds/music/',\n\t\t\tfiles: files\n\t\t});\n\n\t\tthis._sound.play(song);\n\t\tthis._sound.setMusicMuted(!weebyLocalData.getMusicOn());\n\t};\n\n\tthis.setMute = function (mute) {\n\t\tthis._sound.setMusicMuted(mute);\n\t};\n\n\tthis.fetchCrosspromoInfo = function (cb) {\n\t\tthis._api.fetchCrosspromos(cb);\n\t}\n\n\tthis.getCachedConnections = function (cb) {\n\t\tthis._api.getCachedConnections(cb);\n\t}\n\n\tthis.getCachedConnectionsSync = function () {\n\t\treturn this._api.getCachedConnectionsSync();\n\t}\n\n\tthis.setSubstate = function (substate) {\n\t\tthis.validateSubstate(substate);\n\n\t\tthis._substate = substate;\n\t\tthis.emit('State', this._substate);\n\t};\n\n\tthis.getSubstate = function () {\n\t\treturn this._substate;\n\t}\n\n\tthis.validateAction = function (action) {\n\t\tif (action in stateDetails[this._state].actions) {\n\t\t\treturn action;\n\t\t}\n\n\t\tif (action == 'back') {\n\t\t\treturn action;\n\t\t}\n\n\t\tthis.throwError(\"validateAction failed: unexpected action \" + action + \" in state \" + states[this._state]);\n\t};\n\n\tthis.validateSubstate = function (substate) {\n\t\tif (substate in stateDetails[this._state].substates) {\n\t\t\treturn substate;\n\t\t}\n\n\t\tthis.throwError('Undefined substate \"' + substate + '\" for state \"' + states[this._state] + '\"');\n\t};\n\n\n\t/**\n\t * Set state to ladder, fetch info...\n\t */\n\tthis._updateLadder = function () {\n\t\tthis._gameModel.getLadder().refresh(bind(this, function (err, res) {\n\t\t\tif (!err) {\n\t\t\t\tthis._receivedGifts = res.receivedGifts;\n\t\t\t\tthis._sentGifts = res.sentGifts;\n\n\t\t\t\tthis.emit('GiftsUpdated');\n\t\t\t\tthis.emit('LadderData');\n\t\t\t}\n\t\t}));\n\t};\n\n\tthis.getUser = function () { return this._user; };\n\n\t// @deprecated -- move functionality into this._user\n\tthis.getCurrentUser = function (cb) {\n\t\tthis._api.connect(cb);\n\t};\n\n\tthis.showMyProfile = function () {\n\t\ttrackers.track('show:viewProfile', {\n\t\t\tuserId: this._user.getID()\n\t\t});\n\n\t\tif (this.isOffline()) {\n\t\t\tthis.pushState(states.STATE_DIALOG_OFFLINE);\n\t\t} else {\n\t\t\tthis.pushState(states.STATE_PROFILE);\n\t\t}\n\t};\n\n\tthis.handleHeader = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'addPremium':\n\t\t\t\tif (this.isOffline()) {\n\t\t\t\t\tthis.pushState(states.STATE_DIALOG_OFFLINE);\n\t\t\t\t} else {\n\t\t\t\t\tthis.pushState(states.STATE_DIALOG_SHOP_PREMIUM);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'addCommon':\n\t\t\t\tthis.pushState(states.STATE_DIALOG_SHOP_COMMON);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.handleDialogMustAcceptTerms = function (action) {\n\t\tif (action == 'ok') {\n\t\t\tthis.popState();\n\t\t\treturn this.handleTos('login');\n\t\t}\n\t};\n\n\tthis.handleDialogCrosspromoReward = function (action) {\n\t\tif (action == 'close') {\n\t\t\tthis.crosspromoManager.giveReward(this._activeReward);\n\t\t\tthis._activeReward = null;\n\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handleDialogAcceptTos = function(action) {\n\t\tswitch (action) {\n\t\t\tcase 'acceptTos': \n\t\t\t\ttrackers.track('auth:acceptTos');\n\t\t\t\tweebyLocalData.setTOSAccepted();\n\t\t\t\treturn POP_STATE;\n\t\t\tcase 'close':\n\t\t\t\ttrackers.track('auth:acceptTos:failure');\n\t\t\t\treturn POP_STATE;\n\t\t}\n\t}\n\n\tthis.handleSplash = function(action) {\n\t\tswitch (action) {\n\t\t\tcase 'login':\n\t\t\t\ttrackers.track('auth:clickSplashLogin');\n\t\t\t\treturn states.STATE_TOS;\n\t\t} \n\t}\n\n\tthis.handleTos = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'game':\n\t\t\t\ttrackers.track('auth:playAsGuest');\n\t\t\t\treturn states.STATE_LADDER;\n\n\t\t\tcase 'notAccepted':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_ACCEPT_TERMS;\n\t\t\t\treturn PUSH_STATE;\n\n\t\t\tcase 'showAcceptTos':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_ACCEPT_TOS;\n\t\t\t\treturn PUSH_STATE;\n\n\t\t\tcase 'login':\n\t\t\t\tvar nextState;\n\n\t\t\t\tif (this._user.isVerified()) {\n\t\t\t\t\tnextState = states.STATE_LADDER;\t\n\t\t\t\t} else if (weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t  weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\tnextState = states.STATE_VERIFY_VARIANT;\n\t\t\t\t} else {\n\t\t\t\t\tnextState = states.STATE_VERIFY;\n\t\t\t\t}\n\n\t\t\t\treturn nextState;\n\t\t}\n\t};\n\n\tthis.handleDialogAuth = function(action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'ok':\n\t\t\t\treturn POP_STATE;\n\t\t\tcase 'verify':\n\t\t\t\ttrackers.track('auth:numberSubmitted');\n\t\t\t\tvar phoneNumber = data.countryCode + data.phoneNumber;\n\n\t\t\t\tthis._user.startVerifyPhone({\n\t\t\t\t\tnumber: phoneNumber\n\t\t\t\t}, bind(this, function(error, data2) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\ttrackers.track('auth:numberSubmitted:failure', { number:  phoneNumber });\n\t\t\t\t\t\tthis.emit('VerifyError', error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('auth:numberSubmitted:success', { number: phoneNumber });\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (weebyNative.canAutoReadAuthCode()) {\n\t\t\t\t\t\t\tthis.emit('NumberSubmitSuccess', data);\n\t\t\t\t\t\t\tthis.setState(states.STATE_DIALOG_VERIFYING);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\t\tthis.emit('AuthCodeData', data);\n\t\t\t\t\t\t\tthis.setState(states.STATE_AUTH_CODE);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\t\n\t\t\t\treturn ASYNC_STATE_CHANGE;\n\t\t\tcase 'voice':\n\t\t\t\t// make voice call\n\t\t\t\ttrackers.track('auth:voiceNumberSubmitted');\n\t\t\t\tvar number = data.countryCode + data.phoneNumber;\n\n\t\t\t\tthis._api.verifyVoicePhone({\n\t\t\t\t\tnumber: number\n\t\t\t\t}, bind(this, function(error, data2) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\ttrackers.track('auth:voiceNumberSubmitted:failure', { number:  number });\n\t\t\t\t\t\tthis.emit('VerifyError', error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('auth:voiceNumberSubmitted:success', { number: number });\n\t\t\t\t\t\t// dialogs must be all gone before moving on to next state\n\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\tthis.setState(states.STATE_AUTH_CODE);\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\treturn ASYNC_STATE_CHANGE;\n\t\t\tdefault:\n\t\t\t\treturn POP_STATE;\n\t\t} \n\t}\n\n\tthis.handleDialogVerifying = function(action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'edit':\n\t\t\t\ttrackers.track('auth:editFromVerifying', data);\n\t\t\t\treturn POP_STATE;\n\t\t\tcase 'finish': // TODO? does this action need to be renamed?\n\t\t\t\ttrackers.track('auth:codeTimeout', data);\n\t\t\t\tthis.emit('AuthDialog', data);\n\t\t\t\treturn states.STATE_DIALOG_AUTH;\n\t\t\tcase 'enterManually':\n\t\t\t\ttrackers.track('auth:enterManually', data);\n\t\t\t\tthis.popState();\n\t\t\t\tthis.emit('AuthCodeData', data);\n\t\t\t\tthis.setState(states.STATE_AUTH_CODE);\n\n\t\t\t\treturn STATE_HANDLED;\n\t\t\tcase 'autodetect':\n\t\t\t\ttrackers.track('auth:enteredCode:autodetect', data);\n\t\t\t\ttrackers.track('auth:enteredCode', { code: data.code });\n\t\t\t\tthis._user.completeVerifyPhone({\n\t\t\t\t\tnumber: data.phoneNumber,\n\t\t\t\t\tcode: data.code\n\t\t\t\t}, bind(this, function(error, data2) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\ttrackers.track('auth:enteredCode:failure', { code: data.code });\n\n\t\t\t\t\t\tthis.emit('AuthDialog', { \n\t\t\t\t\t\t\tsubstate: 'codeIncorrect'\n\t\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t\tthis.pushState(states.STATE_DIALOG_AUTH);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('auth:enteredCode:success', { code: data.code });\n\n\t\t\t\t\t\tif (!weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t\t\t   weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\t\t\t// TODO: remove these when they're no longer needed\n\t\t\t\t\t\t\ttrackers.track('auth:setName');\n\t\t\t\t\t\t\ttrackers.track('auth:setNickname');\n\n\t\t\t\t\t\t\tthis._user.setName(data.fullName);\n\t\t\t\t\t\t\tthis._user.setNickname(data.username);\n\n\t\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\t\tthis.setState(states.STATE_LADDER);\n\n\t\t\t\t\t\t\t// TODO: hack (doesn't work on Android without this??)\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\t\tthis.setState(states.STATE_VERIFY_PHOTO);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\t\n\t\t\t\treturn ASYNC_STATE_CHANGE;\n\t\t} \n\t}\n\n\tthis.handleAuthCode = function(action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'back':\n\t\t\t\tvar nextState;\n\n\t\t\t\ttrackers.track('auth:backFromEnterAuthScreen', data);\n\t\t\t\tif (this._stack.length == 0) {\n\t\t\t\t\tif (weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t\t  weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\t\tnextState = states.STATE_VERIFY_PHONE;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextState = states.STATE_VERIFY; \n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnextState = POP_STATE; \n\t\t\t\t}\n\n\t\t\t\treturn nextState;\n\t\t\tcase 'verify':\n\t\t\t\ttrackers.track('auth:enteredCode:manually', data);\n\t\t\t\ttrackers.track('auth:enteredCode');\n\t\t\t\tthis._user.completeVerifyPhone({\n\t\t\t\t\tnumber: data.countryCode + data.phoneNumber,\n\t\t\t\t\tcode: data.code\n\t\t\t\t}, bind(this, function (error, data2) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\ttrackers.track('auth:enteredCode:failure', { code: data.code });\n\t\t\t\t\t\tthis.emit('AuthDialog', { \n\t\t\t\t\t\t\tcountryCode: data.countryCode,\n\t\t\t\t\t\t\tphoneNumber: data.phoneNumber,\n\t\t\t\t\t\t\tfullName: data.fullName,\n\t\t\t\t\t\t\tusername: data.username,\n\t\t\t\t\t\t\tsubstate: 'codeIncorrect'\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('auth:enteredCode:success', { code: data.code });\n\n\t\t\t\t\t\t// TODO: remove these when they're no longer needed\n\t\t\t\t\t\ttrackers.track('auth:setName');\n\t\t\t\t\t\ttrackers.track('auth:setNickname');\n\n\t\t\t\t\t\tif (!weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t\t\t   weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\n\t\t\t\t\t\t\tthis._user.setName(data.fullName);\n\t\t\t\t\t\t\tthis._user.setNickname(data.username);\n\n\t\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\t\tthis.setState(states.STATE_LADDER);\n\n\t\t\t\t\t\t\t// TODO: hack (doesn't work on Android without this??)\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\t\tthis.setState(states.STATE_VERIFY_PHOTO);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tthis.emit('AuthDialog', merge({\n\t\t\t\t\tsubstate: 'loading'\n\t\t\t\t}, data));\n\t\t\t\tthis._nextState = states.STATE_DIALOG_AUTH;\n\t\t\t\treturn PUSH_STATE;\n\t\t\tcase 'error':\n\t\t\t\ttrackers.track('auth:enterInvalidCodeFormat', data);\n\t\t\t\tthis.emit('AuthDialog', merge({\n\t\t\t\t\tsubstate: 'codeError' \n\t\t\t\t}, data));\n\t\t\t\tthis._nextState = states.STATE_DIALOG_AUTH;\n\t\t\t\treturn PUSH_STATE;\n\t\t} \n\t}\n\n\tthis.handleVerifyVariant = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'back':\n\t\t\t\tvar nextState;\n\n\t\t\t\t// do not know the stack ahead of time.\n\t\t\t\t// Sometimes we want to move to next state,\n\t\t\t\t// or sometimes we want to pop\n\t\t\t\tif (this._stack.length == 0) {\n\t\t\t\t\tnextState = states.STATE_TOS; \n\t\t\t\t} else {\n\t\t\t\t\tnextState = POP_STATE; \n\t\t\t\t}\n\n\t\t\t\treturn nextState;\n\n\t\t\tcase 'backLadder':\n\t\t\t\tvar nextState;\n\n\t\t\t\tif (this._stack.length == 0) {\n\t\t\t\t\tnextState = states.STATE_LADDER; \n\t\t\t\t} else {\n\t\t\t\t\tnextState = POP_STATE; \n\t\t\t\t}\n\n\t\t\t\treturn nextState;\n\n\t\t\tcase 'verify':\n\t\t\t\ttrackers.track('auth:verifyName:enteredName');\n\n\t\t\t\tthis._user.setName(data.fullName, bind(this, function (error, data2) {\n\t\t\t\t\tif (!error || error.response === \"AlreadySet\") {\n\t\t\t\t\t\ttrackers.track('auth:setName');\n\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\tthis.setState(states.STATE_VERIFY_PHONE);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('auth:verifyName:enteredName:failure', { code: data.code });\n\t\t\t\t\t\tthis.emit('AuthDialog', { \n\t\t\t\t\t\t\tfullName: data.fullName,\n\t\t\t\t\t\t\tsubstate: 'nameError'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\tthis.emit('AuthDialog', merge({\n\t\t\t\t\tsubstate: 'loading'\n\t\t\t\t}, data));\n\t\t\t\tthis._nextState = states.STATE_DIALOG_AUTH;\n\t\t\t\treturn PUSH_STATE;\n\n\t\t\tcase 'error':\n\t\t\t\tthis.emit('AuthDialog', data);\n\t\t\t\tthis._nextState = states.STATE_DIALOG_AUTH;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t};\n\n\tthis.handleVerifyPhoto = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'verify':\n\t\t\tcase 'skip':\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\t}, 0);\n\t\t\t\treturn states.STATE_LADDER;\n\t\t\tcase 'pickPhoto':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_PHOTO_PICK;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t};\n\n\tthis.handleVerify = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'pickCountry':\n\t\t\t\ttrackers.track('auth:pickCountry');\n\t\t\t\treturn states.STATE_PICK_COUNTRY;\n\n\t\t\tcase 'back':\n\t\t\t\tvar nextState;\n\n\t\t\t\t// do not know the stack ahead of time.\n\t\t\t\t// Sometimes we want to move to next state,\n\t\t\t\t// or sometimes we want to pop\n\t\t\t\tif (this._stack.length == 0) {\n\t\t\t\t\tnextState = states.STATE_TOS; \n\t\t\t\t} else {\n\t\t\t\t\tnextState = POP_STATE; \n\t\t\t\t}\n\n\t\t\t\treturn nextState;\n\n\t\t\tcase 'backLadder':\n\t\t\t\tvar nextState;\n\n\t\t\t\tif (this._stack.length == 0) {\n\t\t\t\t\tnextState = states.STATE_LADDER; \n\t\t\t\t} else {\n\t\t\t\t\tnextState = POP_STATE; \n\t\t\t\t}\n\n\t\t\t\treturn nextState;\n\n\t\t\tcase 'login':\n\t\t\t\treturn states.STATE_VERIFY;\n\n\t\t\tcase 'error':\n\t\t\tcase 'confirm':\n\t\t\t\tthis.emit('AuthDialog', data);\n\t\t\t\tthis._nextState = states.STATE_DIALOG_AUTH;\n\t\t\t\treturn PUSH_STATE;\n\t\t\tcase 'pickPhoto':\n\t\t\t\ttrackers.track('auth:clickSetPhoto');\n\t\t\t\tthis._nextState = states.STATE_DIALOG_PHOTO_PICK;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t};\n\n\tthis.handleVerifyPhone = function(action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'back':\n\t\t\t\treturn states.STATE_VERIFY_VARIANT;\n\t\t\tcase 'pickCountry':\n\t\t\t\treturn states.STATE_PICK_COUNTRY;\n\t\t\tcase 'error':\n\t\t\tcase 'confirm':\n\t\t\t\tthis.emit('AuthDialog', data);\n\t\t\t\tthis._nextState = states.STATE_DIALOG_AUTH;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\t\n\t}\n\n\tthis.handleDialogPhotoPick = function(action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'photoReturn':\n\t\t\t\tif (weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\tthis.emit('AuthPhotoReturn:verifyPhoto');\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit('AuthPhotoReturn');\n\t\t\t\t}\n\n\t\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handlePickCountry = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'pick':\n\t\t\t\tif (weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\tthis.emit('HandlePickCountry', data.name, data.iso, data.number);\n\t\t\t\t\treturn states.STATE_VERIFY_PHONE;\t\t\t\t\t\t\t \n\t\t\t\t} else {\n\t\t\t\t\tthis.emit('CountryCodeChanged', data.name, data.iso, data.number);\n\t\t\t\t\treturn states.STATE_VERIFY;\n\t\t\t\t}\n\t\t\tcase 'cancel':\n\t\t\t\tvar nextState;\n\n\t\t\t\ttrackers.track('auth:backFromPickCountry');\n\n\t\t\t\tif (weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\treturn states.STATE_VERIFY_PHONE;\t\t\t\t\t\t\t \n\t\t\t\t} else {\n\t\t\t\t\treturn states.STATE_VERIFY;\n\t\t\t\t}\n\t\t\n\t\t\t\treturn nextState;\n\t\t}\n\t};\n\n\tthis.handleVerifying = function (action, data) {\n\t\tif (action == 'verify') {\n\t\t\tif (data.code) {\n\t\t\t\ttrackers.track('auth:enteredCode', {code: data.code, source: 'todo'});\n\t\t\t\tthis.setSubstate('verifying.verifying');\n\n\t\t\t\tthis._user.completeVerifyPhone({\n\t\t\t\t\t\tnumber: this._verifyNumber,\n\t\t\t\t\t\tcode: data.code\n\t\t\t\t\t}, bind(this, function (err, data) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tthis.setSubstate('verifying.error');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!this._user.getName()) {\n\t\t\t\t\t\t\t\tthis.setState(states.STATE_EDIT_NAME);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (this._stack.length) {\n\t\t\t\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.setState(states.STATE_LADDER);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\n\t\t\t\treturn ASYNC_STATE_CHANGE;\n\t\t\t} else {\n\t\t\t\tthis.setSubstate('verifying.noCode');\n\t\t\t\treturn states.STATE_VERIFYING;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.handleEditName = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'verify':\n\t\t\t\tif (data.name) {\n\t\t\t\t\t// TODO validation??\n\t\t\t\t\t// TODO wait for server sync??\n\t\t\t\t\tthis.setSubstate('editName.verifying');\n\t\t\t\t\tthis._user.setName(data.name);\n\t\t\t\t\treturn states.STATE_LADDER;\n\t\t\t\t} else {\n\t\t\t\t\tthis.setSubstate('editName.noName');\n\t\t\t\t\treturn states.STATE_EDIT_NAME;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'cancel':\n\t\t\t\treturn states.STATE_VERIFY;\n\t\t}\n\t};\n\n\tthis.handleLadder = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'viewFriendProfile':\n\t\t\t\tthis.emit('ActiveFriendProfile', data.user);\n\t\t\t\tthis._nextState = states.STATE_FRIEND_PROFILE;\n\t\t\t\treturn PUSH_STATE;\n\n\t\t\tcase 'settings':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_SETTINGS;\n\t\t\t\treturn PUSH_STATE;\n\n\t\t\tcase 'addLives':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_SHOP_LIVES;\n\t\t\t\treturn PUSH_STATE;\n\n\t\t\tcase 'play':\n\t\t\t\treturn states.STATE_EQUIP;\n\n\t\t\tcase 'login':\n\t\t\t\tif (weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t  weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\tthis._nextState = states.STATE_VERIFY_VARIANT;\n\t\t\t\t} else {\n\t\t\t\t\tthis._nextState = states.STATE_VERIFY;\n\t\t\t\t}\n\n\t\t\t\treturn PUSH_STATE;\n\t\t\t\n\t\t\tcase 'gift':\n\t\t\t\tif (this._receivedGifts.length) {\n\t\t\t\t\tthis._nextState = states.STATE_DIALOG_GIFT;\n\t\t\t\t\treturn PUSH_STATE;\n\t\t\t\t}\n\n\t\t\t\tthis._nextState = states.STATE_DIALOG_GIFT_NONE;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t};\n\n\tthis.handleAcceptTos = function(action, data) {\n\t\tswitch (action) {\n\t\t} \n\t}\n\n\tthis.handleEquip = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'play':\n\t\t\t\tweebyLocalData.useCommonCurrency(this.getEquipCost(data));\n\t\t\t\treturn this._startGame(data);\n\n\t\t\tcase 'itemshop':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_ITEM_SHOP;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t};\n\n\tthis.getEquipCost = function (data) {\n\t\tvar equipItems = data.equipItems,\n\t\t\ttotalPrice = 0;\n\t\tfor (var key in equipItems) {\n\t\t\ttotalPrice += equipItems[key].price;\n\t\t}\n\t\treturn totalPrice;\n\t};\n\n\tthis.canPlayGame = function (data) {\n\t\tvar canPlay = false;\n\t\tif (weebyLocalData.getLife() > 0) {\n\t\t\tif (weebyLocalData.hasCommonCurrency(this.getEquipCost(data))) {\n\t\t\t\tcanPlay = true;\n\t\t\t} else {\n\t\t\t\ttrackers.track('equip:error:currency');\n\t\t\t\tthis.pushState(states.STATE_DIALOG_NOT_ENOUGH_COMMON);\n\t\t\t}\n\t\t} else {\n\t\t\ttrackers.track('equip:error:lives');\n\t\t\tthis.pushState(states.STATE_DIALOG_NOT_ENOUGH_LIVES);\n\t\t}\n\t\treturn canPlay;\n\t};\n\n\tthis._startGame = function (opts) {\n\t\tif (!opts) { opts = {}; }\n\n\t\tvar ladderData = this.getLadderData();\n\t\tvar gameState = {\n\t\t\t\tsfxOn: weebyLocalData.getSfxOn(),\n\t\t\t\tmusicOn: weebyLocalData.getMusicOn(),\n\t\t\t\tcommonCurrency: weebyLocalData.getCommonCurrency(),\n\t\t\t\tpremiumCurrency: weebyLocalData.getPremiumCurrency(),\n\t\t\t\tequipItems: opts.equipItems,\n\t\t\t\tisTutorial: weebyLocalData.getTutorialMode(),\n\t\t\t\ttutorialStep: weebyLocalData.getTutorialStep(),\n\t\t\t\titemShop: weebyLocalData.getShopItems(),\n\t\t\t\tladderData: ladderData? ladderData.toArray() : [],\n\t\t\t\tweeklyHighScore: weebyLocalData.getWeeklyHighScore(),\n\t\t\t\tallTimeHighScore: weebyLocalData.getAllTimeHighScore,\n\t\t\t\tlevel: weebyLocalData.getLevel(),\n\t\t\t\tlives: weebyLocalData.getLife()\n\t\t\t};\n\n\t\tthis._prevGameResult = this._gameResult;\n\t\tthis._gameResult = new GameResult(this._gameModel);\n\t\tthis._gameResult.recordPregameState();\n\n\t\tthis._sound.setMusicMuted(true);\n\n\t\tweebyLocalData.useLife();\n\n\t\tthis.emit('StartGame', gameState);\n\n\t\treturn states.STATE_GAME;\n\t}\n\n\tthis.getGameResult = function () {\n\t\treturn this._gameResult;\n\t};\n\n\tthis.handleGame = function (action, data) {\n\t\tif (!data || !data.score) {\n\t\t\ttrackers.track('game:cancel');\n\t\t\treturn states.STATE_LADDER;\n\t\t} else {\n\t\t\tvar result = this._gameResult;\n\t\t\tresult.recordPostgameState(data);\n\n\t\t\ttrackers.track('game:finish', {\n\t\t\t\tbaseScore: result.score.base,\n\t\t\t\tbonusScore: result.bonus\n\t\t\t});\n\n\t\t\tconsole.log('Submitting score:', result.score.total);\n\n\t\t\tthis._api.submitScore(\n\t\t\t\t{\n\t\t\t\t\tscore: result.score.total,\n\t\t\t\t\thighScore: result.score.highest,\n\t\t\t\t\texperience: result.afterGame.xp,\n\t\t\t\t\tlevel: result.afterGame.level,\n\t\t\t\t\tdata: ''\n\t\t\t\t},\n\t\t\t\tbind(this, function(error, data) {\n\t\t\t\t\tlogger.log('Submit score result:', error, data);\n\t\t\t\t})\n\t\t\t);\n\t\t\tvar trigger = this.shouldShowCrosspromo('gameresult:start', 'modal1');\n\t\t\tif (trigger) {\n\t\t\t\tthis._crosspromoReturnState = states.STATE_GAME_RESULT;\n\t\t\t\tthis._savedGameResult = result;\n\t\t\t\treturn states.STATE_CROSSPROMO;\n\t\t\t} else {\n\t\t\t\tthis.emit('GameResult', result);\n\t\t\t\treturn states.STATE_GAME_RESULT;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.handleGameResult = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'play':\n\t\t\t\tvar trigger = this.shouldShowCrosspromo('gameresult:end', 'modal1');\n\t\t\t\tif(trigger) {\n\t\t\t\t\tthis._crosspromoReturnState = states.STATE_EQUIP;\n\t\t\t\t\tthis.setState(states.STATE_CROSSPROMO, 'replace', data);\n\t\t\t\t} else {\n\t\t\t\t\ttrackers.track('gameResult:playBtn:showEquip');\n\t\t\t\t\tthis.setState(states.STATE_EQUIP, 'replace', data);\n\t\t\t\t}\n\t\t\t\treturn STATE_HANDLED;\n\t\t\tcase 'back': //fall through\n\t\t\tcase 'close':\n\t\t\t\tvar trigger = this.shouldShowCrosspromo('gameresult:end', 'modal1');\n\t\t\t\tif(trigger) {\n\t\t\t\t\tthis._crosspromoReturnState = states.STATE_LADDER;\n\t\t\t\t\tthis.setState(states.STATE_CROSSPROMO, 'replace', data);\n\t\t\t\t\treturn STATE_HANDLED;\n\t\t\t\t} else {\n\t\t\t\t\ttrackers.track('gameResult:homeBtn');\n\t\t\t\t\tthis.setState(states.STATE_LADDER, 'replace', data);\n\t\t\t\t\treturn STATE_HANDLED;\n\t\t\t\t}\n\n\t\t\tcase 'showRankUp':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_PASSED_PLAYER;\n\t\t\t\treturn PUSH_STATE;\n\n\t\t\tcase 'showLevelUp':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_LEVEL_UP;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t};\n\n\tthis.handleCrosspromo = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'install':\n\t\t\t\tthis.showAppStore(this.crosspromoManager.getCrosspromoTrigger());\n\t\t\t\tvar nextState = states.STATE_LADDER;\n\t\t\t\tif (this._crosspromoReturnState) {\n\t\t\t\t\tif (this._crosspromoReturnState == states.STATE_GAME_RESULT) {\n\t\t\t\t\t\tthis.emit('GameResult', this._savedGameResult);\n\t\t\t\t\t}\n\t\t\t\t\tnextState = this._crosspromoReturnState;\n\t\t\t\t}\n\t\t\t\tthis.setState(nextState, 'replace', data);\n\t\t\t\treturn STATE_HANDLED;\n\t\t\tcase 'back': //fall through\n\t\t\tcase 'close':\n\t\t\t\tvar nextState = states.STATE_LADDER;\n\t\t\t\tif (this._crosspromoReturnState) {\n\t\t\t\t\tif (this._crosspromoReturnState == states.STATE_GAME_RESULT) {\n\t\t\t\t\t\tthis.emit('GameResult', this._savedGameResult);\n\t\t\t\t\t}\n\t\t\t\t\tnextState = this._crosspromoReturnState;\n\t\t\t\t}\n\t\t\t\tthis.setState(nextState, 'replace', data);\n\t\t\t\treturn STATE_HANDLED;\n\n\t\t\tcase 'viewFriendProfile':\n\t\t\t\tthis.emit('ActiveFriendProfile', data.user);\n\t\t\t\tthis._nextState = states.STATE_FRIEND_PROFILE;\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t};\n\n\tthis.handleDialogPassedPlayer = function (action) {\n\t\tif (action == 'close') {\n\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handleDialogLevelUp = function (action) {\n\t\tif (action == 'close') {\n\t\t\t// give the level up reward to the user\n\t\t\tvar reward = this.getLevelUpReward(weebyLocalData.getLevel());\n\t\t\tweebyLocalData.addCommonCurrency(reward.common);\n\t\t\tweebyLocalData.addPremiumCurrency(reward.premium);\n\n\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handleConfirmFriends = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'accept':\n\t\t\t\tconsole.log('accepted:', data.acceptedFriends);\n\t\t\t\tconsole.log('blocked:', data.blockedFriends);\n\t\t\t\tthis._user.confirmFriends(data);\n\t\t\t\treturn BACK_STATE;\n\n\t\t\tcase 'viewFriendProfile':\n\t\t\t\tthis.emit('ActiveFriendProfile', data.user);\n\t\t\t\tthis.pushState(states.STATE_FRIEND_PROFILE);\n\t\t\t\treturn STATE_HANDLED;\n\t\t} \n\t};\n\n\tthis.handleProfile = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'back':\n\t\t\t\treturn POP_STATE;\n\t\t\tcase 'edit':\n\t\t\t\treturn states.STATE_EDIT_PROFILE;\n\t\t}\n\t};\n\n\tthis.handleEditProfile = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'back':\n\t\t\t\treturn states.STATE_PROFILE;\n\t\t\tcase 'editPhoto':\n\t\t\t\tthis._nextState = states.STATE_DIALOG_CHOOSE_PHOTO_SOURCE;\n\t\t\t\treturn PUSH_STATE;\n\t\t\tcase 'editFullname':\n\t\t\t\ttrackers.track('fullname:startEdit');\n\t\t\t\treturn states.STATE_FULLNAME_EDIT;\n\t\t}\n\t};\n\n\tthis.handleFullnameEdit = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'back':\n\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\treturn states.STATE_EDIT_PROFILE;\n\t\t\tcase 'fullname':\n\t\t\t\ttrackers.track('fullname:back');\n\t\t\t\tthis._nextState = states.STATE_DIALOG_FULLNAME_CONFIRM;\n\t\t\t\ttrackers.track('fullname:edit');\n\t\t\t\treturn PUSH_STATE;\n\t\t\tcase 'nickname':\n\t\t\t\ttrackers.track('fullname:gotoNickname');\n\t\t\t\treturn BACK_STATE;\n\t\t}\n\t};\n\n\tthis.handleDialogFullnameConfirm = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'change':\n\t\t\t\ttrackers.track('fullname:confirmChange');\n\t\t\t\tthis.popState();\n\t\t\t\tdevice.get('StatusBar').show();\n\t\t\t\treturn states.STATE_FULLNAME_VERIFY;\n\t\t\tcase 'cancel':\n\t\t\t\ttrackers.track('fullname:cancelChange');\n\t\t\t\tconsole.log('Dont know why not?');\n\t\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handleFullnameVerify = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'change':\n\t\t\t\tvar number = this._user.getPhoneNumber() || '0'; // Use '0' for when in test mode...\n\t\t\t\tthis._fullnamePhone = number;\n\t\t\t\tthis._user.startVerifyPhone({\n\t\t\t\t\tnumber: number\n\t\t\t\t}, bind(this, function(error, data) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\ttrackers.track('fullname:verify:submitted:failure', {number: number});\n\t\t\t\t\t\tthis.emit('FullnameVerifyError', error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('fullname:verify:submitted:success', {number: number});\n\t\t\t\t\t\tthis.setState(states.STATE_FULLNAME_CODE);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\treturn ASYNC_STATE_CHANGE;\n\t\t\tcase 'cancel':\n\t\t\t\ttrackers.track('fullname:verify:cancel');\n\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\tthis.historyBack(states.STATE_EDIT_PROFILE);\n\t\t\t\treturn STATE_HANDLED;\n\t\t}\n\t};\n\n\tthis.handleFullnameCode = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'back':\n\t\t\t\ttrackers.track('fullname:enteredCode:back');\n\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\treturn states.STATE_EDIT_PROFILE;\n\t\t\tcase 'confirmCode':\n\t\t\t\tvar code = data.code;\n\t\t\t\tthis._user.completeVerifyPhone({\n\t\t\t\t\tnumber: this._fullnamePhone,\n\t\t\t\t\tcode: code\n\t\t\t\t}, bind(this, function(error, data) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\ttrackers.track('fullname:enteredCode:failure', {code: code});\n\t\t\t\t\t\tthis.emit('FullnameCodeError', {substate: 'codeIncorrect'});\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('fullname:enteredCode:success', {code: code});\n\t\t\t\t\t\tthis.setState(states.STATE_FULLNAME_CHANGE);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t\treturn ASYNC_STATE_CHANGE;\n\t\t}\n\t};\n\n\tthis.handleFullnameChange = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'cancel':\n\t\t\t\ttrackers.track('fullname:change:cancel');\n\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\treturn states.STATE_EDIT_PROFILE;\n\t\t\tcase 'change':\n\t\t\t\ttrackers.track('fullname:change:update', {fullname: data.fullname});\n\n\t\t\t\t// TODO: handle error?\n\t\t\t\tthis._user.setName(data.fullname);\n\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\t\n\t\t\t\treturn states.STATE_EDIT_PROFILE;\n\t\t}\n\t};\n\n\tthis.handleDialogGift = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'accept':\n\t\t\t\tvar gifts = data.gifts;\n\n\t\t\t\t// TODO remove this -- always accept gifts when we receive them\n\t\t\t\tthis._api.acceptGifts(gifts);\n\n\t\t\t\t// remove gifts immediately so they don't show up locally anymore\n\t\t\t\tvar numGifts = gifts.length;\n\t\t\t\tfor (var i = 0; i < numGifts; ++i) {\n\t\t\t\t\tvar index = this._receivedGifts.indexOf(gifts[i]);\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tthis._receivedGifts.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// TODO refactor some names and things\n\t\t\t\t\n\t\t\t\t// reward some lives\n\t\t\t\tweebyLocalData.addLife(numGifts);\n\n\t\t\t\treturn POP_STATE;\n\t\t\t\n\t\t\tcase 'close':\n\t\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handleDialogShopCommon = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'purchase':\n\t\t\t\tthis._purchaseCommonItem = data.item;\n\t\t\t\tif (weebyLocalData.hasPremiumCurrency(data.item.cost)) {\n\t\t\t\t\tthis._nextState = states.STATE_DIALOG_SHOP_CONFIRM_COMMON;\n\t\t\t\t\treturn PUSH_STATE;\n\t\t\t\t} else {\n\t\t\t\t\tthis._nextState = states.STATE_DIALOG_NOT_ENOUGH_PREMIUM;\n\t\t\t\t\treturn PUSH_STATE;\n\t\t\t\t}\n\n\t\t\t case 'purchased':\n\t\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handleDialogShopConfirmCommon = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'purchase':\n\t\t\t\tthis._trackCurrency('store:startCommonPurchase', this._purchaseCommonItem);\n\t\t\t\tif (weebyLocalData.usePremiumCurrency(this._purchaseCommonItem.cost)) {\n\t\t\t\t\tthis._trackCurrency('store:purchasedCommon', this._purchaseCommonItem);\n\t\t\t\t\tweebyLocalData.addCommonCurrency(this._purchaseCommonItem.rewardAmount);\n\t\t\t\t}\n\n\t\t\t\treturn states.STATE_DIALOG_SHOP_COMMON_SUCCESS;\n\t\t}\n\n\t\treturn POP_STATE;\n\t};\n\n\tthis.handleDialogShopCommonSuccess = function (action) {\n\t\treturn POP_STATE;\n\t};\n\n\tthis.handleDialogShopPremium = function (action, data) {\n\t\tif (action == 'purchase') {\n\t\t\tif (this.isOffline()) {\n\t\t\t\tthis._trackCurrency('store:dialogOffline');\n\t\t\t\tthis._nextState = states.STATE_DIALOG_OFFLINE;\n\t\t\t\treturn PUSH_STATE;\n\t\t\t} else {\n\t\t\t\tthis._purchasePremiumItem = data.item;\n\t\t\t\tthis._nextState = states.STATE_DIALOG_SHOP_CONFIRM_PREMIUM;\n\t\t\t\treturn PUSH_STATE;\n\t\t\t}\n\t\t} else if (action == 'purchased') {\n\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis.handleDialogItemShop = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'close':\n\t\t\t\treturn POP_STATE;\n\t\t\tcase 'buy':\n\t\t\t\tvar buy = false;\n\t\t\t\tvar item = this._purchaseItemShopItem = data;\n\t\t\t\tif (!item.currency || item.currency == 'common') {\n\t\t\t\t\tif (weebyLocalData.useCommonCurrency(item.cost)) {\n\t\t\t\t\t\tbuy = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._nextState = states.STATE_DIALOG_NOT_ENOUGH_COMMON;\n\t\t\t\t\t}\n\t\t\t\t} else if (item.currency == 'premium') {\n\t\t\t\t\tif (weebyLocalData.usePremiumCurrency(item.cost)) {\n\t\t\t\t\t\tbuy = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._nextState = states.STATE_DIALOG_NOT_ENOUGH_PREMIUM;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (buy) {\n\t\t\t\t\tthis._purchaseItemShopItemResults = weebyLocalData.purchaseShopItem(item);\n\t\t\t\t\tthis._nextState = states.STATE_DIALOG_ITEM_SHOP_CONFIRM;\n\t\t\t\t}\n\n\t\t\t\treturn PUSH_STATE;\n\t\t}\n\t\treturn ASYNC_STATE_CHANGE;\n\t};\n\n\tthis.handleDialogItemShopConfirm = function(action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'close':\n\t\t\t\treturn POP_STATE;\n\t\t}\n\t};\n\n\tthis._trackCurrency = function (name, item) {\n\t\ttrackers.track(\n\t\t\tname,\n\t\t\t{\n\t\t\t\tid: item.id,\n\t\t\t\tcost: item.cost,\n\t\t\t\tamount: item.rewardAmount,\n\t\t\t\tpurchaseCurrency: item.purchaseCurrency,\n\t\t\t\trewardCurrency: item.rewardCurrency\n\t\t\t}\n\t\t);\n\t};\n\n\tthis.handleDialogShopConfirmPremium = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'purchase':\n\t\t\t\tvar item = this._purchasePremiumItem;\n\t\t\t\tthis._trackCurrency('store:startPremiumPurchase', item);\n\t\t\t\tthis.popState();\n\t\t\t\tthis.setSubstate('dialogShopPremium.purchasing');\n\n\t\t\t\tbilling.onFailure = bind(this, function (reason, item) {\n\t\t\t\t\tlogger.log('purchase of ', item, 'failed', reason);\n\t\t\t\t\tthis.setSubstate('dialogShopPremium.purchaseFailed');\n\t\t\t\t\tthis.popState();\n\t\t\t\t});\n\n\t\t\t\tbilling.onPurchase = bind(this, function (id) {\n\t\t\t\t\tthis._trackCurrency('store:purchasedPremium', item);\n\t\t\t\t\tlogger.log('successfully purchased', id);\n\t\t\t\t\tlogger.log('adding', item.rewardAmount);\n\t\t\t\t\tweebyLocalData.addPremiumCurrency(item.rewardAmount);\n\t\t\t\t\tthis.setSubstate('dialogShopPremium.purchased');\n\n\t\t\t\t\t// TODO confirmation popup\n\t\t\t\t\t//this.popState();\n\t\t\t\t\tthis.setState(states.STATE_DIALOG_SHOP_PREMIUM_SUCCESS);\n\t\t\t\t});\n\n\t\t\t\tbilling.purchase(this._purchasePremiumItem.id);\n\t\t\t\treturn ASYNC_STATE_CHANGE;\n\t\t}\n\n\t\treturn POP_STATE;\n\t};\n\n\tthis.handleDialogShopPremiumSuccess = function (action) {\n\t\treturn POP_STATE;\n\t};\n\n\tthis.handleDialogShopLives = function (action, data) {\n\t\tif (action == 'purchase') {\n\t\t\tthis._purchaseLivesItem = data.item;\n\t\t\tif (weebyLocalData.getMaxLives() === weebyLocalData.getLife()) {\n\t\t\t\t// lives maxed out\n\t\t\t\treturn POP_STATE;\n\t\t\t} else if (weebyLocalData.hasPremiumCurrency(data.item.cost)) {\n\t\t\t\tthis._nextState = states.STATE_DIALOG_SHOP_CONFIRM_LIVES;\n\t\t\t\treturn PUSH_STATE;\n\t\t\t} else {\n\t\t\t\tthis._nextState = states.STATE_DIALOG_NOT_ENOUGH_PREMIUM;\n\t\t\t\treturn PUSH_STATE;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.handleDialogShopConfirmLives = function (action) {\n\t\tswitch (action) {\n\t\t\tcase 'purchase':\n\t\t\t\tif (weebyLocalData.usePremiumCurrency(this._purchaseLivesItem.cost)) {\n\t\t\t\t\tthis._trackCurrency('store:purchasedLives', this._purchaseLivesItem);\n\t\t\t\t\tweebyLocalData.addLife(this._purchaseLivesItem.rewardAmount);\n\t\t\t\t}\n\t\t\t\treturn states.STATE_DIALOG_SHOP_LIVES_SUCCESS;\n\t\t}\n\t};\n\n\tthis.handleFriendProfile = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'openChat':\n\t\t\t\treturn states.STATE_CHAT;\n\t\t}\n\t}\n\n\tthis.handleFriendList = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'viewFriendProfile':\n\t\t\t\tthis.emit('ActiveFriendProfile', data.user);\n\t\t\t\treturn states.STATE_FRIEND_PROFILE;\n\t\t}\n\t}\n\n\tthis.handleChatList = function (action, data) {\n\t\tswitch (action) {\n\t\t\tcase 'openChat':\n\t\t\t\treturn states.STATE_CHAT;\n\t\t}\n\t}\n\n\tthis.handleDialogShopLivesSuccess = function (action) {\n\t\treturn POP_STATE;\n\t};\n\n\tthis.getWeebyConfig = function () {\n\t\treturn this._weebyConfig;\n\t};\n\n\tthis.getState = function () {\n\t\treturn this._state;\n\t};\n\n\tthis.setState = function (state, type, data) {\n\t\tif (!type) { type = 'add'; }\n\n\t\tif (this._state !== state) {\n\n\t\t\tif (this._state == states.STATE_GAME) {\n\t\t\t\tthis._history = [states.STATE_LADDER];\n\t\t\t\ttype = 'replace';\n\t\t\t}\n\n\t\t\t// Hijack state\n\t\t\tif (state == states.STATE_LADDER && this._state != states.STATE_CONFIRM_FRIENDS && this._user.hasUnconfirmedFriends()) {\n\t\t\t\t// Show confirm friends dialog\n\t\t\t\tsetTimeout(bind(this, function () {\n\t\t\t\t\tthis.pushState(states.STATE_CONFIRM_FRIENDS);\n\t\t\t\t}), 0);\n\t\t\t} else if (state == states.STATE_LADDER && this._state != states.STATE_CROSSPROMO){\n\t\t\t\t// Show crosspromo if available\n\t\t\t\tvar trigger = this.shouldShowCrosspromo('leaderboard:start', 'modal1');\n\t\t\t\tif (trigger) {\n\t\t\t\t\tthis._crosspromoReturnState = state;\n\t\t\t\t\tstate = states.STATE_CROSSPROMO;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If leaderboard will be shown, check for pending crosspromo rewards\n\t\t\tif (state == states.STATE_LADDER) {\n\t\t\t\tthis.crosspromoManager.checkPendingRewards();\n\t\t\t}\n\n\t\t\tconsole.log('Set state:', states[state]);\n\n\t\t\tvar prevState = this._state;\n\t\t\tthis._state = state;\n\n\t\t\tvar stateDetail = stateDetails[state];\n\t\t\tconsole.log(states[state]);\n\t\t\tif (stateDetail && stateDetail.track) {\n\t\t\t\t// console.log('Track:', stateDetail.track, {userId: this._user.getID()});\n\t\t\t\t(typeof stateDetail.track === 'string') ? trackers.track(stateDetail.track) : stateDetail.track(this);\n\t\t\t}\n\n\t\t\t// update history stack\n\t\t\tif (state == states.STATE_LADDER) {\n\t\t\t\t// always clear the history when the state is being set to the ladder\n\t\t\t\tthis._history = [];\n\t\t\t} else if (type == 'back') {\n\t\t\t\tthis._history.pop();\n\t\t\t} else if (type == 'pop') {\n\t\t\t\t// remove from history until the PUSH item is removed\n\t\t\t\tdo {\n\t\t\t\t\tvar removedState = this._history.pop();\n\t\t\t\t} while (removedState != 'PUSH' && this._history.length);\n\t\t\t\tthis._history.pop();\n\t\t\t} else if (prevState && type != 'replace') {\n\t\t\t\t// replace means replace the existing view without\n\t\t\t\t// pushing the current view onto the history\n\t\t\t\tthis._history.push(prevState);\n\t\t\t}\n\n\t\t\tif (type == 'push') {\n\t\t\t\tthis._history.push('PUSH');\n\t\t\t}\n\n\t\t\tthis._substate = stateDetail.initialState;\n\t\t\tconsole.log('Substate:', this._substate);\n\t\t\tthis.emit('StateChanged', state, prevState, type, data);\n\t\t\tthis._stateUpdater[state] && this._stateUpdater[state]();\n\t\t}\n\t};\n\n\tthis.__getStack = function () { return this._stack; }\n\n\t// goes to the previous state in the history\n\t//  - if targetState is provided, may jump back several\n\t//    states\n\t//  - else just goes back one state (default)\n\tthis.historyBack = function (/* optional */ targetState) {\n\t\tvar prevState;\n\t\tif (targetState) {\n\t\t\tvar index = this._history.indexOf(targetState);\n\t\t\tif (index != -1) {\n\t\t\t\t// truncate history to target state\n\t\t\t\tthis._history.length = index + 1;\n\t\t\t} else {\n\t\t\t\t// unexpected error - we tried to go back in history to a target\n\t\t\t\t// state (probably not at the end of the history) and we couldn't\n\t\t\t\t// find it...\n\t\t\t\ttrackers.track(\"weeby:historyError\", {\n\t\t\t\t\t\ttargetState: states[targetState],\n\t\t\t\t\t\thistory: this._history.map(function (state) { return states[state]; })\n\t\t\t\t\t});\n\n\t\t\t\t// just go back and hope everything is ok\n\t\t\t}\n\t\t}\n\n\t\tvar prevState = this._history[this._history.length - 1];\n\t\tif (prevState == 'PUSH') {\n\t\t\tthis.popState();\n\t\t} else {\n\t\t\tthis.setState(prevState, 'back');\n\t\t}\n\t}\n\n\tthis.pushState = function (state) {\n\t\tif (state != this._state) {\n\t\t\tvar stateDetail = stateDetails[state];\n\t\t\tvar level = this._stack.length;\n\t\t\tif (!stateDetail.alwaysPushState) {\n\t\t\t\twhile (level-- > 0) {\n\t\t\t\t\tthis.popState();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._stack.push(this._state);\n\t\t\tthis.emit('StatePushed');\n\t\t\tconsole.log('state push to', states[state]);\n\t\t\tthis.setState(state, 'push');\n\t\t}\n\t}\n\n\tthis.popState = function () {\n\t\tvar prevState = this._stack.pop();\n\t\tif (!prevState) {\n\t\t\tthis.throwError('state pop requested, but nothing is on the state stack!');\n\t\t} else {\n\t\t\tthis.emit('StatePopped');\n\t\t\tconsole.log('state pop to', states[prevState]);\n\t\t\tthis.setState(prevState, 'pop');\n\t\t}\n\t}\n\n\tthis.getSocial = function () {\n\t\treturn this._social;\n\t}\n\n\tthis.getLadder = function () {\n\t\treturn this._gameModel.getLadder();\n\t}\n\n\tthis.getGameModel = function () {\n\t\treturn this._gameModel;\n\t}\n\n\tthis.getLadderData = function () {\n\t\treturn this._gameModel.getLadder().getList();\n\t};\n\n\tthis.getReceivedGifts = function () {\n\t\treturn this._receivedGifts;\n\t}\n\n\tthis.getSentGifts = function () {\n\t\treturn this._sentGifts;\n\t};\n\n\tthis.handleAction = function (action, /* optional */ data) {\n\t\tif (action) {\n\t\t\tthis.validateAction(action);\n\t\t}\n\n\t\tvar type = 'add';\n\t\tif (action == 'back') {\n\t\t\ttype = 'back';\n\t\t}\n\n\t\tvar state = this._state;\n\t\tlogger.log(states[state], 'handle action:', action, \"data:\", JSON.stringify(data));\n\n\t\t// simple case: action maps to another state\n\t\tvar stateDetail = stateDetails[state];\n\t\tvar nextState = stateDetail.actions[action];\n\t\tif (typeof nextState == 'string') {\n\t\t\t// go to the next state!\n\t\t\tif (nextState == 'POP_STATE') {\n\t\t\t\tthis.popState();\n\t\t\t} else {\n\t\t\t\tvar state = states[nextState];\n\t\t\t\tthis.setState(state, type, data);\n\t\t\t}\n\t\t} else {\n\t\t\t// complex case: do we have a custom action handler?\n\t\t\tvar cb = 'handle' + stateDetails[state].capitalCase;\n\t\t\tif (this[cb]) {\n\t\t\t\tvar result = this[cb](action, data);\n\t\t\t\tif (result === ASYNC_STATE_CHANGE) {\n\t\t\t\t\t// do nothing, we've queued up an async state change\n\t\t\t\t} else if (result === PUSH_STATE) {\n\t\t\t\t\tthis.pushState(this._nextState);\n\t\t\t\t} else if (result === POP_STATE) {\n\t\t\t\t\tthis.popState();\n\t\t\t\t} else if (result === BACK_STATE) {\n\t\t\t\t\tthis.historyBack();\n\t\t\t\t} else if (result) {\n\t\t\t\t\t// sync state change!\n\t\t\t\t\tvar nextState = result;\n\t\t\t\t\tthis.setState(nextState, type, data);\n\t\t\t\t} else {\n\t\t\t\t\tif (stateDetails[state].type == 'dialog'\n\t\t\t\t\t\t\t&& (action == 'close' || action == 'cancel' || action == 'ok')) {\n\t\t\t\t\t\t// handle default actions for dialogs\n\t\t\t\t\t\tthis.popState();\n\t\t\t\t\t} else if (action == 'back') {\n\t\t\t\t\t\tthis.historyBack();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// the action was valid, but the handler did not function properly\n\t\t\t\t\t\t// (probably a bug in the handler code!)\n\t\t\t\t\t\tthis.throwUnhandledAction(cb, action);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (action == 'back') {\n\t\t\t\t\tthis.historyBack();\n\t\t\t\t} else if (stateDetails[state].type == 'dialog') {\n\t\t\t\t\tthis.popState();\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn('handleAction(\"' + action + '\", ...) called in state', states[state], 'but no action handler exists (and', action, 'does not have a default behavior).');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.on = function (event, cb) {\n\t\tvar result = supr(this, 'on', arguments);\n\n\t\tif (event === 'StateChanged') {\n\t\t\tvar state = this._state;\n\t\t\tsetTimeout(function () {\n\t\t\t\tcb(state);\n\t\t\t}, 0);\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tthis.cancelGame = function (data) {\n\t\ttrackers.track('game:cancel');\n\t\tif (this._state !== states.STATE_GAME) {\n\t\t\tlogger.warn('cancelGame called, but not in STATE_GAME!');\n\t\t} else {\n\t\t\tthis._onGameEnd('cancelGame', data);\n\t\t}\n\t}\n\n\tthis.finishGame = function (data) {\n\t\tif (this._state !== states.STATE_GAME) {\n\t\t\tlogger.warn('finishGame called, but not in STATE_GAME!');\n\t\t} else {\n\t\t\tthis._onGameEnd('finishGame', data);\n\t\t}\n\t}\n\n\tthis._onGameEnd = function (action, data) {\n\t\tweebyLocalData.setGamesPlayed(weebyLocalData.getGamesPlayed() + 1);\n\t\tweebyLocalData.setLastPlayedTime(Date.now());\n\n\t\tvar step = weebyLocalData.getTutorialStep(),\n\t\t\tisTutorial = weebyLocalData.getTutorialMode();\n\t\tif (isTutorial) {\n\t\t\tstep++;\n\t\t\tweebyLocalData.setTutorialStep(step);\n\t\t\tif (step > MAX_TUTORIAL_STEPS) {\n\t\t\t\tweebyLocalData.setTutorialMode(false);\n\t\t\t}\n\t\t}\n\n\t\tthis._sound.setMusicMuted(!weebyLocalData.getMusicOn());\n\n\t\tthis.handleAction(action, data);\n\t};\n\n\tthis.getLevelUpReward = function (lvl) {\n\t\tvar r = {},\n\t\t\tb = this._weebyConfig.getBalance() || {};\n\n\t\tr.common = (b.levelUpRewardCommonMultiplier * lvl + b.levelUpRewardCommonAddition) || 0;\n\t\tr.premium = (b.levelUpRewardPremiumMultiplier * lvl + b.levelUpRewardPremiumAddition) || 0;\n\t\treturn r;\n\t};\n\n\tthis.sendGiftToUserID = function (userID, cb) {\n\t\tthis._api.sendGiftToUserID(userID, cb);\n\t};\n\n\tthis.isOffline = function () {\n\t\treturn this._api.isOffline();\n\t};\n\n\tthis.getPurchaseCommonItem = function () {\n\t\treturn this._purchaseCommonItem;\n\t};\n\n\tthis.getPurchasePremiumItem = function () {\n\t\treturn this._purchasePremiumItem;\n\t};\n\n\tthis.getPurchaseLivesItem = function () {\n\t\treturn this._purchaseLivesItem;\n\t};\n\n\tthis.getPurchaseItemShopItem = function() {\n\t\treturn this._purchaseItemShopItem;\n\t};\n\n\tthis.getPurchaseItemShopItemResults = function() {\n\t\treturn this._purchaseItemShopItemResults;\n\t};\n\n\tthis.shouldShowCrosspromo = function (trigger, type) {\n\t\tvar match = this.crosspromoManager.shouldShowCrosspromo(trigger, type);\n\t\tif (match) {\n\t\t\tvar connections = this._api.getCachedConnectionsSync();\n\t\t\tvar referrer = {};\n\t\t\treferrer.impressionId = std.uuid.uuid(32, 16).toLowerCase();\n\t\t\treferrer.targetAppId = match.app.id;\n\t\t\treferrer.packageName = (device.isAndroid || device.isAndroidSimulator) ? match.app.appNameAndroid : match.app.appNameIos;\n\t\t\treferrer.sourceAppId = this._api.getAppID();\n\t\t\treferrer.authenticated = this._user.isAuthed();\n\t\t\treferrer.totalSessionTime = 0; //TODO\n\t\t\treferrer.totalPlayTime = 0; // TODO\n\t\t\treferrer.numberGamesCompleted = weebyLocalData.getGamesPlayed();\n\t\t\treferrer.numberOfSessions = 0; //TODO\n\t\t\treferrer.userId = this._user.getID();\n\t\t\treferrer.numConnections = connections ? connections.length : 0;\n\t\t\treferrer.showTime = Date.now;\n\t\t\treferrer.trigger = trigger;\n\n\t\t\tvar storedBucket = weebyLocalData.getCrosspromoBucket();\n\t\t\tif (storedBucket) {\n\t\t\t\treferrer.ABTest_crosspromo_bucket = storedBucket.bucket;\n\t\t\t\treferrer.ABTest_crosspromo_experimentId = storedBucket.experimentId;\n\t\t\t}\n\n\t\t\tmatch.referrer = referrer;\n\t\t}\n\n\t\treturn match;\n\t}\n\n\tthis.showCrosspromoReward = function (reward) {\n\t\tif (this._activeReward != reward) {\n\t\t\tthis._activeReward = reward;\n\t\t\tthis.pushState(states.STATE_DIALOG_CROSSPROMO_REWARD);\n\t\t}\n\t}\n\n\tthis.getActiveCrosspromoReward = function () {\n\t\treturn this._activeReward;\n\t}\n\n\tthis.showAppStore = function (crosspromo) {\n\t\t\n\t\tvar referrer = crosspromo.referrer;\n\t\tif (referrer) {\n\t\t\tvar savedReferrers = globalStorageModel.getData('CROSSPROMO_REFERRERS') || {};\n\t\t\tsavedReferrers[referrer.targetAppId] = referrer;\n\t\t\tglobalStorageModel.setData('CROSSPROMO_REFERRERS', savedReferrers);\n\t\t}\n\n\t\tvar androidLink = 'https://play.google.com/store/apps/details?id=' + crosspromo.app.androidPackage;\n\t\tif (crosspromo.referrer) {\n\t\t\tandroidLink = androidLink + '&referrer=' + encodeURIComponent(JSON.stringify(crosspromo.referrer));\n\t\t}\n\t\t\n\t\tvar iosLink = 'itms://itunes.com/apps/' + crosspromo.app.iosPackage;\n\t\t\n\t\tif (device.isAndroid) {\n\t\t\twindow.open(androidLink);\n\t\t} else if (device.isIOS) {\n\t\t\twindow.open(iosLink)\n\t\t} else {\n\t\t\t// In browser\n\t\t\tif (device.isIOSSimulator) {\n\t\t\t\twindow.open(iosLink);\n\t\t\t} else {\n\t\t\t\twindow.open(androidLink);\n\t\t\t}\n\t\t}\n\t}\n});\n\nvar weebyController = new WeebyController();\nweebyController.states = states;\n\nexports = weebyController;\n","pre":true},"sdk/plugins/billing/billing.js":{"path":"sdk/plugins/billing/billing.js","friendlyPath":"plugins.billing.billing","directory":"sdk/plugins/billing/","filename":"billing.js","src":"jsio(\"import device\");\njsio(\"import event.Emitter as Emitter\");\njsio(\"import util.setProperty as setProperty\");\n\n/*\n * Items are first purchased, and then consumed.\n *\n * When they are consumed they must not be lost, so they are either\n * delivered to the billing.onPurchase callback or must be stored in\n * localStorage for delivery on the next run.\n */\n\nvar purchasedItems = {};\nvar consumedItems = {};\nvar onPurchase; // callback after consumption\nvar onFailure; // callback on purchase failure (not consume fail)\n\n/*\n * Read the list of consumed items during startup.\n */\nfunction initializeFromLocalStorage() {\n\ttry {\n\t\tvar saved = localStorage.getItem(\"billingConsumed\");\n\n\t\tif (saved) {\n\t\t\tvar consumed = JSON.parse(saved);\n\n\t\t\tif (typeof consumed === \"object\") {\n\t\t\t\t// Merge with consumed items\n\t\t\t\tvar count = 0;\n\t\t\t\tfor (var item in consumed) {\n\t\t\t\t\tconsumedItems[item] = 1;\n\t\t\t\t\t++count;\n\t\t\t\t}\n\t\t\t\tlogger.log(\"Read\", count, \"consumed purchased items\");\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\tlogger.log(\"Failed to read consumed items from local storage:\", e);\n\t}\n}\n\n/*\n * Mark an item as purchased but not consumed yet.\n *\n * This list is grabbed from the market so we do not need to store this\n * information locally, yet.\n */\nfunction purchasedItem(item) {\n\ttry {\n\t\tpurchasedItems[item] = 1;\n\t} catch (e) {\n\t\tlogger.log(\"Purchase update failed with error:\", e);\n\t}\n}\n\n/*\n * Attempt to credit a player for their consumed item, and remove it from the\n * consumed items list in local storage on success.\n */\nfunction creditConsumedItem(item) {\n\ttry {\n\t\tif (typeof onPurchase === \"function\" && consumedItems[item]) {\n\t\t\tonPurchase(item);\n\n\t\t\tdelete consumedItems[item];\n\t\t\tlocalStorage.setItem(\"billingConsumed\", JSON.stringify(consumedItems));\n\n\t\t\tlogger.log(\"Successfully credited consumed item:\", item);\n\t\t}\n\t} catch (e) {\n\t\tlogger.log(\"Crediting purchase failed with error:\", e);\n\t}\n}\n\n/*\n * Move an item from the purchased list to the consumed list and update\n * local storage so that it does not get lost.\n */\nfunction consumePurchasedItem(item) {\n\ttry {\n\t\tif (purchasedItems[item]) {\n\t\t\tdelete purchasedItems[item];\n\t\t\tconsumedItems[item] = 1;\n\n\t\t\tlocalStorage.setItem(\"billingConsumed\", JSON.stringify(consumedItems));\n\n\t\t\tlogger.log(\"Successfully consumed purchased item:\", item);\n\n\t\t\tcreditConsumedItem(item);\n\t\t}\n\t} catch (e) {\n\t\tlogger.log(\"Crediting purchase failed with error:\", e);\n\t}\n}\n\n/*\n * Credit all outstanding consumed items.\n */\nfunction creditAllConsumedItems() {\n\tvar consumed = [];\n\n\tfor (var item in consumedItems) {\n\t\tif (consumedItems[item]) {\n\t\t\tconsumed.push(item);\n\t\t}\n\t}\n\n\tfor (var ii = 0; ii < consumed.length; ++ii) {\n\t\tvar item = consumed[ii];\n\n\t\tcreditConsumedItem(item);\n\t}\n}\n\n/*\n * Run purchase simulation.\n */\nfunction simulatePurchase(item, simulate) {\n\tif (!simulate || simulate === \"simulate\") {\n\t\tsetTimeout(function() {\n\t\t\tlogger.log(\"Simulating item purchase:\", item);\n\t\t\tif (!purchasedItems[item]) {\n\t\t\t\tpurchasedItem(item);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tlogger.log(\"Simulating item consume:\", item);\n\t\t\t\t\tconsumePurchasedItem(item);\n\t\t\t\t}, 2000);\n\t\t\t} else {\n\t\t\t\tlogger.log(\"Item is already purchased.\");\n\t\t\t\tif (typeof onFailure === \"function\") {\n\t\t\t\t\tonFailure(\"already owned\", item);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 2000);\n\t} else {\n\t\tsetTimeout(function() {\n\t\t\tlogger.log(\"Simulating item failure:\", item);\n\t\t\tif (typeof onFailure === \"function\") {\n\t\t\t\tonFailure(simulate, item);\n\t\t\t}\n\t\t}, 1000);\n\t}\n}\n\n// Run initialization tasks\ninitializeFromLocalStorage();\n\n// Maps of tokens <-> items from market\nvar tokenItem = {};\nvar itemToken = {};\n\n// Flag: Has read purchases from the market?\nvar readPurchases = false;\n\n// Flag: Is market service connected?\nvar isConnected = true;\n\n// Flag: Is connected to the Internet?\nvar isOnline = navigator.onLine;\n\n// Flag: Is market available?\nvar isMarketAvailable = false;\n\nBilling=__class__;var Billing=Billing(function Billing(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function() {\n\t\tsupr(this, 'init', arguments);\n\n\t\tsetProperty(this, \"onPurchase\", {\n\t\t\tset: function(f) {\n\t\t\t\t// If a callback is being set,\n\t\t\t\tif (typeof f === \"function\") {\n\t\t\t\t\tonPurchase = f;\n\n\t\t\t\t\tcreditAllConsumedItems();\n\t\t\t\t} else {\n\t\t\t\t\tonPurchase = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\tget: function() {\n\t\t\t\treturn onPurchase;\n\t\t\t}\n\t\t});\n\n\t\tsetProperty(this, \"onFailure\", {\n\t\t\tset: function(f) {\n\t\t\t\t// If a callback is being set,\n\t\t\t\tif (typeof f === \"function\") {\n\t\t\t\t\tonFailure = f;\n\t\t\t\t} else {\n\t\t\t\t\tonFailure = null;\n\t\t\t\t}\n\t\t\t},\n\t\t\tget: function() {\n\t\t\t\treturn onFailure;\n\t\t\t}\n\t\t});\n\n\t\tsetProperty(this, \"isMarketAvailable\", {\n\t\t\tset: function(f) {\n\t\t\t},\n\t\t\tget: function() {\n\t\t\t\treturn isMarketAvailable == true;\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.purchase = simulatePurchase;\n});\n\nvar billing = new Billing;\n\nfunction onMarketStateChange() {\n\tvar available = isConnected && isOnline;\n\n\tif (available != isMarketAvailable) {\n\t\tisMarketAvailable = available;\n\n\t\tif (available) {\n\t\t\tlogger.log(\"Market is now available\");\n\t\t} else {\n\t\t\tlogger.log(\"Market is now unavailable\");\n\t\t}\n\n\t\tbilling.emit(\"MarketAvailable\", available);\n\t}\n}\n\n// If just simulating native device,\nif (!GLOBAL.NATIVE || device.simulatingMobileNative) {\n\tlogger.log(\"Installing fake billing API\");\n} else {\n\tlogger.log(\"Installing JS billing component for native\");\n\n\t// Override purchase function to hook into native\n\tBilling.prototype.purchase = function(item, simulate) {\n\t\tif (simulate) {\n\t\t\tif (simulate == \"simulate\") {\n\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"purchase\", JSON.stringify({\n\t\t\t\t\t\"sku\": \"android.test.purchased\"\n\t\t\t\t}));\n\t\t\t} else if (simulate == \"cancel\") {\n\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"purchase\", JSON.stringify({\n\t\t\t\t\t\"sku\": \"android.test.canceled\"\n\t\t\t\t}));\n\t\t\t} else if (simulate == \"refund\") {\n\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"purchase\", JSON.stringify({\n\t\t\t\t\t\"sku\": \"android.test.refunded\"\n\t\t\t\t}));\n\t\t\t} else if (simulate == \"unavailable\") {\n\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"purchase\", JSON.stringify({\n\t\t\t\t\t\"sku\": \"android.test.unavailable\"\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"purchase\", JSON.stringify({\n\t\t\t\t\t\"sku\": \"android.test.canceled\"\n\t\t\t\t}));\n\t\t\t}\n\t\t} else {\n\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"purchase\", JSON.stringify({\n\t\t\t\t\"sku\": item\n\t\t\t}));\n\t\t}\n\t};\n\n\t// Request initial market state\n\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"isConnected\", \"{}\");\n\n\tfunction nativePurchasedItem(sku, token) {\n\t\t// Set up map\n\t\ttokenItem[token] = sku;\n\t\titemToken[sku] = token;\n\n\t\t// Record purchases\n\t\tpurchasedItem(sku);\n\n\t\t// Attempt to consume it immediately\n\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"consume\", JSON.stringify({\n\t\t\ttoken: token\n\t\t}));\n\t}\n\n\tNATIVE.events.registerHandler('billingPurchase', function(evt) {\n\t\tlogger.log(\"Got billingPurchase event:\", JSON.stringify(evt));\n\n\t\t// If SKU event,\n\t\tvar sku = evt.sku;\n\t\tif (!sku || evt.failure) {\n\t\t\tvar failure = evt.failure || \"cancel\";\n\n\t\t\tlogger.log(\"Unable to purchase item\", sku, \":\", failure);\n\n\t\t\tif (typeof onFailure === \"function\") {\n\t\t\t\tonFailure(failure, sku);\n\t\t\t}\n\t\t} else {\n\t\t\tnativePurchasedItem(sku, evt.token);\n\t\t}\n\t});\n\n\tNATIVE.events.registerHandler('billingConsume', function(evt) {\n\t\tlogger.log(\"Got billingConsume event:\", JSON.stringify(evt));\n\n\t\t// NOTE: Function is organized carefully for callback reentrancy\n\n\t\tvar token = evt.token;\n\t\tvar item = tokenItem[token];\n\n\t\t// If not failed,\n\t\tif (!evt.failure) {\n\t\t\tconsumePurchasedItem(item);\n\t\t} else {\n\t\t\tlogger.log(\"Failed to consume token\", token, \"for item\", item, \"and will retry in 3 seconds...\");\n\n\t\t\tsetTimeout(function() {\n\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"consume\", JSON.stringify({\n\t\t\t\t\ttoken: token\n\t\t\t\t}));\n\t\t\t}, 3000);\n\t\t}\n\t});\n\n\t// Wait a couple of seconds to avoid slowing down the startup process\n\tvar ownedRetryID = setTimeout(function() {\n\t\townedRetryID = null;\n\t\tif (!readPurchases) {\n\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"getPurchases\", \"{}\");\n\t\t}\n\t}, 3000);\n\n\tNATIVE.events.registerHandler('billingOwned', function(evt) {\n\t\tlogger.log(\"Got billingOwned event:\", JSON.stringify(evt));\n\n\t\tif (ownedRetryID !== null) {\n\t\t\tclearTimeout(ownedRetryID);\n\t\t\townedRetryID = null;\n\t\t}\n\n\t\t// If attempt failed,\n\t\tif (evt.failure) {\n\t\t\townedRetryID = setTimeout(function() {\n\t\t\t\townedRetryID = null;\n\t\t\t\tif (!readPurchases) {\n\t\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"getPurchases\", \"{}\");\n\t\t\t\t}\n\t\t\t}, 10000);\n\t\t} else {\n\t\t\treadPurchases = true;\n\n\t\t\t// Add owned items\n\t\t\tvar skus = evt.skus;\n\t\t\tvar tokens = evt.tokens;\n\t\t\tif (skus && skus.length > 0) {\n\t\t\t\tfor (var ii = 0, len = skus.length; ii < len; ++ii) {\n\t\t\t\t\tnativePurchasedItem(sku[ii], tokens[ii]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tNATIVE.events.registerHandler('billingConnected', function(evt) {\n\t\tlogger.log(\"Got billingConnected event:\", JSON.stringify(evt));\n\n\t\tisConnected = evt.connected;\n\n\t\tonMarketStateChange();\n\t});\n\n\twindow.addEventListener(\"online\", function() {\n\t\tisOnline = true;\n\n\t\tonMarketStateChange();\n\t});\n\n\twindow.addEventListener(\"offline\", function() {\n\t\tisOnline = false;\n\n\t\tonMarketStateChange();\n\t});\n\n\tbilling.on(\"MarketAvailable\", function(available) {\n\t\t// If just connected,\n\t\tif (available) {\n\t\t\tif (ownedRetryID !== null) {\n\t\t\t\tclearTimeout(ownedRetryID);\n\t\t\t\townedRetryID = null;\n\t\t\t}\n\n\t\t\t// Try to get purchases immediately to react faster\n\t\t\tif (!readPurchases) {\n\t\t\t\tNATIVE.plugins.sendEvent(\"BillingPlugin\", \"getPurchases\", \"{}\");\n\t\t\t}\n\t\t}\n\t});\n}\n\n// Run initial state check\nonMarketStateChange();\n\nexports = billing;\n","pre":true},"sdk/plugins/amplitude/amplitude.js":{"path":"sdk/plugins/amplitude/amplitude.js","friendlyPath":"plugins.amplitude.amplitude","directory":"sdk/plugins/amplitude/","filename":"amplitude.js","src":"Amplitude=__class__;var Amplitude=Amplitude(function Amplitude(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.track = function (name, data) {\n\t\tlogger.log(\"{amplitude} track: \", name, JSON.stringify(data));\n\n\t\tif (NATIVE && NATIVE.plugins && NATIVE.plugins.sendEvent) {\n\t\t\tNATIVE.plugins.sendEvent(\"AmplitudePlugin\", \"track\",\n\t\t\t\tJSON.stringify({ eventName: name, params: data }));\n\t\t}\n\t};\n});\n\nexports = new Amplitude();\n","pre":true},"sdk/jsio/std/uuid.js":{"path":"sdk/jsio/std/uuid.js","friendlyPath":"std.uuid","directory":"sdk/jsio/std/","filename":"uuid.js","src":"/*\nBased on Math.uuid.js 1.4 by Robert Kieffer\n\n----\nCopyright (c) 2008, Robert Kieffer\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n  * Redistributions of source code must retain the above copyright notice,\n\tthis list of conditions and the following disclaimer.\n  * Redistributions in binary form must reproduce the above copyright\n\tnotice, this list of conditions and the following disclaimer in the\n\tdocumentation and/or other materials provided with the distribution.\n  * Neither the name of Robert Kieffer nor the names of its contributors\n\tmay be used to endorse or promote products derived from this software\n\twithout specific prior written permission.\n  \nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\nINTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\nARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGE.\n\n*/\n\n\n\n/*\n * Generate a random uuid.\n *\n * USAGE: uuid.uuid(length, radix)\n *   length - the desired number of characters\n *   radix  - the number of allowable values for each character.\n *\n * EXAMPLES:\n *   // No arguments  - returns RFC4122, version 4 ID\n *   >>> std.uuid()\n *   \"92329D39-6F5C-4520-ABFC-AAB64544E172\"\n * \n *   // One argument - returns ID of the specified length\n *   >>> std.uuid(15)\t // 15 character ID (default base=62)\n *   \"VcydxgltxrVZSTV\"\n *\n *   // Two arguments - returns ID of the specified length, and radix. (Radix must be <= 62)\n *   >>> std.uuid(8, 2)  // 8 character ID (base=2)\n *   \"01001010\"\n *   >>> std.uuid(8, 10) // 8 character ID (base=10)\n *   \"47473046\"\n *   >>> std.uuid(8, 16) // 8 character ID (base=16)\n *   \"098F4D35\"\n */\n\n\nvar CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''); \nexports.uuid = function (len, radix) {\n\tvar chars = CHARS, uuid = [], rnd = Math.random;\n\tradix = radix || chars.length;\n\n\tif (len) {\n\t\t// Compact form\n\t\tfor (var i = 0; i < len; i++) uuid[i] = chars[0 | rnd()*radix];\n\t} else {\n\t\t// rfc4122, version 4 form\n\t\tvar r;\n\n\t\t// rfc4122 requires these characters\n\t\tuuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\n\t\tuuid[14] = '4';\n\n\t\t// Fill in random data.  At i==19 set the high bits of clock sequence as\n\t\t// per rfc4122, sec. 4.1.5\n\t\tfor (var i = 0; i < 36; i++) {\n\t\t\tif (!uuid[i]) {\n\t\t\t\tr = 0 | rnd()*16;\n\t\t\t\tuuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r & 0xf];\n\t\t\t}\n\t\t}\n\t}\n\treturn uuid.join('');\n};\n\n","pre":true},"sdk/plugins/weeby/CrosspromoManager.js":{"path":"sdk/plugins/weeby/CrosspromoManager.js","friendlyPath":".CrosspromoManager","directory":"sdk/plugins/weeby/","filename":"CrosspromoManager.js","src":"jsio(\"import .weebyLocalData\");\njsio(\"import device\");\n\nvar sdk_plugins_weeby_CrosspromoManager=__class__;exports=sdk_plugins_weeby_CrosspromoManager(function sdk_plugins_weeby_CrosspromoManager(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.crosspromoTypes = ['modal1', 'ladderrow1', 'ladderrow2', 'ladderfull1']; // all lowercase\n\n\tthis.init = function (opts) {\n\t\tthis._weebyController = opts.weebyController;\n\t\t\n\t\t// Load saved crosspromos, make sure campaigns and triggers are defined\n\t\tthis._crosspromos = weebyLocalData.getCrosspromoTriggers();\n\t\tif (this._crosspromos && !this._crosspromos.campaigns) {\n\t\t\tthis._crosspromos.campaigns = [];\n\t\t}\n\n\t\tif (this._crosspromos && !this._crosspromos.triggers) {\n\t\t\tthis._crosspromos.triggers = [];\n\t\t}\n\n\t\t// Make sure connections are available later when needed\n\t\tthis._weebyController.getCachedConnections(bind(this, function (err, connections) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t} else {\n\t\t\t\t//Do nothing\n\t\t\t}\n\t\t}));\n\n\t\tthis._refreshCrosspromos();\n\n\t\tsetInterval(bind(this, '_refreshCrosspromos'), 120000);\n\n\t\tthis.checkPendingRewards();\n\t}\n\n\tthis._refreshCrosspromos = function() {\n\t\tthis._weebyController.fetchCrosspromoInfo(bind(this, function (err, crosspromos) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t} else if (crosspromos) {\n\n\t\t\t\tvar storedBucket = weebyLocalData.getCrosspromoBucket();\n\n\t\t\t\t// If no bucket or id changed, choose new bucket\n\t\t\t\tif (!storedBucket || (crosspromos.abExperimentId && crosspromos.abExperimentId != storedBucket.experimentId)) {\n\n\t\t\t\t\t// Check for buckets and pick one\n\t\t\t\t\tvar buckets = crosspromos.abBuckets;\n\t\t\t\t\tif(buckets && buckets.length > 0) {\n\n\t\t\t\t\t\tvar dartboard = [this.crosspromoTypes[0]];\n\t\t\t\t\t\tfor (var i = buckets.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\tvar bucket = buckets[i].toLowerCase();\n\t\t\t\t\t\t\tif(this.crosspromoTypes.indexOf(bucket) != -1 && dartboard.indexOf(bucket) == -1) {\n\t\t\t\t\t\t\t\t// This is an known bucket, and is not listed yet\n\t\t\t\t\t\t\t\tdartboard.push(bucket);\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Pick one type at random, and save it.\n\n\t\t\t\t\t\tvar count = dartboard.length;\n\t\t\t\t\t\t// Choose one match at random\n\t\t\t\t\t\tvar randomBucket = dartboard[Math.floor(Math.random() * count)];\n\t\t\t\t\t\tweebyLocalData.setCrosspromoBucket({\n\t\t\t\t\t\t\tbucket: randomBucket,\n\t\t\t\t\t\t\texperimentId: crosspromos.abExperimentId\n\t\t\t\t\t\t});\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\t\t// Choose random bucket\n\t\t\t\t\t\t\tweebyLocalData.setCrosspromoBucket({\n\t\t\t\t\t\t\t\tbucket: this.crosspromoTypes[Math.floor(Math.random() * this.crosspromoTypes.length)],\n\t\t\t\t\t\t\t\texperimentId: 'default'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Save default bucket\n\t\t\t\t\t\t\tweebyLocalData.setCrosspromoBucket({\n\t\t\t\t\t\t\t\tbucket: this.crosspromoTypes[0],\n\t\t\t\t\t\t\t\texperimentId: 'default'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} \n\n\t\t\t\tvar currentDeviceLocale = window.navigator.language && window.navigator.language.substring(0, 2);\n\t\t\t\t\n\t\t\t\t// Make sure reward amounts are defined, and set localized app names\n\t\t\t\tfor (var i = crosspromos.campaigns.length - 1; i >= 0; i--) {\n\t\t\t\t\tvar campaign = crosspromos.campaigns[i];\n\t\t\t\t\tcampaign.rewardAmount = campaign.rewardAmount || 10;\n\n\t\t\t\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\t\t\t\tif (currentDeviceLocale && campaign.app.androidAppNames) {\n\t\t\t\t\t\t\tcampaign.app.localizedName = campaign.app.androidAppNames[currentDeviceLocale] || campaign.app.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (currentDeviceLocale && campaign.app.iosAppNames) {\n\t\t\t\t\t\t\tcampaign.app.localizedName = campaign.app.iosAppNames[currentDeviceLocale] || campaign.app.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t// if (DEBUG) {\n\t\t\t\t// \t// Dont remove any triggers in debug mode\n\t\t\t\t// \tthis._findFriendsPlaying(crosspromos);\n\t\t\t\t// \tthis._saveTriggers(crosspromos);\n\t\t\t\t// } else {\n\t\t\t\t\tvar campaigns = [];\n\t\t\t\t\t// If the user plays any target games, remove that trigger\n\t\t\t\t\tthis._weebyController.getCurrentUser(bind(this, function (err, result) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (result && result.apps) {\n\t\t\t\t\t\t\t\tfor (var i = crosspromos.campaigns.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\t\t\tvar found = false;\n\t\t\t\t\t\t\t\t\tfor (var j = result.apps.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\t\t\t\tif (crosspromos.campaigns[i].app.id == result.apps[j].app.id) {\n\t\t\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tif (!found) {\n\t\t\t\t\t\t\t\t\t\t// User does not play this game, save it\n\t\t\t\t\t\t\t\t\t\tcampaigns.push(crosspromos.campaigns[i]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcrosspromos.campaigns = campaigns;\n\t\t\t\t\t\tthis._findFriendsPlaying(crosspromos);\n\t\t\t\t\t\tthis._saveTriggers(crosspromos);\n\t\t\t\t\t}));\n\t\t\t\t//}\n\t\t\t}\n\t\t}));\n\t}\n\n\tthis._saveTriggers = function (crosspromos) {\n\t\tthis._crosspromos = crosspromos;\n\t\tweebyLocalData.setCrosspromoTriggers(this._crosspromos);\n\t}\n\n\tthis._findFriendsPlaying = function (crosspromos) {\n\t\t// Check all games played by all connections\n\t\t// If any connections play target games, save the user objects inside the campaigns\n\t\tif (crosspromos && crosspromos.campaigns) {\n\t\t\tvar connections = this._weebyController.getCachedConnectionsSync();\n\t\t\tif (connections) {\n\t\t\t\tfor (var k = crosspromos.campaigns.length - 1; k >= 0; k--) {\n\t\t\t\t\tvar appId = crosspromos.campaigns[k].app.id;\n\t\t\t\t\tcrosspromos.campaigns[k].friends = [];\n\t\t\t\t\tfor (var i = connections.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tvar apps = connections[i].apps;\n\t\t\t\t\t\tif (apps) {\n\t\t\t\t\t\t\tfor (var j = apps.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\t\tif (apps[j].id == appId) {\n\t\t\t\t\t\t\t\t\t// Save connection, and move on to next connection\n\t\t\t\t\t\t\t\t\tcrosspromos.campaigns[k].friends.push(connections[i]);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// trigger is a game state like gameresult:start or game:end etc.\n\t// type is AB test bucket like modal1 or ladderrow1 etc.\n\tthis.shouldShowCrosspromo = function (trigger, type) {\n\t\tvar returnVal = null;\n\t\tvar crosspromos = this._crosspromos;\n\t\tvar savedBucket = weebyLocalData.getCrosspromoBucket();\n\t\tvar level = weebyLocalData.getLevel();\n\n\t\t// Only look for a match if:\n\t\t// the user is level 3 or above, \n\t\t// the crosspromo bucket matches, and \n\t\t// either the user is verified or if the type is modal1.\n\t\tif (level && level >= 3 && type && savedBucket && savedBucket.bucket && type == savedBucket.bucket && (this._weebyController.getUser().isVerified() || type === 'modal1')) {\n\t\t\tswitch (type) {\n\t\t\t\tcase 'ladderfull1':\n\t\t\t\t\t// fall through\n\t\t\t\tcase 'modal1': \n\t\t\t\t\t// If a trigger matches\n\t\t\t\t\tif (crosspromos.triggers.indexOf(trigger) != -1) {\n\t\t\t\t\t\tvar minGames = crosspromos.minGames ? crosspromos.minGames : 5;\n\t\t\t\t    \tvar minTime = crosspromos.minSeconds ? crosspromos.minSeconds * 1000 : 600 * 1000;\n\t\t\t\t    \tvar lastCrosspromoTime = weebyLocalData.getLastCrosspromoTime();\n\t\t\t\t    \tvar lastPlayedTime = weebyLocalData.getLastPlayedTime();\n\t\t\t\t    \tvar gamesPlayed = weebyLocalData.getGamesPlayed();\n\t\t\t\t    \tvar LastCrosspromoGamesPlayed = weebyLocalData.getLastCrosspromoGamesPlayed();\n\t\t\t\t    \tvar nowDate = Date.now();\n\n\t\t\t\t    \tif (!minGames || !minTime \n\t\t\t\t    \t\t|| (gamesPlayed - LastCrosspromoGamesPlayed >= minGames) \n\t\t\t\t    \t\t|| (nowDate - lastCrosspromoTime > minTime && nowDate - lastPlayedTime < minTime)) {\n\t\t\t\t    \t\t// Enough number of games have been played OR enough time has passed since last cp, and a game was played recently\n\t\t\t    \t\t\treturnVal = this._selectRandomActiveCampaign();\n\t\t\t\t    \t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t\n\t\t\t\tdefault:\n\t\t\t\t\treturnVal = this._selectRandomActiveCampaign();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis.setActiveTrigger(returnVal);\n\t\treturn returnVal;\n\t}\n\n\tthis._selectRandomActiveCampaign = function () {\n\t\t// Make sure friends are loaded\n\t\tthis._findFriendsPlaying(this._crosspromos);\n\t\t\n\t\t// Select from matches which are active, and are not redeemed already\n\t\tvar matches = [];\n\t\t\t\t\t\n\t\tfor (var i = this._crosspromos.campaigns.length - 1; i >= 0; i--) {\n\t\t \tvar match = this._crosspromos.campaigns[i];\n\t\t \tif (match.dateStart < Date.now() && match.dateEnd > Date.now()) {\n\t\t \t\tvar found = false;\n\t\t \t\tvar rewards = weebyLocalData.getCrosspromoRewards();\n\t\t\t\tif (rewards && rewards.length > 0) {\n\t\t\t\t\tfor (var j = rewards.length - 1; j >= 0; j--) {\n\t\t\t\t\t\tif (rewards[j].id == match.app.id && rewards[j].redeeemed) {\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!found) {\n\t\t\t\t\tmatches.push(match);\n\t\t\t\t}\n\t\t \t}\n\t\t };\n\n\t\tvar count = matches.length;\n\t\t\t\t\t\n\t\tif (count == 0) {\n\t\t\treturn null;\n\t\t} else {\n\t\t\t// Choose one match at random\n\t\t\tvar randomMatch = matches[Math.floor(Math.random() * count)];\n\t\t\treturn randomMatch;\n\t\t}\n\t}\n\n\tthis.setActiveTrigger = function (trigger) {\n\t\tthis._activeTrigger = trigger;\n\t}\n\n\tthis.getCrosspromoTrigger = function () {\n\t\treturn this._activeTrigger;\n\t}\n\n\tthis.onInstall = function (trigger) {\n\t\t\n\t\t// Save pending reward - only save amount on android\n\t\trewards = weebyLocalData.getCrosspromoRewards();\n\t\tvar found = false;\n\t\tfor (var i = rewards.length - 1; i >= 0; i--) {\n\t\t\tif (rewards[i].id == trigger.app.id) {\n\t\t\t\tfound = true;\n\t\t\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\t\t\trewards[i].amount = trigger.rewardAmount;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\tif (!found) {\n\n\t\t\tvar rewardAmount;\n\t\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\t\t\trewardAmount = trigger.rewardAmount;\n\t\t\t} else {\n\t\t\t\t// Do nothing, amount should be 0 or undefined on iOS\n\t\t\t}\n\t\t\trewards.push({\n\t\t\t\tid: trigger.app.id,\n\t\t\t\tamount: rewardAmount,\n\t\t\t\tname: trigger.app.localizedName || trigger.app.name,\n\t\t\t\timage: trigger.app.images.iconSmall,\n\t\t\t\tcreated: Date.now(),\n\t\t\t\tredeemed: false\n\t\t\t});\n\t\t}\n\n\t\tweebyLocalData.setCrosspromoRewards(rewards);\n\t}\n\n\tthis.checkPendingRewards = function () {\n\t\tvar rewards = weebyLocalData.getCrosspromoRewards();\n\t\tif (rewards && rewards.length > 0) {\n\t\t\tthis._weebyController.getCurrentUser(bind(this, function (err, result) {\n\t\t\t\tif (err) {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t} else {\n\t\t\t\t\tvar found = false;\n\t\t\t\t\tfor (var i = rewards.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (rewards[i].redeeemed) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (var j = result.apps.length - 1; j >= 0; j--) {\n\t\t\t\t\t\t\t// If the reward app is associated with the user, and the association happened after reward entry\n\t\t\t\t\t\t\tif (rewards[i].id == result.apps[j].app.id && rewards[i].created < result.apps[j].app.created && !rewards[i].redeemed) {\n\t\t\t\t\t\t\t\tthis._weebyController.showCrosspromoReward(rewards[i]);\n\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (found) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\tthis.giveReward = function (reward) {\n\t\tif (reward) {\n\t\t\tvar rewards = weebyLocalData.getCrosspromoRewards();\n\t\t\tvar found = false;\n\t\t\tfor (var i = rewards.length - 1; i >= 0; i--) {\n\t\t\t\tif (rewards[i].id == reward.id) {\n\t\t\t\t\t// Give award\n\t\t\t\t\tvar amount = rewards[i].amount;\n\t\t\t\t\trewards[i].redeemed = true;\n\t\t\t\t\tfound = true;\n\t\t\t\t\tif (amount) {\n\t\t\t\t\t\t// Amount will be undefined on iOS\n\t\t\t\t\t\tweebyLocalData.addPremiumCurrency(amount);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\tweebyLocalData.setCrosspromoRewards(rewards);\n\t\t}\n\t}\n});\n","pre":true},"sdk/plugins/weeby/sdk/api.js":{"path":"sdk/plugins/weeby/sdk/api.js","friendlyPath":".sdk.api","directory":"sdk/plugins/weeby/sdk/","filename":"api.js","src":"jsio(\"import lib.PubSub\");\njsio(\"import util.ajax as ajax\");\njsio(\"import std.uuid\");\n\njsio(\"import ..models.localStorageModel as localStorageModel\");\njsio(\"import ..models.globalStorageModel as globalStorageModel\");\njsio(\"import ..weebyNative as weebyNative\");\n\nvar DEFAULT_API_VERSION = 'v1';\n\nWeeby=__class__;var Weeby=Weeby(function Weeby(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\tvar defaults = {\n\t\tbaseURL: 'http://staging.wee.by:80/v1/',\n\n\t\t// TODO: remove this?\n\t\tappID: 'd7fb97bfae514c9690efab195e8ac2f7',\n\t\t\n\t\tlocal: false,\n\t\tstaging: false,\n\t\tdebug: false\n\t};\n\n\tthis.init = function(opts) {\n\t\tthis._version = DEFAULT_API_VERSION;\n\n\t\tthis._isOffline = !navigator.onLine;\n\t\twindow.addEventListener('online', bind(this, '_onOnlineChange'));\n\t\twindow.addEventListener('offline', bind(this, '_onOnlineChange'));\n\n\t\tthis._verifyOpts(opts);\n\t\topts = merge(opts, defaults);\n\t\tthis._appID = opts.appID;\n\t\tthis._baseURL = opts.baseURL;\n\t\tthis._debug = opts.debug;\n\t\tthis._gifts = [];\n\n\t\tthis._blocked = 0;\n\t\tthis._queue = [];\n\n\t\tthis.readData(opts.authKey);\n\n\t\tif (opts.staging && this.setStagingHost) {\n\t\t\tthis.setStagingHost();\n\t\t} else if (opts.local && this.setLocalHost) {\n\t\t\tthis.setLocalHost();\n\t\t} else {\n\t\t\tthis.setProductionHost();\n\t\t}\n\t};\n\n\tthis.isMock = function () {\n\t\treturn false;\n\t};\n\n\tfunction throwError() {\n\t\tvar msg = Array.prototype.join.call(arguments, ' ');\n\t\tif (DEBUG) {\n\t\t\tthrow new Error(msg);\n\t\t} else {\n\t\t\tlogger.error(msg);\n\t\t}\n\t};\n\n\tthis.getHost = function () {\n\t\treturn this._host;\n\t}\n\n\tthis.setProductionHost = function () {\n\t\tthis.setHost('api.wee.by');\n\t};\n\n\tthis.setStagingHost = function () {\n\t\tthis.setHost('staging.wee.by');\n\t};\n\n\t// these won't even be defined in release builds\n\tif (DEBUG) {\n\t\tthis.setLocalHost = function () {\n\t\t\tthis.setHost('localhost', 3000);\n\t\t}\n\t};\n\n\tthis.setHost = function (hostname, port) {\n\t\tthis._host = hostname + (port ? ':' + port : '');\n\t\tthis._baseURL = 'http://' + this._host + '/' + this._version + '/';\n\t};\n\n\t/*\n\t * make sure we've been given everything we need to properly initialize\n\t * In debug mode, use some defaults but warn about them\n\t */\n\tthis._verifyOpts = function(opts) {\n\t\tif (!opts.appID) {\n\t\t\tlogger.error('no appID specified');\n\t\t\tif (!opts.debug) {\n\t\t\t\tthrowError('Missing appID when creating weeby object!');\n\t\t\t} else {\n\t\t\t\tlogger.warn('Default app key won\\'t work in release mode');\n\t\t\t}\n\t\t}\n\t\tif (opts.authKey) {\n\t\t\tif (opts.debug) {\n\t\t\t\tlogger.info('Using mock auth key - not reading from settings');\n\t\t\t} else {\n\t\t\t\tlogger.error('mock auth key in release mode is not allowed');\n\t\t\t\tthrowError('Mock auth key in release mode');\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getAuthKey = function () {\n\t\treturn this._saveData.authKey;\n\t};\n\n\tthis._setAuthKey = function (authKey) {\n\t\tif (authKey && authKey != this._saveData.authKey) {\n\t\t\tthis._saveData.authKey = authKey;\n\t\t\tthis.writeData();\n\t\t\tthis.emit('authKeyChanged', authKey);\n\t\t}\n\t};\n\n\t//TODO this stuff should probably be kept out of local storage when\n\t//we're not in the simulator.  A really simple plugin to do this would be \n\t//good - save it to a file or to user preferences. This will allow the \n\t//tests to run in node, too, which is nice.\n\tvar STORAGE_KEY = 'api.data';\n\tthis.readData = function (debugKey) {\n\t\tthis._saveData = globalStorageModel.getData(STORAGE_KEY);\n\t\tif (!this._saveData) {\n\t\t\tthis._saveData = localStorageModel.getData(STORAGE_KEY);\n\t\t\tif (!this._saveData) {\n\t\t\t\tthis._saveData = {};\n\t\t\t}\n\t\t}\n\n\t\tif (debugKey) { \n\t\t\t//if we're given a debug key, just use it and don't save to\n\t\t\t//settings.\n\t\t\tthis._persistData = false;\n\t\t\tthis._saveData.authKey = debugKey;\n\t\t} else {\n\t\t\tthis._persistData = true;\n\t\t\tif (!this._saveData.authKey) {\n\t\t\t\tthis._saveData.authKey = exports.newAuthKey();\n\t\t\t\tlogger.log('generated new key', this._saveData.authKey);\n\t\t\t\tthis.writeData();\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.writeData = function () {\n\t\tif (this._persistData) {\n\t\t\tlocalStorageModel.setData(STORAGE_KEY, this._saveData);\n\t\t\tglobalStorageModel.setData(STORAGE_KEY, this._saveData);\n\t\t} else {\n\t\t\tif (!this._debug) {\n\t\t\t\t//data should always be persisted except in debug mode\n\t\t\t\tthrowError('persistData is false in release mode!');\n\t\t\t} else {\n\t\t\t\tlogger.info('Skipping persist of data');\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.handleQueue = function () {\n\t\tif (this._queue.length) {\n\t\t\tvar item = this._queue.shift();\n\t\t\tthis[item.methodName](item.data, item.cb);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\t/**\n\t * RPC creates a method on Weeby named `methodName`, which makes\n\t * an rpc  to the server endpoint `path`.  It will optionally call\n\t * a callback on success, passing back the data.\n\t **/\n\tvar RPC = bind(this, function(path, methodName, onSuccess, blocking, canBlock) {\n\t\tthis[methodName] = function(data, cb) {\n\t\t\t// If there's something blocking -like login- and the request can be blocked\n\t\t\t// then store the request to be handled later...\n\t\t\tif (this._blocked && canBlock) {\n\t\t\t\tthis._queue.push({\n\t\t\t\t\tmethodName: methodName,\n\t\t\t\t\tdata: data,\n\t\t\t\t\tcb: cb\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof data === 'function') {\n\t\t\t\tcb = data;\n\t\t\t\tdata = {};\n\t\t\t}\n\n\t\t\tif (blocking) {\n\t\t\t\tthis._blocked++; // Blocked is a stack, there can be multiple blocking calls made...\n\t\t\t}\n\n\t\t\tconsole.log('POST -->: ' + path + ', data: ' + JSON.stringify(data));\n\t\t\tthis.req(path, data, bind(this, function(error, data) {\n\t\t\t\tif (blocking) {\n\t\t\t\t\tthis._blocked--;\n\t\t\t\t}\n\n\t\t\t\tconsole.log('<-- ' + path + ', error: ' + JSON.stringify(error) + ', data: ' + JSON.stringify(data));\n\t\t\t\tif (!error && onSuccess) {\n\t\t\t\t\tonSuccess.call(this, data);\n\t\t\t\t}\n\t\t\t\tif (cb) {\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\tcb(error, data);\n\t\t\t\t}\n\n\t\t\t\t// Check if there are pending requests which were blocked...\n\t\t\t\tif (!this._blocked) {\n\t\t\t\t\tthis.handleQueue();\n\t\t\t\t}\n\t\t\t}));\n\t\t};\n\t});\n\n\t//TODO these seem to be the same thing\n\tRPC(\n\t\t'users.log-in',\n\t\t'login',\n\t\tfunction (data) {\n\t\t\tif (data.key != this.getAuthKey()) {\n\t\t\t\tthis._setAuthKey(data.key);\n\t\t\t}\n\t\t},\n\t\ttrue, // is blocking\n\t\tfalse // can not be blocked\n\t);\n\n\tRPC('users.get-current-user', 'connect', null, false, true); // Not blocking, can be blocked\n\tRPC('users.get-connections', '_getConnections', null, false, true); // Not blocking, can be blocked\n\n\tthis.getConnections = function (cb) {\n\t\tthis._getConnections(bind(this, function (err, res) {\n\t\t\tthis._connections = res && res.items;\n\t\t\tcb && cb(err, res && res.items);\n\t\t}));\n\t};\n\n\tRPC('users.get-user', 'getProfile', null, false, true); // Not blocking, can be blocked\n\tRPC('users.review-unconfirmed-friends', 'confirmFriends', null, false, true); // Not blocking, can be blocked\n\tRPC(\n\t\t'leaderboard.get-ladder',\n\t\t'getLadder',\n\t\tfunction (data) {\n\t\t\tvar usersWhoSentGifts = data.items.filter(function (item) {\n\t\t\t\treturn item.gift !== null;\n\t\t\t});\n\t\t\tdata.expiration = data.expiration && new Date(data.expiration);\n\t\t\tvar gifts = [];\n\t\t\tusersWhoSentGifts.forEach(function(item) {\n\t\t\t\titem.gifts.forEach(function(gift) {\n\t\t\t\t\tgifts.push(gift);\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis._gifts = gifts;\n\t\t},\n\t\tfalse, // Not blocking\n\t\ttrue // Can be blocked\n\t);\n\tRPC('users/begin-phone-verification', 'verifyPhone', null, true, false); // Blocking, can not be blocked\n\tRPC('users/begin-voice-verification', 'verifyVoicePhone', null, true, false); // Blocking, can not be blocked\n\tRPC('users/complete-phone-verification', 'completeVerifyPhone', null, true, false); // Blocking, can not be blocked\n\n\tRPC('users.update-info', 'updateInfo', null, false, true); // Not blocking, can be blocked\n\tRPC('users.set-image', '_setProfilePhoto', null, false, true); // Not blocking, can be blocked\n\tRPC('leaderboard.submit-score', 'submitScore', null, false, true); // Not blocking, can be blocked\n\tRPC('gifts.accept-gifts', 'acceptGiftsByID', null, false, true); // Not blocking, can be blocked\n\tRPC('gifts.send-gift', '_sendGift', null, false, true); // Not blocking, can be blocked\n\tRPC('notifications.register-apns', 'registerAPNS', null, false, true); // Not blocking, can be blocked\n\t\n\tthis.setProfilePhoto = function (base64Image, cb) {\n\t\tthis._setProfilePhoto({data: base64Image}, cb);\n\t};\n\n\tthis.fetchCrosspromos = function(cb) {\n\t\tvar urlPrefix = 'http://s3.amazonaws.com/s.wee.cat/apps/';\n\t\tif (DEBUG) {\n\t\t\turlPrefix = 'http://s3.amazonaws.com/staging.wee.cat/apps/';\n\t\t}\n\t\t\n\t\tajax.get({\n\t\t\turl: urlPrefix + this._appID + '/crosspromos.json',\n\t\t\ttype: 'json'\n\t\t}, cb);\n\t};\n\n\t// This never auto-refreshes its cache. \n\t// Use getConnections instead if latest info is required \n\tthis.getCachedConnections = function (cb) {\n\t\tif (this._connections) {\n\t\t\tcb(null, this._connections);\n\t\t} else {\n\t\t\tthis.getConnections(cb);\n\t\t}\n\t};\n\n\tthis.getCachedConnectionsSync = function () {\n\t\treturn this._connections;\n\t};\n\n\tthis.getUnconfirmedFriends = function (myUserID, cb) {\n\t\tthis.getConnections(function (err, connections) {\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t} else if (connections) {\n\t\t\t\tcb(null, connections.filter(function (item) {\n\t\t\t\t\tvar n = item.services.length;\n\t\t\t\t\tvar gc;\n\t\t\t\t\tfor (var i = 0; i < n; ++i) {\n\t\t\t\t\t\tif (item.services[i].service == 'gc') {\n\t\t\t\t\t\t\tgc = item.services[i];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn gc // has the gc service\n\t\t\t\t\t\t&& item.id != myUserID // is not me\n\t\t\t\t\t\t&& (item.name || item.nickname) // has a name\n\t\t\t\t\t\t&& item.verified // is verified\n\t\t\t\t\t\t&& !gc.confirmed // not already confirmed\n\t\t\t\t\t\t&& !gc.blocked; // not blocked\n\t\t\t\t}));\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.setFullName = function(name, cb) {\n\t\tif (typeof name !== 'string') {\n\t\t\tthrowError('setFullName called with a non-string argument');\n\t\t}\n\t\tthis.updateInfo({\n\t\t\tname: name\n\t\t}, cb);\n\t};\n\n\tthis.setNickname = function(nickname, cb) {\n\t\tif (typeof nickname !== 'string') {\n\t\t\tthrowError('setNickname called with a non-string argument');\n\t\t}\n\t\tthis.updateInfo({\n\t\t\tnickname: nickname\n\t\t}, cb);\n\t};\n\n\tthis.setStatus = function(status, cb) {\n\t\tif (typeof status !== 'string') {\n\t\t\tthrowError('setStatus called with a non-string argument');\n\t\t}\n\t\tthis.updateInfo({\n\t\t\tstatus: status\n\t\t}, cb);\n\t};\n\n\tthis.getGifts = function() {\n\t\treturn this._gifts;\n\t};\n\n\tthis.acceptGifts = function(gifts, cb) {\n\t\tvar ids = gifts.map(function(gift) {\n\t\t\treturn gift.id;\n\t\t});\n\t\tthis.acceptGiftsByID({ids: ids}, cb);\n\t};\n\n\tthis.sendGiftToUserID = function (userID, cb) {\n\t\tthis._sendGift({\n\t\t\tto: userID,\n\t\t\tdata: {}\n\t\t}, cb);\n\t};\n\n\tvar onContacts = function(cb, e, data) {\n\t\tif (cb) {\n\t\t\tcb(e, data);\n\t\t}\n\t};\n\n\t/**\n\t * get the contacts from the device (or fake simulator), and upload\n\t * them to the server\n\t **/\n\tthis.syncContacts = function (cb) {\n\t\tconsole.log('SYNC CONTACTS');\n\t\tweebyNative.readContactList(bind(this, function (err, contacts) {\n\t\t\tlogger.log('#####################################################');\n\t\t\tif (contacts) {\n\t\t\t\tlogger.log('got a contact list');\n\t\t\t\tlogger.log(JSON.stringify(contacts));\n\t\t\t\tthis.req('users/add-connections', {items: contacts}, bind(this, onContacts, cb));\n\t\t\t} else {\n\t\t\t\tcb && cb(err, contacts);\n\t\t\t}\n\t\t}));\n\t};\n\n\t//TODO\n\t//state.save-state What is state?\n\t//set photo\n\n\tthis.req = function(path, data, cb) {\n\t\tvar url = this._baseURL + path + '?key=' + this._saveData.authKey +\n\t\t\t'&app=' + this._appID;\n\n\t\tdata = merge(data, {\n\t\t\tauthKey: this._saveData.authKey,\n\t\t\tappID: this._appID\n\t\t});\n\n\t\tconsole.log(url);\n\n\t\tajax.post({\n\t\t\tdata: data,\n\t\t\turl: url,\n\t\t\ttype: 'json',\n\t\t\theaders:  {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t}, cb);\n\t};\n\n\tthis.getAppID = function () {\n\t\treturn this._appID;\n\t};\n\n\tthis.setOffline = function (offline) {\n\t\tthis._isOffline = offline;\n\t};\n\n\tthis._onOnlineChange = function () {\n\t\tthis._isOffline = !navigator.onLine;\n\t}\n\n\tthis.isOffline = function () {\n\t\treturn this._isOffline;\n\t};\n});\n\nexports.newAuthKey = function() {\n\treturn std.uuid.uuid(32, 16).toLowerCase();\n};\n\nif (window.GC) {\n\tjsio('import device');\n\tif (device.isSimulator) {\n\t\tjsio('import .simulator.contacts');\n\t}\n}\nexports.Weeby = Weeby;\n","pre":true},"sdk/plugins/weeby/models/globalStorageModel.js":{"path":"sdk/plugins/weeby/models/globalStorageModel.js","friendlyPath":"..models.globalStorageModel","directory":"sdk/plugins/weeby/models/","filename":"globalStorageModel.js","src":"jsio(\"import event.Emitter as Emitter\");\njsio(\"import ..weebyNative as weebyNative\");\njsio(\"import .localStorageModel\");\n\nglobalStorageModel=__class__;var globalStorageModel=globalStorageModel(function globalStorageModel(){return this.init&&this.init.apply(this,arguments)},Emitter, function(supr) {\n\n\t// one unified global storage key per app, avoids overlap in browser\n\tvar GLOBAL_STORAGE_KEY = \"__WEEBY_GLOBAL_STORAGE__\";\n\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', arguments);\n\t};\n\n\tfunction _read(key) {\n\t\tvar data = weebyNative.readFromGlobalStorage(key);\n\t\tif (data) {\n\t\t\ttry {\n\t\t\t\tdata = JSON.parse(data);\n\t\t\t} catch (e) {\n\t\t\t\tdata = null;\n\t\t\t}\n\t\t}\n\t\treturn data;\n\t}\n\n\tthis.getData = function(key) {\n\t\tvar data;\n\t\tif (NATIVE && NATIVE.plugins) {\n\t\t\tdata = _read(key);\n\n\t\t\t// deprecated\n\t\t\tif (!data) {\n\t\t\t\tdata = _read(GLOBAL_STORAGE_KEY + key);\n\t\t\t}\n\t\t} else {\n\t\t\t// prefix key for localStorage read/write (browser simulator only)\n\t\t\tkey = GLOBAL_STORAGE_KEY + key;\n\n\t\t\tvar data = localStorage.getItem(key);\n\t\t\tif (data !== undefined && data !== null) {\n\t\t\t\tdata = JSON.parse(data);\n\t\t\t}\n\t\t}\n\t\treturn data;\n\t};\n\n\tthis.setData = function(key, value) {\n\t\tif (key.length > 43) {\n\t\t\tif (DEBUG) {\n\t\t\t\tthrow new Error(\"global storage key is too long, max length: 43\");\n\t\t\t}\n\n\t\t\tlogger.error(\"global storage max key length greater than 43\");\n\t\t\tkey = key.substring(0, 43);\n\t\t}\n\n\t\tif (value !== undefined && value !== null) {\n\t\t\tkey = key;\n\t\t\tif (NATIVE && NATIVE.plugins) {\n\t\t\t\tweebyNative.writeToGlobalStorage(key, JSON.stringify(value));\n\t\t\t} else {\n\t\t\t\t// prefix key for localStorage read/write (browser simulator only)\n\t\t\t\tkey = GLOBAL_STORAGE_KEY + key;\n\n\t\t\t\tlocalStorage.setItem(GLOBAL_STORAGE_KEY + key, JSON.stringify(value));\n\t\t\t}\n\t\t} else {\n\t\t\t//this.removeData(key);\n\t\t}\n\t};\n\n//\tthis.removeData = function(key) {\n//\t\tglobalStorage.removeItem(GLOBAL_STORAGE_KEY + key);\n//\t};\n//\n//\tthis.readInt = function(key, defaultValue) {\n//\t\tdefaultValue = defaultValue || 0;\n//\t\tvar value = this.getData(key);\n//\t\tif (value === undefined) {\n//\t\t\tvalue = defaultValue;\n//\t\t} else if (typeof value !== 'number') {\n//\t\t\tvalue = defaultValue;\n//\t\t\tlogger.warn(\"Int not found in readInt, using default value for key\", key);\n//\t\t} else {\n//\t\t\tvar oldValue = value;\n//\t\t\tvalue = parseInt(value, 10);\n//\t\t\tif (value !== oldValue) {\n//\t\t\t\tlogger.warn(\"Non-int value found in readInt, for key\", key);\n//\t\t\t}\n//\t\t}\n//\t\treturn value;\n//\t};\n//\n//\tthis.writeInt = function(key, value) {\n//\t\tvalue = Math.floor(value || 0);\n//\t\tthis.setData(key, value);\n//\t\treturn value;\n//\t};\n//\n//\tthis.readBool = function(key, defaultValue) {\n//\t\tdefaultValue = defaultValue === undefined ? true : defaultValue;\n//\t\tvar value = this.getData(key);\n//\t\tif (value === undefined) {\n//\t\t\tvalue = defaultValue;\n//\t\t} else if (typeof value !== 'boolean') {\n//\t\t\tvalue = defaultValue;\n//\t\t\tlogger.warn(\"Non-boolean value in readBool, using default value for key\", key);\n//\t\t}\n//\t\treturn value;\n//\t};\n//\n//\tthis.writeBool = function(key, value) {\n//\t\tthis.setData(key, value || false);\n//\t};\n});\n\nvar globalStorageModel = new globalStorageModel();\nexports = globalStorageModel;\n","pre":true},"sdk/plugins/weeby/sdk/simulator/contacts.js":{"path":"sdk/plugins/weeby/sdk/simulator/contacts.js","friendlyPath":".simulator.contacts","directory":"sdk/plugins/weeby/sdk/simulator/","filename":"contacts.js","src":"jsio('import .PhoneFormat');\njsio('import .md5');\n\nNATIVE = window.NATIVE || {};\nNATIVE.contacts = NATIVE.contacts || {};\nvar number = '5133192890';\nvar e164 = PhoneFormat.formatE164('US', number);\nvar md5Number = md5.md5(number);\nvar md5E164 = md5.md5(e164);\nNATIVE.contacts.getContacts =  function(cb) {\n\tcb({\n\t\t\"items\": [\n\t\t{\n\t\t\t\"data\": \"fb25313cc023bd4ad43c6ef93494c98d\",\n\t\t\t\"service\": \"phone\",\n\t\t\t\"name\": \"Joe Smith\",\n\t\t\t\"key\": \"9d7f71641b0be55c4c857135e8e89a5d\"\n\t\t},\n\t\t{\n\t\t\t\"data\": md5E164,\n\t\t\t\"service\": \"phone\",\n\t\t\t\"name\": \"Tom Fairfield\",\n\t\t\t\"key\": md5Number\n\t\t}]\n\t});\n};\n","pre":true},"sdk/plugins/weeby/sdk/simulator/PhoneFormat.js":{"path":"sdk/plugins/weeby/sdk/simulator/PhoneFormat.js","friendlyPath":".PhoneFormat","directory":"sdk/plugins/weeby/sdk/simulator/","filename":"PhoneFormat.js","src":"/*\n\nCompiled Tuesday May 14, 2013 at 7:33pm America/New_York\n\nVersion: libphonenumber r574\n\n------------------------------------------------------------------------\n\n\n Copyright (C) Alan Beebe (alan.beebe@gmail.com).\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n \n\n\nUsage...\n\nThis is the same type of code used by cell phones when you enter\na phone number into your dialer app.  Your phone already knows\nwhat country you are a subscriber in, so it assumes you are entering\na local number, unless of course you prefix the number with a +, or\nin the USA you could also prefix the number with 011 to indicate you\nwish to dial internationally.  This code functions the same way.\n\nLets assume your in the United States and you enter the following\nphone number: 8646978257\n\nformatE164(\"US\", \"8646978257\");\n Returns: +18646978257\n\ncountryForE164Number(\"US\", \"+18646978257\");\n Returns: US\n\nformatInternational(\"US\", \"8646978257\");\n Returns: (864) 697-8257\n Info: This is the format you use if you are displaying this number to users outside the US\n \nformatLocal(\"US\", \"8646978257\");\n Returns: (864) 697-8257\n Info: This is the format you use if you are displaying this number to users inside the US\n       (In certain countries, this format will be different then the international format)\n \ncountryCodeToName(\"US\");\n Returns: United States\n\t\n\t\n\n*/\n\n\n// -------------------------------------------------------------------------\nfunction countryForE164Number(phone) {\n\t/*\n\t\n\tReturn the country code for an e164 formatted number\n\t\n\tphone (String) phone number in e164 format to return the country code for\n\t\n\t*/\n\n\tif (!phone) { return \"\"; }\n\t\n\ttry {\n\t\tvar phone = cleanPhone(phone);\n\t\tvar phoneUtil = i18n.phonenumbers.PhoneNumberUtil.getInstance();\n\t\tvar number = phoneUtil.parseAndKeepRawInput(phone);\n\t    var output = new goog.string.StringBuffer();\n\t    output = phoneUtil.getRegionCodeForNumber(number);\n    \treturn output.toString();\n    } catch (e) {\n    \treturn \"\";\n    }\n}\n\n// -------------------------------------------------------------------------\nfunction formatNumberForMobileDialing(country, phone) {\n\t/*\n\t\n\tReturns a number formatted in such a way that it can be dialed from a mobile\n\tphone in a specific region. If the number cannot be reached from the region\n\t(e.g. some countries block toll-free numbers from being called outside of the\n\tcountry), the method returns an empty string.\n\t\n\t*/\n\n\tif (!phone) { return \"\"; }\n\t\n\ttry {\n\t\tvar phone = cleanPhone(phone);\n\t\tvar phoneUtil = i18n.phonenumbers.PhoneNumberUtil.getInstance();\n\t\tvar number = phoneUtil.parseAndKeepRawInput(phone, country);\n\t    var output = new goog.string.StringBuffer();\n\t    output = phoneUtil.formatNumberForMobileDialing(number, country, true);\n    \treturn output.toString();\n    } catch (e) {\n    \treturn \"\";\n    }\n}\n\n// -------------------------------------------------------------------------\nexports.isValidNumber = function isValidNumber(phone) {\n\t/*\n\t\n\tTests whether a phone number matches a valid pattern. Note this doesn't\n\tverify the number is actually in use, which is impossible to tell by just\n\tlooking at a number itself.\n\t\n\t*/\n\n\tif (!phone) { return false; }\n\t\n\ttry {\n\t\tvar phone = cleanPhone(phone);\n\t\tvar phoneUtil = i18n.phonenumbers.PhoneNumberUtil.getInstance();\n\t\tvar number = phoneUtil.parseAndKeepRawInput(phone, \"\");\n\t    return phoneUtil.isValidNumber(number);\n    } catch (e) {\n    \treturn false;\n    }\n}\n\n// -------------------------------------------------------------------------\nexports.formatE164 = function formatE164(country, phone) {\n\t/*\n\t\n\tReturn the phone number in e164 format\n\t\n\tcountry (String) 2 digit country code\n\tphone (String) phone number to format\n\t\n\t*/\n\n\tif (!phone) { return phone; }\n\t\n\ttry {\n\t\tvar phone = cleanPhone(phone);\n\t\tvar phoneUtil = i18n.phonenumbers.PhoneNumberUtil.getInstance();\n\t\tvar number = phoneUtil.parseAndKeepRawInput(phone, country);\n\t\tvar PNF = i18n.phonenumbers.PhoneNumberFormat;\n\t    var output = new goog.string.StringBuffer();\n\t    output = phoneUtil.format(number, PNF.E164);\n    \treturn output.toString();\n    } catch (e) {\n    \treturn phone\n    }\n}\n\n\n// -------------------------------------------------------------------------  \nfunction formatInternational(country, phone) {\n\t/*\n\t\n\tReturn the phone number in international format\n\t\n\tcountry (String) 2 digit country code\n\tphone (String) phone number to format\n\t\n\t*/\n\t\n\tif (!phone) { return phone; }\n\n\ttry {\n\t\tvar phone = cleanPhone(phone);\n\t    var formatter = new i18n.phonenumbers.AsYouTypeFormatter(country);\n\t    var output = new goog.string.StringBuffer();\n\t    for (var i = 0; i < phone.length; ++i) {\n\t\t\tvar inputChar = phone.charAt(i);\n\t\t\toutput = (formatter.inputDigit(inputChar));\n\t\t}\n    \treturn output.toString();\n    } catch (e) {\n    \treturn phone;\n    }\n}\n\n// -------------------------------------------------------------------------\nexports.formatLocal = function formatLocal(country, phone) {\n\t/*\n\t\n\tReturn the phone number in the format local to the user\n\t\n\tcountry (String) 2 digit country code\n\tphone (String) phone number to format\n\t\n\t*/\n\n\tif (!phone) { return phone; }\n\t\n\ttry {\n\t\tvar phone = cleanPhone(phone);\n\t\tvar phoneUtil = i18n.phonenumbers.PhoneNumberUtil.getInstance();\n\t\tvar number = phoneUtil.parseAndKeepRawInput(phone, country);\n\t\tif (phoneUtil.isValidNumberForRegion(number, country)) {\n\t\t\tvar PNF = i18n.phonenumbers.PhoneNumberFormat;\n\t\t    var output = new goog.string.StringBuffer();\n\t\t    output = phoneUtil.format(number, PNF.NATIONAL);\n\t    \treturn output.toString();\n\t\t} else {\n\t\t\treturn formatInternational(country, phone);\n\t\t}\n\t} catch (e) {\n\t\treturn formatInternational(country, phone);\n\t}\n}\n\t\n// -------------------------------------------------------------------------\nfunction cleanPhone(phone) {\n\t/*\n\t\n\tRemove any non numeric characters from the phone number but leave any plus sign at the beginning\n\t\n\tphone (String) phone number to clean\n\t\n\t*/\n\n\tif (phone) {\n\t\tphone = phone.replace(/[^\\d\\+]/g,'');\n\t\tif (phone.substr(0, 1) == \"+\") {\n\t\t\tphone = \"+\" + phone.replace(/[^\\d]/g,'');\n\t\t} else {\n\t\t\tphone = phone.replace(/[^\\d]/g,'');\n\t\t}\n\t}\n\n\treturn phone;\n}\n\n// -------------------------------------------------------------------------\nfunction countryCodeToName(countryCode) {\n\t/*\n\t\n\tConvert the country code to a name\n\t\n\tcountry (String) 2 digit country code\n\t\n\t*/\n\t\n\tvar arrCountry = new Array();\n\tarrCountry['AF'] = \"Afghanistan\";\n\tarrCountry['AL'] = \"Albania\";\n\tarrCountry['DZ'] = \"Algeria\";\n\tarrCountry['AS'] = \"American Samoa\";\n\tarrCountry['AD'] = \"Andorra\";\n\tarrCountry['AO'] = \"Angola\";\n\tarrCountry['AI'] = \"Anguilla\";\n\tarrCountry['AQ'] = \"Antarctica\";\n\tarrCountry['AG'] = \"Antigua And Barbuda\";\n\tarrCountry['AR'] = \"Argentina\";\n\tarrCountry['AM'] = \"Armenia\";\n\tarrCountry['AW'] = \"Aruba\";\n\tarrCountry['AU'] = \"Australia\";\n\tarrCountry['AT'] = \"Austria\";\n\tarrCountry['AZ'] = \"Azerbaijan\";\n\tarrCountry['BS'] = \"Bahamas\";\n\tarrCountry['BH'] = \"Bahrain\";\n\tarrCountry['BD'] = \"Bangladesh\";\n\tarrCountry['BB'] = \"Barbados\";\n\tarrCountry['BY'] = \"Belarus\";\n\tarrCountry['BE'] = \"Belgium\";\n\tarrCountry['BZ'] = \"Belize\";\n\tarrCountry['BJ'] = \"Benin\";\n\tarrCountry['BM'] = \"Bermuda\";\n\tarrCountry['BT'] = \"Bhutan\";\n\tarrCountry['BO'] = \"Bolivia\";\n\tarrCountry['BA'] = \"Bosnia And Herzegovina\";\n\tarrCountry['BW'] = \"Botswana\";\n\tarrCountry['BV'] = \"Bouvet Island\";\n\tarrCountry['BR'] = \"Brazil\";\n\tarrCountry['IO'] = \"British Indian Ocean Territory\";\n\tarrCountry['BN'] = \"Brunei\";\n\tarrCountry['BG'] = \"Bulgaria\";\n\tarrCountry['BF'] = \"Burkina Faso\";\n\tarrCountry['BI'] = \"Burundi\";\n\tarrCountry['KH'] = \"Cambodia\";\n\tarrCountry['CM'] = \"Cameroon\";\n\tarrCountry['CA'] = \"Canada\";\n\tarrCountry['CV'] = \"Cape Verde\";\n\tarrCountry['KY'] = \"Cayman Islands\";\n\tarrCountry['CF'] = \"Central African Republic\";\n\tarrCountry['TD'] = \"Chad\";\n\tarrCountry['CL'] = \"Chile\";\n\tarrCountry['CN'] = \"China\";\n\tarrCountry['CX'] = \"Christmas Island\";\n\tarrCountry['CC'] = \"Cocos (Keeling) Islands\";\n\tarrCountry['CO'] = \"Columbia\";\n\tarrCountry['KM'] = \"Comoros\";\n\tarrCountry['CG'] = \"Congo\";\n\tarrCountry['CK'] = \"Cook Islands\";\n\tarrCountry['CR'] = \"Costa Rica\";\n\tarrCountry['CI'] = \"Cote D'Ivorie (Ivory Coast)\";\n\tarrCountry['HR'] = \"Croatia (Hrvatska)\";\n\tarrCountry['CU'] = \"Cuba\";\n\tarrCountry['CY'] = \"Cyprus\";\n\tarrCountry['CZ'] = \"Czech Republic\";\n\tarrCountry['CD'] = \"Democratic Republic Of Congo (Zaire)\";\n\tarrCountry['DK'] = \"Denmark\";\n\tarrCountry['DJ'] = \"Djibouti\";\n\tarrCountry['DM'] = \"Dominica\";\n\tarrCountry['DO'] = \"Dominican Republic\";\n\tarrCountry['TP'] = \"East Timor\";\n\tarrCountry['EC'] = \"Ecuador\";\n\tarrCountry['EG'] = \"Egypt\";\n\tarrCountry['SV'] = \"El Salvador\";\n\tarrCountry['GQ'] = \"Equatorial Guinea\";\n\tarrCountry['ER'] = \"Eritrea\";\n\tarrCountry['EE'] = \"Estonia\";\n\tarrCountry['ET'] = \"Ethiopia\";\n\tarrCountry['FK'] = \"Falkland Islands (Malvinas)\";\n\tarrCountry['FO'] = \"Faroe Islands\";\n\tarrCountry['FJ'] = \"Fiji\";\n\tarrCountry['FI'] = \"Finland\";\n\tarrCountry['FR'] = \"France\";\n\tarrCountry['FX'] = \"France, Metropolitan\";\n\tarrCountry['GF'] = \"French Guinea\";\n\tarrCountry['PF'] = \"French Polynesia\";\n\tarrCountry['TF'] = \"French Southern Territories\";\n\tarrCountry['GA'] = \"Gabon\";\n\tarrCountry['GM'] = \"Gambia\";\n\tarrCountry['GE'] = \"Georgia\";\n\tarrCountry['DE'] = \"Germany\";\n\tarrCountry['GH'] = \"Ghana\";\n\tarrCountry['GI'] = \"Gibraltar\";\n\tarrCountry['GR'] = \"Greece\";\n\tarrCountry['GL'] = \"Greenland\";\n\tarrCountry['GD'] = \"Grenada\";\n\tarrCountry['GP'] = \"Guadeloupe\";\n\tarrCountry['GU'] = \"Guam\";\n\tarrCountry['GT'] = \"Guatemala\";\n\tarrCountry['GN'] = \"Guinea\";\n\tarrCountry['GW'] = \"Guinea-Bissau\";\n\tarrCountry['GY'] = \"Guyana\";\n\tarrCountry['HT'] = \"Haiti\";\n\tarrCountry['HM'] = \"Heard And McDonald Islands\";\n\tarrCountry['HN'] = \"Honduras\";\n\tarrCountry['HK'] = \"Hong Kong\";\n\tarrCountry['HU'] = \"Hungary\";\n\tarrCountry['IS'] = \"Iceland\";\n\tarrCountry['IN'] = \"India\";\n\tarrCountry['ID'] = \"Indonesia\";\n\tarrCountry['IR'] = \"Iran\";\n\tarrCountry['IQ'] = \"Iraq\";\n\tarrCountry['IE'] = \"Ireland\";\n\tarrCountry['IM'] = \"Isle of Man\";\n\tarrCountry['IL'] = \"Israel\";\n\tarrCountry['IT'] = \"Italy\";\n\tarrCountry['JM'] = \"Jamaica\";\n\tarrCountry['JP'] = \"Japan\";\n\tarrCountry['JO'] = \"Jordan\";\n\tarrCountry['KZ'] = \"Kazakhstan\";\n\tarrCountry['KE'] = \"Kenya\";\n\tarrCountry['KI'] = \"Kiribati\";\n\tarrCountry['KW'] = \"Kuwait\";\n\tarrCountry['KG'] = \"Kyrgyzstan\";\n\tarrCountry['LA'] = \"Laos\";\n\tarrCountry['LV'] = \"Latvia\";\n\tarrCountry['LB'] = \"Lebanon\";\n\tarrCountry['LS'] = \"Lesotho\";\n\tarrCountry['LR'] = \"Liberia\";\n\tarrCountry['LY'] = \"Libya\";\n\tarrCountry['LI'] = \"Liechtenstein\";\n\tarrCountry['LT'] = \"Lithuania\";\n\tarrCountry['LU'] = \"Luxembourg\";\n\tarrCountry['MO'] = \"Macau\";\n\tarrCountry['MK'] = \"Macedonia\";\n\tarrCountry['MG'] = \"Madagascar\";\n\tarrCountry['MW'] = \"Malawi\";\n\tarrCountry['MY'] = \"Malaysia\";\n\tarrCountry['MV'] = \"Maldives\";\n\tarrCountry['ML'] = \"Mali\";\n\tarrCountry['MT'] = \"Malta\";\n\tarrCountry['MH'] = \"Marshall Islands\";\n\tarrCountry['MQ'] = \"Martinique\";\n\tarrCountry['MR'] = \"Mauritania\";\n\tarrCountry['MU'] = \"Mauritius\";\n\tarrCountry['YT'] = \"Mayotte\";\n\tarrCountry['MX'] = \"Mexico\";\n\tarrCountry['FM'] = \"Micronesia\";\n\tarrCountry['MD'] = \"Moldova\";\n\tarrCountry['MC'] = \"Monaco\";\n\tarrCountry['MN'] = \"Mongolia\";\n\tarrCountry['MS'] = \"Montserrat\";\n\tarrCountry['MA'] = \"Morocco\";\n\tarrCountry['MZ'] = \"Mozambique\";\n\tarrCountry['MM'] = \"Myanmar (Burma)\";\n\tarrCountry['NA'] = \"Namibia\";\n\tarrCountry['NR'] = \"Nauru\";\n\tarrCountry['NP'] = \"Nepal\";\n\tarrCountry['NL'] = \"Netherlands\";\n\tarrCountry['AN'] = \"Netherlands Antilles\";\n\tarrCountry['NC'] = \"New Caledonia\";\n\tarrCountry['NZ'] = \"New Zealand\";\n\tarrCountry['NI'] = \"Nicaragua\";\n\tarrCountry['NE'] = \"Niger\";\n\tarrCountry['NG'] = \"Nigeria\";\n\tarrCountry['NU'] = \"Niue\";\n\tarrCountry['NF'] = \"Norfolk Island\";\n\tarrCountry['KP'] = \"North Korea\";\n\tarrCountry['MP'] = \"Northern Mariana Islands\";\n\tarrCountry['NO'] = \"Norway\";\n\tarrCountry['OM'] = \"Oman\";\n\tarrCountry['PK'] = \"Pakistan\";\n\tarrCountry['PW'] = \"Palau\";\n\tarrCountry['PA'] = \"Panama\";\n\tarrCountry['PG'] = \"Papua New Guinea\";\n\tarrCountry['PY'] = \"Paraguay\";\n\tarrCountry['PE'] = \"Peru\";\n\tarrCountry['PH'] = \"Philippines\";\n\tarrCountry['PN'] = \"Pitcairn\";\n\tarrCountry['PL'] = \"Poland\";\n\tarrCountry['PT'] = \"Portugal\";\n\tarrCountry['PR'] = \"Puerto Rico\";\n\tarrCountry['QA'] = \"Qatar\";\n\tarrCountry['RE'] = \"Reunion\";\n\tarrCountry['RO'] = \"Romania\";\n\tarrCountry['RU'] = \"Russia\";\n\tarrCountry['RW'] = \"Rwanda\";\n\tarrCountry['SH'] = \"Saint Helena\";\n\tarrCountry['KN'] = \"Saint Kitts And Nevis\";\n\tarrCountry['LC'] = \"Saint Lucia\";\n\tarrCountry['PM'] = \"Saint Pierre And Miquelon\";\n\tarrCountry['VC'] = \"Saint Vincent And The Grenadines\";\n\tarrCountry['SM'] = \"San Marino\";\n\tarrCountry['ST'] = \"Sao Tome And Principe\";\n\tarrCountry['SA'] = \"Saudi Arabia\";\n\tarrCountry['SN'] = \"Senegal\";\n\tarrCountry['SC'] = \"Seychelles\";\n\tarrCountry['SL'] = \"Sierra Leone\";\n\tarrCountry['SG'] = \"Singapore\";\n\tarrCountry['SK'] = \"Slovak Republic\";\n\tarrCountry['SI'] = \"Slovenia\";\n\tarrCountry['SB'] = \"Solomon Islands\";\n\tarrCountry['SO'] = \"Somalia\";\n\tarrCountry['ZA'] = \"South Africa\";\n\tarrCountry['GS'] = \"South Georgia And South Sandwich Islands\";\n\tarrCountry['KR'] = \"South Korea\";\n\tarrCountry['ES'] = \"Spain\";\n\tarrCountry['LK'] = \"Sri Lanka\";\n\tarrCountry['SD'] = \"Sudan\";\n\tarrCountry['SR'] = \"Suriname\";\n\tarrCountry['SJ'] = \"Svalbard And Jan Mayen\";\n\tarrCountry['SZ'] = \"Swaziland\";\n\tarrCountry['SE'] = \"Sweden\";\n\tarrCountry['CH'] = \"Switzerland\";\n\tarrCountry['SY'] = \"Syria\";\n\tarrCountry['TW'] = \"Taiwan\";\n\tarrCountry['TJ'] = \"Tajikistan\";\n\tarrCountry['TZ'] = \"Tanzania\";\n\tarrCountry['TH'] = \"Thailand\";\n\tarrCountry['TG'] = \"Togo\";\n\tarrCountry['TK'] = \"Tokelau\";\n\tarrCountry['TO'] = \"Tonga\";\n\tarrCountry['TT'] = \"Trinidad And Tobago\";\n\tarrCountry['TN'] = \"Tunisia\";\n\tarrCountry['TR'] = \"Turkey\";\n\tarrCountry['TM'] = \"Turkmenistan\";\n\tarrCountry['TC'] = \"Turks And Caicos Islands\";\n\tarrCountry['TV'] = \"Tuvalu\";\n\tarrCountry['UG'] = \"Uganda\";\n\tarrCountry['UA'] = \"Ukraine\";\n\tarrCountry['AE'] = \"United Arab Emirates\";\n\tarrCountry['GB'] = \"United Kingdom\";\n\tarrCountry['US'] = \"United States\";\n\tarrCountry['UM'] = \"United States Minor Outlying Islands\";\n\tarrCountry['UY'] = \"Uruguay\";\n\tarrCountry['UZ'] = \"Uzbekistan\";\n\tarrCountry['VU'] = \"Vanuatu\";\n\tarrCountry['VA'] = \"Vatican City (Holy See)\";\n\tarrCountry['VE'] = \"Venezuela\";\n\tarrCountry['VN'] = \"Vietnam\";\n\tarrCountry['VG'] = \"Virgin Islands (British)\";\n\tarrCountry['VI'] = \"Virgin Islands (US)\";\n\tarrCountry['WF'] = \"Wallis And Futuna Islands\";\n\tarrCountry['EH'] = \"Western Sahara\";\n\tarrCountry['WS'] = \"Western Samoa\";\n\tarrCountry['YE'] = \"Yemen\";\n\tarrCountry['YU'] = \"Yugoslavia\";\n\tarrCountry['ZM'] = \"Zambia\";\n\tarrCountry['ZW'] = \"Zimbabwe\";\n\t\n\tvar name = arrCountry[countryCode.toUpperCase()];\n\tif (name === undefined) {\n\t\treturn \"\";\n\t} else {\n\t\treturn name;\n\t}\n}\n\n\nvar COMPILED=!0,goog=goog||{};goog.global=this;goog.DEBUG=!0;goog.LOCALE=\"en\";goog.provide=function(a){if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace \"'+a+'\" already declared.');delete goog.implicitNamespaces_[a];for(var b=a;(b=b.substring(0,b.lastIndexOf(\".\")))&&!goog.getObjectByName(b);)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)};goog.setTestOnly=function(a){if(COMPILED&&!goog.DEBUG)throw a=a||\"\",Error(\"Importing test-only code into non-debug environment\"+a?\": \"+a:\".\");};\nCOMPILED||(goog.isProvided_=function(a){return!goog.implicitNamespaces_[a]&&!!goog.getObjectByName(a)},goog.implicitNamespaces_={});goog.exportPath_=function(a,b,c){a=a.split(\".\");c=c||goog.global;!(a[0]in c)&&c.execScript&&c.execScript(\"var \"+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};goog.getObjectByName=function(a,b){for(var c=a.split(\".\"),d=b||goog.global,e;e=c.shift();)if(goog.isDefAndNotNull(d[e]))d=d[e];else return null;return d};\ngoog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};goog.addDependency=function(a,b,c){if(!COMPILED){var d;a=a.replace(/\\\\/g,\"/\");for(var e=goog.dependencies_,f=0;d=b[f];f++)e.nameToPath[d]=a,a in e.pathToNames||(e.pathToNames[a]={}),e.pathToNames[a][d]=!0;for(d=0;b=c[d];d++)a in e.requires||(e.requires[a]={}),e.requires[a][b]=!0}};goog.ENABLE_DEBUG_LOADER=!0;\ngoog.require=function(a){if(!COMPILED&&!goog.isProvided_(a)){if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b){goog.included_[b]=!0;goog.writeScripts_();return}}a=\"goog.require could not find: \"+a;goog.global.console&&goog.global.console.error(a);throw Error(a);}};goog.basePath=\"\";goog.nullFunction=function(){};goog.identityFunction=function(a){return a};goog.abstractMethod=function(){throw Error(\"unimplemented abstract method\");};\ngoog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];\n!COMPILED&&goog.ENABLE_DEBUG_LOADER&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return\"undefined\"!=typeof a&&\"write\"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName(\"script\"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf(\"?\"),d=\n-1==d?c.length:d;if(\"base.js\"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a){var b=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[a]&&b(a)&&(goog.dependencies_.written[a]=!0)},goog.writeScriptTag_=function(a){if(goog.inHtmlDocument_()){var b=goog.global.document;if(\"complete\"==b.readyState){if(/\\bdeps.js$/.test(a))return!1;throw Error('Cannot write \"'+a+'\" after document load');}b.write('<script type=\"text/javascript\" src=\"'+\na+'\">\\x3c/script>');return!0}return!1},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&(d.visited[e]=!0,e in d.requires))for(var g in d.requires[e])if(!goog.isProvided_(g))if(g in d.nameToPath)a(d.nameToPath[g]);else throw Error(\"Undefined nameToPath for \"+g);e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_,e;for(e in goog.included_)d.written[e]||a(e);for(e=0;e<b.length;e++)if(b[e])goog.importScript_(goog.basePath+b[e]);else throw Error(\"Undefined script input\");\n},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+\"deps.js\"));\ngoog.typeOf=function(a){var b=typeof a;if(\"object\"==b)if(a){if(a instanceof Array)return\"array\";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if(\"[object Window]\"==c)return\"object\";if(\"[object Array]\"==c||\"number\"==typeof a.length&&\"undefined\"!=typeof a.splice&&\"undefined\"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable(\"splice\"))return\"array\";if(\"[object Function]\"==c||\"undefined\"!=typeof a.call&&\"undefined\"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable(\"call\"))return\"function\"}else return\"null\";\nelse if(\"function\"==b&&\"undefined\"==typeof a.call)return\"object\";return b};goog.isDef=function(a){return void 0!==a};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return\"array\"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return\"array\"==b||\"object\"==b&&\"number\"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&\"function\"==typeof a.getFullYear};goog.isString=function(a){return\"string\"==typeof a};\ngoog.isBoolean=function(a){return\"boolean\"==typeof a};goog.isNumber=function(a){return\"number\"==typeof a};goog.isFunction=function(a){return\"function\"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return\"object\"==b&&null!=a||\"function\"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.removeUid=function(a){\"removeAttribute\"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};\ngoog.UID_PROPERTY_=\"closure_uid_\"+Math.floor(2147483648*Math.random()).toString(36);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if(\"object\"==b||\"array\"==b){if(a.clone)return a.clone();var b=\"array\"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};\ngoog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){goog.bind=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?goog.bindNative_:goog.bindJs_;return goog.bind.apply(null,arguments)};\ngoog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,c);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=Date.now||function(){return+new Date};\ngoog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,\"JavaScript\");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval(\"var _et_ = 1;\"),\"undefined\"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement(\"script\");c.type=\"text/javascript\";c.defer=!1;c.appendChild(b.createTextNode(a));b.body.appendChild(c);\nb.body.removeChild(c)}else throw Error(\"goog.globalEval not available\");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split(\"-\");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join(\"-\")},d=goog.cssNameMapping_?\"BY_WHOLE\"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+\"-\"+d(b):d(a)};goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};\n!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){var c=b||{},d;for(d in c){var e=(\"\"+c[d]).replace(/\\$/g,\"$$$$\");a=a.replace(RegExp(\"\\\\{\\\\$\"+d+\"\\\\}\",\"gi\"),e)}return a};goog.getMsgWithFallback=function(a){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};\ngoog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a};\ngoog.base=function(a,b,c){var d=arguments.callee.caller;if(d.superClass_)return d.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var e=Array.prototype.slice.call(arguments,2),f=!1,g=a.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error(\"goog.base called from a method of one name to a method of a different name\");};\ngoog.scope=function(a){a.call(goog.global)};goog.string={};goog.string.StringBuffer=function(a,b){null!=a&&this.append.apply(this,arguments)};goog.string.StringBuffer.prototype.buffer_=\"\";goog.string.StringBuffer.prototype.set=function(a){this.buffer_=\"\"+a};goog.string.StringBuffer.prototype.append=function(a,b,c){this.buffer_+=a;if(null!=b)for(var d=1;d<arguments.length;d++)this.buffer_+=arguments[d];return this};goog.string.StringBuffer.prototype.clear=function(){this.buffer_=\"\"};goog.string.StringBuffer.prototype.getLength=function(){return this.buffer_.length};\ngoog.string.StringBuffer.prototype.toString=function(){return this.buffer_};goog.debug={};goog.debug.Error=function(a){Error.captureStackTrace?Error.captureStackTrace(this,goog.debug.Error):this.stack=Error().stack||\"\";a&&(this.message=String(a))};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name=\"CustomError\";goog.string.Unicode={NBSP:\"\\u00a0\"};goog.string.startsWith=function(a,b){return 0==a.lastIndexOf(b,0)};goog.string.endsWith=function(a,b){var c=a.length-b.length;return 0<=c&&a.indexOf(b,c)==c};goog.string.caseInsensitiveStartsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(0,b.length))};goog.string.caseInsensitiveEndsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(a.length-b.length,b.length))};\ngoog.string.subs=function(a,b){for(var c=1;c<arguments.length;c++){var d=String(arguments[c]).replace(/\\$/g,\"$$$$\");a=a.replace(/\\%s/,d)}return a};goog.string.collapseWhitespace=function(a){return a.replace(/[\\s\\xa0]+/g,\" \").replace(/^\\s+|\\s+$/g,\"\")};goog.string.isEmpty=function(a){return/^[\\s\\xa0]*$/.test(a)};goog.string.isEmptySafe=function(a){return goog.string.isEmpty(goog.string.makeSafe(a))};goog.string.isBreakingWhitespace=function(a){return!/[^\\t\\n\\r ]/.test(a)};goog.string.isAlpha=function(a){return!/[^a-zA-Z]/.test(a)};\ngoog.string.isNumeric=function(a){return!/[^0-9]/.test(a)};goog.string.isAlphaNumeric=function(a){return!/[^a-zA-Z0-9]/.test(a)};goog.string.isSpace=function(a){return\" \"==a};goog.string.isUnicodeChar=function(a){return 1==a.length&&\" \"<=a&&\"~\">=a||\"\\u0080\"<=a&&\"\\ufffd\">=a};goog.string.stripNewlines=function(a){return a.replace(/(\\r\\n|\\r|\\n)+/g,\" \")};goog.string.canonicalizeNewlines=function(a){return a.replace(/(\\r\\n|\\r|\\n)/g,\"\\n\")};\ngoog.string.normalizeWhitespace=function(a){return a.replace(/\\xa0|\\s/g,\" \")};goog.string.normalizeSpaces=function(a){return a.replace(/\\xa0|[ \\t]+/g,\" \")};goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\\t\\r\\n ]+/g,\" \").replace(/^[\\t\\r\\n ]+|[\\t\\r\\n ]+$/g,\"\")};goog.string.trim=function(a){return a.replace(/^[\\s\\xa0]+|[\\s\\xa0]+$/g,\"\")};goog.string.trimLeft=function(a){return a.replace(/^[\\s\\xa0]+/,\"\")};goog.string.trimRight=function(a){return a.replace(/[\\s\\xa0]+$/,\"\")};\ngoog.string.caseInsensitiveCompare=function(a,b){var c=String(a).toLowerCase(),d=String(b).toLowerCase();return c<d?-1:c==d?0:1};goog.string.numerateCompareRegExp_=/(\\.\\d+)|(\\d+)|(\\D+)/g;\ngoog.string.numerateCompare=function(a,b){if(a==b)return 0;if(!a)return-1;if(!b)return 1;for(var c=a.toLowerCase().match(goog.string.numerateCompareRegExp_),d=b.toLowerCase().match(goog.string.numerateCompareRegExp_),e=Math.min(c.length,d.length),f=0;f<e;f++){var g=c[f],h=d[f];if(g!=h)return c=parseInt(g,10),!isNaN(c)&&(d=parseInt(h,10),!isNaN(d)&&c-d)?c-d:g<h?-1:1}return c.length!=d.length?c.length-d.length:a<b?-1:1};goog.string.urlEncode=function(a){return encodeURIComponent(String(a))};\ngoog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\\+/g,\" \"))};goog.string.newLineToBr=function(a,b){return a.replace(/(\\r\\n|\\r|\\n)/g,b?\"<br />\":\"<br>\")};\ngoog.string.htmlEscape=function(a,b){if(b)return a.replace(goog.string.amperRe_,\"&amp;\").replace(goog.string.ltRe_,\"&lt;\").replace(goog.string.gtRe_,\"&gt;\").replace(goog.string.quotRe_,\"&quot;\");if(!goog.string.allRe_.test(a))return a;-1!=a.indexOf(\"&\")&&(a=a.replace(goog.string.amperRe_,\"&amp;\"));-1!=a.indexOf(\"<\")&&(a=a.replace(goog.string.ltRe_,\"&lt;\"));-1!=a.indexOf(\">\")&&(a=a.replace(goog.string.gtRe_,\"&gt;\"));-1!=a.indexOf('\"')&&(a=a.replace(goog.string.quotRe_,\"&quot;\"));return a};\ngoog.string.amperRe_=/&/g;goog.string.ltRe_=/</g;goog.string.gtRe_=/>/g;goog.string.quotRe_=/\\\"/g;goog.string.allRe_=/[&<>\\\"]/;goog.string.unescapeEntities=function(a){return goog.string.contains(a,\"&\")?\"document\"in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a};\ngoog.string.unescapeEntitiesUsingDom_=function(a){var b={\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"'},c=document.createElement(\"div\");return a.replace(goog.string.HTML_ENTITY_PATTERN_,function(a,e){var f=b[a];if(f)return f;if(\"#\"==e.charAt(0)){var g=Number(\"0\"+e.substr(1));isNaN(g)||(f=String.fromCharCode(g))}f||(c.innerHTML=a+\" \",f=c.firstChild.nodeValue.slice(0,-1));return b[a]=f})};\ngoog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(a,c){switch(c){case \"amp\":return\"&\";case \"lt\":return\"<\";case \"gt\":return\">\";case \"quot\":return'\"';default:if(\"#\"==c.charAt(0)){var d=Number(\"0\"+c.substr(1));if(!isNaN(d))return String.fromCharCode(d)}return a}})};goog.string.HTML_ENTITY_PATTERN_=/&([^;\\s<&]+);?/g;goog.string.whitespaceEscape=function(a,b){return goog.string.newLineToBr(a.replace(/  /g,\" &#160;\"),b)};\ngoog.string.stripQuotes=function(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a};goog.string.truncate=function(a,b,c){c&&(a=goog.string.unescapeEntities(a));a.length>b&&(a=a.substring(0,b-3)+\"...\");c&&(a=goog.string.htmlEscape(a));return a};\ngoog.string.truncateMiddle=function(a,b,c,d){c&&(a=goog.string.unescapeEntities(a));if(d&&a.length>b){d>b&&(d=b);var e=a.length-d;a=a.substring(0,b-d)+\"...\"+a.substring(e)}else a.length>b&&(d=Math.floor(b/2),e=a.length-d,a=a.substring(0,d+b%2)+\"...\"+a.substring(e));c&&(a=goog.string.htmlEscape(a));return a};goog.string.specialEscapeChars_={\"\\x00\":\"\\\\0\",\"\\b\":\"\\\\b\",\"\\f\":\"\\\\f\",\"\\n\":\"\\\\n\",\"\\r\":\"\\\\r\",\"\\t\":\"\\\\t\",\"\\x0B\":\"\\\\x0B\",'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\"};goog.string.jsEscapeCache_={\"'\":\"\\\\'\"};\ngoog.string.quote=function(a){a=String(a);if(a.quote)return a.quote();for(var b=['\"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0);b[c+1]=goog.string.specialEscapeChars_[d]||(31<e&&127>e?d:goog.string.escapeChar(d))}b.push('\"');return b.join(\"\")};goog.string.escapeString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=goog.string.escapeChar(a.charAt(c));return b.join(\"\")};\ngoog.string.escapeChar=function(a){if(a in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[a];if(a in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[a]=goog.string.specialEscapeChars_[a];var b=a,c=a.charCodeAt(0);if(31<c&&127>c)b=a;else{if(256>c){if(b=\"\\\\x\",16>c||256<c)b+=\"0\"}else b=\"\\\\u\",4096>c&&(b+=\"0\");b+=c.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[a]=b};goog.string.toMap=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=!0;return b};\ngoog.string.contains=function(a,b){return-1!=a.indexOf(b)};goog.string.countOf=function(a,b){return a&&b?a.split(b).length-1:0};goog.string.removeAt=function(a,b,c){var d=a;0<=b&&(b<a.length&&0<c)&&(d=a.substr(0,b)+a.substr(b+c,a.length-b-c));return d};goog.string.remove=function(a,b){var c=RegExp(goog.string.regExpEscape(b),\"\");return a.replace(c,\"\")};goog.string.removeAll=function(a,b){var c=RegExp(goog.string.regExpEscape(b),\"g\");return a.replace(c,\"\")};\ngoog.string.regExpEscape=function(a){return String(a).replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g,\"\\\\$1\").replace(/\\x08/g,\"\\\\x08\")};goog.string.repeat=function(a,b){return Array(b+1).join(a)};goog.string.padNumber=function(a,b,c){a=goog.isDef(c)?a.toFixed(c):String(a);c=a.indexOf(\".\");-1==c&&(c=a.length);return goog.string.repeat(\"0\",Math.max(0,b-c))+a};goog.string.makeSafe=function(a){return null==a?\"\":String(a)};goog.string.buildString=function(a){return Array.prototype.join.call(arguments,\"\")};\ngoog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)};\ngoog.string.compareVersions=function(a,b){for(var c=0,d=goog.string.trim(String(a)).split(\".\"),e=goog.string.trim(String(b)).split(\".\"),f=Math.max(d.length,e.length),g=0;0==c&&g<f;g++){var h=d[g]||\"\",j=e[g]||\"\",k=RegExp(\"(\\\\d*)(\\\\D*)\",\"g\"),n=RegExp(\"(\\\\d*)(\\\\D*)\",\"g\");do{var l=k.exec(h)||[\"\",\"\",\"\"],m=n.exec(j)||[\"\",\"\",\"\"];if(0==l[0].length&&0==m[0].length)break;var c=0==l[1].length?0:parseInt(l[1],10),p=0==m[1].length?0:parseInt(m[1],10),c=goog.string.compareElements_(c,p)||goog.string.compareElements_(0==\nl[2].length,0==m[2].length)||goog.string.compareElements_(l[2],m[2])}while(0==c)}return c};goog.string.compareElements_=function(a,b){return a<b?-1:a>b?1:0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(a){for(var b=0,c=0;c<a.length;++c)b=31*b+a.charCodeAt(c),b%=goog.string.HASHCODE_MAX_;return b};goog.string.uniqueStringCounter_=2147483648*Math.random()|0;goog.string.createUniqueString=function(){return\"goog_\"+goog.string.uniqueStringCounter_++};\ngoog.string.toNumber=function(a){var b=Number(a);return 0==b&&goog.string.isEmpty(a)?NaN:b};goog.string.toCamelCase=function(a){return String(a).replace(/\\-([a-z])/g,function(a,c){return c.toUpperCase()})};goog.string.toSelectorCase=function(a){return String(a).replace(/([A-Z])/g,\"-$1\").toLowerCase()};goog.string.toTitleCase=function(a,b){var c=goog.isString(b)?goog.string.regExpEscape(b):\"\\\\s\";return a.replace(RegExp(\"(^\"+(c?\"|[\"+c+\"]+\":\"\")+\")([a-z])\",\"g\"),function(a,b,c){return b+c.toUpperCase()})};\ngoog.string.parseInt=function(a){isFinite(a)&&(a=String(a));return goog.isString(a)?/^\\s*-?0x/i.test(a)?parseInt(a,16):parseInt(a,10):NaN};goog.asserts={};goog.asserts.ENABLE_ASSERTS=goog.DEBUG;goog.asserts.AssertionError=function(a,b){b.unshift(a);goog.debug.Error.call(this,goog.string.subs.apply(null,b));b.shift();this.messagePattern=a};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);goog.asserts.AssertionError.prototype.name=\"AssertionError\";goog.asserts.doAssertFailure_=function(a,b,c,d){var e=\"Assertion failed\";if(c)var e=e+(\": \"+c),f=d;else a&&(e+=\": \"+a,f=b);throw new goog.asserts.AssertionError(\"\"+e,f||[]);};\ngoog.asserts.assert=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!a&&goog.asserts.doAssertFailure_(\"\",null,b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.fail=function(a,b){if(goog.asserts.ENABLE_ASSERTS)throw new goog.asserts.AssertionError(\"Failure\"+(a?\": \"+a:\"\"),Array.prototype.slice.call(arguments,1));};\ngoog.asserts.assertNumber=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(a)&&goog.asserts.doAssertFailure_(\"Expected number but got %s: %s.\",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertString=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isString(a)&&goog.asserts.doAssertFailure_(\"Expected string but got %s: %s.\",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};\ngoog.asserts.assertFunction=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(a)&&goog.asserts.doAssertFailure_(\"Expected function but got %s: %s.\",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertObject=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isObject(a)&&goog.asserts.doAssertFailure_(\"Expected object but got %s: %s.\",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};\ngoog.asserts.assertArray=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isArray(a)&&goog.asserts.doAssertFailure_(\"Expected array but got %s: %s.\",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertBoolean=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(a)&&goog.asserts.doAssertFailure_(\"Expected boolean but got %s: %s.\",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};\ngoog.asserts.assertInstanceof=function(a,b,c,d){goog.asserts.ENABLE_ASSERTS&&!(a instanceof b)&&goog.asserts.doAssertFailure_(\"instanceof check failed.\",null,c,Array.prototype.slice.call(arguments,3));return a};goog.array={};goog.NATIVE_ARRAY_PROTOTYPES=!0;goog.array.peek=function(a){return a[a.length-1]};goog.array.ARRAY_PROTOTYPE_=Array.prototype;\ngoog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(goog.isString(a))return!goog.isString(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};\ngoog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(goog.isString(a))return!goog.isString(b)||1!=b.length?-1:a.lastIndexOf(b,c);for(;0<=c;c--)if(c in a&&a[c]===b)return c;return-1};\ngoog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(a,b,c){goog.asserts.assert(null!=a.length);goog.array.ARRAY_PROTOTYPE_.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(\"\"):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};goog.array.forEachRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(\"\"):a,d=d-1;0<=d;--d)d in e&&b.call(c,e[d],d,a)};\ngoog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(\"\"):a,h=0;h<d;h++)if(h in g){var j=g[h];b.call(c,j,h,a)&&(e[f++]=j)}return e};\ngoog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=goog.isString(a)?a.split(\"\"):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e};goog.array.reduce=function(a,b,c,d){if(a.reduce)return d?a.reduce(goog.bind(b,d),c):a.reduce(b,c);var e=c;goog.array.forEach(a,function(c,g){e=b.call(d,e,c,g,a)});return e};\ngoog.array.reduceRight=function(a,b,c,d){if(a.reduceRight)return d?a.reduceRight(goog.bind(b,d),c):a.reduceRight(b,c);var e=c;goog.array.forEachRight(a,function(c,g){e=b.call(d,e,c,g,a)});return e};\ngoog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(\"\"):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1};\ngoog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(\"\"):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};goog.array.count=function(a,b,c){var d=0;goog.array.forEach(a,function(a,f,g){b.call(c,a,f,g)&&++d},c);return d};\ngoog.array.find=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(\"\"):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1};goog.array.findRight=function(a,b,c){b=goog.array.findIndexRight(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};\ngoog.array.findIndexRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(\"\"):a,d=d-1;0<=d;d--)if(d in e&&b.call(c,e[d],d,a))return d;return-1};goog.array.contains=function(a,b){return 0<=goog.array.indexOf(a,b)};goog.array.isEmpty=function(a){return 0==a.length};goog.array.clear=function(a){if(!goog.isArray(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0};goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)};\ngoog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)};goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)};goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||0>(d=goog.array.indexOf(a,c))?a.push(b):goog.array.insertAt(a,b,d)};goog.array.remove=function(a,b){var c=goog.array.indexOf(a,b),d;(d=0<=c)&&goog.array.removeAt(a,c);return d};\ngoog.array.removeAt=function(a,b){goog.asserts.assert(null!=a.length);return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length};goog.array.removeIf=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0<=b?(goog.array.removeAt(a,b),!0):!1};goog.array.concat=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.toArray=function(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]};goog.array.clone=goog.array.toArray;\ngoog.array.extend=function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c],e;if(goog.isArray(d)||(e=goog.isArrayLike(d))&&d.hasOwnProperty(\"callee\"))a.push.apply(a,d);else if(e)for(var f=a.length,g=d.length,h=0;h<g;h++)a[f+h]=d[h];else a.push(d)}};goog.array.splice=function(a,b,c,d){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))};\ngoog.array.slice=function(a,b,c){goog.asserts.assert(null!=a.length);return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(a,b):goog.array.ARRAY_PROTOTYPE_.slice.call(a,b,c)};goog.array.removeDuplicates=function(a,b){for(var c=b||a,d={},e=0,f=0;f<a.length;){var g=a[f++],h=goog.isObject(g)?\"o\"+goog.getUid(g):(typeof g).charAt(0)+g;Object.prototype.hasOwnProperty.call(d,h)||(d[h]=!0,c[e++]=g)}c.length=e};\ngoog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,!1,b)};goog.array.binarySelect=function(a,b,c){return goog.array.binarySearch_(a,b,!0,void 0,c)};goog.array.binarySearch_=function(a,b,c,d,e){for(var f=0,g=a.length,h;f<g;){var j=f+g>>1,k;k=c?b.call(e,a[j],j,a):b(d,a[j]);0<k?f=j+1:(g=j,h=!k)}return h?f:~f};goog.array.sort=function(a,b){goog.asserts.assert(null!=a.length);goog.array.ARRAY_PROTOTYPE_.sort.call(a,b||goog.array.defaultCompare)};\ngoog.array.stableSort=function(a,b){for(var c=0;c<a.length;c++)a[c]={index:c,value:a[c]};var d=b||goog.array.defaultCompare;goog.array.sort(a,function(a,b){return d(a.value,b.value)||a.index-b.index});for(c=0;c<a.length;c++)a[c]=a[c].value};goog.array.sortObjectsByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(a[b],c[b])})};\ngoog.array.isSorted=function(a,b,c){b=b||goog.array.defaultCompare;for(var d=1;d<a.length;d++){var e=b(a[d-1],a[d]);if(0<e||0==e&&c)return!1}return!0};goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;var d=a.length;c=c||goog.array.defaultCompareEquality;for(var e=0;e<d;e++)if(!c(a[e],b[e]))return!1;return!0};goog.array.compare=function(a,b,c){return goog.array.equals(a,b,c)};\ngoog.array.compare3=function(a,b,c){c=c||goog.array.defaultCompare;for(var d=Math.min(a.length,b.length),e=0;e<d;e++){var f=c(a[e],b[e]);if(0!=f)return f}return goog.array.defaultCompare(a.length,b.length)};goog.array.defaultCompare=function(a,b){return a>b?1:a<b?-1:0};goog.array.defaultCompareEquality=function(a,b){return a===b};goog.array.binaryInsert=function(a,b,c){c=goog.array.binarySearch(a,b,c);return 0>c?(goog.array.insertAt(a,b,-(c+1)),!0):!1};\ngoog.array.binaryRemove=function(a,b,c){b=goog.array.binarySearch(a,b,c);return 0<=b?goog.array.removeAt(a,b):!1};goog.array.bucket=function(a,b){for(var c={},d=0;d<a.length;d++){var e=a[d],f=b(e,d,a);goog.isDef(f)&&(c[f]||(c[f]=[])).push(e)}return c};goog.array.toObject=function(a,b,c){var d={};goog.array.forEach(a,function(e,f){d[b.call(c,e,f,a)]=e});return d};goog.array.repeat=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=a;return c};\ngoog.array.flatten=function(a){for(var b=[],c=0;c<arguments.length;c++){var d=arguments[c];goog.isArray(d)?b.push.apply(b,goog.array.flatten.apply(null,d)):b.push(d)}return b};goog.array.rotate=function(a,b){goog.asserts.assert(null!=a.length);a.length&&(b%=a.length,0<b?goog.array.ARRAY_PROTOTYPE_.unshift.apply(a,a.splice(-b,b)):0>b&&goog.array.ARRAY_PROTOTYPE_.push.apply(a,a.splice(0,-b)));return a};\ngoog.array.zip=function(a){if(!arguments.length)return[];for(var b=[],c=0;;c++){for(var d=[],e=0;e<arguments.length;e++){var f=arguments[e];if(c>=f.length)return b;d.push(f[c])}b.push(d)}};goog.array.shuffle=function(a,b){for(var c=b||Math.random,d=a.length-1;0<d;d--){var e=Math.floor(c()*(d+1)),f=a[d];a[d]=a[e];a[e]=f}};goog.object={};goog.object.forEach=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)};goog.object.filter=function(a,b,c){var d={},e;for(e in a)b.call(c,a[e],e,a)&&(d[e]=a[e]);return d};goog.object.map=function(a,b,c){var d={},e;for(e in a)d[e]=b.call(c,a[e],e,a);return d};goog.object.some=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return!0;return!1};goog.object.every=function(a,b,c){for(var d in a)if(!b.call(c,a[d],d,a))return!1;return!0};\ngoog.object.getCount=function(a){var b=0,c;for(c in a)b++;return b};goog.object.getAnyKey=function(a){for(var b in a)return b};goog.object.getAnyValue=function(a){for(var b in a)return a[b]};goog.object.contains=function(a,b){return goog.object.containsValue(a,b)};goog.object.getValues=function(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b};goog.object.getKeys=function(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};\ngoog.object.getValueByKeys=function(a,b){for(var c=goog.isArrayLike(b),d=c?b:arguments,c=c?0:1;c<d.length&&!(a=a[d[c]],!goog.isDef(a));c++);return a};goog.object.containsKey=function(a,b){return b in a};goog.object.containsValue=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1};goog.object.findKey=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return d};goog.object.findValue=function(a,b,c){return(b=goog.object.findKey(a,b,c))&&a[b]};\ngoog.object.isEmpty=function(a){for(var b in a)return!1;return!0};goog.object.clear=function(a){for(var b in a)delete a[b]};goog.object.remove=function(a,b){var c;(c=b in a)&&delete a[b];return c};goog.object.add=function(a,b,c){if(b in a)throw Error('The object already contains the key \"'+b+'\"');goog.object.set(a,b,c)};goog.object.get=function(a,b,c){return b in a?a[b]:c};goog.object.set=function(a,b,c){a[b]=c};goog.object.setIfUndefined=function(a,b,c){return b in a?a[b]:a[b]=c};\ngoog.object.clone=function(a){var b={},c;for(c in a)b[c]=a[c];return b};goog.object.unsafeClone=function(a){var b=goog.typeOf(a);if(\"object\"==b||\"array\"==b){if(a.clone)return a.clone();var b=\"array\"==b?[]:{},c;for(c in a)b[c]=goog.object.unsafeClone(a[c]);return b}return a};goog.object.transpose=function(a){var b={},c;for(c in a)b[a[c]]=c;return b};goog.object.PROTOTYPE_FIELDS_=\"constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf\".split(\" \");\ngoog.object.extend=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<goog.object.PROTOTYPE_FIELDS_.length;f++)c=goog.object.PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};\ngoog.object.create=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(b%2)throw Error(\"Uneven number of arguments\");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c};goog.object.createSet=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};\ngoog.object.createImmutableView=function(a){var b=a;Object.isFrozen&&!Object.isFrozen(a)&&(b=Object.create(a),Object.freeze(b));return b};goog.object.isImmutableView=function(a){return!!Object.isFrozen&&Object.isFrozen(a)};goog.proto2={};goog.proto2.Util={};goog.proto2.Util.PBCHECK=!COMPILED;goog.proto2.Util.assert=function(a,b){goog.proto2.Util.PBCHECK&&goog.asserts.assert(a,b)};goog.proto2.Util.conductChecks=function(){return goog.proto2.Util.PBCHECK};goog.proto2.Descriptor=function(a,b,c){this.messageType_=a;this.name_=b.name||null;this.fullName_=b.fullName||null;this.containingType_=b.containingType;this.fields_={};for(a=0;a<c.length;a++)b=c[a],this.fields_[b.getTag()]=b};goog.proto2.Descriptor.prototype.getName=function(){return this.name_};goog.proto2.Descriptor.prototype.getFullName=function(){return this.fullName_};goog.proto2.Descriptor.prototype.getContainingType=function(){return!this.containingType_?null:this.containingType_.getDescriptor()};\ngoog.proto2.Descriptor.prototype.getFields=function(){var a=goog.object.getValues(this.fields_);goog.array.sort(a,function(a,c){return a.getTag()-c.getTag()});return a};goog.proto2.Descriptor.prototype.getFieldsMap=function(){return this.fields_};goog.proto2.Descriptor.prototype.findFieldByName=function(a){return goog.object.findValue(this.fields_,function(b){return b.getName()==a})||null};\ngoog.proto2.Descriptor.prototype.findFieldByTag=function(a){goog.proto2.Util.assert(goog.string.isNumeric(a));return this.fields_[parseInt(a,10)]||null};goog.proto2.Descriptor.prototype.createMessageInstance=function(){return new this.messageType_};goog.proto2.FieldDescriptor=function(a,b,c){this.parent_=a;goog.proto2.Util.assert(goog.string.isNumeric(b));this.tag_=b;this.name_=c.name;this.isRepeated_=!!c.repeated;this.isRequired_=!!c.required;this.fieldType_=c.fieldType;this.nativeType_=c.type;this.deserializationConversionPermitted_=!1;switch(this.fieldType_){case goog.proto2.FieldDescriptor.FieldType.INT64:case goog.proto2.FieldDescriptor.FieldType.UINT64:case goog.proto2.FieldDescriptor.FieldType.FIXED64:case goog.proto2.FieldDescriptor.FieldType.SFIXED64:case goog.proto2.FieldDescriptor.FieldType.SINT64:this.deserializationConversionPermitted_=\n!0}this.defaultValue_=c.defaultValue};goog.proto2.FieldDescriptor.FieldType={DOUBLE:1,FLOAT:2,INT64:3,UINT64:4,INT32:5,FIXED64:6,FIXED32:7,BOOL:8,STRING:9,GROUP:10,MESSAGE:11,BYTES:12,UINT32:13,ENUM:14,SFIXED32:15,SFIXED64:16,SINT32:17,SINT64:18};goog.proto2.FieldDescriptor.prototype.getTag=function(){return this.tag_};goog.proto2.FieldDescriptor.prototype.getContainingType=function(){return this.parent_.getDescriptor()};goog.proto2.FieldDescriptor.prototype.getName=function(){return this.name_};\ngoog.proto2.FieldDescriptor.prototype.getDefaultValue=function(){if(void 0===this.defaultValue_){var a=this.nativeType_;this.defaultValue_=a===Boolean?!1:a===Number?0:a===String?\"\":new a}return this.defaultValue_};goog.proto2.FieldDescriptor.prototype.getFieldType=function(){return this.fieldType_};goog.proto2.FieldDescriptor.prototype.getNativeType=function(){return this.nativeType_};goog.proto2.FieldDescriptor.prototype.deserializationConversionPermitted=function(){return this.deserializationConversionPermitted_};\ngoog.proto2.FieldDescriptor.prototype.getFieldMessageType=function(){goog.proto2.Util.assert(this.isCompositeType(),\"Expected message or group\");return this.nativeType_.getDescriptor()};goog.proto2.FieldDescriptor.prototype.isCompositeType=function(){return this.fieldType_==goog.proto2.FieldDescriptor.FieldType.MESSAGE||this.fieldType_==goog.proto2.FieldDescriptor.FieldType.GROUP};goog.proto2.FieldDescriptor.prototype.isRepeated=function(){return this.isRepeated_};\ngoog.proto2.FieldDescriptor.prototype.isRequired=function(){return this.isRequired_};goog.proto2.FieldDescriptor.prototype.isOptional=function(){return!this.isRepeated_&&!this.isRequired_};goog.proto2.Message=function(){this.values_={};this.fields_=this.getDescriptor().getFieldsMap();this.deserializedFields_=this.lazyDeserializer_=null};goog.proto2.Message.FieldType={DOUBLE:1,FLOAT:2,INT64:3,UINT64:4,INT32:5,FIXED64:6,FIXED32:7,BOOL:8,STRING:9,GROUP:10,MESSAGE:11,BYTES:12,UINT32:13,ENUM:14,SFIXED32:15,SFIXED64:16,SINT32:17,SINT64:18};goog.proto2.Message.prototype.initializeForLazyDeserializer=function(a,b){this.lazyDeserializer_=a;this.values_=b;this.deserializedFields_={}};\ngoog.proto2.Message.prototype.setUnknown=function(a,b){goog.proto2.Util.assert(!this.fields_[a],\"Field is not unknown in this message\");goog.proto2.Util.assert(1<=a,\"Tag is not valid\");goog.proto2.Util.assert(null!==b,\"Value cannot be null\");this.values_[a]=b;this.deserializedFields_&&delete this.deserializedFields_[a]};goog.proto2.Message.prototype.forEachUnknown=function(a,b){var c=b||this,d;for(d in this.values_)this.fields_[d]||a.call(c,Number(d),this.values_[d])};\ngoog.proto2.Message.prototype.getDescriptor=function(){var a=this.constructor;return a.descriptor_||(a.descriptor_=goog.proto2.Message.create$Descriptor(a,a.descriptorObj_))};goog.proto2.Message.prototype.has=function(a){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");return this.has$Value(a.getTag())};\ngoog.proto2.Message.prototype.arrayOf=function(a){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");return this.array$Values(a.getTag())};goog.proto2.Message.prototype.countOf=function(a){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");return this.count$Values(a.getTag())};\ngoog.proto2.Message.prototype.get=function(a,b){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");return this.get$Value(a.getTag(),b)};goog.proto2.Message.prototype.getOrDefault=function(a,b){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");return this.get$ValueOrDefault(a.getTag(),b)};\ngoog.proto2.Message.prototype.set=function(a,b){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");this.set$Value(a.getTag(),b)};goog.proto2.Message.prototype.add=function(a,b){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");this.add$Value(a.getTag(),b)};\ngoog.proto2.Message.prototype.clear=function(a){goog.proto2.Util.assert(a.getContainingType()==this.getDescriptor(),\"The current message does not contain the given field\");this.clear$Field(a.getTag())};\ngoog.proto2.Message.prototype.equals=function(a){if(!a||this.constructor!=a.constructor)return!1;for(var b=this.getDescriptor().getFields(),c=0;c<b.length;c++){var d=b[c];if(this.has(d)!=a.has(d))return!1;if(this.has(d)){var e=d.isCompositeType(),f=this.getValueForField_(d),g=a.getValueForField_(d);if(d.isRepeated()){if(f.length!=g.length)return!1;for(d=0;d<f.length;d++)if(!(e?f[d].equals(g[d]):f[d]==g[d]))return!1}else if(!(e?f.equals(g):f==g))return!1}}return!0};\ngoog.proto2.Message.prototype.copyFrom=function(a){goog.proto2.Util.assert(this.constructor==a.constructor,\"The source message must have the same type.\");this!=a&&(this.values_={},this.deserializedFields_&&(this.deserializedFields_={}),this.mergeFrom(a))};\ngoog.proto2.Message.prototype.mergeFrom=function(a){goog.proto2.Util.assert(this.constructor==a.constructor,\"The source message must have the same type.\");for(var b=this.getDescriptor().getFields(),c=0;c<b.length;c++){var d=b[c];if(a.has(d)){this.deserializedFields_&&delete this.deserializedFields_[d.getTag()];var e=d.isCompositeType();if(d.isRepeated())for(var f=a.arrayOf(d),g=0;g<f.length;g++)this.add(d,e?f[g].clone():f[g]);else f=a.getValueForField_(d),e?(e=this.getValueForField_(d))?e.mergeFrom(f):\nthis.set(d,f.clone()):this.set(d,f)}}};goog.proto2.Message.prototype.clone=function(){var a=new this.constructor;a.copyFrom(this);return a};goog.proto2.Message.prototype.initDefaults=function(a){for(var b=this.getDescriptor().getFields(),c=0;c<b.length;c++){var d=b[c],e=d.getTag(),f=d.isCompositeType();!this.has(d)&&!d.isRepeated()&&(f?this.values_[e]=new (d.getNativeType()):a&&(this.values_[e]=d.getDefaultValue()));if(f)if(d.isRepeated()){d=this.array$Values(e);for(e=0;e<d.length;e++)d[e].initDefaults(a)}else this.get$Value(e).initDefaults(a)}};\ngoog.proto2.Message.prototype.getFieldByTag_=function(a){goog.proto2.Util.assert(this.fields_[a],\"No field found for the given tag\");return this.fields_[a]};goog.proto2.Message.prototype.has$Value=function(a){goog.proto2.Util.assert(this.fields_[a],\"No field found for the given tag\");return a in this.values_&&goog.isDef(this.values_[a])&&null!==this.values_[a]};\ngoog.proto2.Message.prototype.getValueForField_=function(a){var b=a.getTag();if(!b in this.values_)return null;var c=this.values_[b];return null==c?null:this.lazyDeserializer_?!(b in this.deserializedFields_)?(a=this.lazyDeserializer_.deserializeField(this,a,c),this.deserializedFields_[b]=a):this.deserializedFields_[b]:c};\ngoog.proto2.Message.prototype.get$Value=function(a,b){var c=this.getFieldByTag_(a),d=this.getValueForField_(c);if(c.isRepeated())return goog.proto2.Util.assert(goog.isArray(d)),c=b||0,goog.proto2.Util.assert(0<=c&&c<d.length,\"Given index is out of bounds\"),d[c];goog.proto2.Util.assert(!goog.isArray(d));return d};goog.proto2.Message.prototype.get$ValueOrDefault=function(a,b){return!this.has$Value(a)?this.getFieldByTag_(a).getDefaultValue():this.get$Value(a,b)};\ngoog.proto2.Message.prototype.array$Values=function(a){goog.proto2.Util.assert(this.getFieldByTag_(a).isRepeated(),\"Cannot call fieldArray on a non-repeated field\");a=this.getFieldByTag_(a);a=this.getValueForField_(a);goog.proto2.Util.assert(null==a||goog.isArray(a));return a||[]};\ngoog.proto2.Message.prototype.count$Values=function(a){return this.getFieldByTag_(a).isRepeated()?(this.has$Value(a)&&goog.proto2.Util.assert(goog.isArray(this.values_[a])),this.has$Value(a)?this.values_[a].length:0):this.has$Value(a)?1:0};\ngoog.proto2.Message.prototype.set$Value=function(a,b){if(goog.proto2.Util.conductChecks()){var c=this.getFieldByTag_(a);goog.proto2.Util.assert(!c.isRepeated(),\"Cannot call set on a repeated field\");this.checkFieldType_(c,b)}this.values_[a]=b;this.deserializedFields_&&(this.deserializedFields_[a]=b)};\ngoog.proto2.Message.prototype.add$Value=function(a,b){if(goog.proto2.Util.conductChecks()){var c=this.getFieldByTag_(a);goog.proto2.Util.assert(c.isRepeated(),\"Cannot call add on a non-repeated field\");this.checkFieldType_(c,b)}this.values_[a]||(this.values_[a]=[]);this.values_[a].push(b);this.deserializedFields_&&delete this.deserializedFields_[a]};\ngoog.proto2.Message.prototype.checkFieldType_=function(a,b){goog.proto2.Util.assert(null!==b);var c=a.getNativeType();c===String?goog.proto2.Util.assert(\"string\"===typeof b,\"Expected value of type string\"):c===Boolean?goog.proto2.Util.assert(\"boolean\"===typeof b,\"Expected value of type boolean\"):c===Number?goog.proto2.Util.assert(\"number\"===typeof b,\"Expected value of type number\"):a.getFieldType()==goog.proto2.FieldDescriptor.FieldType.ENUM?goog.proto2.Util.assert(\"number\"===typeof b,\"Expected an enum value, which is a number\"):\ngoog.proto2.Util.assert(b instanceof c,\"Expected a matching message type\")};goog.proto2.Message.prototype.clear$Field=function(a){goog.proto2.Util.assert(this.getFieldByTag_(a),\"Unknown field\");delete this.values_[a];this.deserializedFields_&&delete this.deserializedFields_[a]};\ngoog.proto2.Message.create$Descriptor=function(a,b){var c=[],d,e;for(e in b)b.hasOwnProperty(e)&&(goog.proto2.Util.assert(goog.string.isNumeric(e),\"Keys must be numeric\"),0==e?d=b[0]:c.push(new goog.proto2.FieldDescriptor(a,e,b[e])));goog.proto2.Util.assert(d);return new goog.proto2.Descriptor(a,d,c)};goog.proto2.Message.set$Metadata=function(a,b){a.descriptorObj_=b;a.getDescriptor=function(){return a.descriptor_||(new a).getDescriptor()}};goog.proto2.Serializer=function(){};goog.proto2.Serializer.prototype.getSerializedValue=function(a,b){return a.isCompositeType()?this.serialize(b):b};goog.proto2.Serializer.prototype.deserialize=function(a,b){var c=a.createMessageInstance();this.deserializeTo(c,b);goog.proto2.Util.assert(c instanceof goog.proto2.Message);return c};\ngoog.proto2.Serializer.prototype.getDeserializedValue=function(a,b){if(a.isCompositeType())return b instanceof goog.proto2.Message?b:this.deserialize(a.getFieldMessageType(),b);if(!a.deserializationConversionPermitted())return b;var c=a.getNativeType();if(c===String){if(\"number\"===typeof b)return String(b)}else if(c===Number&&\"string\"===typeof b&&/^-?[0-9]+$/.test(b))return Number(b);return b};goog.proto2.LazyDeserializer=function(){};goog.inherits(goog.proto2.LazyDeserializer,goog.proto2.Serializer);goog.proto2.LazyDeserializer.prototype.deserialize=function(a,b){var c=a.createMessageInstance();c.initializeForLazyDeserializer(this,b);goog.proto2.Util.assert(c instanceof goog.proto2.Message);return c};goog.proto2.LazyDeserializer.prototype.deserializeTo=function(){throw Error(\"Unimplemented\");};goog.proto2.PbLiteSerializer=function(){};goog.inherits(goog.proto2.PbLiteSerializer,goog.proto2.LazyDeserializer);goog.proto2.PbLiteSerializer.prototype.zeroIndexing_=!1;goog.proto2.PbLiteSerializer.prototype.setZeroIndexed=function(a){this.zeroIndexing_=a};\ngoog.proto2.PbLiteSerializer.prototype.serialize=function(a){for(var b=a.getDescriptor().getFields(),c=[],d=this.zeroIndexing_,e=0;e<b.length;e++){var f=b[e];if(a.has(f)){var g=f.getTag(),g=d?g-1:g;if(f.isRepeated()){c[g]=[];for(var h=0;h<a.countOf(f);h++)c[g][h]=this.getSerializedValue(f,a.get(f,h))}else c[g]=this.getSerializedValue(f,a.get(f))}}a.forEachUnknown(function(a,b){c[d?a-1:a]=b});return c};\ngoog.proto2.PbLiteSerializer.prototype.deserializeField=function(a,b,c){if(null==c)return c;if(b.isRepeated()){a=[];goog.proto2.Util.assert(goog.isArray(c));for(var d=0;d<c.length;d++)a[d]=this.getDeserializedValue(b,c[d]);return a}return this.getDeserializedValue(b,c)};goog.proto2.PbLiteSerializer.prototype.getSerializedValue=function(a,b){return a.getFieldType()==goog.proto2.FieldDescriptor.FieldType.BOOL?b?1:0:goog.proto2.Serializer.prototype.getSerializedValue.apply(this,arguments)};\ngoog.proto2.PbLiteSerializer.prototype.getDeserializedValue=function(a,b){return a.getFieldType()==goog.proto2.FieldDescriptor.FieldType.BOOL?1===b:goog.proto2.Serializer.prototype.getDeserializedValue.apply(this,arguments)};goog.proto2.PbLiteSerializer.prototype.deserialize=function(a,b){var c=b;if(this.zeroIndexing_){var c=[],d;for(d in b)c[parseInt(d,10)+1]=b[d]}return goog.proto2.PbLiteSerializer.superClass_.deserialize.call(this,a,c)};goog.userAgent={};goog.userAgent.ASSUME_IE=!1;goog.userAgent.ASSUME_GECKO=!1;goog.userAgent.ASSUME_WEBKIT=!1;goog.userAgent.ASSUME_MOBILE_WEBKIT=!1;goog.userAgent.ASSUME_OPERA=!1;goog.userAgent.ASSUME_ANY_VERSION=!1;goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA;\ngoog.userAgent.getUserAgentString=function(){return goog.global.navigator?goog.global.navigator.userAgent:null};goog.userAgent.getNavigator=function(){return goog.global.navigator};\ngoog.userAgent.init_=function(){goog.userAgent.detectedOpera_=!1;goog.userAgent.detectedIe_=!1;goog.userAgent.detectedWebkit_=!1;goog.userAgent.detectedMobile_=!1;goog.userAgent.detectedGecko_=!1;var a;if(!goog.userAgent.BROWSER_KNOWN_&&(a=goog.userAgent.getUserAgentString())){var b=goog.userAgent.getNavigator();goog.userAgent.detectedOpera_=0==a.indexOf(\"Opera\");goog.userAgent.detectedIe_=!goog.userAgent.detectedOpera_&&-1!=a.indexOf(\"MSIE\");goog.userAgent.detectedWebkit_=!goog.userAgent.detectedOpera_&&\n-1!=a.indexOf(\"WebKit\");goog.userAgent.detectedMobile_=goog.userAgent.detectedWebkit_&&-1!=a.indexOf(\"Mobile\");goog.userAgent.detectedGecko_=!goog.userAgent.detectedOpera_&&!goog.userAgent.detectedWebkit_&&\"Gecko\"==b.product}};goog.userAgent.BROWSER_KNOWN_||goog.userAgent.init_();goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.userAgent.detectedOpera_;goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.userAgent.detectedIe_;\ngoog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.userAgent.detectedGecko_;goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.userAgent.detectedWebkit_;goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.detectedMobile_;goog.userAgent.SAFARI=goog.userAgent.WEBKIT;goog.userAgent.determinePlatform_=function(){var a=goog.userAgent.getNavigator();return a&&a.platform||\"\"};\ngoog.userAgent.PLATFORM=goog.userAgent.determinePlatform_();goog.userAgent.ASSUME_MAC=!1;goog.userAgent.ASSUME_WINDOWS=!1;goog.userAgent.ASSUME_LINUX=!1;goog.userAgent.ASSUME_X11=!1;goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11;\ngoog.userAgent.initPlatform_=function(){goog.userAgent.detectedMac_=goog.string.contains(goog.userAgent.PLATFORM,\"Mac\");goog.userAgent.detectedWindows_=goog.string.contains(goog.userAgent.PLATFORM,\"Win\");goog.userAgent.detectedLinux_=goog.string.contains(goog.userAgent.PLATFORM,\"Linux\");goog.userAgent.detectedX11_=!!goog.userAgent.getNavigator()&&goog.string.contains(goog.userAgent.getNavigator().appVersion||\"\",\"X11\")};goog.userAgent.PLATFORM_KNOWN_||goog.userAgent.initPlatform_();\ngoog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.userAgent.detectedMac_;goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.userAgent.detectedWindows_;goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.detectedLinux_;goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.detectedX11_;\ngoog.userAgent.determineVersion_=function(){var a=\"\",b;goog.userAgent.OPERA&&goog.global.opera?(a=goog.global.opera.version,a=\"function\"==typeof a?a():a):(goog.userAgent.GECKO?b=/rv\\:([^\\);]+)(\\)|;)/:goog.userAgent.IE?b=/MSIE\\s+([^\\);]+)(\\)|;)/:goog.userAgent.WEBKIT&&(b=/WebKit\\/(\\S+)/),b&&(a=(a=b.exec(goog.userAgent.getUserAgentString()))?a[1]:\"\"));return goog.userAgent.IE&&(b=goog.userAgent.getDocumentMode_(),b>parseFloat(a))?String(b):a};\ngoog.userAgent.getDocumentMode_=function(){var a=goog.global.document;return a?a.documentMode:void 0};goog.userAgent.VERSION=goog.userAgent.determineVersion_();goog.userAgent.compare=function(a,b){return goog.string.compareVersions(a,b)};goog.userAgent.isVersionCache_={};goog.userAgent.isVersion=function(a){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionCache_[a]||(goog.userAgent.isVersionCache_[a]=0<=goog.string.compareVersions(goog.userAgent.VERSION,a))};\ngoog.userAgent.isDocumentMode=function(a){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=a};goog.userAgent.DOCUMENT_MODE=function(){var a=goog.global.document;return!a||!goog.userAgent.IE?void 0:goog.userAgent.getDocumentMode_()||(\"CSS1Compat\"==a.compatMode?parseInt(goog.userAgent.VERSION,10):5)}();goog.dom={};goog.dom.BrowserFeature={CAN_ADD_NAME_OR_TYPE_ATTRIBUTES:!goog.userAgent.IE||goog.userAgent.isDocumentMode(9),CAN_USE_CHILDREN_ATTRIBUTE:!goog.userAgent.GECKO&&!goog.userAgent.IE||goog.userAgent.IE&&goog.userAgent.isDocumentMode(9)||goog.userAgent.GECKO&&goog.userAgent.isVersion(\"1.9.1\"),CAN_USE_INNER_TEXT:goog.userAgent.IE&&!goog.userAgent.isVersion(\"9\"),CAN_USE_PARENT_ELEMENT_PROPERTY:goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.WEBKIT,INNER_HTML_NEEDS_SCOPED_ELEMENT:goog.userAgent.IE};goog.dom.TagName={A:\"A\",ABBR:\"ABBR\",ACRONYM:\"ACRONYM\",ADDRESS:\"ADDRESS\",APPLET:\"APPLET\",AREA:\"AREA\",ARTICLE:\"ARTICLE\",ASIDE:\"ASIDE\",AUDIO:\"AUDIO\",B:\"B\",BASE:\"BASE\",BASEFONT:\"BASEFONT\",BDI:\"BDI\",BDO:\"BDO\",BIG:\"BIG\",BLOCKQUOTE:\"BLOCKQUOTE\",BODY:\"BODY\",BR:\"BR\",BUTTON:\"BUTTON\",CANVAS:\"CANVAS\",CAPTION:\"CAPTION\",CENTER:\"CENTER\",CITE:\"CITE\",CODE:\"CODE\",COL:\"COL\",COLGROUP:\"COLGROUP\",COMMAND:\"COMMAND\",DATA:\"DATA\",DATALIST:\"DATALIST\",DD:\"DD\",DEL:\"DEL\",DETAILS:\"DETAILS\",DFN:\"DFN\",DIALOG:\"DIALOG\",DIR:\"DIR\",DIV:\"DIV\",\nDL:\"DL\",DT:\"DT\",EM:\"EM\",EMBED:\"EMBED\",FIELDSET:\"FIELDSET\",FIGCAPTION:\"FIGCAPTION\",FIGURE:\"FIGURE\",FONT:\"FONT\",FOOTER:\"FOOTER\",FORM:\"FORM\",FRAME:\"FRAME\",FRAMESET:\"FRAMESET\",H1:\"H1\",H2:\"H2\",H3:\"H3\",H4:\"H4\",H5:\"H5\",H6:\"H6\",HEAD:\"HEAD\",HEADER:\"HEADER\",HGROUP:\"HGROUP\",HR:\"HR\",HTML:\"HTML\",I:\"I\",IFRAME:\"IFRAME\",IMG:\"IMG\",INPUT:\"INPUT\",INS:\"INS\",ISINDEX:\"ISINDEX\",KBD:\"KBD\",KEYGEN:\"KEYGEN\",LABEL:\"LABEL\",LEGEND:\"LEGEND\",LI:\"LI\",LINK:\"LINK\",MAP:\"MAP\",MARK:\"MARK\",MATH:\"MATH\",MENU:\"MENU\",META:\"META\",METER:\"METER\",\nNAV:\"NAV\",NOFRAMES:\"NOFRAMES\",NOSCRIPT:\"NOSCRIPT\",OBJECT:\"OBJECT\",OL:\"OL\",OPTGROUP:\"OPTGROUP\",OPTION:\"OPTION\",OUTPUT:\"OUTPUT\",P:\"P\",PARAM:\"PARAM\",PRE:\"PRE\",PROGRESS:\"PROGRESS\",Q:\"Q\",RP:\"RP\",RT:\"RT\",RUBY:\"RUBY\",S:\"S\",SAMP:\"SAMP\",SCRIPT:\"SCRIPT\",SECTION:\"SECTION\",SELECT:\"SELECT\",SMALL:\"SMALL\",SOURCE:\"SOURCE\",SPAN:\"SPAN\",STRIKE:\"STRIKE\",STRONG:\"STRONG\",STYLE:\"STYLE\",SUB:\"SUB\",SUMMARY:\"SUMMARY\",SUP:\"SUP\",SVG:\"SVG\",TABLE:\"TABLE\",TBODY:\"TBODY\",TD:\"TD\",TEXTAREA:\"TEXTAREA\",TFOOT:\"TFOOT\",TH:\"TH\",THEAD:\"THEAD\",\nTIME:\"TIME\",TITLE:\"TITLE\",TR:\"TR\",TRACK:\"TRACK\",TT:\"TT\",U:\"U\",UL:\"UL\",VAR:\"VAR\",VIDEO:\"VIDEO\",WBR:\"WBR\"};goog.dom.classes={};goog.dom.classes.set=function(a,b){a.className=b};goog.dom.classes.get=function(a){a=a.className;return goog.isString(a)&&a.match(/\\S+/g)||[]};goog.dom.classes.add=function(a,b){var c=goog.dom.classes.get(a),d=goog.array.slice(arguments,1),e=c.length+d.length;goog.dom.classes.add_(c,d);a.className=c.join(\" \");return c.length==e};\ngoog.dom.classes.remove=function(a,b){var c=goog.dom.classes.get(a),d=goog.array.slice(arguments,1),e=goog.dom.classes.getDifference_(c,d);a.className=e.join(\" \");return e.length==c.length-d.length};goog.dom.classes.add_=function(a,b){for(var c=0;c<b.length;c++)goog.array.contains(a,b[c])||a.push(b[c])};goog.dom.classes.getDifference_=function(a,b){return goog.array.filter(a,function(a){return!goog.array.contains(b,a)})};\ngoog.dom.classes.swap=function(a,b,c){for(var d=goog.dom.classes.get(a),e=!1,f=0;f<d.length;f++)d[f]==b&&(goog.array.splice(d,f--,1),e=!0);e&&(d.push(c),a.className=d.join(\" \"));return e};goog.dom.classes.addRemove=function(a,b,c){var d=goog.dom.classes.get(a);goog.isString(b)?goog.array.remove(d,b):goog.isArray(b)&&(d=goog.dom.classes.getDifference_(d,b));goog.isString(c)&&!goog.array.contains(d,c)?d.push(c):goog.isArray(c)&&goog.dom.classes.add_(d,c);a.className=d.join(\" \")};\ngoog.dom.classes.has=function(a,b){return goog.array.contains(goog.dom.classes.get(a),b)};goog.dom.classes.enable=function(a,b,c){c?goog.dom.classes.add(a,b):goog.dom.classes.remove(a,b)};goog.dom.classes.toggle=function(a,b){var c=!goog.dom.classes.has(a,b);goog.dom.classes.enable(a,b,c);return c};goog.math={};goog.math.randomInt=function(a){return Math.floor(Math.random()*a)};goog.math.uniformRandom=function(a,b){return a+Math.random()*(b-a)};goog.math.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};goog.math.modulo=function(a,b){var c=a%b;return 0>c*b?c+b:c};goog.math.lerp=function(a,b,c){return a+c*(b-a)};goog.math.nearlyEquals=function(a,b,c){return Math.abs(a-b)<=(c||1E-6)};goog.math.standardAngle=function(a){return goog.math.modulo(a,360)};\ngoog.math.toRadians=function(a){return a*Math.PI/180};goog.math.toDegrees=function(a){return 180*a/Math.PI};goog.math.angleDx=function(a,b){return b*Math.cos(goog.math.toRadians(a))};goog.math.angleDy=function(a,b){return b*Math.sin(goog.math.toRadians(a))};goog.math.angle=function(a,b,c,d){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(d-b,c-a)))};goog.math.angleDifference=function(a,b){var c=goog.math.standardAngle(b)-goog.math.standardAngle(a);180<c?c-=360:-180>=c&&(c=360+c);return c};\ngoog.math.sign=function(a){return 0==a?0:0>a?-1:1};goog.math.longestCommonSubsequence=function(a,b,c,d){c=c||function(a,b){return a==b};d=d||function(b){return a[b]};for(var e=a.length,f=b.length,g=[],h=0;h<e+1;h++)g[h]=[],g[h][0]=0;for(var j=0;j<f+1;j++)g[0][j]=0;for(h=1;h<=e;h++)for(j=1;j<=e;j++)g[h][j]=c(a[h-1],b[j-1])?g[h-1][j-1]+1:Math.max(g[h-1][j],g[h][j-1]);for(var k=[],h=e,j=f;0<h&&0<j;)c(a[h-1],b[j-1])?(k.unshift(d(h-1,j-1)),h--,j--):g[h-1][j]>g[h][j-1]?h--:j--;return k};\ngoog.math.sum=function(a){return goog.array.reduce(arguments,function(a,c){return a+c},0)};goog.math.average=function(a){return goog.math.sum.apply(null,arguments)/arguments.length};goog.math.standardDeviation=function(a){var b=arguments.length;if(2>b)return 0;var c=goog.math.average.apply(null,arguments),b=goog.math.sum.apply(null,goog.array.map(arguments,function(a){return Math.pow(a-c,2)}))/(b-1);return Math.sqrt(b)};goog.math.isInt=function(a){return isFinite(a)&&0==a%1};\ngoog.math.isFiniteNumber=function(a){return isFinite(a)&&!isNaN(a)};goog.math.Coordinate=function(a,b){this.x=goog.isDef(a)?a:0;this.y=goog.isDef(b)?b:0};goog.math.Coordinate.prototype.clone=function(){return new goog.math.Coordinate(this.x,this.y)};goog.DEBUG&&(goog.math.Coordinate.prototype.toString=function(){return\"(\"+this.x+\", \"+this.y+\")\"});goog.math.Coordinate.equals=function(a,b){return a==b?!0:!a||!b?!1:a.x==b.x&&a.y==b.y};goog.math.Coordinate.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};\ngoog.math.Coordinate.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};goog.math.Coordinate.azimuth=function(a){return goog.math.angle(0,0,a.x,a.y)};goog.math.Coordinate.squaredDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};goog.math.Coordinate.difference=function(a,b){return new goog.math.Coordinate(a.x-b.x,a.y-b.y)};goog.math.Coordinate.sum=function(a,b){return new goog.math.Coordinate(a.x+b.x,a.y+b.y)};goog.math.Size=function(a,b){this.width=a;this.height=b};goog.math.Size.equals=function(a,b){return a==b?!0:!a||!b?!1:a.width==b.width&&a.height==b.height};goog.math.Size.prototype.clone=function(){return new goog.math.Size(this.width,this.height)};goog.DEBUG&&(goog.math.Size.prototype.toString=function(){return\"(\"+this.width+\" x \"+this.height+\")\"});goog.math.Size.prototype.getLongest=function(){return Math.max(this.width,this.height)};\ngoog.math.Size.prototype.getShortest=function(){return Math.min(this.width,this.height)};goog.math.Size.prototype.area=function(){return this.width*this.height};goog.math.Size.prototype.perimeter=function(){return 2*(this.width+this.height)};goog.math.Size.prototype.aspectRatio=function(){return this.width/this.height};goog.math.Size.prototype.isEmpty=function(){return!this.area()};goog.math.Size.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};\ngoog.math.Size.prototype.fitsInside=function(a){return this.width<=a.width&&this.height<=a.height};goog.math.Size.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};goog.math.Size.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};goog.math.Size.prototype.scale=function(a){this.width*=a;this.height*=a;return this};\ngoog.math.Size.prototype.scaleToFit=function(a){a=this.aspectRatio()>a.aspectRatio()?a.width/this.width:a.height/this.height;return this.scale(a)};goog.dom.ASSUME_QUIRKS_MODE=!1;goog.dom.ASSUME_STANDARDS_MODE=!1;goog.dom.COMPAT_MODE_KNOWN_=goog.dom.ASSUME_QUIRKS_MODE||goog.dom.ASSUME_STANDARDS_MODE;goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};goog.dom.getDomHelper=function(a){return a?new goog.dom.DomHelper(goog.dom.getOwnerDocument(a)):goog.dom.defaultDomHelper_||(goog.dom.defaultDomHelper_=new goog.dom.DomHelper)};\ngoog.dom.getDocument=function(){return document};goog.dom.getElement=function(a){return goog.isString(a)?document.getElementById(a):a};goog.dom.$=goog.dom.getElement;goog.dom.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(document,a,b,c)};\ngoog.dom.getElementsByClass=function(a,b){var c=b||document;return goog.dom.canUseQuerySelector_(c)?c.querySelectorAll(\".\"+a):c.getElementsByClassName?c.getElementsByClassName(a):goog.dom.getElementsByTagNameAndClass_(document,\"*\",a,b)};goog.dom.getElementByClass=function(a,b){var c=b||document,d=null;return(d=goog.dom.canUseQuerySelector_(c)?c.querySelector(\".\"+a):goog.dom.getElementsByClass(a,b)[0])||null};goog.dom.canUseQuerySelector_=function(a){return!(!a.querySelectorAll||!a.querySelector)};\ngoog.dom.getElementsByTagNameAndClass_=function(a,b,c,d){a=d||a;b=b&&\"*\"!=b?b.toUpperCase():\"\";if(goog.dom.canUseQuerySelector_(a)&&(b||c))return a.querySelectorAll(b+(c?\".\"+c:\"\"));if(c&&a.getElementsByClassName){a=a.getElementsByClassName(c);if(b){d={};for(var e=0,f=0,g;g=a[f];f++)b==g.nodeName&&(d[e++]=g);d.length=e;return d}return a}a=a.getElementsByTagName(b||\"*\");if(c){d={};for(f=e=0;g=a[f];f++)b=g.className,\"function\"==typeof b.split&&goog.array.contains(b.split(/\\s+/),c)&&(d[e++]=g);d.length=\ne;return d}return a};goog.dom.$$=goog.dom.getElementsByTagNameAndClass;goog.dom.setProperties=function(a,b){goog.object.forEach(b,function(b,d){\"style\"==d?a.style.cssText=b:\"class\"==d?a.className=b:\"for\"==d?a.htmlFor=b:d in goog.dom.DIRECT_ATTRIBUTE_MAP_?a.setAttribute(goog.dom.DIRECT_ATTRIBUTE_MAP_[d],b):goog.string.startsWith(d,\"aria-\")||goog.string.startsWith(d,\"data-\")?a.setAttribute(d,b):a[d]=b})};\ngoog.dom.DIRECT_ATTRIBUTE_MAP_={cellpadding:\"cellPadding\",cellspacing:\"cellSpacing\",colspan:\"colSpan\",frameborder:\"frameBorder\",height:\"height\",maxlength:\"maxLength\",role:\"role\",rowspan:\"rowSpan\",type:\"type\",usemap:\"useMap\",valign:\"vAlign\",width:\"width\"};goog.dom.getViewportSize=function(a){return goog.dom.getViewportSize_(a||window)};goog.dom.getViewportSize_=function(a){a=a.document;a=goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body;return new goog.math.Size(a.clientWidth,a.clientHeight)};\ngoog.dom.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(window)};goog.dom.getDocumentHeight_=function(a){var b=a.document,c=0;if(b){a=goog.dom.getViewportSize_(a).height;var c=b.body,d=b.documentElement;if(goog.dom.isCss1CompatMode_(b)&&d.scrollHeight)c=d.scrollHeight!=a?d.scrollHeight:d.offsetHeight;else{var b=d.scrollHeight,e=d.offsetHeight;d.clientHeight!=e&&(b=c.scrollHeight,e=c.offsetHeight);c=b>a?b>e?b:e:b<e?b:e}}return c};\ngoog.dom.getPageScroll=function(a){return goog.dom.getDomHelper((a||goog.global||window).document).getDocumentScroll()};goog.dom.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(document)};goog.dom.getDocumentScroll_=function(a){var b=goog.dom.getDocumentScrollElement_(a);a=goog.dom.getWindow_(a);return new goog.math.Coordinate(a.pageXOffset||b.scrollLeft,a.pageYOffset||b.scrollTop)};goog.dom.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(document)};\ngoog.dom.getDocumentScrollElement_=function(a){return!goog.userAgent.WEBKIT&&goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body};goog.dom.getWindow=function(a){return a?goog.dom.getWindow_(a):window};goog.dom.getWindow_=function(a){return a.parentWindow||a.defaultView};goog.dom.createDom=function(a,b,c){return goog.dom.createDom_(document,arguments)};\ngoog.dom.createDom_=function(a,b){var c=b[0],d=b[1];if(!goog.dom.BrowserFeature.CAN_ADD_NAME_OR_TYPE_ATTRIBUTES&&d&&(d.name||d.type)){c=[\"<\",c];d.name&&c.push(' name=\"',goog.string.htmlEscape(d.name),'\"');if(d.type){c.push(' type=\"',goog.string.htmlEscape(d.type),'\"');var e={};goog.object.extend(e,d);delete e.type;d=e}c.push(\">\");c=c.join(\"\")}c=a.createElement(c);d&&(goog.isString(d)?c.className=d:goog.isArray(d)?goog.dom.classes.add.apply(null,[c].concat(d)):goog.dom.setProperties(c,d));2<b.length&&\ngoog.dom.append_(a,c,b,2);return c};goog.dom.append_=function(a,b,c,d){function e(c){c&&b.appendChild(goog.isString(c)?a.createTextNode(c):c)}for(;d<c.length;d++){var f=c[d];goog.isArrayLike(f)&&!goog.dom.isNodeLike(f)?goog.array.forEach(goog.dom.isNodeList(f)?goog.array.toArray(f):f,e):e(f)}};goog.dom.$dom=goog.dom.createDom;goog.dom.createElement=function(a){return document.createElement(a)};goog.dom.createTextNode=function(a){return document.createTextNode(a)};\ngoog.dom.createTable=function(a,b,c){return goog.dom.createTable_(document,a,b,!!c)};goog.dom.createTable_=function(a,b,c,d){for(var e=[\"<tr>\"],f=0;f<c;f++)e.push(d?\"<td>&nbsp;</td>\":\"<td></td>\");e.push(\"</tr>\");e=e.join(\"\");c=[\"<table>\"];for(f=0;f<b;f++)c.push(e);c.push(\"</table>\");a=a.createElement(goog.dom.TagName.DIV);a.innerHTML=c.join(\"\");return a.removeChild(a.firstChild)};goog.dom.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(document,a)};\ngoog.dom.htmlToDocumentFragment_=function(a,b){var c=a.createElement(\"div\");goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT?(c.innerHTML=\"<br>\"+b,c.removeChild(c.firstChild)):c.innerHTML=b;if(1==c.childNodes.length)return c.removeChild(c.firstChild);for(var d=a.createDocumentFragment();c.firstChild;)d.appendChild(c.firstChild);return d};goog.dom.getCompatMode=function(){return goog.dom.isCss1CompatMode()?\"CSS1Compat\":\"BackCompat\"};goog.dom.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(document)};\ngoog.dom.isCss1CompatMode_=function(a){return goog.dom.COMPAT_MODE_KNOWN_?goog.dom.ASSUME_STANDARDS_MODE:\"CSS1Compat\"==a.compatMode};goog.dom.canHaveChildren=function(a){if(a.nodeType!=goog.dom.NodeType.ELEMENT)return!1;switch(a.tagName){case goog.dom.TagName.APPLET:case goog.dom.TagName.AREA:case goog.dom.TagName.BASE:case goog.dom.TagName.BR:case goog.dom.TagName.COL:case goog.dom.TagName.COMMAND:case goog.dom.TagName.EMBED:case goog.dom.TagName.FRAME:case goog.dom.TagName.HR:case goog.dom.TagName.IMG:case goog.dom.TagName.INPUT:case goog.dom.TagName.IFRAME:case goog.dom.TagName.ISINDEX:case goog.dom.TagName.KEYGEN:case goog.dom.TagName.LINK:case goog.dom.TagName.NOFRAMES:case goog.dom.TagName.NOSCRIPT:case goog.dom.TagName.META:case goog.dom.TagName.OBJECT:case goog.dom.TagName.PARAM:case goog.dom.TagName.SCRIPT:case goog.dom.TagName.SOURCE:case goog.dom.TagName.STYLE:case goog.dom.TagName.TRACK:case goog.dom.TagName.WBR:return!1}return!0};\ngoog.dom.appendChild=function(a,b){a.appendChild(b)};goog.dom.append=function(a,b){goog.dom.append_(goog.dom.getOwnerDocument(a),a,arguments,1)};goog.dom.removeChildren=function(a){for(var b;b=a.firstChild;)a.removeChild(b)};goog.dom.insertSiblingBefore=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)};goog.dom.insertSiblingAfter=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b.nextSibling)};goog.dom.insertChildAt=function(a,b,c){a.insertBefore(b,a.childNodes[c]||null)};\ngoog.dom.removeNode=function(a){return a&&a.parentNode?a.parentNode.removeChild(a):null};goog.dom.replaceNode=function(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)};goog.dom.flattenElement=function(a){var b,c=a.parentNode;if(c&&c.nodeType!=goog.dom.NodeType.DOCUMENT_FRAGMENT){if(a.removeNode)return a.removeNode(!1);for(;b=a.firstChild;)c.insertBefore(b,a);return goog.dom.removeNode(a)}};\ngoog.dom.getChildren=function(a){return goog.dom.BrowserFeature.CAN_USE_CHILDREN_ATTRIBUTE&&void 0!=a.children?a.children:goog.array.filter(a.childNodes,function(a){return a.nodeType==goog.dom.NodeType.ELEMENT})};goog.dom.getFirstElementChild=function(a){return void 0!=a.firstElementChild?a.firstElementChild:goog.dom.getNextElementNode_(a.firstChild,!0)};goog.dom.getLastElementChild=function(a){return void 0!=a.lastElementChild?a.lastElementChild:goog.dom.getNextElementNode_(a.lastChild,!1)};\ngoog.dom.getNextElementSibling=function(a){return void 0!=a.nextElementSibling?a.nextElementSibling:goog.dom.getNextElementNode_(a.nextSibling,!0)};goog.dom.getPreviousElementSibling=function(a){return void 0!=a.previousElementSibling?a.previousElementSibling:goog.dom.getNextElementNode_(a.previousSibling,!1)};goog.dom.getNextElementNode_=function(a,b){for(;a&&a.nodeType!=goog.dom.NodeType.ELEMENT;)a=b?a.nextSibling:a.previousSibling;return a};\ngoog.dom.getNextNode=function(a){if(!a)return null;if(a.firstChild)return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null};goog.dom.getPreviousNode=function(a){if(!a)return null;if(!a.previousSibling)return a.parentNode;for(a=a.previousSibling;a&&a.lastChild;)a=a.lastChild;return a};goog.dom.isNodeLike=function(a){return goog.isObject(a)&&0<a.nodeType};goog.dom.isElement=function(a){return goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT};\ngoog.dom.isWindow=function(a){return goog.isObject(a)&&a.window==a};goog.dom.getParentElement=function(a){if(goog.dom.BrowserFeature.CAN_USE_PARENT_ELEMENT_PROPERTY)return a.parentElement;a=a.parentNode;return goog.dom.isElement(a)?a:null};goog.dom.contains=function(a,b){if(a.contains&&b.nodeType==goog.dom.NodeType.ELEMENT)return a==b||a.contains(b);if(\"undefined\"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a};\ngoog.dom.compareNodeOrder=function(a,b){if(a==b)return 0;if(a.compareDocumentPosition)return a.compareDocumentPosition(b)&2?1:-1;if(goog.userAgent.IE&&!goog.userAgent.isDocumentMode(9)){if(a.nodeType==goog.dom.NodeType.DOCUMENT)return-1;if(b.nodeType==goog.dom.NodeType.DOCUMENT)return 1}if(\"sourceIndex\"in a||a.parentNode&&\"sourceIndex\"in a.parentNode){var c=a.nodeType==goog.dom.NodeType.ELEMENT,d=b.nodeType==goog.dom.NodeType.ELEMENT;if(c&&d)return a.sourceIndex-b.sourceIndex;var e=a.parentNode,f=\nb.parentNode;return e==f?goog.dom.compareSiblingOrder_(a,b):!c&&goog.dom.contains(e,b)?-1*goog.dom.compareParentsDescendantNodeIe_(a,b):!d&&goog.dom.contains(f,a)?goog.dom.compareParentsDescendantNodeIe_(b,a):(c?a.sourceIndex:e.sourceIndex)-(d?b.sourceIndex:f.sourceIndex)}d=goog.dom.getOwnerDocument(a);c=d.createRange();c.selectNode(a);c.collapse(!0);d=d.createRange();d.selectNode(b);d.collapse(!0);return c.compareBoundaryPoints(goog.global.Range.START_TO_END,d)};\ngoog.dom.compareParentsDescendantNodeIe_=function(a,b){var c=a.parentNode;if(c==b)return-1;for(var d=b;d.parentNode!=c;)d=d.parentNode;return goog.dom.compareSiblingOrder_(d,a)};goog.dom.compareSiblingOrder_=function(a,b){for(var c=b;c=c.previousSibling;)if(c==a)return-1;return 1};\ngoog.dom.findCommonAncestor=function(a){var b,c=arguments.length;if(c){if(1==c)return arguments[0]}else return null;var d=[],e=Infinity;for(b=0;b<c;b++){for(var f=[],g=arguments[b];g;)f.unshift(g),g=g.parentNode;d.push(f);e=Math.min(e,f.length)}f=null;for(b=0;b<e;b++){for(var g=d[0][b],h=1;h<c;h++)if(g!=d[h][b])return f;f=g}return f};goog.dom.getOwnerDocument=function(a){return a.nodeType==goog.dom.NodeType.DOCUMENT?a:a.ownerDocument||a.document};\ngoog.dom.getFrameContentDocument=function(a){return a.contentDocument||a.contentWindow.document};goog.dom.getFrameContentWindow=function(a){return a.contentWindow||goog.dom.getWindow_(goog.dom.getFrameContentDocument(a))};\ngoog.dom.setTextContent=function(a,b){if(\"textContent\"in a)a.textContent=b;else if(a.firstChild&&a.firstChild.nodeType==goog.dom.NodeType.TEXT){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else{goog.dom.removeChildren(a);var c=goog.dom.getOwnerDocument(a);a.appendChild(c.createTextNode(b))}};goog.dom.getOuterHtml=function(a){if(\"outerHTML\"in a)return a.outerHTML;var b=goog.dom.getOwnerDocument(a).createElement(\"div\");b.appendChild(a.cloneNode(!0));return b.innerHTML};\ngoog.dom.findNode=function(a,b){var c=[];return goog.dom.findNodes_(a,b,c,!0)?c[0]:void 0};goog.dom.findNodes=function(a,b){var c=[];goog.dom.findNodes_(a,b,c,!1);return c};goog.dom.findNodes_=function(a,b,c,d){if(null!=a)for(a=a.firstChild;a;){if(b(a)&&(c.push(a),d)||goog.dom.findNodes_(a,b,c,d))return!0;a=a.nextSibling}return!1};goog.dom.TAGS_TO_IGNORE_={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1};goog.dom.PREDEFINED_TAG_VALUES_={IMG:\" \",BR:\"\\n\"};\ngoog.dom.isFocusableTabIndex=function(a){var b=a.getAttributeNode(\"tabindex\");return b&&b.specified?(a=a.tabIndex,goog.isNumber(a)&&0<=a&&32768>a):!1};goog.dom.setFocusableTabIndex=function(a,b){b?a.tabIndex=0:(a.tabIndex=-1,a.removeAttribute(\"tabIndex\"))};\ngoog.dom.getTextContent=function(a){if(goog.dom.BrowserFeature.CAN_USE_INNER_TEXT&&\"innerText\"in a)a=goog.string.canonicalizeNewlines(a.innerText);else{var b=[];goog.dom.getTextContent_(a,b,!0);a=b.join(\"\")}a=a.replace(/ \\xAD /g,\" \").replace(/\\xAD/g,\"\");a=a.replace(/\\u200B/g,\"\");goog.dom.BrowserFeature.CAN_USE_INNER_TEXT||(a=a.replace(/ +/g,\" \"));\" \"!=a&&(a=a.replace(/^\\s*/,\"\"));return a};goog.dom.getRawTextContent=function(a){var b=[];goog.dom.getTextContent_(a,b,!1);return b.join(\"\")};\ngoog.dom.getTextContent_=function(a,b,c){if(!(a.nodeName in goog.dom.TAGS_TO_IGNORE_))if(a.nodeType==goog.dom.NodeType.TEXT)c?b.push(String(a.nodeValue).replace(/(\\r\\n|\\r|\\n)/g,\"\")):b.push(a.nodeValue);else if(a.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)b.push(goog.dom.PREDEFINED_TAG_VALUES_[a.nodeName]);else for(a=a.firstChild;a;)goog.dom.getTextContent_(a,b,c),a=a.nextSibling};goog.dom.getNodeTextLength=function(a){return goog.dom.getTextContent(a).length};\ngoog.dom.getNodeTextOffset=function(a,b){for(var c=b||goog.dom.getOwnerDocument(a).body,d=[];a&&a!=c;){for(var e=a;e=e.previousSibling;)d.unshift(goog.dom.getTextContent(e));a=a.parentNode}return goog.string.trimLeft(d.join(\"\")).replace(/ +/g,\" \").length};\ngoog.dom.getNodeAtOffset=function(a,b,c){a=[a];for(var d=0,e=null;0<a.length&&d<b;)if(e=a.pop(),!(e.nodeName in goog.dom.TAGS_TO_IGNORE_))if(e.nodeType==goog.dom.NodeType.TEXT)var f=e.nodeValue.replace(/(\\r\\n|\\r|\\n)/g,\"\").replace(/ +/g,\" \"),d=d+f.length;else if(e.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)d+=goog.dom.PREDEFINED_TAG_VALUES_[e.nodeName].length;else for(f=e.childNodes.length-1;0<=f;f--)a.push(e.childNodes[f]);goog.isObject(c)&&(c.remainder=e?e.nodeValue.length+b-d-1:0,c.node=e);return e};\ngoog.dom.isNodeList=function(a){if(a&&\"number\"==typeof a.length){if(goog.isObject(a))return\"function\"==typeof a.item||\"string\"==typeof a.item;if(goog.isFunction(a))return\"function\"==typeof a.item}return!1};goog.dom.getAncestorByTagNameAndClass=function(a,b,c){if(!b&&!c)return null;var d=b?b.toUpperCase():null;return goog.dom.getAncestor(a,function(a){return(!d||a.nodeName==d)&&(!c||goog.dom.classes.has(a,c))},!0)};\ngoog.dom.getAncestorByClass=function(a,b){return goog.dom.getAncestorByTagNameAndClass(a,null,b)};goog.dom.getAncestor=function(a,b,c,d){c||(a=a.parentNode);c=null==d;for(var e=0;a&&(c||e<=d);){if(b(a))return a;a=a.parentNode;e++}return null};goog.dom.getActiveElement=function(a){try{return a&&a.activeElement}catch(b){}return null};goog.dom.DomHelper=function(a){this.document_=a||goog.global.document||document};goog.dom.DomHelper.prototype.getDomHelper=goog.dom.getDomHelper;\ngoog.dom.DomHelper.prototype.setDocument=function(a){this.document_=a};goog.dom.DomHelper.prototype.getDocument=function(){return this.document_};goog.dom.DomHelper.prototype.getElement=function(a){return goog.isString(a)?this.document_.getElementById(a):a};goog.dom.DomHelper.prototype.$=goog.dom.DomHelper.prototype.getElement;goog.dom.DomHelper.prototype.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(this.document_,a,b,c)};\ngoog.dom.DomHelper.prototype.getElementsByClass=function(a,b){return goog.dom.getElementsByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.getElementByClass=function(a,b){return goog.dom.getElementByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.$$=goog.dom.DomHelper.prototype.getElementsByTagNameAndClass;goog.dom.DomHelper.prototype.setProperties=goog.dom.setProperties;goog.dom.DomHelper.prototype.getViewportSize=function(a){return goog.dom.getViewportSize(a||this.getWindow())};\ngoog.dom.DomHelper.prototype.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(this.getWindow())};goog.dom.DomHelper.prototype.createDom=function(a,b,c){return goog.dom.createDom_(this.document_,arguments)};goog.dom.DomHelper.prototype.$dom=goog.dom.DomHelper.prototype.createDom;goog.dom.DomHelper.prototype.createElement=function(a){return this.document_.createElement(a)};goog.dom.DomHelper.prototype.createTextNode=function(a){return this.document_.createTextNode(a)};\ngoog.dom.DomHelper.prototype.createTable=function(a,b,c){return goog.dom.createTable_(this.document_,a,b,!!c)};goog.dom.DomHelper.prototype.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(this.document_,a)};goog.dom.DomHelper.prototype.getCompatMode=function(){return this.isCss1CompatMode()?\"CSS1Compat\":\"BackCompat\"};goog.dom.DomHelper.prototype.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(this.document_)};goog.dom.DomHelper.prototype.getWindow=function(){return goog.dom.getWindow_(this.document_)};\ngoog.dom.DomHelper.prototype.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(this.document_)};goog.dom.DomHelper.prototype.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(this.document_)};goog.dom.DomHelper.prototype.getActiveElement=function(a){return goog.dom.getActiveElement(a||this.document_)};goog.dom.DomHelper.prototype.appendChild=goog.dom.appendChild;goog.dom.DomHelper.prototype.append=goog.dom.append;\ngoog.dom.DomHelper.prototype.canHaveChildren=goog.dom.canHaveChildren;goog.dom.DomHelper.prototype.removeChildren=goog.dom.removeChildren;goog.dom.DomHelper.prototype.insertSiblingBefore=goog.dom.insertSiblingBefore;goog.dom.DomHelper.prototype.insertSiblingAfter=goog.dom.insertSiblingAfter;goog.dom.DomHelper.prototype.insertChildAt=goog.dom.insertChildAt;goog.dom.DomHelper.prototype.removeNode=goog.dom.removeNode;goog.dom.DomHelper.prototype.replaceNode=goog.dom.replaceNode;\ngoog.dom.DomHelper.prototype.flattenElement=goog.dom.flattenElement;goog.dom.DomHelper.prototype.getChildren=goog.dom.getChildren;goog.dom.DomHelper.prototype.getFirstElementChild=goog.dom.getFirstElementChild;goog.dom.DomHelper.prototype.getLastElementChild=goog.dom.getLastElementChild;goog.dom.DomHelper.prototype.getNextElementSibling=goog.dom.getNextElementSibling;goog.dom.DomHelper.prototype.getPreviousElementSibling=goog.dom.getPreviousElementSibling;\ngoog.dom.DomHelper.prototype.getNextNode=goog.dom.getNextNode;goog.dom.DomHelper.prototype.getPreviousNode=goog.dom.getPreviousNode;goog.dom.DomHelper.prototype.isNodeLike=goog.dom.isNodeLike;goog.dom.DomHelper.prototype.isElement=goog.dom.isElement;goog.dom.DomHelper.prototype.isWindow=goog.dom.isWindow;goog.dom.DomHelper.prototype.getParentElement=goog.dom.getParentElement;goog.dom.DomHelper.prototype.contains=goog.dom.contains;goog.dom.DomHelper.prototype.compareNodeOrder=goog.dom.compareNodeOrder;\ngoog.dom.DomHelper.prototype.findCommonAncestor=goog.dom.findCommonAncestor;goog.dom.DomHelper.prototype.getOwnerDocument=goog.dom.getOwnerDocument;goog.dom.DomHelper.prototype.getFrameContentDocument=goog.dom.getFrameContentDocument;goog.dom.DomHelper.prototype.getFrameContentWindow=goog.dom.getFrameContentWindow;goog.dom.DomHelper.prototype.setTextContent=goog.dom.setTextContent;goog.dom.DomHelper.prototype.getOuterHtml=goog.dom.getOuterHtml;goog.dom.DomHelper.prototype.findNode=goog.dom.findNode;\ngoog.dom.DomHelper.prototype.findNodes=goog.dom.findNodes;goog.dom.DomHelper.prototype.isFocusableTabIndex=goog.dom.isFocusableTabIndex;goog.dom.DomHelper.prototype.setFocusableTabIndex=goog.dom.setFocusableTabIndex;goog.dom.DomHelper.prototype.getTextContent=goog.dom.getTextContent;goog.dom.DomHelper.prototype.getNodeTextLength=goog.dom.getNodeTextLength;goog.dom.DomHelper.prototype.getNodeTextOffset=goog.dom.getNodeTextOffset;goog.dom.DomHelper.prototype.getNodeAtOffset=goog.dom.getNodeAtOffset;\ngoog.dom.DomHelper.prototype.isNodeList=goog.dom.isNodeList;goog.dom.DomHelper.prototype.getAncestorByTagNameAndClass=goog.dom.getAncestorByTagNameAndClass;goog.dom.DomHelper.prototype.getAncestorByClass=goog.dom.getAncestorByClass;goog.dom.DomHelper.prototype.getAncestor=goog.dom.getAncestor;goog.json={};goog.json.isValid_=function(a){return/^\\s*$/.test(a)?!1:/^[\\],:{}\\s\\u2028\\u2029]*$/.test(a.replace(/\\\\[\"\\\\\\/bfnrtu]/g,\"@\").replace(/\"[^\"\\\\\\n\\r\\u2028\\u2029\\x00-\\x08\\x0a-\\x1f]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g,\"]\").replace(/(?:^|:|,)(?:[\\s\\u2028\\u2029]*\\[)+/g,\"\"))};goog.json.parse=function(a){a=String(a);if(goog.json.isValid_(a))try{return eval(\"(\"+a+\")\")}catch(b){}throw Error(\"Invalid JSON string: \"+a);};goog.json.unsafeParse=function(a){return eval(\"(\"+a+\")\")};\ngoog.json.serialize=function(a,b){return(new goog.json.Serializer(b)).serialize(a)};goog.json.Serializer=function(a){this.replacer_=a};goog.json.Serializer.prototype.serialize=function(a){var b=[];this.serialize_(a,b);return b.join(\"\")};\ngoog.json.Serializer.prototype.serialize_=function(a,b){switch(typeof a){case \"string\":this.serializeString_(a,b);break;case \"number\":this.serializeNumber_(a,b);break;case \"boolean\":b.push(a);break;case \"undefined\":b.push(\"null\");break;case \"object\":if(null==a){b.push(\"null\");break}if(goog.isArray(a)){this.serializeArray(a,b);break}this.serializeObject_(a,b);break;case \"function\":break;default:throw Error(\"Unknown type: \"+typeof a);}};\ngoog.json.Serializer.charToJsonCharCache_={'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\",\"/\":\"\\\\/\",\"\\b\":\"\\\\b\",\"\\f\":\"\\\\f\",\"\\n\":\"\\\\n\",\"\\r\":\"\\\\r\",\"\\t\":\"\\\\t\",\"\\x0B\":\"\\\\u000b\"};goog.json.Serializer.charsToReplace_=/\\uffff/.test(\"\\uffff\")?/[\\\\\\\"\\x00-\\x1f\\x7f-\\uffff]/g:/[\\\\\\\"\\x00-\\x1f\\x7f-\\xff]/g;\ngoog.json.Serializer.prototype.serializeString_=function(a,b){b.push('\"',a.replace(goog.json.Serializer.charsToReplace_,function(a){if(a in goog.json.Serializer.charToJsonCharCache_)return goog.json.Serializer.charToJsonCharCache_[a];var b=a.charCodeAt(0),e=\"\\\\u\";16>b?e+=\"000\":256>b?e+=\"00\":4096>b&&(e+=\"0\");return goog.json.Serializer.charToJsonCharCache_[a]=e+b.toString(16)}),'\"')};goog.json.Serializer.prototype.serializeNumber_=function(a,b){b.push(isFinite(a)&&!isNaN(a)?a:\"null\")};\ngoog.json.Serializer.prototype.serializeArray=function(a,b){var c=a.length;b.push(\"[\");for(var d=\"\",e=0;e<c;e++)b.push(d),d=a[e],this.serialize_(this.replacer_?this.replacer_.call(a,String(e),d):d,b),d=\",\";b.push(\"]\")};\ngoog.json.Serializer.prototype.serializeObject_=function(a,b){b.push(\"{\");var c=\"\",d;for(d in a)if(Object.prototype.hasOwnProperty.call(a,d)){var e=a[d];\"function\"!=typeof e&&(b.push(c),this.serializeString_(d,b),b.push(\":\"),this.serialize_(this.replacer_?this.replacer_.call(a,d,e):e,b),c=\",\")}b.push(\"}\")};goog.proto2.ObjectSerializer=function(a){this.keyOption_=a};goog.inherits(goog.proto2.ObjectSerializer,goog.proto2.Serializer);goog.proto2.ObjectSerializer.KeyOption={TAG:0,NAME:1};\ngoog.proto2.ObjectSerializer.prototype.serialize=function(a){for(var b=a.getDescriptor().getFields(),c={},d=0;d<b.length;d++){var e=b[d],f=this.keyOption_==goog.proto2.ObjectSerializer.KeyOption.NAME?e.getName():e.getTag();if(a.has(e))if(e.isRepeated()){var g=[];c[f]=g;for(f=0;f<a.countOf(e);f++)g.push(this.getSerializedValue(e,a.get(e,f)))}else c[f]=this.getSerializedValue(e,a.get(e))}a.forEachUnknown(function(a,b){c[a]=b});return c};\ngoog.proto2.ObjectSerializer.prototype.deserializeTo=function(a,b){var c=a.getDescriptor(),d;for(d in b){var e,f=b[d],g=goog.string.isNumeric(d);g?e=c.findFieldByTag(d):(goog.proto2.Util.assert(this.keyOption_==goog.proto2.ObjectSerializer.KeyOption.NAME),e=c.findFieldByName(d));if(e)if(e.isRepeated()){goog.proto2.Util.assert(goog.isArray(f));for(g=0;g<f.length;g++)a.add(e,this.getDeserializedValue(e,f[g]))}else goog.proto2.Util.assert(!goog.isArray(f)),a.set(e,this.getDeserializedValue(e,f));else g?\na.setUnknown(d,f):goog.proto2.Util.assert(e)}};/*\n\n Copyright (C) 2011 The Libphonenumber Authors.\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\nvar i18n={phonenumbers:{}};i18n.phonenumbers.RegionCode={UN001:\"001\",AD:\"AD\",AE:\"AE\",AO:\"AO\",AQ:\"AQ\",AR:\"AR\",AU:\"AU\",BR:\"BR\",BS:\"BS\",BY:\"BY\",CA:\"CA\",CH:\"CH\",CN:\"CN\",CS:\"CS\",DE:\"DE\",GB:\"GB\",IT:\"IT\",JP:\"JP\",KR:\"KR\",MX:\"MX\",NZ:\"NZ\",PL:\"PL\",RE:\"RE\",SG:\"SG\",US:\"US\",YT:\"YT\",ZW:\"ZW\",ZZ:\"ZZ\"};/*\n\n Protocol Buffer 2 Copyright 2008 Google Inc.\n All other code copyright its respective owners.\n Copyright (C) 2010 The Libphonenumber Authors\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\ni18n.phonenumbers.NumberFormat=function(){goog.proto2.Message.apply(this)};goog.inherits(i18n.phonenumbers.NumberFormat,goog.proto2.Message);i18n.phonenumbers.NumberFormat.prototype.getPattern=function(){return this.get$Value(1)};i18n.phonenumbers.NumberFormat.prototype.getPatternOrDefault=function(){return this.get$ValueOrDefault(1)};i18n.phonenumbers.NumberFormat.prototype.setPattern=function(a){this.set$Value(1,a)};i18n.phonenumbers.NumberFormat.prototype.hasPattern=function(){return this.has$Value(1)};\ni18n.phonenumbers.NumberFormat.prototype.patternCount=function(){return this.count$Values(1)};i18n.phonenumbers.NumberFormat.prototype.clearPattern=function(){this.clear$Field(1)};i18n.phonenumbers.NumberFormat.prototype.getFormat=function(){return this.get$Value(2)};i18n.phonenumbers.NumberFormat.prototype.getFormatOrDefault=function(){return this.get$ValueOrDefault(2)};i18n.phonenumbers.NumberFormat.prototype.setFormat=function(a){this.set$Value(2,a)};\ni18n.phonenumbers.NumberFormat.prototype.hasFormat=function(){return this.has$Value(2)};i18n.phonenumbers.NumberFormat.prototype.formatCount=function(){return this.count$Values(2)};i18n.phonenumbers.NumberFormat.prototype.clearFormat=function(){this.clear$Field(2)};i18n.phonenumbers.NumberFormat.prototype.getLeadingDigitsPattern=function(a){return this.get$Value(3,a)};i18n.phonenumbers.NumberFormat.prototype.getLeadingDigitsPatternOrDefault=function(a){return this.get$ValueOrDefault(3,a)};\ni18n.phonenumbers.NumberFormat.prototype.addLeadingDigitsPattern=function(a){this.add$Value(3,a)};i18n.phonenumbers.NumberFormat.prototype.leadingDigitsPatternArray=function(){return this.array$Values(3)};i18n.phonenumbers.NumberFormat.prototype.hasLeadingDigitsPattern=function(){return this.has$Value(3)};i18n.phonenumbers.NumberFormat.prototype.leadingDigitsPatternCount=function(){return this.count$Values(3)};i18n.phonenumbers.NumberFormat.prototype.clearLeadingDigitsPattern=function(){this.clear$Field(3)};\ni18n.phonenumbers.NumberFormat.prototype.getNationalPrefixFormattingRule=function(){return this.get$Value(4)};i18n.phonenumbers.NumberFormat.prototype.getNationalPrefixFormattingRuleOrDefault=function(){return this.get$ValueOrDefault(4)};i18n.phonenumbers.NumberFormat.prototype.setNationalPrefixFormattingRule=function(a){this.set$Value(4,a)};i18n.phonenumbers.NumberFormat.prototype.hasNationalPrefixFormattingRule=function(){return this.has$Value(4)};\ni18n.phonenumbers.NumberFormat.prototype.nationalPrefixFormattingRuleCount=function(){return this.count$Values(4)};i18n.phonenumbers.NumberFormat.prototype.clearNationalPrefixFormattingRule=function(){this.clear$Field(4)};i18n.phonenumbers.NumberFormat.prototype.getNationalPrefixOptionalWhenFormatting=function(){return this.get$Value(6)};i18n.phonenumbers.NumberFormat.prototype.getNationalPrefixOptionalWhenFormattingOrDefault=function(){return this.get$ValueOrDefault(6)};\ni18n.phonenumbers.NumberFormat.prototype.setNationalPrefixOptionalWhenFormatting=function(a){this.set$Value(6,a)};i18n.phonenumbers.NumberFormat.prototype.hasNationalPrefixOptionalWhenFormatting=function(){return this.has$Value(6)};i18n.phonenumbers.NumberFormat.prototype.nationalPrefixOptionalWhenFormattingCount=function(){return this.count$Values(6)};i18n.phonenumbers.NumberFormat.prototype.clearNationalPrefixOptionalWhenFormatting=function(){this.clear$Field(6)};\ni18n.phonenumbers.NumberFormat.prototype.getDomesticCarrierCodeFormattingRule=function(){return this.get$Value(5)};i18n.phonenumbers.NumberFormat.prototype.getDomesticCarrierCodeFormattingRuleOrDefault=function(){return this.get$ValueOrDefault(5)};i18n.phonenumbers.NumberFormat.prototype.setDomesticCarrierCodeFormattingRule=function(a){this.set$Value(5,a)};i18n.phonenumbers.NumberFormat.prototype.hasDomesticCarrierCodeFormattingRule=function(){return this.has$Value(5)};\ni18n.phonenumbers.NumberFormat.prototype.domesticCarrierCodeFormattingRuleCount=function(){return this.count$Values(5)};i18n.phonenumbers.NumberFormat.prototype.clearDomesticCarrierCodeFormattingRule=function(){this.clear$Field(5)};i18n.phonenumbers.PhoneNumberDesc=function(){goog.proto2.Message.apply(this)};goog.inherits(i18n.phonenumbers.PhoneNumberDesc,goog.proto2.Message);i18n.phonenumbers.PhoneNumberDesc.prototype.getNationalNumberPattern=function(){return this.get$Value(2)};\ni18n.phonenumbers.PhoneNumberDesc.prototype.getNationalNumberPatternOrDefault=function(){return this.get$ValueOrDefault(2)};i18n.phonenumbers.PhoneNumberDesc.prototype.setNationalNumberPattern=function(a){this.set$Value(2,a)};i18n.phonenumbers.PhoneNumberDesc.prototype.hasNationalNumberPattern=function(){return this.has$Value(2)};i18n.phonenumbers.PhoneNumberDesc.prototype.nationalNumberPatternCount=function(){return this.count$Values(2)};\ni18n.phonenumbers.PhoneNumberDesc.prototype.clearNationalNumberPattern=function(){this.clear$Field(2)};i18n.phonenumbers.PhoneNumberDesc.prototype.getPossibleNumberPattern=function(){return this.get$Value(3)};i18n.phonenumbers.PhoneNumberDesc.prototype.getPossibleNumberPatternOrDefault=function(){return this.get$ValueOrDefault(3)};i18n.phonenumbers.PhoneNumberDesc.prototype.setPossibleNumberPattern=function(a){this.set$Value(3,a)};\ni18n.phonenumbers.PhoneNumberDesc.prototype.hasPossibleNumberPattern=function(){return this.has$Value(3)};i18n.phonenumbers.PhoneNumberDesc.prototype.possibleNumberPatternCount=function(){return this.count$Values(3)};i18n.phonenumbers.PhoneNumberDesc.prototype.clearPossibleNumberPattern=function(){this.clear$Field(3)};i18n.phonenumbers.PhoneNumberDesc.prototype.getExampleNumber=function(){return this.get$Value(6)};i18n.phonenumbers.PhoneNumberDesc.prototype.getExampleNumberOrDefault=function(){return this.get$ValueOrDefault(6)};\ni18n.phonenumbers.PhoneNumberDesc.prototype.setExampleNumber=function(a){this.set$Value(6,a)};i18n.phonenumbers.PhoneNumberDesc.prototype.hasExampleNumber=function(){return this.has$Value(6)};i18n.phonenumbers.PhoneNumberDesc.prototype.exampleNumberCount=function(){return this.count$Values(6)};i18n.phonenumbers.PhoneNumberDesc.prototype.clearExampleNumber=function(){this.clear$Field(6)};i18n.phonenumbers.PhoneMetadata=function(){goog.proto2.Message.apply(this)};\ngoog.inherits(i18n.phonenumbers.PhoneMetadata,goog.proto2.Message);i18n.phonenumbers.PhoneMetadata.prototype.getGeneralDesc=function(){return this.get$Value(1)};i18n.phonenumbers.PhoneMetadata.prototype.getGeneralDescOrDefault=function(){return this.get$ValueOrDefault(1)};i18n.phonenumbers.PhoneMetadata.prototype.setGeneralDesc=function(a){this.set$Value(1,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasGeneralDesc=function(){return this.has$Value(1)};\ni18n.phonenumbers.PhoneMetadata.prototype.generalDescCount=function(){return this.count$Values(1)};i18n.phonenumbers.PhoneMetadata.prototype.clearGeneralDesc=function(){this.clear$Field(1)};i18n.phonenumbers.PhoneMetadata.prototype.getFixedLine=function(){return this.get$Value(2)};i18n.phonenumbers.PhoneMetadata.prototype.getFixedLineOrDefault=function(){return this.get$ValueOrDefault(2)};i18n.phonenumbers.PhoneMetadata.prototype.setFixedLine=function(a){this.set$Value(2,a)};\ni18n.phonenumbers.PhoneMetadata.prototype.hasFixedLine=function(){return this.has$Value(2)};i18n.phonenumbers.PhoneMetadata.prototype.fixedLineCount=function(){return this.count$Values(2)};i18n.phonenumbers.PhoneMetadata.prototype.clearFixedLine=function(){this.clear$Field(2)};i18n.phonenumbers.PhoneMetadata.prototype.getMobile=function(){return this.get$Value(3)};i18n.phonenumbers.PhoneMetadata.prototype.getMobileOrDefault=function(){return this.get$ValueOrDefault(3)};\ni18n.phonenumbers.PhoneMetadata.prototype.setMobile=function(a){this.set$Value(3,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasMobile=function(){return this.has$Value(3)};i18n.phonenumbers.PhoneMetadata.prototype.mobileCount=function(){return this.count$Values(3)};i18n.phonenumbers.PhoneMetadata.prototype.clearMobile=function(){this.clear$Field(3)};i18n.phonenumbers.PhoneMetadata.prototype.getTollFree=function(){return this.get$Value(4)};\ni18n.phonenumbers.PhoneMetadata.prototype.getTollFreeOrDefault=function(){return this.get$ValueOrDefault(4)};i18n.phonenumbers.PhoneMetadata.prototype.setTollFree=function(a){this.set$Value(4,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasTollFree=function(){return this.has$Value(4)};i18n.phonenumbers.PhoneMetadata.prototype.tollFreeCount=function(){return this.count$Values(4)};i18n.phonenumbers.PhoneMetadata.prototype.clearTollFree=function(){this.clear$Field(4)};\ni18n.phonenumbers.PhoneMetadata.prototype.getPremiumRate=function(){return this.get$Value(5)};i18n.phonenumbers.PhoneMetadata.prototype.getPremiumRateOrDefault=function(){return this.get$ValueOrDefault(5)};i18n.phonenumbers.PhoneMetadata.prototype.setPremiumRate=function(a){this.set$Value(5,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasPremiumRate=function(){return this.has$Value(5)};i18n.phonenumbers.PhoneMetadata.prototype.premiumRateCount=function(){return this.count$Values(5)};\ni18n.phonenumbers.PhoneMetadata.prototype.clearPremiumRate=function(){this.clear$Field(5)};i18n.phonenumbers.PhoneMetadata.prototype.getSharedCost=function(){return this.get$Value(6)};i18n.phonenumbers.PhoneMetadata.prototype.getSharedCostOrDefault=function(){return this.get$ValueOrDefault(6)};i18n.phonenumbers.PhoneMetadata.prototype.setSharedCost=function(a){this.set$Value(6,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasSharedCost=function(){return this.has$Value(6)};\ni18n.phonenumbers.PhoneMetadata.prototype.sharedCostCount=function(){return this.count$Values(6)};i18n.phonenumbers.PhoneMetadata.prototype.clearSharedCost=function(){this.clear$Field(6)};i18n.phonenumbers.PhoneMetadata.prototype.getPersonalNumber=function(){return this.get$Value(7)};i18n.phonenumbers.PhoneMetadata.prototype.getPersonalNumberOrDefault=function(){return this.get$ValueOrDefault(7)};i18n.phonenumbers.PhoneMetadata.prototype.setPersonalNumber=function(a){this.set$Value(7,a)};\ni18n.phonenumbers.PhoneMetadata.prototype.hasPersonalNumber=function(){return this.has$Value(7)};i18n.phonenumbers.PhoneMetadata.prototype.personalNumberCount=function(){return this.count$Values(7)};i18n.phonenumbers.PhoneMetadata.prototype.clearPersonalNumber=function(){this.clear$Field(7)};i18n.phonenumbers.PhoneMetadata.prototype.getVoip=function(){return this.get$Value(8)};i18n.phonenumbers.PhoneMetadata.prototype.getVoipOrDefault=function(){return this.get$ValueOrDefault(8)};\ni18n.phonenumbers.PhoneMetadata.prototype.setVoip=function(a){this.set$Value(8,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasVoip=function(){return this.has$Value(8)};i18n.phonenumbers.PhoneMetadata.prototype.voipCount=function(){return this.count$Values(8)};i18n.phonenumbers.PhoneMetadata.prototype.clearVoip=function(){this.clear$Field(8)};i18n.phonenumbers.PhoneMetadata.prototype.getPager=function(){return this.get$Value(21)};i18n.phonenumbers.PhoneMetadata.prototype.getPagerOrDefault=function(){return this.get$ValueOrDefault(21)};\ni18n.phonenumbers.PhoneMetadata.prototype.setPager=function(a){this.set$Value(21,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasPager=function(){return this.has$Value(21)};i18n.phonenumbers.PhoneMetadata.prototype.pagerCount=function(){return this.count$Values(21)};i18n.phonenumbers.PhoneMetadata.prototype.clearPager=function(){this.clear$Field(21)};i18n.phonenumbers.PhoneMetadata.prototype.getUan=function(){return this.get$Value(25)};i18n.phonenumbers.PhoneMetadata.prototype.getUanOrDefault=function(){return this.get$ValueOrDefault(25)};\ni18n.phonenumbers.PhoneMetadata.prototype.setUan=function(a){this.set$Value(25,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasUan=function(){return this.has$Value(25)};i18n.phonenumbers.PhoneMetadata.prototype.uanCount=function(){return this.count$Values(25)};i18n.phonenumbers.PhoneMetadata.prototype.clearUan=function(){this.clear$Field(25)};i18n.phonenumbers.PhoneMetadata.prototype.getEmergency=function(){return this.get$Value(27)};\ni18n.phonenumbers.PhoneMetadata.prototype.getEmergencyOrDefault=function(){return this.get$ValueOrDefault(27)};i18n.phonenumbers.PhoneMetadata.prototype.setEmergency=function(a){this.set$Value(27,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasEmergency=function(){return this.has$Value(27)};i18n.phonenumbers.PhoneMetadata.prototype.emergencyCount=function(){return this.count$Values(27)};i18n.phonenumbers.PhoneMetadata.prototype.clearEmergency=function(){this.clear$Field(27)};\ni18n.phonenumbers.PhoneMetadata.prototype.getVoicemail=function(){return this.get$Value(28)};i18n.phonenumbers.PhoneMetadata.prototype.getVoicemailOrDefault=function(){return this.get$ValueOrDefault(28)};i18n.phonenumbers.PhoneMetadata.prototype.setVoicemail=function(a){this.set$Value(28,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasVoicemail=function(){return this.has$Value(28)};i18n.phonenumbers.PhoneMetadata.prototype.voicemailCount=function(){return this.count$Values(28)};\ni18n.phonenumbers.PhoneMetadata.prototype.clearVoicemail=function(){this.clear$Field(28)};i18n.phonenumbers.PhoneMetadata.prototype.getNoInternationalDialling=function(){return this.get$Value(24)};i18n.phonenumbers.PhoneMetadata.prototype.getNoInternationalDiallingOrDefault=function(){return this.get$ValueOrDefault(24)};i18n.phonenumbers.PhoneMetadata.prototype.setNoInternationalDialling=function(a){this.set$Value(24,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasNoInternationalDialling=function(){return this.has$Value(24)};\ni18n.phonenumbers.PhoneMetadata.prototype.noInternationalDiallingCount=function(){return this.count$Values(24)};i18n.phonenumbers.PhoneMetadata.prototype.clearNoInternationalDialling=function(){this.clear$Field(24)};i18n.phonenumbers.PhoneMetadata.prototype.getId=function(){return this.get$Value(9)};i18n.phonenumbers.PhoneMetadata.prototype.getIdOrDefault=function(){return this.get$ValueOrDefault(9)};i18n.phonenumbers.PhoneMetadata.prototype.setId=function(a){this.set$Value(9,a)};\ni18n.phonenumbers.PhoneMetadata.prototype.hasId=function(){return this.has$Value(9)};i18n.phonenumbers.PhoneMetadata.prototype.idCount=function(){return this.count$Values(9)};i18n.phonenumbers.PhoneMetadata.prototype.clearId=function(){this.clear$Field(9)};i18n.phonenumbers.PhoneMetadata.prototype.getCountryCode=function(){return this.get$Value(10)};i18n.phonenumbers.PhoneMetadata.prototype.getCountryCodeOrDefault=function(){return this.get$ValueOrDefault(10)};\ni18n.phonenumbers.PhoneMetadata.prototype.setCountryCode=function(a){this.set$Value(10,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasCountryCode=function(){return this.has$Value(10)};i18n.phonenumbers.PhoneMetadata.prototype.countryCodeCount=function(){return this.count$Values(10)};i18n.phonenumbers.PhoneMetadata.prototype.clearCountryCode=function(){this.clear$Field(10)};i18n.phonenumbers.PhoneMetadata.prototype.getInternationalPrefix=function(){return this.get$Value(11)};\ni18n.phonenumbers.PhoneMetadata.prototype.getInternationalPrefixOrDefault=function(){return this.get$ValueOrDefault(11)};i18n.phonenumbers.PhoneMetadata.prototype.setInternationalPrefix=function(a){this.set$Value(11,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasInternationalPrefix=function(){return this.has$Value(11)};i18n.phonenumbers.PhoneMetadata.prototype.internationalPrefixCount=function(){return this.count$Values(11)};i18n.phonenumbers.PhoneMetadata.prototype.clearInternationalPrefix=function(){this.clear$Field(11)};\ni18n.phonenumbers.PhoneMetadata.prototype.getPreferredInternationalPrefix=function(){return this.get$Value(17)};i18n.phonenumbers.PhoneMetadata.prototype.getPreferredInternationalPrefixOrDefault=function(){return this.get$ValueOrDefault(17)};i18n.phonenumbers.PhoneMetadata.prototype.setPreferredInternationalPrefix=function(a){this.set$Value(17,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasPreferredInternationalPrefix=function(){return this.has$Value(17)};\ni18n.phonenumbers.PhoneMetadata.prototype.preferredInternationalPrefixCount=function(){return this.count$Values(17)};i18n.phonenumbers.PhoneMetadata.prototype.clearPreferredInternationalPrefix=function(){this.clear$Field(17)};i18n.phonenumbers.PhoneMetadata.prototype.getNationalPrefix=function(){return this.get$Value(12)};i18n.phonenumbers.PhoneMetadata.prototype.getNationalPrefixOrDefault=function(){return this.get$ValueOrDefault(12)};\ni18n.phonenumbers.PhoneMetadata.prototype.setNationalPrefix=function(a){this.set$Value(12,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasNationalPrefix=function(){return this.has$Value(12)};i18n.phonenumbers.PhoneMetadata.prototype.nationalPrefixCount=function(){return this.count$Values(12)};i18n.phonenumbers.PhoneMetadata.prototype.clearNationalPrefix=function(){this.clear$Field(12)};i18n.phonenumbers.PhoneMetadata.prototype.getPreferredExtnPrefix=function(){return this.get$Value(13)};\ni18n.phonenumbers.PhoneMetadata.prototype.getPreferredExtnPrefixOrDefault=function(){return this.get$ValueOrDefault(13)};i18n.phonenumbers.PhoneMetadata.prototype.setPreferredExtnPrefix=function(a){this.set$Value(13,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasPreferredExtnPrefix=function(){return this.has$Value(13)};i18n.phonenumbers.PhoneMetadata.prototype.preferredExtnPrefixCount=function(){return this.count$Values(13)};i18n.phonenumbers.PhoneMetadata.prototype.clearPreferredExtnPrefix=function(){this.clear$Field(13)};\ni18n.phonenumbers.PhoneMetadata.prototype.getNationalPrefixForParsing=function(){return this.get$Value(15)};i18n.phonenumbers.PhoneMetadata.prototype.getNationalPrefixForParsingOrDefault=function(){return this.get$ValueOrDefault(15)};i18n.phonenumbers.PhoneMetadata.prototype.setNationalPrefixForParsing=function(a){this.set$Value(15,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasNationalPrefixForParsing=function(){return this.has$Value(15)};\ni18n.phonenumbers.PhoneMetadata.prototype.nationalPrefixForParsingCount=function(){return this.count$Values(15)};i18n.phonenumbers.PhoneMetadata.prototype.clearNationalPrefixForParsing=function(){this.clear$Field(15)};i18n.phonenumbers.PhoneMetadata.prototype.getNationalPrefixTransformRule=function(){return this.get$Value(16)};i18n.phonenumbers.PhoneMetadata.prototype.getNationalPrefixTransformRuleOrDefault=function(){return this.get$ValueOrDefault(16)};\ni18n.phonenumbers.PhoneMetadata.prototype.setNationalPrefixTransformRule=function(a){this.set$Value(16,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasNationalPrefixTransformRule=function(){return this.has$Value(16)};i18n.phonenumbers.PhoneMetadata.prototype.nationalPrefixTransformRuleCount=function(){return this.count$Values(16)};i18n.phonenumbers.PhoneMetadata.prototype.clearNationalPrefixTransformRule=function(){this.clear$Field(16)};\ni18n.phonenumbers.PhoneMetadata.prototype.getSameMobileAndFixedLinePattern=function(){return this.get$Value(18)};i18n.phonenumbers.PhoneMetadata.prototype.getSameMobileAndFixedLinePatternOrDefault=function(){return this.get$ValueOrDefault(18)};i18n.phonenumbers.PhoneMetadata.prototype.setSameMobileAndFixedLinePattern=function(a){this.set$Value(18,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasSameMobileAndFixedLinePattern=function(){return this.has$Value(18)};\ni18n.phonenumbers.PhoneMetadata.prototype.sameMobileAndFixedLinePatternCount=function(){return this.count$Values(18)};i18n.phonenumbers.PhoneMetadata.prototype.clearSameMobileAndFixedLinePattern=function(){this.clear$Field(18)};i18n.phonenumbers.PhoneMetadata.prototype.getNumberFormat=function(a){return this.get$Value(19,a)};i18n.phonenumbers.PhoneMetadata.prototype.getNumberFormatOrDefault=function(a){return this.get$ValueOrDefault(19,a)};\ni18n.phonenumbers.PhoneMetadata.prototype.addNumberFormat=function(a){this.add$Value(19,a)};i18n.phonenumbers.PhoneMetadata.prototype.numberFormatArray=function(){return this.array$Values(19)};i18n.phonenumbers.PhoneMetadata.prototype.hasNumberFormat=function(){return this.has$Value(19)};i18n.phonenumbers.PhoneMetadata.prototype.numberFormatCount=function(){return this.count$Values(19)};i18n.phonenumbers.PhoneMetadata.prototype.clearNumberFormat=function(){this.clear$Field(19)};\ni18n.phonenumbers.PhoneMetadata.prototype.getIntlNumberFormat=function(a){return this.get$Value(20,a)};i18n.phonenumbers.PhoneMetadata.prototype.getIntlNumberFormatOrDefault=function(a){return this.get$ValueOrDefault(20,a)};i18n.phonenumbers.PhoneMetadata.prototype.addIntlNumberFormat=function(a){this.add$Value(20,a)};i18n.phonenumbers.PhoneMetadata.prototype.intlNumberFormatArray=function(){return this.array$Values(20)};i18n.phonenumbers.PhoneMetadata.prototype.hasIntlNumberFormat=function(){return this.has$Value(20)};\ni18n.phonenumbers.PhoneMetadata.prototype.intlNumberFormatCount=function(){return this.count$Values(20)};i18n.phonenumbers.PhoneMetadata.prototype.clearIntlNumberFormat=function(){this.clear$Field(20)};i18n.phonenumbers.PhoneMetadata.prototype.getMainCountryForCode=function(){return this.get$Value(22)};i18n.phonenumbers.PhoneMetadata.prototype.getMainCountryForCodeOrDefault=function(){return this.get$ValueOrDefault(22)};\ni18n.phonenumbers.PhoneMetadata.prototype.setMainCountryForCode=function(a){this.set$Value(22,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasMainCountryForCode=function(){return this.has$Value(22)};i18n.phonenumbers.PhoneMetadata.prototype.mainCountryForCodeCount=function(){return this.count$Values(22)};i18n.phonenumbers.PhoneMetadata.prototype.clearMainCountryForCode=function(){this.clear$Field(22)};i18n.phonenumbers.PhoneMetadata.prototype.getLeadingDigits=function(){return this.get$Value(23)};\ni18n.phonenumbers.PhoneMetadata.prototype.getLeadingDigitsOrDefault=function(){return this.get$ValueOrDefault(23)};i18n.phonenumbers.PhoneMetadata.prototype.setLeadingDigits=function(a){this.set$Value(23,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasLeadingDigits=function(){return this.has$Value(23)};i18n.phonenumbers.PhoneMetadata.prototype.leadingDigitsCount=function(){return this.count$Values(23)};i18n.phonenumbers.PhoneMetadata.prototype.clearLeadingDigits=function(){this.clear$Field(23)};\ni18n.phonenumbers.PhoneMetadata.prototype.getLeadingZeroPossible=function(){return this.get$Value(26)};i18n.phonenumbers.PhoneMetadata.prototype.getLeadingZeroPossibleOrDefault=function(){return this.get$ValueOrDefault(26)};i18n.phonenumbers.PhoneMetadata.prototype.setLeadingZeroPossible=function(a){this.set$Value(26,a)};i18n.phonenumbers.PhoneMetadata.prototype.hasLeadingZeroPossible=function(){return this.has$Value(26)};i18n.phonenumbers.PhoneMetadata.prototype.leadingZeroPossibleCount=function(){return this.count$Values(26)};\ni18n.phonenumbers.PhoneMetadata.prototype.clearLeadingZeroPossible=function(){this.clear$Field(26)};i18n.phonenumbers.PhoneMetadataCollection=function(){goog.proto2.Message.apply(this)};goog.inherits(i18n.phonenumbers.PhoneMetadataCollection,goog.proto2.Message);i18n.phonenumbers.PhoneMetadataCollection.prototype.getMetadata=function(a){return this.get$Value(1,a)};i18n.phonenumbers.PhoneMetadataCollection.prototype.getMetadataOrDefault=function(a){return this.get$ValueOrDefault(1,a)};\ni18n.phonenumbers.PhoneMetadataCollection.prototype.addMetadata=function(a){this.add$Value(1,a)};i18n.phonenumbers.PhoneMetadataCollection.prototype.metadataArray=function(){return this.array$Values(1)};i18n.phonenumbers.PhoneMetadataCollection.prototype.hasMetadata=function(){return this.has$Value(1)};i18n.phonenumbers.PhoneMetadataCollection.prototype.metadataCount=function(){return this.count$Values(1)};i18n.phonenumbers.PhoneMetadataCollection.prototype.clearMetadata=function(){this.clear$Field(1)};\ngoog.proto2.Message.set$Metadata(i18n.phonenumbers.NumberFormat,{\"0\":{name:\"NumberFormat\",fullName:\"i18n.phonenumbers.NumberFormat\"},1:{name:\"pattern\",required:!0,fieldType:goog.proto2.Message.FieldType.STRING,type:String},2:{name:\"format\",required:!0,fieldType:goog.proto2.Message.FieldType.STRING,type:String},3:{name:\"leading_digits_pattern\",repeated:!0,fieldType:goog.proto2.Message.FieldType.STRING,type:String},4:{name:\"national_prefix_formatting_rule\",fieldType:goog.proto2.Message.FieldType.STRING,\ntype:String},6:{name:\"national_prefix_optional_when_formatting\",fieldType:goog.proto2.Message.FieldType.BOOL,type:Boolean},5:{name:\"domestic_carrier_code_formatting_rule\",fieldType:goog.proto2.Message.FieldType.STRING,type:String}});\ngoog.proto2.Message.set$Metadata(i18n.phonenumbers.PhoneNumberDesc,{\"0\":{name:\"PhoneNumberDesc\",fullName:\"i18n.phonenumbers.PhoneNumberDesc\"},2:{name:\"national_number_pattern\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},3:{name:\"possible_number_pattern\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},6:{name:\"example_number\",fieldType:goog.proto2.Message.FieldType.STRING,type:String}});\ngoog.proto2.Message.set$Metadata(i18n.phonenumbers.PhoneMetadata,{\"0\":{name:\"PhoneMetadata\",fullName:\"i18n.phonenumbers.PhoneMetadata\"},1:{name:\"general_desc\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},2:{name:\"fixed_line\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},3:{name:\"mobile\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},4:{name:\"toll_free\",\nrequired:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},5:{name:\"premium_rate\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},6:{name:\"shared_cost\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},7:{name:\"personal_number\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},8:{name:\"voip\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,\ntype:i18n.phonenumbers.PhoneNumberDesc},21:{name:\"pager\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},25:{name:\"uan\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},27:{name:\"emergency\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},28:{name:\"voicemail\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},\n24:{name:\"no_international_dialling\",required:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneNumberDesc},9:{name:\"id\",required:!0,fieldType:goog.proto2.Message.FieldType.STRING,type:String},10:{name:\"country_code\",required:!0,fieldType:goog.proto2.Message.FieldType.INT32,type:Number},11:{name:\"international_prefix\",required:!0,fieldType:goog.proto2.Message.FieldType.STRING,type:String},17:{name:\"preferred_international_prefix\",fieldType:goog.proto2.Message.FieldType.STRING,\ntype:String},12:{name:\"national_prefix\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},13:{name:\"preferred_extn_prefix\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},15:{name:\"national_prefix_for_parsing\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},16:{name:\"national_prefix_transform_rule\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},18:{name:\"same_mobile_and_fixed_line_pattern\",fieldType:goog.proto2.Message.FieldType.BOOL,defaultValue:!1,\ntype:Boolean},19:{name:\"number_format\",repeated:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.NumberFormat},20:{name:\"intl_number_format\",repeated:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.NumberFormat},22:{name:\"main_country_for_code\",fieldType:goog.proto2.Message.FieldType.BOOL,defaultValue:!1,type:Boolean},23:{name:\"leading_digits\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},26:{name:\"leading_zero_possible\",fieldType:goog.proto2.Message.FieldType.BOOL,\ndefaultValue:!1,type:Boolean}});goog.proto2.Message.set$Metadata(i18n.phonenumbers.PhoneMetadataCollection,{\"0\":{name:\"PhoneMetadataCollection\",fullName:\"i18n.phonenumbers.PhoneMetadataCollection\"},1:{name:\"metadata\",repeated:!0,fieldType:goog.proto2.Message.FieldType.MESSAGE,type:i18n.phonenumbers.PhoneMetadata}});/*\n\n Copyright (C) 2010 The Libphonenumber Authors\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\ni18n.phonenumbers.metadata={};\ni18n.phonenumbers.metadata.countryCodeToRegionCodeMap={1:\"US AG AI AS BB BM BS CA DM DO GD GU JM KN KY LC MP MS PR SX TC TT VC VG VI\".split(\" \"),7:[\"RU\",\"KZ\"],20:[\"EG\"],27:[\"ZA\"],30:[\"GR\"],31:[\"NL\"],32:[\"BE\"],33:[\"FR\"],34:[\"ES\"],36:[\"HU\"],39:[\"IT\"],40:[\"RO\"],41:[\"CH\"],43:[\"AT\"],44:[\"GB\",\"GG\",\"IM\",\"JE\"],45:[\"DK\"],46:[\"SE\"],47:[\"NO\",\"SJ\"],48:[\"PL\"],49:[\"DE\"],51:[\"PE\"],52:[\"MX\"],53:[\"CU\"],54:[\"AR\"],55:[\"BR\"],56:[\"CL\"],57:[\"CO\"],58:[\"VE\"],60:[\"MY\"],61:[\"AU\",\"CC\",\"CX\"],62:[\"ID\"],63:[\"PH\"],64:[\"NZ\"],65:[\"SG\"],\n66:[\"TH\"],81:[\"JP\"],82:[\"KR\"],84:[\"VN\"],86:[\"CN\"],90:[\"TR\"],91:[\"IN\"],92:[\"PK\"],93:[\"AF\"],94:[\"LK\"],95:[\"MM\"],98:[\"IR\"],211:[\"SS\"],212:[\"MA\",\"EH\"],213:[\"DZ\"],216:[\"TN\"],218:[\"LY\"],220:[\"GM\"],221:[\"SN\"],222:[\"MR\"],223:[\"ML\"],224:[\"GN\"],225:[\"CI\"],226:[\"BF\"],227:[\"NE\"],228:[\"TG\"],229:[\"BJ\"],230:[\"MU\"],231:[\"LR\"],232:[\"SL\"],233:[\"GH\"],234:[\"NG\"],235:[\"TD\"],236:[\"CF\"],237:[\"CM\"],238:[\"CV\"],239:[\"ST\"],240:[\"GQ\"],241:[\"GA\"],242:[\"CG\"],243:[\"CD\"],244:[\"AO\"],245:[\"GW\"],246:[\"IO\"],247:[\"AC\"],248:[\"SC\"],249:[\"SD\"],\n250:[\"RW\"],251:[\"ET\"],252:[\"SO\"],253:[\"DJ\"],254:[\"KE\"],255:[\"TZ\"],256:[\"UG\"],257:[\"BI\"],258:[\"MZ\"],260:[\"ZM\"],261:[\"MG\"],262:[\"RE\",\"YT\"],263:[\"ZW\"],264:[\"NA\"],265:[\"MW\"],266:[\"LS\"],267:[\"BW\"],268:[\"SZ\"],269:[\"KM\"],290:[\"SH\"],291:[\"ER\"],297:[\"AW\"],298:[\"FO\"],299:[\"GL\"],350:[\"GI\"],351:[\"PT\"],352:[\"LU\"],353:[\"IE\"],354:[\"IS\"],355:[\"AL\"],356:[\"MT\"],357:[\"CY\"],358:[\"FI\",\"AX\"],359:[\"BG\"],370:[\"LT\"],371:[\"LV\"],372:[\"EE\"],373:[\"MD\"],374:[\"AM\"],375:[\"BY\"],376:[\"AD\"],377:[\"MC\"],378:[\"SM\"],379:[\"VA\"],380:[\"UA\"],\n381:[\"RS\"],382:[\"ME\"],385:[\"HR\"],386:[\"SI\"],387:[\"BA\"],389:[\"MK\"],420:[\"CZ\"],421:[\"SK\"],423:[\"LI\"],500:[\"FK\"],501:[\"BZ\"],502:[\"GT\"],503:[\"SV\"],504:[\"HN\"],505:[\"NI\"],506:[\"CR\"],507:[\"PA\"],508:[\"PM\"],509:[\"HT\"],590:[\"GP\",\"BL\",\"MF\"],591:[\"BO\"],592:[\"GY\"],593:[\"EC\"],594:[\"GF\"],595:[\"PY\"],596:[\"MQ\"],597:[\"SR\"],598:[\"UY\"],599:[\"CW\",\"BQ\"],670:[\"TL\"],672:[\"NF\"],673:[\"BN\"],674:[\"NR\"],675:[\"PG\"],676:[\"TO\"],677:[\"SB\"],678:[\"VU\"],679:[\"FJ\"],680:[\"PW\"],681:[\"WF\"],682:[\"CK\"],683:[\"NU\"],685:[\"WS\"],686:[\"KI\"],687:[\"NC\"],\n688:[\"TV\"],689:[\"PF\"],690:[\"TK\"],691:[\"FM\"],692:[\"MH\"],800:[\"001\"],808:[\"001\"],850:[\"KP\"],852:[\"HK\"],853:[\"MO\"],855:[\"KH\"],856:[\"LA\"],870:[\"001\"],878:[\"001\"],880:[\"BD\"],881:[\"001\"],882:[\"001\"],883:[\"001\"],886:[\"TW\"],888:[\"001\"],960:[\"MV\"],961:[\"LB\"],962:[\"JO\"],963:[\"SY\"],964:[\"IQ\"],965:[\"KW\"],966:[\"SA\"],967:[\"YE\"],968:[\"OM\"],970:[\"PS\"],971:[\"AE\"],972:[\"IL\"],973:[\"BH\"],974:[\"QA\"],975:[\"BT\"],976:[\"MN\"],977:[\"NP\"],979:[\"001\"],992:[\"TJ\"],993:[\"TM\"],994:[\"AZ\"],995:[\"GE\"],996:[\"KG\"],998:[\"UZ\"]};\ni18n.phonenumbers.metadata.countryToMetadata={AC:[,[,,\"[2-467]\\\\d{3}\",\"\\\\d{4}\"],[,,\"(?:[267]\\\\d|3[0-5]|4[4-69])\\\\d{2}\",\"\\\\d{4}\",,,\"6889\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AC\",247,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],AD:[,[,,\"(?:[346-9]|180)\\\\d{5}\",\"\\\\d{6,8}\"],[,,\"[78]\\\\d{5}\",\"\\\\d{6}\",,,\"712345\"],[,,\"[346]\\\\d{5}\",\"\\\\d{6}\",,,\"312345\"],[,,\"180[02]\\\\d{4}\",\"\\\\d{8}\",,,\"18001234\"],[,,\"9\\\\d{5}\",\n\"\\\\d{6}\",,,\"912345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AD\",376,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{3})\",\"$1 $2\",[\"[346-9]\"],\"\",\"\",0],[,\"(180[02])(\\\\d{4})\",\"$1 $2\",[\"1\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[0268]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],AE:[,[,,\"[2-79]\\\\d{7,8}|800\\\\d{2,9}\",\"\\\\d{5,12}\"],[,,\"[2-4679][2-8]\\\\d{6}\",\"\\\\d{7,8}\",,,\"22345678\"],[,,\"5[0256]\\\\d{7}\",\"\\\\d{9}\",,,\"501234567\"],[,,\"400\\\\d{6}|800\\\\d{2,9}\",\"\\\\d{5,12}\",,,\"800123456\"],[,,\"900[02]\\\\d{5}\",\"\\\\d{9}\",,,\n\"900234567\"],[,,\"700[05]\\\\d{5}\",\"\\\\d{9}\",,,\"700012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AE\",971,\"00\",\"0\",,,\"0\",,,,[[,\"([2-4679])(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[2-4679][2-8]\"],\"0$1\",\"\",0],[,\"(5[0256])(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"5\"],\"0$1\",\"\",0],[,\"([479]00)(\\\\d)(\\\\d{5})\",\"$1 $2 $3\",[\"[479]0\"],\"$1\",\"\",0],[,\"([68]00)(\\\\d{2,9})\",\"$1 $2\",[\"60|8\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"600[25]\\\\d{5}\",\"\\\\d{9}\",,,\"600212345\"],,[,,\"112|99[789]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],AF:[,[,,\"[2-7]\\\\d{8}\",\n\"\\\\d{7,9}\"],[,,\"(?:[25][0-8]|[34][0-4]|6[0-5])[2-9]\\\\d{6}\",\"\\\\d{7,9}\",,,\"234567890\"],[,,\"7[057-9]\\\\d{7}\",\"\\\\d{9}\",,,\"701234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AF\",93,\"00\",\"0\",,,\"0\",,,,[[,\"([2-7]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:02|19)\",\"\\\\d{3}\",,,\"119\"],[,,\"NA\",\"NA\"]],AG:[,[,,\"[2589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"268(?:4(?:6[0-38]|84)|56[0-2])\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"2684601234\"],[,\n,\"268(?:464|7(?:2[0-9]|64|7[0-689]|8[02-68]))\\\\d{4}\",\"\\\\d{10}\",,,\"2684641234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"26848[01]\\\\d{4}\",\"\\\\d{10}\",,,\"2684801234\"],\"AG\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"26840[69]\\\\d{4}\",\"\\\\d{10}\",,,\"2684061234\"],,\"268\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|99)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],AI:[,[,,\"[2589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],\n[,,\"2644(?:6[12]|9[78])\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"2644612345\"],[,,\"264(?:235|476|5(?:3[6-9]|8[1-4])|7(?:29|72))\\\\d{4}\",\"\\\\d{10}\",,,\"2642351234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"AI\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"264\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],AL:[,[,,\"[2-57]\\\\d{7}|6\\\\d{8}|8\\\\d{5,7}|9\\\\d{5}\",\n\"\\\\d{5,9}\"],[,,\"(?:2(?:[168][1-9]|[247]\\\\d|9[1-7])|3(?:1[1-3]|[2-6]\\\\d|[79][1-8]|8[1-9])|4\\\\d{2}|5(?:1[1-4]|[2-578]\\\\d|6[1-5]|9[1-7])|8(?:[19][1-5]|[2-6]\\\\d|[78][1-7]))\\\\d{5}\",\"\\\\d{5,8}\",,,\"22345678\"],[,,\"6[6-9]\\\\d{7}\",\"\\\\d{9}\",,,\"661234567\"],[,,\"800\\\\d{4}\",\"\\\\d{7}\",,,\"8001234\"],[,,\"900\\\\d{3}\",\"\\\\d{6}\",,,\"900123\"],[,,\"808\\\\d{3}\",\"\\\\d{6}\",,,\"808123\"],[,,\"700\\\\d{5}\",\"\\\\d{8}\",,,\"70012345\"],[,,\"NA\",\"NA\"],\"AL\",355,\"00\",\"0\",,,\"0\",,,,[[,\"(4)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"4[0-6]\"],\"0$1\",\"\",0],[,\"(6[6-9])(\\\\d{3})(\\\\d{4})\",\n\"$1 $2 $3\",[\"6\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[2358][2-5]|4[7-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3,5})\",\"$1 $2\",[\"[235][16-9]|8[016-9]|[79]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"12[789]\",\"\\\\d{3}\",,,\"129\"],[,,\"NA\",\"NA\"]],AM:[,[,,\"[1-9]\\\\d{7}\",\"\\\\d{5,8}\"],[,,\"(?:1[01]\\\\d|2(?:2[2-46]|3[1-8]|4[2-69]|5[2-7]|6[1-9]|8[1-7])|3[12]2|47\\\\d)\\\\d{5}\",\"\\\\d{5,8}\",,,\"10123456\"],[,,\"(?:55|77|9[1-9])\\\\d{6}\",\"\\\\d{8}\",,,\"77123456\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],\n[,,\"90[016]\\\\d{5}\",\"\\\\d{8}\",,,\"90012345\"],[,,\"80[1-4]\\\\d{5}\",\"\\\\d{8}\",,,\"80112345\"],[,,\"NA\",\"NA\"],[,,\"60[2-6]\\\\d{5}\",\"\\\\d{8}\",,,\"60271234\"],\"AM\",374,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{6})\",\"$1 $2\",[\"1|47\"],\"(0$1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{6})\",\"$1 $2\",[\"[5-7]|9[1-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{5})\",\"$1 $2\",[\"[23]\"],\"(0$1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"8|90\"],\"0 $1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"10[123]\",\"\\\\d{3}\",,,\"102\"],[,,\"NA\",\"NA\"]],AO:[,[,,\"[29]\\\\d{8}\",\n\"\\\\d{9}\"],[,,\"2\\\\d(?:[26-9]\\\\d|\\\\d[26-9])\\\\d{5}\",\"\\\\d{9}\",,,\"222123456\"],[,,\"9[1-4]\\\\d{7}\",\"\\\\d{9}\",,,\"923123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AO\",244,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[235]\",\"\\\\d{3}\",,,\"113\"],[,,\"NA\",\"NA\"]],AR:[,[,,\"[1-368]\\\\d{9}|9\\\\d{10}\",\"\\\\d{6,11}\"],[,,\"11\\\\d{8}|(?:2(?:2(?:[013]\\\\d|2[13-79]|4[1-6]|5[2457]|6[124-8]|7[1-4]|8[13-6]|9[1267])|3(?:1[467]|2[03-6]|3[13-8]|[49][2-6]|5[2-8]|[067]\\\\d)|4(?:7[3-8]|9\\\\d)|6(?:[01346]\\\\d|2[24-6]|5[15-8])|80\\\\d|9(?:[0124789]\\\\d|3[1-6]|5[234]|6[2-46]))|3(?:3(?:2[79]|6\\\\d|8[2578])|4(?:[78]\\\\d|0[0124-9]|[1-35]\\\\d|4[24-7]|6[02-9]|9[123678])|5(?:[138]\\\\d|2[1245]|4[1-9]|6[2-4]|7[1-6])|6[24]\\\\d|7(?:[0469]\\\\d|1[1568]|2[013-9]|3[145]|5[14-8]|7[2-57]|8[0-24-9])|8(?:[013578]\\\\d|2[15-7]|4[13-6]|6[1-357-9]|9[124]))|670\\\\d)\\\\d{6}\",\n\"\\\\d{6,10}\",,,\"1123456789\"],[,,\"675\\\\d{7}|9(?:11[2-9]\\\\d{7}|(?:2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[12358]|5[138]|6[24]|7[069]|8[013578]))[2-9]\\\\d{6}|\\\\d{4}[2-9]\\\\d{5})\",\"\\\\d{6,11}\",,,\"91123456789\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"60[04579]\\\\d{7}\",\"\\\\d{10}\",,,\"6001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AR\",54,\"00\",\"0\",,,\"0?(?:(11|2(?:2(?:02?|[13]|2[13-79]|4[1-6]|5[2457]|6[124-8]|7[1-4]|8[13-6]|9[1267])|3(?:02?|1[467]|2[03-6]|3[13-8]|[49][2-6]|5[2-8]|[67])|4(?:7[3-578]|9)|6(?:[0136]|2[24-6]|4[6-8]?|5[15-8])|80|9(?:0[1-3]|[19]|2\\\\d|3[1-6]|4[02568]?|5[2-4]|6[2-46]|72?|8[23]?))|3(?:3(?:2[79]|6|8[2578])|4(?:0[124-9]|[12]|3[5-8]?|4[24-7]|5[4-68]?|6[02-9]|7[126]|8[2379]?|9[1-36-8])|5(?:1|2[1245]|3[237]?|4[1-46-9]|6[2-4]|7[1-6]|8[2-5]?)|6[24]|7(?:1[1568]|2[15]|3[145]|4[13]|5[14-8]|[069]|7[2-57]|8[126])|8(?:[01]|2[15-7]|3[2578]?|4[13-6]|5[4-8]?|6[1-357-9]|7[36-8]?|8[5-8]?|9[124])))15)?\",\n\"9$1\",,,[[,\"([68]\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"[68]\"],\"0$1\",\"\",0],[,\"(9)(11)(\\\\d{4})(\\\\d{4})\",\"$2 15-$3-$4\",[\"911\"],\"0$1\",\"\",0],[,\"(9)(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$2 15-$3-$4\",[\"9(?:2[234689]|3[3-8])\",\"9(?:2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[12358]|5[138]|6[24]|7[069]|8[013578]))\",\"9(?:2(?:2[013]|3[067]|49|6[01346]|80|9(?:[17-9]|4[13479]))|3(?:36|4[12358]|5(?:[18]|3[014-689])|6[24]|7[069]|8(?:[01]|3[013469]|5[0-39]|7[0-2459]|8[0-49])))\"],\"0$1\",\"\",0],[,\"(9)(\\\\d{4})(\\\\d{3})(\\\\d{3})\",\n\"$2 15-$3-$4\",[\"93[58]\",\"9(?:3(?:53|8[78]))\",\"9(?:3(?:537|8(?:73|88)))\"],\"0$1\",\"\",0],[,\"(9)(\\\\d{4})(\\\\d{2})(\\\\d{4})\",\"$2 15-$3-$4\",[\"9[23]\"],\"0$1\",\"\",0],[,\"(11)(\\\\d{4})(\\\\d{4})\",\"$1 $2-$3\",[\"1\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2-$3\",[\"2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[12358]|5[138]|6[24]|7[069]|8[013578])\",\"2(?:2[013]|3[067]|49|6[01346]|80|9(?:[17-9]|4[13479]))|3(?:36|4[12358]|5(?:[18]|3[0-689])|6[24]|7[069]|8(?:[01]|3[013469]|5[0-39]|7[0-2459]|8[0-49]))\"],\"0$1\",\"\",\n0],[,\"(\\\\d{4})(\\\\d{3})(\\\\d{3})\",\"$1 $2-$3\",[\"3(?:53|8[78])\",\"3(?:537|8(?:73|88))\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{2})(\\\\d{4})\",\"$1 $2-$3\",[\"[23]\"],\"0$1\",\"\",0]],[[,\"([68]\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"[68]\",\"[68]\"],\"0$1\",\"\",0],[,\"(9)(11)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3-$4\",[\"911\"]],[,\"(9)(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3-$4\",[\"9(?:2[234689]|3[3-8])\",\"9(?:2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[12358]|5[138]|6[24]|7[069]|8[013578]))\",\"9(?:2(?:2[013]|3[067]|49|6[01346]|80|9(?:[17-9]|4[13479]))|3(?:36|4[12358]|5(?:[18]|3[014-689])|6[24]|7[069]|8(?:[01]|3[013469]|5[0-39]|7[0-2459]|8[0-49])))\"]],\n[,\"(9)(\\\\d{4})(\\\\d{3})(\\\\d{3})\",\"$2 15-$3-$4\",\"93[58] 9(?:3(?:53|8[78])) 9(?:3(?:537|8(?:73|88))) 93[58] 9(?:3(?:53|8[78])) 9(?:3(?:537|8(?:73|88)))\".split(\" \"),\"0$1\",\"\",0],[,\"(9)(\\\\d{4})(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3-$4\",[\"9[23]\"]],[,\"(11)(\\\\d{4})(\\\\d{4})\",\"$1 $2-$3\",[\"1\",\"1\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2-$3\",[\"2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[12358]|5[138]|6[24]|7[069]|8[013578])\",\"2(?:2[013]|3[067]|49|6[01346]|80|9(?:[17-9]|4[13479]))|3(?:36|4[12358]|5(?:[18]|3[0-689])|6[24]|7[069]|8(?:[01]|3[013469]|5[0-39]|7[0-2459]|8[0-49]))\",\n\"2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[12358]|5[138]|6[24]|7[069]|8[013578])\",\"2(?:2[013]|3[067]|49|6[01346]|80|9(?:[17-9]|4[13479]))|3(?:36|4[12358]|5(?:[18]|3[0-689])|6[24]|7[069]|8(?:[01]|3[013469]|5[0-39]|7[0-2459]|8[0-49]))\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{3})(\\\\d{3})\",\"$1 $2-$3\",[\"3(?:53|8[78])\",\"3(?:537|8(?:73|88))\",\"3(?:53|8[78])\",\"3(?:537|8(?:73|88))\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{2})(\\\\d{4})\",\"$1 $2-$3\",[\"[23]\",\"[23]\"],\"0$1\",\"\",0]],[,,\"NA\",\"NA\"],,,[,,\"810\\\\d{7}\",\"\\\\d{10}\",,,\"8101234567\"],\n[,,\"810\\\\d{7}\",\"\\\\d{10}\",,,\"8101234567\"],,[,,\"1(?:0[017]|28)\",\"\\\\d{3}\",,,\"101\"],[,,\"NA\",\"NA\"]],AS:[,[,,\"[5689]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"6846(?:22|33|44|55|77|88|9[19])\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"6846221234\"],[,,\"684(?:733|258)\\\\d{4}\",\"\\\\d{10}\",,,\"6847331234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"AS\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],\n,\"684\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],AT:[,[,,\"[1-9]\\\\d{3,12}\",\"\\\\d{3,13}\"],[,,\"1\\\\d{3,12}|(?:2(?:1[467]|2[13-8]|5[2357]|6[1-46-8]|7[1-8]|8[124-7]|9[1458])|3(?:1[1-8]|3[23568]|4[5-7]|5[1378]|6[1-38]|8[3-68])|4(?:2[1-8]|35|63|7[1368]|8[2457])|5(?:12|2[1-8]|3[357]|4[147]|5[12578]|6[37])|6(?:13|2[1-47]|4[1-35-8]|5[468]|62)|7(?:2[1-8]|3[25]|4[13478]|5[68]|6[16-8]|7[1-6]|9[45]))\\\\d{3,10}\",\"\\\\d{3,13}\",,,\"1234567890\"],[,,\"6(?:44|5[0-3579]|6[013-9]|[7-9]\\\\d)\\\\d{4,10}\",\n\"\\\\d{7,13}\",,,\"644123456\"],[,,\"80[02]\\\\d{6,10}\",\"\\\\d{9,13}\",,,\"800123456\"],[,,\"(?:711|9(?:0[01]|3[019]))\\\\d{6,10}\",\"\\\\d{9,13}\",,,\"900123456\"],[,,\"8(?:10|2[018])\\\\d{6,10}\",\"\\\\d{9,13}\",,,\"810123456\"],[,,\"NA\",\"NA\"],[,,\"780\\\\d{6,10}\",\"\\\\d{9,13}\",,,\"780123456\"],\"AT\",43,\"00\",\"0\",,,\"0\",,,,[[,\"(1)(\\\\d{3,12})\",\"$1 $2\",[\"1\"],\"0$1\",\"\",0],[,\"(5\\\\d)(\\\\d{3,5})\",\"$1 $2\",[\"5[079]\"],\"0$1\",\"\",0],[,\"(5\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"5[079]\"],\"0$1\",\"\",0],[,\"(5\\\\d)(\\\\d{4})(\\\\d{4,7})\",\"$1 $2 $3\",[\"5[079]\"],\"0$1\",\n\"\",0],[,\"(\\\\d{3})(\\\\d{3,10})\",\"$1 $2\",[\"316|46|51|732|6(?:44|5[0-3579]|[6-9])|7(?:1|[28]0)|[89]\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{3,9})\",\"$1 $2\",[\"2|3(?:1[1-578]|[3-8])|4[2378]|5[2-6]|6(?:[12]|4[1-35-9]|5[468])|7(?:2[1-8]|35|4[1-8]|[57-9])\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"5(?:(?:0[1-9]|17)\\\\d{2,10}|[79]\\\\d{3,11})|720\\\\d{6,10}\",\"\\\\d{5,13}\",,,\"50123\"],,[,,\"1(?:[12]2|33|44)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],AU:[,[,,\"[1-578]\\\\d{5,9}\",\"\\\\d{6,10}\"],[,,\"[237]\\\\d{8}|8(?:[68]\\\\d{3}|7[0-69]\\\\d{2}|9(?:[02-9]\\\\d{2}|1(?:[0-57-9]\\\\d|6[0135-9])))\\\\d{4}\",\n\"\\\\d{8,9}\",,,\"212345678\"],[,,\"14(?:5\\\\d|71)\\\\d{5}|4(?:[0-2]\\\\d|3[0-57-9]|4[47-9]|5[0-35-9]|6[6-9]|[79][07-9]|8[17-9])\\\\d{6}\",\"\\\\d{9}\",,,\"412345678\"],[,,\"180(?:0\\\\d{3}|2)\\\\d{3}\",\"\\\\d{7,10}\",,,\"1800123456\"],[,,\"19(?:0[0126]\\\\d{6}|[13-5]\\\\d{3}|[679]\\\\d{5})\",\"\\\\d{6,10}\",,,\"1900123456\"],[,,\"13(?:00\\\\d{2})?\\\\d{4}\",\"\\\\d{6,10}\",,,\"1300123456\"],[,,\"500\\\\d{6}\",\"\\\\d{9}\",,,\"500123456\"],[,,\"550\\\\d{6}\",\"\\\\d{9}\",,,\"550123456\"],\"AU\",61,\"(?:14(?:1[14]|34|4[17]|[56]6|7[47]|88))?001[14-689]\",\"0\",,,\"0\",,\"0011\",,[[,\"([2378])(\\\\d{4})(\\\\d{4})\",\n\"$1 $2 $3\",[\"[2378]\"],\"(0$1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[45]|14\"],\"0$1\",\"\",0],[,\"(16)(\\\\d{3})(\\\\d{2,4})\",\"$1 $2 $3\",[\"16\"],\"0$1\",\"\",0],[,\"(1[389]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1(?:[38]0|90)\",\"1(?:[38]00|90)\"],\"$1\",\"\",0],[,\"(180)(2\\\\d{3})\",\"$1 $2\",[\"180\",\"1802\"],\"$1\",\"\",0],[,\"(19\\\\d)(\\\\d{3})\",\"$1 $2\",[\"19[13]\"],\"$1\",\"\",0],[,\"(19\\\\d{2})(\\\\d{4})\",\"$1 $2\",[\"19[67]\"],\"$1\",\"\",0],[,\"(13)(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",[\"13[1-9]\"],\"$1\",\"\",0]],,[,,\"16\\\\d{3,7}\",\"\\\\d{5,9}\",,,\"1612345\"],\n1,,[,,\"1(?:3(?:\\\\d{4}|00\\\\d{6})|80(?:0\\\\d{6}|2\\\\d{3}))\",\"\\\\d{6,10}\",,,\"1300123456\"],[,,\"NA\",\"NA\"],,[,,\"000|112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],AW:[,[,,\"[25-9]\\\\d{6}\",\"\\\\d{7}\"],[,,\"5(?:2\\\\d|8[1-9])\\\\d{4}\",\"\\\\d{7}\",,,\"5212345\"],[,,\"(?:5(?:6\\\\d|9[2-478])|6(?:[039]0|22|4[01]|6[0-2])|7[34]\\\\d|9(?:6[45]|9[4-8]))\\\\d{4}\",\"\\\\d{7}\",,,\"5601234\"],[,,\"800\\\\d{4}\",\"\\\\d{7}\",,,\"8001234\"],[,,\"900\\\\d{4}\",\"\\\\d{7}\",,,\"9001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"28\\\\d{5}|501\\\\d{4}\",\"\\\\d{7}\",,,\"5011234\"],\"AW\",297,\"00\",\n,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"100|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],AX:[,[,,\"[135]\\\\d{5,9}|[27]\\\\d{4,9}|4\\\\d{5,10}|6\\\\d{7,8}|8\\\\d{6,9}\",\"\\\\d{5,12}\"],[,,\"18[1-8]\\\\d{3,9}\",\"\\\\d{6,12}\",,,\"1812345678\"],[,,\"4\\\\d{5,10}|50\\\\d{4,8}\",\"\\\\d{6,11}\",,,\"412345678\"],[,,\"800\\\\d{4,7}\",\"\\\\d{7,10}\",,,\"8001234567\"],[,,\"[67]00\\\\d{5,6}\",\"\\\\d{8,9}\",,,\"600123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AX\",358,\"00|99[049]\",\"0\",,,\"0\",,,,,,[,,\"NA\",\n\"NA\"],,,[,,\"[13]00\\\\d{3,7}|2(?:0(?:0\\\\d{3,7}|2[023]\\\\d{1,6}|9[89]\\\\d{1,6}))|60(?:[12]\\\\d{5,6}|6\\\\d{7})|7(?:1\\\\d{7}|3\\\\d{8}|5[03-9]\\\\d{2,7})\",\"\\\\d{5,10}\",,,\"100123\"],[,,\"[13]0\\\\d{4,8}|2(?:0(?:[016-8]\\\\d{3,7}|[2-59]\\\\d{2,7})|9\\\\d{4,8})|60(?:[12]\\\\d{5,6}|6\\\\d{7})|7(?:1\\\\d{7}|3\\\\d{8}|5[03-9]\\\\d{2,7})\",\"\\\\d{5,10}\",,,\"10112345\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],AZ:[,[,,\"[1-9]\\\\d{8}\",\"\\\\d{7,9}\"],[,,\"(?:1[28]\\\\d|2(?:02|1[24]|2[2-4]|33|[45]2|6[23])|365)\\\\d{6}\",\"\\\\d{7,9}\",,,\"123123456\"],[,,\"(?:4[04]|5[015]|60|7[07])\\\\d{7}\",\n\"\\\\d{9}\",,,\"401234567\"],[,,\"88\\\\d{7}\",\"\\\\d{9}\",,,\"881234567\"],[,,\"900200\\\\d{3}\",\"\\\\d{9}\",,,\"900200123\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"AZ\",994,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"(?:1[28]|2(?:[45]2|[0-36])|365)\"],\"(0$1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[4-8]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"9\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[123]|12)\",\"\\\\d{3}\",,,\"101\"],\n[,,\"NA\",\"NA\"]],BA:[,[,,\"[3-9]\\\\d{7,8}\",\"\\\\d{6,9}\"],[,,\"(?:[35]\\\\d|49)\\\\d{6}\",\"\\\\d{6,8}\",,,\"30123456\"],[,,\"6(?:03|44|71|[1-356])\\\\d{6}\",\"\\\\d{8,9}\",,,\"61123456\"],[,,\"8[08]\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"9[0246]\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"8[12]\\\\d{6}\",\"\\\\d{8}\",,,\"82123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BA\",387,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2-$3\",[\"[3-5]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"6[1-356]|[7-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{3})\",\n\"$1 $2 $3 $4\",[\"6[047]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"70[23]\\\\d{5}\",\"\\\\d{8}\",,,\"70223456\"],,[,,\"12[234]\",\"\\\\d{3}\",,,\"122\"],[,,\"NA\",\"NA\"]],BB:[,[,,\"[2589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"246[2-9]\\\\d{6}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"2462345678\"],[,,\"246(?:(?:2[346]|45|82)\\\\d|25[0-4])\\\\d{4}\",\"\\\\d{10}\",,,\"2462501234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],\n[,,\"NA\",\"NA\"],\"BB\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"246\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"[235]11\",\"\\\\d{3}\",,,\"211\"],[,,\"NA\",\"NA\"]],BD:[,[,,\"[2-79]\\\\d{5,9}|1\\\\d{9}|8[0-7]\\\\d{4,8}\",\"\\\\d{6,10}\"],[,,\"2(?:7(?:1[0-267]|2[0-289]|3[0-29]|[46][01]|5[1-3]|7[017]|91)|8(?:0[125]|[139][1-6]|2[0157-9]|6[1-35]|7[1-5]|8[1-8])|9(?:0[0-2]|1[1-4]|2[568]|3[3-6]|5[5-7]|6[0167]|7[15]|8[016-8]))\\\\d{4}|3(?:12?[5-7]\\\\d{2}|0(?:2(?:[025-79]\\\\d|[348]\\\\d{1,2})|3(?:[2-4]\\\\d|[56]\\\\d?))|2(?:1\\\\d{2}|2(?:[12]\\\\d|[35]\\\\d{1,2}|4\\\\d?))|3(?:1\\\\d{2}|2(?:[2356]\\\\d|4\\\\d{1,2}))|4(?:1\\\\d{2}|2(?:2\\\\d{1,2}|[47]|5\\\\d{2}))|5(?:1\\\\d{2}|29)|[67]1\\\\d{2}|8(?:1\\\\d{2}|2(?:2\\\\d{2}|3|4\\\\d))|)\\\\d{3}|4(?:0(?:2(?:[09]\\\\d|7)|33\\\\d{2})|1\\\\d{3}|2(?:1\\\\d{2}|2(?:[25]\\\\d?|[348]\\\\d|[67]\\\\d{1,2}))|3(?:1\\\\d{2}(?:\\\\d{2})?|2(?:[045]\\\\d|[236-9]\\\\d{1,2})|32\\\\d{2})|4(?:[18]\\\\d{2}|2(?:[2-46]\\\\d{2}|3)|5[25]\\\\d{2})|5(?:1\\\\d{2}|2(?:3\\\\d|5))|6(?:[18]\\\\d{2}|2(?:3(?:\\\\d{2})?|[46]\\\\d{1,2}|5\\\\d{2}|7\\\\d)|5(?:3\\\\d?|4\\\\d|[57]\\\\d{1,2}|6\\\\d{2}|8))|71\\\\d{2}|8(?:[18]\\\\d{2}|23\\\\d{2}|54\\\\d{2})|9(?:[18]\\\\d{2}|2[2-5]\\\\d{2}|53\\\\d{1,2}))\\\\d{3}|5(?:02[03489]\\\\d{2}|1\\\\d{2}|2(?:1\\\\d{2}|2(?:2(?:\\\\d{2})?|[457]\\\\d{2}))|3(?:1\\\\d{2}|2(?:[37](?:\\\\d{2})?|[569]\\\\d{2}))|4(?:1\\\\d{2}|2[46]\\\\d{2})|5(?:1\\\\d{2}|26\\\\d{1,2})|6(?:[18]\\\\d{2}|2|53\\\\d{2})|7(?:1|24)\\\\d{2}|8(?:1|26)\\\\d{2}|91\\\\d{2})\\\\d{3}|6(?:0(?:1\\\\d{2}|2(?:3\\\\d{2}|4\\\\d{1,2}))|2(?:2[2-5]\\\\d{2}|5(?:[3-5]\\\\d{2}|7)|8\\\\d{2})|3(?:1|2[3478])\\\\d{2}|4(?:1|2[34])\\\\d{2}|5(?:1|2[47])\\\\d{2}|6(?:[18]\\\\d{2}|6(?:2(?:2\\\\d|[34]\\\\d{2})|5(?:[24]\\\\d{2}|3\\\\d|5\\\\d{1,2})))|72[2-5]\\\\d{2}|8(?:1\\\\d{2}|2[2-5]\\\\d{2})|9(?:1\\\\d{2}|2[2-6]\\\\d{2}))\\\\d{3}|7(?:(?:02|[3-589]1|6[12]|72[24])\\\\d{2}|21\\\\d{3}|32)\\\\d{3}|8(?:(?:4[12]|[5-7]2|1\\\\d?)|(?:0|3[12]|[5-7]1|217)\\\\d)\\\\d{4}|9(?:[35]1|(?:[024]2|81)\\\\d|(?:1|[24]1)\\\\d{2})\\\\d{3}\",\n\"\\\\d{6,9}\",,,\"27111234\"],[,,\"(?:1[13-9]\\\\d|(?:3[78]|44)[02-9]|6(?:44|6[02-9]))\\\\d{7}\",\"\\\\d{10}\",,,\"1812345678\"],[,,\"80[03]\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"96(?:0[49]|1[0-4]|6[69])\\\\d{6}\",\"\\\\d{10}\",,,\"9604123456\"],\"BD\",880,\"00[12]?\",\"0\",,,\"0\",,\"00\",,[[,\"(2)(\\\\d{7})\",\"$1-$2\",[\"2\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{4,6})\",\"$1-$2\",[\"[3-79]1\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{3,6})\",\"$1-$2\",[\"1|3(?:0|[2-58]2)|4(?:0|[25]2|3[23]|[4689][25])|5(?:[02-578]2|6[25])|6(?:[0347-9]2|[26][25])|7[02-9]2|8(?:[023][23]|[4-7]2)|9(?:[02][23]|[458]2|6[016])\"],\n\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3,7})\",\"$1-$2\",[\"[3-79][2-9]|8\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"10[0-2]|999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],BE:[,[,,\"[1-9]\\\\d{7,8}\",\"\\\\d{8,9}\"],[,,\"(?:1[0-69]|[23][2-8]|[49][23]|5\\\\d|6[013-57-9]|71)\\\\d{6}|8(?:0[1-9]|[1-79]\\\\d)\\\\d{5}\",\"\\\\d{8}\",,,\"12345678\"],[,,\"4(?:[679]\\\\d|8[03-9])\\\\d{6}\",\"\\\\d{9}\",,,\"470123456\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"(?:90|7[07])\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n\"BE\",32,\"00\",\"0\",,,\"0\",,,,[[,\"(4[6-9]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"4[6-9]\"],\"0$1\",\"\",0],[,\"([2-49])(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[23]|[49][23]\"],\"0$1\",\"\",0],[,\"([15-8]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[156]|7[0178]|8(?:0[1-9]|[1-79])\"],\"0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"(?:80|9)0\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"78\\\\d{6}\",\"\\\\d{8}\",,,\"78123456\"],,[,,\"1(?:0[01]|12)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],BF:[,[,,\"[24-7]\\\\d{7}\",\n\"\\\\d{8}\"],[,,\"(?:20(?:49|5[23]|9[016-9])|40(?:4[56]|5[4-6]|7[0179])|50[34]\\\\d)\\\\d{4}\",\"\\\\d{8}\",,,\"20491234\"],[,,\"6(?:[0156]\\\\d|[28][0-5]|4[01])\\\\d{5}|7\\\\d{7}\",\"\\\\d{8}\",,,\"70123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BF\",226,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[78]\",\"\\\\d{2}\",,,\"17\"],[,,\"NA\",\"NA\"]],BG:[,[,,\"[23567]\\\\d{5,7}|[489]\\\\d{6,8}\",\"\\\\d{5,9}\"],[,,\"2(?:[0-8]\\\\d{5,6}|9\\\\d{4,6})|(?:[36]\\\\d|5[1-9]|8[1-6]|9[1-7])\\\\d{5,6}|(?:4(?:[124-7]\\\\d|3[1-6])|7(?:0[1-9]|[1-9]\\\\d))\\\\d{4,5}\",\n\"\\\\d{5,8}\",,,\"2123456\"],[,,\"(?:8[7-9]|98)\\\\d{7}|4(?:3[0789]|8\\\\d)\\\\d{5}\",\"\\\\d{8,9}\",,,\"48123456\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"90\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"NA\",\"NA\"],[,,\"700\\\\d{5}\",\"\\\\d{5,9}\",,,\"70012345\"],[,,\"NA\",\"NA\"],\"BG\",359,\"00\",\"0\",,,\"0\",,,,[[,\"(2)(\\\\d{5})\",\"$1 $2\",[\"29\"],\"0$1\",\"\",0],[,\"(2)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"2\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"43[124-7]|70[1-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{2})\",\"$1 $2 $3\",[\"43[124-7]|70[1-9]\"],\"0$1\",\"\",\n0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"[78]00\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{2,3})\",\"$1 $2 $3\",[\"[356]|7[1-9]|8[1-6]|9[1-7]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"48|8[7-9]|9[08]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|50|6[06])\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],BH:[,[,,\"[136-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:1(?:3[3-6]|6[0156]|7\\\\d)\\\\d|6(?:1[16]\\\\d|6(?:0\\\\d|3[12]|44)|9(?:69|9[6-9]))|77\\\\d{2})\\\\d{4}\",\"\\\\d{8}\",,,\"17001234\"],[,,\"(?:3(?:[23469]\\\\d|5[35]|77|8[348])\\\\d|6(?:1[16]\\\\d|3(?:00|33|6[16])|6(?:[069]\\\\d|3[03-9]|44)|9(?:69|9[6-9]))|77\\\\d{2})\\\\d{4}\",\n\"\\\\d{8}\",,,\"36001234\"],[,,\"80\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"(?:87|9[014578])\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"84\\\\d{6}\",\"\\\\d{8}\",,,\"84123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BH\",973,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],BI:[,[,,\"[27]\\\\d{7}\",\"\\\\d{8}\"],[,,\"22(?:2[0-7]|[3-5]0)\\\\d{4}\",\"\\\\d{8}\",,,\"22201234\"],[,,\"(?:29\\\\d|7(?:1[1-3]|[4-9]\\\\d))\\\\d{5}\",\"\\\\d{8}\",,,\"79561234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BI\",257,\"00\",,,,,,,,[[,\"([27]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[78]\",\"\\\\d{3}\",,,\"117\"],[,,\"NA\",\"NA\"]],BJ:[,[,,\"[2689]\\\\d{7}|7\\\\d{3}\",\"\\\\d{4,8}\"],[,,\"2(?:02|1[037]|2[45]|3[68])\\\\d{5}\",\"\\\\d{8}\",,,\"20211234\"],[,,\"(?:6[46]|9[03-8])\\\\d{6}\",\"\\\\d{8}\",,,\"90011234\"],[,,\"7[3-5]\\\\d{2}\",\"\\\\d{4}\",,,\"7312\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"857[58]\\\\d{4}\",\"\\\\d{8}\",,,\"85751234\"],\"BJ\",229,\n\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"81\\\\d{6}\",\"\\\\d{8}\",,,\"81123456\"],,[,,\"11[78]\",\"\\\\d{3}\",,,\"117\"],[,,\"NA\",\"NA\"]],BL:[,[,,\"[56]\\\\d{8}\",\"\\\\d{9}\"],[,,\"590(?:2[7-9]|5[12]|87)\\\\d{4}\",\"\\\\d{9}\",,,\"590271234\"],[,,\"690(?:10|2[27]|66|77|8[78])\\\\d{4}\",\"\\\\d{9}\",,,\"690221234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BL\",590,\"00\",\"0\",,,\"0\",,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"18\",\"\\\\d{2}\",\n,,\"18\"],[,,\"NA\",\"NA\"]],BM:[,[,,\"[4589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"441(?:2(?:02|23|61|[3479]\\\\d)|[46]\\\\d{2}|5(?:4\\\\d|60|89)|824)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"4412345678\"],[,,\"441(?:[37]\\\\d|5[0-39])\\\\d{5}\",\"\\\\d{10}\",,,\"4413701234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"BM\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"441\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],BN:[,[,,\"[2-578]\\\\d{6}\",\"\\\\d{7}\"],[,,\"[2-5]\\\\d{6}\",\"\\\\d{7}\",,,\"2345678\"],[,,\"[78]\\\\d{6}\",\"\\\\d{7}\",,,\"7123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BN\",673,\"00\",,,,,,,,[[,\"([2-578]\\\\d{2})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"99[135]\",\"\\\\d{3}\",,,\"991\"],[,,\"NA\",\"NA\"]],BO:[,[,,\"[23467]\\\\d{7}\",\"\\\\d{7,8}\"],[,,\"(?:2(?:2\\\\d{2}|5(?:11|[258]\\\\d|9[67])|6(?:12|2\\\\d|9[34])|8(?:2[34]|39|62))|3(?:3\\\\d{2}|4(?:6\\\\d|8[24])|8(?:25|42|5[257]|86|9[25])|9(?:2\\\\d|3[234]|4[248]|5[24]|6[2-6]|7\\\\d))|4(?:4\\\\d{2}|6(?:11|[24689]\\\\d|72)))\\\\d{4}\",\n\"\\\\d{7,8}\",,,\"22123456\"],[,,\"[67]\\\\d{7}\",\"\\\\d{8}\",,,\"71234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BO\",591,\"00(1\\\\d)?\",\"0\",,,\"0(1\\\\d)?\",,,,[[,\"([234])(\\\\d{7})\",\"$1 $2\",[\"[234]\"],\"\",\"0$CC $1\",0],[,\"([67]\\\\d{7})\",\"$1\",[\"[67]\"],\"\",\"0$CC $1\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[089]\",\"\\\\d{3}\",,,\"110\"],[,,\"NA\",\"NA\"]],BQ:[,[,,\"[347]\\\\d{6}\",\"\\\\d{7}\"],[,,\"(?:318[023]|416[0239]|7(?:1[578]|50)\\\\d)\\\\d{3}\",\"\\\\d{7}\",,,\"7151234\"],[,,\"(?:318[1456]|416[15-8]|7(?:0[01]|[89]\\\\d)\\\\d)\\\\d{3}|\",\n\"\\\\d{7}\",,,\"3181234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BQ\",599,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|911\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],BR:[,[,,\"[1-46-9]\\\\d{7,10}|5\\\\d{8,9}\",\"\\\\d{8,11}\"],[,,\"1[1-9][2-5]\\\\d{7}|(?:[4689][1-9]|2[12478]|3[1-578]|5[13-5]|7[13-579])[2-5]\\\\d{7}\",\"\\\\d{8,11}\",,,\"1123456789\"],[,,\"1(?:1(?:5[347]|[6-9]\\\\d|)|[2-9][6-9]\\\\d)\\\\d{6}|(?:2[12478]|3[1-578]|[4689][1-9]|5[13-5]|7[13-579])[6-9]\\\\d{7}|(?:119\\\\d|1[2-9]9[6-9])\\\\d{7}\",\n\"\\\\d{10,11}\",,,\"1161234567\"],[,,\"800\\\\d{6,7}\",\"\\\\d{8,11}\",,,\"800123456\"],[,,\"[359]00\\\\d{6,7}\",\"\\\\d{8,11}\",,,\"300123456\"],[,,\"[34]00\\\\d{5}\",\"\\\\d{8}\",,,\"40041234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BR\",55,\"00(?:1[45]|2[135]|[34]1|43)\",\"0\",,,\"0(?:(1[245]|2[135]|[34]1)(\\\\d{10,11}))?\",\"$2\",,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1-$2\",[\"[2-9](?:[1-9]|0[1-9])\"],\"$1\",\"\",0],[,\"(\\\\d{5})(\\\\d{4})\",\"$1-$2\",[\"9(?:[1-9]|0[1-9])\"],\"$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{5})(\\\\d{4})\",\"$1 $2-$3\",[\"1[1-9]9\"],\"($1)\",\"0 $CC ($1)\",0],[,\"(\\\\d{2})(\\\\d{4})(\\\\d{4})\",\n\"$1 $2-$3\",[\"[1-9][1-9]\"],\"($1)\",\"0 $CC ($1)\",0],[,\"([34]00\\\\d)(\\\\d{4})\",\"$1-$2\",[\"[34]00\"],\"\",\"\",0],[,\"([3589]00)(\\\\d{2,3})(\\\\d{4})\",\"$1 $2 $3\",[\"[3589]00\"],\"0$1\",\"\",0]],[[,\"(\\\\d{2})(\\\\d{5})(\\\\d{4})\",\"$1 $2-$3\",[\"1[1-9]9\",\"1[1-9]9\"],\"($1)\",\"0 $CC ($1)\",0],[,\"(\\\\d{2})(\\\\d{4})(\\\\d{4})\",\"$1 $2-$3\",[\"[1-9][1-9]\",\"[1-9][1-9]\"],\"($1)\",\"0 $CC ($1)\",0],[,\"([34]00\\\\d)(\\\\d{4})\",\"$1-$2\",[\"[34]00\",\"[34]00\"],\"\",\"\",0],[,\"([3589]00)(\\\\d{2,3})(\\\\d{4})\",\"$1 $2 $3\",[\"[3589]00\",\"[3589]00\"],\"0$1\",\"\",0]],[,,\"NA\",\"NA\"],\n,,[,,\"[34]00\\\\d{5}\",\"\\\\d{8}\",,,\"40041234\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|28|9[023])|911\",\"\\\\d{3}\",,,\"190\"],[,,\"NA\",\"NA\"]],BS:[,[,,\"[2589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"242(?:3(?:02|[236][1-9]|4[0-24-9]|5[0-68]|7[3467]|8[0-4]|9[2-467])|461|502|6(?:12|7[67]|8[78]|9[89])|702)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"2423456789\"],[,,\"242(?:3(?:5[79]|[79]5)|4(?:[2-4][1-9]|5[1-8]|6[2-8]|7\\\\d|81)|5(?:2[45]|3[35]|44|5[1-9]|65|77)|6[34]6|727)\\\\d{4}\",\"\\\\d{10}\",,,\"2423591234\"],[,,\"242300\\\\d{4}|8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\n\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"BS\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"242\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"91[19]\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],BT:[,[,,\"[1-8]\\\\d{6,7}\",\"\\\\d{6,8}\"],[,,\"(?:2[3-6]|[34][5-7]|5[236]|6[2-46]|7[246]|8[2-4])\\\\d{5}\",\"\\\\d{6,7}\",,,\"2345678\"],[,,\"[17]7\\\\d{6}\",\"\\\\d{8}\",,,\"17123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],\"BT\",975,\"00\",,,,,,,,[[,\"([17]7)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"1|77\"],\"\",\"\",0],[,\"([2-8])(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[2-68]|7[246]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[023]\",\"\\\\d{3}\",,,\"113\"],[,,\"NA\",\"NA\"]],BW:[,[,,\"[2-79]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"(?:2(?:4[0-48]|6[0-24]|9[0578])|3(?:1[0235-9]|55|6\\\\d|7[01]|9[0-57])|4(?:6[03]|7[1267]|9[0-5])|5(?:3[0389]|4[0489]|7[1-47]|88|9[0-49])|6(?:2[1-35]|5[149]|8[067]))\\\\d{4}\",\"\\\\d{7}\",,,\"2401234\"],[,,\"7(?:[1-35]\\\\d{6}|[46][0-7]\\\\d{5}|7[01]\\\\d{5})\",\n\"\\\\d{8}\",,,\"71123456\"],[,,\"NA\",\"NA\"],[,,\"90\\\\d{5}\",\"\\\\d{7}\",,,\"9012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"79[12][01]\\\\d{4}\",\"\\\\d{8}\",,,\"79101234\"],\"BW\",267,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[2-6]\"],\"\",\"\",0],[,\"(7\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"7\"],\"\",\"\",0],[,\"(90)(\\\\d{5})\",\"$1 $2\",[\"9\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"99[789]\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],BY:[,[,,\"[1-4]\\\\d{8}|[89]\\\\d{9,10}\",\"\\\\d{7,11}\"],[,,\"(?:1(?:5(?:1[1-5]|2\\\\d|6[2-4]|9[1-7])|6(?:[235]\\\\d|4[1-7])|7\\\\d{2})|2(?:1(?:[246]\\\\d|3[0-35-9]|5[1-9])|2(?:[235]\\\\d|4[0-8])|3(?:2\\\\d|3[02-79]|4[024-7]|5[0-7])))\\\\d{5}\",\n\"\\\\d{7,9}\",,,\"152450911\"],[,,\"(?:2(?:5[5679]|9[1-9])|33\\\\d|44\\\\d)\\\\d{6}\",\"\\\\d{9}\",,,\"294911911\"],[,,\"8(?:0[13]|20\\\\d)\\\\d{7}\",\"\\\\d{10,11}\",,,\"8011234567\"],[,,\"(?:810|902)\\\\d{7}\",\"\\\\d{10}\",,,\"9021234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BY\",375,\"810\",\"8\",,,\"80?\",,\"8~10\",,[[,\"([1-4]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[1-4]\"],\"8 0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"8[01]|9\"],\"8 $1\",\"\",0],[,\"(8\\\\d{2})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"82\"],\"8 $1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"8(?:[01]|20)\\\\d{8}|902\\\\d{7}\",\n\"\\\\d{10,11}\",,,\"82012345678\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[123]|12)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],BZ:[,[,,\"[2-8]\\\\d{6}|0\\\\d{10}\",\"\\\\d{7}(?:\\\\d{4})?\"],[,,\"[234578][02]\\\\d{5}\",\"\\\\d{7}\",,,\"2221234\"],[,,\"6[0-367]\\\\d{5}\",\"\\\\d{7}\",,,\"6221234\"],[,,\"0800\\\\d{7}\",\"\\\\d{11}\",,,\"08001234123\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"BZ\",501,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1-$2\",[\"[2-8]\"],\"\",\"\",0],[,\"(0)(800)(\\\\d{4})(\\\\d{3})\",\"$1-$2-$3-$4\",[\"0\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],1,[,,\"9(?:0|11)\",\"\\\\d{2,3}\",,,\"911\"],[,,\"NA\",\"NA\"]],CA:[,[,,\"[2-9]\\\\d{9}|3\\\\d{6}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"(?:2(?:04|[23]6|[48]9|50)|3(?:06|43|65)|4(?:03|1[68]|3[178]|5[06])|5(?:0[06]|1[49]|79|8[17])|6(?:0[04]|13|39|47)|7(?:0[059]|80|78)|8(?:[06]7|19|73)|90[25])[2-9]\\\\d{6}|310\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"2042345678\"],[,,\"(?:2(?:04|[23]6|[48]9|50)|3(?:06|43|65)|4(?:03|1[68]|3[178]|5[06])|5(?:0[06]|1[49]|79|8[17])|6(?:0[04]|13|39|47)|7(?:0[059]|80|78)|8(?:[06]7|19|73)|90[25])[2-9]\\\\d{6}\",\"\\\\d{7}(?:\\\\d{3})?\",\n,,\"2042345678\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}|310\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"CA\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],CC:[,[,,\"[1458]\\\\d{5,9}\",\"\\\\d{6,10}\"],[,,\"89162\\\\d{4}\",\"\\\\d{8,9}\",,,\"891621234\"],[,,\"4(?:[0-2]\\\\d|3[0-57-9]|4[47-9]|5[0-37-9]|6[6-9]|7[07-9]|8[7-9])\\\\d{6}\",\n\"\\\\d{9}\",,,\"412345678\"],[,,\"1(?:80(?:0\\\\d{2})?|3(?:00\\\\d{2})?)\\\\d{4}\",\"\\\\d{6,10}\",,,\"1800123456\"],[,,\"190[0126]\\\\d{6}\",\"\\\\d{10}\",,,\"1900123456\"],[,,\"NA\",\"NA\"],[,,\"500\\\\d{6}\",\"\\\\d{9}\",,,\"500123456\"],[,,\"550\\\\d{6}\",\"\\\\d{9}\",,,\"550123456\"],\"CC\",61,\"(?:14(?:1[14]|34|4[17]|[56]6|7[47]|88))?001[14-689]\",\"0\",,,\"0\",,\"0011\",,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"000|112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],CD:[,[,,\"[2-6]\\\\d{6}|[18]\\\\d{6,8}|9\\\\d{8}\",\"\\\\d{7,9}\"],[,,\"1(?:2\\\\d{7}|\\\\d{6})|[2-6]\\\\d{6}\",\n\"\\\\d{7,9}\",,,\"1234567\"],[,,\"8(?:[0-259]\\\\d{2}|[48])\\\\d{5}|9[7-9]\\\\d{7}\",\"\\\\d{7,9}\",,,\"991234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CD\",243,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"12\"],\"0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"8[0-259]|9\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"8[48]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"[1-6]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,\n,\"NA\",\"NA\"]],CF:[,[,,\"[278]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2[12]\\\\d{6}\",\"\\\\d{8}\",,,\"21612345\"],[,,\"7[0257]\\\\d{6}\",\"\\\\d{8}\",,,\"70012345\"],[,,\"NA\",\"NA\"],[,,\"8776\\\\d{4}\",\"\\\\d{8}\",,,\"87761234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CF\",236,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],CG:[,[,,\"[028]\\\\d{8}\",\"\\\\d{9}\"],[,,\"222[1-589]\\\\d{5}\",\"\\\\d{9}\",,,\"222123456\"],[,,\"0[14-6]\\\\d{7}\",\"\\\\d{9}\",,,\"061234567\"],\n[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CG\",242,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[02]\"],\"\",\"\",0],[,\"(\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"8\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],CH:[,[,,\"[2-9]\\\\d{8}|860\\\\d{9}\",\"\\\\d{9}(?:\\\\d{3})?\"],[,,\"(?:2[12467]|3[1-4]|4[134]|5[12568]|6[12]|[7-9]1)\\\\d{7}\",\"\\\\d{9}\",,,\"212345678\"],[,,\"7[46-9]\\\\d{7}\",\"\\\\d{9}\",,,\"741234567\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",\n,,\"800123456\"],[,,\"90[016]\\\\d{6}\",\"\\\\d{9}\",,,\"900123456\"],[,,\"84[0248]\\\\d{6}\",\"\\\\d{9}\",,,\"840123456\"],[,,\"878\\\\d{6}\",\"\\\\d{9}\",,,\"878123456\"],[,,\"NA\",\"NA\"],\"CH\",41,\"00\",\"0\",,,\"0\",,,,[[,\"([2-9]\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[2-7]|[89]1\"],\"0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"8[047]|90\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4 $5\",[\"860\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:1[278]|44)\",\"\\\\d{3}\",,,\"112\"],[,\n,\"860\\\\d{9}\",\"\\\\d{12}\",,,\"860123456789\"]],CI:[,[,,\"[02-6]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:2(?:0[023]|1[02357]|[23][045]|4[03-5])|3(?:0[06]|1[069]|[2-4][07]|5[09]|6[08]))\\\\d{5}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"(?:0[1-9]|4[0-24-9]|5[057-9]|6[05679])\\\\d{6}\",\"\\\\d{8}\",,,\"01234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CI\",225,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"1(?:1[01]|[78]0)\",\"\\\\d{3}\",,,\"110\"],\n[,,\"NA\",\"NA\"]],CK:[,[,,\"[2-57]\\\\d{4}\",\"\\\\d{5}\"],[,,\"(?:2\\\\d|3[13-7]|4[1-5])\\\\d{3}\",\"\\\\d{5}\",,,\"21234\"],[,,\"(?:5[0-68]|7\\\\d)\\\\d{3}\",\"\\\\d{5}\",,,\"71234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CK\",682,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{3})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"99[689]\",\"\\\\d{3}\",,,\"998\"],[,,\"NA\",\"NA\"]],CL:[,[,,\"(?:[2-9]|600|123)\\\\d{7,8}\",\"\\\\d{6,11}\"],[,,\"(?:[23]2|41|58)\\\\d{7}|(?:3[3-5]|4[235]|5[1-357]|6[13-57]|7[1-35])\\\\d{6,7}\",\n\"\\\\d{6,9}\",,,\"221234567\"],[,,\"9[5-9]\\\\d{7}\",\"\\\\d{8,9}\",,,\"961234567\"],[,,\"800\\\\d{6}|1230\\\\d{7}\",\"\\\\d{9,11}\",,,\"800123456\"],[,,\"NA\",\"NA\"],[,,\"600\\\\d{7,8}\",\"\\\\d{10,11}\",,,\"6001234567\"],[,,\"NA\",\"NA\"],[,,\"44\\\\d{7}\",\"\\\\d{9}\",,,\"441234567\"],\"CL\",56,\"(?:0|1(?:1[0-69]|2[0-57]|5[13-58]|69|7[0167]|8[018]))0\",\"0\",,,\"0|(1(?:1[0-69]|2[0-57]|5[13-58]|69|7[0167]|8[018]))\",,,,[[,\"(2)(\\\\d{3,4})(\\\\d{4})\",\"$1 $2 $3\",[\"2\"],\"($1)\",\"$CC ($1)\",0],[,\"(\\\\d{2})(\\\\d{2,3})(\\\\d{4})\",\"$1 $2 $3\",[\"[357]|4[1-35]|6[13-57]\"],\"($1)\",\n\"$CC ($1)\",0],[,\"(9)([5-9]\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"9\"],\"0$1\",\"\",0],[,\"(44)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"44\"],\"0$1\",\"\",0],[,\"([68]00)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"60|8\"],\"$1\",\"\",0],[,\"(600)(\\\\d{3})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"60\"],\"$1\",\"\",0],[,\"(1230)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"600\\\\d{7,8}\",\"\\\\d{10,11}\",,,\"6001234567\"],[,,\"NA\",\"NA\"],,[,,\"13[123]\",\"\\\\d{3}\",,,\"133\"],[,,\"NA\",\"NA\"]],CM:[,[,,\"[237-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:22|33)\\\\d{6}\",\"\\\\d{8}\",,,\n\"22123456\"],[,,\"[79]\\\\d{7}\",\"\\\\d{8}\",,,\"71234567\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"88\\\\d{6}\",\"\\\\d{8}\",,,\"88012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CM\",237,\"00\",,,,,,,,[[,\"([237-9]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[2379]|88\"],\"\",\"\",0],[,\"(800)(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"80\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1?1[37]\",\"\\\\d{2,3}\",,,\"113\"],[,,\"NA\",\"NA\"]],CN:[,[,,\"[1-7]\\\\d{7,11}|8[0-357-9]\\\\d{6,9}|9(?:5\\\\d{3}|\\\\d{9})\",\"\\\\d{4,12}\"],[,,\"21\\\\d{8,10}|(?:10|2[02-57-9]|3(?:11|7[179])|4(?:[15]1|3[12])|5(?:1\\\\d|2[37]|3[12]|51|7[13-79]|9[15])|7(?:31|5[457]|6[09]|91)|8(?:71|98))\\\\d{8}|(?:3(?:1[02-9]|35|49|5\\\\d|7[02-68]|9[1-68])|4(?:1[02-9]|2[179]|3[3-9]|5[2-9]|6[4789]|7\\\\d|8[23])|5(?:3[03-9]|4[36]|5[02-9]|6[1-46]|7[028]|80|9[2-46-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[17]\\\\d|2[248]|3[04-9]|4[3-6]|5[0-3689]|6[2368]|9[02-9])|8(?:1[236-8]|2[5-7]|3\\\\d|5[1-9]|7[02-9]|8[3678]|9[1-7])|9(?:0[1-3689]|1[1-79]|[379]\\\\d|4[13]|5[1-5]))\\\\d{7}|80(?:29|6[03578]|7[018]|81)\\\\d{4}\",\n\"\\\\d{4,12}\",,,\"1012345678\"],[,,\"1(?:3\\\\d|4[57]|[58][0-35-9])\\\\d{8}\",\"\\\\d{11}\",,,\"13123456789\"],[,,\"(?:10)?800\\\\d{7}\",\"\\\\d{10,12}\",,,\"8001234567\"],[,,\"16[08]\\\\d{5}\",\"\\\\d{8}\",,,\"16812345\"],[,,\"400\\\\d{7}|95\\\\d{3}\",\"\\\\d{5}(?:\\\\d{5})?\",,,\"4001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CN\",86,\"(1[1279]\\\\d{3})?00\",\"0\",,,\"(1[1279]\\\\d{3})|0\",,\"00\",,[[,\"(80\\\\d{2})(\\\\d{4})\",\"$1 $2\",[\"80[2678]\"],\"0$1\",\"$CC $1\",1],[,\"([48]00)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[48]00\"],\"\",\"\",0],[,\"(\\\\d{5})\",\"$1\",[\"95\"],\"\",\"\",0],[,\"(\\\\d{3,4})(\\\\d{4})\",\n\"$1 $2\",[\"[2-9]\"],\"\",\"\",0],[,\"(21)(\\\\d{4})(\\\\d{4,6})\",\"$1 $2 $3\",[\"21\"],\"0$1\",\"$CC $1\",1],[,\"([12]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"10[1-9]|2[02-9]\",\"10[1-9]|2[02-9]\",\"10(?:[1-79]|8(?:[1-9]|0[1-9]))|2[02-9]\"],\"0$1\",\"$CC $1\",1],[,\"(\\\\d{3})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"3(?:11|7[179])|4(?:[15]1|3[12])|5(?:1|2[37]|3[12]|51|7[13-79]|9[15])|7(?:31|5[457]|6[09]|91)|8(?:71|98)\"],\"0$1\",\"$CC $1\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"3(?:1[02-9]|35|49|5|7[02-68]|9[1-68])|4(?:1[02-9]|2[179]|[35][2-9]|6[4789]|7\\\\d|8[23])|5(?:3[03-9]|4[36]|5[02-9]|6[1-46]|7[028]|80|9[2-46-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[04-9]|4[3-6]|6[2368])|8(?:1[236-8]|2[5-7]|3|5[1-9]|7[02-9]|8[3678]|9[1-7])|9(?:0[1-3689]|1[1-79]|[379]|4[13]|5[1-5])\"],\n\"0$1\",\"$CC $1\",1],[,\"(1[3-58]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"1[3-58]\"],\"\",\"$CC $1\",0],[,\"(10800)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"108\",\"1080\",\"10800\"],\"\",\"\",0]],[[,\"(80\\\\d{2})(\\\\d{4})\",\"$1 $2\",[\"80[2678]\",\"80[2678]\"],\"0$1\",\"$CC $1\",1],[,\"([48]00)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[48]00\",\"[48]00\"],\"\",\"\",0],[,\"(\\\\d{5})\",\"$1\",[\"95\",\"95\"],\"\",\"\",0],[,\"(21)(\\\\d{4})(\\\\d{4,6})\",\"$1 $2 $3\",[\"21\",\"21\"],\"0$1\",\"$CC $1\",1],[,\"([12]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",\"10[1-9]|2[02-9] 10[1-9]|2[02-9] 10(?:[1-79]|8(?:[1-9]|0[1-9]))|2[02-9] 10[1-9]|2[02-9] 10[1-9]|2[02-9] 10(?:[1-79]|8(?:[1-9]|0[1-9]))|2[02-9]\".split(\" \"),\n\"0$1\",\"$CC $1\",1],[,\"(\\\\d{3})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"3(?:11|7[179])|4(?:[15]1|3[12])|5(?:1|2[37]|3[12]|51|7[13-79]|9[15])|7(?:31|5[457]|6[09]|91)|8(?:71|98)\",\"3(?:11|7[179])|4(?:[15]1|3[12])|5(?:1|2[37]|3[12]|51|7[13-79]|9[15])|7(?:31|5[457]|6[09]|91)|8(?:71|98)\"],\"0$1\",\"$CC $1\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"3(?:1[02-9]|35|49|5|7[02-68]|9[1-68])|4(?:1[02-9]|2[179]|[35][2-9]|6[4789]|7\\\\d|8[23])|5(?:3[03-9]|4[36]|5[02-9]|6[1-46]|7[028]|80|9[2-46-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[04-9]|4[3-6]|6[2368])|8(?:1[236-8]|2[5-7]|3|5[1-9]|7[02-9]|8[3678]|9[1-7])|9(?:0[1-3689]|1[1-79]|[379]|4[13]|5[1-5])\",\n\"3(?:1[02-9]|35|49|5|7[02-68]|9[1-68])|4(?:1[02-9]|2[179]|[35][2-9]|6[4789]|7\\\\d|8[23])|5(?:3[03-9]|4[36]|5[02-9]|6[1-46]|7[028]|80|9[2-46-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[04-9]|4[3-6]|6[2368])|8(?:1[236-8]|2[5-7]|3|5[1-9]|7[02-9]|8[3678]|9[1-7])|9(?:0[1-3689]|1[1-79]|[379]|4[13]|5[1-5])\"],\"0$1\",\"$CC $1\",1],[,\"(1[3-58]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"1[3-58]\",\"1[3-58]\"],\"\",\"$CC $1\",0],[,\"(10800)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",\"108 1080 10800 108 1080 10800\".split(\" \"),\"\",\"\",0]],\n[,,\"NA\",\"NA\"],,,[,,\"(?:4|(?:10)?8)00\\\\d{7}|95\\\\d{3}\",\"\\\\d{5,12}\",,,\"4001234567\"],[,,\"NA\",\"NA\"],,[,,\"1(?:1[09]|20)\",\"\\\\d{3}\",,,\"119\"],[,,\"NA\",\"NA\"]],CO:[,[,,\"(?:[13]\\\\d{0,3}|[24-8])\\\\d{7}\",\"\\\\d{7,11}\"],[,,\"[124-8][2-9]\\\\d{6}\",\"\\\\d{8}\",,,\"12345678\"],[,,\"3(?:0[0-24]|1\\\\d|2[01])\\\\d{7}\",\"\\\\d{10}\",,,\"3211234567\"],[,,\"1800\\\\d{7}\",\"\\\\d{11}\",,,\"18001234567\"],[,,\"19(?:0[01]|4[78])\\\\d{7}\",\"\\\\d{11}\",,,\"19001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CO\",57,\"00[579]|#555|#999\",\"0\",,,\"0([3579]|4(?:44|56))?\",\n,,,[[,\"(\\\\d)(\\\\d{7})\",\"$1 $2\",[\"1(?:8[2-9]|9[0-3]|[2-7])|[24-8]\",\"1(?:8[2-9]|9(?:09|[1-3])|[2-7])|[24-8]\"],\"($1)\",\"0$CC $1\",0],[,\"(\\\\d{3})(\\\\d{7})\",\"$1 $2\",[\"3\"],\"\",\"0$CC $1\",0],[,\"(1)(\\\\d{3})(\\\\d{7})\",\"$1-$2-$3\",[\"1(?:80|9[04])\",\"1(?:800|9(?:0[01]|4[78]))\"],\"0$1\",\"\",0]],[[,\"(\\\\d)(\\\\d{7})\",\"$1 $2\",[\"1(?:8[2-9]|9[0-3]|[2-7])|[24-8]\",\"1(?:8[2-9]|9(?:09|[1-3])|[2-7])|[24-8]\",\"1(?:8[2-9]|9[0-3]|[2-7])|[24-8]\",\"1(?:8[2-9]|9(?:09|[1-3])|[2-7])|[24-8]\"],\"($1)\",\"0$CC $1\",0],[,\"(\\\\d{3})(\\\\d{7})\",\"$1 $2\",[\"3\",\n\"3\"],\"\",\"0$CC $1\",0],[,\"(1)(\\\\d{3})(\\\\d{7})\",\"$1 $2 $3\",[\"1(?:80|9[04])\",\"1(?:800|9(?:0[01]|4[78]))\"]]],[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:1[29]|23|32|56)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],CR:[,[,,\"[24-9]\\\\d{7,9}\",\"\\\\d{8,10}\"],[,,\"2[24-7]\\\\d{6}\",\"\\\\d{8}\",,,\"22123456\"],[,,\"5(?:0[0-4]|7[01])\\\\d{5}|[67][0-2]\\\\d{6}|8[3-9]\\\\d{6}\",\"\\\\d{8}\",,,\"83123456\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"90[059]\\\\d{7}\",\"\\\\d{10}\",,,\"9001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"210[0-6]\\\\d{4}|4(?:0(?:[04]0\\\\d{4}|10[0-3]\\\\d{3}|2(?:00\\\\d|900)\\\\d{2}|3[01]\\\\d{4}|5\\\\d{5}|70[01]\\\\d{3})|1[01]\\\\d{5}|20[0-3]\\\\d{4}|400\\\\d{4}|70[0-2]\\\\d{4})|5100\\\\d{4}\",\n\"\\\\d{8}\",,,\"40001234\"],\"CR\",506,\"00\",,,,\"(19(?:0[0-2468]|19|20|66|77))\",,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"[24-7]|8[3-9]\"],\"\",\"$CC $1\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"[89]0\"],\"\",\"$CC $1\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],CU:[,[,,\"[2-57]\\\\d{5,7}\",\"\\\\d{4,8}\"],[,,\"2[1-4]\\\\d{5,6}|3(?:1\\\\d{6}|[23]\\\\d{4,6})|4(?:[125]\\\\d{5,6}|[36]\\\\d{6}|[78]\\\\d{4,6})|7\\\\d{6,7}\",\"\\\\d{4,8}\",,,\"71234567\"],[,,\"5\\\\d{7}\",\"\\\\d{8}\",,,\"51234567\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CU\",53,\"119\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{6,7})\",\"$1 $2\",[\"7\"],\"(0$1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{4,6})\",\"$1 $2\",[\"[2-4]\"],\"(0$1)\",\"\",0],[,\"(\\\\d)(\\\\d{7})\",\"$1 $2\",[\"5\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"10[456]\",\"\\\\d{3}\",,,\"106\"],[,,\"NA\",\"NA\"]],CV:[,[,,\"[259]\\\\d{6}\",\"\\\\d{7}\"],[,,\"2(?:2[1-7]|3[0-8]|4[12]|5[1256]|6\\\\d|7[1-3]|8[1-5])\\\\d{4}\",\"\\\\d{7}\",,,\"2211234\"],[,,\"(?:9\\\\d|59)\\\\d{5}\",\"\\\\d{7}\",,,\"9911234\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CV\",238,\"0\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"13[012]\",\"\\\\d{3}\",,,\"132\"],[,,\"NA\",\"NA\"]],CW:[,[,,\"[169]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"9(?:[48]\\\\d{2}|50\\\\d|7(?:2[0-2]|[34]\\\\d|6[35-7]|77))\\\\d{4}\",\"\\\\d{7,8}\",,,\"94151234\"],[,,\"9(?:5(?:[1246]\\\\d|3[01])|6(?:[1679]\\\\d|3[01]))\\\\d{4}\",\"\\\\d{7,8}\",,,\"95181234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"(?:10|69)\\\\d{5}\",\"\\\\d{7}\",,,\"1011234\"],[,\n,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"CW\",599,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[13-7]\"],\"\",\"\",0],[,\"(9)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"9\"],\"\",\"\",0]],,[,,\"955\\\\d{5}\",\"\\\\d{7,8}\",,,\"95581234\"],1,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|911\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],CY:[,[,,\"[257-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2[2-6]\\\\d{6}\",\"\\\\d{8}\",,,\"22345678\"],[,,\"9[5-79]\\\\d{6}\",\"\\\\d{8}\",,,\"96123456\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80001234\"],[,,\"90[09]\\\\d{5}\",\"\\\\d{8}\",,,\"90012345\"],[,,\"80[1-9]\\\\d{5}\",\"\\\\d{8}\",,,\"80112345\"],\n[,,\"700\\\\d{5}\",\"\\\\d{8}\",,,\"70012345\"],[,,\"NA\",\"NA\"],\"CY\",357,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{6})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"(?:50|77)\\\\d{6}\",\"\\\\d{8}\",,,\"77123456\"],,[,,\"1(?:12|99)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],CX:[,[,,\"[1458]\\\\d{5,9}\",\"\\\\d{6,10}\"],[,,\"89164\\\\d{4}\",\"\\\\d{8,9}\",,,\"891641234\"],[,,\"4(?:[0-2]\\\\d|3[0-57-9]|4[47-9]|5[0-37-9]|6[6-9]|7[07-9]|8[7-9])\\\\d{6}\",\"\\\\d{9}\",,,\"412345678\"],[,,\"1(?:80(?:0\\\\d{2})?|3(?:00\\\\d{2})?)\\\\d{4}\",\"\\\\d{6,10}\",,,\"1800123456\"],[,,\"190[0126]\\\\d{6}\",\n\"\\\\d{10}\",,,\"1900123456\"],[,,\"NA\",\"NA\"],[,,\"500\\\\d{6}\",\"\\\\d{9}\",,,\"500123456\"],[,,\"550\\\\d{6}\",\"\\\\d{9}\",,,\"550123456\"],\"CX\",61,\"(?:14(?:1[14]|34|4[17]|[56]6|7[47]|88))?001[14-689]\",\"0\",,,\"0\",,\"0011\",,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"000|112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],CZ:[,[,,\"[2-8]\\\\d{8}|9\\\\d{8,11}\",\"\\\\d{9,12}\"],[,,\"2\\\\d{8}|(?:3[1257-9]|4[16-9]|5[13-9])\\\\d{7}\",\"\\\\d{9,12}\",,,\"212345678\"],[,,\"(?:60[1-8]|7(?:0[2-5]|[2379]\\\\d))\\\\d{6}\",\"\\\\d{9,12}\",,,\"601123456\"],[,,\"800\\\\d{6}\",\n\"\\\\d{9,12}\",,,\"800123456\"],[,,\"9(?:0[05689]|76)\\\\d{6}\",\"\\\\d{9,12}\",,,\"900123456\"],[,,\"8[134]\\\\d{7}\",\"\\\\d{9,12}\",,,\"811234567\"],[,,\"70[01]\\\\d{6}\",\"\\\\d{9,12}\",,,\"700123456\"],[,,\"9[17]0\\\\d{6}\",\"\\\\d{9,12}\",,,\"910123456\"],\"CZ\",420,\"00\",,,,,,,,[[,\"([2-9]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[2-8]|9[015-7]\"],\"\",\"\",0],[,\"(96\\\\d)(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"96\"],\"\",\"\",0],[,\"(9\\\\d)(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"9[36]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"9(?:5\\\\d|7[234])\\\\d{6}\",\n\"\\\\d{9,12}\",,,\"972123456\"],,[,,\"1(?:12|5[058])\",\"\\\\d{3}\",,,\"112\"],[,,\"9(?:3\\\\d{9}|6\\\\d{7,10})\",\"\\\\d{9,12}\",,,\"93123456789\"]],DE:[,[,,\"[1-35-9]\\\\d{3,14}|4(?:[0-8]\\\\d{4,12}|9(?:[0-37]\\\\d|4(?:[1-35-8]|4\\\\d?)|5\\\\d{1,2}|6[1-8]\\\\d?)\\\\d{2,7})\",\"\\\\d{2,15}\"],[,,\"[246]\\\\d{5,13}|3(?:[03-9]\\\\d{4,13}|2\\\\d{9})|5(?:0[2-8]|[1256]\\\\d|[38][0-8]|4\\\\d{0,2}|[79][0-7])\\\\d{3,11}|7(?:0[2-8]|[1-9]\\\\d)\\\\d{3,10}|8(?:0[2-9]|[1-9]\\\\d)\\\\d{3,10}|9(?:0[6-9]|[1-9]\\\\d)\\\\d{3,10}\",\"\\\\d{2,15}\",,,\"30123456\"],[,,\"1(?:5[0-2579]\\\\d{8}|6[023]\\\\d{7,8}|7(?:[0-57-9]\\\\d?|6\\\\d)\\\\d{7})\",\n\"\\\\d{10,11}\",,,\"15123456789\"],[,,\"800\\\\d{7,10}\",\"\\\\d{10,13}\",,,\"8001234567890\"],[,,\"900(?:[135]\\\\d{6}|9\\\\d{7})\",\"\\\\d{10,11}\",,,\"9001234567\"],[,,\"180\\\\d{5,11}\",\"\\\\d{8,14}\",,,\"18012345\"],[,,\"700\\\\d{8}\",\"\\\\d{11}\",,,\"70012345678\"],[,,\"NA\",\"NA\"],\"DE\",49,\"00\",\"0\",,,\"0\",,,,[[,\"(1\\\\d{2})(\\\\d{7,8})\",\"$1 $2\",[\"1[67]\"],\"0$1\",\"\",0],[,\"(1\\\\d{3})(\\\\d{7})\",\"$1 $2\",[\"15\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{4,11})\",\"$1 $2\",[\"3[02]|40|[68]9\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3,11})\",\"$1 $2\",[\"2(?:\\\\d1|0[2389]|1[24]|28|34)|3(?:[3-9][15]|40)|[4-8][1-9]1|9(?:06|[1-9]1)\"],\n\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{2,11})\",\"$1 $2\",[\"[24-6]|[7-9](?:\\\\d[1-9]|[1-9]\\\\d)|3(?:[3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])\",\"[24-6]|[7-9](?:\\\\d[1-9]|[1-9]\\\\d)|3(?:3(?:0[1-467]|2[127-9]|3[124578]|[46][1246]|7[1257-9]|8[1256]|9[145])|4(?:2[135]|3[1357]|4[13578]|6[1246]|7[1356]|9[1346])|5(?:0[14]|2[1-3589]|3[1357]|4[1246]|6[1-4]|7[1346]|8[13568]|9[1246])|6(?:0[356]|2[1-489]|3[124-6]|4[1347]|6[13]|7[12579]|8[1-356]|9[135])|7(?:2[1-7]|3[1357]|4[145]|6[1-5]|7[1-4])|8(?:21|3[1468]|4[1347]|6[0135-9]|7[1467]|8[136])|9(?:0[12479]|2[1358]|3[1357]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))\"],\n\"0$1\",\"\",0],[,\"(3\\\\d{4})(\\\\d{1,10})\",\"$1 $2\",[\"3\"],\"0$1\",\"\",0],[,\"(800)(\\\\d{7,10})\",\"$1 $2\",[\"800\"],\"0$1\",\"\",0],[,\"(177)(99)(\\\\d{7,8})\",\"$1 $2 $3\",[\"177\",\"1779\",\"17799\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d)(\\\\d{4,10})\",\"$1 $2 $3\",[\"(?:18|90)0\",\"180|900[1359]\"],\"0$1\",\"\",0],[,\"(1\\\\d{2})(\\\\d{5,11})\",\"$1 $2\",[\"181\"],\"0$1\",\"\",0],[,\"(18\\\\d{3})(\\\\d{6})\",\"$1 $2\",[\"185\",\"1850\",\"18500\"],\"0$1\",\"\",0],[,\"(18\\\\d{2})(\\\\d{7})\",\"$1 $2\",[\"18[68]\"],\"0$1\",\"\",0],[,\"(18\\\\d)(\\\\d{8})\",\"$1 $2\",[\"18[2-579]\"],\"0$1\",\"\",0],[,\"(700)(\\\\d{4})(\\\\d{4})\",\n\"$1 $2 $3\",[\"700\"],\"0$1\",\"\",0]],,[,,\"16(?:4\\\\d{1,10}|[89]\\\\d{1,11})\",\"\\\\d{4,14}\",,,\"16412345\"],,,[,,\"NA\",\"NA\"],[,,\"18(?:1\\\\d{5,11}|[2-9]\\\\d{8})\",\"\\\\d{8,14}\",,,\"18500123456\"],,[,,\"11[02]\",\"\\\\d{3}\",,,\"112\"],[,,\"17799\\\\d{7,8}\",\"\\\\d{12,13}\",,,\"177991234567\"]],DJ:[,[,,\"[27]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2(?:1[2-5]|7[45])\\\\d{5}\",\"\\\\d{8}\",,,\"21360003\"],[,,\"77[6-8]\\\\d{5}\",\"\\\\d{8}\",,,\"77831001\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"DJ\",253,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\n\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[78]\",\"\\\\d{2}\",,,\"17\"],[,,\"NA\",\"NA\"]],DK:[,[,,\"[2-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:[2-7]\\\\d|8[126-9]|9[126-9])\\\\d{6}\",\"\\\\d{8}\",,,\"32123456\"],[,,\"(?:[2-7]\\\\d|8[126-9]|9[126-9])\\\\d{6}\",\"\\\\d{8}\",,,\"20123456\"],[,,\"80\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"90\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"DK\",45,\"00\",,,,,,,1,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],DM:[,[,,\"[57-9]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"767(?:2(?:55|66)|4(?:2[01]|4[0-25-9])|50[0-4])\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"7674201234\"],[,,\"767(?:2(?:[234689]5|7[5-7])|31[5-7]|61[2-7])\\\\d{4}\",\"\\\\d{10}\",,,\"7672251234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"DM\",1,\"011\",\"1\",,,\"1\",,,,\n,,[,,\"NA\",\"NA\"],,\"767\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"333|9(?:11|99)\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],DO:[,[,,\"[589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"8(?:[04]9[2-9]\\\\d{6}|29(?:2(?:[0-59]\\\\d|6[04-9]|7[0-27]|8[0237-9])|3(?:[0-35-9]\\\\d|4[7-9])|[45]\\\\d{2}|6(?:[0-27-9]\\\\d|[3-5][1-9]|6[0135-8])|7(?:0[013-9]|[1-37]\\\\d|4[1-35689]|5[1-4689]|6[1-57-9]|8[1-79]|9[1-8])|8(?:0[146-9]|1[0-48]|[248]\\\\d|3[1-79]|5[01589]|6[013-68]|7[124-8]|9[0-8])|9(?:[0-24]\\\\d|3[02-46-9]|5[0-79]|60|7[0169]|8[57-9]|9[02-9]))\\\\d{4})\",\n\"\\\\d{7}(?:\\\\d{3})?\",,,\"8092345678\"],[,,\"8[024]9[2-9]\\\\d{6}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"8092345678\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"DO\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"8[024]9\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],DZ:[,[,,\"(?:[1-4]|[5-9]\\\\d)\\\\d{7}\",\"\\\\d{8,9}\"],[,,\"(?:1\\\\d|2[014-79]|3[0-8]|4[0135689])\\\\d{6}|9619\\\\d{5}\",\n\"\\\\d{8,9}\",,,\"12345678\"],[,,\"(?:5[56]|7[7-9])\\\\d{7}|6(?:[569]\\\\d|70)\\\\d{6}\",\"\\\\d{9}\",,,\"551234567\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"80[3-689]1\\\\d{5}\",\"\\\\d{9}\",,,\"808123456\"],[,,\"80[12]1\\\\d{5}\",\"\\\\d{9}\",,,\"801123456\"],[,,\"NA\",\"NA\"],[,,\"98[23]\\\\d{6}\",\"\\\\d{9}\",,,\"983123456\"],\"DZ\",213,\"00\",\"0\",,,\"0\",,,,[[,\"([1-4]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[1-4]\"],\"0$1\",\"\",0],[,\"([5-8]\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[5-8]\"],\"0$1\",\"\",0],[,\"(9\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",\n[\"9\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[47]\",\"\\\\d{2}\",,,\"17\"],[,,\"NA\",\"NA\"]],EC:[,[,,\"1\\\\d{9,10}|[2-8]\\\\d{7}|9\\\\d{8}\",\"\\\\d{7,11}\"],[,,\"[2-7][2-7]\\\\d{6}\",\"\\\\d{7,8}\",,,\"22123456\"],[,,\"9(?:39|[4-6][89]|7[7-9]|[89]\\\\d)\\\\d{6}\",\"\\\\d{9}\",,,\"991234567\"],[,,\"1800\\\\d{6,7}\",\"\\\\d{10,11}\",,,\"18001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"[2-7]890\\\\d{4}\",\"\\\\d{8}\",,,\"28901234\"],\"EC\",593,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2-$3\",[\"[247]|[356][2-8]\"],\"(0$1)\",\n\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"9\"],\"0$1\",\"\",0],[,\"(1800)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"1\"],\"$1\",\"\",0]],[[,\"(\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"[247]|[356][2-8]\"]],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"9\",\"9\"],\"0$1\",\"\",0],[,\"(1800)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"1\",\"1\"],\"$1\",\"\",0]],[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[12]|12)|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],EE:[,[,,\"1\\\\d{3,4}|[3-9]\\\\d{6,7}|800\\\\d{6,7}\",\"\\\\d{4,10}\"],[,,\"(?:3[23589]|4(?:0\\\\d|[3-8])|6\\\\d|7[1-9]|88)\\\\d{5}\",\n\"\\\\d{7,8}\",,,\"3212345\"],[,,\"(?:5\\\\d|8[1-5])\\\\d{6}|5(?:[02]\\\\d{2}|1(?:[0-8]\\\\d|95)|5[0-478]\\\\d|64[0-4]|65[1-589])\\\\d{3}\",\"\\\\d{7,8}\",,,\"51234567\"],[,,\"800(?:0\\\\d{3}|1\\\\d|[2-9])\\\\d{3}\",\"\\\\d{7,10}\",,,\"80012345\"],[,,\"900\\\\d{4}\",\"\\\\d{7}\",,,\"9001234\"],[,,\"NA\",\"NA\"],[,,\"70[0-2]\\\\d{5}\",\"\\\\d{8}\",,,\"70012345\"],[,,\"NA\",\"NA\"],\"EE\",372,\"00\",,,,,,,,[[,\"([3-79]\\\\d{2})(\\\\d{4})\",\"$1 $2\",[\"[369]|4[3-8]|5(?:[0-2]|5[0-478]|6[45])|7[1-9]\",\"[369]|4[3-8]|5(?:[02]|1(?:[0-8]|95)|5[0-478]|6(?:4[0-4]|5[1-589]))|7[1-9]\"],\"\",\n\"\",0],[,\"(70)(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"70\"],\"\",\"\",0],[,\"(8000)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"800\",\"8000\"],\"\",\"\",0],[,\"([458]\\\\d{3})(\\\\d{3,4})\",\"$1 $2\",[\"40|5|8(?:00|[1-5])\",\"40|5|8(?:00[1-9]|[1-5])\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"1\\\\d{3,4}|800[2-9]\\\\d{3}\",\"\\\\d{4,7}\",,,\"8002123\"],[,,\"1(?:2[01245]|3[0-6]|4[1-489]|5[0-59]|6[1-46-9]|7[0-27-9]|8[189]|9[012])\\\\d{1,2}\",\"\\\\d{4,5}\",,,\"12123\"],,[,,\"11[02]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],EG:[,[,,\"1\\\\d{4,9}|[2456]\\\\d{8}|3\\\\d{7}|[89]\\\\d{8,9}\",\"\\\\d{5,10}\"],\n[,,\"(?:1(3[23]\\\\d|5[23])|2[2-4]\\\\d{2}|3\\\\d{2}|4(?:0[2-5]|[578][23]|64)\\\\d|5(?:0[2-7]|[57][23])\\\\d|6[24-689]3\\\\d|8(?:2[2-57]|4[26]|6[237]|8[2-4])\\\\d|9(?:2[27]|3[24]|52|6[2356]|7[2-4])\\\\d)\\\\d{5}|1[69]\\\\d{3}\",\"\\\\d{5,9}\",,,\"234567890\"],[,,\"1(?:0[01269]|1[1245]|2[0-278])\\\\d{7}\",\"\\\\d{10}\",,,\"1001234567\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"900\\\\d{7}\",\"\\\\d{10}\",,,\"9001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"EG\",20,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{7,8})\",\"$1 $2\",[\"[23]\"],\"0$1\",\"\",0],[,\n\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1[012]|[89]00\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{6,7})\",\"$1 $2\",[\"1(?:3|5[23])|[4-6]|[89][2-9]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:2[23]|80)\",\"\\\\d{3}\",,,\"122\"],[,,\"NA\",\"NA\"]],EH:[,[,,\"[5689]\\\\d{8}\",\"\\\\d{9}\"],[,,\"528[89]\\\\d{5}\",\"\\\\d{9}\",,,\"528812345\"],[,,\"6(?:0[0-6]|[14-7]\\\\d|2[2-46-9]|3[03-8]|8[01]|99)\\\\d{6}\",\"\\\\d{9}\",,,\"650123456\"],[,,\"80\\\\d{7}\",\"\\\\d{9}\",,,\"801234567\"],[,,\"89\\\\d{7}\",\"\\\\d{9}\",,,\"891234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],\"EH\",212,\"00\",\"0\",,,\"0\",,,,,,[,,\"NA\",\"NA\"],,\"528[89]\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:[59]|77)\",\"\\\\d{2,3}\",,,\"15\"],[,,\"NA\",\"NA\"]],ER:[,[,,\"[178]\\\\d{6}\",\"\\\\d{6,7}\"],[,,\"1(?:1[12568]|20|40|55|6[146])\\\\d{4}|8\\\\d{6}\",\"\\\\d{6,7}\",,,\"8370362\"],[,,\"17[1-3]\\\\d{4}|7\\\\d{6}\",\"\\\\d{7}\",,,\"7123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"ER\",291,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],ES:[,[,,\"[5-9]\\\\d{8}\",\"\\\\d{9}\"],[,,\"8(?:[13]0|[28][0-8]|[47][1-9]|5[01346-9]|6[0457-9])\\\\d{6}|9(?:[1238][0-8]\\\\d{6}|4[1-9]\\\\d{6}|5\\\\d{7}|6(?:[0-8]\\\\d{6}|9(?:0(?:[0-57-9]\\\\d{4}|6(?:0[0-8]|1[1-9]|[2-9]\\\\d)\\\\d{2})|[1-9]\\\\d{5}))|7(?:[124-9]\\\\d{2}|3(?:[0-8]\\\\d|9[1-9]))\\\\d{4})\",\"\\\\d{9}\",,,\"810123456\"],[,,\"(?:6\\\\d{6}|7[1-4]\\\\d{5}|9(?:6906(?:09|10)|7390\\\\d{2}))\\\\d{2}\",\"\\\\d{9}\",,,\"612345678\"],[,,\"[89]00\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"80[367]\\\\d{6}\",\"\\\\d{9}\",,,\"803123456\"],\n[,,\"90[12]\\\\d{6}\",\"\\\\d{9}\",,,\"901123456\"],[,,\"70\\\\d{7}\",\"\\\\d{9}\",,,\"701234567\"],[,,\"NA\",\"NA\"],\"ES\",34,\"00\",,,,,,,,[[,\"([5-9]\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"51\\\\d{7}\",\"\\\\d{9}\",,,\"511234567\"],,[,,\"0(?:[69][12]|8[05])|112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],ET:[,[,,\"[1-59]\\\\d{8}\",\"\\\\d{7,9}\"],[,,\"(?:11(?:1(?:1[124]|2[2-57]|3[1-5]|5[5-8]|8[6-8])|2(?:13|3[6-8]|5[89]|7[05-9]|8[2-6])|3(?:2[01]|3[0-289]|4[1289]|7[1-4]|87)|4(?:1[69]|3[2-49]|4[0-3]|6[5-8])|5(?:1[57]|44|5[0-4])|6(?:18|2[69]|4[5-7]|5[1-5]|6[0-59]|8[015-8]))|2(?:2(?:11[1-9]|22[0-7]|33\\\\d|44[1467]|66[1-68])|5(?:11[124-6]|33[2-8]|44[1467]|55[14]|66[1-3679]|77[124-79]|880))|3(?:3(?:11[0-46-8]|22[0-6]|33[0134689]|44[04]|55[0-6]|66[01467])|4(?:44[0-8]|55[0-69]|66[0-3]|77[1-5]))|4(?:6(?:22[0-24-7]|33[1-5]|44[13-69]|55[14-689]|660|88[1-4])|7(?:11[1-9]|22[1-9]|33[13-7]|44[13-6]|55[1-689]))|5(?:7(?:227|55[05]|(?:66|77)[14-8])|8(?:11[149]|22[013-79]|33[0-68]|44[013-8]|550|66[1-5]|77\\\\d)))\\\\d{4}\",\n\"\\\\d{7,9}\",,,\"111112345\"],[,,\"9(?:[1-3]\\\\d|5[89])\\\\d{6}\",\"\\\\d{9}\",,,\"911234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"ET\",251,\"00\",\"0\",,,\"0\",,,,[[,\"([1-59]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11?|[23]|9[17])\",\"\\\\d{2,3}\",,,\"991\"],[,,\"NA\",\"NA\"]],FI:[,[,,\"1\\\\d{4,11}|[2-9]\\\\d{4,10}\",\"\\\\d{5,12}\"],[,,\"1(?:[3569][1-8]\\\\d{3,9}|[47]\\\\d{5,10})|2[1-8]\\\\d{3,9}|3(?:[1-8]\\\\d{3,9}|9\\\\d{4,8})|[5689][1-8]\\\\d{3,9}\",\"\\\\d{5,12}\",\n,,\"1312345678\"],[,,\"4\\\\d{5,10}|50\\\\d{4,8}\",\"\\\\d{6,11}\",,,\"412345678\"],[,,\"800\\\\d{4,7}\",\"\\\\d{7,10}\",,,\"8001234567\"],[,,\"[67]00\\\\d{5,6}\",\"\\\\d{8,9}\",,,\"600123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"FI\",358,\"00|99[049]\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{3,7})\",\"$1 $2\",[\"(?:[1-3]00|[6-8]0)\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{4,10})\",\"$1 $2\",[\"2[09]|[14]|50|7[135]\"],\"0$1\",\"\",0],[,\"(\\\\d)(\\\\d{4,11})\",\"$1 $2\",[\"[25689][1-8]|3\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],1,,[,,\"[13]00\\\\d{3,7}|2(?:0(?:0\\\\d{3,7}|2[023]\\\\d{1,6}|9[89]\\\\d{1,6}))|60(?:[12]\\\\d{5,6}|6\\\\d{7})|7(?:1\\\\d{7}|3\\\\d{8}|5[03-9]\\\\d{2,7})\",\n\"\\\\d{5,10}\",,,\"100123\"],[,,\"[13]0\\\\d{4,8}|2(?:0(?:[016-8]\\\\d{3,7}|[2-59]\\\\d{2,7})|9\\\\d{4,8})|60(?:[12]\\\\d{5,6}|6\\\\d{7})|7(?:1\\\\d{7}|3\\\\d{8}|5[03-9]\\\\d{2,7})\",\"\\\\d{5,10}\",,,\"10112345\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],FJ:[,[,,\"[36-9]\\\\d{6}|0\\\\d{10}\",\"\\\\d{7}(?:\\\\d{4})?\"],[,,\"(?:3[0-5]|6[25-7]|8[58])\\\\d{5}\",\"\\\\d{7}\",,,\"3212345\"],[,,\"(?:7[0-467]|8[367]|9[02346-9])\\\\d{5}\",\"\\\\d{7}\",,,\"7012345\"],[,,\"0800\\\\d{7}\",\"\\\\d{11}\",,,\"08001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n\"FJ\",679,\"0(?:0|52)\",,,,,,\"00\",,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[36-9]\"],\"\",\"\",0],[,\"(\\\\d{4})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"0\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"91[17]\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],FK:[,[,,\"[2-7]\\\\d{4}\",\"\\\\d{5}\"],[,,\"[2-47]\\\\d{4}\",\"\\\\d{5}\",,,\"31234\"],[,,\"[56]\\\\d{4}\",\"\\\\d{5}\",,,\"51234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"FK\",500,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],\n[,,\"NA\",\"NA\"]],FM:[,[,,\"[39]\\\\d{6}\",\"\\\\d{7}\"],[,,\"3[2357]0[1-9]\\\\d{3}|9[2-6]\\\\d{5}\",\"\\\\d{7}\",,,\"3201234\"],[,,\"3[2357]0[1-9]\\\\d{3}|9[2-7]\\\\d{5}\",\"\\\\d{7}\",,,\"3501234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"FM\",691,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911|320221\",\"\\\\d{3}(?:\\\\d{3})?\",,,\"911\"],[,,\"NA\",\"NA\"]],FO:[,[,,\"[2-9]\\\\d{5}\",\"\\\\d{6}\"],[,,\"(?:20|[3-4]\\\\d|8[19])\\\\d{4}\",\"\\\\d{6}\",,,\"201234\"],[,,\"(?:2[1-9]|5\\\\d|7[1-79])\\\\d{4}\",\n\"\\\\d{6}\",,,\"211234\"],[,,\"80[257-9]\\\\d{3}\",\"\\\\d{6}\",,,\"802123\"],[,,\"90(?:[1345][15-7]|2[125-7]|99)\\\\d{2}\",\"\\\\d{6}\",,,\"901123\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"(?:6[0-36]|88)\\\\d{4}\",\"\\\\d{6}\",,,\"601234\"],\"FO\",298,\"00\",,,,\"(10(?:01|[12]0|88))\",,,,[[,\"(\\\\d{6})\",\"$1\",,\"\",\"$CC $1\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],FR:[,[,,\"[124-9]\\\\d{8}|3\\\\d{3}(?:\\\\d{5})?\",\"\\\\d{4}(?:\\\\d{5})?\"],[,,\"[1-5]\\\\d{8}\",\"\\\\d{9}\",,,\"123456789\"],[,,\"6\\\\d{8}|7[5-9]\\\\d{7}\",\"\\\\d{9}\",\n,,\"612345678\"],[,,\"80\\\\d{7}\",\"\\\\d{9}\",,,\"801234567\"],[,,\"3\\\\d{3}|89[1-37-9]\\\\d{6}\",\"\\\\d{4}(?:\\\\d{5})?\",,,\"891123456\"],[,,\"8(?:1[019]|2[0156]|84|90)\\\\d{6}\",\"\\\\d{9}\",,,\"810123456\"],[,,\"NA\",\"NA\"],[,,\"9\\\\d{8}\",\"\\\\d{9}\",,,\"912345678\"],\"FR\",33,\"[04579]0\",\"0\",,,\"0\",,\"00\",,[[,\"([1-79])(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4 $5\",[\"[1-79]\"],\"0$1\",\"\",0],[,\"(8\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"8\"],\"0 $1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"3\\\\d{3}\",\"\\\\d{4}\",,,\"3123\"],[,,\"NA\",\"NA\"],,[,,\"1(?:[578]|12)\",\n\"\\\\d{2,3}\",,,\"112\"],[,,\"NA\",\"NA\"]],GA:[,[,,\"[01]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"1\\\\d{6}\",\"\\\\d{7,8}\",,,\"1441234\"],[,,\"0[2-7]\\\\d{6}\",\"\\\\d{7,8}\",,,\"06031234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GA\",241,\"00\",\"0\",,,\"0\",,,,[[,\"(1)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"1\"],\"0$1\",\"\",0],[,\"(0\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"0\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"1730|18|13\\\\d{2}\",\"\\\\d{2,4}\",,,\"1730\"],[,,\"NA\",\"NA\"]],GB:[,[,,\"\\\\d{7,10}\",\n\"\\\\d{4,10}\"],[,,\"2(?:0[01378]|3[0189]|4[017]|8[0-46-9]|9[012])\\\\d{7}|1(?:(?:1(?:3[0-48]|[46][0-4]|5[012789]|7[0-49]|8[01349])|21[0-7]|31[0-8]|[459]1\\\\d|61[0-46-9]))\\\\d{6}|1(?:2(?:0[024-9]|2[3-9]|3[3-79]|4[1-689]|[58][02-9]|6[0-4789]|7[013-9]|9\\\\d)|3(?:0\\\\d|[25][02-9]|3[02-579]|[468][0-46-9]|7[1235679]|9[24578])|4(?:0[03-9]|[28][02-5789]|[37]\\\\d|4[02-69]|5[0-8]|[69][0-79])|5(?:0[1235-9]|2[024-9]|3[015689]|4[02-9]|5[03-9]|6\\\\d|7[0-35-9]|8[0-468]|9[0-5789])|6(?:0[034689]|2[0-35689]|[38][013-9]|4[1-467]|5[0-69]|6[13-9]|7[0-8]|9[0124578])|7(?:0[0246-9]|2\\\\d|3[023678]|4[03-9]|5[0-46-9]|6[013-9]|7[0-35-9]|8[024-9]|9[02-9])|8(?:0[35-9]|2[1-5789]|3[02-578]|4[0-578]|5[124-9]|6[2-69]|7\\\\d|8[02-9]|9[02569])|9(?:0[02-589]|2[02-689]|3[1-5789]|4[2-9]|5[0-579]|6[234789]|7[0124578]|8\\\\d|9[2-57]))\\\\d{6}|1(?:2(?:0(?:46[1-4]|87[2-9])|545[1-79]|76(?:2\\\\d|3[1-8]|6[1-6])|9(?:7(?:2[0-4]|3[2-5])|8(?:2[2-8]|7[0-4789]|8[345])))|3(?:638[2-5]|647[23]|8(?:47[04-9]|64[015789]))|4(?:044[1-7]|20(?:2[23]|8\\\\d)|6(?:0(?:30|5[2-57]|6[1-8]|7[2-8])|140)|8(?:052|87[123]))|5(?:24(?:3[2-79]|6\\\\d)|276\\\\d|6(?:26[06-9]|686))|6(?:06(?:4\\\\d|7[4-79])|295[567]|35[34]\\\\d|47(?:24|61)|59(?:5[08]|6[67]|74)|955[0-4])|7(?:26(?:6[13-9]|7[0-7])|442\\\\d|50(?:2[0-3]|[3-68]2|76))|8(?:27[56]\\\\d|37(?:5[2-5]|8[239])|84(?:3[2-58]))|9(?:0(?:0(?:6[1-8]|85)|52\\\\d)|3583|4(?:66[1-8]|9(?:2[01]|81))|63(?:23|3[1-4])|9561))\\\\d{3}|176888[234678]\\\\d{2}|16977[23]\\\\d{3}\",\n\"\\\\d{4,10}\",,,\"1212345678\"],[,,\"7(?:[1-4]\\\\d\\\\d|5(?:0[0-8]|[13-9]\\\\d|2[0-35-9])|7(?:0[1-9]|[1-7]\\\\d|8[02-9]|9[0-689])|8(?:[014-9]\\\\d|[23][0-8])|9(?:[04-9]\\\\d|1[02-9]|2[0-35-9]|3[0-689]))\\\\d{6}\",\"\\\\d{10}\",,,\"7400123456\"],[,,\"80(?:0(?:1111|\\\\d{6,7})|8\\\\d{7})|500\\\\d{6}\",\"\\\\d{7}(?:\\\\d{2,3})?\",,,\"8001234567\"],[,,\"(?:87[123]|9(?:[01]\\\\d|8[2349]))\\\\d{7}\",\"\\\\d{10}\",,,\"9012345678\"],[,,\"8(?:4(?:5464\\\\d|[2-5]\\\\d{7})|70\\\\d{7})\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"8431234567\"],[,,\"70\\\\d{8}\",\"\\\\d{10}\",,,\"7012345678\"],[,,\"56\\\\d{8}\",\n\"\\\\d{10}\",,,\"5612345678\"],\"GB\",44,\"00\",\"0\",\" x\",,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"2|5[56]|7(?:0|6[013-9])\",\"2|5[56]|7(?:0|6(?:[013-9]|2[0-35-9]))\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1(?:1|\\\\d1)|3|9[018]\"],\"0$1\",\"\",0],[,\"(\\\\d{5})(\\\\d{4,5})\",\"$1 $2\",[\"1(?:38|5[23]|69|76|94)\",\"1(?:387|5(?:24|39)|697|768|946)\",\"1(?:3873|5(?:242|39[456])|697[347]|768[347]|9467)\"],\"0$1\",\"\",0],[,\"(1\\\\d{3})(\\\\d{5,6})\",\"$1 $2\",[\"1\"],\"0$1\",\"\",0],[,\"(7\\\\d{3})(\\\\d{6})\",\"$1 $2\",[\"7(?:[1-5789]|62)\",\n\"7(?:[1-5789]|624)\"],\"0$1\",\"\",0],[,\"(800)(\\\\d{4})\",\"$1 $2\",[\"800\",\"8001\",\"80011\",\"800111\",\"8001111\"],\"0$1\",\"\",0],[,\"(845)(46)(4\\\\d)\",\"$1 $2 $3\",[\"845\",\"8454\",\"84546\",\"845464\"],\"0$1\",\"\",0],[,\"(8\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"8(?:4[2-5]|7[0-3])\"],\"0$1\",\"\",0],[,\"(80\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"80\"],\"0$1\",\"\",0],[,\"([58]00)(\\\\d{6})\",\"$1 $2\",[\"[58]00\"],\"0$1\",\"\",0]],,[,,\"76(?:0[012]|2[356]|4[0134]|5[49]|6[0-369]|77|81|9[39])\\\\d{6}\",\"\\\\d{10}\",,,\"7640123456\"],1,,[,,\"NA\",\"NA\"],[,,\"(?:3[0347]|55)\\\\d{8}\",\n\"\\\\d{10}\",,,\"5512345678\"],,[,,\"112|999\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],GD:[,[,,\"[4589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"473(?:2(?:3[0-2]|69)|3(?:2[89]|86)|4(?:[06]8|3[5-9]|4[0-49]|5[5-79]|68|73|90)|63[68]|7(?:58|84)|938)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"4732691234\"],[,,\"473(?:4(?:0[3-79]|1[04-9]|20|58)|53[3-8])\\\\d{4}\",\"\\\\d{10}\",,,\"4734031234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",\n,,\"5002345678\"],[,,\"NA\",\"NA\"],\"GD\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"473\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],GE:[,[,,\"[3458]\\\\d{8}\",\"\\\\d{6,9}\"],[,,\"(?:3(?:[256]\\\\d|4[124-9]|7[0-4])|4(?:1\\\\d|2[2-7]|3[1-79]|4[2-8]|7[239]|9[1-7]))\\\\d{6}\",\"\\\\d{6,9}\",,,\"322123456\"],[,,\"5(?:14|5[01578]|68|7[0147-9]|9[0-35-9])\\\\d{6}\",\"\\\\d{9}\",,,\"555123456\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GE\",995,\"810\",\"8\",,,\"8\",,\"8~10\",\n,[[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[348]\"],\"8 $1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"5\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"0(?:11|22|33)|1(?:1[123]|22)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],GF:[,[,,\"[56]\\\\d{8}\",\"\\\\d{9}\"],[,,\"594(?:10|2[012457-9]|3[0-57-9]|4[3-9]|5[7-9]|6[0-3]|9[014])\\\\d{4}\",\"\\\\d{9}\",,,\"594101234\"],[,,\"694(?:[04][0-7]|1[0-5]|2[0-46-9]|38|9\\\\d)\\\\d{4}\",\"\\\\d{9}\",,,\"694201234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GF\",594,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[578]\",\"\\\\d{2}\",,,\"15\"],[,,\"NA\",\"NA\"]],GG:[,[,,\"[135789]\\\\d{6,9}\",\"\\\\d{6,10}\"],[,,\"1481\\\\d{6}\",\"\\\\d{6,10}\",,,\"1481456789\"],[,,\"7(?:781|839|911)\\\\d{6}\",\"\\\\d{10}\",,,\"7781123456\"],[,,\"80(?:0(?:1111|\\\\d{6,7})|8\\\\d{7})|500\\\\d{6}\",\"\\\\d{7}(?:\\\\d{2,3})?\",,,\"8001234567\"],[,,\"(?:87[123]|9(?:[01]\\\\d|8[0-3]))\\\\d{7}\",\"\\\\d{10}\",,,\"9012345678\"],\n[,,\"8(?:4(?:5464\\\\d|[2-5]\\\\d{7})|70\\\\d{7})\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"8431234567\"],[,,\"70\\\\d{8}\",\"\\\\d{10}\",,,\"7012345678\"],[,,\"56\\\\d{8}\",\"\\\\d{10}\",,,\"5612345678\"],\"GG\",44,\"00\",\"0\",\" x\",,\"0\",,,,,,[,,\"76(?:0[012]|2[356]|4[0134]|5[49]|6[0-369]|77|81|9[39])\\\\d{6}\",\"\\\\d{10}\",,,\"7640123456\"],,,[,,\"NA\",\"NA\"],[,,\"(?:3[0347]|55)\\\\d{8}\",\"\\\\d{10}\",,,\"5512345678\"],,[,,\"112|999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],GH:[,[,,\"[235]\\\\d{8}|8\\\\d{7}\",\"\\\\d{7,9}\"],[,,\"3(?:0[237]\\\\d|[167](?:2[0-6]|7\\\\d)|2(?:2[0-5]|7\\\\d)|3(?:2[0-3]|7\\\\d)|4(?:2[013-9]|3[01]|7\\\\d)|5(?:2[0-7]|7\\\\d)|8(?:2[0-2]|7\\\\d)|9(?:20|7\\\\d))\\\\d{5}\",\n\"\\\\d{7,9}\",,,\"302345678\"],[,,\"(?:2[034678]|5[047])\\\\d{7}\",\"\\\\d{9}\",,,\"231234567\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GH\",233,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[235]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{5})\",\"$1 $2\",[\"8\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"NA\",\"NA\"],,[,,\"19[123]|999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],GI:[,[,,\"[2568]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2(?:00\\\\d|16[0-7]|22[2457])\\\\d{4}\",\n\"\\\\d{8}\",,,\"20012345\"],[,,\"(?:5[4-8]|60)\\\\d{6}\",\"\\\\d{8}\",,,\"57123456\"],[,,\"80\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"8[1-689]\\\\d{6}\",\"\\\\d{8}\",,,\"88123456\"],[,,\"87\\\\d{6}\",\"\\\\d{8}\",,,\"87123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GI\",350,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|9[09])\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],GL:[,[,,\"[1-689]\\\\d{5}\",\"\\\\d{6}\"],[,,\"(?:19|3[1-6]|6[14689]|8[14-79]|9\\\\d)\\\\d{4}\",\"\\\\d{6}\",,,\"321000\"],[,,\"[245][2-9]\\\\d{4}\",\"\\\\d{6}\",,,\"221234\"],[,,\"80\\\\d{4}\",\"\\\\d{6}\",\n,,\"801234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"3[89]\\\\d{4}\",\"\\\\d{6}\",,,\"381234\"],\"GL\",299,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],GM:[,[,,\"[2-9]\\\\d{6}\",\"\\\\d{7}\"],[,,\"(?:4(?:[23]\\\\d{2}|4(?:1[024679]|[6-9]\\\\d))|5(?:54[0-7]|6(?:[67]\\\\d)|7(?:1[04]|2[035]|3[58]|48))|8\\\\d{3})\\\\d{3}\",\"\\\\d{7}\",,,\"5661234\"],[,,\"(?:2[0-2]|[3679]\\\\d)\\\\d{5}\",\"\\\\d{7}\",,,\"3012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GM\",220,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1?1[678]\",\"\\\\d{2,3}\",,,\"117\"],[,,\"NA\",\"NA\"]],GN:[,[,,\"[23567]\\\\d{7,8}\",\"\\\\d{8,9}\"],[,,\"30(?:24|3[12]|4[1-35-7]|5[13]|6[189]|[78]1|9[1478])\\\\d{4}\",\"\\\\d{8}\",,,\"30241234\"],[,,\"(?:24|55)\\\\d{6}|6(?:0(?:2[0-35-9]|3[3467]|5[2457-9])|1[0-5]\\\\d|2\\\\d{2}|[4-9]\\\\d{2}|3(?:[14]0|35))\\\\d{4}|6(?:[03]1|2[128]|5[57]|6[2469])\\\\d{6}\",\"\\\\d{8,9}\",,,\"60201234\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"78\\\\d{6}\",\"\\\\d{8}\",,,\"78123456\"],\"GN\",224,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[23567]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"6[02356]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],GP:[,[,,\"[56]\\\\d{8}\",\"\\\\d{9}\"],[,,\"590(?:1[12]|2[0-68]|3[28]|4[126-8]|5[067]|6[018]|[89]\\\\d)\\\\d{4}\",\"\\\\d{9}\",,,\"590201234\"],[,,\"690(?:00|1[1-9]|2[013-5]|[3-5]\\\\d|6[0-57-9]|7[1-6]|8[0-6]|9[09])\\\\d{4}\",\n\"\\\\d{9}\",,,\"690301234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GP\",590,\"00\",\"0\",,,\"0\",,,,[[,\"([56]90)(\\\\d{2})(\\\\d{4})\",\"$1 $2-$3\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],1,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[578]\",\"\\\\d{2}\",,,\"18\"],[,,\"NA\",\"NA\"]],GQ:[,[,,\"[23589]\\\\d{8}\",\"\\\\d{9}\"],[,,\"3(?:3(?:3\\\\d[7-9]|[0-24-9]\\\\d[46])|5\\\\d{2}[7-9])\\\\d{4}\",\"\\\\d{9}\",,,\"333091234\"],[,,\"(?:222|551)\\\\d{6}\",\"\\\\d{9}\",,,\"222123456\"],[,,\"80\\\\d[1-9]\\\\d{5}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"90\\\\d[1-9]\\\\d{5}\",\"\\\\d{9}\",\n,,\"900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GQ\",240,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[235]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{6})\",\"$1 $2\",[\"[89]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],GR:[,[,,\"[26-9]\\\\d{9}\",\"\\\\d{10}\"],[,,\"2(?:1\\\\d{2}|2(?:3[1-8]|4[1-7]|5[1-4]|6[1-8]|7[1-5]|[289][1-9])|3(?:1\\\\d|2[1-57]|3[1-4]|[45][1-3]|7[1-7]|8[1-6]|9[1-79])|4(?:1\\\\d|2[1-8]|3[1-4]|4[13-5]|6[1-578]|9[1-5])|5(?:1\\\\d|[239][1-4]|4[124]|5[1-6])|6(?:1\\\\d|3[124]|4[1-7]|5[13-9]|[269][1-6]|7[14]|8[1-5])|7(?:1\\\\d|2[1-5]|3[1-6]|4[1-7]|5[1-57]|6[134]|9[15-7])|8(?:1\\\\d|2[1-5]|[34][1-4]|9[1-7]))\\\\d{6}\",\n\"\\\\d{10}\",,,\"2123456789\"],[,,\"69\\\\d{8}\",\"\\\\d{10}\",,,\"6912345678\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"90[19]\\\\d{7}\",\"\\\\d{10}\",,,\"9091234567\"],[,,\"8(?:0[16]|12|25)\\\\d{7}\",\"\\\\d{10}\",,,\"8011234567\"],[,,\"70\\\\d{8}\",\"\\\\d{10}\",,,\"7012345678\"],[,,\"NA\",\"NA\"],\"GR\",30,\"00\",,,,,,,,[[,\"([27]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"21|7\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"2[2-9]1|[689]\"],\"\",\"\",0],[,\"(2\\\\d{3})(\\\\d{6})\",\"$1 $2\",[\"2[2-9][02-9]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],,[,,\"1(?:00|12|66|99)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],GT:[,[,,\"[2-7]\\\\d{7}|1[89]\\\\d{9}\",\"\\\\d{8}(?:\\\\d{3})?\"],[,,\"[267][2-9]\\\\d{6}\",\"\\\\d{8}\",,,\"22456789\"],[,,\"[345]\\\\d{7}\",\"\\\\d{8}\",,,\"51234567\"],[,,\"18[01]\\\\d{8}\",\"\\\\d{11}\",,,\"18001112222\"],[,,\"19\\\\d{9}\",\"\\\\d{11}\",,,\"19001112222\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GT\",502,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"[2-7]\"],\"\",\"\",0],[,\"(\\\\d{4})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n,[,,\"1(?:10|2[03])\",\"\\\\d{3}\",,,\"110\"],[,,\"NA\",\"NA\"]],GU:[,[,,\"[5689]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"671(?:3(?:00|3[39]|4[349]|55|6[26])|4(?:56|7[1-9]|8[23678])|5(?:55|6[2-5]|88)|6(?:3[2-578]|4[24-9]|5[34]|78|8[5-9])|7(?:[079]7|2[0167]|3[45]|8[789])|8(?:[2-5789]8|6[48])|9(?:2[29]|6[79]|7[179]|8[789]|9[78]))\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"6713001234\"],[,,\"671(?:3(?:00|3[39]|4[349]|55|6[26])|4(?:56|7[1-9]|8[23678])|5(?:55|6[2-5]|88)|6(?:3[2-578]|4[24-9]|5[34]|78|8[5-9])|7(?:[079]7|2[0167]|3[45]|8[789])|8(?:[2-5789]8|6[48])|9(?:2[29]|6[79]|7[179]|8[789]|9[78]))\\\\d{4}\",\n\"\\\\d{7}(?:\\\\d{3})?\",,,\"6713001234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"GU\",1,\"011\",\"1\",,,\"1\",,,1,,,[,,\"NA\",\"NA\"],,\"671\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],GW:[,[,,\"[3567]\\\\d{6}\",\"\\\\d{7}\"],[,,\"3(?:2[0125]|3[1245]|4[12]|5[1-4]|70|9[1-467])\\\\d{4}\",\"\\\\d{7}\",,,\"3201234\"],[,,\"[5-7]\\\\d{6}\",\"\\\\d{7}\",,,\"5012345\"],[,\n,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GW\",245,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[378]\",\"\\\\d{3}\",,,\"113\"],[,,\"NA\",\"NA\"]],GY:[,[,,\"[2-4679]\\\\d{6}\",\"\\\\d{7}\"],[,,\"(?:2(?:1[6-9]|2[0-35-9]|3[1-4]|5[3-9]|6\\\\d|7[0-24-79])|3(?:2[25-9]|3\\\\d)|4(?:4[0-24]|5[56])|77[1-57])\\\\d{4}\",\"\\\\d{7}\",,,\"2201234\"],[,,\"6\\\\d{6}\",\"\\\\d{7}\",,,\"6091234\"],[,,\"(?:289|862)\\\\d{4}\",\"\\\\d{7}\",,,\"2891234\"],[,,\"9008\\\\d{3}\",\"\\\\d{7}\",,,\"9008123\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"GY\",592,\"001\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"91[123]\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],HK:[,[,,\"[235-7]\\\\d{7}|8\\\\d{7,8}|9\\\\d{4,10}\",\"\\\\d{5,11}\"],[,,\"(?:[23]\\\\d|5[78])\\\\d{6}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"(?:5[1-69]\\\\d|6\\\\d{2}|9(?:0[1-9]|[1-8]\\\\d))\\\\d{5}\",\"\\\\d{8}\",,,\"51234567\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"900(?:[0-24-9]\\\\d{7}|3\\\\d{1,4})\",\"\\\\d{5,11}\",,,\"90012345678\"],[,,\"NA\",\"NA\"],\n[,,\"8[1-3]\\\\d{6}\",\"\\\\d{8}\",,,\"81123456\"],[,,\"NA\",\"NA\"],\"HK\",852,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"[235-7]|[89](?:0[1-9]|[1-9])\"],\"\",\"\",0],[,\"(800)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"800\"],\"\",\"\",0],[,\"(900)(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"900\"],\"\",\"\",0],[,\"(900)(\\\\d{2,5})\",\"$1 $2\",[\"900\"],\"\",\"\",0]],,[,,\"7\\\\d{7}\",\"\\\\d{8}\",,,\"71234567\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|99[29]\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],HN:[,[,,\"[237-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2(?:2(?:0[019]|1[1-36]|[23]\\\\d|4[056]|5[57]|8[0146-9]|9[012])|4(?:2|3-59]|3[13-689]|4[0-68]|5[1-35])|5(?:4[3-5]|5\\\\d|6[56]|74)|6(?:4[0-378]|[56]\\\\d|[78][0-8]|9[01])|7(?:6[46-9]|7[02-9]|8[34])|8(?:79|8[0-35789]|9[1-57-9]))\\\\d{4}\",\n\"\\\\d{8}\",,,\"22123456\"],[,,\"[37-9]\\\\d{7}\",\"\\\\d{8}\",,,\"91234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"HN\",504,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1-$2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"199\",\"\\\\d{3}\",,,\"199\"],[,,\"NA\",\"NA\"]],HR:[,[,,\"[1-7]\\\\d{5,8}|[89]\\\\d{6,11}\",\"\\\\d{6,12}\"],[,,\"1\\\\d{7}|(?:2[0-3]|3[1-5]|4[02-47-9]|5[1-3])\\\\d{6}\",\"\\\\d{6,8}\",,,\"12345678\"],[,,\"9[1257-9]\\\\d{6,10}\",\"\\\\d{8,12}\",,,\"912345678\"],[,,\"80[01]\\\\d{4,7}\",\"\\\\d{7,10}\",,,\"8001234567\"],\n[,,\"6(?:[09]\\\\d{7}|[145]\\\\d{4,7})\",\"\\\\d{6,9}\",,,\"611234\"],[,,\"NA\",\"NA\"],[,,\"7[45]\\\\d{4,7}\",\"\\\\d{6,9}\",,,\"741234567\"],[,,\"NA\",\"NA\"],\"HR\",385,\"00\",\"0\",,,\"0\",,,,[[,\"(1)(\\\\d{4})(\\\\d{3})\",\"$1 $2 $3\",[\"1\"],\"0$1\",\"\",0],[,\"(6[09])(\\\\d{4})(\\\\d{3})\",\"$1 $2 $3\",[\"6[09]\"],\"0$1\",\"\",0],[,\"(62)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"62\"],\"0$1\",\"\",0],[,\"([2-5]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[2-5]\"],\"0$1\",\"\",0],[,\"(9\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"9\"],\"0$1\",\"\",0],[,\"(9\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"9\"],\"0$1\",\n\"\",0],[,\"(9\\\\d)(\\\\d{3,4})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"9\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2,3})\",\"$1 $2 $3\",[\"6[145]|7\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3,4})(\\\\d{3})\",\"$1 $2 $3\",[\"6[145]|7\"],\"0$1\",\"\",0],[,\"(80[01])(\\\\d{2})(\\\\d{2,3})\",\"$1 $2 $3\",[\"8\"],\"0$1\",\"\",0],[,\"(80[01])(\\\\d{3,4})(\\\\d{3})\",\"$1 $2 $3\",[\"8\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"62\\\\d{6,7}\",\"\\\\d{8,9}\",,,\"62123456\"],,[,,\"1(?:12|92)|9[34]\",\"\\\\d{2,3}\",,,\"112\"],[,,\"NA\",\"NA\"]],HT:[,[,,\"[2-489]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2(?:[24]\\\\d|5[1-5]|94)\\\\d{5}\",\n\"\\\\d{8}\",,,\"22453300\"],[,,\"(?:3[1-9]|4\\\\d)\\\\d{6}\",\"\\\\d{8}\",,,\"34101234\"],[,,\"8\\\\d{7}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"98[89]\\\\d{5}\",\"\\\\d{8}\",,,\"98901234\"],\"HT\",509,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[48]\",\"\\\\d{3}\",,,\"118\"],[,,\"NA\",\"NA\"]],HU:[,[,,\"[1-9]\\\\d{7,8}\",\"\\\\d{6,9}\"],[,,\"(?:1\\\\d|2(?:1\\\\d|[2-9])|3[2-7]|4[24-9]|5[2-79]|6[23689]|7(?:1\\\\d|[2-9])|8[2-57-9]|9[2-69])\\\\d{6}\",\"\\\\d{6,9}\",\n,,\"12345678\"],[,,\"(?:[27]0|3[01])\\\\d{7}\",\"\\\\d{9}\",,,\"201234567\"],[,,\"80\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"9[01]\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"40\\\\d{6}\",\"\\\\d{8}\",,,\"40123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"HU\",36,\"00\",\"06\",,,\"06\",,,,[[,\"(1)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"($1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[2-9]\"],\"($1)\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[457]|12)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],ID:[,[,,\"[1-9]\\\\d{6,10}\",\"\\\\d{5,11}\"],[,,\"2(?:1(?:[0-8]\\\\d{6,7}|9\\\\d{6})|[24]\\\\d{7,8})|(?:2(?:[35][1-4]|6[0-8]|7[1-6]|8\\\\d|9[1-8])|3(?:1|2[1-578]|3[1-68]|4[1-3]|5[1-8]|6[1-3568]|7[0-46]|8\\\\d)|4(?:0[1-589]|1[01347-9]|2[0-36-8]|3[0-24-68]|5[1-378]|6[1-5]|7[134]|8[1245])|5(?:1[1-35-9]|2[25-8]|3[1246-9]|4[1-3589]|5[1-46]|6[1-8])|6(?:19?|[25]\\\\d|3[1-469]|4[1-6])|7(?:1[1-46-9]|2[14-9]|[36]\\\\d|4[1-8]|5[1-9]|7[0-36-9])|9(?:0[12]|1[013-8]|2[0-479]|5[125-8]|6[23679]|7[159]|8[01346]))\\\\d{5,8}\",\n\"\\\\d{5,10}\",,,\"612345678\"],[,,\"(?:2(?:1(?:3[145]|4[01]|5[1-469]|60|8[0359]|9\\\\d)|2(?:88|9[1256])|3[1-4]9|4(?:36|91)|5(?:1[349]|[2-4]9)|6[0-7]9|7(?:[1-36]9|4[39])|8[1-5]9|9[1-48]9)|3(?:19[1-3]|2[12]9|3[13]9|4(?:1[69]|39)|5[14]9|6(?:1[69]|2[89])|709)|4[13]19|5(?:1(?:19|8[39])|4[129]9|6[12]9)|6(?:19[12]|2(?:[23]9|77))|7(?:1[13]9|2[15]9|419|5(?:1[89]|29)|6[15]9|7[178]9))\\\\d{5,6}|8[1-35-9]\\\\d{7,9}\",\"\\\\d{9,11}\",,,\"812345678\"],[,,\"177\\\\d{6,8}|800\\\\d{5,7}\",\"\\\\d{8,11}\",,,\"8001234567\"],[,,\"809\\\\d{7}\",\"\\\\d{10}\",\n,,\"8091234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"ID\",62,\"0(?:0[1789]|10(?:00|1[67]))\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{7,8})\",\"$1 $2\",[\"2[124]|[36]1\"],\"(0$1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{5,7})\",\"$1 $2\",[\"[4579]|2[035-9]|[36][02-9]\"],\"(0$1)\",\"\",0],[,\"(8\\\\d{2})(\\\\d{3,4})(\\\\d{3,4})\",\"$1-$2-$3\",[\"8[1-35-9]\"],\"0$1\",\"\",0],[,\"(177)(\\\\d{6,8})\",\"$1 $2\",[\"1\"],\"0$1\",\"\",0],[,\"(800)(\\\\d{5,7})\",\"$1 $2\",[\"800\"],\"0$1\",\"\",0],[,\"(809)(\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"809\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[02389]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],IE:[,[,,\"[124-9]\\\\d{6,9}\",\"\\\\d{5,10}\"],[,,\"1\\\\d{7,8}|2(?:1\\\\d{6,7}|3\\\\d{7}|[24-9]\\\\d{5})|4(?:0[24]\\\\d{5}|[1-469]\\\\d{7}|5\\\\d{6}|7\\\\d{5}|8[0-46-9]\\\\d{7})|5(?:0[45]\\\\d{5}|1\\\\d{6}|[23679]\\\\d{7}|8\\\\d{5})|6(?:1\\\\d{6}|[237-9]\\\\d{5}|[4-6]\\\\d{7})|7[14]\\\\d{7}|9(?:1\\\\d{6}|[04]\\\\d{7}|[35-9]\\\\d{5})\",\"\\\\d{5,10}\",,,\"2212345\"],[,,\"8(?:22\\\\d{6}|[35-9]\\\\d{7})\",\"\\\\d{9}\",,,\"850123456\"],[,,\"1800\\\\d{6}\",\"\\\\d{10}\",,,\"1800123456\"],[,,\"15(?:1[2-8]|[2-8]0|9[089])\\\\d{6}\",\n\"\\\\d{10}\",,,\"1520123456\"],[,,\"18[59]0\\\\d{6}\",\"\\\\d{10}\",,,\"1850123456\"],[,,\"700\\\\d{6}\",\"\\\\d{9}\",,,\"700123456\"],[,,\"76\\\\d{7}\",\"\\\\d{9}\",,,\"761234567\"],\"IE\",353,\"00\",\"0\",,,\"0\",,,,[[,\"(1)(\\\\d{3,4})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"(0$1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"2[24-9]|47|58|6[237-9]|9[35-9]\"],\"(0$1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{5})\",\"$1 $2\",[\"40[24]|50[45]\"],\"(0$1)\",\"\",0],[,\"(48)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"48\"],\"(0$1)\",\"\",0],[,\"(818)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"81\"],\"(0$1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\n\"$1 $2 $3\",[\"[24-69]|7[14]\"],\"(0$1)\",\"\",0],[,\"([78]\\\\d)(\\\\d{3,4})(\\\\d{4})\",\"$1 $2 $3\",[\"76|8[35-9]\"],\"0$1\",\"\",0],[,\"(700)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"70\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1(?:8[059]|5)\",\"1(?:8[059]0|5)\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"18[59]0\\\\d{6}\",\"\\\\d{10}\",,,\"1850123456\"],[,,\"818\\\\d{6}\",\"\\\\d{9}\",,,\"818123456\"],,[,,\"112|999\",\"\\\\d{3}\",,,\"112\"],[,,\"8[35-9]\\\\d{8}\",\"\\\\d{10}\",,,\"8501234567\"]],IL:[,[,,\"[17]\\\\d{6,9}|[2-589]\\\\d{3}(?:\\\\d{3,6})?|6\\\\d{3}\",\"\\\\d{4,10}\"],\n[,,\"[2-489]\\\\d{7}\",\"\\\\d{7,8}\",,,\"21234567\"],[,,\"5(?:[02347-9]\\\\d{2}|5(?:2[23]|3[34]|4[45]|5[5689]|6[67]|7[78]|8[89])|6[2-9]\\\\d)\\\\d{5}\",\"\\\\d{9}\",,,\"501234567\"],[,,\"1(?:80[019]\\\\d{3}|255)\\\\d{3}\",\"\\\\d{7,10}\",,,\"1800123456\"],[,,\"1(?:212|(?:9(?:0[01]|19)|200)\\\\d{2})\\\\d{4}\",\"\\\\d{8,10}\",,,\"1919123456\"],[,,\"1700\\\\d{6}\",\"\\\\d{10}\",,,\"1700123456\"],[,,\"NA\",\"NA\"],[,,\"7(?:2[23]\\\\d|3[237]\\\\d|47\\\\d|6(?:5\\\\d|8[08])|7\\\\d{2}|8(?:33|55|77|81))\\\\d{5}\",\"\\\\d{9}\",,,\"771234567\"],\"IL\",972,\"0(?:0|1[2-9])\",\"0\",,,\"0\",,,,[[,\"([2-489])(\\\\d{3})(\\\\d{4})\",\n\"$1-$2-$3\",[\"[2-489]\"],\"0$1\",\"\",0],[,\"([57]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"[57]\"],\"0$1\",\"\",0],[,\"(1)([7-9]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1-$2-$3-$4\",[\"1[7-9]\"],\"$1\",\"\",0],[,\"(1255)(\\\\d{3})\",\"$1-$2\",[\"125\"],\"$1\",\"\",0],[,\"(1200)(\\\\d{3})(\\\\d{3})\",\"$1-$2-$3\",[\"120\"],\"$1\",\"\",0],[,\"(1212)(\\\\d{2})(\\\\d{2})\",\"$1-$2-$3\",[\"121\"],\"$1\",\"\",0],[,\"(1599)(\\\\d{6})\",\"$1-$2\",[\"15\"],\"$1\",\"\",0],[,\"(\\\\d{4})\",\"*$1\",[\"[2-689]\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"1700\\\\d{6}|[2-689]\\\\d{3}\",\"\\\\d{4,10}\",,,\"1700123456\"],[,,\"[2-689]\\\\d{3}\",\n\"\\\\d{4}\",,,\"2250\"],,[,,\"1(?:0[012]|12)\",\"\\\\d{3}\",,,\"112\"],[,,\"1599\\\\d{6}\",\"\\\\d{10}\",,,\"1599123456\"]],IM:[,[,,\"[135789]\\\\d{6,9}\",\"\\\\d{6,10}\"],[,,\"1624\\\\d{6}\",\"\\\\d{6,10}\",,,\"1624456789\"],[,,\"7[569]24\\\\d{6}\",\"\\\\d{10}\",,,\"7924123456\"],[,,\"808162\\\\d{4}\",\"\\\\d{10}\",,,\"8081624567\"],[,,\"(?:872299|90[0167]624)\\\\d{4}\",\"\\\\d{10}\",,,\"9016247890\"],[,,\"8(?:4(?:40[49]06|5624\\\\d)|70624\\\\d)\\\\d{3}\",\"\\\\d{10}\",,,\"8456247890\"],[,,\"70\\\\d{8}\",\"\\\\d{10}\",,,\"7012345678\"],[,,\"56\\\\d{8}\",\"\\\\d{10}\",,,\"5612345678\"],\"IM\",44,\"00\",\n\"0\",\" x\",,\"0\",,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"3(?:08162\\\\d|3\\\\d{5}|4(?:40[49]06|5624\\\\d)|7(?:0624\\\\d|2299\\\\d))\\\\d{3}|55\\\\d{8}\",\"\\\\d{10}\",,,\"5512345678\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],IN:[,[,,\"1\\\\d{7,12}|[2-9]\\\\d{9,10}\",\"\\\\d{6,13}\"],[,,\"(?:11|2[02]|33|4[04]|79)[2-7]\\\\d{7}|80[2-467]\\\\d{7}|(?:1(?:2[0-249]|3[0-25]|4[145]|[59][14]|6[014]|7[1257]|8[01346])|2(?:1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|3[15]|5[12]|6[126-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:[136][25]|22|4[28]|5[12]|[78]1|9[15])|6(?:12|[2345]1|57|6[13]|7[14]|80)|7(?:12|2[14]|3[134]|4[47]|5[15]|[67]1|88)|8(?:16|2[014]|3[126]|6[136]|7[078]|8[34]|91))[2-7]\\\\d{6}|(?:(?:1(?:2[35-8]|3[346-9]|4[236-9]|[59][0235-9]|6[235-9]|7[34689]|8[257-9])|2(?:1[134689]|3[24-8]|4[2-8]|5[25689]|6[2-4679]|7[13-79]|8[2-479]|9[235-9])|3(?:01|1[79]|2[1-5]|4[25-8]|5[125689]|6[235-7]|7[157-9]|8[2-467])|4(?:1[14578]|2[5689]|3[2-467]|5[4-7]|6[35]|73|8[2689]|9[2389])|5(?:[16][146-9]|2[14-8]|3[1346]|4[14-69]|5[46]|7[2-4]|8[2-8]|9[246])|6(?:1[1358]|2[2457]|3[2-4]|4[235-7]|[57][2-689]|6[24-58]|8[1-6])|8(?:1[1357-9]|2[235-8]|3[03-57-9]|4[0-24-9]|5\\\\d|6[2457-9]|7[1-6]|8[1256]|9[2-4]))\\\\d|7(?:(?:1[013-9]|2[0235-9]|3[2679]|4[1-35689]|5[2-46-9]|[67][02-9]|9\\\\d)\\\\d|8(?:2[0-6]|[013-8]\\\\d)))[2-7]\\\\d{5}\",\n\"\\\\d{6,10}\",,,\"1123456789\"],[,,\"(?:7(?:2(?:0[04-9]|5[09]|7[5-8]|9[389])|3(?:0[1-9]|[58]\\\\d|7[3679]|9[689])|4(?:0[1-9]|1[15-9]|[29][89]|39|8[389])|5(?:0\\\\d|[47]9|[25]0|6[6-9]|[89][7-9])|6(?:0[027]|12|20|3[19]|5[45]|6[5-9]|7[679]|9[6-9])|7(?:0[27-9]|3[5-9]|42|6[03-9]|[79]\\\\d|8[1-9])|8(?:[0-7]\\\\d|9[013-9]))|8(?:0(?:[01589]\\\\d|6[67])|1(?:[02-589]\\\\d|1[0135-9]|7[0-79])|2(?:[236-9]\\\\d|5[1-9])|3(?:[037-9]\\\\d|4[1-9]|5[0-37-9])|[45]\\\\d{2}|6[02457-9]\\\\d|7[1-69]\\\\d|8(?:[0-26-9]\\\\d|44|5[2-9])|9(?:[035-9]\\\\d|2[2-9]|4[0-8]))|9\\\\d{3})\\\\d{6}\",\n\"\\\\d{10}\",,,\"9123456789\"],[,,\"1(?:600\\\\d{6}|80(?:0\\\\d{4,8}|3\\\\d{9}))\",\"\\\\d{8,13}\",,,\"1800123456\"],[,,\"186[12]\\\\d{9}\",\"\\\\d{13}\",,,\"1861123456789\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"IN\",91,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{6})\",\"$1 $2 $3\",[\"7(?:2[0579]|3[057-9]|4[0-389]|5[024-9]|6[0-35-9]|7[0346-9]|8[0-79])|8(?:0[015689]|1[0-57-9]|2[2356-9]|3[0-57-9]|[45]|6[0245789]|7[1-69]|8[0124-9]|9[02-9])|9\",\"7(?:2(?:0[04-9]|5[09]|7[5-8]|9[389])|3(?:0[1-9]|[58]|7[3679]|9[689])|4(?:0[1-9]|1[15-9]|[29][89]|39|8[389])|5(?:0|[47]9|[25]0|6[6-9]|[89][7-9])|6(?:0[027]|12|20|3[19]|5[45]|6[5-9]|7[679]|9[6-9])|7(?:0[27-9]|3[5-9]|42|60|7[7-9]|8[1-9]|9[05-9])|8(?:[03][07-9]|14|2[7-9]|[4-7]|9[013-9]))|8(?:0(?:[01589]|6[67])|1(?:[02-589]|1[0135-9]|7[0-79])|2(?:[236-9]|5[1-9])|3(?:[037-9]|4[1-9]|5[0-37-9])|[45]|6[02457-9]|7[1-69]|8(?:[0-26-9]|44|5[2-9])|9(?:[035-9]|2[2-9]|4[0-8]))|9\"],\n\"0$1\",\"\",1],[,\"(\\\\d{2})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"11|2[02]|33|4[04]|79|80[2-46]\"],\"0$1\",\"\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1(?:2[0-249]|3[0-25]|4[145]|[569][14]|7[1257]|8[1346]|[68][1-9])|2(?:1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|3[15]|5[12]|6[126-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:[136][25]|22|4[28]|5[12]|[78]1|9[15])|6(?:12|[2345]1|57|6[13]|7[14]|80)\"],\"0$1\",\"\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",\n[\"7(?:12|2[14]|3[134]|4[47]|5[15]|[67]1|88)\",\"7(?:12|2[14]|3[134]|4[47]|5(?:1|5[2-6])|[67]1|88)\"],\"0$1\",\"\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"8(?:16|2[014]|3[126]|6[136]|7[078]|8[34]|91)\"],\"0$1\",\"\",1],[,\"(\\\\d{4})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1(?:[2-579]|[68][1-9])|[2-8]\"],\"0$1\",\"\",1],[,\"(1600)(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"160\",\"1600\"],\"$1\",\"\",0],[,\"(1800)(\\\\d{4,5})\",\"$1 $2\",[\"180\",\"1800\"],\"$1\",\"\",0],[,\"(18[06]0)(\\\\d{2,4})(\\\\d{4})\",\"$1 $2 $3\",[\"18[06]\",\"18[06]0\"],\"$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{3})(\\\\d{4})(\\\\d{2})\",\n\"$1 $2 $3 $4\",[\"18[06]\",\"18(?:03|6[12])\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"1(?:600\\\\d{6}|8(?:0(?:0\\\\d{4,8}|3\\\\d{9})|6(?:0\\\\d{7}|[12]\\\\d{9})))\",\"\\\\d{8,13}\",,,\"1800123456\"],[,,\"1860\\\\d{7}\",\"\\\\d{11}\",,,\"18603451234\"],,[,,\"1(?:0[0128]|12|298)|2611\",\"\\\\d{3,4}\",,,\"108\"],[,,\"NA\",\"NA\"]],IO:[,[,,\"3\\\\d{6}\",\"\\\\d{7}\"],[,,\"37\\\\d{5}\",\"\\\\d{7}\",,,\"3709100\"],[,,\"38\\\\d{5}\",\"\\\\d{7}\",,,\"3801234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"IO\",246,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",\n,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],IQ:[,[,,\"[1-7]\\\\d{7,9}\",\"\\\\d{6,10}\"],[,,\"1\\\\d{7}|(?:2[13-5]|3[02367]|4[023]|5[03]|6[026])\\\\d{6,7}\",\"\\\\d{6,9}\",,,\"12345678\"],[,,\"7[3-9]\\\\d{8}\",\"\\\\d{10}\",,,\"7912345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"IQ\",964,\"00\",\"0\",,,\"0\",,,,[[,\"(1)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"0$1\",\"\",0],[,\"([2-6]\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[2-6]\"],\"0$1\",\"\",0],[,\"(7\\\\d{2})(\\\\d{3})(\\\\d{4})\",\n\"$1 $2 $3\",[\"7\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],IR:[,[,,\"[14-8]\\\\d{6,9}|[23]\\\\d{5,9}|9(?:[1-4]\\\\d{8}|9\\\\d{2,8})\",\"\\\\d{4,10}\"],[,,\"(?:[145](?:1[1-9]|[2-9]\\\\d)\\\\d{0,3}|[23][1-9]\\\\d{0,4}|6[1-9]\\\\d{1,4}|[78]\\\\d{2,5})\\\\d{4}\",\"\\\\d{6,10}\",,,\"2123456789\"],[,,\"9[1-3]\\\\d{8}\",\"\\\\d{10}\",,,\"9123456789\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"(?:[2-6]0\\\\d|993)\\\\d{7}\",\"\\\\d{10}\",,,\"9932123456\"],\"IR\",98,\"00\",\"0\",,,\"0\",,,,[[,\"(21)(\\\\d{3,5})\",\n\"$1 $2\",[\"21\"],\"0$1\",\"\",0],[,\"(21)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"21\"],\"0$1\",\"\",0],[,\"(2[16])(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"2[16]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[13-9]|2[02-9]\"],\"0$1\",\"\",0]],,[,,\"943\\\\d{7}\",\"\\\\d{10}\",,,\"9432123456\"],,,[,,\"NA\",\"NA\"],[,,\"9990\\\\d{0,6}\",\"\\\\d{4,10}\",,,\"9990123456\"],,[,,\"1(?:1[025]|25)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],IS:[,[,,\"[4-9]\\\\d{6}|38\\\\d{7}\",\"\\\\d{7,9}\"],[,,\"(?:4(?:[14][0-245]|2[0-7]|[37][0-8]|5[0-3568]|6\\\\d|8[0-36-8])|5(?:05|[156]\\\\d|2[02578]|3[013-7]|4[03-7]|7[0-2578]|8[0-35-9]|9[013-689])|87[23])\\\\d{4}\",\n\"\\\\d{7}\",,,\"4101234\"],[,,\"38[59]\\\\d{6}|(?:6(?:1[0-8]|3[0-27-9]|4[0-27]|5[0-29]|[67][0-69]|9\\\\d)|7(?:5[057]|7\\\\d|8[0-3])|8(?:2[0-5]|[469]\\\\d|5[1-9]))\\\\d{4}\",\"\\\\d{7,9}\",,,\"6101234\"],[,,\"800\\\\d{4}\",\"\\\\d{7}\",,,\"8001234\"],[,,\"90\\\\d{5}\",\"\\\\d{7}\",,,\"9011234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"49[0-24-79]\\\\d{4}\",\"\\\\d{7}\",,,\"4921234\"],\"IS\",354,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[4-9]\"],\"\",\"\",0],[,\"(3\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"3\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,\n,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"388\\\\d{6}|(?:6(?:2[0-8]|49|8\\\\d)|8(?:2[6-9]|[38]\\\\d|50|7[014-9])|95[48])\\\\d{4}\",\"\\\\d{7,9}\",,,\"388123456\"]],IT:[,[,,\"[01589]\\\\d{5,10}|3(?:[12457-9]\\\\d{8}|[36]\\\\d{7,9})\",\"\\\\d{6,11}\"],[,,\"0(?:[26]\\\\d{4,9}|(?:1(?:[0159]\\\\d|[27][1-5]|31|4[1-4]|6[1356]|8[2-57])|3(?:[0159]\\\\d|2[1-4]|3[12]|[48][1-6]|6[2-59]|7[1-7])|4(?:[0159]\\\\d|[23][1-9]|4[245]|6[1-5]|7[1-4]|81)|5(?:[0159]\\\\d|2[1-5]|3[2-6]|4[1-79]|6[4-6]|7[1-578]|8[3-8])|7(?:[0159]\\\\d|2[12]|3[1-7]|4[2346]|6[13569]|7[13-6]|8[1-59])|8(?:[0159]\\\\d|2[34578]|3[1-356]|[6-8][1-5])|9(?:[0159]\\\\d|[238][1-5]|4[12]|6[1-8]|7[1-6]))\\\\d{2,7})\",\n\"\\\\d{6,11}\",,,\"0212345678\"],[,,\"3(?:[12457-9]\\\\d{8}|6\\\\d{7,8}|3\\\\d{7,9})\",\"\\\\d{9,11}\",,,\"3123456789\"],[,,\"80(?:0\\\\d{6}|3\\\\d{3})\",\"\\\\d{6,9}\",,,\"800123456\"],[,,\"0878\\\\d{5}|1(?:44|6[346])\\\\d{6}|89(?:2\\\\d{3}|4(?:[0-4]\\\\d{2}|[5-9]\\\\d{4})|5(?:[0-4]\\\\d{2}|[5-9]\\\\d{6})|9\\\\d{6})\",\"\\\\d{6,10}\",,,\"899123456\"],[,,\"84(?:[08]\\\\d{6}|[17]\\\\d{3})\",\"\\\\d{6,9}\",,,\"848123456\"],[,,\"1(?:78\\\\d|99)\\\\d{6}\",\"\\\\d{9,10}\",,,\"1781234567\"],[,,\"55\\\\d{8}\",\"\\\\d{10}\",,,\"5512345678\"],\"IT\",39,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{3,4})(\\\\d{4})\",\n\"$1 $2 $3\",[\"0[26]|55\"],\"\",\"\",0],[,\"(0[26])(\\\\d{4})(\\\\d{5})\",\"$1 $2 $3\",[\"0[26]\"],\"\",\"\",0],[,\"(0[26])(\\\\d{4,6})\",\"$1 $2\",[\"0[26]\"],\"\",\"\",0],[,\"(0\\\\d{2})(\\\\d{3,4})(\\\\d{4})\",\"$1 $2 $3\",[\"0[13-57-9][0159]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{3,6})\",\"$1 $2\",[\"0[13-57-9][0159]|8(?:03|4[17]|9[245])\",\"0[13-57-9][0159]|8(?:03|4[17]|9(?:2|[45][0-4]))\"],\"\",\"\",0],[,\"(0\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"0[13-57-9][2-46-8]\"],\"\",\"\",0],[,\"(0\\\\d{3})(\\\\d{2,6})\",\"$1 $2\",[\"0[13-57-9][2-46-8]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3,4})\",\n\"$1 $2 $3\",[\"[13]|8(?:00|4[08]|9[59])\",\"[13]|8(?:00|4[08]|9(?:5[5-9]|9))\"],\"\",\"\",0],[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"894\",\"894[5-9]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"3\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"848\\\\d{6}\",\"\\\\d{9}\",,,\"848123456\"],[,,\"NA\",\"NA\"],1,[,,\"11[2358]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],JE:[,[,,\"[135789]\\\\d{6,9}\",\"\\\\d{6,10}\"],[,,\"1534\\\\d{6}\",\"\\\\d{6,10}\",,,\"1534456789\"],[,,\"7(?:509|7(?:00|97)|829|937)\\\\d{6}\",\"\\\\d{10}\",,,\"7797123456\"],[,,\"80(?:07(?:35|81)|8901)\\\\d{4}\",\"\\\\d{10}\",\n,,\"8007354567\"],[,,\"(?:871206|90(?:066[59]|1810|71(?:07|55)))\\\\d{4}\",\"\\\\d{10}\",,,\"9018105678\"],[,,\"8(?:4(?:4(?:4(?:05|42|69)|703)|5(?:041|800))|70002)\\\\d{4}\",\"\\\\d{10}\",,,\"8447034567\"],[,,\"701511\\\\d{4}\",\"\\\\d{10}\",,,\"7015115678\"],[,,\"56\\\\d{8}\",\"\\\\d{10}\",,,\"5612345678\"],\"JE\",44,\"00\",\"0\",\" x\",,\"0\",,,,,,[,,\"76(?:0[012]|2[356]|4[0134]|5[49]|6[0-369]|77|81|9[39])\\\\d{6}\",\"\\\\d{10}\",,,\"7640123456\"],,,[,,\"NA\",\"NA\"],[,,\"3(?:0(?:07(?:35|81)|8901)|3\\\\d{4}|4(?:4(?:4(?:05|42|69)|703)|5(?:041|800))|7(?:0002|1206))\\\\d{4}|55\\\\d{8}\",\n\"\\\\d{10}\",,,\"5512345678\"],,[,,\"112|999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],JM:[,[,,\"[589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"876(?:5(?:0[12]|1[0-468]|2[35]|63)|6(?:0[1-3579]|1[027-9]|[23]\\\\d|40|5[06]|6[2-489]|7[05]|8[04]|9[4-9])|7(?:0[2-689]|[1-6]\\\\d|8[056]|9[45])|9(?:0[1-8]|1[02378]|[2-8]\\\\d|9[2-468]))\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"8765123456\"],[,,\"876(?:2[1789]\\\\d|[348]\\\\d{2}|5(?:08|27|6[0-24-9]|[3-578]\\\\d)|7(?:0[07]|7\\\\d|8[1-47-9]|9[0-36-9])|9(?:[01]9|9[0579]))\\\\d{4}\",\"\\\\d{10}\",,,\"8762101234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\n\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"JM\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"876\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[09]\",\"\\\\d{3}\",,,\"119\"],[,,\"NA\",\"NA\"]],JO:[,[,,\"[235-9]\\\\d{7,8}\",\"\\\\d{7,9}\"],[,,\"(?:2(?:6(?:2[0-35-9]|3[0-57-8]|4[24-7]|5[0-24-8]|[6-9][02])|7(?:0[1-79]|10|2[014-7]|3[0-689]|4[019]|5[0-3578]))|32(?:0[1-69]|1[1-35-7]|2[024-7]|3\\\\d|[457][02]|60)|53(?:[013][02]|2[0-59]|49|5[0-35-9]|6[15]|7[45]|8[1-6]|9[0-36-9])|6(?:2[50]0|300|4(?:0[0125]|1[2-7]|2[0569]|[38][07-9]|4[025689]|6[0-589]|7\\\\d|9[0-2])|5(?:[01][056]|2[034]|3[0-57-9]|4[17-8]|5[0-69]|6[0-35-9]|7[1-379]|8[0-68]|9[02-39]))|87(?:[02]0|7[08]|9[09]))\\\\d{4}\",\n\"\\\\d{7,8}\",,,\"62001234\"],[,,\"7(?:55|7[25-9]|8[5-9]|9[05-9])\\\\d{6}\",\"\\\\d{9}\",,,\"790123456\"],[,,\"80\\\\d{6}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"900\\\\d{5}\",\"\\\\d{8}\",,,\"90012345\"],[,,\"85\\\\d{6}\",\"\\\\d{8}\",,,\"85012345\"],[,,\"70\\\\d{7}\",\"\\\\d{9}\",,,\"700123456\"],[,,\"NA\",\"NA\"],\"JO\",962,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[2356]|87\"],\"(0$1)\",\"\",0],[,\"(7)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"7[457-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{5,6})\",\"$1 $2\",[\"70|8[0158]|9\"],\"0$1\",\"\",0]],,[,,\"74(?:66|77)\\\\d{5}\",\"\\\\d{9}\",\n,,\"746612345\"],,,[,,\"NA\",\"NA\"],[,,\"8(?:10|8\\\\d)\\\\d{5}\",\"\\\\d{8}\",,,\"88101234\"],,[,,\"1(?:12|91)|911\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],JP:[,[,,\"[1-9]\\\\d{8,9}|0(?:[36]\\\\d{7,14}|7\\\\d{5,7}|8\\\\d{7})\",\"\\\\d{7,16}\"],[,,\"(?:1(?:1[235-8]|2[3-6]|3[3-9]|4[2-6]|[58][2-8]|6[2-7]|7[2-9]|9[1-9])|2[2-9]\\\\d|[36][1-9]\\\\d|4(?:6[02-8]|[2-578]\\\\d|9[2-59])|5(?:6[1-9]|7[2-8]|[2-589]\\\\d)|7(?:3[4-9]|4[02-9]|[25-9]\\\\d)|8(?:3[2-9]|4[5-9]|5[1-9]|8[03-9]|[2679]\\\\d)|9(?:[679][1-9]|[2-58]\\\\d))\\\\d{6}\",\"\\\\d{9}\",,,\"312345678\"],[,,\"(?:[79]0\\\\d|80[1-9])\\\\d{7}\",\n\"\\\\d{10}\",,,\"7012345678\"],[,,\"120\\\\d{6}|800\\\\d{7}|0(?:37\\\\d{6,13}|66\\\\d{6,13}|777(?:[01]\\\\d{2}|5\\\\d{3}|8\\\\d{4})|882[1245]\\\\d{4})\",\"\\\\d{7,16}\",,,\"120123456\"],[,,\"990\\\\d{6}\",\"\\\\d{9}\",,,\"990123456\"],[,,\"NA\",\"NA\"],[,,\"60\\\\d{7}\",\"\\\\d{9}\",,,\"601234567\"],[,,\"50[1-9]\\\\d{7}\",\"\\\\d{10}\",,,\"5012345678\"],\"JP\",81,\"010\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1-$2-$3\",[\"(?:12|57|99)0\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"800\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})\",\"$1-$2\",[\"077\"],\"0$1\",\"\",0],[,\n\"(\\\\d{3})(\\\\d{2})(\\\\d{3,4})\",\"$1-$2-$3\",[\"077\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{4})\",\"$1-$2-$3\",[\"088\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3,4})\",\"$1-$2-$3\",[\"0(?:37|66)\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})(\\\\d{4,5})\",\"$1-$2-$3\",[\"0(?:37|66)\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{5})(\\\\d{5,6})\",\"$1-$2-$3\",[\"0(?:37|66)\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{6})(\\\\d{6,7})\",\"$1-$2-$3\",[\"0(?:37|66)\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{4})(\\\\d{4})\",\"$1-$2-$3\",[\"[2579]0|80[1-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d)(\\\\d{4})\",\"$1-$2-$3\",\n[\"1(?:26|3[79]|4[56]|5[4-68]|6[3-5])|5(?:76|97)|499|746|8(?:3[89]|63|47|51)|9(?:49|80|9[16])\",\"1(?:267|3(?:7[247]|9[278])|4(?:5[67]|66)|5(?:47|58|64|8[67])|6(?:3[245]|48|5[4-68]))|5(?:76|97)9|499[2468]|7468|8(?:3(?:8[78]|96)|636|477|51[24])|9(?:496|802|9(?:1[23]|69))\",\"1(?:267|3(?:7[247]|9[278])|4(?:5[67]|66)|5(?:47|58|64|8[67])|6(?:3[245]|48|5[4-68]))|5(?:769|979[2-69])|499[2468]|7468|8(?:3(?:8[78]|96[2457-9])|636[2-57-9]|477|51[24])|9(?:496|802|9(?:1[23]|69))\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{4})\",\n\"$1-$2-$3\",[\"1(?:2[3-6]|3[3-9]|4[2-6]|5[2-8]|[68][2-7]|7[2-689]|9[1-578])|2(?:2[03-689]|3[3-58]|4[0-468]|5[04-8]|6[013-8]|7[06-9]|8[02-57-9]|9[13])|4(?:2[28]|3[689]|6[035-7]|7[05689]|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9[4-9])|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9[014-9])|8(?:2[49]|3[3-8]|4[5-8]|5[2-9]|6[35-9]|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9[3-7])\",\"1(?:2[3-6]|3[3-9]|4[2-6]|5(?:[236-8]|[45][2-69])|[68][2-7]|7[2-689]|9[1-578])|2(?:2(?:[04-689]|3[23])|3[3-58]|4[0-468]|5(?:5[78]|7[2-4]|[0468][2-9])|6(?:[0135-8]|4[2-5])|7(?:[0679]|8[2-7])|8(?:[024578]|3[25-9]|9[6-9])|9(?:11|3[2-4]))|4(?:2(?:2[2-9]|8[237-9])|3[689]|6[035-7]|7(?:[059][2-8]|[68])|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9(?:[89][2-8]|[4-7]))|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9(?:[017-9]|4[6-8]|5[2-478]|6[2-589]))|8(?:2(?:4[4-8]|9[2-8])|3(?:7[2-6]|[3-6][2-9]|8[2-5])|4[5-8]|5[2-9]|6(?:[37]|5[4-7]|6[2-9]|8[2-8]|9[236-9])|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9(?:3[34]|[4-7]))\",\n\"1(?:2[3-6]|3[3-9]|4[2-6]|5(?:[236-8]|[45][2-69])|[68][2-7]|7[2-689]|9[1-578])|2(?:2(?:[04-689]|3[23])|3[3-58]|4[0-468]|5(?:5[78]|7[2-4]|[0468][2-9])|6(?:[0135-8]|4[2-5])|7(?:[0679]|8[2-7])|8(?:[024578]|3[25-9]|9[6-9])|9(?:11|3[2-4]))|4(?:2(?:2[2-9]|8[237-9])|3[689]|6[035-7]|7(?:[059][2-8]|[68])|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9(?:[89][2-8]|[4-7]))|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9(?:[017-9]|4[6-8]|5[2-478]|6[2-589]))|8(?:2(?:4[4-8]|9(?:[3578]|20|4[04-9]|6[56]))|3(?:7(?:[2-5]|6[0-59])|[3-6][2-9]|8[2-5])|4[5-8]|5[2-9]|6(?:[37]|5(?:[467]|5[014-9])|6(?:[2-8]|9[02-69])|8[2-8]|9(?:[236-8]|9[23]))|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9(?:3(?:3[02-9]|4[0-24689])|4[2-69]|[5-7]))\",\n\"1(?:2[3-6]|3[3-9]|4[2-6]|5(?:[236-8]|[45][2-69])|[68][2-7]|7[2-689]|9[1-578])|2(?:2(?:[04-689]|3[23])|3[3-58]|4[0-468]|5(?:5[78]|7[2-4]|[0468][2-9])|6(?:[0135-8]|4[2-5])|7(?:[0679]|8[2-7])|8(?:[024578]|3[25-9]|9[6-9])|9(?:11|3[2-4]))|4(?:2(?:2[2-9]|8[237-9])|3[689]|6[035-7]|7(?:[059][2-8]|[68])|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9(?:[89][2-8]|[4-7]))|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9(?:[017-9]|4[6-8]|5[2-478]|6[2-589]))|8(?:2(?:4[4-8]|9(?:[3578]|20|4[04-9]|6(?:5[25]|60)))|3(?:7(?:[2-5]|6[0-59])|[3-6][2-9]|8[2-5])|4[5-8]|5[2-9]|6(?:[37]|5(?:[467]|5[014-9])|6(?:[2-8]|9[02-69])|8[2-8]|9(?:[236-8]|9[23]))|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9(?:3(?:3[02-9]|4[0-24689])|4[2-69]|[5-7]))\"],\n\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"1|2(?:2[37]|5[5-9]|64|78|8[39]|91)|4(?:2[2689]|64|7[347])|5(?:[2-589]|39)|60|8(?:[46-9]|3[279]|2[124589])|9(?:[235-8]|93)\",\"1|2(?:2[37]|5(?:[57]|[68]0|9[19])|64|78|8[39]|917)|4(?:2(?:[68]|20|9[178])|64|7[347])|5(?:[2-589]|39[67])|60|8(?:[46-9]|3[279]|2[124589])|9(?:[235-8]|93[34])\",\"1|2(?:2[37]|5(?:[57]|[68]0|9(?:17|99))|64|78|8[39]|917)|4(?:2(?:[68]|20|9[178])|64|7[347])|5(?:[2-589]|39[67])|60|8(?:[46-9]|3[279]|2[124589])|9(?:[235-8]|93(?:31|4))\"],\n\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{4})\",\"$1-$2-$3\",[\"2(?:9[14-79]|74|[34]7|[56]9)|82|993\"],\"0$1\",\"\",0],[,\"(\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1-$2-$3\",[\"3|4(?:2[09]|7[01])|6[1-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"[2479][1-9]\"],\"0$1\",\"\",0]],,[,,\"20\\\\d{8}\",\"\\\\d{10}\",,,\"2012345678\"],,,[,,\"0(?:37\\\\d{6,13}|66\\\\d{6,13}|777(?:[01]\\\\d{2}|5\\\\d{3}|8\\\\d{4})|882[1245]\\\\d{4})\",\"\\\\d{7,16}\",,,\"0777012\"],[,,\"570\\\\d{6}\",\"\\\\d{9}\",,,\"570123456\"],1,[,,\"11[09]\",\"\\\\d{3}\",,,\"110\"],[,,\"NA\",\"NA\"]],KE:[,[,,\"20\\\\d{6,7}|[4-9]\\\\d{6,9}\",\n\"\\\\d{5,10}\"],[,,\"20\\\\d{6,7}|4(?:[013]\\\\d{7}|[24-6]\\\\d{5,7})|5(?:[0-36-8]\\\\d{5,7}|[459]\\\\d{5})|6(?:[08]\\\\d{5}|[14-79]\\\\d{5,7}|2\\\\d{7})\",\"\\\\d{5,9}\",,,\"202012345\"],[,,\"7(?:0[0-8]|[123]\\\\d|5[0-6]|7[0-5]|8[5-9])\\\\d{6}\",\"\\\\d{9}\",,,\"712123456\"],[,,\"800[24-8]\\\\d{5,6}\",\"\\\\d{9,10}\",,,\"800223456\"],[,,\"900[02-578]\\\\d{5}\",\"\\\\d{9}\",,,\"900223456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"KE\",254,\"000\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{4,7})\",\"$1 $2\",[\"[24-6]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{6,7})\",\"$1 $2\",[\"7\"],\"0$1\",\n\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[89]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],KG:[,[,,\"[35-8]\\\\d{8,9}\",\"\\\\d{5,10}\"],[,,\"(?:3(?:1(?:2\\\\d|3[1-9]|47|5[02]|6[1-8])|2(?:22|3[0-479]|6[0-7])|4(?:22|5[6-9]|6[0-4])|5(?:22|3[4-7]|59|6[0-5])|6(?:22|5[35-7]|6[0-3])|7(?:22|3[468]|4[1-9]|59|6\\\\d|7[5-7])|9(?:22|4[1-8]|6[0-8]))|6(?:09|12|2[2-4])\\\\d)\\\\d{5}\",\"\\\\d{5,10}\",,,\"312123456\"],[,,\"5[124-7]\\\\d{7}|7(?:0[0-357-9]|7\\\\d)\\\\d{6}\",\n\"\\\\d{9}\",,,\"700123456\"],[,,\"800\\\\d{6,7}\",\"\\\\d{9,10}\",,,\"800123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"KG\",996,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"31[25]|[5-7]\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{5})\",\"$1 $2\",[\"3(?:1[36]|[2-9])\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d)(\\\\d{3})\",\"$1 $2 $3 $4\",[\"8\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"10[123]\",\"\\\\d{3}\",,,\"101\"],[,,\"NA\",\"NA\"]],KH:[,[,,\"[1-9]\\\\d{7,9}\",\"\\\\d{6,10}\"],[,,\"(?:2[3-6]|3[2-6]|4[2-4]|[567][2-5])(?:[2-47-9]|5\\\\d|6\\\\d?)\\\\d{5}\",\n\"\\\\d{6,9}\",,,\"23456789\"],[,,\"(?:(?:1\\\\d|6[06-9]|7(?:[07-9]|6\\\\d))[1-9]|8(?:0[89]|[134679]\\\\d|5[2-689]|8\\\\d{2})|9(?:[0-589][1-9]|[67][1-9]\\\\d?))\\\\d{5}\",\"\\\\d{8,9}\",,,\"91234567\"],[,,\"1800(?:1\\\\d|2[019])\\\\d{4}\",\"\\\\d{10}\",,,\"1800123456\"],[,,\"1900(?:1\\\\d|2[09])\\\\d{4}\",\"\\\\d{10}\",,,\"1900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"KH\",855,\"00[14-9]\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"1\\\\d[1-9]|[2-9]\"],\"0$1\",\"\",0],[,\"(1[89]00)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1[89]0\"],\"\",\"\",0]],\n,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[789]|666\",\"\\\\d{3}\",,,\"117\"],[,,\"NA\",\"NA\"]],KI:[,[,,\"[2-689]\\\\d{4}\",\"\\\\d{5}\"],[,,\"(?:[234]\\\\d|50|8[1-5])\\\\d{3}\",\"\\\\d{5}\",,,\"31234\"],[,,\"6\\\\d{4}|9(?:[0-8]\\\\d|9[015-8])\\\\d{2}\",\"\\\\d{5}\",,,\"61234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"KI\",686,\"00\",,,,\"0\",,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"99[2349]\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],KM:[,[,,\"[379]\\\\d{6}\",\"\\\\d{7}\"],[,,\"7(?:6[0-37-9]|7[0-57-9])\\\\d{4}\",\n\"\\\\d{7}\",,,\"7712345\"],[,,\"3[234]\\\\d{5}\",\"\\\\d{7}\",,,\"3212345\"],[,,\"NA\",\"NA\"],[,,\"(?:39[01]|9[01]0)\\\\d{4}\",\"\\\\d{7}\",,,\"9001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"KM\",269,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[78]\",\"\\\\d{2}\",,,\"17\"],[,,\"NA\",\"NA\"]],KN:[,[,,\"[589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"869(?:2(?:29|36)|302|4(?:6[5-9]|70))\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"8692361234\"],[,,\"869(?:5(?:5[6-8]|6[5-7])|66\\\\d|76[02-6])\\\\d{4}\",\n\"\\\\d{10}\",,,\"8695561234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"KN\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"869\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"333|9(?:11|99)\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],KP:[,[,,\"1\\\\d{9}|[28]\\\\d{7}\",\"\\\\d{6,8}|\\\\d{10}\"],[,,\"2\\\\d{7}|85\\\\d{6}\",\"\\\\d{6,8}\",,,\"21234567\"],[,,\"19[123]\\\\d{7}\",\"\\\\d{10}\",,,\"1921234567\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"KP\",850,\"00|99\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"0$1\",\"\",0],[,\"(\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"2\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"8\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"2(?:[0-24-9]\\\\d{2}|3(?:[0-79]\\\\d|8[02-9]))\\\\d{4}\",\"\\\\d{8}\",,,\"23821234\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],KR:[,[,,\"[1-7]\\\\d{3,9}|8\\\\d{8}\",\"\\\\d{4,10}\"],[,,\"(?:2|3[1-3]|[46][1-4]|5[1-5])(?:1\\\\d{2,3}|[1-9]\\\\d{6,7})\",\n\"\\\\d{4,10}\",,,\"22123456\"],[,,\"1[0-26-9]\\\\d{7,8}\",\"\\\\d{9,10}\",,,\"1023456789\"],[,,\"80\\\\d{7}\",\"\\\\d{9}\",,,\"801234567\"],[,,\"60[2-9]\\\\d{6}\",\"\\\\d{9}\",,,\"602345678\"],[,,\"NA\",\"NA\"],[,,\"50\\\\d{8}\",\"\\\\d{10}\",,,\"5012345678\"],[,,\"70\\\\d{8}\",\"\\\\d{10}\",,,\"7012345678\"],\"KR\",82,\"00(?:[124-68]|[37]\\\\d{2})\",\"0\",,,\"0(8[1-46-8]|85\\\\d{2})?\",,,,[[,\"(\\\\d{2})(\\\\d{4})(\\\\d{4})\",\"$1-$2-$3\",[\"1(?:0|1[19]|[69]9|5[458])|[57]0\",\"1(?:0|1[19]|[69]9|5(?:44|59|8))|[57]0\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d{2})(\\\\d{3,4})(\\\\d{4})\",\"$1-$2-$3\",[\"1(?:[169][2-8]|[78]|5[1-4])|[68]0|[3-6][1-9][1-9]\",\n\"1(?:[169][2-8]|[78]|5(?:[1-3]|4[56]))|[68]0|[3-6][1-9][1-9]\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d{3})(\\\\d)(\\\\d{4})\",\"$1-$2-$3\",[\"131\",\"1312\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{4})\",\"$1-$2-$3\",[\"131\",\"131[13-9]\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\",[\"13[2-9]\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3-$4\",[\"30\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d)(\\\\d{3,4})(\\\\d{4})\",\"$1-$2-$3\",[\"2[1-9]\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d)(\\\\d{3,4})\",\"$1-$2\",[\"21[0-46-9]\"],\"0$1\",\"0$CC-$1\",\n0],[,\"(\\\\d{2})(\\\\d{3,4})\",\"$1-$2\",[\"[3-6][1-9]1\",\"[3-6][1-9]1(?:[0-46-9])\"],\"0$1\",\"0$CC-$1\",0],[,\"(\\\\d{4})(\\\\d{4})\",\"$1-$2\",[\"1(?:5[46-9]|6[04678])\",\"1(?:5(?:44|66|77|88|99)|6(?:00|44|6[16]|70|88))\"],\"$1\",\"0$CC-$1\",0]],,[,,\"15\\\\d{7,8}\",\"\\\\d{9,10}\",,,\"1523456789\"],,,[,,\"NA\",\"NA\"],[,,\"1(?:5(?:44|66|77|88|99)|6(?:00|44|6[16]|70|88))\\\\d{4}\",\"\\\\d{8}\",,,\"15441234\"],,[,,\"11[29]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],KW:[,[,,\"[12569]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"(?:18\\\\d|2(?:[23]\\\\d{2}|4(?:[1-35-9]\\\\d|44)|5(?:0[034]|[2-46]\\\\d|5[1-3]|7[1-7])))\\\\d{4}\",\n\"\\\\d{7,8}\",,,\"22345678\"],[,,\"(?:5(?:1[0-2]|[05]\\\\d)|6(?:0[034679]|5[015-9]|6\\\\d|7[067]|9[0369])|9(?:0[09]|4[049]|6[069]|[79]\\\\d))\\\\d{5}\",\"\\\\d{8}\",,,\"50012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"KW\",965,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{3,4})\",\"$1 $2\",[\"[1269]\"],\"\",\"\",0],[,\"(5[015]\\\\d)(\\\\d{5})\",\"$1 $2\",[\"5\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],KY:[,[,,\"[3589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"345(?:2(?:22|44)|444|6(?:23|38|40)|7(?:4[35-79]|6[6-9]|77)|8(?:00|1[45]|25|[48]8)|9(?:14|4[035-9]))\\\\d{4}\",\n\"\\\\d{7}(?:\\\\d{3})?\",,,\"3452221234\"],[,,\"345(?:32[1-9]|5(?:1[67]|2[5-7]|4[6-8]|76)|9(?:1[67]|2[3-9]|3[689]))\\\\d{4}\",\"\\\\d{10}\",,,\"3453231234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002345678\"],[,,\"900[2-9]\\\\d{6}|345976\\\\d{4}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"KY\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"345849\\\\d{4}\",\"\\\\d{10}\",,,\"3458491234\"],,\"345\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],KZ:[,\n[,,\"(?:33\\\\d|7\\\\d{2}|80[09])\\\\d{7}\",\"\\\\d{10}\"],[,,\"33622\\\\d{5}|7(?:1(?:0(?:[23]\\\\d|4[023]|59|63)|1(?:[23]\\\\d|4[0-79]|59)|2(?:[23]\\\\d|59)|3(?:2\\\\d|3[1-79]|4[0-35-9]|59)|4(?:2\\\\d|3[013-79]|4[0-8]|5[1-79])|5(?:2\\\\d|3[1-8]|4[1-7]|59)|6(?:[234]\\\\d|5[19]|61)|72\\\\d|8(?:[27]\\\\d|3[1-46-9]|4[0-5]))|2(?:1(?:[23]\\\\d|4[46-9]|5[3469])|2(?:2\\\\d|3[0679]|46|5[12679])|3(?:[234]\\\\d|5[139])|4(?:2\\\\d|3[1235-9]|59)|5(?:[23]\\\\d|4[01246-8]|59|61)|6(?:2\\\\d|3[1-9]|4[0-4]|59)|7(?:[237]\\\\d|40|5[279])|8(?:[23]\\\\d|4[0-3]|59)|9(?:2\\\\d|3[124578]|59)))\\\\d{5}\",\n\"\\\\d{10}\",,,\"7123456789\"],[,,\"7(?:0[01257]|6[02-4]|7[1578]|85)\\\\d{7}\",\"\\\\d{10}\",,,\"7710009998\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"809\\\\d{7}\",\"\\\\d{10}\",,,\"8091234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"751\\\\d{7}\",\"\\\\d{10}\",,,\"7511234567\"],\"KZ\",7,\"810\",\"8\",,,\"8\",,\"8~10\",,,,[,,\"NA\",\"NA\"],,,[,,\"751\\\\d{7}\",\"\\\\d{10}\",,,\"7511234567\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[123]|12)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],LA:[,[,,\"[2-8]\\\\d{7,9}\",\"\\\\d{6,10}\"],[,,\"(?:2[13]|[35-7][14]|41|8[1468])\\\\d{6}\",\"\\\\d{6,8}\",,,\"21212862\"],\n[,,\"20(?:2[2389]|5[4-689]|7[6-8]|9[57-9])\\\\d{6}\",\"\\\\d{10}\",,,\"2023123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"LA\",856,\"00\",\"0\",,,\"0\",,,,[[,\"(20)(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"20\"],\"0$1\",\"\",0],[,\"([2-8]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"2[13]|[3-8]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"19[015]\",\"\\\\d{3}\",,,\"190\"],[,,\"NA\",\"NA\"]],LB:[,[,,\"[13-9]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"(?:[14-6]\\\\d{2}|7(?:[2-579]\\\\d|62|8[0-7])|[89][2-9]\\\\d)\\\\d{4}\",\n\"\\\\d{7}\",,,\"1123456\"],[,,\"(?:3\\\\d|7(?:[01]\\\\d|6[013-9]|8[89]|91))\\\\d{5}\",\"\\\\d{7,8}\",,,\"71123456\"],[,,\"NA\",\"NA\"],[,,\"9[01]\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"8[01]\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"LB\",961,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[13-6]|7(?:[2-579]|62|8[0-7])|[89][2-9]\"],\"0$1\",\"\",0],[,\"([7-9]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[89][01]|7(?:[01]|6[013-9]|8[89]|91)\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|40|75)|999\",\n\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],LC:[,[,,\"[5789]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"758(?:234|4(?:30|5[0-9]|6[2-9]|8[0-2])|572|638|758)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"7582345678\"],[,,\"758(?:28[4-7]|384|4(?:6[01]|8[4-9])|5(?:1[89]|20|84)|7(?:1[2-9]|2[0-6]))\\\\d{4}\",\"\\\\d{10}\",,,\"7582845678\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"LC\",1,\"011\",\"1\",,,\"1\",\n,,,,,[,,\"NA\",\"NA\"],,\"758\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|99)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],LI:[,[,,\"6\\\\d{8}|[23789]\\\\d{6}\",\"\\\\d{7,9}\"],[,,\"(?:2(?:01|1[27]|3\\\\d|6[02-578]|96)|3(?:7[0135-7]|8[048]|9[0269]))\\\\d{4}\",\"\\\\d{7}\",,,\"2345678\"],[,,\"6(?:51[01]|6(?:[01][0-4]|2[016-9]|88)|710)\\\\d{5}|7(?:36|4[25]|56|[7-9]\\\\d)\\\\d{4}\",\"\\\\d{7,9}\",,,\"661234567\"],[,,\"80(?:0(?:2[238]|79)|9\\\\d{2})\\\\d{2}\",\"\\\\d{7}\",,,\"8002222\"],[,,\"90(?:0(?:2[278]|79)|1(?:23|3[012])|6(?:4\\\\d|6[0126]))\\\\d{2}\",\"\\\\d{7}\",,,\"9002222\"],\n[,,\"NA\",\"NA\"],[,,\"701\\\\d{4}\",\"\\\\d{7}\",,,\"7011234\"],[,,\"NA\",\"NA\"],\"LI\",423,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",[\"[23]|7[3-57-9]|87\"],\"\",\"\",0],[,\"(6\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"6\"],\"\",\"\",0],[,\"(6[567]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"6[567]\"],\"\",\"\",0],[,\"(69)(7\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"697\"],\"\",\"\",0],[,\"([7-9]0\\\\d)(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",[\"[7-9]0\"],\"\",\"\",0],[,\"([89]0\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[89]0\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],\n[,,\"87(?:0[128]|7[0-4])\\\\d{3}\",\"\\\\d{7}\",,,\"8770123\"],,[,,\"1(?:1[278]|44)\",\"\\\\d{3}\",,,\"112\"],[,,\"697(?:[35]6|4[25]|[7-9]\\\\d)\\\\d{4}\",\"\\\\d{9}\",,,\"697361234\"]],LK:[,[,,\"[1-9]\\\\d{8}\",\"\\\\d{7,9}\"],[,,\"(?:[189]1|2[13-7]|3[1-8]|4[157]|5[12457]|6[35-7])[2-57]\\\\d{6}\",\"\\\\d{7,9}\",,,\"112345678\"],[,,\"7[125-8]\\\\d{7}\",\"\\\\d{9}\",,,\"712345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"LK\",94,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{1})(\\\\d{6})\",\"$1 $2 $3\",[\"[1-689]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\n\"$1 $2 $3\",[\"7\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[0189]\",\"\\\\d{3}\",,,\"119\"],[,,\"NA\",\"NA\"]],LR:[,[,,\"(?:[29]\\\\d|[4-6]|7\\\\d{1,2}|[38]\\\\d{2})\\\\d{6}\",\"\\\\d{7,9}\"],[,,\"2\\\\d{7}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"(?:4[67]|5\\\\d|6[4-8]|77?\\\\d{2}|88\\\\d{2})\\\\d{5}\",\"\\\\d{7,9}\",,,\"4612345\"],[,,\"NA\",\"NA\"],[,,\"90\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"33200\\\\d{4}\",\"\\\\d{9}\",,,\"332001234\"],\"LR\",231,\"00\",\"0\",,,\"0\",,,,[[,\"([279]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[279]\"],\n\"0$1\",\"\",0],[,\"(7\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"7\"],\"0$1\",\"\",0],[,\"([4-6])(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[4-6]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[38]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"355|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],LS:[,[,,\"[2568]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2\\\\d{7}\",\"\\\\d{8}\",,,\"22123456\"],[,,\"[56]\\\\d{7}\",\"\\\\d{8}\",,,\"50123456\"],[,,\"800[256]\\\\d{4}\",\"\\\\d{8}\",,,\"80021234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"LS\",266,\n\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[257]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],LT:[,[,,\"[3-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:3[1478]|4[124-6]|52)\\\\d{6}\",\"\\\\d{8}\",,,\"31234567\"],[,,\"6\\\\d{7}\",\"\\\\d{8}\",,,\"61234567\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"9(?:0[0239]|10)\\\\d{5}\",\"\\\\d{8}\",,,\"90012345\"],[,,\"808\\\\d{5}\",\"\\\\d{8}\",,,\"80812345\"],[,,\"700\\\\d{5}\",\"\\\\d{8}\",,,\"70012345\"],[,,\"NA\",\"NA\"],\"LT\",370,\"00\",\"8\",,,\"[08]\",,,,[[,\"([34]\\\\d)(\\\\d{6})\",\n\"$1 $2\",[\"37|4(?:1|5[45]|6[2-4])\"],\"(8-$1)\",\"\",0],[,\"([3-6]\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"3[148]|4(?:[24]|6[09])|528|6\"],\"(8-$1)\",\"\",0],[,\"([7-9]\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"[7-9]\"],\"8 $1\",\"\",0],[,\"(5)(2\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"52[0-79]\"],\"(8-$1)\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"70[67]\\\\d{5}\",\"\\\\d{8}\",,,\"70712345\"],,[,,\"0(?:11?|22?|33?)|1(?:0[123]|12)\",\"\\\\d{2,3}\",,,\"112\"],[,,\"NA\",\"NA\"]],LU:[,[,,\"[24-9]\\\\d{3,10}|3(?:[0-46-9]\\\\d{2,9}|5[013-9]\\\\d{1,8})\",\"\\\\d{4,11}\"],[,,\"(?:2(?:2\\\\d{1,2}|3[2-9]|[67]\\\\d|4[1-8]\\\\d?|5[1-5]\\\\d?|9[0-24-9]\\\\d?)|3(?:[059][05-9]|[13]\\\\d|[26][015-9]|4[0-26-9]|7[0-389]|8[08])\\\\d?|4\\\\d{2,3}|5(?:[01458]\\\\d|[27][0-69]|3[0-3]|[69][0-7])\\\\d?|7(?:1[019]|2[05-9]|3[05]|[45][07-9]|[679][089]|8[06-9])\\\\d?|8(?:0[2-9]|1[0-36-9]|3[3-9]|[469]9|[58][7-9]|7[89])\\\\d?|9(?:0[89]|2[0-49]|37|49|5[0-27-9]|7[7-9]|9[0-478])\\\\d?)\\\\d{1,7}\",\n\"\\\\d{4,11}\",,,\"27123456\"],[,,\"6[269][18]\\\\d{6}\",\"\\\\d{9}\",,,\"628123456\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"90[01]\\\\d{5}\",\"\\\\d{8}\",,,\"90012345\"],[,,\"801\\\\d{5}\",\"\\\\d{8}\",,,\"80112345\"],[,,\"70\\\\d{6}\",\"\\\\d{8}\",,,\"70123456\"],[,,\"20\\\\d{2,8}\",\"\\\\d{4,10}\",,,\"2012345\"],\"LU\",352,\"00\",,,,\"(15(?:0[06]|1[12]|35|4[04]|55|6[26]|77|88|99)\\\\d)\",,,,[[,\"(\\\\d{2})(\\\\d{3})\",\"$1 $2\",[\"[2-5]|7[1-9]|[89](?:[1-9]|0[2-9])\"],\"\",\"$CC $1\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",[\"[2-5]|7[1-9]|[89](?:[1-9]|0[2-9])\"],\"\",\n\"$CC $1\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"20\"],\"\",\"$CC $1\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{1,2})\",\"$1 $2 $3 $4\",[\"2(?:[0367]|4[3-8])\"],\"\",\"$CC $1\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"20\"],\"\",\"$CC $1\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{1,2})\",\"$1 $2 $3 $4 $5\",[\"2(?:[0367]|4[3-8])\"],\"\",\"$CC $1\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{1,4})\",\"$1 $2 $3 $4\",[\"2(?:[12589]|4[12])|[3-5]|7[1-9]|[89](?:[1-9]|0[2-9])\"],\"\",\"$CC $1\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",\n[\"[89]0[01]|70\"],\"\",\"$CC $1\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"6\"],\"\",\"$CC $1\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[23]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],LV:[,[,,\"[2689]\\\\d{7}\",\"\\\\d{8}\"],[,,\"6[3-8]\\\\d{6}\",\"\\\\d{8}\",,,\"63123456\"],[,,\"2\\\\d{7}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"80\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"90\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\"81\\\\d{6}\",\"\\\\d{8}\",,,\"81123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"LV\",371,\"00\",,,,,,,,[[,\"([2689]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"\",\n\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"0[123]|112\",\"\\\\d{2,3}\",,,\"112\"],[,,\"NA\",\"NA\"]],LY:[,[,,\"[25679]\\\\d{8}\",\"\\\\d{7,9}\"],[,,\"(?:2[1345]|5[1347]|6[123479]|71)\\\\d{7}\",\"\\\\d{7,9}\",,,\"212345678\"],[,,\"9[1-6]\\\\d{7}\",\"\\\\d{9}\",,,\"912345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"LY\",218,\"00\",\"0\",,,\"0\",,,,[[,\"([25679]\\\\d)(\\\\d{7})\",\"$1-$2\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"19[013]\",\"\\\\d{3}\",,,\"193\"],[,,\"NA\",\"NA\"]],MA:[,[,,\"[5689]\\\\d{8}\",\n\"\\\\d{9}\"],[,,\"5(?:2(?:(?:[015-7]\\\\d|2[2-9]|3[2-57]|4[2-8]|8[235-7])\\\\d|9(?:0\\\\d|[89]0))|3(?:(?:[0-4]\\\\d|[57][2-9]|6[235-8]|9[3-9])\\\\d|8(?:0\\\\d|[89]0)))\\\\d{4}\",\"\\\\d{9}\",,,\"520123456\"],[,,\"6(?:0[0-6]|[14-7]\\\\d|2[02-46-9]|3[03-8]|8[01]|99)\\\\d{6}\",\"\\\\d{9}\",,,\"650123456\"],[,,\"80\\\\d{7}\",\"\\\\d{9}\",,,\"801234567\"],[,,\"89\\\\d{7}\",\"\\\\d{9}\",,,\"891234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MA\",212,\"00\",\"0\",,,\"0\",,,,[[,\"([56]\\\\d{2})(\\\\d{6})\",\"$1-$2\",[\"5(?:2[015-7]|3[0-4])|6\"],\"0$1\",\"\",0],[,\"([58]\\\\d{3})(\\\\d{5})\",\n\"$1-$2\",[\"5(?:2[2-489]|3[5-9])|892\",\"5(?:2(?:[2-48]|90)|3(?:[5-79]|80))|892\"],\"0$1\",\"\",0],[,\"(5\\\\d{4})(\\\\d{4})\",\"$1-$2\",[\"5(?:29|38)\",\"5(?:29|38)[89]\"],\"0$1\",\"\",0],[,\"(8[09])(\\\\d{7})\",\"$1-$2\",[\"8(?:0|9[013-9])\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],1,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:[59]|77)\",\"\\\\d{2,3}\",,,\"15\"],[,,\"NA\",\"NA\"]],MC:[,[,,\"[4689]\\\\d{7,8}\",\"\\\\d{8,9}\"],[,,\"9[2-47-9]\\\\d{6}\",\"\\\\d{8}\",,,\"99123456\"],[,,\"6\\\\d{8}|4\\\\d{7}\",\"\\\\d{8,9}\",,,\"612345678\"],[,,\"(?:8\\\\d|90)\\\\d{6}\",\"\\\\d{8}\",,,\"90123456\"],[,,\n\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MC\",377,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[89]\"],\"$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"4\"],\"0$1\",\"\",0],[,\"(6)(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4 $5\",[\"6\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"8\\\\d{7}\",\"\\\\d{8}\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|[578])\",\"\\\\d{2,3}\",,,\"112\"],[,,\"NA\",\"NA\"]],MD:[,[,,\"[235-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:2(?:1[0569]|2\\\\d|3[015-7]|4[1-46-9]|5[0-24689]|6[2-589]|7[1-37]|9[1347-9])|5(?:33|5[257]))\\\\d{5}\",\n\"\\\\d{8}\",,,\"22212345\"],[,,\"(?:562|6(?:50|7[1-5]|[089]\\\\d)|7(?:7[47-9]|[89]\\\\d))\\\\d{5}\",\"\\\\d{8}\",,,\"65012345\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"90[056]\\\\d{5}\",\"\\\\d{8}\",,,\"90012345\"],[,,\"808\\\\d{5}\",\"\\\\d{8}\",,,\"80812345\"],[,,\"NA\",\"NA\"],[,,\"3[08]\\\\d{6}\",\"\\\\d{8}\",,,\"30123456\"],\"MD\",373,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"22|3\"],\"0$1\",\"\",0],[,\"([25-7]\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"2[13-79]|[5-7]\"],\"0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"[89]\"],\"0$1\",\"\",0]],\n,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"8(?:03|14)\\\\d{5}\",\"\\\\d{8}\",,,\"80312345\"],,[,,\"112|90[123]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],ME:[,[,,\"[2-9]\\\\d{7,8}\",\"\\\\d{6,9}\"],[,,\"(?:20[2-8]|3(?:0[2-7]|1[35-7]|2[3567]|3[4-7])|4(?:0[237]|1[27])|5(?:0[47]|1[27]|2[378]))\\\\d{5}\",\"\\\\d{6,8}\",,,\"30234567\"],[,,\"6(?:32\\\\d|[89]\\\\d{2}|7(?:[0-8]\\\\d|9(?:[3-9]|[0-2]\\\\d)))\\\\d{4}\",\"\\\\d{8,9}\",,,\"67622901\"],[,,\"800[28]\\\\d{4}\",\"\\\\d{8}\",,,\"80080002\"],[,,\"(?:88\\\\d|9(?:4[13-8]|5[16-8]))\\\\d{5}\",\"\\\\d{8}\",,,\"94515151\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"78[1-9]\\\\d{5}\",\"\\\\d{8}\",,,\"78108780\"],\"ME\",382,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[2-57-9]|6[3789]\",\"[2-57-9]|6(?:[389]|7(?:[0-8]|9[3-9]))\"],\"0$1\",\"\",0],[,\"(67)(9)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"679\",\"679[0-2]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"77\\\\d{6}\",\"\\\\d{8}\",,,\"77273012\"],,[,,\"1(?:12|2[234])\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],MG:[,[,,\"[23]\\\\d{8}\",\"\\\\d{7,9}\"],[,,\"20(?:2\\\\d{2}|4[47]\\\\d|5[3467]\\\\d|6[279]\\\\d|7(?:2[29]|[35]\\\\d)|8[268]\\\\d|9[245]\\\\d)\\\\d{4}\",\n\"\\\\d{7,9}\",,,\"202123456\"],[,,\"3(?:[02-4]\\\\d|90)\\\\d{6}\",\"\\\\d{9}\",,,\"301234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"22\\\\d{7}\",\"\\\\d{9}\",,,\"221234567\"],\"MG\",261,\"00\",\"0\",,,\"0\",,,,[[,\"([23]\\\\d)(\\\\d{2})(\\\\d{3})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11?[78]\",\"\\\\d{2,3}\",,,\"117\"],[,,\"NA\",\"NA\"]],MF:[,[,,\"[56]\\\\d{8}\",\"\\\\d{9}\"],[,,\"590(?:10|2[79]|5[128]|[78]7)\\\\d{4}\",\"\\\\d{9}\",,,\"590271234\"],[,,\"690(?:10|2[27]|66|77|8[78])\\\\d{4}\",\"\\\\d{9}\",\n,,\"690221234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MF\",590,\"00\",\"0\",,,\"0\",,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[578]\",\"\\\\d{2}\",,,\"18\"],[,,\"NA\",\"NA\"]],MH:[,[,,\"[2-6]\\\\d{6}\",\"\\\\d{7}\"],[,,\"(?:247|528|625)\\\\d{4}\",\"\\\\d{7}\",,,\"2471234\"],[,,\"(?:235|329|45[56]|545)\\\\d{4}\",\"\\\\d{7}\",,,\"2351234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"635\\\\d{4}\",\"\\\\d{7}\",,,\"6351234\"],\"MH\",692,\"011\",\"1\",,,\"1\",,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1-$2\",,\"\",\"\",0]],\n,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],MK:[,[,,\"[2-578]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:2(?:[23]\\\\d|5[124578]|6[01])|3(?:1[3-6]|[23][2-6]|4[2356])|4(?:[23][2-6]|4[3-6]|5[256]|6[25-8]|7[24-6]|8[4-6]))\\\\d{5}\",\"\\\\d{6,8}\",,,\"22212345\"],[,,\"7(?:[0-25-8]\\\\d|33)\\\\d{5}\",\"\\\\d{8}\",,,\"72345678\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"5[02-9]\\\\d{6}\",\"\\\\d{8}\",,,\"50012345\"],[,,\"8(?:0[1-9]|[1-9]\\\\d)\\\\d{5}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MK\",389,\"00\",\"0\",,,\"0\",\n,,,[[,\"(2)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"2\"],\"0$1\",\"\",0],[,\"([347]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[347]\"],\"0$1\",\"\",0],[,\"([58]\\\\d{2})(\\\\d)(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[58]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|9[234])\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],ML:[,[,,\"[246-8]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:2(?:0(?:2[0-589]|7[027-9])|1(?:2[5-7]|[3-689]\\\\d))|44[239]\\\\d)\\\\d{4}\",\"\\\\d{8}\",,,\"20212345\"],[,,\"(?:6[3569]|7\\\\d)\\\\d{6}\",\"\\\\d{8}\",,,\"65012345\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",\n,,\"80012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"ML\",223,\"00\",,,,,,,,[[,\"([246-8]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[578]\",\"\\\\d{2}\",,,\"17\"],[,,\"NA\",\"NA\"]],MM:[,[,,\"[14578]\\\\d{5,7}|[26]\\\\d{5,8}|9(?:[258]|3\\\\d|4\\\\d{1,2}|[679]\\\\d?)\\\\d{6}\",\"\\\\d{5,10}\"],[,,\"1(?:2\\\\d{1,2}|[3-5]\\\\d|6\\\\d?|[89][0-6]\\\\d)\\\\d{4}|2(?:[236-9]\\\\d{4}|4(?:0\\\\d{5}|\\\\d{4})|5(?:1\\\\d{3,6}|[02-9]\\\\d{3,5}))|4(?:2[245-8]|[346][2-6]|5[3-5])\\\\d{4}|5(?:2(?:20?|[3-8])|3[2-68]|4(?:21?|[4-8])|5[23]|6[2-4]|7[2-8]|8[24-7]|9[2-7])\\\\d{4}|6(?:0[23]|1[2356]|[24][2-6]|3[24-6]|5[2-4]|6[2-8]|7(?:[2367]|4\\\\d|5\\\\d?|8[145]\\\\d)|8[245]|9[24])\\\\d{4}|7(?:[04][24-8]|[15][2-7]|22|3[2-4])\\\\d{4}|8(?:1(?:2\\\\d?|[3-689])|2[2-8]|3[24]|4[24-7]|5[245]|6[23])\\\\d{4}\",\n\"\\\\d{5,9}\",,,\"1234567\"],[,,\"17[01]\\\\d{4}|9(?:2[0-4]|3[136]\\\\d|4(?:0[0-4]\\\\d|[1379]\\\\d|[24][0-589]\\\\d|5\\\\d{2}|88)|5[0-6]|61?\\\\d|73\\\\d|8\\\\d|9(?:1\\\\d|[089]))\\\\d{5}\",\"\\\\d{7,10}\",,,\"92123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"1333\\\\d{4}\",\"\\\\d{8}\",,,\"13331234\"],\"MM\",95,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"1|2[45]\"],\"0$1\",\"\",0],[,\"(2)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"251\"],\"0$1\",\"\",0],[,\"(\\\\d)(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"16|2\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\n\"$1 $2 $3\",[\"67|81\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[4-8]\"],\"0$1\",\"\",0],[,\"(9)(\\\\d{3})(\\\\d{4,5})\",\"$1 $2 $3\",[\"9(?:[235-9]|4[13789])\"],\"0$1\",\"\",0],[,\"(9)(4\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"94[0245]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"199\",\"\\\\d{3}\",,,\"199\"],[,,\"NA\",\"NA\"]],MN:[,[,,\"[12]\\\\d{7,9}|[57-9]\\\\d{7}\",\"\\\\d{6,10}\"],[,,\"[12](?:1\\\\d|2(?:[1-3]\\\\d?|7\\\\d)|3[2-8]\\\\d{1,2}|4[2-68]\\\\d{1,2}|5[1-4689]\\\\d{1,2})\\\\d{5}|5[0568]\\\\d{6}\",\"\\\\d{6,10}\",,,\"50123456\"],\n[,,\"(?:8[89]|9[013-9])\\\\d{6}\",\"\\\\d{8}\",,,\"88123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"7[05-8]\\\\d{6}\",\"\\\\d{8}\",,,\"75123456\"],\"MN\",976,\"001\",\"0\",,,\"0\",,,,[[,\"([12]\\\\d)(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"[12]1\"],\"0$1\",\"\",0],[,\"([12]2\\\\d)(\\\\d{5,6})\",\"$1 $2\",[\"[12]2[1-3]\"],\"0$1\",\"\",0],[,\"([12]\\\\d{3})(\\\\d{5})\",\"$1 $2\",[\"[12](?:27|[3-5])\",\"[12](?:27|[3-5]\\\\d)2\"],\"0$1\",\"\",0],[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"[57-9]\"],\"$1\",\"\",0],[,\"([12]\\\\d{4})(\\\\d{4,5})\",\"$1 $2\",[\"[12](?:27|[3-5])\",\"[12](?:27|[3-5]\\\\d)[4-9]\"],\n\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"10[0-3]\",\"\\\\d{3}\",,,\"102\"],[,,\"NA\",\"NA\"]],MO:[,[,,\"[268]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:28[2-57-9]|8[2-57-9]\\\\d)\\\\d{5}\",\"\\\\d{8}\",,,\"28212345\"],[,,\"6[236]\\\\d{6}\",\"\\\\d{8}\",,,\"66123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MO\",853,\"00\",,,,,,,,[[,\"([268]\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],MP:[,[,,\"[5689]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],\n[,,\"670(?:2(?:3[3-7]|56|8[5-8])|32[1238]|4(?:33|8[348])|5(?:32|55|88)|6(?:64|70|82)|78[589]|8[3-9]8|989)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"6702345678\"],[,,\"670(?:2(?:3[3-7]|56|8[5-8])|32[1238]|4(?:33|8[348])|5(?:32|55|88)|6(?:64|70|82)|78[589]|8[3-9]8|989)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"6702345678\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"MP\",1,\"011\",\n\"1\",,,\"1\",,,1,,,[,,\"NA\",\"NA\"],,\"670\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],MQ:[,[,,\"[56]\\\\d{8}\",\"\\\\d{9}\"],[,,\"596(?:0[2-5]|[12]0|3[05-9]|4[024-8]|[5-7]\\\\d|89|9[4-8])\\\\d{4}\",\"\\\\d{9}\",,,\"596301234\"],[,,\"696(?:[0-479]\\\\d|5[01]|8[0-689])\\\\d{4}\",\"\\\\d{9}\",,,\"696201234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MQ\",596,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n,[,,\"1(?:12|[578])\",\"\\\\d{2,3}\",,,\"15\"],[,,\"NA\",\"NA\"]],MR:[,[,,\"[2-48]\\\\d{7}\",\"\\\\d{8}\"],[,,\"25[08]\\\\d{5}|35\\\\d{6}|45[1-7]\\\\d{5}\",\"\\\\d{8}\",,,\"35123456\"],[,,\"(?:2(?:2\\\\d|70)|3(?:3\\\\d|6[1-36]|7[1-3])|4(?:4\\\\d|6[0457-9]|7[4-9]))\\\\d{5}\",\"\\\\d{8}\",,,\"22123456\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MR\",222,\"00\",,,,,,,,[[,\"([2-48]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[78]\",\"\\\\d{2}\",\n,,\"17\"],[,,\"NA\",\"NA\"]],MS:[,[,,\"[5689]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"664491\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"6644912345\"],[,,\"66449[2-6]\\\\d{4}\",\"\\\\d{10}\",,,\"6644923456\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"MS\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"664\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|99)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],MT:[,[,,\"[2579]\\\\d{7}\",\n\"\\\\d{8}\"],[,,\"2(?:0(?:1[0-6]|[69]\\\\d)|[1-357]\\\\d{2})\\\\d{4}\",\"\\\\d{8}\",,,\"21001234\"],[,,\"(?:7(?:210|[79]\\\\d{2})|9(?:2[13]\\\\d|696|8(?:1[1-3]|89|97)|9\\\\d{2}))\\\\d{4}\",\"\\\\d{8}\",,,\"96961234\"],[,,\"NA\",\"NA\"],[,,\"50(?:0(?:3[1679]|4\\\\d)|[169]\\\\d{2}|7[06]\\\\d)\\\\d{3}\",\"\\\\d{8}\",,,\"50031234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MT\",356,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"7117\\\\d{4}\",\"\\\\d{8}\",,,\"71171234\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],MU:[,[,\n,\"[2-9]\\\\d{6}\",\"\\\\d{7}\"],[,,\"(?:2(?:[034789]\\\\d|1[0-7]|6[1-69])|4(?:[013-8]\\\\d|2[4-7])|[56]\\\\d{2}|8(?:14|3[129]))\\\\d{4}\",\"\\\\d{7}\",,,\"2012345\"],[,,\"(?:25\\\\d|4(?:2[12389]|9\\\\d)|7\\\\d{2}|8(?:20|7[15-8])|9[1-8]\\\\d)\\\\d{4}\",\"\\\\d{7}\",,,\"2512345\"],[,,\"80[012]\\\\d{4}\",\"\\\\d{7}\",,,\"8001234\"],[,,\"30\\\\d{5}\",\"\\\\d{7}\",,,\"3012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"3(?:20|9\\\\d)\\\\d{4}\",\"\\\\d{7}\",,,\"3201234\"],\"MU\",230,\"0(?:[2-7]0|33)\",,,,,,\"020\",,[[,\"([2-9]\\\\d{2})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"2(?:1[89]|2\\\\d)\\\\d{4}\",\n\"\\\\d{7}\",,,\"2181234\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[45]|99\\\\d\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],MV:[,[,,\"[3467]\\\\d{6}|9(?:00\\\\d{7}|\\\\d{6})\",\"\\\\d{7,10}\"],[,,\"(?:3(?:0[01]|3[0-59])|6(?:[567][02468]|8[024689]|90))\\\\d{4}\",\"\\\\d{7}\",,,\"6701234\"],[,,\"(?:46[46]|7[3-9]\\\\d|9[16-9]\\\\d)\\\\d{4}\",\"\\\\d{7}\",,,\"7712345\"],[,,\"NA\",\"NA\"],[,,\"900\\\\d{7}\",\"\\\\d{10}\",,,\"9001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MV\",960,\"0(?:0|19)\",,,,,,\"00\",,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1-$2\",[\"[3467]|9(?:[1-9]|0[1-9])\"],\n\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"900\"],\"\",\"\",0]],,[,,\"781\\\\d{4}\",\"\\\\d{7}\",,,\"7812345\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:02|19)\",\"\\\\d{3}\",,,\"102\"],[,,\"NA\",\"NA\"]],MW:[,[,,\"(?:1(?:\\\\d{2})?|[2789]\\\\d{2})\\\\d{6}\",\"\\\\d{7,9}\"],[,,\"(?:1[2-9]|21\\\\d{2})\\\\d{5}\",\"\\\\d{7,9}\",,,\"1234567\"],[,,\"(?:111|77\\\\d|88\\\\d|99\\\\d)\\\\d{6}\",\"\\\\d{9}\",,,\"991234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MW\",265,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1\"],\"0$1\",\n\"\",0],[,\"(2\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"2\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[1789]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"199|99[789]\",\"\\\\d{3}\",,,\"997\"],[,,\"NA\",\"NA\"]],MX:[,[,,\"[1-9]\\\\d{9,10}\",\"\\\\d{7,11}\"],[,,\"(?:33|55|81)\\\\d{8}|(?:2(?:2[2-9]|3[1-35-8]|4[13-9]|7[1-689]|8[1-578]|9[467])|3(?:1[1-79]|[2458][1-9]|7[1-8]|9[1-5])|4(?:1[1-57-9]|[24-6][1-9]|[37][1-8]|8[1-35-9]|9[2-689])|5(?:88|9[1-79])|6(?:1[2-68]|[234][1-9]|5[1-3689]|6[12457-9]|7[1-7]|8[67]|9[4-8])|7(?:[13467][1-9]|2[1-8]|5[13-9]|8[1-69]|9[17])|8(?:2[13-689]|3[1-6]|4[124-6]|6[1246-9]|7[1-378]|9[12479])|9(?:1[346-9]|2[1-4]|3[2-46-8]|5[1348]|[69][1-9]|7[12]|8[1-8]))\\\\d{7}\",\n\"\\\\d{7,10}\",,,\"2221234567\"],[,,\"1(?:(?:33|55|81)\\\\d{8}|(?:2(?:2[2-9]|3[1-35-8]|4[13-9]|7[1-689]|8[1-578]|9[467])|3(?:1[1-79]|[2458][1-9]|7[1-8]|9[1-5])|4(?:1[1-57-9]|[24-6][1-9]|[37][1-8]|8[1-35-9]|9[2-689])|5(?:88|9[1-79])|6(?:1[2-68]|[2-4][1-9]|5[1-3689]|6[12457-9]|7[1-7]|8[67]|9[4-8])|7(?:[13467][1-9]|2[1-8]|5[13-9]|8[1-69]|9[17])|8(?:2[13-689]|3[1-6]|4[124-6]|6[1246-9]|7[1-378]|9[12479])|9(?:1[346-9]|2[1-4]|3[2-46-8]|5[1348]|[69][1-9]|7[12]|8[1-8]))\\\\d{7})\",\"\\\\d{11}\",,,\"12221234567\"],[,,\"800\\\\d{7}\",\n\"\\\\d{10}\",,,\"8001234567\"],[,,\"900\\\\d{7}\",\"\\\\d{10}\",,,\"9001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MX\",52,\"0[09]\",\"01\",,,\"0[12]|04[45](\\\\d{10})\",\"1$1\",,,[[,\"([358]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"33|55|81\"],\"01 $1\",\"\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[2467]|3[12457-9]|5[89]|8[02-9]|9[0-35-9]\"],\"01 $1\",\"\",1],[,\"(1)([358]\\\\d)(\\\\d{4})(\\\\d{4})\",\"044 $2 $3 $4\",[\"1(?:33|55|81)\"],\"$1\",\"\",0],[,\"(1)(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"044 $2 $3 $4\",[\"1(?:[2467]|3[12457-9]|5[89]|8[2-9]|9[1-35-9])\"],\n\"$1\",\"\",0]],[[,\"([358]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"33|55|81\",\"33|55|81\"],\"01 $1\",\"\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[2467]|3[12457-9]|5[89]|8[02-9]|9[0-35-9]\",\"[2467]|3[12457-9]|5[89]|8[02-9]|9[0-35-9]\"],\"01 $1\",\"\",1],[,\"(1)([358]\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3 $4\",[\"1(?:33|55|81)\"]],[,\"(1)(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3 $4\",[\"1(?:[2467]|3[12457-9]|5[89]|8[2-9]|9[1-35-9])\"]]],[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"06[568]|911\",\"\\\\d{3}\",,,\"066\"],[,,\"NA\",\"NA\"]],MY:[,\n[,,\"[13-9]\\\\d{7,9}\",\"\\\\d{6,10}\"],[,,\"(?:3[2-9]\\\\d|[4-9][2-9])\\\\d{6}\",\"\\\\d{6,9}\",,,\"323456789\"],[,,\"1(?:1[1-3]\\\\d{2}|[02-4679][2-9]\\\\d|8(?:1[23]|[2-9]\\\\d))\\\\d{5}\",\"\\\\d{9,10}\",,,\"123456789\"],[,,\"1[38]00\\\\d{6}\",\"\\\\d{10}\",,,\"1300123456\"],[,,\"1600\\\\d{6}\",\"\\\\d{10}\",,,\"1600123456\"],[,,\"NA\",\"NA\"],[,,\"1700\\\\d{6}\",\"\\\\d{10}\",,,\"1700123456\"],[,,\"154\\\\d{7}\",\"\\\\d{10}\",,,\"1541234567\"],\"MY\",60,\"00\",\"0\",,,\"0\",,,,[[,\"([4-79])(\\\\d{3})(\\\\d{4})\",\"$1-$2 $3\",[\"[4-79]\"],\"0$1\",\"\",0],[,\"(3)(\\\\d{4})(\\\\d{4})\",\"$1-$2 $3\",[\"3\"],\n\"0$1\",\"\",0],[,\"([18]\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1-$2 $3\",[\"1[02-46-9][1-9]|8\"],\"0$1\",\"\",0],[,\"(1)([36-8]00)(\\\\d{2})(\\\\d{4})\",\"$1-$2-$3-$4\",[\"1[36-8]0\"],\"\",\"\",0],[,\"(11)(\\\\d{4})(\\\\d{4})\",\"$1-$2 $3\",[\"11\"],\"0$1\",\"\",0],[,\"(154)(\\\\d{3})(\\\\d{4})\",\"$1-$2 $3\",[\"15\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],MZ:[,[,,\"[28]\\\\d{7,8}\",\"\\\\d{8,9}\"],[,,\"2(?:[1346]\\\\d|5[0-2]|[78][12]|93)\\\\d{5}\",\"\\\\d{8}\",,,\"21123456\"],[,,\"8[246]\\\\d{7}\",\"\\\\d{9}\",,,\"821234567\"],\n[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"MZ\",258,\"00\",,,,,,,,[[,\"([28]\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"2|8[246]\"],\"\",\"\",0],[,\"(80\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"80\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:1[79]|9[78])\",\"\\\\d{3}\",,,\"119\"],[,,\"NA\",\"NA\"]],NA:[,[,,\"[68]\\\\d{7,8}\",\"\\\\d{8,9}\"],[,,\"6(?:1(?:17|2(?:[0189]\\\\d|[2-6]|7\\\\d?)|3(?:2\\\\d|3[378])|4[01]|69|7[014])|2(?:17|25|5(?:[0-36-8]|4\\\\d?)|69|70)|3(?:17|2(?:[0237]\\\\d?|[14-689])|34|6[29]|7[01]|81)|4(?:17|2(?:[012]|7?)|4(?:[06]|1\\\\d)|5(?:[01357]|[25]\\\\d?)|69|7[01])|5(?:17|2(?:[0459]|[23678]\\\\d?)|69|7[01])|6(?:17|2(?:5|6\\\\d?)|38|42|69|7[01])|7(?:17|2(?:[569]|[234]\\\\d?)|3(?:0\\\\d?|[13])|69|7[01]))\\\\d{4}\",\n\"\\\\d{8,9}\",,,\"612012345\"],[,,\"(?:60|8[125])\\\\d{7}\",\"\\\\d{9}\",,,\"811234567\"],[,,\"NA\",\"NA\"],[,,\"8701\\\\d{5}\",\"\\\\d{9}\",,,\"870123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"8(3\\\\d{2}|86)\\\\d{5}\",\"\\\\d{8,9}\",,,\"88612345\"],\"NA\",264,\"00\",\"0\",,,\"0\",,,,[[,\"(8\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"8[1235]\"],\"0$1\",\"\",0],[,\"(6\\\\d)(\\\\d{2,3})(\\\\d{4})\",\"$1 $2 $3\",[\"6\"],\"0$1\",\"\",0],[,\"(88)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"88\"],\"0$1\",\"\",0],[,\"(870)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"870\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,\n,\"NA\",\"NA\"],,[,,\"10111\",\"\\\\d{5}\",,,\"10111\"],[,,\"NA\",\"NA\"]],NC:[,[,,\"[2-47-9]\\\\d{5}\",\"\\\\d{6}\"],[,,\"(?:2[03-9]|3[0-5]|4[1-7]|88)\\\\d{4}\",\"\\\\d{6}\",,,\"201234\"],[,,\"(?:[79]\\\\d|8[0-79])\\\\d{4}\",\"\\\\d{6}\",,,\"751234\"],[,,\"NA\",\"NA\"],[,,\"36\\\\d{4}\",\"\\\\d{6}\",,,\"366711\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NC\",687,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1.$2.$3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[5-8]\",\"\\\\d{2}\",,,\"15\"],[,,\"NA\",\"NA\"]],NE:[,[,,\"[029]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2(?:0(?:20|3[1-7]|4[134]|5[14]|6[14578]|7[1-578])|1(?:4[145]|5[14]|6[14-68]|7[169]|88))\\\\d{4}\",\n\"\\\\d{8}\",,,\"20201234\"],[,,\"9[0-46-9]\\\\d{6}\",\"\\\\d{8}\",,,\"93123456\"],[,,\"08\\\\d{6}\",\"\\\\d{8}\",,,\"08123456\"],[,,\"09\\\\d{6}\",\"\\\\d{8}\",,,\"09123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NE\",227,\"00\",,,,,,,,[[,\"([029]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[29]|09\"],\"\",\"\",0],[,\"(08)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"08\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],NF:[,[,,\"[13]\\\\d{5}\",\"\\\\d{5,6}\"],[,,\"(?:1(?:06|17|28|39)|3[012]\\\\d)\\\\d{3}\",\"\\\\d{5,6}\",,,\"106609\"],\n[,,\"38\\\\d{4}\",\"\\\\d{5,6}\",,,\"381234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NF\",672,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{4})\",\"$1 $2\",[\"1\"],\"\",\"\",0],[,\"(\\\\d)(\\\\d{5})\",\"$1 $2\",[\"3\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|55|77)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],NG:[,[,,\"[1-69]\\\\d{5,8}|[78]\\\\d{5,13}\",\"\\\\d{5,14}\"],[,,\"[12]\\\\d{6,7}|9\\\\d{7}|(?:3\\\\d|4[023568]|5[02368]|6[02-469]|7[4-69]|8[2-9])\\\\d{6}|(?:4[47]|5[14579]|6[1578]|7[0-357])\\\\d{5,6}|(?:78|41)\\\\d{5}\",\n\"\\\\d{5,9}\",,,\"12345678\"],[,,\"(?:1(?:7[34]\\\\d|8(?:04|[124579]\\\\d|8[0-3])|95\\\\d)|287[0-7]|3(?:18[1-8]|88[0-7]|9(?:8[5-9]|6[1-5]))|4(?:28[0-2]|6(?:7[1-9]|8[02-47])|88[0-2])|5(?:2(?:7[7-9]|8\\\\d)|38[1-79]|48[0-7]|68[4-7])|6(?:2(?:7[7-9]|8\\\\d)|4(?:3[7-9]|[68][129]|7[04-69]|9[1-8])|58[0-2]|98[7-9])|7(?:38[0-7]|69[1-8]|78[2-4])|8(?:28[3-9]|38[0-2]|4(?:2[12]|3[147-9]|5[346]|7[4-9]|8[014-689]|90)|58[1-8]|78[2-9]|88[5-7])|98[07]\\\\d)\\\\d{4}|(?:70(?:[3-9]\\\\d|2[1-9])|8(?:0[2-9]|1\\\\d)\\\\d)\\\\d{6}\",\"\\\\d{8,10}\",,,\"8021234567\"],\n[,,\"800\\\\d{7,11}\",\"\\\\d{10,14}\",,,\"80017591759\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NG\",234,\"009\",\"0\",,,\"0\",,,,[[,\"([129])(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[129]\"],\"0$1\",\"\",0],[,\"([3-8]\\\\d)(\\\\d{3})(\\\\d{2,3})\",\"$1 $2 $3\",[\"[3-6]|7(?:[1-79]|0[1-9])|8[2-9]\"],\"0$1\",\"\",0],[,\"([78]\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"70|8[01]\"],\"0$1\",\"\",0],[,\"([78]00)(\\\\d{4})(\\\\d{4,5})\",\"$1 $2 $3\",[\"[78]00\"],\"0$1\",\"\",0],[,\"([78]00)(\\\\d{5})(\\\\d{5,6})\",\"$1 $2 $3\",[\"[78]00\"],\"0$1\",\"\",0],[,\"(78)(\\\\d{2})(\\\\d{3})\",\n\"$1 $2 $3\",[\"78\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"700\\\\d{7,11}\",\"\\\\d{10,14}\",,,\"7001234567\"],,[,,\"199\",\"\\\\d{3}\",,,\"199\"],[,,\"NA\",\"NA\"]],NI:[,[,,\"[128]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2\\\\d{7}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"8\\\\d{7}\",\"\\\\d{8}\",,,\"81234567\"],[,,\"1800\\\\d{4}\",\"\\\\d{8}\",,,\"18001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NI\",505,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"118\",\"\\\\d{3}\",,,\"118\"],[,,\"NA\",\"NA\"]],\nNL:[,[,,\"1\\\\d{4,8}|[2-7]\\\\d{8}|[89]\\\\d{6,9}\",\"\\\\d{5,10}\"],[,,\"(?:1[0135-8]|2[02-69]|3[0-68]|4[0135-9]|[57]\\\\d|8[478])\\\\d{7}\",\"\\\\d{9}\",,,\"101234567\"],[,,\"6[1-58]\\\\d{7}\",\"\\\\d{9}\",,,\"612345678\"],[,,\"800\\\\d{4,7}\",\"\\\\d{7,10}\",,,\"8001234\"],[,,\"90[069]\\\\d{4,7}\",\"\\\\d{7,10}\",,,\"9001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"85\\\\d{7}\",\"\\\\d{9}\",,,\"851234567\"],\"NL\",31,\"00\",\"0\",,,\"0\",,,,[[,\"([1-578]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1[035]|2[0346]|3[03568]|4[0356]|5[0358]|7|8[458]\"],\"0$1\",\"\",0],[,\"([1-5]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\n\"$1 $2 $3\",[\"1[16-8]|2[259]|3[124]|4[17-9]|5[124679]\"],\"0$1\",\"\",0],[,\"(6)(\\\\d{8})\",\"$1 $2\",[\"6[0-57-9]\"],\"0$1\",\"\",0],[,\"(66)(\\\\d{7})\",\"$1 $2\",[\"66\"],\"0$1\",\"\",0],[,\"(14)(\\\\d{3,4})\",\"$1 $2\",[\"14\"],\"$1\",\"\",0],[,\"([89]0\\\\d)(\\\\d{4,7})\",\"$1 $2\",[\"80|9\"],\"0$1\",\"\",0]],,[,,\"66\\\\d{7}\",\"\\\\d{9}\",,,\"662345678\"],,,[,,\"14\\\\d{3,4}\",\"\\\\d{5,6}\"],[,,\"140(?:1(?:[035]|[16-8]\\\\d)|2(?:[0346]|[259]\\\\d)|3(?:[03568]|[124]\\\\d)|4(?:[0356]|[17-9]\\\\d)|5(?:[0358]|[124679]\\\\d)|7\\\\d|8[458])\",\"\\\\d{5,6}\",,,\"14020\"],,[,,\"112|911\",\"\\\\d{3}\",\n,,\"112\"],[,,\"NA\",\"NA\"]],NO:[,[,,\"0\\\\d{4}|[2-9]\\\\d{7}\",\"\\\\d{5}(?:\\\\d{3})?\"],[,,\"(?:2[1-4]|3[1-3578]|5[1-35-7]|6[1-4679]|7[0-8])\\\\d{6}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"(?:4[015-8]|5[89]|9\\\\d)\\\\d{6}\",\"\\\\d{8}\",,,\"41234567\"],[,,\"80[01]\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"82[09]\\\\d{5}\",\"\\\\d{8}\",,,\"82012345\"],[,,\"810(?:0[0-6]|[2-8]\\\\d)\\\\d{3}\",\"\\\\d{8}\",,,\"81021234\"],[,,\"880\\\\d{5}\",\"\\\\d{8}\",,,\"88012345\"],[,,\"85[0-5]\\\\d{5}\",\"\\\\d{8}\",,,\"85012345\"],\"NO\",47,\"00\",,,,,,,,[[,\"([489]\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"[489]\"],\n\"\",\"\",0],[,\"([235-7]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[235-7]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],1,,[,,\"NA\",\"NA\"],[,,\"0\\\\d{4}|81(?:0(?:0[7-9]|1\\\\d)|5\\\\d{2})\\\\d{3}\",\"\\\\d{5}(?:\\\\d{3})?\",,,\"01234\"],1,[,,\"11[023]\",\"\\\\d{3}\",,,\"112\"],[,,\"81[23]\\\\d{5}\",\"\\\\d{8}\",,,\"81212345\"]],NP:[,[,,\"[1-8]\\\\d{7}|9(?:[1-69]\\\\d{6}|7[2-6]\\\\d{5,7}|8\\\\d{8})\",\"\\\\d{6,10}\"],[,,\"(?:1[0124-6]|2[13-79]|3[135-8]|4[146-9]|5[135-7]|6[13-9]|7[15-9]|8[1-46-9]|9[1-79])\\\\d{6}\",\"\\\\d{6,8}\",,,\"14567890\"],[,,\"9(?:7[45]|8[0145])\\\\d{7}\",\"\\\\d{10}\",\n,,\"9841234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NP\",977,\"00\",\"0\",,,\"0\",,,,[[,\"(1)(\\\\d{7})\",\"$1-$2\",[\"1[2-6]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{6})\",\"$1-$2\",[\"1[01]|[2-8]|9(?:[1-69]|7[15-9])\"],\"0$1\",\"\",0],[,\"(9\\\\d{2})(\\\\d{7})\",\"$1-$2\",[\"9(?:7[45]|8)\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[0-3]|12)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],NR:[,[,,\"[458]\\\\d{6}\",\"\\\\d{7}\"],[,,\"(?:444|888)\\\\d{4}\",\"\\\\d{7}\",,,\"4441234\"],[,,\"55[5-9]\\\\d{4}\",\"\\\\d{7}\",\n,,\"5551234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NR\",674,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[0-2]\",\"\\\\d{3}\",,,\"110\"],[,,\"NA\",\"NA\"]],NU:[,[,,\"[1-5]\\\\d{3}\",\"\\\\d{4}\"],[,,\"[34]\\\\d{3}\",\"\\\\d{4}\",,,\"4002\"],[,,\"[125]\\\\d{3}\",\"\\\\d{4}\",,,\"1234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NU\",683,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],\n[,,\"NA\",\"NA\"]],NZ:[,[,,\"6[235-9]\\\\d{6}|[2-57-9]\\\\d{7,10}\",\"\\\\d{7,11}\"],[,,\"(?:3[2-79]|[49][2-689]|6[235-9]|7[2-5789])\\\\d{6}|24099\\\\d{3}\",\"\\\\d{7,8}\",,,\"32345678\"],[,,\"2(?:[028]\\\\d{7,8}|1(?:0\\\\d{5,7}|[12]\\\\d{5,6}|[3-9]\\\\d{5})|[79]\\\\d{7})\",\"\\\\d{8,10}\",,,\"211234567\"],[,,\"508\\\\d{6,7}|80\\\\d{6,8}\",\"\\\\d{8,10}\",,,\"800123456\"],[,,\"90\\\\d{7,9}\",\"\\\\d{9,11}\",,,\"900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"NZ\",64,\"0(?:0|161)\",\"0\",,,\"0\",,\"00\",,[[,\"([34679])(\\\\d{3})(\\\\d{4})\",\"$1-$2 $3\",[\"[3467]|9[1-9]\"],\n\"0$1\",\"\",0],[,\"(24099)(\\\\d{3})\",\"$1 $2\",[\"240\",\"2409\",\"24099\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"21\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"2(?:1[1-9]|[69]|7[0-35-9])|86\"],\"0$1\",\"\",0],[,\"(2\\\\d)(\\\\d{3,4})(\\\\d{4})\",\"$1 $2 $3\",[\"2[028]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"2(?:10|74)|5|[89]0\"],\"0$1\",\"\",0]],,[,,\"[28]6\\\\d{6,7}\",\"\\\\d{8,9}\",,,\"26123456\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"111\",\"\\\\d{3}\",,,\"111\"],[,,\"NA\",\"NA\"]],OM:[,[,,\"(?:2[2-6]|5|9[1-9])\\\\d{6}|800\\\\d{5,6}\",\n\"\\\\d{7,9}\"],[,,\"2[2-6]\\\\d{6}\",\"\\\\d{8}\",,,\"23123456\"],[,,\"9[1-9]\\\\d{6}\",\"\\\\d{8}\",,,\"92123456\"],[,,\"8007\\\\d{4,5}|500\\\\d{4}\",\"\\\\d{7,9}\",,,\"80071234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"OM\",968,\"00\",,,,,,,,[[,\"(2\\\\d)(\\\\d{6})\",\"$1 $2\",[\"2\"],\"\",\"\",0],[,\"(9\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"9\"],\"\",\"\",0],[,\"([58]00)(\\\\d{4,6})\",\"$1 $2\",[\"[58]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9999\",\"\\\\d{4}\",,,\"9999\"],[,,\"NA\",\"NA\"]],PA:[,[,,\"[1-9]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"(?:1(?:0[02-579]|19|2[37]|3[03]|4[479]|57|65|7[016-8]|8[58]|9[134])|2(?:[0235679]\\\\d|1[0-7]|4[04-9]|8[028])|3(?:0[0-7]|1[14-7]|2[0-3]|3[03]|4[0457]|5[56]|6[068]|7[078]|80|9\\\\d)|4(?:3[013-59]|4\\\\d|7[0-689])|5(?:[01]\\\\d|2[0-7]|[56]0|79)|7(?:0[09]|2[0-267]|[349]0|5[6-9]|7[0-24-7]|8[89])|8(?:[34]\\\\d|5[0-4]|8[02])|9(?:0[78]|1[0178]|2[0378]|3[379]|40|5[0489]|6[06-9]|7[046-9]|8[36-8]|9[1-9]))\\\\d{4}\",\n\"\\\\d{7}\",,,\"2001234\"],[,,\"(?:1[16]1|21[89]|8(?:1[01]|7[23]))\\\\d{4}|6(?:[04-9]\\\\d|1[0-5]|2[0-7]|3[5-9])\\\\d{5}\",\"\\\\d{7,8}\",,,\"60012345\"],[,,\"80[09]\\\\d{4}\",\"\\\\d{7}\",,,\"8001234\"],[,,\"(?:779|8(?:2[235]|55|60|7[578]|86|95)|9(?:0[0-2]|81))\\\\d{4}\",\"\\\\d{7}\",,,\"8601234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"PA\",507,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1-$2\",[\"[1-57-9]\"],\"\",\"\",0],[,\"(\\\\d{4})(\\\\d{4})\",\"$1-$2\",[\"6\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\n\"NA\"]],PE:[,[,,\"[14-9]\\\\d{7,8}\",\"\\\\d{6,9}\"],[,,\"(?:1\\\\d|4[1-4]|5[1-46]|6[1-7]|7[2-46]|8[2-4])\\\\d{6}\",\"\\\\d{6,8}\",,,\"11234567\"],[,,\"9\\\\d{8}\",\"\\\\d{9}\",,,\"912345678\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"805\\\\d{5}\",\"\\\\d{8}\",,,\"80512345\"],[,,\"801\\\\d{5}\",\"\\\\d{8}\",,,\"80112345\"],[,,\"80[24]\\\\d{5}\",\"\\\\d{8}\",,,\"80212345\"],[,,\"NA\",\"NA\"],\"PE\",51,\"19(?:1[124]|77|90)00\",\"0\",\" Anexo \",,\"0\",,,,[[,\"(1)(\\\\d{7})\",\"$1 $2\",[\"1\"],\"(0$1)\",\"\",0],[,\"([4-8]\\\\d)(\\\\d{6})\",\"$1 $2\",[\"[4-7]|8[2-4]\"],\"(0$1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{5})\",\n\"$1 $2\",[\"80\"],\"(0$1)\",\"\",0],[,\"(9\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"9\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:05|1[67])\",\"\\\\d{3}\",,,\"105\"],[,,\"NA\",\"NA\"]],PF:[,[,,\"[2-79]\\\\d{5}|8\\\\d{5,7}\",\"\\\\d{6}(?:\\\\d{2})?\"],[,,\"(?:4(?:[02-9]\\\\d|1[02-9])|[5689]\\\\d{2})\\\\d{3}\",\"\\\\d{6}\",,,\"401234\"],[,,\"(?:[27]\\\\d{2}|3[0-79]\\\\d|411|89\\\\d{3})\\\\d{3}\",\"\\\\d{6}(?:\\\\d{2})?\",,,\"212345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"PF\",689,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\n\"$1 $2 $3 $4\",[\"89\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"44\\\\d{4}\",\"\\\\d{6}\",,,\"441234\"],[,,\"NA\",\"NA\"],,[,,\"1[578]\",\"\\\\d{2}\",,,\"15\"],[,,\"NA\",\"NA\"]],PG:[,[,,\"[1-9]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"(?:3\\\\d{2}|4[257]\\\\d|5[34]\\\\d|6(?:29|4[1-9])|85[02-46-9]|9[78]\\\\d)\\\\d{4}\",\"\\\\d{7}\",,,\"3123456\"],[,,\"(?:68|7[0-36]\\\\d)\\\\d{5}\",\"\\\\d{7,8}\",,,\"6812345\"],[,,\"180\\\\d{4}\",\"\\\\d{7}\",,,\"1801234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"275\\\\d{4}\",\"\\\\d{7}\",,,\"2751234\"],\"PG\",\n675,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[1-689]\"],\"\",\"\",0],[,\"(7\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3\",[\"7\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"000\",\"\\\\d{3}\",,,\"000\"],[,,\"NA\",\"NA\"]],PH:[,[,,\"[2-9]\\\\d{7,9}|1800\\\\d{7,9}\",\"\\\\d{7,13}\"],[,,\"(?:2|3[2-68]|4[2-9]|5[2-6]|6[2-58]|7[24578]|8[2-8])\\\\d{7}\",\"\\\\d{7,9}\",,,\"21234567\"],[,,\"(?:81[37]|9(?:0[5-9]|1[025-9]|2[0-35-9]|3[02-9]|4[236-9]|7[3479]|89|9[46-9]))\\\\d{7}\",\"\\\\d{10}\",,,\"9051234567\"],[,,\"1800\\\\d{7,9}\",\"\\\\d{11,13}\",,,\"180012345678\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"PH\",63,\"00\",\"0\",,,\"0\",,,,[[,\"(2)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"2\"],\"(0$1)\",\"\",0],[,\"(\\\\d{4})(\\\\d{5})\",\"$1 $2\",[\"3(?:23|39|46)|4(?:2[3-6]|[35]9|4[26]|76)|5(?:22|44)|642|8(?:62|8[245])\",\"3(?:230|397|461)|4(?:2(?:35|[46]4|51)|396|4(?:22|63)|59[347]|76[15])|5(?:221|446)|642[23]|8(?:622|8(?:[24]2|5[13]))\"],\"(0$1)\",\"\",0],[,\"(\\\\d{5})(\\\\d{4})\",\"$1 $2\",[\"346|4(?:27|9[35])|883\",\"3469|4(?:279|9(?:30|56))|8834\"],\"(0$1)\",\"\",0],[,\"([3-8]\\\\d)(\\\\d{3})(\\\\d{4})\",\n\"$1 $2 $3\",[\"[3-8]\"],\"(0$1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"81|9\"],\"0$1\",\"\",0],[,\"(1800)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"\",\"\",0],[,\"(1800)(\\\\d{1,2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3 $4\",[\"1\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[27]|911\",\"\\\\d{3}\",,,\"117\"],[,,\"NA\",\"NA\"]],PK:[,[,,\"1\\\\d{8}|[2-8]\\\\d{5,11}|9(?:[013-9]\\\\d{4,9}|2\\\\d(?:111\\\\d{6}|\\\\d{3,7}))\",\"\\\\d{6,12}\"],[,,\"(?:21|42)[2-9]\\\\d{7}|(?:2[25]|4[0146-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]\\\\d{6}|(?:2(?:3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(?:2[2-689]|3[23578]|4[3478]|5[2356])|9(?:1|2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8]))[2-9]\\\\d{5,6}|58[126]\\\\d{7}\",\n\"\\\\d{6,10}\",,,\"2123456789\"],[,,\"3(?:0\\\\d|1[1-5]|2[0-5]|3[1-6]|4[1-7]|55|64)\\\\d{7}\",\"\\\\d{10}\",,,\"3012345678\"],[,,\"800\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"900\\\\d{5}\",\"\\\\d{8}\",,,\"90012345\"],[,,\"NA\",\"NA\"],[,,\"122\\\\d{6}\",\"\\\\d{9}\",,,\"122044444\"],[,,\"NA\",\"NA\"],\"PK\",92,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(111)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)1\",\"(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)11\",\"(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)111\"],\n\"(0$1)\",\"\",0],[,\"(\\\\d{3})(111)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"2[349]|45|54|60|72|8[2-5]|9[2-9]\",\"(?:2[349]|45|54|60|72|8[2-5]|9[2-9])\\\\d1\",\"(?:2[349]|45|54|60|72|8[2-5]|9[2-9])\\\\d11\",\"(?:2[349]|45|54|60|72|8[2-5]|9[2-9])\\\\d111\"],\"(0$1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{7,8})\",\"$1 $2\",[\"(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]\"],\"(0$1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{6,7})\",\"$1 $2\",[\"2[349]|45|54|60|72|8[2-5]|9[2-9]\",\"(?:2[349]|45|54|60|72|8[2-5]|9[2-9])\\\\d[2-9]\"],\"(0$1)\",\"\",0],[,\"(3\\\\d{2})(\\\\d{7})\",\n\"$1 $2\",[\"3\"],\"0$1\",\"\",0],[,\"([15]\\\\d{3})(\\\\d{5,6})\",\"$1 $2\",[\"58[12]|1\"],\"(0$1)\",\"\",0],[,\"(586\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"586\"],\"(0$1)\",\"\",0],[,\"([89]00)(\\\\d{3})(\\\\d{2})\",\"$1 $2 $3\",[\"[89]00\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"(?:2(?:[125]|3[2358]|4[2-4]|9[2-8])|4(?:[0-246-9]|5[3479])|5(?:[1-35-7]|4[2-467])|6(?:[1-8]|0[468])|7(?:[14]|2[236])|8(?:[16]|2[2-689]|3[23578]|4[3478]|5[2356])|9(?:1|22|3[27-9]|4[2-6]|6[3569]|9[2-7]))111\\\\d{6}\",\"\\\\d{11,12}\",,,\"21111825888\"],,[,,\"1(?:1(?:22?|5)|[56])\",\n\"\\\\d{2,4}\",,,\"112\"],[,,\"NA\",\"NA\"]],PL:[,[,,\"[1-58]\\\\d{6,8}|9\\\\d{8}|[67]\\\\d{5,8}\",\"\\\\d{6,9}\"],[,,\"(?:1[2-8]|2[2-59]|3[2-4]|4[1-468]|5[24-689]|6[1-3578]|7[14-6]|8[1-7])\\\\d{5,7}|77\\\\d{4,7}|(?:89|9[145])\\\\d{7}\",\"\\\\d{6,9}\",,,\"123456789\"],[,,\"(?:5[013]|6[069]|7[2389]|88)\\\\d{7}\",\"\\\\d{9}\",,,\"512345678\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"70\\\\d{7}\",\"\\\\d{9}\",,,\"701234567\"],[,,\"801\\\\d{6}\",\"\\\\d{9}\",,,\"801234567\"],[,,\"NA\",\"NA\"],[,,\"39\\\\d{7}\",\"\\\\d{9}\",,,\"391234567\"],\"PL\",48,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\n\"$1 $2 $3 $4\",[\"[124]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145]\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{4,6})\",\"$1 $2\",[\"[124]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-7]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"39|5[013]|6[0469]|7[02389]|8[08]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2,3})\",\"$1 $2 $3\",[\"64\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})\",\"$1 $2\",[\"64\"],\"\",\"\",0]],,[,,\"642\\\\d{3,6}\",\"\\\\d{6,9}\",,,\"642123456\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|99[789]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],PM:[,[,,\"[45]\\\\d{5}\",\n\"\\\\d{6}\"],[,,\"41\\\\d{4}\",\"\\\\d{6}\",,,\"411234\"],[,,\"55\\\\d{4}\",\"\\\\d{6}\",,,\"551234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"PM\",508,\"00\",\"0\",,,\"0\",,,,[[,\"([45]\\\\d)(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[578]\",\"\\\\d{2}\",,,\"17\"],[,,\"NA\",\"NA\"]],PR:[,[,,\"[5789]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"(?:787|939)[2-9]\\\\d{6}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"7872345678\"],[,,\"(?:787|939)[2-9]\\\\d{6}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"7872345678\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\n\"\\\\d{10}\",,,\"8002345678\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"PR\",1,\"011\",\"1\",,,\"1\",,,1,,,[,,\"NA\",\"NA\"],,\"787|939\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],PS:[,[,,\"[24589]\\\\d{7,8}|1(?:[78]\\\\d{8}|[49]\\\\d{2,3})\",\"\\\\d{4,10}\"],[,,\"(?:22[234789]|42[45]|82[01458]|92[369])\\\\d{5}\",\"\\\\d{7,8}\",,,\"22234567\"],[,,\"5[69]\\\\d{7}\",\"\\\\d{9}\",,,\"599123456\"],[,,\"1800\\\\d{6}\",\"\\\\d{10}\",,,\"1800123456\"],\n[,,\"1(?:4|9\\\\d)\\\\d{2}\",\"\\\\d{4,5}\",,,\"19123\"],[,,\"1700\\\\d{6}\",\"\\\\d{10}\",,,\"1700123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"PS\",970,\"00\",\"0\",,,\"0\",,,,[[,\"([2489])(2\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"[2489]\"],\"0$1\",\"\",0],[,\"(5[69]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"5\"],\"0$1\",\"\",0],[,\"(1[78]00)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1[78]\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],PT:[,[,,\"[2-46-9]\\\\d{8}\",\"\\\\d{9}\"],[,,\"2(?:[12]\\\\d|[35][1-689]|4[1-59]|6[1-35689]|7[1-9]|8[1-69]|9[1256])\\\\d{6}\",\n\"\\\\d{9}\",,,\"212345678\"],[,,\"9(?:[136]\\\\d{2}|2[0-79]\\\\d|480)\\\\d{5}\",\"\\\\d{9}\",,,\"912345678\"],[,,\"80[02]\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"76(?:0[1-57]|1[2-47]|2[237])\\\\d{5}\",\"\\\\d{9}\",,,\"760123456\"],[,,\"80(?:8\\\\d|9[1579])\\\\d{5}\",\"\\\\d{9}\",,,\"808123456\"],[,,\"884[128]\\\\d{5}\",\"\\\\d{9}\",,,\"884123456\"],[,,\"30\\\\d{7}\",\"\\\\d{9}\",,,\"301234567\"],\"PT\",351,\"00\",,,,,,,,[[,\"([2-46-9]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"70(?:7\\\\d|8[17])\\\\d{5}\",\"\\\\d{9}\",,,\"707123456\"],,[,,\n\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],PW:[,[,,\"[2-8]\\\\d{6}\",\"\\\\d{7}\"],[,,\"2552255|(?:277|345|488|5(?:35|44|87)|6(?:22|54|79)|7(?:33|47)|8(?:24|55|76))\\\\d{4}\",\"\\\\d{7}\",,,\"2771234\"],[,,\"(?:6[234689]0|77[45789])\\\\d{4}\",\"\\\\d{7}\",,,\"6201234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"PW\",680,\"01[12]\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],PY:[,[,,\"5[0-5]\\\\d{4,7}|[2-46-9]\\\\d{5,8}\",\n\"\\\\d{5,9}\"],[,,\"(?:[26]1|3[289]|4[124678]|7[123]|8[1236])\\\\d{5,7}|(?:2(?:2[4568]|7[15]|9[1-5])|3(?:18|3[167]|4[2357]|51)|4(?:18|2[45]|3[12]|5[13]|64|71|9[1-47])|5(?:[1-4]\\\\d|5[0234])|6(?:3[1-3]|44|7[1-4678])|7(?:17|4[0-4]|6[1-578]|75|8[0-8])|858)\\\\d{5,6}\",\"\\\\d{5,9}\",,,\"212345678\"],[,,\"9(?:61|[78][1-6]|9[1-5])\\\\d{6}\",\"\\\\d{9}\",,,\"961456789\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"8700[0-4]\\\\d{4}\",\"\\\\d{9}\",,,\"870012345\"],\"PY\",595,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{5,7})\",\"$1 $2\",\n[\"(?:[26]1|3[289]|4[124678]|7[123]|8[1236])\"],\"($1)\",\"\",0],[,\"(\\\\d{3})(\\\\d{3,6})\",\"$1 $2\",[\"[2-9]0\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{6})\",\"$1 $2\",[\"9[1-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"8700\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{4,6})\",\"$1 $2\",[\"[2-8][1-9]\"],\"($1)\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"[2-9]0\\\\d{4,7}\",\"\\\\d{6,9}\",,,\"201234567\"],,[,,\"128|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],QA:[,[,,\"[2-8]\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"4[04]\\\\d{6}\",\"\\\\d{7,8}\",,,\"44123456\"],[,,\"[3567]\\\\d{7}\",\n\"\\\\d{7,8}\",,,\"33123456\"],[,,\"800\\\\d{4}\",\"\\\\d{7,8}\",,,\"8001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"QA\",974,\"00\",,,,,,,,[[,\"([28]\\\\d{2})(\\\\d{4})\",\"$1 $2\",[\"[28]\"],\"\",\"\",0],[,\"([3-7]\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[3-7]\"],\"\",\"\",0]],,[,,\"2(?:[12]\\\\d|61)\\\\d{4}\",\"\\\\d{7}\",,,\"2123456\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],RE:[,[,,\"[268]\\\\d{8}\",\"\\\\d{9}\"],[,,\"262\\\\d{6}\",\"\\\\d{9}\",,,\"262161234\"],[,,\"6(?:9[23]|47)\\\\d{6}\",\"\\\\d{9}\",,,\"692123456\"],[,,\"80\\\\d{7}\",\n\"\\\\d{9}\",,,\"801234567\"],[,,\"89[1-37-9]\\\\d{6}\",\"\\\\d{9}\",,,\"891123456\"],[,,\"8(?:1[019]|2[0156]|84|90)\\\\d{6}\",\"\\\\d{9}\",,,\"810123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"RE\",262,\"00\",\"0\",,,\"0\",,,,[[,\"([268]\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],1,\"262|6[49]|8\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|[578])\",\"\\\\d{2,3}\",,,\"15\"],[,,\"NA\",\"NA\"]],RO:[,[,,\"2\\\\d{5,8}|[37-9]\\\\d{8}\",\"\\\\d{6,9}\"],[,,\"2(?:1(?:\\\\d{7}|9\\\\d{3})|[3-6](?:\\\\d{7}|\\\\d9\\\\d{2}))|3[13-6]\\\\d{7}\",\"\\\\d{6,9}\",,,\"211234567\"],\n[,,\"7[1-8]\\\\d{7}\",\"\\\\d{9}\",,,\"712345678\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"90[036]\\\\d{6}\",\"\\\\d{9}\",,,\"900123456\"],[,,\"801\\\\d{6}\",\"\\\\d{9}\",,,\"801123456\"],[,,\"802\\\\d{6}\",\"\\\\d{9}\",,,\"802123456\"],[,,\"NA\",\"NA\"],\"RO\",40,\"00\",\"0\",\" int \",,\"0\",,,,[[,\"([237]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[23]1\"],\"0$1\",\"\",0],[,\"(21)(\\\\d{4})\",\"$1 $2\",[\"21\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[23][3-7]|[7-9]\"],\"0$1\",\"\",0],[,\"(2\\\\d{2})(\\\\d{3})\",\"$1 $2\",[\"2[3-6]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,\n[,,\"NA\",\"NA\"],[,,\"37\\\\d{7}\",\"\\\\d{9}\",,,\"372123456\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],RS:[,[,,\"[126-9]\\\\d{4,11}|3(?:[0-79]\\\\d{3,10}|8[2-9]\\\\d{2,9})\",\"\\\\d{5,12}\"],[,,\"(?:1(?:[02-9][2-9]|1[1-9])\\\\d|2(?:[0-24-7][2-9]\\\\d|[389](?:0[2-9]|[2-9]\\\\d))|3(?:[0-8][2-9]\\\\d|9(?:[2-9]\\\\d|0[2-9])))\\\\d{3,8}\",\"\\\\d{5,12}\",,,\"10234567\"],[,,\"6(?:[0-689]|7\\\\d)\\\\d{6,7}\",\"\\\\d{8,10}\",,,\"601234567\"],[,,\"800\\\\d{3,9}\",\"\\\\d{6,12}\",,,\"80012345\"],[,,\"(?:90[0169]|78\\\\d)\\\\d{3,7}\",\"\\\\d{6,12}\",,,\"90012345\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"RS\",381,\"00\",\"0\",,,\"0\",,,,[[,\"([23]\\\\d{2})(\\\\d{4,9})\",\"$1 $2\",[\"(?:2[389]|39)0\"],\"0$1\",\"\",0],[,\"([1-3]\\\\d)(\\\\d{5,10})\",\"$1 $2\",[\"1|2(?:[0-24-7]|[389][1-9])|3(?:[0-8]|9[1-9])\"],\"0$1\",\"\",0],[,\"(6\\\\d)(\\\\d{6,8})\",\"$1 $2\",[\"6\"],\"0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{3,9})\",\"$1 $2\",[\"[89]\"],\"0$1\",\"\",0],[,\"(7[26])(\\\\d{4,9})\",\"$1 $2\",[\"7[26]\"],\"0$1\",\"\",0],[,\"(7[08]\\\\d)(\\\\d{4,9})\",\"$1 $2\",[\"7[08]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"7[06]\\\\d{4,10}\",\"\\\\d{6,12}\",,,\"700123456\"],\n,[,,\"112|9[234]\",\"\\\\d{2,3}\",,,\"112\"],[,,\"NA\",\"NA\"]],RU:[,[,,\"[3489]\\\\d{9}\",\"\\\\d{10}\"],[,,\"(?:3(?:0[12]|4[1-35-79]|5[1-3]|8[1-58]|9[0145])|4(?:01|1[1356]|2[13467]|7[1-5]|8[1-7]|9[1-689])|8(?:1[1-8]|2[01]|3[13-6]|4[0-8]|5[15]|6[1-35-7]|7[1-37-9]))\\\\d{7}\",\"\\\\d{10}\",,,\"3011234567\"],[,,\"9\\\\d{9}\",\"\\\\d{10}\",,,\"9123456789\"],[,,\"80[04]\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"80[39]\\\\d{7}\",\"\\\\d{10}\",,,\"8091234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"RU\",7,\"810\",\"8\",,,\"8\",,\"8~10\",,[[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\n\"$1-$2-$3\",[\"[1-79]\"],\"$1\",\"\",0],[,\"([3489]\\\\d{2})(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2-$3-$4\",[\"[34689]\"],\"8 ($1)\",\"\",1],[,\"(7\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"7\"],\"8 ($1)\",\"\",1]],[[,\"([3489]\\\\d{2})(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2-$3-$4\",[\"[34689]\",\"[34689]\"],\"8 ($1)\",\"\",1],[,\"(7\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"7\",\"7\"],\"8 ($1)\",\"\",1]],[,,\"NA\",\"NA\"],1,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"0[123]|112\",\"\\\\d{2,3}\",,,\"112\"],[,,\"NA\",\"NA\"]],RW:[,[,,\"[027-9]\\\\d{7,8}\",\"\\\\d{8,9}\"],[,,\"2[258]\\\\d{7}|06\\\\d{6}\",\n\"\\\\d{8,9}\",,,\"250123456\"],[,,\"7[238]\\\\d{7}\",\"\\\\d{9}\",,,\"720123456\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"900\\\\d{6}\",\"\\\\d{9}\",,,\"900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"RW\",250,\"00\",\"0\",,,\"0\",,,,[[,\"(2\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"2\"],\"$1\",\"\",0],[,\"([7-9]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[7-9]\"],\"0$1\",\"\",0],[,\"(0\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"0\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],SA:[,[,\n,\"1\\\\d{7,8}|(?:[2-467]|92)\\\\d{7}|5\\\\d{8}|8\\\\d{9}\",\"\\\\d{7,10}\"],[,,\"(?:11?\\\\d|2[24-8]|3[35-8]|4[3-68]|6[2-5]|7[235-7])\\\\d{6}\",\"\\\\d{7,9}\",,,\"112345678\"],[,,\"(?:5[013-689]|811)\\\\d{7}\",\"\\\\d{9,10}\",,,\"512345678\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"NA\",\"NA\"],[,,\"92[05]\\\\d{6}\",\"\\\\d{9}\",,,\"920012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SA\",966,\"00\",\"0\",,,\"0\",,,,[[,\"([1-467])(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[1-467]\"],\"0$1\",\"\",0],[,\"(1\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1[1-467]\"],\"0$1\",\"\",0],[,\"(5\\\\d)(\\\\d{3})(\\\\d{4})\",\n\"$1 $2 $3\",[\"5\"],\"0$1\",\"\",0],[,\"(92\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"9\"],\"$1\",\"\",0],[,\"(800)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"80\"],\"$1\",\"\",0],[,\"(811)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"81\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|9(?:11|9[7-9])\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],SB:[,[,,\"[1-9]\\\\d{4,6}\",\"\\\\d{5,7}\"],[,,\"(?:1[4-79]|[23]\\\\d|4[01]|5[03]|6[0-37])\\\\d{3}\",\"\\\\d{5}\",,,\"40123\"],[,,\"48\\\\d{3}|7(?:[46-8]\\\\d|5[025-9]|90)\\\\d{4}|8[4-8]\\\\d{5}|9(?:[46]\\\\d|5[0-46-9]|7[0-689]|8[0-79]|9[0-8])\\\\d{4}\",\n\"\\\\d{5,7}\",,,\"7421234\"],[,,\"1[38]\\\\d{3}\",\"\\\\d{5}\",,,\"18123\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"5[12]\\\\d{3}\",\"\\\\d{5}\",,,\"51123\"],\"SB\",677,\"0[01]\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[7-9]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],SC:[,[,,\"[24689]\\\\d{5,6}\",\"\\\\d{6,7}\"],[,,\"4[2-46]\\\\d{5}\",\"\\\\d{7}\",,,\"4217123\"],[,,\"2[5-8]\\\\d{5}\",\"\\\\d{7}\",,,\"2510123\"],[,,\"8000\\\\d{2}\",\"\\\\d{6}\",,,\"800000\"],[,,\"98\\\\d{4}\",\"\\\\d{6}\",,,\"981234\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],[,,\"64\\\\d{5}\",\"\\\\d{7}\",,,\"6412345\"],\"SC\",248,\"0[0-2]\",,,,,,\"00\",,[[,\"(\\\\d{3})(\\\\d{3})\",\"$1 $2\",[\"[89]\"],\"\",\"\",0],[,\"(\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[246]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],SD:[,[,,\"[19]\\\\d{8}\",\"\\\\d{9}\"],[,,\"1(?:[125]\\\\d|8[3567])\\\\d{6}\",\"\\\\d{9}\",,,\"121231234\"],[,,\"9[012569]\\\\d{7}\",\"\\\\d{9}\",,,\"911231234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SD\",249,\"00\",\"0\",,,\n\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],SE:[,[,,\"[1-9]\\\\d{6,9}\",\"\\\\d{5,10}\"],[,,\"1(?:0[1-8]\\\\d{6}|[136]\\\\d{5,7}|(?:2[0-35]|4[0-4]|5[0-25-9]|7[13-6]|[89]\\\\d)\\\\d{5,6})|2(?:[136]\\\\d{5,7}|(?:2[0-7]|4[0136-8]|5[0138]|7[018]|8[01]|9[0-57])\\\\d{5,6})|3(?:[356]\\\\d{5,7}|(?:0[0-4]|1\\\\d|2[0-25]|4[056]|7[0-2]|8[0-3]|9[023])\\\\d{5,6})|4(?:[0246]\\\\d{5,7}|(?:1[0-8]|3[0135]|5[14-79]|7[0-246-9]|8[0156]|9[0-689])\\\\d{5,6})|5(?:0[0-6]|[15][0-5]|2[0-68]|3[0-4]|4\\\\d|6[03-5]|7[013]|8[0-79]|9[01])\\\\d{5,6}|6(?:[03]\\\\d{5,7}|(?:1[1-3]|2[0-4]|4[02-57]|5[0-37]|6[0-3]|7[0-2]|8[0247]|9[0-356])\\\\d{5,6})|8\\\\d{6,8}|9(?:0\\\\d{5,7}|(?:1[0-68]|2\\\\d|3[02-59]|[45][0-4]|[68][01]|7[0135-8])\\\\d{5,6})\",\n\"\\\\d{5,9}\",,,\"8123456\"],[,,\"7[0236]\\\\d{7}\",\"\\\\d{9}\",,,\"701234567\"],[,,\"20\\\\d{4,7}\",\"\\\\d{6,9}\",,,\"201234567\"],[,,\"9(?:00|39|44)\\\\d{7}\",\"\\\\d{10}\",,,\"9001234567\"],[,,\"77\\\\d{7}\",\"\\\\d{9}\",,,\"771234567\"],[,,\"75\\\\d{7}\",\"\\\\d{9}\",,,\"751234567\"],[,,\"NA\",\"NA\"],\"SE\",46,\"00\",\"0\",,,\"0\",,,,[[,\"(8)(\\\\d{2,3})(\\\\d{2,3})(\\\\d{2})\",\"$1-$2 $3 $4\",[\"8\"],\"0$1\",\"\",0],[,\"([1-69]\\\\d)(\\\\d{2,3})(\\\\d{2})(\\\\d{2})\",\"$1-$2 $3 $4\",[\"1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90\"],\"0$1\",\"\",0],[,\"([1-69]\\\\d)(\\\\d{3})(\\\\d{2})\",\"$1-$2 $3\",\n[\"1[13689]|2[136]|3[1356]|4[0246]|54|6[03]|90\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1-$2 $3 $4\",[\"1[2457]|2[2457-9]|3[0247-9]|4[1357-9]|5[0-35-9]|6[124-9]|9(?:[125-8]|3[0-5]|4[0-3])\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{2,3})(\\\\d{2})\",\"$1-$2 $3\",[\"1[2457]|2[2457-9]|3[0247-9]|4[1357-9]|5[0-35-9]|6[124-9]|9(?:[125-8]|3[0-5]|4[0-3])\"],\"0$1\",\"\",0],[,\"(7\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1-$2 $3 $4\",[\"7\"],\"0$1\",\"\",0],[,\"(20)(\\\\d{2,3})(\\\\d{2})\",\"$1-$2 $3\",[\"20\"],\"0$1\",\"\",0],[,\"(9[034]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{3})\",\n\"$1-$2 $3 $4\",[\"9[034]\"],\"0$1\",\"\",0]],[[,\"(8)(\\\\d{2,3})(\\\\d{2,3})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"8\"]],[,\"([1-69]\\\\d)(\\\\d{2,3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90\"]],[,\"([1-69]\\\\d)(\\\\d{3})(\\\\d{2})\",\"$1 $2 $3\",[\"1[13689]|2[136]|3[1356]|4[0246]|54|6[03]|90\"]],[,\"(\\\\d{3})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"1[2457]|2[2457-9]|3[0247-9]|4[1357-9]|5[0-35-9]|6[124-9]|9(?:[125-8]|3[0-5]|4[0-3])\"]],[,\"(\\\\d{3})(\\\\d{2,3})(\\\\d{2})\",\"$1 $2 $3\",[\"1[2457]|2[2457-9]|3[0247-9]|4[1357-9]|5[0-35-9]|6[124-9]|9(?:[125-8]|3[0-5]|4[0-3])\"]],\n[,\"(7\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"7\"]],[,\"(20)(\\\\d{2,3})(\\\\d{2})\",\"$1 $2 $3\",[\"20\"]],[,\"(9[034]\\\\d)(\\\\d{2})(\\\\d{2})(\\\\d{3})\",\"$1 $2 $3 $4\",[\"9[034]\"]]],[,,\"74\\\\d{7}\",\"\\\\d{9}\",,,\"741234567\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|90000\",\"\\\\d{3,5}\",,,\"112\"],[,,\"NA\",\"NA\"]],SG:[,[,,\"[36]\\\\d{7}|[17-9]\\\\d{7,10}\",\"\\\\d{8,11}\"],[,,\"6[1-9]\\\\d{6}\",\"\\\\d{8}\",,,\"61234567\"],[,,\"(?:8[1-7]|9[0-8])\\\\d{6}\",\"\\\\d{8}\",,,\"81234567\"],[,,\"1?800\\\\d{7}\",\"\\\\d{10,11}\",,,\"18001234567\"],[,,\"1900\\\\d{7}\",\"\\\\d{11}\",\n,,\"19001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"3[12]\\\\d{6}\",\"\\\\d{8}\",,,\"31234567\"],\"SG\",65,\"0[0-3]\\\\d\",,,,,,,,[[,\"([3689]\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[369]|8[1-9]\"],\"\",\"\",0],[,\"(1[89]00)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1[89]\"],\"\",\"\",0],[,\"(7000)(\\\\d{4})(\\\\d{3})\",\"$1 $2 $3\",[\"70\"],\"\",\"\",0],[,\"(800)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"80\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"7000\\\\d{7}\",\"\\\\d{11}\",,,\"70001234567\"],,[,,\"99[359]\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],SH:[,[,,\"[2-9]\\\\d{3}\",\"\\\\d{4}\"],[,,\"(?:[2-468]\\\\d|7[01])\\\\d{2}\",\n\"\\\\d{4}\",,,\"2158\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"(?:[59]\\\\d|7[2-9])\\\\d{2}\",\"\\\\d{4}\",,,\"5012\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SH\",290,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|99)\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],SI:[,[,,\"[1-7]\\\\d{6,7}|[89]\\\\d{4,7}\",\"\\\\d{5,8}\"],[,,\"(?:1\\\\d|[25][2-8]|3[4-8]|4[24-8]|7[3-8])\\\\d{6}\",\"\\\\d{7,8}\",,,\"11234567\"],[,,\"(?:[37][01]|4[019]|51|6[48])\\\\d{6}\",\"\\\\d{8}\",,,\"31234567\"],[,,\"80\\\\d{4,6}\",\"\\\\d{6,8}\",,,\"80123456\"],[,,\"90\\\\d{4,6}|89[1-3]\\\\d{2,5}\",\n\"\\\\d{5,8}\",,,\"90123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"(?:59|8[1-3])\\\\d{6}\",\"\\\\d{8}\",,,\"59012345\"],\"SI\",386,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[12]|3[4-8]|4[24-8]|5[2-8]|7[3-8]\"],\"(0$1)\",\"\",0],[,\"([3-7]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[37][01]|4[019]|51|6\"],\"0$1\",\"\",0],[,\"([89][09])(\\\\d{3,6})\",\"$1 $2\",[\"[89][09]\"],\"0$1\",\"\",0],[,\"([58]\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"59|8[1-3]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[23]\",\"\\\\d{3}\",,,\"112\"],\n[,,\"NA\",\"NA\"]],SJ:[,[,,\"0\\\\d{4}|[4789]\\\\d{7}\",\"\\\\d{5}(?:\\\\d{3})?\"],[,,\"79\\\\d{6}\",\"\\\\d{8}\",,,\"79123456\"],[,,\"(?:4[015-8]|5[89]|9\\\\d)\\\\d{6}\",\"\\\\d{8}\",,,\"41234567\"],[,,\"80[01]\\\\d{5}\",\"\\\\d{8}\",,,\"80012345\"],[,,\"82[09]\\\\d{5}\",\"\\\\d{8}\",,,\"82012345\"],[,,\"810(?:0[0-6]|[2-8]\\\\d)\\\\d{3}\",\"\\\\d{8}\",,,\"81021234\"],[,,\"880\\\\d{5}\",\"\\\\d{8}\",,,\"88012345\"],[,,\"85[0-5]\\\\d{5}\",\"\\\\d{8}\",,,\"85012345\"],\"SJ\",47,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"0\\\\d{4}|81(?:0(?:0[7-9]|1\\\\d)|5\\\\d{2})\\\\d{3}\",\"\\\\d{5}(?:\\\\d{3})?\",\n,,\"01234\"],1,[,,\"11[023]\",\"\\\\d{3}\",,,\"112\"],[,,\"81[23]\\\\d{5}\",\"\\\\d{8}\",,,\"81212345\"]],SK:[,[,,\"[2-689]\\\\d{8}\",\"\\\\d{9}\"],[,,\"[2-5]\\\\d{8}\",\"\\\\d{9}\",,,\"212345678\"],[,,\"9(?:0[1-8]|1[0-24-9]|4[0489])\\\\d{6}\",\"\\\\d{9}\",,,\"912123456\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"9(?:[78]\\\\d{7}|00\\\\d{6})\",\"\\\\d{9}\",,,\"900123456\"],[,,\"8[5-9]\\\\d{7}\",\"\\\\d{9}\",,,\"850123456\"],[,,\"NA\",\"NA\"],[,,\"6(?:5[0-4]|9[0-6])\\\\d{6}\",\"\\\\d{9}\",,,\"690123456\"],\"SK\",421,\"00\",\"0\",,,\"0\",,,,[[,\"(2)(\\\\d{3})(\\\\d{3})(\\\\d{2})\",\"$1/$2 $3 $4\",\n[\"2\"],\"0$1\",\"\",0],[,\"([3-5]\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1/$2 $3 $4\",[\"[3-5]\"],\"0$1\",\"\",0],[,\"([689]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[689]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"(?:8(?:00|[5-9]\\\\d)|9(?:00|[78]\\\\d))\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"96\\\\d{7}\",\"\\\\d{9}\",,,\"961234567\"],,[,,\"1(?:12|5[058])\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],SL:[,[,,\"[2-578]\\\\d{7}\",\"\\\\d{6,8}\"],[,,\"[235]2[2-4][2-9]\\\\d{4}\",\"\\\\d{6,8}\",,,\"22221234\"],[,,\"(?:2[15]|3[034]|4[04]|5[05]|7[6-9]|88)\\\\d{6}\",\"\\\\d{6,8}\",,,\"25123456\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SL\",232,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{6})\",\"$1 $2\",,\"(0$1)\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"(?:01|99)9\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],SM:[,[,,\"[05-7]\\\\d{7,9}\",\"\\\\d{6,10}\"],[,,\"0549(?:8[0157-9]|9\\\\d)\\\\d{4}\",\"\\\\d{6,10}\",,,\"0549886377\"],[,,\"6[16]\\\\d{6}\",\"\\\\d{8}\",,,\"66661212\"],[,,\"NA\",\"NA\"],[,,\"7[178]\\\\d{6}\",\"\\\\d{8}\",,,\"71123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"5[158]\\\\d{6}\",\"\\\\d{8}\",,,\"58001110\"],\n\"SM\",378,\"00\",,,,\"(?:0549)?([89]\\\\d{5})\",\"0549$1\",,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[5-7]\"],\"\",\"\",0],[,\"(0549)(\\\\d{6})\",\"$1 $2\",[\"0\"],\"\",\"\",0],[,\"(\\\\d{6})\",\"0549 $1\",[\"[89]\"],\"\",\"\",0]],[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"[5-7]\",\"[5-7]\"],\"\",\"\",0],[,\"(0549)(\\\\d{6})\",\"($1) $2\",[\"0\"]],[,\"(\\\\d{6})\",\"(0549) $1\",[\"[89]\"]]],[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"11[358]\",\"\\\\d{3}\",,,\"113\"],[,,\"NA\",\"NA\"]],SN:[,[,,\"[37]\\\\d{8}\",\"\\\\d{9}\"],[,,\"3(?:0(?:1[01]|80)|3(?:8[1-9]|9[2-9]))\\\\d{5}\",\n\"\\\\d{9}\",,,\"301012345\"],[,,\"7(?:0(?:[01279]0|3[03]|4[05]|5[06]|6[03-5]|8[029])|6(?:1[23]|2[89]|3[3489]|4[6-9]|5\\\\d|6[3-9]|7[45]|8[3-8])|7\\\\d{2}|8(?:01|1[01]))\\\\d{5}\",\"\\\\d{9}\",,,\"701012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"33301\\\\d{4}\",\"\\\\d{9}\",,,\"333011234\"],\"SN\",221,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],SO:[,[,,\"[1-79]\\\\d{6,8}\",\"\\\\d{7,9}\"],[,,\"(?:[134]\\\\d|2[0-79]|5[57-9])\\\\d{5}\",\n\"\\\\d{7}\",,,\"5522010\"],[,,\"(?:15\\\\d|2(?:4\\\\d|8)|6[17-9]?\\\\d{2}|7\\\\d{2}|9(?:07|1)\\\\d)\\\\d{5}\",\"\\\\d{7,9}\",,,\"907792024\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SO\",252,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d)(\\\\d{6})\",\"$1 $2\",[\"2[0-79]|[13-5]\"],\"\",\"\",0],[,\"(\\\\d)(\\\\d{7})\",\"$1 $2\",[\"24|[67]\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{5,7})\",\"$1 $2\",[\"15|28|6[178]|9\"],\"\",\"\",0],[,\"(69\\\\d)(\\\\d{6})\",\"$1 $2\",[\"69\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],SR:[,[,\n,\"[2-8]\\\\d{5,6}\",\"\\\\d{6,7}\"],[,,\"(?:2[1-3]|3[0-7]|4\\\\d|5[2-58]|68\\\\d)\\\\d{4}\",\"\\\\d{6,7}\",,,\"211234\"],[,,\"(?:7[1-57]|8[1-9])\\\\d{5}\",\"\\\\d{7}\",,,\"7412345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"56\\\\d{4}\",\"\\\\d{6}\",,,\"561234\"],\"SR\",597,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{3})\",\"$1-$2\",[\"[2-4]|5[2-58]\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1-$2-$3\",[\"56\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})\",\"$1-$2\",[\"[6-8]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"115\",\"\\\\d{3}\",,,\"115\"],[,\n,\"NA\",\"NA\"]],SS:[,[,,\"[19]\\\\d{8}\",\"\\\\d{9}\"],[,,\"18\\\\d{7}\",\"\\\\d{9}\",,,\"181234567\"],[,,\"(?:12|9[1257])\\\\d{7}\",\"\\\\d{9}\",,,\"977123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SS\",211,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],ST:[,[,,\"[29]\\\\d{6}\",\"\\\\d{7}\"],[,,\"22\\\\d{5}\",\"\\\\d{7}\",,,\"2221234\"],[,,\"9[89]\\\\d{5}\",\"\\\\d{7}\",,,\"9812345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"ST\",239,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],SV:[,[,,\"[267]\\\\d{7}|[89]\\\\d{6}(?:\\\\d{4})?\",\"\\\\d{7,8}|\\\\d{11}\"],[,,\"2[1-6]\\\\d{6}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"[67]\\\\d{7}\",\"\\\\d{8}\",,,\"70123456\"],[,,\"800\\\\d{4}(?:\\\\d{4})?\",\"\\\\d{7}(?:\\\\d{4})?\",,,\"8001234\"],[,,\"900\\\\d{4}(?:\\\\d{4})?\",\"\\\\d{7}(?:\\\\d{4})?\",,,\"9001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SV\",503,\"00\",\n,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"[267]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[89]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"[89]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],SX:[,[,,\"[5789]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"7215(?:4[2-8]|8[239]|9[056])\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"7215425678\"],[,,\"7215(?:1[02]|2\\\\d|5[034679]|8[014-8])\\\\d{4}\",\"\\\\d{10}\",,,\"7215205678\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002123456\"],\n[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002123456\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"SX\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"721\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"919\",\"\\\\d{3}\",,,\"919\"],[,,\"NA\",\"NA\"]],SY:[,[,,\"[1-59]\\\\d{7,8}\",\"\\\\d{6,9}\"],[,,\"(?:1(?:1\\\\d?|4\\\\d|[2356])|2[1-35]|3(?:[13]\\\\d|4)|4[13]|5[1-3])\\\\d{6}\",\"\\\\d{6,9}\",,,\"112345678\"],[,,\"9(?:22|[35][0-8]|4\\\\d|6[024-9]|88|9[0-489])\\\\d{6}\",\"\\\\d{9}\",,,\"944567890\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SY\",963,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[1-5]\"],\"0$1\",\"\",1],[,\"(9\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"9\"],\"0$1\",\"\",1]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[023]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],SZ:[,[,,\"[027]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2(?:2(?:0[07]|[13]7|2[57])|3(?:0[34]|[1278]3|3[23]|[46][34])|(?:40[4-69]|67)|5(?:0[5-7]|1[6-9]|[23][78]|48|5[01]))\\\\d{4}\",\"\\\\d{8}\",,,\"22171234\"],[,,\"7[6-8]\\\\d{6}\",\"\\\\d{8}\",,,\"76123456\"],[,\n,\"0800\\\\d{4}\",\"\\\\d{8}\",,,\"08001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"SZ\",268,\"00\",,,,,,,,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"[027]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"0800\\\\d{4}\",\"\\\\d{8}\",,,\"08001234\"],[,,\"NA\",\"NA\"],1,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],TC:[,[,,\"[5689]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"649(?:712|9(?:4\\\\d|50))\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"6497121234\"],[,,\"649(?:2(?:3[129]|4[1-7])|3(?:3[1-39]|4[1-7])|4[34][12])\\\\d{4}\",\"\\\\d{10}\",,,\"6492311234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\n\"\\\\d{10}\",,,\"8002345678\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"64971[01]\\\\d{4}\",\"\\\\d{10}\",,,\"6497101234\"],\"TC\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"649\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|99)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],TD:[,[,,\"[2679]\\\\d{7}\",\"\\\\d{8}\"],[,,\"22(?:[3789]0|5[0-5]|6[89])\\\\d{4}\",\"\\\\d{8}\",,,\"22501234\"],[,,\"(?:6[02368]\\\\d|77\\\\d|9(?:5[0-4]|9\\\\d))\\\\d{5}\",\"\\\\d{8}\",,,\"63012345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TD\",235,\"00|16\",,,,,,\"00\",,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[78]\",\"\\\\d{2}\",,,\"17\"],[,,\"NA\",\"NA\"]],TG:[,[,,\"[29]\\\\d{7}\",\"\\\\d{8}\"],[,,\"2(?:2[2-7]|3[23]|44|55|66|77)\\\\d{5}\",\"\\\\d{8}\",,,\"22212345\"],[,,\"9[0-289]\\\\d{6}\",\"\\\\d{8}\",,,\"90112345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TG\",228,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",\n,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:01|1[78]|7[17])\",\"\\\\d{3}\",,,\"117\"],[,,\"NA\",\"NA\"]],TH:[,[,,\"[2-9]\\\\d{7,8}|1\\\\d{3}(?:\\\\d{6})?\",\"\\\\d{4}|\\\\d{8,10}\"],[,,\"(?:2[1-9]|3[2-9]|4[2-5]|5[2-6]|7[3-7])\\\\d{6}\",\"\\\\d{8}\",,,\"21234567\"],[,,\"[89]\\\\d{8}\",\"\\\\d{9}\",,,\"812345678\"],[,,\"1800\\\\d{6}\",\"\\\\d{10}\",,,\"1800123456\"],[,,\"1900\\\\d{6}\",\"\\\\d{10}\",,,\"1900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"60\\\\d{7}\",\"\\\\d{9}\",,,\"601234567\"],\"TH\",66,\"00\",\"0\",,,\"0\",,,,[[,\"(2)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",\n[\"2\"],\"0$1\",\"\",0],[,\"([3-9]\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[3-9]\"],\"0$1\",\"\",0],[,\"(1[89]00)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"1\\\\d{3}\",\"\\\\d{4}\",,,\"1100\"],[,,\"1\\\\d{3}\",\"\\\\d{4}\",,,\"1100\"],,[,,\"1(?:669|9[19])\",\"\\\\d{3,4}\",,,\"191\"],[,,\"NA\",\"NA\"]],TJ:[,[,,\"[3-59]\\\\d{8}\",\"\\\\d{3,9}\"],[,,\"(?:3(?:1[3-5]|2[245]|3[12]|4[24-7]|5[25]|72)|4(?:46|74|87))\\\\d{6}\",\"\\\\d{3,9}\",,,\"372123456\"],[,,\"(?:505|9[0-35-9]\\\\d)\\\\d{6}\",\"\\\\d{9}\",,,\"917123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TJ\",992,\"810\",\"8\",,,\"8\",,\"8~10\",,[[,\"([349]\\\\d{2})(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"[34]7|91[78]\"],\"(8) $1\",\"\",1],[,\"([459]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"4[48]|5|9(?:1[59]|[0235-9])\"],\"(8) $1\",\"\",1],[,\"(331700)(\\\\d)(\\\\d{2})\",\"$1 $2 $3\",[\"331\",\"3317\",\"33170\",\"331700\"],\"(8) $1\",\"\",1],[,\"(\\\\d{4})(\\\\d)(\\\\d{4})\",\"$1 $2 $3\",[\"3[1-5]\",\"3(?:[1245]|3(?:[02-9]|1[0-589]))\"],\"(8) $1\",\"\",1]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[1-3]|12)\",\"\\\\d{3}\",,,\"112\"],\n[,,\"NA\",\"NA\"]],TK:[,[,,\"[2-5]\\\\d{3}\",\"\\\\d{4}\"],[,,\"[2-4]\\\\d{3}\",\"\\\\d{4}\",,,\"3010\"],[,,\"5\\\\d{3}\",\"\\\\d{4}\",,,\"5190\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TK\",690,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],TL:[,[,,\"[2-489]\\\\d{6}|7\\\\d{6,7}\",\"\\\\d{7,8}\"],[,,\"(?:2[1-5]|3[1-9]|4[1-4])\\\\d{5}\",\"\\\\d{7}\",,,\"2112345\"],[,,\"7[3-8]\\\\d{6}\",\"\\\\d{8}\",,,\"77212345\"],[,,\"80\\\\d{5}\",\"\\\\d{7}\",,,\"8012345\"],[,,\"90\\\\d{5}\",\"\\\\d{7}\",,,\"9012345\"],[,\n,\"NA\",\"NA\"],[,,\"70\\\\d{5}\",\"\\\\d{7}\",,,\"7012345\"],[,,\"NA\",\"NA\"],\"TL\",670,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[2-489]\"],\"\",\"\",0],[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"7\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[25]\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],TM:[,[,,\"[1-6]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:1(?:2\\\\d|3[1-9])|2(?:22|4[0-35-8])|3(?:22|4[03-9])|4(?:22|3[128]|4\\\\d|6[15])|5(?:22|5[7-9]|6[014-689]))\\\\d{5}\",\"\\\\d{8}\",,,\"12345678\"],[,,\"6[3-8]\\\\d{6}\",\"\\\\d{8}\",,,\"66123456\"],[,,\"NA\",\"NA\"],[,,\n\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TM\",993,\"810\",\"8\",,,\"8\",,\"8~10\",,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2-$3-$4\",[\"12\"],\"(8 $1)\",\"\",0],[,\"(\\\\d{2})(\\\\d{6})\",\"$1 $2\",[\"6\"],\"8 $1\",\"\",0],[,\"(\\\\d{3})(\\\\d)(\\\\d{2})(\\\\d{2})\",\"$1 $2-$3-$4\",[\"13|[2-5]\"],\"(8 $1)\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"0[1-3]\",\"\\\\d{2}\",,,\"03\"],[,,\"NA\",\"NA\"]],TN:[,[,,\"[2-57-9]\\\\d{7}\",\"\\\\d{8}\"],[,,\"(?:3[012]|7\\\\d|81)\\\\d{6}\",\"\\\\d{8}\",,,\"71234567\"],[,,\"(?:[259]\\\\d|4[0-2])\\\\d{6}\",\"\\\\d{8}\",\n,,\"20123456\"],[,,\"NA\",\"NA\"],[,,\"8[028]\\\\d{6}\",\"\\\\d{8}\",,,\"80123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TN\",216,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"19[078]\",\"\\\\d{3}\",,,\"197\"],[,,\"NA\",\"NA\"]],TO:[,[,,\"[02-8]\\\\d{4,6}\",\"\\\\d{5,7}\"],[,,\"(?:2\\\\d|3[1-8]|4[1-4]|[56]0|7[0149]|8[05])\\\\d{3}\",\"\\\\d{5}\",,,\"20123\"],[,,\"(?:7[578]|8[7-9])\\\\d{5}\",\"\\\\d{7}\",,,\"7715123\"],[,,\"0800\\\\d{3}\",\"\\\\d{7}\",,,\"0800222\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TO\",676,\"00\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{3})\",\"$1-$2\",[\"[1-6]|7[0-4]|8[05]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"7[5-9]|8[7-9]\"],\"\",\"\",0],[,\"(\\\\d{4})(\\\\d{3})\",\"$1 $2\",[\"0\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"9(?:11|22|33|99)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],TR:[,[,,\"[2-589]\\\\d{9}|444\\\\d{4}\",\"\\\\d{7,10}\"],[,,\"(?:2(?:[13][26]|[28][2468]|[45][268]|[67][246])|3(?:[13][28]|[24-6][2468]|[78][02468]|92)|4(?:[16][246]|[23578][2468]|4[26]))\\\\d{7}\",\"\\\\d{10}\",\n,,\"2123456789\"],[,,\"5(?:0[1-7]|22|[34]\\\\d|5[1-59]|9[246])\\\\d{7}\",\"\\\\d{10}\",,,\"5012345678\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"900\\\\d{7}\",\"\\\\d{10}\",,,\"9001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TR\",90,\"00\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[23]|4(?:[0-35-9]|4[0-35-9])\"],\"(0$1)\",\"\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[589]\"],\"0$1\",\"\",1],[,\"(444)(\\\\d{1})(\\\\d{3})\",\"$1 $2 $3\",[\"444\"],\"\",\"\",0]],,[,,\"512\\\\d{7}\",\"\\\\d{10}\",,,\"5123456789\"],,,[,,\"444\\\\d{4}\",\n\"\\\\d{7}\",,,\"4441444\"],[,,\"444\\\\d{4}|850\\\\d{7}\",\"\\\\d{7,10}\",,,\"4441444\"],,[,,\"1(?:1[02]|55)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],TT:[,[,,\"[589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"868(?:2(?:01|2[1-5])|6(?:07|1[4-6]|2[1-9]|[3-6]\\\\d|7[0-79]|9[0-8])|82[12])\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"8682211234\"],[,,\"868(?:2(?:8[59]|9\\\\d)|3(?:0[1-9]|1[02-9]|[2-9]\\\\d)|4(?:[679]\\\\d|8[0-4])|6(?:20|78|8\\\\d)|7(?:03|1[02-9]|[2-9]\\\\d))\\\\d{4}\",\"\\\\d{10}\",,,\"8682911234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002345678\"],\n[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"TT\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"868\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"99[09]\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],TV:[,[,,\"[29]\\\\d{4,5}\",\"\\\\d{5,6}\"],[,,\"2[02-9]\\\\d{3}\",\"\\\\d{5}\",,,\"20123\"],[,,\"90\\\\d{4}\",\"\\\\d{6}\",,,\"901234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TV\",688,\"00\",,,,,,,,,,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,\n,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],TW:[,[,,\"[2-9]\\\\d{7,8}\",\"\\\\d{8,9}\"],[,,\"[2-8]\\\\d{7,8}\",\"\\\\d{8,9}\",,,\"21234567\"],[,,\"9\\\\d{8}\",\"\\\\d{9}\",,,\"912345678\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"900\\\\d{6}\",\"\\\\d{9}\",,,\"900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"TW\",886,\"0(?:0[25679]|19)\",\"0\",\"#\",,\"0\",,,,[[,\"([2-8])(\\\\d{3,4})(\\\\d{4})\",\"$1 $2 $3\",[\"[2-7]|8[1-9]\"],\"0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"80|9\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n,[,,\"11[029]\",\"\\\\d{3}\",,,\"110\"],[,,\"NA\",\"NA\"]],TZ:[,[,,\"\\\\d{9}\",\"\\\\d{7,9}\"],[,,\"2[2-8]\\\\d{7}\",\"\\\\d{7,9}\",,,\"222345678\"],[,,\"(?:6[158]|7[1-9])\\\\d{7}\",\"\\\\d{9}\",,,\"612345678\"],[,,\"80[08]\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"90\\\\d{7}\",\"\\\\d{9}\",,,\"900123456\"],[,,\"8(?:40|6[01])\\\\d{6}\",\"\\\\d{9}\",,,\"840123456\"],[,,\"NA\",\"NA\"],[,,\"41\\\\d{7}\",\"\\\\d{9}\",,,\"412345678\"],\"TZ\",255,\"00[056]\",\"0\",,,\"0\",,,,[[,\"([24]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[24]\"],\"0$1\",\"\",0],[,\"([67]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"[67]\"],\n\"0$1\",\"\",0],[,\"([89]\\\\d{2})(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"[89]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"11[12]|999\",\"\\\\d{3}\",,,\"111\"],[,,\"NA\",\"NA\"]],UA:[,[,,\"[3-689]\\\\d{8}\",\"\\\\d{5,9}\"],[,,\"(?:3[1-8]|4[13-8]|5[1-7]|6[12459])\\\\d{7}\",\"\\\\d{5,9}\",,,\"311234567\"],[,,\"(?:39|50|6[36-8]|9[1-9])\\\\d{7}\",\"\\\\d{9}\",,,\"391234567\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"900\\\\d{6}\",\"\\\\d{9}\",,,\"900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"89\\\\d{7}\",\"\\\\d{9}\",,,\"891234567\"],\"UA\",380,\"00\",\"0\",\n,,\"0\",,\"0~0\",,[[,\"([3-689]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[38]9|4(?:[45][0-5]|87)|5(?:0|6[37]|7[37])|6[36-8]|9[1-9]\",\"[38]9|4(?:[45][0-5]|87)|5(?:0|6(?:3[14-7]|7)|7[37])|6[36-8]|9[1-9]\"],\"0$1\",\"\",0],[,\"([3-689]\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"3[1-8]2|4[13678]2|5(?:[12457]2|6[24])|6(?:[49]2|[12][29]|5[24])|8[0-8]|90\",\"3(?:[1-46-8]2[013-9]|52)|4(?:[1378]2|62[013-9])|5(?:[12457]2|6[24])|6(?:[49]2|[12][29]|5[24])|8[0-8]|90\"],\"0$1\",\"\",0],[,\"([3-6]\\\\d{3})(\\\\d{5})\",\"$1 $2\",[\"3(?:5[013-9]|[1-46-8])|4(?:[137][013-9]|6|[45][6-9]|8[4-6])|5(?:[1245][013-9]|6[0135-9]|3|7[4-6])|6(?:[49][013-9]|5[0135-9]|[12][13-8])\",\n\"3(?:5[013-9]|[1-46-8](?:22|[013-9]))|4(?:[137][013-9]|6(?:[013-9]|22)|[45][6-9]|8[4-6])|5(?:[1245][013-9]|6(?:3[02389]|[015689])|3|7[4-6])|6(?:[49][013-9]|5[0135-9]|[12][13-8])\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:0[123]|12)\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],UG:[,[,,\"\\\\d{9}\",\"\\\\d{5,9}\"],[,,\"20(?:[0147]\\\\d{2}|2(?:40|[5-9]\\\\d)|3[23]\\\\d|5[0-4]\\\\d|60\\\\d|8[0-2]\\\\d)\\\\d{4}|[34]\\\\d{8}\",\"\\\\d{5,9}\",,,\"312345678\"],[,,\"7(?:0[0-7]|[15789]\\\\d|[23]0|[46][0-4])\\\\d{6}\",\"\\\\d{9}\",,,\n\"712345678\"],[,,\"800[123]\\\\d{5}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"90[123]\\\\d{6}\",\"\\\\d{9}\",,,\"901123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"UG\",256,\"00[057]\",\"0\",,,\"0\",,,,[[,\"(\\\\d{3})(\\\\d{6})\",\"$1 $2\",[\"[7-9]|20(?:[013-8]|2[5-9])|4(?:6[45]|[7-9])\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{7})\",\"$1 $2\",[\"3|4(?:[1-5]|6[0-36-9])\"],\"0$1\",\"\",0],[,\"(2024)(\\\\d{5})\",\"$1 $2\",[\"2024\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"999\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],US:[,[,,\"[2-9]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],\n[,,\"(?:2(?:0[1-35-9]|1[02-9]|2[4589]|3[149]|4[08]|5[1-46]|6[0279]|7[06]|8[13])|3(?:0[1-57-9]|1[02-9]|2[0135]|3[014679]|47|5[12]|6[01]|8[056])|4(?:0[124-9]|1[02-579]|2[3-5]|3[0245]|4[0235]|58|69|7[0589]|8[04])|5(?:0[1-57-9]|1[0235-8]|20|3[0149]|4[01]|5[19]|6[1-37]|7[013-5]|8[056])|6(?:0[1-35-9]|1[024-9]|2[036]|3[016]|4[16]|5[017]|6[0-279]|78|8[12])|7(?:0[1-46-8]|1[02-9]|2[047]|3[124]|4[07]|5[47]|6[02359]|7[02-59]|8[156])|8(?:0[1-68]|1[02-8]|28|3[0-25]|4[3578]|5[06-9]|6[02-5]|7[028])|9(?:0[1346-9]|1[02-9]|2[0589]|3[1678]|4[0179]|5[1246]|7[0-3589]|8[0459]))[2-9]\\\\d{6}\",\n\"\\\\d{7}(?:\\\\d{3})?\",,,\"2015555555\"],[,,\"(?:2(?:0[1-35-9]|1[02-9]|2[4589]|3[149]|4[08]|5[1-46]|6[0279]|7[06]|8[13])|3(?:0[1-57-9]|1[02-9]|2[0135]|3[014679]|47|5[12]|6[01]|8[056])|4(?:0[124-9]|1[02-579]|2[3-5]|3[0245]|4[0235]|58|69|7[0589]|8[04])|5(?:0[1-57-9]|1[0235-8]|20|3[0149]|4[01]|5[19]|6[1-37]|7[013-5]|8[056])|6(?:0[1-35-9]|1[024-9]|2[036]|3[016]|4[16]|5[017]|6[0-279]|78|8[12])|7(?:0[1-46-8]|1[02-9]|2[047]|3[124]|4[07]|5[47]|6[02359]|7[02-59]|8[156])|8(?:0[1-68]|1[02-8]|28|3[0-25]|4[3578]|5[06-9]|6[02-5]|7[028])|9(?:0[1346-9]|1[02-9]|2[0589]|3[1678]|4[0179]|5[1246]|7[0-3589]|8[0459]))[2-9]\\\\d{6}\",\n\"\\\\d{7}(?:\\\\d{3})?\",,,\"2015555555\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002345678\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"US\",1,\"011\",\"1\",,,\"1\",,,1,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1-$2\",,\"\",\"\",1],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"($1) $2-$3\",,\"\",\"\",1]],[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{4})\",\"$1-$2-$3\"]],[,,\"NA\",\"NA\"],1,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"112|911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],UY:[,[,,\"[2489]\\\\d{6,7}\",\n\"\\\\d{7,8}\"],[,,\"2\\\\d{7}|4[2-7]\\\\d{6}\",\"\\\\d{7,8}\",,,\"21231234\"],[,,\"9[13-9]\\\\d{6}\",\"\\\\d{8}\",,,\"94231234\"],[,,\"80[05]\\\\d{4}\",\"\\\\d{7}\",,,\"8001234\"],[,,\"90[0-8]\\\\d{4}\",\"\\\\d{7}\",,,\"9001234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"UY\",598,\"0(?:1[3-9]\\\\d|0)\",\"0\",\" int. \",,\"0\",,\"00\",,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",[\"[24]\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"9[1-9]\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[89]0\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"128|911\",\n\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],UZ:[,[,,\"[679]\\\\d{8}\",\"\\\\d{7,9}\"],[,,\"(?:6(?:1(?:22|3[124]|4[1-4]|5[123578]|64)|2(?:22|3[0-57-9]|41)|5(?:22|3[3-7]|5[024-8])|6\\\\d{2}|7(?:[23]\\\\d|7[69])|9(?:22|4[1-8]|6[135]))|7(?:0(?:5[4-9]|6[0146]|7[12456]|9[135-8])|1[12]\\\\d|2(?:22|3[1345789]|4[123579]|5[14])|3(?:2\\\\d|3[1578]|4[1-35-7]|5[1-57]|61)|4(?:2\\\\d|3[1-579]|7[1-79])|5(?:22|5[1-9]|6[1457])|6(?:22|3[12457]|4[13-8])|9(?:22|5[1-9])))\\\\d{5}\",\"\\\\d{7,9}\",,,\"662345678\"],[,,\"6(?:1(?:2(?:98|2[01])|35[0-4]|50\\\\d|61[23]|7(?:[01][017]|4\\\\d|55|9[5-9]))|2(?:11\\\\d|2(?:[12]1|9[01379])|5(?:[126]\\\\d|3[0-4])|7\\\\d{2})|5(?:19[01]|2(?:27|9[26])|30\\\\d|59\\\\d|7\\\\d{2})|6(?:2(?:1[5-9]|2[0367]|38|41|52|60)|3[79]\\\\d|4(?:56|83)|7(?:[07]\\\\d|1[017]|3[07]|4[047]|5[057]|67|8[0178]|9[79])|9[0-3]\\\\d)|7(?:2(?:24|3[237]|4[5-9]|7[15-8])|5(?:7[12]|8[0589])|7(?:0\\\\d|[39][07])|9(?:0\\\\d|7[079]))|9(2(?:1[1267]|5\\\\d|3[01]|7[0-4])|5[67]\\\\d|6(?:2[0-26]|8\\\\d)|7\\\\d{2}))\\\\d{4}|7(?:0\\\\d{3}|1(?:13[01]|6(?:0[47]|1[67]|66)|71[3-69]|98\\\\d)|2(?:2(?:2[79]|95)|3(?:2[5-9]|6[0-6])|57\\\\d|7(?:0\\\\d|1[17]|2[27]|3[37]|44|5[057]|66|88))|3(?:2(?:1[0-6]|21|3[469]|7[159])|33\\\\d|5(?:0[0-4]|5[579]|9\\\\d)|7(?:[0-3579]\\\\d|4[0467]|6[67]|8[078])|9[4-6]\\\\d)|4(?:2(?:29|5[0257]|6[0-7]|7[1-57])|5(?:1[0-4]|8\\\\d|9[5-9])|7(?:0\\\\d|1[024589]|2[0127]|3[0137]|[46][07]|5[01]|7[5-9]|9[079])|9(?:7[015-9]|[89]\\\\d))|5(?:112|2(?:0\\\\d|2[29]|[49]4)|3[1568]\\\\d|52[6-9]|7(?:0[01578]|1[017]|[23]7|4[047]|[5-7]\\\\d|8[78]|9[079]))|6(?:2(?:2[1245]|4[2-4])|39\\\\d|41[179]|5(?:[349]\\\\d|5[0-2])|7(?:0[017]|[13]\\\\d|22|44|55|67|88))|9(?:22[128]|3(?:2[0-4]|7\\\\d)|57[05629]|7(?:2[05-9]|3[37]|4\\\\d|60|7[2579]|87|9[07])))\\\\d{4}|9[0-57-9]\\\\d{7}\",\n\"\\\\d{7,9}\",,,\"912345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"UZ\",998,\"810\",\"8\",,,\"8\",,\"8~10\",,[[,\"([679]\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",,\"8 $1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"0(?:0[123]|[123]|50)\",\"\\\\d{2,3}\",,,\"01\"],[,,\"NA\",\"NA\"]],VA:[,[,,\"06\\\\d{8}\",\"\\\\d{10}\"],[,,\"06698\\\\d{5}\",\"\\\\d{10}\",,,\"0669812345\"],[,,\"N/A\",\"N/A\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"VA\",379,\"00\",,,,,,,,[[,\"(06)(\\\\d{4})(\\\\d{4})\",\n\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"11[2358]\",\"\\\\d{3}\",,,\"113\"],[,,\"NA\",\"NA\"]],VC:[,[,,\"[5789]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"784(?:266|3(?:6[6-9]|7\\\\d|8[0-24-6])|4(?:38|5[0-36-8]|8\\\\d|9[01])|555|638|784)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"7842661234\"],[,,\"784(?:4(?:3[0-4]|5[45]|9[2-5])|5(?:2[6-9]|3[0-4]|93))\\\\d{4}\",\"\\\\d{10}\",,,\"7844301234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002345678\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,\n,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"VC\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"784\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|99)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],VE:[,[,,\"[24589]\\\\d{9}\",\"\\\\d{7,10}\"],[,,\"(?:2(?:12|3[457-9]|[58][1-9]|[467]\\\\d|9[1-6])|50[01])\\\\d{7}\",\"\\\\d{7,10}\",,,\"2121234567\"],[,,\"4(?:1[24-8]|2[46])\\\\d{7}\",\"\\\\d{10}\",,,\"4121234567\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"900\\\\d{7}\",\"\\\\d{10}\",,,\"9001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n\"VE\",58,\"00\",\"0\",,,\"(1\\\\d{2})|0\",,,,[[,\"(\\\\d{3})(\\\\d{7})\",\"$1-$2\",,\"0$1\",\"$CC $1\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"171\",\"\\\\d{3}\",,,\"171\"],[,,\"NA\",\"NA\"]],VG:[,[,,\"[2589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"284(?:(?:229|4(?:22|9[45])|774|8(?:52|6[459]))\\\\d{4}|496[0-5]\\\\d{3})\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"2842291234\"],[,,\"284(?:(?:3(?:0[0-3]|4[0-367])|4(?:4[0-6]|68|99)|54[0-57])\\\\d{4}|496[6-9]\\\\d{3})\",\"\\\\d{10}\",,,\"2843001234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002345678\"],\n[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"VG\",1,\"011\",\"1\",,,\"1\",,,,,,[,,\"NA\",\"NA\"],,\"284\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"9(?:11|99)\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],VI:[,[,,\"[3589]\\\\d{9}\",\"\\\\d{7}(?:\\\\d{3})?\"],[,,\"340(?:2(?:01|2[067]|36|44|77)|3(?:32|44)|4(?:4[38]|7[34])|5(?:1[34]|55)|6(?:26|4[23]|9[023])|7(?:[17]\\\\d|27)|884|998)\\\\d{4}\",\"\\\\d{7}(?:\\\\d{3})?\",,,\"3406421234\"],[,,\"340(?:2(?:01|2[067]|36|44|77)|3(?:32|44)|4(?:4[38]|7[34])|5(?:1[34]|55)|6(?:26|4[23]|9[023])|7(?:[17]\\\\d|27)|884|998)\\\\d{4}\",\n\"\\\\d{7}(?:\\\\d{3})?\",,,\"3406421234\"],[,,\"8(?:00|55|66|77|88)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"8002345678\"],[,,\"900[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"9002345678\"],[,,\"NA\",\"NA\"],[,,\"5(?:00|33|44)[2-9]\\\\d{6}\",\"\\\\d{10}\",,,\"5002345678\"],[,,\"NA\",\"NA\"],\"VI\",1,\"011\",\"1\",,,\"1\",,,1,,,[,,\"NA\",\"NA\"],,\"340\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"911\",\"\\\\d{3}\",,,\"911\"],[,,\"NA\",\"NA\"]],VN:[,[,,\"[17]\\\\d{6,9}|[2-69]\\\\d{7,9}|8\\\\d{6,8}\",\"\\\\d{7,10}\"],[,,\"(?:2(?:[025-79]|1[0189]|[348][01])|3(?:[0136-9]|[25][01])|4\\\\d|5(?:[01][01]|[2-9])|6(?:[0-46-8]|5[01])|7(?:[02-79]|[18][01])|8[1-9])\\\\d{7}\",\n\"\\\\d{9,10}\",,,\"2101234567\"],[,,\"(?:9\\\\d|1(?:2\\\\d|6[2-9]|8[68]|99))\\\\d{7}\",\"\\\\d{9,10}\",,,\"912345678\"],[,,\"1800\\\\d{4,6}\",\"\\\\d{8,10}\",,,\"1800123456\"],[,,\"1900\\\\d{4,6}\",\"\\\\d{8,10}\",,,\"1900123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"VN\",84,\"00\",\"0\",,,\"0\",,,,[[,\"([17]99)(\\\\d{4})\",\"$1 $2\",[\"[17]99\"],\"0$1\",\"\",1],[,\"([48])(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"[48]\"],\"0$1\",\"\",1],[,\"([235-7]\\\\d)(\\\\d{4})(\\\\d{3})\",\"$1 $2 $3\",[\"2[025-79]|3[0136-9]|5[2-9]|6[0-46-8]|7[02-79]\"],\"0$1\",\"\",1],[,\"(80)(\\\\d{5})\",\"$1 $2\",\n[\"80\"],\"0$1\",\"\",1],[,\"(69\\\\d)(\\\\d{4,5})\",\"$1 $2\",[\"69\"],\"0$1\",\"\",1],[,\"([235-7]\\\\d{2})(\\\\d{4})(\\\\d{3})\",\"$1 $2 $3\",[\"2[1348]|3[25]|5[01]|65|7[18]\"],\"0$1\",\"\",1],[,\"(9\\\\d)(\\\\d{3})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3 $4\",[\"9\"],\"0$1\",\"\",1],[,\"(1[2689]\\\\d)(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"1(?:[26]|8[68]|99)\"],\"0$1\",\"\",1],[,\"(1[89]00)(\\\\d{4,6})\",\"$1 $2\",[\"1[89]0\"],\"$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"[17]99\\\\d{4}|69\\\\d{5,6}\",\"\\\\d{7,8}\",,,\"1992000\"],[,,\"[17]99\\\\d{4}|69\\\\d{5,6}|80\\\\d{5}\",\"\\\\d{7,8}\",,,\"1992000\"],,[,,\"11[345]\",\n\"\\\\d{3}\",,,\"113\"],[,,\"NA\",\"NA\"]],VU:[,[,,\"[2-57-9]\\\\d{4,6}\",\"\\\\d{5,7}\"],[,,\"(?:2[2-9]\\\\d|3(?:[5-7]\\\\d|8[0-8])|48[4-9]|88\\\\d)\\\\d{2}\",\"\\\\d{5}\",,,\"22123\"],[,,\"(?:5(?:7[2-5]|[3-69]\\\\d)|7[013-7]\\\\d)\\\\d{4}\",\"\\\\d{7}\",,,\"5912345\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"VU\",678,\"00\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{4})\",\"$1 $2\",[\"[579]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"3[03]\\\\d{3}|900\\\\d{4}\",\"\\\\d{5,7}\",,,\"30123\"],,[,,\"112\",\"\\\\d{3}\",,,\"112\"],[,,\"NA\",\"NA\"]],WF:[,[,,\"[5-7]\\\\d{5}\",\n\"\\\\d{6}\"],[,,\"(?:50|68|72)\\\\d{4}\",\"\\\\d{6}\",,,\"501234\"],[,,\"(?:50|68|72)\\\\d{4}\",\"\\\\d{6}\",,,\"501234\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"WF\",681,\"00\",,,,,,,1,[[,\"(\\\\d{2})(\\\\d{2})(\\\\d{2})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1[578]\",\"\\\\d{2}\",,,\"15\"],[,,\"NA\",\"NA\"]],WS:[,[,,\"[2-8]\\\\d{4,6}\",\"\\\\d{5,7}\"],[,,\"(?:[2-5]\\\\d|6[1-9]|84\\\\d{2})\\\\d{3}\",\"\\\\d{5,7}\",,,\"22123\"],[,,\"(?:60|7[25-7]\\\\d)\\\\d{4}\",\"\\\\d{6,7}\",,,\"601234\"],[,,\"800\\\\d{3}\",\"\\\\d{6}\",\n,,\"800123\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"WS\",685,\"0\",,,,,,,,[[,\"(8\\\\d{2})(\\\\d{3,4})\",\"$1 $2\",[\"8\"],\"\",\"\",0],[,\"(7\\\\d)(\\\\d{5})\",\"$1 $2\",[\"7\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"99[4-6]\",\"\\\\d{3}\",,,\"994\"],[,,\"NA\",\"NA\"]],YE:[,[,,\"[1-7]\\\\d{6,8}\",\"\\\\d{6,9}\"],[,,\"(?:1(?:7\\\\d|[2-68])|2[2-68]|3[2358]|4[2-58]|5[2-6]|6[3-58]|7[24-68])\\\\d{5}\",\"\\\\d{6,8}\",,,\"1234567\"],[,,\"7[0137]\\\\d{7}\",\"\\\\d{9}\",,,\"712345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"],[,,\"NA\",\"NA\"],\"YE\",967,\"00\",\"0\",,,\"0\",,,,[[,\"([1-7])(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[1-6]|7[24-68]\"],\"0$1\",\"\",0],[,\"(7\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"7[0137]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"19[1459]\",\"\\\\d{3}\",,,\"191\"],[,,\"NA\",\"NA\"]],YT:[,[,,\"[268]\\\\d{8}\",\"\\\\d{9}\"],[,,\"2696[0-4]\\\\d{4}\",\"\\\\d{9}\",,,\"269601234\"],[,,\"639\\\\d{6}\",\"\\\\d{9}\",,,\"639123456\"],[,,\"80\\\\d{7}\",\"\\\\d{9}\",,,\"801234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"YT\",262,\"00\",\n\"0\",,,\"0\",,,,,,[,,\"NA\",\"NA\"],,\"269|63\",[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"1(?:12|5)\",\"\\\\d{2,3}\",,,\"15\"],[,,\"NA\",\"NA\"]],ZA:[,[,,\"[1-79]\\\\d{8}|8(?:[067]\\\\d{7}|[1-4]\\\\d{3,7})\",\"\\\\d{5,9}\"],[,,\"(?:1[0-8]|2[0-378]|3[1-69]|4\\\\d|5[1346-8])\\\\d{7}\",\"\\\\d{9}\",,,\"101234567\"],[,,\"(?:6[0-5]|7[0-46-9])\\\\d{7}|8[1-4]\\\\d{3,7}\",\"\\\\d{5,9}\",,,\"711234567\"],[,,\"80\\\\d{7}\",\"\\\\d{9}\",,,\"801234567\"],[,,\"86[2-9]\\\\d{6}|90\\\\d{7}\",\"\\\\d{9}\",,,\"862345678\"],[,,\"860\\\\d{6}\",\"\\\\d{9}\",,,\"860123456\"],[,,\"NA\",\"NA\"],[,,\"87\\\\d{7}\",\"\\\\d{9}\",,\n,\"871234567\"],\"ZA\",27,\"00\",\"0\",,,\"0\",,,,[[,\"(860)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"860\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{4})\",\"$1 $2 $3\",[\"[1-79]|8(?:[0-47]|6[1-9])\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3,4})\",\"$1 $2\",[\"8[1-4]\"],\"0$1\",\"\",0],[,\"(\\\\d{2})(\\\\d{3})(\\\\d{2,3})\",\"$1 $2 $3\",[\"8[1-4]\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"861\\\\d{6}\",\"\\\\d{9}\",,,\"861123456\"],,[,,\"1(?:01(?:11|77)|12)\",\"\\\\d{3,5}\",,,\"10111\"],[,,\"NA\",\"NA\"]],ZM:[,[,,\"[289]\\\\d{8}\",\"\\\\d{9}\"],[,,\"21[1-8]\\\\d{6}\",\"\\\\d{9}\",,,\"211234567\"],\n[,,\"9(?:5[05]|6\\\\d|7[13-9])\\\\d{6}\",\"\\\\d{9}\",,,\"955123456\"],[,,\"800\\\\d{6}\",\"\\\\d{9}\",,,\"800123456\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"ZM\",260,\"00\",\"0\",,,\"0\",,,,[[,\"([29]\\\\d)(\\\\d{7})\",\"$1 $2\",[\"[29]\"],\"0$1\",\"\",0],[,\"(800)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"8\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"(?:112|99[139])\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],ZW:[,[,,\"2(?:[012457-9]\\\\d{3,8}|6\\\\d{3,6})|[13-79]\\\\d{4,8}|8[06]\\\\d{8}\",\"\\\\d{3,10}\"],[,,\"(?:1[3-9]|2(?:0[45]|[16]|2[28]|[49]8?|58[23]|7[246]|8[1346-9])|3(?:08?|17?|3[78]|[2456]|7[1569]|8[379])|5(?:[07-9]|1[78]|483|5(?:7?|8))|6(?:0|28|37?|[45][68][78]|98?)|848)\\\\d{3,6}|(?:2(?:27|5|7[135789]|8[25])|3[39]|5[1-46]|6[126-8])\\\\d{4,6}|2(?:(?:0|70)\\\\d{5,6}|2[05]\\\\d{7})|(?:4\\\\d|9[2-8])\\\\d{4,7}\",\n\"\\\\d{3,10}\",,,\"1312345\"],[,,\"7[1378]\\\\d{7}|86(?:22|44)\\\\d{6}\",\"\\\\d{9,10}\",,,\"711234567\"],[,,\"800\\\\d{7}\",\"\\\\d{10}\",,,\"8001234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"86(?:1[12]|30|55|77|8[367]|99)\\\\d{6}\",\"\\\\d{10}\",,,\"8686123456\"],\"ZW\",263,\"00\",\"0\",,,\"0\",,,,[[,\"([49])(\\\\d{3})(\\\\d{2,5})\",\"$1 $2 $3\",[\"4|9[2-9]\"],\"0$1\",\"\",0],[,\"([179]\\\\d)(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"[19]1|7\"],\"0$1\",\"\",0],[,\"(86\\\\d{2})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"86[24]\"],\"0$1\",\"\",0],[,\"([2356]\\\\d{2})(\\\\d{3,5})\",\"$1 $2\",\n[\"2(?:[278]|0[45]|[49]8)|3(?:08|17|3[78]|[78])|5[15][78]|6(?:[29]8|37|[68][78])\"],\"0$1\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3,4})\",\"$1 $2 $3\",[\"2(?:[278]|0[45]|48)|3(?:08|17|3[78]|[78])|5[15][78]|6(?:[29]8|37|[68][78])|80\"],\"0$1\",\"\",0],[,\"([1-356]\\\\d)(\\\\d{3,5})\",\"$1 $2\",[\"1[3-9]|2(?:[1-469]|0[0-35-9]|[45][0-79])|3(?:0[0-79]|1[0-689]|[24-69]|3[0-69])|5(?:[02-46-9]|[15][0-69])|6(?:[0145]|[29][0-79]|3[0-689]|[68][0-69])\"],\"0$1\",\"\",0],[,\"([1-356]\\\\d)(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"1[3-9]|2(?:[1-469]|0[0-35-9]|[45][0-79])|3(?:0[0-79]|1[0-689]|[24-69]|3[0-69])|5(?:[02-46-9]|[15][0-69])|6(?:[0145]|[29][0-79]|3[0-689]|[68][0-69])\"],\n\"0$1\",\"\",0],[,\"([25]\\\\d{3})(\\\\d{3,5})\",\"$1 $2\",[\"(?:25|54)8\",\"258[23]|5483\"],\"0$1\",\"\",0],[,\"([25]\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",[\"(?:25|54)8\",\"258[23]|5483\"],\"0$1\",\"\",0],[,\"(8\\\\d{3})(\\\\d{6})\",\"$1 $2\",[\"86\"],\"0$1\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"(?:112|99[3459])\",\"\\\\d{3}\",,,\"999\"],[,,\"NA\",\"NA\"]],800:[,[,,\"\\\\d{8}\",\"\\\\d{8}\",,,\"12345678\"],[,,\"NA\",\"NA\",,,\"12345678\"],[,,\"NA\",\"NA\",,,\"12345678\"],[,,\"\\\\d{8}\",\"\\\\d{8}\",,,\"12345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\n\"NA\",\"NA\"],\"001\",800,\"\",,,,,,,1,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],808:[,[,,\"\\\\d{8}\",\"\\\\d{8}\",,,\"12345678\"],[,,\"NA\",\"NA\",,,\"12345678\"],[,,\"NA\",\"NA\",,,\"12345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"\\\\d{8}\",\"\\\\d{8}\",,,\"12345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"001\",808,\"\",,,,,,,1,[[,\"(\\\\d{4})(\\\\d{4})\",\"$1 $2\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],870:[,[,,\"[35-7]\\\\d{8}\",\"\\\\d{9}\",\n,,\"301234567\"],[,,\"NA\",\"NA\",,,\"301234567\"],[,,\"(?:[356]\\\\d|7[6-8])\\\\d{7}\",\"\\\\d{9}\",,,\"301234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"001\",870,\"\",,,,,,,,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],878:[,[,,\"1\\\\d{11}\",\"\\\\d{12}\",,,\"101234567890\"],[,,\"NA\",\"NA\",,,\"101234567890\"],[,,\"NA\",\"NA\",,,\"101234567890\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"10\\\\d{10}\",\"\\\\d{12}\",\n,,\"101234567890\"],\"001\",878,\"\",,,,,,,1,[[,\"(\\\\d{2})(\\\\d{5})(\\\\d{5})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],881:[,[,,\"[67]\\\\d{8}\",\"\\\\d{9}\",,,\"612345678\"],[,,\"NA\",\"NA\",,,\"612345678\"],[,,\"[67]\\\\d{8}\",\"\\\\d{9}\",,,\"612345678\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"001\",881,\"\",,,,,,,,[[,\"(\\\\d)(\\\\d{3})(\\\\d{5})\",\"$1 $2 $3\",[\"[67]\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],\n882:[,[,,\"[13]\\\\d{6,11}\",\"\\\\d{7,12}\",,,\"3451234567\"],[,,\"NA\",\"NA\",,,\"3451234567\"],[,,\"3(?:2\\\\d{3}|37\\\\d{2}|4(?:2|7\\\\d{3}))\\\\d{4}\",\"\\\\d{7,10}\",,,\"3451234567\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"1(?:3(?:0[0347]|[13][0139]|2[035]|4[013568]|6[0459]|7[06]|8[15678]|9[0689])\\\\d{4}|6\\\\d{5,10})|345\\\\d{7}\",\"\\\\d{7,12}\",,,\"3451234567\"],\"001\",882,\"\",,,,,,,,[[,\"(\\\\d{2})(\\\\d{4})(\\\\d{3})\",\"$1 $2 $3\",[\"3[23]\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{5})\",\"$1 $2\",[\"16|342\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{4})(\\\\d{4})\",\n\"$1 $2 $3\",[\"34[57]\"],\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",[\"348\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{2})(\\\\d{4})\",\"$1 $2 $3\",[\"1\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{3,4})(\\\\d{4})\",\"$1 $2 $3\",[\"16\"],\"\",\"\",0],[,\"(\\\\d{2})(\\\\d{4,5})(\\\\d{5})\",\"$1 $2 $3\",[\"16\"],\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"348[57]\\\\d{7}\",\"\\\\d{11}\",,,\"3451234567\"]],883:[,[,,\"51\\\\d{7}(?:\\\\d{3})?\",\"\\\\d{9}(?:\\\\d{3})?\",,,\"510012345\"],[,,\"NA\",\"NA\",,,\"510012345\"],[,,\"NA\",\"NA\",,,\"510012345\"],[,,\"NA\",\"NA\"],\n[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"51(?:00\\\\d{5}(?:\\\\d{3})?|10\\\\d{8})\",\"\\\\d{9}(?:\\\\d{3})?\",,,\"510012345\"],\"001\",883,\"\",,,,,,,1,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3\",,\"\",\"\",0],[,\"(\\\\d{3})(\\\\d{3})(\\\\d{3})(\\\\d{3})\",\"$1 $2 $3 $4\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],888:[,[,,\"\\\\d{11}\",\"\\\\d{11}\",,,\"12345678901\"],[,,\"NA\",\"NA\",,,\"12345678901\"],[,,\"NA\",\"NA\",,,\"12345678901\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\n\"001\",888,\"\",,,,,,,1,[[,\"(\\\\d{3})(\\\\d{3})(\\\\d{5})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"\\\\d{11}\",\"\\\\d{11}\",,,\"12345678901\"],1,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"]],979:[,[,,\"\\\\d{9}\",\"\\\\d{9}\",,,\"123456789\"],[,,\"NA\",\"NA\",,,\"123456789\"],[,,\"NA\",\"NA\",,,\"123456789\"],[,,\"NA\",\"NA\"],[,,\"\\\\d{9}\",\"\\\\d{9}\",,,\"123456789\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],\"001\",979,\"\",,,,,,,1,[[,\"(\\\\d)(\\\\d{4})(\\\\d{4})\",\"$1 $2 $3\",,\"\",\"\",0]],,[,,\"NA\",\"NA\"],,,[,,\"NA\",\"NA\"],[,,\"NA\",\"NA\"],1,[,,\"NA\",\"NA\"],[,,\"NA\",\n\"NA\"]]};/*\n\n Protocol Buffer 2 Copyright 2008 Google Inc.\n All other code copyright its respective owners.\n Copyright (C) 2010 The Libphonenumber Authors\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\ni18n.phonenumbers.PhoneNumber=function(){goog.proto2.Message.apply(this)};goog.inherits(i18n.phonenumbers.PhoneNumber,goog.proto2.Message);i18n.phonenumbers.PhoneNumber.prototype.getCountryCode=function(){return this.get$Value(1)};i18n.phonenumbers.PhoneNumber.prototype.getCountryCodeOrDefault=function(){return this.get$ValueOrDefault(1)};i18n.phonenumbers.PhoneNumber.prototype.setCountryCode=function(a){this.set$Value(1,a)};i18n.phonenumbers.PhoneNumber.prototype.hasCountryCode=function(){return this.has$Value(1)};\ni18n.phonenumbers.PhoneNumber.prototype.countryCodeCount=function(){return this.count$Values(1)};i18n.phonenumbers.PhoneNumber.prototype.clearCountryCode=function(){this.clear$Field(1)};i18n.phonenumbers.PhoneNumber.prototype.getNationalNumber=function(){return this.get$Value(2)};i18n.phonenumbers.PhoneNumber.prototype.getNationalNumberOrDefault=function(){return this.get$ValueOrDefault(2)};i18n.phonenumbers.PhoneNumber.prototype.setNationalNumber=function(a){this.set$Value(2,a)};\ni18n.phonenumbers.PhoneNumber.prototype.hasNationalNumber=function(){return this.has$Value(2)};i18n.phonenumbers.PhoneNumber.prototype.nationalNumberCount=function(){return this.count$Values(2)};i18n.phonenumbers.PhoneNumber.prototype.clearNationalNumber=function(){this.clear$Field(2)};i18n.phonenumbers.PhoneNumber.prototype.getExtension=function(){return this.get$Value(3)};i18n.phonenumbers.PhoneNumber.prototype.getExtensionOrDefault=function(){return this.get$ValueOrDefault(3)};\ni18n.phonenumbers.PhoneNumber.prototype.setExtension=function(a){this.set$Value(3,a)};i18n.phonenumbers.PhoneNumber.prototype.hasExtension=function(){return this.has$Value(3)};i18n.phonenumbers.PhoneNumber.prototype.extensionCount=function(){return this.count$Values(3)};i18n.phonenumbers.PhoneNumber.prototype.clearExtension=function(){this.clear$Field(3)};i18n.phonenumbers.PhoneNumber.prototype.getItalianLeadingZero=function(){return this.get$Value(4)};\ni18n.phonenumbers.PhoneNumber.prototype.getItalianLeadingZeroOrDefault=function(){return this.get$ValueOrDefault(4)};i18n.phonenumbers.PhoneNumber.prototype.setItalianLeadingZero=function(a){this.set$Value(4,a)};i18n.phonenumbers.PhoneNumber.prototype.hasItalianLeadingZero=function(){return this.has$Value(4)};i18n.phonenumbers.PhoneNumber.prototype.italianLeadingZeroCount=function(){return this.count$Values(4)};i18n.phonenumbers.PhoneNumber.prototype.clearItalianLeadingZero=function(){this.clear$Field(4)};\ni18n.phonenumbers.PhoneNumber.prototype.getRawInput=function(){return this.get$Value(5)};i18n.phonenumbers.PhoneNumber.prototype.getRawInputOrDefault=function(){return this.get$ValueOrDefault(5)};i18n.phonenumbers.PhoneNumber.prototype.setRawInput=function(a){this.set$Value(5,a)};i18n.phonenumbers.PhoneNumber.prototype.hasRawInput=function(){return this.has$Value(5)};i18n.phonenumbers.PhoneNumber.prototype.rawInputCount=function(){return this.count$Values(5)};\ni18n.phonenumbers.PhoneNumber.prototype.clearRawInput=function(){this.clear$Field(5)};i18n.phonenumbers.PhoneNumber.prototype.getCountryCodeSource=function(){return this.get$Value(6)};i18n.phonenumbers.PhoneNumber.prototype.getCountryCodeSourceOrDefault=function(){return this.get$ValueOrDefault(6)};i18n.phonenumbers.PhoneNumber.prototype.setCountryCodeSource=function(a){this.set$Value(6,a)};i18n.phonenumbers.PhoneNumber.prototype.hasCountryCodeSource=function(){return this.has$Value(6)};\ni18n.phonenumbers.PhoneNumber.prototype.countryCodeSourceCount=function(){return this.count$Values(6)};i18n.phonenumbers.PhoneNumber.prototype.clearCountryCodeSource=function(){this.clear$Field(6)};i18n.phonenumbers.PhoneNumber.prototype.getPreferredDomesticCarrierCode=function(){return this.get$Value(7)};i18n.phonenumbers.PhoneNumber.prototype.getPreferredDomesticCarrierCodeOrDefault=function(){return this.get$ValueOrDefault(7)};\ni18n.phonenumbers.PhoneNumber.prototype.setPreferredDomesticCarrierCode=function(a){this.set$Value(7,a)};i18n.phonenumbers.PhoneNumber.prototype.hasPreferredDomesticCarrierCode=function(){return this.has$Value(7)};i18n.phonenumbers.PhoneNumber.prototype.preferredDomesticCarrierCodeCount=function(){return this.count$Values(7)};i18n.phonenumbers.PhoneNumber.prototype.clearPreferredDomesticCarrierCode=function(){this.clear$Field(7)};\ni18n.phonenumbers.PhoneNumber.CountryCodeSource={FROM_NUMBER_WITH_PLUS_SIGN:1,FROM_NUMBER_WITH_IDD:5,FROM_NUMBER_WITHOUT_PLUS_SIGN:10,FROM_DEFAULT_COUNTRY:20};\ngoog.proto2.Message.set$Metadata(i18n.phonenumbers.PhoneNumber,{\"0\":{name:\"PhoneNumber\",fullName:\"i18n.phonenumbers.PhoneNumber\"},1:{name:\"country_code\",required:!0,fieldType:goog.proto2.Message.FieldType.INT32,type:Number},2:{name:\"national_number\",required:!0,fieldType:goog.proto2.Message.FieldType.UINT64,type:Number},3:{name:\"extension\",fieldType:goog.proto2.Message.FieldType.STRING,type:String},4:{name:\"italian_leading_zero\",fieldType:goog.proto2.Message.FieldType.BOOL,type:Boolean},5:{name:\"raw_input\",\nfieldType:goog.proto2.Message.FieldType.STRING,type:String},6:{name:\"country_code_source\",fieldType:goog.proto2.Message.FieldType.ENUM,defaultValue:i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_NUMBER_WITH_PLUS_SIGN,type:i18n.phonenumbers.PhoneNumber.CountryCodeSource},7:{name:\"preferred_domestic_carrier_code\",fieldType:goog.proto2.Message.FieldType.STRING,type:String}});/*\n\n Copyright (C) 2010 The Libphonenumber Authors.\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\ni18n.phonenumbers.PhoneNumberUtil=function(){this.regionToMetadataMap={}};goog.addSingletonGetter(i18n.phonenumbers.PhoneNumberUtil);i18n.phonenumbers.Error={INVALID_COUNTRY_CODE:\"Invalid country calling code\",NOT_A_NUMBER:\"The string supplied did not seem to be a phone number\",TOO_SHORT_AFTER_IDD:\"Phone number too short after IDD\",TOO_SHORT_NSN:\"The string supplied is too short to be a phone number\",TOO_LONG:\"The string supplied is too long to be a phone number\"};\ni18n.phonenumbers.PhoneNumberUtil.NANPA_COUNTRY_CODE_=1;i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_=2;i18n.phonenumbers.PhoneNumberUtil.MAX_LENGTH_FOR_NSN_=16;i18n.phonenumbers.PhoneNumberUtil.MAX_LENGTH_COUNTRY_CODE_=3;i18n.phonenumbers.PhoneNumberUtil.MAX_INPUT_STRING_LENGTH_=250;i18n.phonenumbers.PhoneNumberUtil.UNKNOWN_REGION_=\"ZZ\";i18n.phonenumbers.PhoneNumberUtil.COLOMBIA_MOBILE_TO_FIXED_LINE_PREFIX_=\"3\";i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN=\"+\";\ni18n.phonenumbers.PhoneNumberUtil.STAR_SIGN_=\"*\";i18n.phonenumbers.PhoneNumberUtil.RFC3966_EXTN_PREFIX_=\";ext=\";i18n.phonenumbers.PhoneNumberUtil.RFC3966_PREFIX_=\"tel:\";i18n.phonenumbers.PhoneNumberUtil.RFC3966_PHONE_CONTEXT_=\";phone-context=\";i18n.phonenumbers.PhoneNumberUtil.RFC3966_ISDN_SUBADDRESS_=\";isub=\";\ni18n.phonenumbers.PhoneNumberUtil.DIGIT_MAPPINGS={\"0\":\"0\",1:\"1\",2:\"2\",3:\"3\",4:\"4\",5:\"5\",6:\"6\",7:\"7\",8:\"8\",9:\"9\",\"\\uff10\":\"0\",\"\\uff11\":\"1\",\"\\uff12\":\"2\",\"\\uff13\":\"3\",\"\\uff14\":\"4\",\"\\uff15\":\"5\",\"\\uff16\":\"6\",\"\\uff17\":\"7\",\"\\uff18\":\"8\",\"\\uff19\":\"9\",\"\\u0660\":\"0\",\"\\u0661\":\"1\",\"\\u0662\":\"2\",\"\\u0663\":\"3\",\"\\u0664\":\"4\",\"\\u0665\":\"5\",\"\\u0666\":\"6\",\"\\u0667\":\"7\",\"\\u0668\":\"8\",\"\\u0669\":\"9\",\"\\u06f0\":\"0\",\"\\u06f1\":\"1\",\"\\u06f2\":\"2\",\"\\u06f3\":\"3\",\"\\u06f4\":\"4\",\"\\u06f5\":\"5\",\"\\u06f6\":\"6\",\"\\u06f7\":\"7\",\"\\u06f8\":\"8\",\"\\u06f9\":\"9\"};\ni18n.phonenumbers.PhoneNumberUtil.DIALLABLE_CHAR_MAPPINGS_={\"0\":\"0\",1:\"1\",2:\"2\",3:\"3\",4:\"4\",5:\"5\",6:\"6\",7:\"7\",8:\"8\",9:\"9\",\"+\":i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN,\"*\":\"*\"};i18n.phonenumbers.PhoneNumberUtil.ALPHA_MAPPINGS_={A:\"2\",B:\"2\",C:\"2\",D:\"3\",E:\"3\",F:\"3\",G:\"4\",H:\"4\",I:\"4\",J:\"5\",K:\"5\",L:\"5\",M:\"6\",N:\"6\",O:\"6\",P:\"7\",Q:\"7\",R:\"7\",S:\"7\",T:\"8\",U:\"8\",V:\"8\",W:\"9\",X:\"9\",Y:\"9\",Z:\"9\"};\ni18n.phonenumbers.PhoneNumberUtil.ALL_NORMALIZATION_MAPPINGS_={\"0\":\"0\",1:\"1\",2:\"2\",3:\"3\",4:\"4\",5:\"5\",6:\"6\",7:\"7\",8:\"8\",9:\"9\",\"\\uff10\":\"0\",\"\\uff11\":\"1\",\"\\uff12\":\"2\",\"\\uff13\":\"3\",\"\\uff14\":\"4\",\"\\uff15\":\"5\",\"\\uff16\":\"6\",\"\\uff17\":\"7\",\"\\uff18\":\"8\",\"\\uff19\":\"9\",\"\\u0660\":\"0\",\"\\u0661\":\"1\",\"\\u0662\":\"2\",\"\\u0663\":\"3\",\"\\u0664\":\"4\",\"\\u0665\":\"5\",\"\\u0666\":\"6\",\"\\u0667\":\"7\",\"\\u0668\":\"8\",\"\\u0669\":\"9\",\"\\u06f0\":\"0\",\"\\u06f1\":\"1\",\"\\u06f2\":\"2\",\"\\u06f3\":\"3\",\"\\u06f4\":\"4\",\"\\u06f5\":\"5\",\"\\u06f6\":\"6\",\"\\u06f7\":\"7\",\"\\u06f8\":\"8\",\n\"\\u06f9\":\"9\",A:\"2\",B:\"2\",C:\"2\",D:\"3\",E:\"3\",F:\"3\",G:\"4\",H:\"4\",I:\"4\",J:\"5\",K:\"5\",L:\"5\",M:\"6\",N:\"6\",O:\"6\",P:\"7\",Q:\"7\",R:\"7\",S:\"7\",T:\"8\",U:\"8\",V:\"8\",W:\"9\",X:\"9\",Y:\"9\",Z:\"9\"};\ni18n.phonenumbers.PhoneNumberUtil.ALL_PLUS_NUMBER_GROUPING_SYMBOLS_={\"0\":\"0\",1:\"1\",2:\"2\",3:\"3\",4:\"4\",5:\"5\",6:\"6\",7:\"7\",8:\"8\",9:\"9\",A:\"A\",B:\"B\",C:\"C\",D:\"D\",E:\"E\",F:\"F\",G:\"G\",H:\"H\",I:\"I\",J:\"J\",K:\"K\",L:\"L\",M:\"M\",N:\"N\",O:\"O\",P:\"P\",Q:\"Q\",R:\"R\",S:\"S\",T:\"T\",U:\"U\",V:\"V\",W:\"W\",X:\"X\",Y:\"Y\",Z:\"Z\",a:\"A\",b:\"B\",c:\"C\",d:\"D\",e:\"E\",f:\"F\",g:\"G\",h:\"H\",i:\"I\",j:\"J\",k:\"K\",l:\"L\",m:\"M\",n:\"N\",o:\"O\",p:\"P\",q:\"Q\",r:\"R\",s:\"S\",t:\"T\",u:\"U\",v:\"V\",w:\"W\",x:\"X\",y:\"Y\",z:\"Z\",\"-\":\"-\",\"\\uff0d\":\"-\",\"\\u2010\":\"-\",\"\\u2011\":\"-\",\"\\u2012\":\"-\",\n\"\\u2013\":\"-\",\"\\u2014\":\"-\",\"\\u2015\":\"-\",\"\\u2212\":\"-\",\"/\":\"/\",\"\\uff0f\":\"/\",\" \":\" \",\"\\u3000\":\" \",\"\\u2060\":\" \",\".\":\".\",\"\\uff0e\":\".\"};i18n.phonenumbers.PhoneNumberUtil.UNIQUE_INTERNATIONAL_PREFIX_=/[\\d]+(?:[~\\u2053\\u223C\\uFF5E][\\d]+)?/;i18n.phonenumbers.PhoneNumberUtil.VALID_PUNCTUATION=\"-x\\u2010-\\u2015\\u2212\\u30fc\\uff0d-\\uff0f \\u00a0\\u00ad\\u200b\\u2060\\u3000()\\uff08\\uff09\\uff3b\\uff3d.\\\\[\\\\]/~\\u2053\\u223c\\uff5e\";i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_=\"0-9\\uff10-\\uff19\\u0660-\\u0669\\u06f0-\\u06f9\";\ni18n.phonenumbers.PhoneNumberUtil.VALID_ALPHA_=\"A-Za-z\";i18n.phonenumbers.PhoneNumberUtil.PLUS_CHARS_=\"+\\uff0b\";i18n.phonenumbers.PhoneNumberUtil.PLUS_CHARS_PATTERN=RegExp(\"[\"+i18n.phonenumbers.PhoneNumberUtil.PLUS_CHARS_+\"]+\");i18n.phonenumbers.PhoneNumberUtil.LEADING_PLUS_CHARS_PATTERN_=RegExp(\"^[\"+i18n.phonenumbers.PhoneNumberUtil.PLUS_CHARS_+\"]+\");i18n.phonenumbers.PhoneNumberUtil.SEPARATOR_PATTERN_=\"[\"+i18n.phonenumbers.PhoneNumberUtil.VALID_PUNCTUATION+\"]+\";\ni18n.phonenumbers.PhoneNumberUtil.CAPTURING_DIGIT_PATTERN=RegExp(\"([\"+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+\"])\");i18n.phonenumbers.PhoneNumberUtil.VALID_START_CHAR_PATTERN_=RegExp(\"[\"+i18n.phonenumbers.PhoneNumberUtil.PLUS_CHARS_+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+\"]\");i18n.phonenumbers.PhoneNumberUtil.SECOND_NUMBER_START_PATTERN_=/[\\\\\\/] *x/;\ni18n.phonenumbers.PhoneNumberUtil.UNWANTED_END_CHAR_PATTERN_=RegExp(\"[^\"+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+i18n.phonenumbers.PhoneNumberUtil.VALID_ALPHA_+\"#]+$\");i18n.phonenumbers.PhoneNumberUtil.VALID_ALPHA_PHONE_PATTERN_=/(?:.*?[A-Za-z]){3}.*/;i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_PHONE_NUMBER_PATTERN_=\"[\"+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+\"]{\"+i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_+\"}\";\ni18n.phonenumbers.PhoneNumberUtil.VALID_PHONE_NUMBER_=\"[\"+i18n.phonenumbers.PhoneNumberUtil.PLUS_CHARS_+\"]*(?:[\"+i18n.phonenumbers.PhoneNumberUtil.VALID_PUNCTUATION+i18n.phonenumbers.PhoneNumberUtil.STAR_SIGN_+\"]*[\"+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+\"]){3,}[\"+i18n.phonenumbers.PhoneNumberUtil.VALID_PUNCTUATION+i18n.phonenumbers.PhoneNumberUtil.STAR_SIGN_+i18n.phonenumbers.PhoneNumberUtil.VALID_ALPHA_+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+\"]*\";\ni18n.phonenumbers.PhoneNumberUtil.DEFAULT_EXTN_PREFIX_=\" ext. \";i18n.phonenumbers.PhoneNumberUtil.CAPTURING_EXTN_DIGITS_=\"([\"+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+\"]{1,7})\";\ni18n.phonenumbers.PhoneNumberUtil.EXTN_PATTERNS_FOR_PARSING_=i18n.phonenumbers.PhoneNumberUtil.RFC3966_EXTN_PREFIX_+i18n.phonenumbers.PhoneNumberUtil.CAPTURING_EXTN_DIGITS_+\"|[ \\u00a0\\\\t,]*(?:e?xt(?:ensi(?:o\\u0301?|\\u00f3))?n?|\\uff45?\\uff58\\uff54\\uff4e?|[,x\\uff58#\\uff03~\\uff5e]|int|anexo|\\uff49\\uff4e\\uff54)[:\\\\.\\uff0e]?[ \\u00a0\\\\t,-]*\"+i18n.phonenumbers.PhoneNumberUtil.CAPTURING_EXTN_DIGITS_+\"#?|[- ]+([\"+i18n.phonenumbers.PhoneNumberUtil.VALID_DIGITS_+\"]{1,5})#\";\ni18n.phonenumbers.PhoneNumberUtil.EXTN_PATTERN_=RegExp(\"(?:\"+i18n.phonenumbers.PhoneNumberUtil.EXTN_PATTERNS_FOR_PARSING_+\")$\",\"i\");i18n.phonenumbers.PhoneNumberUtil.VALID_PHONE_NUMBER_PATTERN_=RegExp(\"^\"+i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_PHONE_NUMBER_PATTERN_+\"$|^\"+i18n.phonenumbers.PhoneNumberUtil.VALID_PHONE_NUMBER_+\"(?:\"+i18n.phonenumbers.PhoneNumberUtil.EXTN_PATTERNS_FOR_PARSING_+\")?$\",\"i\");i18n.phonenumbers.PhoneNumberUtil.NON_DIGITS_PATTERN_=/\\D+/;\ni18n.phonenumbers.PhoneNumberUtil.FIRST_GROUP_PATTERN_=/(\\$\\d)/;i18n.phonenumbers.PhoneNumberUtil.NP_PATTERN_=/\\$NP/;i18n.phonenumbers.PhoneNumberUtil.FG_PATTERN_=/\\$FG/;i18n.phonenumbers.PhoneNumberUtil.CC_PATTERN_=/\\$CC/;i18n.phonenumbers.PhoneNumberUtil.FIRST_GROUP_ONLY_PREFIX_PATTERN_=/^\\(?\\$1\\)?$/;i18n.phonenumbers.PhoneNumberUtil.REGION_CODE_FOR_NON_GEO_ENTITY=\"001\";i18n.phonenumbers.PhoneNumberFormat={E164:0,INTERNATIONAL:1,NATIONAL:2,RFC3966:3};\ni18n.phonenumbers.PhoneNumberType={FIXED_LINE:0,MOBILE:1,FIXED_LINE_OR_MOBILE:2,TOLL_FREE:3,PREMIUM_RATE:4,SHARED_COST:5,VOIP:6,PERSONAL_NUMBER:7,PAGER:8,UAN:9,VOICEMAIL:10,UNKNOWN:-1};i18n.phonenumbers.PhoneNumberUtil.MatchType={NOT_A_NUMBER:0,NO_MATCH:1,SHORT_NSN_MATCH:2,NSN_MATCH:3,EXACT_MATCH:4};i18n.phonenumbers.PhoneNumberUtil.ValidationResult={IS_POSSIBLE:0,INVALID_COUNTRY_CODE:1,TOO_SHORT:2,TOO_LONG:3};\ni18n.phonenumbers.PhoneNumberUtil.extractPossibleNumber=function(a){var b=a.search(i18n.phonenumbers.PhoneNumberUtil.VALID_START_CHAR_PATTERN_);0<=b?(a=a.substring(b),a=a.replace(i18n.phonenumbers.PhoneNumberUtil.UNWANTED_END_CHAR_PATTERN_,\"\"),b=a.search(i18n.phonenumbers.PhoneNumberUtil.SECOND_NUMBER_START_PATTERN_),0<=b&&(a=a.substring(0,b))):a=\"\";return a};\ni18n.phonenumbers.PhoneNumberUtil.isViablePhoneNumber=function(a){return a.length<i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_?!1:i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(i18n.phonenumbers.PhoneNumberUtil.VALID_PHONE_NUMBER_PATTERN_,a)};\ni18n.phonenumbers.PhoneNumberUtil.normalize=function(a){return i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(i18n.phonenumbers.PhoneNumberUtil.VALID_ALPHA_PHONE_PATTERN_,a)?i18n.phonenumbers.PhoneNumberUtil.normalizeHelper_(a,i18n.phonenumbers.PhoneNumberUtil.ALL_NORMALIZATION_MAPPINGS_,!0):i18n.phonenumbers.PhoneNumberUtil.normalizeDigitsOnly(a)};i18n.phonenumbers.PhoneNumberUtil.normalizeSB_=function(a){var b=i18n.phonenumbers.PhoneNumberUtil.normalize(a.toString());a.clear();a.append(b)};\ni18n.phonenumbers.PhoneNumberUtil.normalizeDigitsOnly=function(a){return i18n.phonenumbers.PhoneNumberUtil.normalizeHelper_(a,i18n.phonenumbers.PhoneNumberUtil.DIGIT_MAPPINGS,!0)};i18n.phonenumbers.PhoneNumberUtil.convertAlphaCharactersInNumber=function(a){return i18n.phonenumbers.PhoneNumberUtil.normalizeHelper_(a,i18n.phonenumbers.PhoneNumberUtil.ALL_NORMALIZATION_MAPPINGS_,!1)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getLengthOfGeographicalAreaCode=function(a){var b=this.getMetadataForRegion(this.getRegionCodeForNumber(a));return null==b||!b.hasNationalPrefix()&&!a.hasItalianLeadingZero()||!this.isNumberGeographical(a)?0:this.getLengthOfNationalDestinationCode(a)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getLengthOfNationalDestinationCode=function(a){var b;a.hasExtension()?(b=a.clone(),b.clearExtension()):b=a;b=this.format(b,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL).split(i18n.phonenumbers.PhoneNumberUtil.NON_DIGITS_PATTERN_);0==b[0].length&&b.shift();return 2>=b.length?0:\"AR\"==this.getRegionCodeForCountryCode(a.getCountryCodeOrDefault())&&this.getNumberType(a)==i18n.phonenumbers.PhoneNumberType.MOBILE?b[2].length+1:b[1].length};\ni18n.phonenumbers.PhoneNumberUtil.normalizeHelper_=function(a,b,c){for(var d=new goog.string.StringBuffer,e,f,g=a.length,h=0;h<g;++h)e=a.charAt(h),f=b[e.toUpperCase()],null!=f?d.append(f):c||d.append(e);return d.toString()};i18n.phonenumbers.PhoneNumberUtil.prototype.formattingRuleHasFirstGroupOnly=function(a){return i18n.phonenumbers.PhoneNumberUtil.FIRST_GROUP_ONLY_PREFIX_PATTERN_.test(a)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isNumberGeographical=function(a){a=this.getNumberType(a);return a==i18n.phonenumbers.PhoneNumberType.FIXED_LINE||a==i18n.phonenumbers.PhoneNumberType.FIXED_LINE_OR_MOBILE};i18n.phonenumbers.PhoneNumberUtil.prototype.isValidRegionCode_=function(a){return null!=a&&isNaN(a)&&a.toUpperCase()in i18n.phonenumbers.metadata.countryToMetadata};i18n.phonenumbers.PhoneNumberUtil.prototype.hasValidCountryCallingCode_=function(a){return a in i18n.phonenumbers.metadata.countryCodeToRegionCodeMap};\ni18n.phonenumbers.PhoneNumberUtil.prototype.format=function(a,b){if(0==a.getNationalNumber()&&a.hasRawInput()){var c=a.getRawInputOrDefault();if(0<c.length)return c}var c=a.getCountryCodeOrDefault(),d=this.getNationalSignificantNumber(a);if(b==i18n.phonenumbers.PhoneNumberFormat.E164)return this.prefixNumberWithCountryCallingCode_(c,i18n.phonenumbers.PhoneNumberFormat.E164,d,\"\");if(!this.hasValidCountryCallingCode_(c))return d;var e=this.getRegionCodeForCountryCode(c),f=this.getMetadataForRegionOrCallingCode_(c,\ne),e=this.maybeGetFormattedExtension_(a,f,b),d=this.formatNsn_(d,f,b);return this.prefixNumberWithCountryCallingCode_(c,b,d,e)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatByPattern=function(a,b,c){var d=a.getCountryCodeOrDefault(),e=this.getNationalSignificantNumber(a);if(!this.hasValidCountryCallingCode_(d))return e;var f=this.getRegionCodeForCountryCode(d),f=this.getMetadataForRegionOrCallingCode_(d,f),g=\"\",g=this.chooseFormattingPatternForNumber_(c,e);if(null==g)g=e;else{c=g.clone();g=g.getNationalPrefixFormattingRuleOrDefault();if(0<g.length){var h=f.getNationalPrefixOrDefault();0<h.length?(g=g.replace(i18n.phonenumbers.PhoneNumberUtil.NP_PATTERN_,\nh).replace(i18n.phonenumbers.PhoneNumberUtil.FG_PATTERN_,\"$1\"),c.setNationalPrefixFormattingRule(g)):c.clearNationalPrefixFormattingRule()}g=this.formatNsnUsingPattern_(e,c,b)}a=this.maybeGetFormattedExtension_(a,f,b);return this.prefixNumberWithCountryCallingCode_(d,b,g,a)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatNationalNumberWithCarrierCode=function(a,b){var c=a.getCountryCodeOrDefault(),d=this.getNationalSignificantNumber(a);if(!this.hasValidCountryCallingCode_(c))return d;var e=this.getRegionCodeForCountryCode(c),f=this.getMetadataForRegionOrCallingCode_(c,e),e=this.maybeGetFormattedExtension_(a,f,i18n.phonenumbers.PhoneNumberFormat.NATIONAL),d=this.formatNsn_(d,f,i18n.phonenumbers.PhoneNumberFormat.NATIONAL,b);return this.prefixNumberWithCountryCallingCode_(c,\ni18n.phonenumbers.PhoneNumberFormat.NATIONAL,d,e)};i18n.phonenumbers.PhoneNumberUtil.prototype.getMetadataForRegionOrCallingCode_=function(a,b){return i18n.phonenumbers.PhoneNumberUtil.REGION_CODE_FOR_NON_GEO_ENTITY==b?this.getMetadataForNonGeographicalRegion(a):this.getMetadataForRegion(b)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatNationalNumberWithPreferredCarrierCode=function(a,b){return this.formatNationalNumberWithCarrierCode(a,a.hasPreferredDomesticCarrierCode()?a.getPreferredDomesticCarrierCodeOrDefault():b)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatNumberForMobileDialing=function(a,b,c){var d=a.getCountryCodeOrDefault();if(!this.hasValidCountryCallingCode_(d))return a.hasRawInput()?a.getRawInputOrDefault():\"\";var e=\"\";a=a.clone();a.clearExtension();var f=this.getRegionCodeForCountryCode(d);if(b==f)b=this.getNumberType(a),e=b==i18n.phonenumbers.PhoneNumberType.FIXED_LINE||b==i18n.phonenumbers.PhoneNumberType.MOBILE||b==i18n.phonenumbers.PhoneNumberType.FIXED_LINE_OR_MOBILE,e=\"CO\"==f&&b==i18n.phonenumbers.PhoneNumberType.FIXED_LINE?\nthis.formatNationalNumberWithCarrierCode(a,i18n.phonenumbers.PhoneNumberUtil.COLOMBIA_MOBILE_TO_FIXED_LINE_PREFIX_):\"BR\"==f&&e?a.hasPreferredDomesticCarrierCode()?this.formatNationalNumberWithPreferredCarrierCode(a,\"\"):\"\":\"HU\"==f?this.getNddPrefixForRegion(f,!0)+\" \"+this.format(a,i18n.phonenumbers.PhoneNumberFormat.NATIONAL):(d==i18n.phonenumbers.PhoneNumberUtil.NANPA_COUNTRY_CODE_||f==i18n.phonenumbers.PhoneNumberUtil.REGION_CODE_FOR_NON_GEO_ENTITY||(\"MX\"==f||\"CL\"==f)&&e)&&this.canBeInternationallyDialled(a)?\nthis.format(a,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL):this.format(a,i18n.phonenumbers.PhoneNumberFormat.NATIONAL);else if(this.canBeInternationallyDialled(a))return c?this.format(a,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL):this.format(a,i18n.phonenumbers.PhoneNumberFormat.E164);return c?e:i18n.phonenumbers.PhoneNumberUtil.normalizeHelper_(e,i18n.phonenumbers.PhoneNumberUtil.DIALLABLE_CHAR_MAPPINGS_,!0)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatOutOfCountryCallingNumber=function(a,b){if(!this.isValidRegionCode_(b))return this.format(a,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL);var c=a.getCountryCodeOrDefault(),d=this.getNationalSignificantNumber(a);if(!this.hasValidCountryCallingCode_(c))return d;if(c==i18n.phonenumbers.PhoneNumberUtil.NANPA_COUNTRY_CODE_){if(this.isNANPACountry(b))return c+\" \"+this.format(a,i18n.phonenumbers.PhoneNumberFormat.NATIONAL)}else if(c==this.getCountryCodeForValidRegion_(b))return this.format(a,\ni18n.phonenumbers.PhoneNumberFormat.NATIONAL);var e=this.getMetadataForRegion(b),f=e.getInternationalPrefixOrDefault(),g=\"\";i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(i18n.phonenumbers.PhoneNumberUtil.UNIQUE_INTERNATIONAL_PREFIX_,f)?g=f:e.hasPreferredInternationalPrefix()&&(g=e.getPreferredInternationalPrefixOrDefault());e=this.getRegionCodeForCountryCode(c);e=this.getMetadataForRegionOrCallingCode_(c,e);d=this.formatNsn_(d,e,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL);e=this.maybeGetFormattedExtension_(a,\ne,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL);return 0<g.length?g+\" \"+c+\" \"+d+e:this.prefixNumberWithCountryCallingCode_(c,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL,d,e)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatInOriginalFormat=function(a,b){if(a.hasRawInput()&&(this.hasUnexpectedItalianLeadingZero_(a)||!this.hasFormattingPatternForNumber_(a)))return a.getRawInputOrDefault();if(!a.hasCountryCodeSource())return this.format(a,i18n.phonenumbers.PhoneNumberFormat.NATIONAL);var c;switch(a.getCountryCodeSource()){case i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_NUMBER_WITH_PLUS_SIGN:c=this.format(a,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL);break;\ncase i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_NUMBER_WITH_IDD:c=this.formatOutOfCountryCallingNumber(a,b);break;case i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_NUMBER_WITHOUT_PLUS_SIGN:c=this.format(a,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL).substring(1);break;default:var d=this.getRegionCodeForCountryCode(a.getCountryCodeOrDefault()),e=this.getNddPrefixForRegion(d,!0);c=this.format(a,i18n.phonenumbers.PhoneNumberFormat.NATIONAL);if(null==e||0==e.length)break;if(this.rawInputContainsNationalPrefix_(a.getRawInputOrDefault(),\ne,d))break;d=this.getMetadataForRegion(d);e=this.getNationalSignificantNumber(a);d=this.chooseFormattingPatternForNumber_(d.numberFormatArray(),e);if(null==d)break;var e=d.getNationalPrefixFormattingRuleOrDefault(),f=e.indexOf(\"$1\");if(0>=f)break;e=e.substring(0,f);e=i18n.phonenumbers.PhoneNumberUtil.normalizeDigitsOnly(e);if(0==e.length)break;c=d.clone();c.clearNationalPrefixFormattingRule();c=this.formatByPattern(a,i18n.phonenumbers.PhoneNumberFormat.NATIONAL,[c])}d=a.getRawInputOrDefault();null!=\nc&&0<d.length&&(e=i18n.phonenumbers.PhoneNumberUtil.normalizeHelper_(c,i18n.phonenumbers.PhoneNumberUtil.DIALLABLE_CHAR_MAPPINGS_,!0),f=i18n.phonenumbers.PhoneNumberUtil.normalizeHelper_(d,i18n.phonenumbers.PhoneNumberUtil.DIALLABLE_CHAR_MAPPINGS_,!0),e!=f&&(c=d));return c};\ni18n.phonenumbers.PhoneNumberUtil.prototype.rawInputContainsNationalPrefix_=function(a,b,c){a=i18n.phonenumbers.PhoneNumberUtil.normalizeDigitsOnly(a);if(goog.string.startsWith(a,b))try{return this.isValidNumber(this.parse(a.substring(b.length),c))}catch(d){}return!1};i18n.phonenumbers.PhoneNumberUtil.prototype.hasUnexpectedItalianLeadingZero_=function(a){return a.hasItalianLeadingZero()&&!this.isLeadingZeroPossible(a.getCountryCodeOrDefault())};\ni18n.phonenumbers.PhoneNumberUtil.prototype.hasFormattingPatternForNumber_=function(a){var b=a.getCountryCodeOrDefault(),c=this.getRegionCodeForCountryCode(b),b=this.getMetadataForRegionOrCallingCode_(b,c);if(null==b)return!1;a=this.getNationalSignificantNumber(a);return null!=this.chooseFormattingPatternForNumber_(b.numberFormatArray(),a)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatOutOfCountryKeepingAlphaChars=function(a,b){var c=a.getRawInputOrDefault();if(0==c.length)return this.formatOutOfCountryCallingNumber(a,b);var d=a.getCountryCodeOrDefault();if(!this.hasValidCountryCallingCode_(d))return c;var c=i18n.phonenumbers.PhoneNumberUtil.normalizeHelper_(c,i18n.phonenumbers.PhoneNumberUtil.ALL_PLUS_NUMBER_GROUPING_SYMBOLS_,!0),e=this.getNationalSignificantNumber(a);if(3<e.length){var f=c.indexOf(e.substring(0,3));-1!=f&&(c=\nc.substring(f))}f=this.getMetadataForRegion(b);if(d==i18n.phonenumbers.PhoneNumberUtil.NANPA_COUNTRY_CODE_){if(this.isNANPACountry(b))return d+\" \"+c}else if(null!=f&&d==this.getCountryCodeForValidRegion_(b)){d=this.chooseFormattingPatternForNumber_(f.numberFormatArray(),e);if(null==d)return c;d=d.clone();d.setPattern(\"(\\\\d+)(.*)\");d.setFormat(\"$1$2\");return this.formatNsnUsingPattern_(c,d,i18n.phonenumbers.PhoneNumberFormat.NATIONAL)}e=\"\";null!=f&&(e=f.getInternationalPrefixOrDefault(),e=i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(i18n.phonenumbers.PhoneNumberUtil.UNIQUE_INTERNATIONAL_PREFIX_,\ne)?e:f.getPreferredInternationalPrefixOrDefault());f=this.getRegionCodeForCountryCode(d);f=this.getMetadataForRegionOrCallingCode_(d,f);f=this.maybeGetFormattedExtension_(a,f,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL);return 0<e.length?e+\" \"+d+\" \"+c+f:this.prefixNumberWithCountryCallingCode_(d,i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL,c,f)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getNationalSignificantNumber=function(a){var b=\"\"+a.getNationalNumber();return a.hasItalianLeadingZero()&&a.getItalianLeadingZero()?\"0\"+b:b};\ni18n.phonenumbers.PhoneNumberUtil.prototype.prefixNumberWithCountryCallingCode_=function(a,b,c,d){switch(b){case i18n.phonenumbers.PhoneNumberFormat.E164:return i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN+a+c+d;case i18n.phonenumbers.PhoneNumberFormat.INTERNATIONAL:return i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN+a+\" \"+c+d;case i18n.phonenumbers.PhoneNumberFormat.RFC3966:return i18n.phonenumbers.PhoneNumberUtil.RFC3966_PREFIX_+i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN+a+\"-\"+c+d;default:return c+\nd}};i18n.phonenumbers.PhoneNumberUtil.prototype.formatNsn_=function(a,b,c,d){b=0==b.intlNumberFormatArray().length||c==i18n.phonenumbers.PhoneNumberFormat.NATIONAL?b.numberFormatArray():b.intlNumberFormatArray();b=this.chooseFormattingPatternForNumber_(b,a);return null==b?a:this.formatNsnUsingPattern_(a,b,c,d)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.chooseFormattingPatternForNumber_=function(a,b){for(var c,d=a.length,e=0;e<d;++e){c=a[e];var f=c.leadingDigitsPatternCount();if(0==f||0==b.search(c.getLeadingDigitsPattern(f-1)))if(f=RegExp(c.getPattern()),i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(f,b))return c}return null};\ni18n.phonenumbers.PhoneNumberUtil.prototype.formatNsnUsingPattern_=function(a,b,c,d){var e=b.getFormatOrDefault(),f=RegExp(b.getPattern()),g=b.getDomesticCarrierCodeFormattingRuleOrDefault(),h=\"\";c==i18n.phonenumbers.PhoneNumberFormat.NATIONAL&&null!=d&&0<d.length&&0<g.length?(b=g.replace(i18n.phonenumbers.PhoneNumberUtil.CC_PATTERN_,d),e=e.replace(i18n.phonenumbers.PhoneNumberUtil.FIRST_GROUP_PATTERN_,b),h=a.replace(f,e)):(b=b.getNationalPrefixFormattingRuleOrDefault(),h=c==i18n.phonenumbers.PhoneNumberFormat.NATIONAL&&\nnull!=b&&0<b.length?a.replace(f,e.replace(i18n.phonenumbers.PhoneNumberUtil.FIRST_GROUP_PATTERN_,b)):a.replace(f,e));c==i18n.phonenumbers.PhoneNumberFormat.RFC3966&&(h=h.replace(RegExp(\"^\"+i18n.phonenumbers.PhoneNumberUtil.SEPARATOR_PATTERN_),\"\"),h=h.replace(RegExp(i18n.phonenumbers.PhoneNumberUtil.SEPARATOR_PATTERN_,\"g\"),\"-\"));return h};i18n.phonenumbers.PhoneNumberUtil.prototype.getExampleNumber=function(a){return this.getExampleNumberForType(a,i18n.phonenumbers.PhoneNumberType.FIXED_LINE)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getExampleNumberForType=function(a,b){if(!this.isValidRegionCode_(a))return null;var c=this.getNumberDescByType_(this.getMetadataForRegion(a),b);try{if(c.hasExampleNumber())return this.parse(c.getExampleNumberOrDefault(),a)}catch(d){}return null};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getExampleNumberForNonGeoEntity=function(a){var b=this.getMetadataForNonGeographicalRegion(a);if(null!=b){b=b.getGeneralDesc();try{if(b.hasExampleNumber())return this.parse(\"+\"+a+b.getExampleNumber(),\"ZZ\")}catch(c){}}return null};\ni18n.phonenumbers.PhoneNumberUtil.prototype.maybeGetFormattedExtension_=function(a,b,c){return!a.hasExtension()||0==a.getExtension().length?\"\":c==i18n.phonenumbers.PhoneNumberFormat.RFC3966?i18n.phonenumbers.PhoneNumberUtil.RFC3966_EXTN_PREFIX_+a.getExtension():b.hasPreferredExtnPrefix()?b.getPreferredExtnPrefix()+a.getExtensionOrDefault():i18n.phonenumbers.PhoneNumberUtil.DEFAULT_EXTN_PREFIX_+a.getExtensionOrDefault()};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getNumberDescByType_=function(a,b){switch(b){case i18n.phonenumbers.PhoneNumberType.PREMIUM_RATE:return a.getPremiumRate();case i18n.phonenumbers.PhoneNumberType.TOLL_FREE:return a.getTollFree();case i18n.phonenumbers.PhoneNumberType.MOBILE:return a.getMobile();case i18n.phonenumbers.PhoneNumberType.FIXED_LINE:case i18n.phonenumbers.PhoneNumberType.FIXED_LINE_OR_MOBILE:return a.getFixedLine();case i18n.phonenumbers.PhoneNumberType.SHARED_COST:return a.getSharedCost();\ncase i18n.phonenumbers.PhoneNumberType.VOIP:return a.getVoip();case i18n.phonenumbers.PhoneNumberType.PERSONAL_NUMBER:return a.getPersonalNumber();case i18n.phonenumbers.PhoneNumberType.PAGER:return a.getPager();case i18n.phonenumbers.PhoneNumberType.UAN:return a.getUan();case i18n.phonenumbers.PhoneNumberType.VOICEMAIL:return a.getVoicemail();default:return a.getGeneralDesc()}};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getNumberType=function(a){var b=this.getRegionCodeForNumber(a),b=this.getMetadataForRegionOrCallingCode_(a.getCountryCodeOrDefault(),b);if(null==b)return i18n.phonenumbers.PhoneNumberType.UNKNOWN;a=this.getNationalSignificantNumber(a);return this.getNumberTypeHelper_(a,b)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getNumberTypeHelper_=function(a,b){var c=b.getGeneralDesc();return!c.hasNationalNumberPattern()||!this.isNumberMatchingDesc_(a,c)?i18n.phonenumbers.PhoneNumberType.UNKNOWN:this.isNumberMatchingDesc_(a,b.getPremiumRate())?i18n.phonenumbers.PhoneNumberType.PREMIUM_RATE:this.isNumberMatchingDesc_(a,b.getTollFree())?i18n.phonenumbers.PhoneNumberType.TOLL_FREE:this.isNumberMatchingDesc_(a,b.getSharedCost())?i18n.phonenumbers.PhoneNumberType.SHARED_COST:this.isNumberMatchingDesc_(a,\nb.getVoip())?i18n.phonenumbers.PhoneNumberType.VOIP:this.isNumberMatchingDesc_(a,b.getPersonalNumber())?i18n.phonenumbers.PhoneNumberType.PERSONAL_NUMBER:this.isNumberMatchingDesc_(a,b.getPager())?i18n.phonenumbers.PhoneNumberType.PAGER:this.isNumberMatchingDesc_(a,b.getUan())?i18n.phonenumbers.PhoneNumberType.UAN:this.isNumberMatchingDesc_(a,b.getVoicemail())?i18n.phonenumbers.PhoneNumberType.VOICEMAIL:this.isNumberMatchingDesc_(a,b.getFixedLine())?b.getSameMobileAndFixedLinePattern()||this.isNumberMatchingDesc_(a,\nb.getMobile())?i18n.phonenumbers.PhoneNumberType.FIXED_LINE_OR_MOBILE:i18n.phonenumbers.PhoneNumberType.FIXED_LINE:!b.getSameMobileAndFixedLinePattern()&&this.isNumberMatchingDesc_(a,b.getMobile())?i18n.phonenumbers.PhoneNumberType.MOBILE:i18n.phonenumbers.PhoneNumberType.UNKNOWN};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getMetadataForRegion=function(a){if(null==a)return null;a=a.toUpperCase();var b=this.regionToMetadataMap[a];if(null==b){var b=new goog.proto2.PbLiteSerializer,c=i18n.phonenumbers.metadata.countryToMetadata[a];if(null==c)return null;b=b.deserialize(i18n.phonenumbers.PhoneMetadata.getDescriptor(),c);this.regionToMetadataMap[a]=b}return b};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getMetadataForNonGeographicalRegion=function(a){return this.getMetadataForRegion(\"\"+a)};i18n.phonenumbers.PhoneNumberUtil.prototype.isNumberMatchingDesc_=function(a,b){return i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(b.getPossibleNumberPatternOrDefault(),a)&&i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(b.getNationalNumberPatternOrDefault(),a)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isValidNumber=function(a){var b=this.getRegionCodeForNumber(a);return this.isValidNumberForRegion(a,b)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isValidNumberForRegion=function(a,b){var c=a.getCountryCodeOrDefault(),d=this.getMetadataForRegionOrCallingCode_(c,b);if(null==d||i18n.phonenumbers.PhoneNumberUtil.REGION_CODE_FOR_NON_GEO_ENTITY!=b&&c!=this.getCountryCodeForValidRegion_(b))return!1;var c=d.getGeneralDesc(),e=this.getNationalSignificantNumber(a);return!c.hasNationalNumberPattern()?(d=e.length,d>i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_&&d<=i18n.phonenumbers.PhoneNumberUtil.MAX_LENGTH_FOR_NSN_):\nthis.getNumberTypeHelper_(e,d)!=i18n.phonenumbers.PhoneNumberType.UNKNOWN};i18n.phonenumbers.PhoneNumberUtil.prototype.getRegionCodeForNumber=function(a){if(null==a)return null;var b=a.getCountryCodeOrDefault(),b=i18n.phonenumbers.metadata.countryCodeToRegionCodeMap[b];return null==b?null:1==b.length?b[0]:this.getRegionCodeForNumberFromRegionList_(a,b)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getRegionCodeForNumberFromRegionList_=function(a,b){for(var c=this.getNationalSignificantNumber(a),d,e=b.length,f=0;f<e;f++){d=b[f];var g=this.getMetadataForRegion(d);if(g.hasLeadingDigits()){if(0==c.search(g.getLeadingDigits()))return d}else if(this.getNumberTypeHelper_(c,g)!=i18n.phonenumbers.PhoneNumberType.UNKNOWN)return d}return null};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getRegionCodeForCountryCode=function(a){a=i18n.phonenumbers.metadata.countryCodeToRegionCodeMap[a];return null==a?i18n.phonenumbers.PhoneNumberUtil.UNKNOWN_REGION_:a[0]};i18n.phonenumbers.PhoneNumberUtil.prototype.getRegionCodesForCountryCode=function(a){a=i18n.phonenumbers.metadata.countryCodeToRegionCodeMap[a];return null==a?[]:a};i18n.phonenumbers.PhoneNumberUtil.prototype.getCountryCodeForRegion=function(a){return!this.isValidRegionCode_(a)?0:this.getCountryCodeForValidRegion_(a)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.getCountryCodeForValidRegion_=function(a){var b=this.getMetadataForRegion(a);if(null==b)throw\"Invalid region code: \"+a;return b.getCountryCodeOrDefault()};i18n.phonenumbers.PhoneNumberUtil.prototype.getNddPrefixForRegion=function(a,b){var c=this.getMetadataForRegion(a);if(null==c)return null;c=c.getNationalPrefixOrDefault();if(0==c.length)return null;b&&(c=c.replace(\"~\",\"\"));return c};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isNANPACountry=function(a){return null!=a&&goog.array.contains(i18n.phonenumbers.metadata.countryCodeToRegionCodeMap[i18n.phonenumbers.PhoneNumberUtil.NANPA_COUNTRY_CODE_],a.toUpperCase())};i18n.phonenumbers.PhoneNumberUtil.prototype.isLeadingZeroPossible=function(a){a=this.getMetadataForRegionOrCallingCode_(a,this.getRegionCodeForCountryCode(a));return null!=a&&a.getLeadingZeroPossibleOrDefault()};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isAlphaNumber=function(a){if(!i18n.phonenumbers.PhoneNumberUtil.isViablePhoneNumber(a))return!1;a=new goog.string.StringBuffer(a);this.maybeStripExtension(a);return i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(i18n.phonenumbers.PhoneNumberUtil.VALID_ALPHA_PHONE_PATTERN_,a.toString())};i18n.phonenumbers.PhoneNumberUtil.prototype.isPossibleNumber=function(a){return this.isPossibleNumberWithReason(a)==i18n.phonenumbers.PhoneNumberUtil.ValidationResult.IS_POSSIBLE};\ni18n.phonenumbers.PhoneNumberUtil.prototype.testNumberLengthAgainstPattern_=function(a,b){return i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(a,b)?i18n.phonenumbers.PhoneNumberUtil.ValidationResult.IS_POSSIBLE:0==b.search(a)?i18n.phonenumbers.PhoneNumberUtil.ValidationResult.TOO_LONG:i18n.phonenumbers.PhoneNumberUtil.ValidationResult.TOO_SHORT};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isPossibleNumberWithReason=function(a){var b=this.getNationalSignificantNumber(a);a=a.getCountryCodeOrDefault();if(!this.hasValidCountryCallingCode_(a))return i18n.phonenumbers.PhoneNumberUtil.ValidationResult.INVALID_COUNTRY_CODE;var c=this.getRegionCodeForCountryCode(a);a=this.getMetadataForRegionOrCallingCode_(a,c).getGeneralDesc();if(!a.hasNationalNumberPattern())return b=b.length,b<i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_?i18n.phonenumbers.PhoneNumberUtil.ValidationResult.TOO_SHORT:\nb>i18n.phonenumbers.PhoneNumberUtil.MAX_LENGTH_FOR_NSN_?i18n.phonenumbers.PhoneNumberUtil.ValidationResult.TOO_LONG:i18n.phonenumbers.PhoneNumberUtil.ValidationResult.IS_POSSIBLE;a=a.getPossibleNumberPatternOrDefault();return this.testNumberLengthAgainstPattern_(a,b)};i18n.phonenumbers.PhoneNumberUtil.prototype.isPossibleNumberString=function(a,b){try{return this.isPossibleNumber(this.parse(a,b))}catch(c){return!1}};\ni18n.phonenumbers.PhoneNumberUtil.prototype.truncateTooLongNumber=function(a){if(this.isValidNumber(a))return!0;var b=a.clone(),c=a.getNationalNumberOrDefault();do if(c=Math.floor(c/10),b.setNationalNumber(c),0==c||this.isPossibleNumberWithReason(b)==i18n.phonenumbers.PhoneNumberUtil.ValidationResult.TOO_SHORT)return!1;while(!this.isValidNumber(b));a.setNationalNumber(c);return!0};\ni18n.phonenumbers.PhoneNumberUtil.prototype.extractCountryCode=function(a,b){var c=a.toString();if(0==c.length||\"0\"==c.charAt(0))return 0;for(var d,e=c.length,f=1;f<=i18n.phonenumbers.PhoneNumberUtil.MAX_LENGTH_COUNTRY_CODE_&&f<=e;++f)if(d=parseInt(c.substring(0,f),10),d in i18n.phonenumbers.metadata.countryCodeToRegionCodeMap)return b.append(c.substring(f)),d;return 0};\ni18n.phonenumbers.PhoneNumberUtil.prototype.maybeExtractCountryCode=function(a,b,c,d,e){if(0==a.length)return 0;a=new goog.string.StringBuffer(a);var f;null!=b&&(f=b.getInternationalPrefix());null==f&&(f=\"NonMatch\");f=this.maybeStripInternationalPrefixAndNormalize(a,f);d&&e.setCountryCodeSource(f);if(f!=i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_DEFAULT_COUNTRY){if(a.getLength()<=i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_)throw i18n.phonenumbers.Error.TOO_SHORT_AFTER_IDD;c=this.extractCountryCode(a,\nc);if(0!=c)return e.setCountryCode(c),c;throw i18n.phonenumbers.Error.INVALID_COUNTRY_CODE;}if(null!=b){f=b.getCountryCodeOrDefault();var g=\"\"+f,h=a.toString();if(goog.string.startsWith(h,g)){var j=new goog.string.StringBuffer(h.substring(g.length)),h=b.getGeneralDesc(),g=RegExp(h.getNationalNumberPatternOrDefault());this.maybeStripNationalPrefixAndCarrierCode(j,b,null);b=j.toString();h=h.getPossibleNumberPatternOrDefault();if(!i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(g,a.toString())&&i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(g,\nb)||this.testNumberLengthAgainstPattern_(h,a.toString())==i18n.phonenumbers.PhoneNumberUtil.ValidationResult.TOO_LONG)return c.append(b),d&&e.setCountryCodeSource(i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_NUMBER_WITHOUT_PLUS_SIGN),e.setCountryCode(f),f}}e.setCountryCode(0);return 0};\ni18n.phonenumbers.PhoneNumberUtil.prototype.parsePrefixAsIdd_=function(a,b){var c=b.toString();if(0==c.search(a)){var d=c.match(a)[0].length,e=c.substring(d).match(i18n.phonenumbers.PhoneNumberUtil.CAPTURING_DIGIT_PATTERN);if(e&&(null!=e[1]&&0<e[1].length)&&\"0\"==i18n.phonenumbers.PhoneNumberUtil.normalizeDigitsOnly(e[1]))return!1;b.clear();b.append(c.substring(d));return!0}return!1};\ni18n.phonenumbers.PhoneNumberUtil.prototype.maybeStripInternationalPrefixAndNormalize=function(a,b){var c=a.toString();if(0==c.length)return i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_DEFAULT_COUNTRY;if(i18n.phonenumbers.PhoneNumberUtil.LEADING_PLUS_CHARS_PATTERN_.test(c))return c=c.replace(i18n.phonenumbers.PhoneNumberUtil.LEADING_PLUS_CHARS_PATTERN_,\"\"),a.clear(),a.append(i18n.phonenumbers.PhoneNumberUtil.normalize(c)),i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_NUMBER_WITH_PLUS_SIGN;\nc=RegExp(b);i18n.phonenumbers.PhoneNumberUtil.normalizeSB_(a);return this.parsePrefixAsIdd_(c,a)?i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_NUMBER_WITH_IDD:i18n.phonenumbers.PhoneNumber.CountryCodeSource.FROM_DEFAULT_COUNTRY};\ni18n.phonenumbers.PhoneNumberUtil.prototype.maybeStripNationalPrefixAndCarrierCode=function(a,b,c){var d=a.toString(),e=d.length,f=b.getNationalPrefixForParsing();if(0==e||null==f||0==f.length)return!1;var g=RegExp(\"^(?:\"+f+\")\");if(e=g.exec(d)){var f=RegExp(b.getGeneralDesc().getNationalNumberPatternOrDefault()),h=e.length-1,j=b.getNationalPrefixTransformRule(),g=(b=null==j||0==j.length||null==e[h]||0==e[h].length)?d.substring(e[0].length):d.replace(g,j);if(i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(f,\nd)&&!i18n.phonenumbers.PhoneNumberUtil.matchesEntirely_(f,g))return!1;(b&&0<h&&null!=e[1]||!b&&1<h)&&null!=c&&c.append(e[1]);a.clear();a.append(g);return!0}return!1};\ni18n.phonenumbers.PhoneNumberUtil.prototype.maybeStripExtension=function(a){var b=a.toString(),c=b.search(i18n.phonenumbers.PhoneNumberUtil.EXTN_PATTERN_);if(0<=c&&i18n.phonenumbers.PhoneNumberUtil.isViablePhoneNumber(b.substring(0,c)))for(var d=b.match(i18n.phonenumbers.PhoneNumberUtil.EXTN_PATTERN_),e=d.length,f=1;f<e;++f)if(null!=d[f]&&0<d[f].length)return a.clear(),a.append(b.substring(0,c)),d[f];return\"\"};\ni18n.phonenumbers.PhoneNumberUtil.prototype.checkRegionForParsing_=function(a,b){return this.isValidRegionCode_(b)||null!=a&&0<a.length&&i18n.phonenumbers.PhoneNumberUtil.LEADING_PLUS_CHARS_PATTERN_.test(a)};i18n.phonenumbers.PhoneNumberUtil.prototype.parse=function(a,b){return this.parseHelper_(a,b,!1,!0)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.parseAndKeepRawInput=function(a,b){if(!this.isValidRegionCode_(b)&&0<a.length&&a.charAt(0)!=i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN)throw i18n.phonenumbers.Error.INVALID_COUNTRY_CODE;return this.parseHelper_(a,b,!0,!0)};\ni18n.phonenumbers.PhoneNumberUtil.prototype.parseHelper_=function(a,b,c,d){if(null==a)throw i18n.phonenumbers.Error.NOT_A_NUMBER;if(a.length>i18n.phonenumbers.PhoneNumberUtil.MAX_INPUT_STRING_LENGTH_)throw i18n.phonenumbers.Error.TOO_LONG;var e=new goog.string.StringBuffer;this.buildNationalNumberForParsing_(a,e);if(!i18n.phonenumbers.PhoneNumberUtil.isViablePhoneNumber(e.toString()))throw i18n.phonenumbers.Error.NOT_A_NUMBER;if(d&&!this.checkRegionForParsing_(e.toString(),b))throw i18n.phonenumbers.Error.INVALID_COUNTRY_CODE;\nd=new i18n.phonenumbers.PhoneNumber;c&&d.setRawInput(a);a=this.maybeStripExtension(e);0<a.length&&d.setExtension(a);a=this.getMetadataForRegion(b);var f=new goog.string.StringBuffer,g=0,h=e.toString();try{g=this.maybeExtractCountryCode(h,a,f,c,d)}catch(j){if(j==i18n.phonenumbers.Error.INVALID_COUNTRY_CODE&&i18n.phonenumbers.PhoneNumberUtil.LEADING_PLUS_CHARS_PATTERN_.test(h)){if(h=h.replace(i18n.phonenumbers.PhoneNumberUtil.LEADING_PLUS_CHARS_PATTERN_,\"\"),g=this.maybeExtractCountryCode(h,a,f,c,d),\n0==g)throw j;}else throw j;}0!=g?(e=this.getRegionCodeForCountryCode(g),e!=b&&(a=this.getMetadataForRegionOrCallingCode_(g,e))):(i18n.phonenumbers.PhoneNumberUtil.normalizeSB_(e),f.append(e.toString()),null!=b?(g=a.getCountryCodeOrDefault(),d.setCountryCode(g)):c&&d.clearCountryCodeSource());if(f.getLength()<i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_)throw i18n.phonenumbers.Error.TOO_SHORT_NSN;null!=a&&(b=new goog.string.StringBuffer,this.maybeStripNationalPrefixAndCarrierCode(f,a,b),c&&\nd.setPreferredDomesticCarrierCode(b.toString()));c=f.toString();b=c.length;if(b<i18n.phonenumbers.PhoneNumberUtil.MIN_LENGTH_FOR_NSN_)throw i18n.phonenumbers.Error.TOO_SHORT_NSN;if(b>i18n.phonenumbers.PhoneNumberUtil.MAX_LENGTH_FOR_NSN_)throw i18n.phonenumbers.Error.TOO_LONG;\"0\"==c.charAt(0)&&d.setItalianLeadingZero(!0);d.setNationalNumber(parseInt(c,10));return d};\ni18n.phonenumbers.PhoneNumberUtil.prototype.buildNationalNumberForParsing_=function(a,b){var c=a.indexOf(i18n.phonenumbers.PhoneNumberUtil.RFC3966_PHONE_CONTEXT_);if(0<c){var d=c+i18n.phonenumbers.PhoneNumberUtil.RFC3966_PHONE_CONTEXT_.length;if(a.charAt(d)==i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN){var e=a.indexOf(\";\",d);0<e?b.append(a.substring(d,e)):b.append(a.substring(d))}b.append(a.substring(a.indexOf(i18n.phonenumbers.PhoneNumberUtil.RFC3966_PREFIX_)+i18n.phonenumbers.PhoneNumberUtil.RFC3966_PREFIX_.length,\nc))}else b.append(i18n.phonenumbers.PhoneNumberUtil.extractPossibleNumber(a));c=b.toString();d=c.indexOf(i18n.phonenumbers.PhoneNumberUtil.RFC3966_ISDN_SUBADDRESS_);0<d&&(b.clear(),b.append(c.substring(0,d)))};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isNumberMatch=function(a,b){var c,d;if(\"string\"==typeof a)try{c=this.parse(a,i18n.phonenumbers.PhoneNumberUtil.UNKNOWN_REGION_)}catch(e){if(e!=i18n.phonenumbers.Error.INVALID_COUNTRY_CODE)return i18n.phonenumbers.PhoneNumberUtil.MatchType.NOT_A_NUMBER;if(\"string\"!=typeof b){var f=this.getRegionCodeForCountryCode(b.getCountryCodeOrDefault());if(f!=i18n.phonenumbers.PhoneNumberUtil.UNKNOWN_REGION_){try{c=this.parse(a,f)}catch(g){return i18n.phonenumbers.PhoneNumberUtil.MatchType.NOT_A_NUMBER}c=\nthis.isNumberMatch(c,b);return c==i18n.phonenumbers.PhoneNumberUtil.MatchType.EXACT_MATCH?i18n.phonenumbers.PhoneNumberUtil.MatchType.NSN_MATCH:c}}try{c=this.parseHelper_(a,null,!1,!1)}catch(h){return i18n.phonenumbers.PhoneNumberUtil.MatchType.NOT_A_NUMBER}}else c=a.clone();if(\"string\"==typeof b)try{return d=this.parse(b,i18n.phonenumbers.PhoneNumberUtil.UNKNOWN_REGION_),this.isNumberMatch(a,d)}catch(j){return j!=i18n.phonenumbers.Error.INVALID_COUNTRY_CODE?i18n.phonenumbers.PhoneNumberUtil.MatchType.NOT_A_NUMBER:\nthis.isNumberMatch(b,c)}else d=b.clone();c.clearRawInput();c.clearCountryCodeSource();c.clearPreferredDomesticCarrierCode();d.clearRawInput();d.clearCountryCodeSource();d.clearPreferredDomesticCarrierCode();c.hasExtension()&&0==c.getExtension().length&&c.clearExtension();d.hasExtension()&&0==d.getExtension().length&&d.clearExtension();if(c.hasExtension()&&d.hasExtension()&&c.getExtension()!=d.getExtension())return i18n.phonenumbers.PhoneNumberUtil.MatchType.NO_MATCH;var f=c.getCountryCodeOrDefault(),\nk=d.getCountryCodeOrDefault();if(0!=f&&0!=k)return c.equals(d)?i18n.phonenumbers.PhoneNumberUtil.MatchType.EXACT_MATCH:f==k&&this.isNationalNumberSuffixOfTheOther_(c,d)?i18n.phonenumbers.PhoneNumberUtil.MatchType.SHORT_NSN_MATCH:i18n.phonenumbers.PhoneNumberUtil.MatchType.NO_MATCH;c.setCountryCode(0);d.setCountryCode(0);return c.equals(d)?i18n.phonenumbers.PhoneNumberUtil.MatchType.NSN_MATCH:this.isNationalNumberSuffixOfTheOther_(c,d)?i18n.phonenumbers.PhoneNumberUtil.MatchType.SHORT_NSN_MATCH:i18n.phonenumbers.PhoneNumberUtil.MatchType.NO_MATCH};\ni18n.phonenumbers.PhoneNumberUtil.prototype.isNationalNumberSuffixOfTheOther_=function(a,b){var c=\"\"+a.getNationalNumber(),d=\"\"+b.getNationalNumber();return goog.string.endsWith(c,d)||goog.string.endsWith(d,c)};i18n.phonenumbers.PhoneNumberUtil.prototype.canBeInternationallyDialled=function(a){var b=this.getMetadataForRegion(this.getRegionCodeForNumber(a));if(null==b)return!0;a=this.getNationalSignificantNumber(a);return!this.isNumberMatchingDesc_(a,b.getNoInternationalDialling())};\ni18n.phonenumbers.PhoneNumberUtil.matchesEntirely_=function(a,b){var c=\"string\"==typeof a?b.match(\"^(?:\"+a+\")$\"):b.match(a);return c&&c[0].length==b.length?!0:!1};/*\n\n Copyright (C) 2010 The Libphonenumber Authors.\n\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\ni18n.phonenumbers.AsYouTypeFormatter=function(a){this.DIGIT_PLACEHOLDER_=\"\\u2008\";this.DIGIT_PATTERN_=RegExp(this.DIGIT_PLACEHOLDER_);this.currentOutput_=\"\";this.formattingTemplate_=new goog.string.StringBuffer;this.currentFormattingPattern_=\"\";this.accruedInput_=new goog.string.StringBuffer;this.accruedInputWithoutFormatting_=new goog.string.StringBuffer;this.ableToFormat_=!0;this.isExpectingCountryCallingCode_=this.isCompleteNumber_=this.inputHasFormatting_=!1;this.phoneUtil_=i18n.phonenumbers.PhoneNumberUtil.getInstance();\nthis.positionToRemember_=this.originalPosition_=this.lastMatchPosition_=0;this.prefixBeforeNationalNumber_=new goog.string.StringBuffer;this.shouldAddSpaceAfterNationalPrefix_=!1;this.nationalPrefixExtracted_=\"\";this.nationalNumber_=new goog.string.StringBuffer;this.possibleFormats_=[];this.defaultCountry_=a;this.defaultMetaData_=this.currentMetaData_=this.getMetadataForRegion_(this.defaultCountry_)};i18n.phonenumbers.AsYouTypeFormatter.SEPARATOR_BEFORE_NATIONAL_NUMBER_=\" \";\ni18n.phonenumbers.AsYouTypeFormatter.EMPTY_METADATA_=new i18n.phonenumbers.PhoneMetadata;i18n.phonenumbers.AsYouTypeFormatter.EMPTY_METADATA_.setInternationalPrefix(\"NA\");i18n.phonenumbers.AsYouTypeFormatter.CHARACTER_CLASS_PATTERN_=/\\[([^\\[\\]])*\\]/g;i18n.phonenumbers.AsYouTypeFormatter.STANDALONE_DIGIT_PATTERN_=/\\d(?=[^,}][^,}])/g;\ni18n.phonenumbers.AsYouTypeFormatter.ELIGIBLE_FORMAT_PATTERN_=RegExp(\"^[\"+i18n.phonenumbers.PhoneNumberUtil.VALID_PUNCTUATION+\"]*(\\\\$\\\\d[\"+i18n.phonenumbers.PhoneNumberUtil.VALID_PUNCTUATION+\"]*)+$\");i18n.phonenumbers.AsYouTypeFormatter.NATIONAL_PREFIX_SEPARATORS_PATTERN_=/[- ]/;i18n.phonenumbers.AsYouTypeFormatter.MIN_LEADING_DIGITS_LENGTH_=3;\ni18n.phonenumbers.AsYouTypeFormatter.prototype.getMetadataForRegion_=function(a){a=this.phoneUtil_.getCountryCodeForRegion(a);a=this.phoneUtil_.getRegionCodeForCountryCode(a);a=this.phoneUtil_.getMetadataForRegion(a);return null!=a?a:i18n.phonenumbers.AsYouTypeFormatter.EMPTY_METADATA_};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.maybeCreateNewTemplate_=function(){for(var a=this.possibleFormats_.length,b=0;b<a;++b){var c=this.possibleFormats_[b],d=c.getPatternOrDefault();if(this.currentFormattingPattern_==d)return!1;if(this.createFormattingTemplate_(c))return this.currentFormattingPattern_=d,this.shouldAddSpaceAfterNationalPrefix_=i18n.phonenumbers.AsYouTypeFormatter.NATIONAL_PREFIX_SEPARATORS_PATTERN_.test(c.getNationalPrefixFormattingRule()),this.lastMatchPosition_=0,!0}return this.ableToFormat_=\n!1};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.getAvailableFormats_=function(a){for(var b=this.isCompleteNumber_&&0<this.currentMetaData_.intlNumberFormatCount()?this.currentMetaData_.intlNumberFormatArray():this.currentMetaData_.numberFormatArray(),c=b.length,d=0;d<c;++d){var e=b[d];(!this.currentMetaData_.hasNationalPrefix()||this.isCompleteNumber_||e.getNationalPrefixOptionalWhenFormatting()||this.phoneUtil_.formattingRuleHasFirstGroupOnly(e.getNationalPrefixFormattingRuleOrDefault()))&&this.isFormatEligible_(e.getFormatOrDefault())&&this.possibleFormats_.push(e)}this.narrowDownPossibleFormats_(a)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.isFormatEligible_=function(a){return i18n.phonenumbers.AsYouTypeFormatter.ELIGIBLE_FORMAT_PATTERN_.test(a)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.narrowDownPossibleFormats_=function(a){for(var b=[],c=a.length-i18n.phonenumbers.AsYouTypeFormatter.MIN_LEADING_DIGITS_LENGTH_,d=this.possibleFormats_.length,e=0;e<d;++e){var f=this.possibleFormats_[e];f.leadingDigitsPatternCount()>c?(f=f.getLeadingDigitsPatternOrDefault(c),0==a.search(f)&&b.push(this.possibleFormats_[e])):b.push(this.possibleFormats_[e])}this.possibleFormats_=b};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.createFormattingTemplate_=function(a){var b=a.getPatternOrDefault();if(-1!=b.indexOf(\"|\"))return!1;b=b.replace(i18n.phonenumbers.AsYouTypeFormatter.CHARACTER_CLASS_PATTERN_,\"\\\\d\");b=b.replace(i18n.phonenumbers.AsYouTypeFormatter.STANDALONE_DIGIT_PATTERN_,\"\\\\d\");this.formattingTemplate_.clear();a=this.getFormattingTemplate_(b,a.getFormatOrDefault());return 0<a.length?(this.formattingTemplate_.append(a),!0):!1};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.getFormattingTemplate_=function(a,b){var c=\"999999999999999\".match(a)[0];if(c.length<this.nationalNumber_.getLength())return\"\";c=c.replace(RegExp(a,\"g\"),b);return c=c.replace(RegExp(\"9\",\"g\"),this.DIGIT_PLACEHOLDER_)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.clear=function(){this.currentOutput_=\"\";this.accruedInput_.clear();this.accruedInputWithoutFormatting_.clear();this.formattingTemplate_.clear();this.lastMatchPosition_=0;this.currentFormattingPattern_=\"\";this.prefixBeforeNationalNumber_.clear();this.nationalPrefixExtracted_=\"\";this.nationalNumber_.clear();this.ableToFormat_=!0;this.inputHasFormatting_=!1;this.originalPosition_=this.positionToRemember_=0;this.isExpectingCountryCallingCode_=this.isCompleteNumber_=\n!1;this.possibleFormats_=[];this.shouldAddSpaceAfterNationalPrefix_=!1;this.currentMetaData_!=this.defaultMetaData_&&(this.currentMetaData_=this.getMetadataForRegion_(this.defaultCountry_))};i18n.phonenumbers.AsYouTypeFormatter.prototype.inputDigit=function(a){return this.currentOutput_=this.inputDigitWithOptionToRememberPosition_(a,!1)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.inputDigitAndRememberPosition=function(a){return this.currentOutput_=this.inputDigitWithOptionToRememberPosition_(a,!0)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.inputDigitWithOptionToRememberPosition_=function(a,b){this.accruedInput_.append(a);b&&(this.originalPosition_=this.accruedInput_.getLength());this.isDigitOrLeadingPlusSign_(a)?a=this.normalizeAndAccrueDigitsAndPlusSign_(a,b):(this.ableToFormat_=!1,this.inputHasFormatting_=!0);if(!this.ableToFormat_){if(!this.inputHasFormatting_)if(this.attemptToExtractIdd_()){if(this.attemptToExtractCountryCallingCode_())return this.attemptToChoosePatternWithPrefixExtracted_()}else if(this.ableToExtractLongerNdd_())return this.prefixBeforeNationalNumber_.append(i18n.phonenumbers.AsYouTypeFormatter.SEPARATOR_BEFORE_NATIONAL_NUMBER_),this.attemptToChoosePatternWithPrefixExtracted_();\nreturn this.accruedInput_.toString()}switch(this.accruedInputWithoutFormatting_.getLength()){case 0:case 1:case 2:return this.accruedInput_.toString();case 3:if(this.attemptToExtractIdd_())this.isExpectingCountryCallingCode_=!0;else return this.nationalPrefixExtracted_=this.removeNationalPrefixFromNationalNumber_(),this.attemptToChooseFormattingPattern_();default:if(this.isExpectingCountryCallingCode_)return this.attemptToExtractCountryCallingCode_()&&(this.isExpectingCountryCallingCode_=!1),this.prefixBeforeNationalNumber_.toString()+\nthis.nationalNumber_.toString();if(0<this.possibleFormats_.length){var c=this.inputDigitHelper_(a),d=this.attemptToFormatAccruedDigits_();if(0<d.length)return d;this.narrowDownPossibleFormats_(this.nationalNumber_.toString());return this.maybeCreateNewTemplate_()?this.inputAccruedNationalNumber_():this.ableToFormat_?this.appendNationalNumber_(c):this.accruedInput_.toString()}return this.attemptToChooseFormattingPattern_()}};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.attemptToChoosePatternWithPrefixExtracted_=function(){this.ableToFormat_=!0;this.isExpectingCountryCallingCode_=!1;this.possibleFormats_=[];return this.attemptToChooseFormattingPattern_()};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.ableToExtractLongerNdd_=function(){if(0<this.nationalPrefixExtracted_.length){var a=this.nationalNumber_.toString();this.nationalNumber_.clear();this.nationalNumber_.append(this.nationalPrefixExtracted_);this.nationalNumber_.append(a);var a=this.prefixBeforeNationalNumber_.toString(),b=a.lastIndexOf(this.nationalPrefixExtracted_);this.prefixBeforeNationalNumber_.clear();this.prefixBeforeNationalNumber_.append(a.substring(0,b))}return this.nationalPrefixExtracted_!=\nthis.removeNationalPrefixFromNationalNumber_()};i18n.phonenumbers.AsYouTypeFormatter.prototype.isDigitOrLeadingPlusSign_=function(a){return i18n.phonenumbers.PhoneNumberUtil.CAPTURING_DIGIT_PATTERN.test(a)||1==this.accruedInput_.getLength()&&i18n.phonenumbers.PhoneNumberUtil.PLUS_CHARS_PATTERN.test(a)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.attemptToFormatAccruedDigits_=function(){for(var a=this.nationalNumber_.toString(),b=this.possibleFormats_.length,c=0;c<b;++c){var d=this.possibleFormats_[c],e=d.getPatternOrDefault();if(RegExp(\"^(?:\"+e+\")$\").test(a))return this.shouldAddSpaceAfterNationalPrefix_=i18n.phonenumbers.AsYouTypeFormatter.NATIONAL_PREFIX_SEPARATORS_PATTERN_.test(d.getNationalPrefixFormattingRule()),a=a.replace(RegExp(e,\"g\"),d.getFormat()),this.appendNationalNumber_(a)}return\"\"};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.appendNationalNumber_=function(a){var b=this.prefixBeforeNationalNumber_.getLength();return this.shouldAddSpaceAfterNationalPrefix_&&0<b&&this.prefixBeforeNationalNumber_.toString().charAt(b-1)!=i18n.phonenumbers.AsYouTypeFormatter.SEPARATOR_BEFORE_NATIONAL_NUMBER_?this.prefixBeforeNationalNumber_+i18n.phonenumbers.AsYouTypeFormatter.SEPARATOR_BEFORE_NATIONAL_NUMBER_+a:this.prefixBeforeNationalNumber_+a};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.getRememberedPosition=function(){if(!this.ableToFormat_)return this.originalPosition_;for(var a=0,b=0,c=this.accruedInputWithoutFormatting_.toString(),d=this.currentOutput_.toString();a<this.positionToRemember_&&b<d.length;)c.charAt(a)==d.charAt(b)&&a++,b++;return b};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.attemptToChooseFormattingPattern_=function(){var a=this.nationalNumber_.toString();return a.length>=i18n.phonenumbers.AsYouTypeFormatter.MIN_LEADING_DIGITS_LENGTH_?(this.getAvailableFormats_(a.substring(0,i18n.phonenumbers.AsYouTypeFormatter.MIN_LEADING_DIGITS_LENGTH_)),this.maybeCreateNewTemplate_()?this.inputAccruedNationalNumber_():this.accruedInput_.toString()):this.appendNationalNumber_(a)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.inputAccruedNationalNumber_=function(){var a=this.nationalNumber_.toString(),b=a.length;if(0<b){for(var c=\"\",d=0;d<b;d++)c=this.inputDigitHelper_(a.charAt(d));return this.ableToFormat_?this.appendNationalNumber_(c):this.accruedInput_.toString()}return this.prefixBeforeNationalNumber_.toString()};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.isNanpaNumberWithNationalPrefix_=function(){if(1!=this.currentMetaData_.getCountryCode())return!1;var a=this.nationalNumber_.toString();return\"1\"==a.charAt(0)&&\"0\"!=a.charAt(1)&&\"1\"!=a.charAt(1)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.removeNationalPrefixFromNationalNumber_=function(){var a=this.nationalNumber_.toString(),b=0;if(this.isNanpaNumberWithNationalPrefix_())b=1,this.prefixBeforeNationalNumber_.append(\"1\").append(i18n.phonenumbers.AsYouTypeFormatter.SEPARATOR_BEFORE_NATIONAL_NUMBER_),this.isCompleteNumber_=!0;else if(this.currentMetaData_.hasNationalPrefixForParsing()){var c=RegExp(\"^(?:\"+this.currentMetaData_.getNationalPrefixForParsing()+\")\"),c=a.match(c);null!=c&&(null!=\nc[0]&&0<c[0].length)&&(this.isCompleteNumber_=!0,b=c[0].length,this.prefixBeforeNationalNumber_.append(a.substring(0,b)))}this.nationalNumber_.clear();this.nationalNumber_.append(a.substring(b));return a.substring(0,b)};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.attemptToExtractIdd_=function(){var a=this.accruedInputWithoutFormatting_.toString(),b=RegExp(\"^(?:\\\\\"+i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN+\"|\"+this.currentMetaData_.getInternationalPrefix()+\")\"),b=a.match(b);return null!=b&&null!=b[0]&&0<b[0].length?(this.isCompleteNumber_=!0,b=b[0].length,this.nationalNumber_.clear(),this.nationalNumber_.append(a.substring(b)),this.prefixBeforeNationalNumber_.clear(),this.prefixBeforeNationalNumber_.append(a.substring(0,\nb)),a.charAt(0)!=i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN&&this.prefixBeforeNationalNumber_.append(i18n.phonenumbers.AsYouTypeFormatter.SEPARATOR_BEFORE_NATIONAL_NUMBER_),!0):!1};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.attemptToExtractCountryCallingCode_=function(){if(0==this.nationalNumber_.getLength())return!1;var a=new goog.string.StringBuffer,b=this.phoneUtil_.extractCountryCode(this.nationalNumber_,a);if(0==b)return!1;this.nationalNumber_.clear();this.nationalNumber_.append(a.toString());a=this.phoneUtil_.getRegionCodeForCountryCode(b);i18n.phonenumbers.PhoneNumberUtil.REGION_CODE_FOR_NON_GEO_ENTITY==a?this.currentMetaData_=this.phoneUtil_.getMetadataForNonGeographicalRegion(b):\na!=this.defaultCountry_&&(this.currentMetaData_=this.getMetadataForRegion_(a));this.prefixBeforeNationalNumber_.append(\"\"+b).append(i18n.phonenumbers.AsYouTypeFormatter.SEPARATOR_BEFORE_NATIONAL_NUMBER_);return!0};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.normalizeAndAccrueDigitsAndPlusSign_=function(a,b){var c;a==i18n.phonenumbers.PhoneNumberUtil.PLUS_SIGN?(c=a,this.accruedInputWithoutFormatting_.append(a)):(c=i18n.phonenumbers.PhoneNumberUtil.DIGIT_MAPPINGS[a],this.accruedInputWithoutFormatting_.append(c),this.nationalNumber_.append(c));b&&(this.positionToRemember_=this.accruedInputWithoutFormatting_.getLength());return c};\ni18n.phonenumbers.AsYouTypeFormatter.prototype.inputDigitHelper_=function(a){var b=this.formattingTemplate_.toString();if(0<=b.substring(this.lastMatchPosition_).search(this.DIGIT_PATTERN_)){var c=b.search(this.DIGIT_PATTERN_);a=b.replace(this.DIGIT_PATTERN_,a);this.formattingTemplate_.clear();this.formattingTemplate_.append(a);this.lastMatchPosition_=c;return a.substring(0,this.lastMatchPosition_+1)}1==this.possibleFormats_.length&&(this.ableToFormat_=!1);this.currentFormattingPattern_=\"\";return this.accruedInput_.toString()};\n","pre":true},"sdk/plugins/weeby/sdk/simulator/md5.js":{"path":"sdk/plugins/weeby/sdk/simulator/md5.js","friendlyPath":".md5","directory":"sdk/plugins/weeby/sdk/simulator/","filename":"md5.js","src":"function md5cycle(x, k) {\n\tvar a = x[0], b = x[1], c = x[2], d = x[3];\n\n\ta = ff(a, b, c, d, k[0], 7, -680876936);\n\td = ff(d, a, b, c, k[1], 12, -389564586);\n\tc = ff(c, d, a, b, k[2], 17,  606105819);\n\tb = ff(b, c, d, a, k[3], 22, -1044525330);\n\ta = ff(a, b, c, d, k[4], 7, -176418897);\n\td = ff(d, a, b, c, k[5], 12,  1200080426);\n\tc = ff(c, d, a, b, k[6], 17, -1473231341);\n\tb = ff(b, c, d, a, k[7], 22, -45705983);\n\ta = ff(a, b, c, d, k[8], 7,  1770035416);\n\td = ff(d, a, b, c, k[9], 12, -1958414417);\n\tc = ff(c, d, a, b, k[10], 17, -42063);\n\tb = ff(b, c, d, a, k[11], 22, -1990404162);\n\ta = ff(a, b, c, d, k[12], 7,  1804603682);\n\td = ff(d, a, b, c, k[13], 12, -40341101);\n\tc = ff(c, d, a, b, k[14], 17, -1502002290);\n\tb = ff(b, c, d, a, k[15], 22,  1236535329);\n\n\ta = gg(a, b, c, d, k[1], 5, -165796510);\n\td = gg(d, a, b, c, k[6], 9, -1069501632);\n\tc = gg(c, d, a, b, k[11], 14,  643717713);\n\tb = gg(b, c, d, a, k[0], 20, -373897302);\n\ta = gg(a, b, c, d, k[5], 5, -701558691);\n\td = gg(d, a, b, c, k[10], 9,  38016083);\n\tc = gg(c, d, a, b, k[15], 14, -660478335);\n\tb = gg(b, c, d, a, k[4], 20, -405537848);\n\ta = gg(a, b, c, d, k[9], 5,  568446438);\n\td = gg(d, a, b, c, k[14], 9, -1019803690);\n\tc = gg(c, d, a, b, k[3], 14, -187363961);\n\tb = gg(b, c, d, a, k[8], 20,  1163531501);\n\ta = gg(a, b, c, d, k[13], 5, -1444681467);\n\td = gg(d, a, b, c, k[2], 9, -51403784);\n\tc = gg(c, d, a, b, k[7], 14,  1735328473);\n\tb = gg(b, c, d, a, k[12], 20, -1926607734);\n\n\ta = hh(a, b, c, d, k[5], 4, -378558);\n\td = hh(d, a, b, c, k[8], 11, -2022574463);\n\tc = hh(c, d, a, b, k[11], 16,  1839030562);\n\tb = hh(b, c, d, a, k[14], 23, -35309556);\n\ta = hh(a, b, c, d, k[1], 4, -1530992060);\n\td = hh(d, a, b, c, k[4], 11,  1272893353);\n\tc = hh(c, d, a, b, k[7], 16, -155497632);\n\tb = hh(b, c, d, a, k[10], 23, -1094730640);\n\ta = hh(a, b, c, d, k[13], 4,  681279174);\n\td = hh(d, a, b, c, k[0], 11, -358537222);\n\tc = hh(c, d, a, b, k[3], 16, -722521979);\n\tb = hh(b, c, d, a, k[6], 23,  76029189);\n\ta = hh(a, b, c, d, k[9], 4, -640364487);\n\td = hh(d, a, b, c, k[12], 11, -421815835);\n\tc = hh(c, d, a, b, k[15], 16,  530742520);\n\tb = hh(b, c, d, a, k[2], 23, -995338651);\n\n\ta = ii(a, b, c, d, k[0], 6, -198630844);\n\td = ii(d, a, b, c, k[7], 10,  1126891415);\n\tc = ii(c, d, a, b, k[14], 15, -1416354905);\n\tb = ii(b, c, d, a, k[5], 21, -57434055);\n\ta = ii(a, b, c, d, k[12], 6,  1700485571);\n\td = ii(d, a, b, c, k[3], 10, -1894986606);\n\tc = ii(c, d, a, b, k[10], 15, -1051523);\n\tb = ii(b, c, d, a, k[1], 21, -2054922799);\n\ta = ii(a, b, c, d, k[8], 6,  1873313359);\n\td = ii(d, a, b, c, k[15], 10, -30611744);\n\tc = ii(c, d, a, b, k[6], 15, -1560198380);\n\tb = ii(b, c, d, a, k[13], 21,  1309151649);\n\ta = ii(a, b, c, d, k[4], 6, -145523070);\n\td = ii(d, a, b, c, k[11], 10, -1120210379);\n\tc = ii(c, d, a, b, k[2], 15,  718787259);\n\tb = ii(b, c, d, a, k[9], 21, -343485551);\n\n\tx[0] = add32(a, x[0]);\n\tx[1] = add32(b, x[1]);\n\tx[2] = add32(c, x[2]);\n\tx[3] = add32(d, x[3]);\n\n}\n\nfunction cmn(q, a, b, x, s, t) {\n\ta = add32(add32(a, q), add32(x, t));\n\treturn add32((a << s) | (a >>> (32 - s)), b);\n}\n\nfunction ff(a, b, c, d, x, s, t) {\n\treturn cmn((b & c) | ((~b) & d), a, b, x, s, t);\n}\n\nfunction gg(a, b, c, d, x, s, t) {\n\treturn cmn((b & d) | (c & (~d)), a, b, x, s, t);\n}\n\nfunction hh(a, b, c, d, x, s, t) {\n\treturn cmn(b ^ c ^ d, a, b, x, s, t);\n}\n\nfunction ii(a, b, c, d, x, s, t) {\n\treturn cmn(c ^ (b | (~d)), a, b, x, s, t);\n}\n\nfunction md51(s) {\n\ttxt = '';\n\tvar n = s.length,\n\tstate = [1732584193, -271733879, -1732584194, 271733878], i;\n\tfor (i=64; i<=s.length; i+=64) {\n\t\tmd5cycle(state, md5blk(s.substring(i-64, i)));\n\t}\n\ts = s.substring(i-64);\n\tvar tail = [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0];\n\tfor (i=0; i<s.length; i++)\n\t\ttail[i>>2] |= s.charCodeAt(i) << ((i%4) << 3);\n\ttail[i>>2] |= 0x80 << ((i%4) << 3);\n\tif (i > 55) {\n\t\tmd5cycle(state, tail);\n\t\tfor (i=0; i<16; i++) tail[i] = 0;\n\t}\ntail[14] = n*8;\nmd5cycle(state, tail);\nreturn state;\n}\n\n/* there needs to be support for Unicode here,\n*  * unless we pretend that we can redefine the MD-5\n*   * algorithm for multi-byte characters (perhaps\n*    * by adding every four 16-bit characters and\n*     * shortening the sum to 32 bits). Otherwise\n*      * I suggest performing MD-5 as if every character\n*       * was two bytes--e.g., 0040 0025 = @%--but then\n*        * how will an ordinary MD-5 sum be matched?\n*         * There is no way to standardize text to something\n*          * like UTF-8 before transformation; speed cost is\n*           * utterly prohibitive. The JavaScript standard\n*            * itself needs to look at this: it should start\n*             * providing access to strings as preformed UTF-8\n*              * 8-bit unsigned value arrays.\n*               */\nfunction md5blk(s) { /* I figured global was faster.   */\n\tvar md5blks = [], i; /* Andy King said do it this way. */\n\tfor (i=0; i<64; i+=4) {\n\t\tmd5blks[i>>2] = s.charCodeAt(i)\n\t\t+ (s.charCodeAt(i+1) << 8)\n\t\t+ (s.charCodeAt(i+2) << 16)\n\t\t+ (s.charCodeAt(i+3) << 24);\n\t}\n\treturn md5blks;\n}\n\nvar hex_chr = '0123456789abcdef'.split('');\n\nfunction rhex(n)\n{\n\tvar s='', j=0;\n\tfor(; j<4; j++)\n\t\ts += hex_chr[(n >> (j * 8 + 4)) & 0x0F]\n\t+ hex_chr[(n >> (j * 8)) & 0x0F];\n\treturn s;\n}\n\nfunction hex(x) {\n\tfor (var i=0; i<x.length; i++)\n\t\tx[i] = rhex(x[i]);\n\treturn x.join('');\n}\n\nfunction md5(s) {\n\treturn hex(md51(s));\n}\nexports.md5 = md5;\n\n/* this function is much faster,\n* so if possible we use it. Some IEs\n* are the only ones I know of that\n* need the idiotic second function,\n* generated by an if clause.  */\n\nfunction add32(a, b) {\n\treturn (a + b) & 0xFFFFFFFF;\n}\n\nif (md5('hello') != '5d41402abc4b2a76b9719d911017c592') {\n\tfunction add32(x, y) {\n\t\tvar lsw = (x & 0xFFFF) + (y & 0xFFFF),\n\t\tmsw = (x >> 16) + (y >> 16) + (lsw >> 16);\n\t\treturn (msw << 16) | (lsw & 0xFFFF);\n\t}\n}\n","pre":true},"sdk/timestep/ui/TextEditView.js":{"path":"sdk/timestep/ui/TextEditView.js","friendlyPath":"ui.TextEditView","directory":"sdk/timestep/ui/","filename":"TextEditView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import device\");\njsio(\"import ui.TextView as TextView\");\njsio(\"import ui.ImageScaleView as ImageScaleView\");\n\nvar EditText = device.get('EditText');\n\nvar sdk_timestep_ui_TextEditView=__class__;exports=sdk_timestep_ui_TextEditView(function sdk_timestep_ui_TextEditView(){return this.init&&this.init.apply(this,arguments)},ImageScaleView, function(supr) {\n\n    var defaults = {\n        color: 'black',\n        hintColor: \"#979797\",\n        paddingLeft: 20,\n        paddingRight: 20,\n        paddingTop: 0,\n        paddingBottom: 0\n    };\n\n    this.init = function(opts) {\n        this._opts = merge(opts || {}, defaults); \n        supr(this, 'init', [this._opts]);\n\n        this._textBox = new TextView(merge({\n            x: this._opts.paddingLeft,\n            y: this._opts.paddingTop,\n            width: opts.width - this._opts.paddingLeft - this._opts.paddingRight,\n            height: opts.height\n        }, opts));\n\n        this.addSubview(this._textBox);\n        this._focused = false;\n        this._textFilter = null;\n        this._textCursorFilter = null;\n        this._backTextEditView = null;\n        this._forwardTextEditView = null;\n        this._hint = this._opts.hintJs || this._opts.hint;\n        this._hintSet = false;\n        this._cursorPos = -1;\n        this._normalColor = this._opts.color;\n        this._hintColor = this._opts.hintColor;\n        this._editText = new EditText(merge({}, // avoid side effects\n            merge(opts, {\n                title: this._hint,\n                textEditView: this,\n                onChange: bind(this, 'onChange'),\n                onSubmit: bind(this, 'onSubmit'),\n                onFocusChange: bind(this, this.onFocusChange)\n            })\n        ));\n\n        this.setText(this._opts.text || \"\");\n    };\n\n    this.onSubmit = function () {};\n\n    this.onInputSelect = function() {\n        this.requestFocus();\n    };\n\n    this.requestFocus = function() {\n        this._focused = true;\n        this._editText.requestFocus();\n        this.refresh();\n    };\n\n    this.removeFocus = function() {\n        this._editText.closeEditField();\n    };\n\n    this.refresh = function() {\n        this._editText.refresh(this.getText(),\n                               this._backTextEditView != null,\n                               this._forwardTextEditView != null,\n                               this._cursorPos);\n    };\n\n    this.onFocusChange = function (focused) {\n        if (focused) {\n            this.emit('focusAdd');\n        } else {\n            this.emit('focusRemove');\n        }\n    };\n\n    this.onChange = function(value, prevValue, cursorPos) {\n        var isProcessed;\n        var isCursorSet;\n\n        if (value !== this._textBox.getText()) {\n            isProcessed = typeof this._textFilter === 'function';\n            isCursorSet = typeof this._textCursorFilter === 'function';\n            \n            if (isProcessed) {\n                if (isCursorSet) {\n                    this._cursorPos = this._textCursorFilter(value || '', prevValue || '', cursorPos || 0);\n                }\n\n                value = this._textFilter(value || '', prevValue || '');\n            } \n\n            this.setText(value);\n\n            if (isProcessed) {\n                this.refresh(); // update native EditText with processed values\n            }\n\n            this.emit('onChange', value);\n        }\n    };\n\n    this.setBackward = function(view) {\n        this._backTextEditView = view;\n    };\n\n    this.setForward = function(view) {\n        this._forwardTextEditView = view;\n    }\n\n    /**\n     * Accepts a function that takes one string argument\n     * and returns a string. This can be used to process text\n     * entered into the EditText.\n     */\n    this.registerTextFilter = function(fn, fn2) {\n        this._textFilter = fn; \n        this._textCursorFilter = fn2;\n    }\n\n    this.getText = function() {\n        var result;\n\n        if (this._hintSet) {\n            result = \"\"; \n        } else {\n            result = this._textBox.getText();\n        }\n\n        return result;\n    }\n\n    this.getValue = function () {\n        return this._editText.getValue();\n    }\n\n    this.setValue = function (value) {\n        this.setText(value);\n\n        if (this._editText.setValue) {\n            this._editText.setValue(value);\n        }\n    }\n\n    this.setText = function(text) {\n        if ((text == null || (text != null && text.length == 0)) && this._hint != null) {\n            this._hintSet = true;\n            text = this._hint;\n            this._textBox._opts.color = this._hintColor;\n        } else {\n            this._hintSet = false;\n            this._textBox._opts.color = this._normalColor; \n        }\n\n        this._textBox.setText(text);\n    }\n\n    this.setHint = function(hint) {\n        this._hint = hint; \n        this._editText.setHint(hint);\n        this.setText(this.getText());\n    }\n});\n","pre":true},"sdk/timestep/ui/ImageScaleView.js":{"path":"sdk/timestep/ui/ImageScaleView.js","friendlyPath":"ui.ImageScaleView","directory":"sdk/timestep/ui/","filename":"ImageScaleView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ImageScaleView\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html#class-ui.imagescaleview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio(\"import ui.View\");\njsio(\"import ui.resource.Image as Image\");\n\nvar sdk_timestep_ui_ImageScaleView=__class__;exports=sdk_timestep_ui_ImageScaleView(function sdk_timestep_ui_ImageScaleView(){return this.init&&this.init.apply(this,arguments)},ui.View, function (supr) {\n\n\tvar defaults = {\n\t\timage: null,\n\t\tautoSize: false,\n\t\tscaleMethod: 'stretch',\n\t\trenderCenter: true\n\t};\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [merge(opts, defaults)]);\n\t};\n\n\tthis.getScaleMethod = function () {\n\t\treturn this._scaleMethod;\n\t};\n\n\tthis.updateSlices = function (opts) {\n\t\t// reset slice cache\n\t\tthis._renderCacheKey = {};\n\t\tthis._sliceCache = [];\n\t\tfor (var i = 0; i < 9; ++i) {\n\t\t\tvar row = [this._img.getSource(), 0, 0, 0, 0, 0, 0, 0, 0];\n\t\t\trow.render = false;\n\t\t\tthis._sliceCache.push(row);\n\t\t}\n\n\t\t// {horizontal: {left: n, center: n, right: n}, vertical: {top: n, middle: n, bottom: n}}\n\t\tthis._sourceSlices = opts.sourceSlices;\n\t\t// {horizontal: {left: n, right: n}, vertical: {top: n, bottom: n}}\n\t\tthis._destSlices = opts.destSlices || opts.sourceSlices;\n\n\t\tthis._imgScale = opts.imgScale || 1;\n\n\t\tif (!opts.sourceSlices || !(opts.sourceSlices.horizontal || opts.sourceSlices.vertical)) {\n\t\t\tthrow new Error('slice views require sourceSlices.horizontal and/or sourceSlices.vertical');\n\t\t}\n\n\t\tif (opts.scaleMethod === '2slice') {\n\t\t\tif (opts.sourceSlices.horizontal && opts.destSlices.horizontal) {\n\t\t\t\tif (opts.destSlices.horizontal.left) {\n\t\t\t\t\topts.sourceSlices.horizontal.center = opts.sourceSlices.horizontal.right;\n\t\t\t\t\topts.sourceSlices.horizontal.right = 0;\n\t\t\t\t} else if (opts.destSlices.horizontal.right) {\n\t\t\t\t\topts.sourceSlices.horizontal.center = opts.sourceSlices.horizontal.left;\n\t\t\t\t\topts.sourceSlices.horizontal.left = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (opts.sourceSlices.vertical && opts.destSlices.vertical) {\n\t\t\t\tif (opts.destSlices.vertical.top) {\n\t\t\t\t\topts.sourceSlices.vertical.middle = opts.sourceSlices.vertical.bottom;\n\t\t\t\t\topts.sourceSlices.vertical.bottom = 0;\n\t\t\t\t} else if (opts.destSlices.vertical.bottom) {\n\t\t\t\t\topts.sourceSlices.vertical.middle = opts.sourceSlices.vertical.bottom;\n\t\t\t\t\topts.sourceSlices.vertical.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (opts.sourceSlices.horizontal) {\n\t\t\tvar src = opts.sourceSlices.horizontal;\n\t\t\tvar slices = [src.left || 0, src.center || 0, src.right || 0];\n\t\t\tif (src.center == undefined && this._img) { // also captures null, but ignores 0\n\t\t\t\tvar width = this._img.getWidth();\n\t\t\t\tslices[1] = width ? width - slices[0] - slices[2] : 0;\n\t\t\t}\n\n\t\t\tthis._sourceSlicesHor = slices;\n\t\t\tthis._destSlicesHor = [\n\t\t\t\t(this._destSlices.horizontal.left || 0) * this._imgScale,\n\t\t\t\t0,\n\t\t\t\t(this._destSlices.horizontal.right || 0) * this._imgScale\n\t\t\t];\n\t\t} else {\n\t\t\tthis._sourceSlicesHor = [0, 100, 0];\n\t\t\tthis._destSlicesHor = [0, 100, 0];\n\t\t}\n\n\t\tif (opts.sourceSlices.vertical) {\n\t\t\tvar src = opts.sourceSlices.vertical;\n\t\t\tvar slices = [src.top || 0, src.middle || 0, src.bottom || 0];\n\t\t\tif (src.middle == undefined && this._img) {\n\t\t\t\tvar height = this._img.getHeight();\n\t\t\t\tslices[1] = height ? height - slices[0] - slices[2] : 0;\n\t\t\t}\n\n\t\t\tthis._sourceSlicesVer = slices;\n\t\t\tthis._destSlicesVer = [\n\t\t\t\t(this._destSlices.vertical.top || 0) * this._imgScale,\n\t\t\t\t0,\n\t\t\t\t(this._destSlices.vertical.bottom || 0) * this._imgScale\n\t\t\t];\n\t\t} else {\n\t\t\tthis._sourceSlicesVer = [0, 100, 0];\n\t\t\tthis._destSlicesVer = [0, 100, 0];\n\t\t}\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\topts = merge(supr(this, 'updateOpts', arguments), this._opts);\n\n\t\tif (opts.scaleMethod) {\n\t\t\tif (this._scaleMethod != opts.scaleMethod) {\n\t\t\t\tvar key = opts.scaleMethod;\n\t\t\t\tif (/slice$/.test(key)) {\n\t\t\t\t\tkey = 'slice';\n\t\t\t\t}\n\n\t\t\t\tthis.render = renderFunctions[key];\n\t\t\t\tthis._renderCacheKey = {};\n\t\t\t\tthis._scaleMethod = opts.scaleMethod;\n\t\t\t\tthis._isSlice = this._scaleMethod.slice(1) == 'slice';\n\t\t\t}\n\t\t}\n\n\t\tif ('debug' in opts) {\n\t\t\tthis.debug = !!opts.debug;\n\t\t}\n\n\t\tif (this._isSlice && this._img) {\n\t\t\tthis.updateSlices(opts);\n\t\t}\n\n\t\tif (opts.image) {\n\t\t\tthis.setImage(opts.image, opts);\n\t\t}\n\t\tif (opts.verticalAlign) {\n\t\t\tthis._renderCacheKey = {};\n\t\t\tthis._verticalAlign = opts.verticalAlign;\n\t\t}\n\t\tif (opts.align || opts.horizontalAlign) {\n\t\t\tthis._align = opts.align || opts.horizontalAlign;\n\t\t}\n\n\t\tthis.rows = opts.rows;\n\t\tthis.columns = opts.columns;\n\n\t\treturn opts;\n\t};\n\n\tthis._computeSlices = function (w, h, absScale) {\n\t\tvar bounds = this._img.getBounds();\n\t\tvar iw = bounds.width;\n\t\tvar ih = bounds.height;\n\t\tif (iw <= 0 || ih <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar image = this._img.getSource();\n\t\tvar sourceSlicesHor = this._sourceSlicesHor;\n\t\tvar sourceSlicesVer = this._sourceSlicesVer;\n\t\tvar destSlicesHor = [];\n\t\tvar destSlicesVer = [];\n\n\t\tif (sourceSlicesHor) {\n\t\t\tvar ratio = this.style.fixedAspectRatio ? h / ih : 1;\n\t\t\tdestSlicesHor[0] = this._destSlicesHor[0] * ratio;\n\t\t\tdestSlicesHor[2] = this._destSlicesHor[2] * ratio;\n\t\t\tdestSlicesHor[1] = w - destSlicesHor[0] - destSlicesHor[2];\n\n\t\t\tif (destSlicesHor[1] < 0) {\n\t\t\t\tdestSlicesHor[0] = (destSlicesHor[0] * w / (destSlicesHor[0] + destSlicesHor[2])) | 0;\n\t\t\t\tdestSlicesHor[1] = 0;\n\t\t\t\tdestSlicesHor[2] = w - destSlicesHor[0];\n\t\t\t}\n\t\t}\n\n\t\tif (sourceSlicesVer) {\n\t\t\tvar ratio = this.style.fixedAspectRatio ? w / iw : 1;\n\t\t\tdestSlicesVer[0] = this._destSlicesVer[0] * ratio;\n\t\t\tdestSlicesVer[2] = this._destSlicesVer[2] * ratio;\n\t\t\tdestSlicesVer[1] = h - destSlicesVer[0] - destSlicesVer[2];\n\n\t\t\tif (destSlicesVer[1] < 0) {\n\t\t\t\tdestSlicesVer[0] = (destSlicesVer[0] * h / (destSlicesVer[0] + destSlicesVer[2])) | 0;\n\t\t\t\tdestSlicesVer[1] = 0;\n\t\t\t\tdestSlicesVer[2] = h - destSlicesVer[0];\n\t\t\t}\n\t\t}\n\n\t\tvar marginLeft = bounds.marginLeft,\n\t\t\torigLeftSlice = sourceSlicesHor[0] + bounds.marginLeft;\n\t\tif (origLeftSlice) {\n\t\t\tmarginLeft *= destSlicesHor[0] / origLeftSlice;\n\t\t}\n\n\t\tvar marginRight = bounds.marginRight,\n\t\t\torigRightSlice = sourceSlicesHor[2] + bounds.marginRight;\n\t\tif (origRightSlice) {\n\t\t\tmarginRight *= destSlicesHor[2] / origRightSlice;\n\t\t}\n\n\t\tvar marginTop = bounds.marginTop,\n\t\t\torigTopSlice = sourceSlicesVer[0] + bounds.marginTop;\n\t\tif (origTopSlice) {\n\t\t\tmarginTop *= destSlicesVer[0] / origTopSlice;\n\t\t}\n\n\t\tvar marginBottom = bounds.marginBottom,\n\t\t\torigBottomSlice = sourceSlicesVer[2] + bounds.marginBottom;\n\t\tif (origBottomSlice) {\n\t\t\tmarginBottom *= destSlicesVer[2] / origBottomSlice;\n\t\t}\n\n\t\tdestSlicesHor[0] -= marginLeft;\n\t\tdestSlicesVer[0] -= marginTop;\n\t\tdestSlicesHor[2] -= marginRight;\n\t\tdestSlicesVer[2] -= marginBottom;\n\n\t\tvar heightBalance = 0;\n\t\tvar sx, sw, sh;\n\t\tvar sy = bounds.y;\n\t\tvar dx, dw, dh;\n\t\tvar dy = marginTop;\n\t\tvar i, j;\n\n\t\tfor (j = 0; j < 3; j++) {\n\t\t\tvar widthBalance = 0;\n\t\t\tvar idealHeight = destSlicesVer[j] + heightBalance;\n\t\t\tvar roundedHeight = Math.round(absScale * idealHeight) / absScale;\n\t\t\theightBalance = idealHeight - roundedHeight;\n\n\t\t\tsh = sourceSlicesVer[j];\n\t\t\tdh = roundedHeight;\n\t\t\tsx = bounds.x;\n\t\t\tdx = marginLeft;\n\t\t\tfor (i = 0; i < 3; i++) {\n\t\t\t\tvar idealWidth = destSlicesHor[i] + widthBalance;\n\t\t\t\tvar roundedWidth = Math.round(absScale * idealWidth) / absScale;\n\t\t\t\twidthBalance = idealWidth - roundedWidth;\n\n\t\t\t\tsw = sourceSlicesHor[i];\n\t\t\t\tdw = roundedWidth;\n\n\t\t\t\tvar cache = this._sliceCache[j * 3 + i];\n\t\t\t\tif (sw > 0 && sh > 0 && dw > 0 && dh > 0) {\n\t\t\t\t\tcache[1] = sx;\n\t\t\t\t\tcache[2] = sy;\n\t\t\t\t\tcache[3] = sw;\n\t\t\t\t\tcache[4] = sh;\n\t\t\t\t\tcache[5] = dx;\n\t\t\t\t\tcache[6] = dy;\n\t\t\t\t\tcache[7] = dw;\n\t\t\t\t\tcache[8] = dh;\n\t\t\t\t\tcache.render = true;\n\t\t\t\t} else {\n\t\t\t\t\tcache.render = false;\n\t\t\t\t}\n\n\t\t\t\tsx += sw;\n\t\t\t\tdx += dw;\n\t\t\t}\n\t\t\tsy += sh;\n\t\t\tdy += dh;\n\n\t\t\tmarginTop = 0;\n\t\t}\n\t};\n\n\tthis.getImage = function () {\n\t\treturn this._img;\n\t};\n\n\tthis.setImage = function (img, opts) {\n\t\tvar autoSized = false;\n\t\tvar sw, sh, iw, ih, bounds;\n\t\topts = merge(opts, this._opts);\n\n\t\tif (typeof img == 'string') {\n\t\t\tbounds = GCResources.getMap()[img];\n\t\t\tif (bounds) {\n\t\t\t\tiw = bounds.w + bounds.marginLeft + bounds.marginRight;\n\t\t\t\tih = bounds.h + bounds.marginTop + bounds.marginBottom;\n\t\t\t}\n\t\t} else if (img instanceof Image && img.isLoaded()) {\n\t\t\tbounds = img.getBounds();\n\t\t\tiw = bounds.width + bounds.marginLeft + bounds.marginRight;\n\t\t\tih = bounds.height + bounds.marginTop + bounds.marginBottom;\n\t\t}\n\n\t\tif (!bounds) {\n\t\t\tif (typeof img == 'string') {\n\t\t\t\timg = new Image({url: img});\n\t\t\t}\n\n\t\t\tif (!img.isError()) {\n\t\t\t\treturn img.doOnLoad(this, 'setImage', img, opts);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (opts.autoSize && this._scaleMethod == 'stretch' && !((opts.width || opts.layoutWidth) && (opts.height || opts.layoutHeight))) {\n\t\t\tautoSized = true;\n\t\t\tif (this.style.fixedAspectRatio) {\n\t\t\t\tthis.style.enforceAspectRatio(iw, ih);\n\t\t\t} else {\n\t\t\t\tthis.style.width = iw;\n\t\t\t\tthis.style.height = ih;\n\t\t\t}\n\t\t}\n\n\t\tthis._img = (typeof img == 'string') ? new Image({url: img}) : img;\n\n\t\tif (this._isSlice) {\n\t\t\tthis.updateSlices({\n\t\t\t\tscaleMethod: this._opts.scaleMethod,\n\t\t\t\tsourceSlices: this._opts.sourceSlices,\n\t\t\t\tdestSlices: this._opts.destSlices\n\t\t\t});\n\n\t\t\tvar sourceSlicesHor = this._sourceSlicesHor;\n\t\t\tvar sourceSlicesVer = this._sourceSlicesVer;\n\t\t\tif (sourceSlicesHor) {\n\t\t\t\tsw = sourceSlicesHor[0] + sourceSlicesHor[1] + sourceSlicesHor[2];\n\t\t\t\tvar sourceScaleX = iw / sw;\n\t\t\t\tsourceSlicesHor[0] = sourceSlicesHor[0] * sourceScaleX - bounds.marginLeft;\n\t\t\t\tsourceSlicesHor[1] *= sourceScaleX;\n\t\t\t\tsourceSlicesHor[2] = sourceSlicesHor[2] * sourceScaleX - bounds.marginRight;\n\t\t\t}\n\t\t\tif (sourceSlicesVer) {\n\t\t\t\tsh = sourceSlicesVer[0] + sourceSlicesVer[1] + sourceSlicesVer[2];\n\t\t\t\tvar sourceScaleY = ih / sh;\n\t\t\t\tsourceSlicesVer[0] = sourceSlicesVer[0] * sourceScaleY - bounds.marginTop;\n\t\t\t\tsourceSlicesVer[1] *= sourceScaleY;\n\t\t\t\tsourceSlicesVer[2] = sourceSlicesVer[2] * sourceScaleY - bounds.marginBottom;\n\t\t\t}\n\t\t\t[0, 2].forEach(function(num) {\n\t\t\t\tif (sourceSlicesHor && sourceSlicesHor[num] < 0) {\n\t\t\t\t\tsourceSlicesHor[1] += sourceSlicesHor[num];\n\t\t\t\t\tsourceSlicesHor[num] = 0;\n\t\t\t\t}\n\t\t\t\tif (sourceSlicesVer && sourceSlicesVer[num] < 0) {\n\t\t\t\t\tsourceSlicesVer[1] += sourceSlicesVer[num];\n\t\t\t\t\tsourceSlicesVer[num] = 0;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this._img) {\n\t\t\tif (opts && opts.autoSize && !autoSized) {\n\t\t\t\tthis._img.doOnLoad(this, 'autoSize');\n\t\t\t}\n\n\t\t\tthis._img.doOnLoad(this, 'needsRepaint');\n\t\t}\n\t};\n\n\tthis.doOnLoad = function () {\n\t\tif (arguments.length == 1) {\n\t\t\tthis._img.doOnLoad(this, arguments[0]);\n\t\t} else {\n\t\t\tthis._img.doOnLoad.apply(this._img, arguments);\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.autoSize = function () {\n\t\tif (this._img && this._img.isLoaded()) {\n\t\t\tthis.style.width = this._img.getWidth() || this._opts.width;\n\t\t\tthis.style.height = this._img.getHeight() || this._opts.height;\n\t\t}\n\t};\n\n\tthis.getOrigWidth = this.getOrigW = function () {\n\t\treturn this._img.getOrigW();\n\t};\n\n\tthis.getOrigHeight = this.getOrigH = function () {\n\t\treturn this._img.getOrigH();\n\t};\n\n\tfunction renderCoverOrContain(ctx, opts) {\n\t\tif (!this._img) { return; }\n\n\t\tvar max = Math.max;\n\t\tvar min = Math.min;\n\t\tvar s = this.style;\n\t\tvar w = s.width;\n\t\tvar h = s.height;\n\t\tvar cachedKey = this._renderCacheKey;\n\t\tvar cache = this._renderCache || (this._renderCache = {x: 0, y: 0, w: 0, h: 0});\n\t\tif (cachedKey.width != w || cachedKey.height != h) {\n\t\t\tcachedKey.width = w;\n\t\t\tcachedKey.height = h;\n\n\t\t\tvar bounds = this._img.getBounds();\n\t\t\tvar marginLeft = bounds.marginLeft;\n\t\t\tvar marginRight = bounds.marginRight;\n\t\t\tvar marginTop = bounds.marginTop;\n\t\t\tvar marginBottom = bounds.marginBottom;\n\t\t\tvar sw = bounds.width;\n\t\t\tvar sh = bounds.height;\n\t\t\tvar ow = sw + marginLeft + marginRight;\n\t\t\tvar oh = sh + marginTop + marginBottom;\n\t\t\tvar scale = 1;\n\t\t\tvar targetRatio = ow / oh;\n\t\t\tvar ratio = w / h;\n\n\t\t\tvar isCover = this._scaleMethod == 'cover';\n\t\t\tif (isCover ? ratio > targetRatio : ratio < targetRatio) {\n\t\t\t\tscale = w / ow;\n\t\t\t} else {\n\t\t\t\tscale = h / oh;\n\t\t\t}\n\n\t\t\tvar dw = sw * scale;\n\t\t\tvar dh = sh * scale;\n\t\t\tvar fw = ow * scale;\n\t\t\tvar fh = oh * scale;\n\n\t\t\tcache.x = this._align == 'left'\n\t\t\t\t? marginLeft * scale\n\t\t\t\t: this._align == 'right'\n\t\t\t\t\t? w - (sw + marginRight) * scale\n\t\t\t\t\t: (w - dw) / 2;\n\t\t\tcache.y = this._verticalAlign == 'top'\n\t\t\t\t? marginTop * scale\n\t\t\t\t: this._verticalAlign == 'bottom'\n\t\t\t\t\t? h - (sh + marginBottom) * scale\n\t\t\t\t\t: (h - dh) / 2;\n\n\t\t\tcache.w = dw;\n\t\t\tcache.h = dh;\n\t\t\tcache.sx = bounds.x;\n\t\t\tcache.sy = bounds.y;\n\t\t\tcache.sw = sw;\n\t\t\tcache.sh = sh;\n\n\t\t\tif (isCover) {\n\t\t\t\tif (fh > h) {\n\t\t\t\t\tif (this._verticalAlign == 'bottom') {\n\t\t\t\t\t\tcache.y = max(0, h - marginBottom * scale - dh);\n\t\t\t\t\t\tcache.h = min(dh, h - marginBottom * scale);\n\t\t\t\t\t\tcache.sy += max(0, sh - cache.h / scale);\n\t\t\t\t\t\tcache.sh = cache.h / scale;\n\t\t\t\t\t} else if (this._verticalAlign == 'top') {\n\t\t\t\t\t\tcache.y = marginTop * scale;\n\t\t\t\t\t\tcache.h = min(dh, h - cache.y);\n\t\t\t\t\t\tcache.sh = cache.h / scale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcache.y = max(0, (h - dh) / 2);\n\t\t\t\t\t\tcache.h = min(dh, h);\n\t\t\t\t\t\tcache.sh = cache.h / scale;\n\t\t\t\t\t\tcache.sy = max(0, (sh - cache.sh) / 2);\n\t\t\t\t\t}\n\t\t\t\t} else if (fw > w) {\n\t\t\t\t\tif (this._align == 'right') {\n\t\t\t\t\t\tcache.x = max(0, w - marginRight * scale - dw);\n\t\t\t\t\t\tcache.w = min(dw, w - marginRight * scale);\n\t\t\t\t\t\tcache.sx += max(0, sw - cache.w / scale);\n\t\t\t\t\t\tcache.sw = cache.w / scale;\n\t\t\t\t\t} else if (this._align == 'left') {\n\t\t\t\t\t\tcache.x = marginLeft * scale;\n\t\t\t\t\t\tcache.w = min(dw, w - cache.x);\n\t\t\t\t\t\tcache.sw = cache.w / scale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcache.x = max(0, (w - dw) / 2);\n\t\t\t\t\t\tcache.w = min(dw, w);\n\t\t\t\t\t\tcache.sw = cache.w / scale;\n\t\t\t\t\t\tcache.sx = max(0, (sw - cache.sw) / 2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._img.render(ctx, cache.sx, cache.sy, cache.sw, cache.sh, cache.x, cache.y, cache.w, cache.h);\n\n\t\tif (this.debug) {\n\t\t\tctx.strokeStyle = debugColors[0];\n\t\t\tctx.strokeRect(0, 0, s.width, s.height);\n\t\t}\n\t}\n\n\tvar renderFunctions = {\n\t\t'none': function (ctx, opts) {\n\t\t\tthis._img && this._img.render(ctx, 0, 0);\n\t\t},\n\t\t'stretch': function (ctx, opts) {\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\t\t\tthis._img && this._img.render(ctx, 0, 0, w, h);\n\t\t},\n\t\t'contain': renderCoverOrContain,\n\t\t'cover': renderCoverOrContain,\n\t\t'tile': function (ctx, opts) {\n\t\t\tif (!this._img) { return; }\n\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\n\t\t\tvar bounds = this._img.getBounds();\n\t\t\tvar iw = bounds.width;\n\t\t\tvar ih = bounds.height;\n\n\t\t\tvar x = 0, y = 0;\n\n\t\t\tif (this.rows) {\n\t\t\t\tvar targetHeight = h / this.rows;\n\t\t\t\tvar targetRatio = targetHeight / ih;\n\t\t\t\tvar targetWidth = iw * targetRatio;\n\t\t\t\tfor (var i = 0; i < this.rows; i++) {\n\t\t\t\t\twhile (x < w) {\n\t\t\t\t\t\tthis._img.render(ctx, x, y, targetWidth, targetHeight);\n\t\t\t\t\t\tif (this.debug) {\n\t\t\t\t\t\t\tctx.strokeStyle = debugColors[i % 3];\n\t\t\t\t\t\t\tctx.strokeRect(x + 0.5, y + 0.5, targetWidth - 1, targetHeight - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tx += targetWidth;\n\t\t\t\t\t}\n\t\t\t\t\ty += targetHeight;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.columns) {\n\t\t\t\tvar targetWidth = w / this.columns;\n\t\t\t\tvar targetRatio = targetWidth / iw;\n\t\t\t\tvar targetHeight = ih * targetRatio;\n\t\t\t\tfor (var i = 0; i < this.columns; i++) {\n\t\t\t\t\twhile (y < h) {\n\t\t\t\t\t\tthis._img.render(ctx, x, y, targetWidth, targetHeight);\n\t\t\t\t\t\tif (this.debug) {\n\t\t\t\t\t\t\tctx.strokeStyle = debugColors[i % 3];\n\t\t\t\t\t\t\tctx.strokeRect(x + 0.5, y + 0.5, targetWidth - 1, targetHeight - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ty += targetHeight;\n\t\t\t\t\t}\n\t\t\t\t\tx += targetWidth;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t'slice': function (ctx, opts) {\n\t\t\tif (!this._img) { return; }\n\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\t\t\tvar scale = s.scale;\n\t\t\tvar cachedKey = this._renderCacheKey;\n\t\t\tif (cachedKey.width != w || cachedKey.height != h || cachedKey.absScale != scale) {\n\t\t\t\tcachedKey.width = w;\n\t\t\t\tcachedKey.height = h;\n\t\t\t\tcachedKey.absScale = scale;\n\t\t\t\tthis._computeSlices(w, h, scale);\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < 9; i++) {\n\t\t\t\tthis._drawSlice(ctx, this._sliceCache[i], i);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._drawSlice = function (ctx, sliceData, i) {\n\t\tif (!sliceData.render) { return; }\n\t\tctx.drawImage.apply(ctx, sliceData);\n\t\tif (this.debug) {\n\t\t\tctx.strokeStyle = debugColors[i % 3];\n\t\t\tctx.strokeRect(sliceData[5] + 0.5, sliceData[6] + 0.5,\n\t\t\t\tsliceData[7] - 1, sliceData[8] - 1);\n\t\t}\n\t};\n\n\tvar debugColors = ['#FF0000', '#00FF00', '#0000FF'];\n\n\tthis.getTag = function () {\n\t\treturn 'ImageScaleView' + this.uid + ':' + (this._img && this._img._map.url.substring(0, 16));\n\t};\n});\n","pre":true},"sdk/plugins/weeby/weebyAbTests.js":{"path":"sdk/plugins/weeby/weebyAbTests.js","friendlyPath":".weebyAbTests","directory":"sdk/plugins/weeby/","filename":"weebyAbTests.js","src":"jsio(\"import event.Emitter as Emitter\");\njsio(\"import .weebyLocalData\");\njsio(\"import .trackers.trackers as trackers\");\n\nWeebyAbTests=__class__;var WeebyAbTests=WeebyAbTests(function WeebyAbTests(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\n\tvar uid = 0;\n\tfunction u() {\n\t\treturn uid++;\t\n\t}\n\n\t// ab test config. `this.tests` keys represent the\n\t// name of a single ab test. The inner keys represent\n\t// the different segments for each ab test. Note that the keys\n\t// are converted to strings when tracked. Each ab test segment key\n\t// must map to a unique value.\n\tthis.tests = {\n\t\tABTest_authVariant: {\n\t\t\tCONTROL: u(),\n\t\t\tNO_SPLASH: u(),\n\t\t\tVARIANT2: u()\n\t\t}\t\n\t};\n\n\tthis.ABTest_authVariant = this.tests.ABTest_authVariant; // shorthand\n\t\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', arguments); \n\n\t\tthis._currentTests = weebyLocalData.getAbTests();\n\t};\n\n\tthis.setup = function() {\n\t\tvar testNames = Object.keys(this.tests);\n\t\tvar testsChanged = false;\n\n\t\tfor (var i = 0; i < testNames.length; i++) {\n\t\t\tvar testName = testNames[i];\n\t\t\tvar testKeys = Object.keys(this.tests[testName]);\n\n\t\t\t// set new test group if we do not have one\n\t\t\tif (this._currentTests[testName] == null) {\n\t\t\t\ttestsChanged = true;\n\t\t\t\tthis._currentTests[testName] = testKeys[~~(Math.random() * testKeys.length)];\n\t\t\t}\n\n\t\t\t// track ab tests with every event\n\t\t\ttrackers.addGlobalProperty(testName, this._currentTests[testName]);\t\n\t\t}\n\n\t\tif (testsChanged) {\n\t\t\tweebyLocalData.setAbTests(this._currentTests);\n\t\t}\n\t};\n\n\tthis.isAbTest = function(testName, testVal) {\n\t\tvar testNames = Object.keys(this.tests);\t\n\n\t\tfor (var i = 0; i < testNames.length; i++) {\n\t\t\tif (this.tests[testNames[i]] === testName) {\n\t\t\t\treturn testName[this._currentTests[testNames[i]]] === testVal;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n});\n\nvar weebyAbTests = new WeebyAbTests();\nexports = weebyAbTests;\n","pre":true},"sdk/plugins/weeby/WeebyConfig.js":{"path":"sdk/plugins/weeby/WeebyConfig.js","friendlyPath":".WeebyConfig","directory":"sdk/plugins/weeby/","filename":"WeebyConfig.js","src":"jsio(\"import util.ajax as ajax\");\n\nvar sdk_plugins_weeby_WeebyConfig=__class__;exports=sdk_plugins_weeby_WeebyConfig(function sdk_plugins_weeby_WeebyConfig(){return this.init&&this.init.apply(this,arguments)},function() {\n\n\tvar defaults = {\n\t\tpath: './weebyConfig.json'\n\t};\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, defaults);\n\t\tthis._path = opts.path;\t\n\t\tthis._strings = null;\n\t\tthis._read();\n\t};\n\n\t// go through each string in the given object and attempt\n\t// to localize them (applies recursively to inner objects)\n\tthis._makeLocalized = function (obj) {\n\t\tfor (key in obj) {\n\t\t\tvar o = obj[key];\n\t\t\tvar oType = typeof o;\n\t\t\tif (oType == 'object') {\n\t\t\t\tthis._makeLocalized(o);\n\t\t\t} else if (oType == 'string') {\n\t\t\t\tobj[key] = this.getString(o);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis._read = function () {\n\t\tconsole.log(\"Reading embedded config:\", this._path);\n\t\ttry {\n\t\t\tthis._configData = JSON.parse(CACHE[this._path]);\n\t\t\tif (this._configData.stringsDir) {\n\t\t\t\tvar language = navigator.language && navigator.language.split('-')[0].toLowerCase() || 'en';\n\t\t\t\tvar enStrings = this._configData.stringsDir + 'en.json';\n\t\t\t\tvar stringFile = this._configData.stringsDir + language + '.json';\n\t\t\t\tvar strings = CACHE[stringFile] || CACHE[enStrings];\n\t\t\t\tif (strings) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis._strings = JSON.parse(strings);\n\t\t\t\t\t\tthis._makeLocalized(this._configData);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error(\"Count not read weebyconfig strings file:\");\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(\"Could not find weebyconfig string file:\" + stringFile);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Could not read embedded config:\");\n\t\t\tconsole.error(e);\n\t\t}\n\t};\n\n\tthis.getString = function (key) {\n\t\tvar outString = key;\n\t\tif (this._strings && this._strings[key]) {\n\t\t\toutString = this._strings[key];\n\t\t}\n\t\treturn outString;\n\t};\n\n\tthis.getEquipSlots = function () {\n\t\treturn this._configData.equipSlots;\n\t};\n\n\tthis.getEquipItems = function () {\n\t\treturn this._configData.equipItems;\n\t};\n\n\tthis.getCommonCurrencyPurchases = function () {\n\t\treturn this._configData.buyItems.common;\n\t};\n\n\tthis.getPremiumCurrencyPurchases = function () {\n\t\treturn this._configData.buyItems.premium;\n\t};\n\n\tthis.getLifePurchases = function () {\n\t\treturn this._configData.buyItems.life;\n\t};\n\n\tthis.getSoftCurrency = function () {\n\t\treturn this._configData.currencies.common;\n\t};\n\n\tthis.getHardCurrency = function () {\n\t\treturn this._configData.currencies.premium;\n\t};\n\n\tthis.getLifeCurrency = function () {\n\t\treturn this._configData.currencies.life;\n\t};\n\n\tthis.getBalance = function () {\n\t\treturn this._configData.balance;\n\t};\n\n\tthis.getLifeRegenTime = function () {\n\t\treturn this._configData.lifeRegenTimeMS;\n\t};\n\n\tthis.getMaxLives = function () {\n\t\treturn this._configData.maxLives;\n\t};\n\n\tthis.getSongs = function () {\n\t\treturn this._configData.songs;\n\t};\n\n\tthis.getCurrencies = function () {\n\t\treturn this._configData.currencies;\n\t};\n\n\tthis.getNotifications = function () {\n\t\treturn this._configData.notifications;\n\t};\n});\n","pre":true},"sdk/plugins/weeby/models/LeaderboardGame.js":{"path":"sdk/plugins/weeby/models/LeaderboardGame.js","friendlyPath":".models.LeaderboardGame","directory":"sdk/plugins/weeby/models/","filename":"LeaderboardGame.js","src":"jsio(\"import ..util.readJSON as readJSON\");\njsio(\"import .Ladder\");\njsio(\"import .User\");\n\nvar sdk_plugins_weeby_models_LeaderboardGame=__class__;exports=sdk_plugins_weeby_models_LeaderboardGame(function sdk_plugins_weeby_models_LeaderboardGame(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function (weebyConfig, api, user) {\n\t\tthis._api = api;\n\t\tthis._user = user;\n\n\t\tvar rawConfig = weebyConfig._configData;\n\t\tvar balance = rawConfig.balance;\n\t\tthis._minScoreForXP = readJSON.getInt(balance, 'minScoreForXP', 10000);\n\t\tthis._minAdjustedScore = readJSON.getInt(balance, 'minAdjustedScore', 50000);\n\t\tthis._maxAdjustedScore = readJSON.getInt(balance, 'maxAdjustedScore', 1000000);\n\n\t\tthis._bonusScoreMultiplier = readJSON.getFloat(balance, 'bonusScoreMultiplier', 0.05);\n\t\tthis._gainedCurrencyMultiplier = readJSON.getFloat(balance, 'gainedCurrencyMultiplier', 0.0000025);\n\t\tthis._gainedXPMultiplier = readJSON.getFloat(balance, 'gainedXpMultiplier', 0.01);\n\n\t\tthis._ladder = new Ladder(api, user);\n\t};\n\n\tthis.getLadder = function () { return this._ladder; };\n\n\t/**\n\t * Returns the total experience required to reach the specified level\n\t */\n\tthis.getXPForLevel = function (level) {\n\t\tif (level <= 1) {\n\t\t\treturn 0;\n\t\t} else if (level == 2) {\n\t\t\treturn 200;\n\t\t} else if (level == 3) {\n\t\t\treturn 500;\n\t\t} else if (level == 4) {\n\t\t\treturn 900;\n\t\t} else {\n\t\t\treturn 900 + ((level - 4) * 1000) + (100 * Math.pow(level - 4, 2));\n\t\t}\n\t};\n\n\t/**\n\t * Returns the score multiplier for the provided level\n\t */\n\tthis._getScoreMultiplier = function (level) {\n\t\t// First 10 levels get 1% bonus per level. e.g. Level 5 = 5% bonus, level 9 = 9% bonus\n\t\t// After level 10, increase per level is halved. e.g level 12 = 11%, level 16 = 13%\n\t\tvar multiplier = (level < 10 ? level : 10 + (level - 10) / 2) / 100;\n\t\treturn multiplier;\n\t}\n\n\t/**\n\t * Returns the total bonus score at your current level\n\t */\n\tthis.getBonusScore = function (level, baseScore) {\n\t\treturn Math.floor(this._getScoreMultiplier(level) * baseScore);\n\t};\n\n\t/**\n\t * Returns raw score needed by a user at level to reach scoreWithBonus\n\t */\n\tthis.getRawScore = function (level, scoreWithBonus) {\n\t\treturn Math.floor(scoreWithBonus / (1 + this._getScoreMultiplier(level)));\n\t}\n\n\tthis.getXPForScore = function (currentExperience, currentLevel, totalScore, gameId) {\n\t\t// First 9 games give constant 100 experience, enough to reach level 4\n\t\tif (gameId <= 9) {\n\t\t\treturn 100;\n\t\t} else {\n\t\t\t// Only award experience for score > minScore to avoid low-score experience farming\n\t\t\tif (totalScore > this._minScoreForXP) {\n\t\t\t\t// Get adjusted score between specified min and max value\n\t\t\t\tvar adjustedScore = Math.max(this._minAdjustedScore, Math.min(totalScore, this._maxAdjustedScore));\n\n\t\t\t\t// get normalized value between 0 and 1\n\t\t\t\tvar normalizedScore = (adjustedScore - this._minAdjustedScore) / (this._maxAdjustedScore - this._minAdjustedScore);\n\t\t\t\t\n\t\t\t\t// min score should take ~10 games to level up, max score should take ~5 games to level up\n\t\t\t\tvar timesToPlay = 10 - normalizedScore * 5;\n\n\t\t\t\treturn ((this.getXPForLevel(currentLevel + 1, gameId) - this.getXPForLevel(currentLevel, gameId)) / timesToPlay);\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getCommonCurrencyReward = function (levelBefore, totalScore) {\n\t\treturn Math.floor(totalScore * this._gainedCurrencyMultiplier);\n\t}\n\n\tthis.getBonusLivesReward = function (levelBefore, totalScore) {\n\t\treturn 0;\n\t};\n});\n","pre":true},"sdk/plugins/weeby/util/readJSON.js":{"path":"sdk/plugins/weeby/util/readJSON.js","friendlyPath":"..util.readJSON","directory":"sdk/plugins/weeby/util/","filename":"readJSON.js","src":"exports.getInt = function (obj, key, fallback) {\n\tif (!obj && !fallback) {\n\t\tthrow new Error(\"No object provided when trying to read the required value for key \" + key);\n\t}\n\n\tif (obj && (key in obj)) {\n\t\tif (typeof obj[key] != 'number' || Math.floor(obj[key]) != obj[key]) {\n\t\t\tthrow new Error(\"Value found for key \" + key + \" was not an integer: type \" + typeof obj[key]);\n\t\t}\n\t\treturn obj[key];\n\t}\n\n\treturn fallback;\n}\n\nexports.getFloat = function (obj, key, fallback) {\n\tif (!obj && !fallback) {\n\t\tthrow new Error(\"No object provided when trying to read the required value for key \" + key);\n\t}\n\n\tif (obj && (key in obj)) {\n\t\tif (typeof obj[key] != 'number') {\n\t\t\tthrow new Error(\"Value found for key \" + key + \" was not a float: type \" + typeof obj[key]);\n\t\t}\n\t\treturn obj[key];\n\t}\n\n\treturn fallback;\n}\n\n\n","pre":true},"sdk/plugins/weeby/models/Ladder.js":{"path":"sdk/plugins/weeby/models/Ladder.js","friendlyPath":".Ladder","directory":"sdk/plugins/weeby/models/","filename":"Ladder.js","src":"jsio(\"import squill.models.DataSource as DataSource\");\njsio(\"import event.Emitter as Emitter\");\n\njsio(\"import ..weebyLocalData\");\njsio(\"import ..models.localStorageModel as localStorageModel\");\n\n// sample item:\n\n/*\n{\n  \"gifts\": [\n    {\n      \"data\": {},\n      \"created\": \"2013-06-24T01:12:09Z\",\n      \"sourceUser\": {\n        \"image\": \"http://s.wee.cat/users/f30dedad59394b5f9c21f605b49d28b4/image.png\",\n        \"nickname\": \"mc\",\n        \"name\": \"Apple\",\n        \"id\": \"f30dedad59394b5f9c21f605b49d28b4\"\n      },\n      \"message\": null,\n      \"id\": \"a8a758b2547343b0a16663d3f1e9f1bd\",\n      \"targetUser\": {\n        \"image\": \"http://s.wee.cat/users/0afdbdb7021e4f54912a85482c1dd408/image.png\",\n        \"nickname\": \"A nick name\",\n        \"name\": \"Jimmy Griffith\",\n        \"id\": \"0afdbdb7021e4f54912a85482c1dd408\"\n      },\n      \"accepted\": false\n    }\n  ],\n  \"score\": 1436979,\n  \"percentile\": null,\n  \"gift\": {\n    \"data\": {},\n    \"created\": \"2013-06-24T01:12:09Z\",\n    \"sourceUser\": {\n      \"image\": \"http://s.wee.cat/users/f30dedad59394b5f9c21f605b49d28b4/image.png\",\n      \"nickname\": \"mc\",\n      \"name\": \"Apple\",\n      \"id\": \"f30dedad59394b5f9c21f605b49d28b4\"\n    },\n    \"message\": null,\n    \"id\": \"a8a758b2547343b0a16663d3f1e9f1bd\",\n    \"targetUser\": {\n      \"image\": \"http://s.wee.cat/users/0afdbdb7021e4f54912a85482c1dd408/image.png\",\n      \"nickname\": \"A nick name\",\n      \"name\": \"Jimmy Griffith\",\n      \"id\": \"0afdbdb7021e4f54912a85482c1dd408\"\n    },\n    \"accepted\": false\n  },\n  \"experience\": 9021,\n  \"created\": \"2013-07-03T00:11:48Z\",\n  \"friend\": true,\n  \"level\": 9,\n  \"user\": {\n    \"verified\": true,\n    \"image\": \"http://s.wee.cat/users/f30dedad59394b5f9c21f605b49d28b4/image.png\",\n    \"nickname\": \"mc\",\n    \"name\": \"Apple\",\n    \"id\": \"f30dedad59394b5f9c21f605b49d28b4\"\n  }\n}\n\n*/\n\nvar sdk_plugins_weeby_models_Ladder=__class__;exports=sdk_plugins_weeby_models_Ladder(function sdk_plugins_weeby_models_Ladder(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\tthis.init = function (api, user) {\n\t\tthis._api = api;\n\t\tthis._user = user;\n\n\t\tthis._list = new DataSource({\n\t\t\tkey: 'id',\n\t\t\tsorter: function (item) {\n\t\t\t\t// JS max int is 9007199254740992\n\t\t\t\t// sort backwards by score (highest first)\n\t\t\t\t// then sort alphabetically (a to z)\n\t\t\t\treturn (9000000000000000 - item.score)\n\t\t\t\t\t+ '|' + (item.name ? item.name.toLowerCase() : '')\n\t\t\t\t\t+ '|' + item.id;\n\t\t\t}\n\t\t});\n\n\t\ttry {\n\t\t\tvar ladderData = localStorageModel.getData('LADDER');\n\t\t\tvar ladderID = localStorageModel.getData('LADDER_ID');\n\t\t\tif (ladderData && ladderID) {\n\t\t\t\tthis._updateList(parseInt(ladderID, 10), ladderData, true);\n\t\t\t} else {\n\t\t\t\tthis._generateMyEntry();\n\t\t\t}\n\n\t\t\tvar expiration = weebyLocalData.getLadderExpiration();\n\t\t\tif (expiration) {\n\t\t\t\tthis._expiration = new Date(expiration);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlogger.error(e);\n\t\t}\n\n\t\tthis._user.on('ConfirmedFriends', bind(this, '_onConfirmFriends'));\n\t};\n\n\tthis._generateMyEntry = function () {\n\t\t// create a function\n\t\tvar id = this._user.getID();\n\n\t\t// your ID is null by default\n\t\tif (!id) { id = '__unknownUserID'; }\n\n\t\tthis._list.add({\n\t\t\tid: id,\n\t\t\tname: this._user.getNickname() || this._user.getName(),\n\t\t\trank: 1,\n\t\t\tuser: {\n\t\t\t\tid: id,\n\t\t\t\tnickname: this._user.getNickname(),\n\t\t\t\tname: this._user.getName(),\n\t\t\t\tiamge: this._user.getPhotoURL()\n\t\t\t}\n\t\t});\n\t}\n\n\tthis.refresh = function (cb) {\n\n\t\tthis._api.getLadder(bind(this, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\tconsole.log('Error getting ladder');\n\t\t\t} else {\n\t\t\t\tthis._expiration = data.expiration;\n\t\t\t\tthis._updateList(this._user.getID(), data.items);\n\n\t\t\t\tcb && cb(null, {\n\t\t\t\t\treceivedGifts: this._api.getGifts(),\n\t\t\t\t\tsentGits: data.sentGifts || this._sentGifts || [],\n\t\t\t\t\tladder: this._list\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\n\t\tthis._user.updateUnconfirmedFriends();\n\t}\n\n\t// returns an instance of Date\n\tthis.getExpiration = function () {\n\t\tif (DEBUG && this._api.isMock()) {\n\t\t\treturn new Date(Date.now() + Math.random() * 1000 * 60 * 60 * 24 * 7);\n\t\t}\n\t\treturn this._expiration;\n\t}\n\n\tthis.getList = function () {\n\t\treturn this._list;\n\t};\n\n\tthis._onConfirmFriends = function (data) {\n\t\tthis.refresh();\n\t}\n\n\t/**\n\t * takes a list foramtted by the server and adds\n\t * it to the internal datasource\n\t */\n\tthis._updateList = function (myId, list, dontSave) {\n\t\tthis._myId = myId;\n\n\t\tif (!dontSave) {\n\t\t\tif (this._expiration) {\n\t\t\t\tweebyLocalData.updateLadderExpiration(this._expiration.getTime());\n\t\t\t}\n\t\t\t\n\t\t\tlocalStorageModel.setData('LADDER', list);\n\t\t\tlocalStorageModel.setData('LADDER_ID', myId);\n\t\t}\n\n\t\tvar i = list.length;\n\t\tvar j = 0;\n\t\twhile (i) {\n\t\t\tvar item = list[--i];\n\t\t\tvar id = item.id = item.user.id;\n\t\t\titem.rank = i + 1;\n\t\t\titem.name = item.user && (item.user.nickname || item.user.name);\n\t\t\tif (id == myId) {\n\t\t\t\tthis._myEntry = item;\n\t\t\t}\n\t\t}\n\n\t\tthis._list.clear();\n\t\tthis._list.add(list);\n\t\t\n\t\tif (this._myEntry) {\n\t\t\tif (this._myEntry.score) {\n\t\t\t\t// update the high score if the user has a better score on the server\n\t\t\t\tweebyLocalData.updateHighScore(this._myEntry.score);\n\n\t\t\t\t// use the local high score data for display\n\t\t\t\tthis._myEntry.score = weebyLocalData.getWeeklyHighScore();\n\t\t\t}\n\t\t} else {\n\t\t\tthis._generateMyEntry();\n\t\t}\n\n\t\tthis._recomputeRanks();\n\t};\n\n\tthis._recomputeRanks = function () {\n\t\tvar n = this._list.length;\n\t\tthis._list.sort();\n\t\tvar rank = 1;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tvar item = this._list.getItemForIndex(i);\n\t\t\tif (item.name) {\n\t\t\t\titem.rank = rank++;\n\t\t\t}\n\t\t\tthis._list.add(item);\n\t\t}\n\t};\n\n\t// this.getLives = function () {\n\t// \treturn this._lives;\n\t// };\n\n\t// this.setLives = function (lives) {\n\t// \tthis._lives = lives;\n\t// };\n\n\t// this.getTime = function () {\n\t// \treturn this._time;\n\t// };\n\n\t// this.resetTime = function () {\n\t// };\n\n\tthis.onHighScore = function (score) {\n\t\tif (this._myEntry && score > this._myEntry.score) {\n\t\t\tthis._myEntry.score = score;\n\t\t\tthis._list.updated(this._myEntry);\n\t\t\tthis._recomputeRanks();\n\t\t}\n\t};\n\n\tthis.getMyRank = function () {\n\t\treturn this._myEntry && this._myEntry.rank || 1;\n\t};\n\n\tthis.getMyEntry = function () {\n\t\treturn this._myEntry;\n\t};\n\n\tthis.getEntryAbove = function (rank) {\n\t\tvar aboveEntry = null;\n\t\tvar i = 0;\n\t\tvar entry;\n\t\twhile ((entry = this._list.getItemForIndex(i++))) {\n\t\t\tif (entry.rank == rank) {\n\t\t\t\treturn aboveEntry;\n\t\t\t}\n\n\t\t\tif (entry.rank) {\n\t\t\t\taboveEntry = entry;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getEntryBelow = function (rank) {\n\t\tvar i = 0;\n\t\tvar found = false;\n\t\tvar entry;\n\t\twhile ((entry = this._list.getItemForIndex(i++))) {\n\t\t\tif (entry.rank) {\n\t\t\t\tif (found) {\n\t\t\t\t\treturn entry;\n\t\t\t\t}\n\n\t\t\t\tif (entry.rank == rank) {\n\t\t\t\t\tfound = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.passedScore = function (id, score) {\n\t\tvar list = this._list;\n\t\tvar i = list.length;\n\n\t\twhile (i) {\n\t\t\tvar item = list[--i];\n\t\t\tif ((item.id !== id) && (score > item.score)) {\n\t\t\t\treturn item;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n});\n","pre":true},"sdk/plugins/weeby/models/User.js":{"path":"sdk/plugins/weeby/models/User.js","friendlyPath":".User","directory":"sdk/plugins/weeby/models/","filename":"User.js","src":"jsio(\"import lib.PubSub\");\n\njsio(\"import ..weebyNative\");\n\njsio(\"import ..models.localStorageModel as localStorageModel\");\njsio(\"import ..models.globalStorageModel as globalStorageModel\");\njsio(\"import ..trackers.trackers as trackers\");\n\njsio(\"import .ImageService\");\n\nvar _userImages = ImageService.userImages;\n\nvar STORAGE_KEY = '__WEEBY_PROFILE__';\nvar UPDATE_UNCONFIRMED_FRIENDS_MINUTES = 5; // how long between checks for unconfirmed friends\nvar UPLOAD_CONTACT_INTERVAL_HOURS = 6;\n\nUserModel=__class__;var UserModel=UserModel(function UserModel(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\tthis.init = function () {\n\t\tsupr(this, 'init', arguments);\n\n\t\t// persists to storage\n\t\tthis.id = null;\n\t\tthis.isVerified = false;\n\t\tthis.name = null;\n\t\tthis.nickname = null;\n\t\tthis.status = null;\n\t\tthis.photoURL = null;\n\t\tthis.phoneNumber = null;\n\n\t\tthis.localSync();\n\t};\n\n\t// update from local data\n\tthis.localSync = function () {\n\t\tconsole.log(\"global::::\", JSON.stringify(globalStorageModel.getData(STORAGE_KEY)));\n\t\tconsole.log(\"local:::::\", JSON.stringify(localStorageModel.getData(STORAGE_KEY)));\n\t\tdata = globalStorageModel.getData(STORAGE_KEY) || localStorageModel.getData(STORAGE_KEY);\n\t\tthis.update(data);\n\t}\n\n\tthis.update = function (data) {\n\t\tif (data) {\n\t\t\tif (data.auths) {\n\t\t\t\tvar phoneAuth = data.auths.filter(function (auth) { return auth.service == 'phone'; });\n\t\t\t\tif (phoneAuth[0]) {\n\t\t\t\t\tdata.phoneNumber = phoneAuth[0].token;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.fromJSON(data);\n\t\t\tthis.persist();\n\t\t}\n\t};\n\n\tthis.persist = function() {\n\t\tvar data = this.toJSON();\n\t\tlocalStorageModel.setData(STORAGE_KEY, data);\n\t\tglobalStorageModel.setData(STORAGE_KEY, data);\n\t};\n\n\tthis.toJSON = function () {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tnickname: this.nickname,\n\t\t\tverified: this.isVerified, // NOTE: server returns `verified` rather than `isVerified` so we use that here\n\t\t\tstatus: this.status,\n\t\t\tphotoURL: this.photoURL,\n\t\t\tphoneNumber: this.phoneNumber\n\t\t};\n\t};\n\n\tthis.fromJSON = function (details) {\n\t\tthis.id = details.id;\n\t\tif ('verified' in details) {\n\t\t\t// NOTE: server returns `verified` rather than `isVerified` so we use that here\n\t\t\tthis.isVerified = details.verified;\n\t\t}\n\n\t\t// must be non-empty\n\t\tif (details.name) {\n\t\t\tthis.name = details.name;\n\t\t}\n\n\t\t// can be empty, use 'in'\n\t\tif ('nickname' in details) {\n\t\t\tthis.nickname = details.nickname;\n\t\t}\n\n\t\t// can be empty, use 'in'\n\t\tif ('status' in details) {\n\t\t\tthis.status = details.status;\n\t\t}\n\n\t\tthis.photoURL = details.photoURL || details.image || this.photoURL;\n\t\t_userImages.update(this.id, this.photoURL);\n\n\t\tthis.phoneNumber = details.phoneNumber || this.phoneNumber;\n\t};\n});\n\nvar sdk_plugins_weeby_models_User=__class__;exports=sdk_plugins_weeby_models_User(function sdk_plugins_weeby_models_User(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\tthis.init = function (api) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis._api = api;\n\t\tthis._user = new UserModel();\n\n\t\tthis._unconfirmedFriends = [];\n\n\t\tthis._updateContactsAccess();\n\n\t\tthis._api.login(bind(this, function(error, data) {\n\t\t\tif (error) {\n\t\t\t\t// TODO: try again? what's the error?\n\t\t\t\tweebyNative.setAuthed(false);\n\n\t\t\t\tthis._isAuthed = false;\n\t\t\t} else {\n\t\t\t\tweebyNative.setAuthed(true);\n\t\t\t\tthis._isAuthed = true;\n\n\t\t\t\tthis._updateUser(data);\n\t\t\t}\n\t\t}));\n\n\t\tGC.subscribe('Show', this, '_onShow');\n\t\tGC.subscribe('Hide', this, '_onHide');\n\t};\n\n\tthis._onShow = function () {\n\t\t// Always use local data when the app becomes visible. It's possible the userID\n\t\t// changed in another app while we were in the background.\n\t\tthis._user.localSync();\n\t\tthis._updateContactsAccess();\n\t};\n\n\tthis._onHide = function () {\n\t\tthis._user.persist();\n\t};\n\n\tvar _lastSync = null;\n\t\n\tthis._updateContactsAccess = function () {\n\t\t// possible values for this._contactAccess:\n\t\t// unknown -- can request access to contacts from user\n\t\t// authorized -- can read contacts\n\t\t// denied -- cannot read contacts, user could change in iOS settings\n\t\t// restricted -- cannot read contacts, user cannot change this (no permission)\n\t\tvar access = weebyNative.getContactListAccess();\n\t\tif (access != this._contactsAccess) {\n\t\t\tthis._contactsAccess = access;\n\t\t\tthis.emit('contactsAccessChanged', access);\n\t\t}\n\n\t\tif (this._user.isVerified\n\t\t\t\t&& (!_lastSync || _lastSync + 1000 * 60 * 60 * UPLOAD_CONTACT_INTERVAL_HOURS < Date.now())\n\t\t\t\t&& this.hasContactsAccess())\n\t\t{\n\t\t\t_lastSync = Date.now();\n\n\t\t\tconsole.log(\"=== _update contact access sync started ===\");\n\n\t\t\tthis.syncContacts(function(e, data) {\n\n\t\t\t\tconsole.log(\"=== _update contact access sync end ===\");\n\n\t\t\t\tif (e) {\n\t\t\t\t\tlogger.error('Error uploading contacts', JSON.stringify(e));\n\t\t\t\t} else {\n\t\t\t\t\tlogger.log('Contact upload:', JSON.stringify(data));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// denied means the user has permission to change the status but\n\t// has actively prevented our app from reading contacts. \n\tthis.hasContactsAccess = function () { return this._contactsAccess == 'authorized'; }\n\tthis.canRequestContactsAccess = function () { return this._contactsAccess == 'unknown'; }\n\tthis.canChangeContactsAccess = function () { return this._contactsAccess != 'restricted'; }\n\tthis.syncContacts = function (cb) {\n\t\tthis._api.syncContacts(bind(this, function (err, contacts) {\n\t\t\tif (err) {\n\t\t\t\tconsole.error(\"SYNC CONTACTS ERROR:\");\n\t\t\t\tconsole.error(err);\n\t\t\t\tthis._updateContactsAccess();\n\t\t\t}\n\n\t\t\tcb && cb(err, contacts);\n\t\t}));\n\t}\n\t\n\tthis._updateUser = function (data) {\n\t\tthis._user.update(data);\n\t\tthis._updateUnconfirmedFriends();\n\t\tthis.emit('updated', this);\n\t\tthis.publish('PhotoURLChanged', this._user.photoURL);\n\t};\n\n\tthis.startVerifyPhone = function (data, cb) {\n\t\tthis._api.verifyPhone({\n\t\t\tnumber: data.number\n\t\t}, cb);\n\t}\n\n\tthis.completeVerifyPhone = function (data, cb) {\n\t\tthis._api.completeVerifyPhone(\n\t\t\t{\n\t\t\t\tnumber: data.number,\n\t\t\t\tcode: data.code\n\t\t\t},\n\t\t\tbind(this, function(err, data) {\n\t\t\t\tif (!err) {\n\t\t\t\t\ttrackers.track('auth:enteredCode:success', {code: data.code, source: 'todo'});\n\n\t\t\t\t\t// Update the local phoneNumber field directly\n\t\t\t\t\t// This lets things like the full-name reauth work immediately for this session\n\t\t\t\t\tthis._user.phoneNumber = data.number;\n\n\t\t\t\t\t// update user with verify response\n\t\t\t\t\tthis._updateUser(data.user);\n\t\t\t\t}\n\n\t\t\t\tcb(err, data);\n\t\t\t}));\n\t}\n\n\tthis.getContacts = function () {\n\t\tthis._api.getContacts(bind(this, function (err, res) {\n\t\t\tcb(err, res);\n\n\t\t\t// let the server process contacts for a little bit\n\t\t\t// then refresh the unconfirmed friends list\n\t\t\tsetTimeout(bind(this, '_updateUnconfirmedFriends'), 5000);\n\t\t}));\n\t}\n\n\tthis.hasUnconfirmedFriends = function () { return this._unconfirmedFriends.length; }\n\tthis.getUnconfirmedFriends = function () { return this._unconfirmedFriends; }\n\n\tvar _lastUpdateUnconfirmed = null;\n\tthis.updateUnconfirmedFriends = function () {\n\n\t\t// restrict unconfirmed friend updates to only so often\n\t\tif (!_lastUpdateUnconfirmed || _lastUpdateUnconfirmed + 1000 * 60 * UPDATE_UNCONFIRMED_FRIENDS_MINUTES < Date.now()) {\n\t\t\t_lastUpdateUnconfirmed = Date.now();\n\t\t\tthis._updateUnconfirmedFriends();\n\t\t}\n\t}\n\n\tthis._updateUnconfirmedFriends = function () {\n\t\tif (this._user.isVerified && this._isAuthed && this._user.id) {\n\t\t\tthis._api.getUnconfirmedFriends(this._user.id, bind(this, function (err, unconfirmedFriends) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.log(err);\n\t\t\t\t} else if (unconfirmedFriends && unconfirmedFriends.length) {\n\t\t\t\t\tthis._unconfirmedFriends = unconfirmedFriends;\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\tthis.confirmFriends = function (data) {\n\t\tthis._unconfirmedFriends = [];\n\n\t\tthis._api.confirmFriends({\n\t\t\t\"confirm-ids\": data.acceptedFriends,\n\t\t\t\"reject-ids\": data.blockedFriends\n\t\t}, bind(this, function (err, res) {\n\t\t\tif (err) {\n\t\t\t\tlogger.error(err);\n\t\t\t} else {\n\t\t\t\tthis.emit('ConfirmedFriends', data);\n\t\t\t\tlogger.log(\"Confirmed friends complete\");\n\t\t\t}\n\t\t}));\n\t}\n\n\tthis.isAuthed = function () { return this._isAuthed; };\n\tthis.getAuthKey = function () { return this._api.getAuthKey(); };\n\tthis.isVerified = function () { return this._user.isVerified; };\n\tthis.getID = function () { return this._user.id; };\n\tthis.getName = function () { return this._user.name; };\n\tthis.getNickname = function () { return this._user.nickname; };\n\tthis.getStatus = function () { return this._user.status; };\n\tthis.getPhotoURL = function () { return this._user.photoURL; };\n\n\tthis.getPhotoImage = function () {\n\t\treturn _userImages.get(this._user.id);\n\t}\n\n\t// accepts a base64-encoded image string to post to the server\n\tthis.setPhoto = function (base64Image, cb) {\n\t\tif (base64Image) {\n\n\t\t\tthis.emit('BeforePhotoURLChange');\n\n\t\t\t// show base64 image first\n\t\t\t_userImages.update(this._user.id, 'data:image/png;base64,' + base64Image, true);\n\n\t\t\tthis._api.setProfilePhoto(base64Image, bind(this, function (err, res) {\n\t\t\t\tif (!err) {\n\n\t\t\t\t\t_userImages.update(this._user.id, res.url, true);\n\n\t\t\t\t\tthis._user.photoURL = res.url;\n\t\t\t\t\tthis._user.persist();\n\n\t\t\t\t\tthis.publish('PhotoURLChanged', this._user.photoURL);\n\t\t\t\t}\n\n\t\t\t\tcb && cb(err, {\"photoURL\": res.url});\n\t\t\t}));\n\t\t}\n\t};\n\n\tthis.setName = function (name, cb) {\n\t\tif (name && name != this._user.name) {\n\t\t\tthis._user.name = name;\n\t\t\tthis._user.persist();\n\n\t\t\tthis._api.setFullName(name, bind(this, function (err, data) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tthis.publish('NameChanged', this._user.name);\n\t\t\t\t}\n\n\t\t\t\tcb && cb(err, data);\n\t\t\t}));\n\t\t} else if (name == this._user.name && cb) {\n\t\t\t// set timeout so people do not receive unexpected\n\t\t\t// execution of callback before their current function\n\t\t\t// has finished execution\n\t\t\tsetTimeout(function() {\n\t\t\t\tcb({response: \"AlreadySet\"});\t\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tthis.setNickname = function(nickname, cb) {\n\t\tif (nickname && nickname != this._user.nickname) {\n\t\t\tthis._user.nickname = nickname;\n\t\t\tthis._user.persist();\n\n\t\t\tthis._api.setNickname(nickname, bind(this, function (err, data) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tthis.publish('NicknameChanged', this._user.nickname);\n\t\t\t\t}\n\n\t\t\t\tcb && cb(err, data);\n\t\t\t}));\n\t\t} else if (nickname == this._user.nickname && cb) {\n\t\t\t// set timeout so people do not receive unexpected\n\t\t\t// execution of callback before their current function\n\t\t\t// has finished execution\n\t\t\tsetTimeout(function() {\n\t\t\t\tcb({response: \"AlreadySet\"});\t\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tthis.setStatus = function(status, cb) {\n\t\tif (status != this._user.status) {\n\t\t\tthis._user.status = status;\n\t\t\tthis._user.persist();\n\n\t\t\tthis._api.setStatus(status, bind(this, function (err, data) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tthis.publish('StatusChanged', this._user.status);\n\t\t\t\t}\n\n\t\t\t\tcb && cb(err, data);\n\t\t\t}));\n\t\t}\n\t};\n\n\tthis.getCountryIso = function (cb) {\n\t\tweebyNative.getCountryIso(cb);\n\t};\n\n\tthis.getPhoneNumber = function () { return this._user.phoneNumber; }\n});\n","pre":true},"sdk/plugins/weeby/models/ImageService.js":{"path":"sdk/plugins/weeby/models/ImageService.js","friendlyPath":".ImageService","directory":"sdk/plugins/weeby/models/","filename":"ImageService.js","src":"jsio(\"import ui.resource.Image\");\n\n// request native check for image updates every 30 minutes rather than using the cached version\nvar EXPIRATION_TIME = 1000 * 60 * 30;\n\nLoader=__class__;var Loader=Loader(function Loader(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (defaultURL) {\n\t\tthis.defaultURL = defaultURL;\n\t\tthis.image = new ui.resource.Image({url: defaultURL});\n\t\tthis.loadingImage = null;\n\n\t\t// last force-reload date\n\t\tthis.date = null;\n\t}\n\n\tthis.load = function (url, forceReload) {\n\t\tvar forceReload = forceReload || !this.date || Date.now() > this.date + EXPIRATION_TIME;\n\n\t\tif (!this.loadingImage) {\n\t\t\tthis.loadingImage = new ui.resource.Image({url: url, forceReload: forceReload});\n\t\t} else {\n\t\t\tthis.loadingImage.setURL(url, forceReload);\n\t\t}\n\n\t\tif (forceReload) {\n\t\t\t// update last force-reload date\n\t\t\tthis.date = Date.now();\n\t\t}\n\n\t\tthis.loadingImage.doOnLoad(this, function (err) {\n\t\t\tif (!err) {\n\t\t\t\tthis.image.setURL(url);\n\t\t\t} else {\n\t\t\t\tthis.image.setURL(this.defaultURL);\n\t\t\t}\n\t\t});\n\t}\n});\n\nvar sdk_plugins_weeby_models_ImageService=__class__;exports=sdk_plugins_weeby_models_ImageService(function sdk_plugins_weeby_models_ImageService(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis._images = {};\n\t\tthis._defaultURL = null;\n\t}\n\n\tthis.setDefaultURL = function (defaultURL) {\n\t\tthis._defaultURL = defaultURL;\n\t}\n\n\tthis.update =\n\tthis.get = function (id, url, forceReload) {\n\t\tif (!this._images[id]) {\n\t\t\tthis._images[id] = new Loader(this._defaultURL);\n\t\t}\n\n\t\tif (url) {\n\t\t\tthis._images[id].load(url, forceReload);\n\t\t} else {\n\t\t\tthis._images[id].image.setURL(this._defaultURL);\n\t\t}\n\n\t\treturn this._images[id].image;\n\t}\n\n\tthis.has = function (id) {\n\t\treturn !!this._images[id];\n\t}\n});\n\njsio(\"import ..ui.config as uiConfig\");\nexports.userImages = new exports();\nexports.userImages.setDefaultURL(uiConfig.getThemeImageURL('weeby/icon_pic.png'));\n","pre":true},"sdk/plugins/weeby/models/GameResult.js":{"path":"sdk/plugins/weeby/models/GameResult.js","friendlyPath":".models.GameResult","directory":"sdk/plugins/weeby/models/","filename":"GameResult.js","src":"jsio(\"import ..weebyLocalData\");\njsio(\"import ..models.LeaderboardGame\");\njsio(\"import ..weebyController\");\n\n/**\n * Usage:\n * \n * A new GameResult instance is created for each game play.  After\n * the game ends, various bits of data are computed about the previous\n * game and this data can be read back to create screens such as the\n * game result or high score fanfare.  The properties are described\n * below:\n *\n *  gameResult\n *    .score:\n *      .total: score from last game\n *      .bonus: portion of score that was bonus\n *      .base: portion of score before bonus (base + bonus = total)\n *\n *  gameResult\n *    .beforeGame/.afterGame:\n *      .weeklyHighScore: high score for the week\n *      .level: current user level\n *      .xp: current user experience\n *      .rank: current user rank\n *  \n *  gameResult\n *    .isLevelUp: true if this game resulted in the user leveling up\n *    .isRankUp: true if the user just passed another in the rankings\n *    .passed: item for passed user if .isRankUp is true\n *\n *  gameResult.getXPForLevel(levelNumber): returns xp required\n *    to reach the provided level (convenience wrapper around\n *    game model)\n * \n */\nvar sdk_plugins_weeby_models_GameResult=__class__;exports=sdk_plugins_weeby_models_GameResult(function sdk_plugins_weeby_models_GameResult(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function (gameModel) {\n\t\tthis._gameModel = gameModel;\n\t};\n\n\tthis.getXPForLevel = function (level) {\n\t\treturn this._gameModel.getXPForLevel(level);\n\t};\n\n\tthis.computeTotalScore = function (baseScore) {\n\t\tvar bonusScore = this._gameModel.getBonusScore(this.beforeGame.level, baseScore);\n\t\treturn {\n\t\t\tbase: baseScore,\n\t\t\tbonus: bonusScore,\n\t\t\ttotal: baseScore + bonusScore\n\t\t};\n\t};\n\n\tthis.recordPregameState = function () {\n\t\tthis.beforeGame = this._getData();\n\t};\n\n\tthis.recordPostgameState = function (data) {\n\t\tthis.data = data;\n\n\t\t// compute the final score first\n\t\tthis.score = this.computeTotalScore(data.score);\n\n\t\t// trigger updates to data layer\n\t\tthis._updateState();\n\n\t\t// record new state\n\t\tthis.afterGame = this._getData();\n\n\t\tif (data.currency.commonSpent) {\n\t\t\tthis.afterGame.commonCurrency -= data.currency.commonSpent;\n\t\t}\n\t\tif (data.currency.common) {\n\t\t\tthis.afterGame.commonCurrency += data.currency.common;\n\t\t}\n\t\tif (data.currency.premiumSpent) {\n\t\t\tthis.afterGame.premiumCurrency -= data.currency.premiumSpent;\n\t\t}\n\t\tif (data.currency.premium) {\n\t\t\tthis.afterGame.premiumCurrency += data.currency.premium;\n\t\t}\n\n\t\tif (this.afterGame.rank < this.beforeGame.rank) {\n\t\t\tthis.isRankUp = true;\n\t\t\tthis.passed = this._gameModel.getLadder().getEntryBelow(this.afterGame.rank);\n\t\t}\n\n\t\tif (this.afterGame.level > this.beforeGame.level) {\n\t\t\tthis.isLevelUp = true;\n\t\t}\n\t};\n\n\tthis._updateState = function () {\n\t\tvar xpEarned = this._gameModel.getXPForScore(this.beforeGame.xp, this.beforeGame.level, this.score.total, this.gameId);\n\t\tvar xpFinal = this.beforeGame.xp + xpEarned;\n\n\t\tvar xpBase = this._gameModel.getXPForLevel(this.beforeGame.level);\n\t\tvar xpThreshold = this._gameModel.getXPForLevel(this.beforeGame.level + 1);\n\n\t\tvar leveledUp = xpFinal >= xpThreshold;\n\t\tif (leveledUp) {\n\t\t\tvar cappedXP = (xpThreshold + .85 * (xpThreshold - xpBase));\n\t\t\txpFinal = Math.min(cappedXP, xpFinal);\n\t\t}\n\n\t\txpFinal = Math.floor(xpFinal);\n\t\txpEarned = xpFinal - this.beforeGame.xp;\n\n\t\tweebyLocalData.updateHighScore(this.score.total);\n\t\tweebyLocalData.addXP(xpEarned);\n\t\tif (leveledUp) {\n\t\t\tweebyLocalData.setLevel(this.beforeGame.level + 1);\n\t\t}\n\n\t\tthis.score.highest = weebyLocalData.getWeeklyHighScore();\n\t\tthis._gameModel.getLadder().onHighScore(this.score.total);\n\t};\n\n\tthis._getData = function () {\n\t\treturn {\n\t\t\tweeklyHighScore: weebyLocalData.getWeeklyHighScore(),\n\t\t\tlevel: weebyLocalData.getLevel(),\n\t\t\txp: weebyLocalData.getXP(),\n\t\t\trank: this._gameModel.getLadder().getMyRank(),\n\t\t\tcommonCurrency: weebyLocalData.getCommonCurrency(),\n\t\t\tpremiumCurrency: weebyLocalData.getPremiumCurrency()\n\t\t}\n\t};\n});\n","pre":true},"sdk/plugins/weeby/models/Social.js":{"path":"sdk/plugins/weeby/models/Social.js","friendlyPath":".models.Social","directory":"sdk/plugins/weeby/models/","filename":"Social.js","src":"jsio(\"import lib.PubSub\");\njsio(\"import squill.models.DataSource as DataSource\");\n\njsio(\"import .ImageService\");\njsio(\"import .localStorageModel\");\njsio(\"import ..weebyNative as weebyNative\");\n\nvar STORAGE_KEY = 'social.connections';\n\nvar _instance;\nvar _userImages = ImageService.userImages;\n\nUser=__class__;var User=User(function User(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (data) {\n\t\tthis.id = data.id;\n\t\tthis.services = {};\n\t\tthis.update(data);\n\t}\n\n\tthis.update = function (data) {\n\t\tif (this == data) { return; }\n\n\t\tthis.name = data.name;\n\t\tthis.status = data.status;\n\t\tthis.apps = data.apps;\n\t\tthis.country = data.country;\n\t\tthis.photoURL = data.image;\n\t\tthis.coverImage = data.coverImage;\n\t\tthis.nickname = data.nickname;\n\t\tthis.isVerified = data.verified;\n\t\tthis.created = new Date(data.created);\n\n\t\tfor (var i = 0, n = data.services.length; i < n; ++i) {\n\t\t\tvar service = data.services[i];\n\t\t\tvar name = service.service;\n\t\t\tthis.services[name] = service;\n\t\t\tif (name == 'gc') {\n\t\t\t\tthis.isConfirmed = service.confirmed;\n\t\t\t\tthis.isBlocked = service.blocked;\n\t\t\t}\n\t\t}\n\n\t\tif (this.photoURL && _userImages.has(this.id)) {\n\t\t\t_userImages.update(this.id, this.photoURL);\n\t\t}\n\t}\n\n\tthis.getImage = function () {\n\t\treturn _instance.getImage(this.id);\n\t}\n});\n\n/*\n{\"apps\": [{\"id\":\"e5510cf1e8c641f896d87d6527bcd45d\", \"name\":\"Mecha-Mecha Panic!\", \"shortName\":null, \"packageName\":null, \"images\":{\"iconSmall\":null, \"iconLarge\":null}, \"studio\":\"Wee Cat Games\", \"created\":\"2012-11-13T00:04:45Z\", \"updated\":null}],\n\"status\":null,\n\"country\":null, \"services\":[{\"confirmed\":false, \"blocked\":false, \"service\":\"gc\"}],\n\"name\":\"Patrick Fram\",\n\"image\":null, \"coverImage\":null, \"imageSource\":null, \"nickname\":null,\n\"created\":\"2012-04-11T00:46:59Z\", \"nameSource\":null, \"auths\":[],\n\"verified\":false, \"id\":\"01fb100000000062787c0105\"}\n*/\n\nvar sdk_plugins_weeby_models_Social=__class__;exports=sdk_plugins_weeby_models_Social(function sdk_plugins_weeby_models_Social(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\tthis.init = function (api, user) {\n\t\tthis._api = api;\n\t\tthis._user = user;\n\t\tthis._myID = null;\n\t\tthis._getUserCbs = {};\n\n\t\tthis._connections = new DataSource({\n\t\t\tctor: User\n\t\t});\n\n\t\tthis._unconfirmedConnections = this._connections.getFilteredDataSource(function (connection) {\n\t\t\t\treturn connection.services.gc // has the gc service\n\t\t\t\t\t&& connection.id != this._myID // is not me\n\t\t\t\t\t&& (connection.name || connection.nickname) // has a name\n\t\t\t\t\t&& connection.isVerified // is verified\n\t\t\t\t\t&& !connection.isConfirmed // not already confirmed\n\t\t\t\t\t&& !connection.isBlocked; // not blocked\n\t\t\t});\n\n\t\tthis._friends = this._connections.getFilteredDataSource(function (connection) {\n\t\t\t\treturn connection.isVerified && connection.name && connection.isConfirmed;\n\t\t\t});\n\n\t\tthis._friends.setSorter(function (connection) {\n\t\t\treturn (connection.isBlocked ? 1 : 0) + \"|\"\n\t\t\t\t+ (connection.nickname || connection.name || \"\").toLowerCase()\n\t\t\t\t+ (connection.id);\n\t\t});\n\n\t\tthis._blockedFriends = this._connections.getFilteredDataSource(function (connection) {\n\t\t\t\treturn connection.isVerified && connection.name && connection.isBlocked;\n\t\t\t});\n\n\t\tthis._user.on('updated', bind(this, '_onUserUpdated'));\n\t\tthis._user.on('ConfirmedFriends', bind(this, '_onConfirmFriends'));\n\t}\n\n\tthis._onUserUpdated = function () {\n\t\tvar id = this._user.getID();\n\t\tif (id && id != this._myID) {\n\t\t\tthis._logout();\n\t\t\tthis._setID();\n\t\t}\n\t}\n\n\tthis._logout = function () {\n\t\tthis._connections.clear();\n\t\tthis._myID = null;\n\t}\n\n\tthis._setID = function () {\n\t\tthis._myID = this._user.getID();\n\n\t\tvar data = localStorageModel.getData(STORAGE_KEY);\n\t\tif (data && data.userID == this._myID) {\n\t\t\tthis._updateConnections(data.connections);\n\t\t}\n\n\t\tthis.refreshFriends();\n\t}\n\n\tthis.getUser = function (userID, cb) {\n\t\tvar user = this._friends.get(userID);\n\t\tif (user) {\n\t\t\tcb(null, user);\n\t\t} else {\n\t\t\tvar cbs = this._getUserCbs[userID];\n\t\t\tif (!cbs) {\n\t\t\t\tcbs = this._getUserCbs[userID] = [];\n\t\t\t}\n\n\t\t\tcbs.push(cb);\n\t\t}\n\t}\n\n\t// _chunkAsync splits a list up into chunks and \n\t// calls the callback with each chunk.  It may call\n\t// the callback in a setTimeout if MAX_SYNC_MS time\n\t// is exceeded\n\tvar CHUNK_SIZE = 25;\n\tvar MAX_SYNC_MS = 10;\n\tfunction _chunkAsync (list, cb, doneCb, ctx, start) {\n\t\tstart = start || 0;\n\t\tvar startTime = Date.now();\n\t\tdo {\n\t\t\tvar chunk = list.slice(start, start + CHUNK_SIZE);\n\t\t\tstart += CHUNK_SIZE;\n\t\t\tif (!chunk.length) {\n\t\t\t\tdoneCb && doneCb.call(ctx);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcb.call(ctx, chunk);\n\t\t} while (Date.now() - startTime < MAX_SYNC_MS);\n\t\tsetTimeout(bind(this, _chunkAsync, list, cb, doneCb, ctx, start), MAX_SYNC_MS);\n\t}\n\n\tthis.getFriends = function () { return this._friends; }\n\tthis.getUnconfirmedFriends = function () { return this._unconfirmedConnections; }\n\tthis.getBlockedFriends = function () { return this._blockedFriends; }\n\n\tthis.refreshFriends = function () {\n\t\tthis._api.getConnections(bind(this, function (err, connections) {\n\t\t\tif (!err && connections) {\n\t\t\t\tthis._updateConnections(connections);\n\n\t\t\t\t// only cache friends -- we'll need to refresh to get unconfirmed\n\t\t\t\t// freinds from the server\n\t\t\t\tvar friends = connections.filter(function (data) {\n\t\t\t\t\treturn this._friends.contains(data.id);\n\t\t\t\t}, this);\n\n\t\t\t\tlocalStorageModel.setData(STORAGE_KEY, {\n\t\t\t\t\tuserID: this._myID,\n\t\t\t\t\tconnections: friends\n\t\t\t\t});\n\n\t\t\t}\n\t\t}));\n\t}\n\n\tthis._onConfirmFriends = function (data) {\n\t\tvar accepted = data.acceptedFriends;\n\t\tvar blocked = data.blockedFriends;\n\n\t\taccepted.forEach(function (id) {\n\t\t\tvar user = this._connections.get(id);\n\t\t\tif (user) {\n\t\t\t\tuser.isConfirmed = true;\n\t\t\t\tuser.isBlocked = false;\n\n\t\t\t\tthis._connections.updated(user);\n\t\t\t}\n\t\t}, this);\n\n\t\tblocked.forEach(function (id) {\n\t\t\tvar user = this._connections.get(id);\n\t\t\tif (user) {\n\t\t\t\tuser.isBlocked = true;\n\n\t\t\t\tthis._connections.updated(user);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\tthis._updateConnections = function (connections) {\n\t\t_chunkAsync(connections, function (items) {\n\t\t\tthis._connections.add(items);\n\n\t\t\tfor (var i = 0, n = items.length; i < n; ++i) {\n\t\t\t\tvar userID = items[i].id;\n\t\t\t\tvar cbs = this._getUserCbs[userID];\n\t\t\t\tif (cbs) {\n\t\t\t\t\tvar user = this._connections.get(userID);\n\t\t\t\t\twhile (cbs[0]) {\n\t\t\t\t\t\tcbs.pop()(null, user);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}, function () {\n\t\t\t// on finish\n\t\t\tthis.emit('FriendsUpdated');\n\t\t}, this);\n\t}\n\n\tthis.getDisplayName = function (userID) {\n\t\tif (userID == this._myID) {\n\t\t\treturn this._user.getNickname() || this._user.getName() || '';\n\t\t} else {\n\t\t\tvar user = this._connections.get(userID);\n\t\t\treturn user && (user.nickname || user.name) || '';\n\t\t}\n\t}\n\n\tthis.getName = function (userID) {\n\t\tif (userID == this._myID) {\n\t\t\treturn this._user.getName();\n\t\t} else {\n\t\t\tvar user = this._connections.get(userID);\n\t\t\treturn user && user.name;\n\t\t}\n\t}\n\n\tthis.getNickname = function (userID) {\n\t\tif (userID == this._myID) {\n\t\t\treturn this._user.getNickname();\n\t\t} else {\n\t\t\tvar user = this._connections.get(userID);\n\t\t\treturn user && user.nickname;\n\t\t}\n\t}\n\n\tthis.getPhotoImage = function (userID) {\n\t\treturn _userImages.get(userID, this.getPhotoURL(userID));\n\t}\n\n\tthis.getPhotoURL = function (userID) {\n\t\tif (userID == this._myID) {\n\t\t\treturn this._user.getPhotoURL();\n\t\t} else {\n\t\t\tvar user = this._connections.get(userID);\n\t\t\treturn user && user.photoURL;\n\t\t}\n\t}\n});\n","pre":true},"sdk/plugins/weeby/i18n.js":{"path":"sdk/plugins/weeby/i18n.js","friendlyPath":".i18n","directory":"sdk/plugins/weeby/","filename":"i18n.js","src":"\nI18n=__class__;var I18n=I18n(function I18n(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis.setLanguage(navigator.language && navigator.language.split('-')[0].toLowerCase() || 'en');\n\t}\n\n\tthis.getLanguage = function () {\n\t\treturn this._language;\n\t}\n\n\tthis.setLanguage = function (language) {\n\t\tif (language && language != this._language) {\n\t\t\tthis._language = language;\n\n\t\t\tvar strings = CACHE[\"addons/weeby/strings/\" + language + \".json\"];\n\t\t\tif (strings) {\n\t\t\t\tthis._strings = JSON.parse(strings);\n\t\t\t} else {\n\t\t\t\tthis._strings = {};\n\t\t\t\tlogger.error(\"No localized strings found\");\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.getStrings = function () { return this._strings; }\n\n\tif (DEBUG) {\n\t\tvar _warnMissing = {};\n\t}\n\n\tthis.get = function (key, data) {\n\t\tvar text = key in this._strings ? this._strings[key] : key;\n\n\t\tif (DEBUG && (!(key in this._strings)) && (!(key in _warnMissing))) {\n\t\t\tlogger.warn(\"Key is not localized:\", key);\n\t\t\t_warnMissing[key] = true;\n\t\t}\n\n\t\tif (data) {\n\t\t\ttext = text.replace(/\\{[a-zA-Z0-9 ]+\\}/g, function (match) {\n\t\t\t\tvar key = match.substring(1, match.length - 1);\n\t\t\t\treturn data[key] || key;\n\t\t\t});\n\t\t}\n\t\treturn text;\n\t}\n\n\tthis.formatNumber = function(num) {\n\t\tvar oldString = ~~num + \"\",\n\t\t\tendIndex = oldString.length,\n\t\t\tstartIndex = endIndex - 3,\n\t\t\tnewString = \"\";\n\n\t\twhile (startIndex >= 0) {\n\t\t\tif (startIndex) {\n\t\t\t\tnewString = \",\" + oldString.slice(startIndex, endIndex) + newString;\n\t\t\t} else {\n\t\t\t\tnewString = oldString.slice(startIndex, endIndex) + newString;\n\t\t\t}\n\n\t\t\tstartIndex -= 3;\n\t\t\tendIndex -= 3;\n\t\t}\n\n\t\tif (endIndex >= 0) {\n\t\t\tnewString = oldString.slice(0, endIndex) + newString;\n\t\t}\n\n\t\treturn newString;\n\t};\n\n\tvar months = [\n\t\t\"January\",\n\t\t\"February\",\n\t\t\"March\",\n\t\t\"April\",\n\t\t\"May\",\n\t\t\"June\",\n\t\t\"July\",\n\t\t\"August\",\n\t\t\"September\",\n\t\t\"October\",\n\t\t\"November\",\n\t\t\"December\",\n\t];\n\n\tvar days = [\n\t\t\"Sunday\",\n\t\t\"Monday\",\n\t\t\"Tuesday\",\n\t\t\"Wednesday\",\n\t\t\"Thursday\",\n\t\t\"Friday\",\n\t\t\"Saturday\",\n\t]\n\n\tthis.formatDate = function (date) {\n\t\treturn days[date.getDay()] + \", \" + months[date.getMonth()] + \" \" + date.getDate() + \", \" + date.getFullYear();\n\t}\n\n\tthis.formatTime = function (time) {\n\t\tvar hours = time.getHours();\n\t\tvar amPm = 'am';\n\t\tif (hours >= 12) {\n\t\t\tamPm = 'pm';\n\t\t\tif (hours > 12) {\n\t\t\t\thours -= 12;\n\t\t\t}\n\t\t}\n\n\t\tif (hours == 0) {\n\t\t\thours = 12;\n\t\t}\n\n\t\tvar minutes = time.getMinutes();\n\t\tif (minutes < 10) { minutes = '0' + minutes; }\n\n\t\treturn hours + \":\" + minutes + \" \" + amPm;\n\t}\n\n\tthis.getTimeAgo = function (date, allowFutureDates) {\n\t\tvar distanceMillis = Date.now() - date;\n\t\tvar strings = this._strings.timeAgo;\n\t\tvar prefix = strings.prefixAgo;\n\t\tvar suffix = strings.suffixAgo;\n\n\t\tif (allowFutureDates) {\n\t\t\tif (distanceMillis < 0) {\n\t\t\t\tprefix = strings.prefixFromNow;\n\t\t\t\tsuffix = strings.suffixFromNow;\n\t\t\t}\n\t\t}\n\n\t\tvar seconds = Math.abs(distanceMillis) / 1000;\n\t\tvar minutes = seconds / 60;\n\t\tvar hours = minutes / 60;\n\t\tvar days = hours / 24;\n\t\tvar years = days / 365;\n\n\t\tfunction substitute (stringOrFunction, number) {\n\t\t\tvar string = typeof stringOrFunction == 'function' ? stringOrFunction(number, distanceMillis) : stringOrFunction;\n\t\t\tvar value = (strings.numbers && strings.numbers[number]) || number;\n\t\t\treturn string.replace(/\\{n\\}/i, value);\n\t\t}\n\n\t\tvar words = seconds < 45 && substitute(strings.seconds, Math.round(seconds)) ||\n\t\t\tseconds < 90 && substitute(strings.minute, 1) ||\n\t\t\tminutes < 45 && substitute(strings.minutes, Math.round(minutes)) ||\n\t\t\tminutes < 90 && substitute(strings.hour, 1) ||\n\t\t\thours < 24 && substitute(strings.hours, Math.round(hours)) ||\n\t\t\thours < 42 && substitute(strings.day, 1) ||\n\t\t\tdays < 30 && substitute(strings.days, Math.round(days)) ||\n\t\t\tdays < 45 && substitute(strings.month, 1) ||\n\t\t\tdays < 365 && substitute(strings.months, Math.round(days / 30)) ||\n\t\t\tyears < 1.5 && substitute(strings.year, 1) ||\n\t\t\tsubstitute(strings.years, Math.round(years));\n\n\t\tvar separator = strings.wordSeparator || \"\";\n\t\tif (strings.wordSeparator === undefined) { separator = \" \"; }\n\n\t\tvar value = prefix || \"\";\n\t\tvalue += (value ? separator : \"\") + words;\n\t\tvalue += (value ? separator : \"\") + suffix;\n\t\treturn value.replace(/^\\s+|\\s+$/g, '');\n\t}\n});\n\nexports = new I18n();\n\n\n","pre":true},"sdk/plugins/weeby/sdk/apiMock.js":{"path":"sdk/plugins/weeby/sdk/apiMock.js","friendlyPath":".sdk.apiMock","directory":"sdk/plugins/weeby/sdk/","filename":"apiMock.js","src":"jsio(\"import lib.PubSub\");\njsio(\"import util.ajax as ajax\");\njsio(\"import std.uuid\");\njsio(\"import .api\");\n\njsio(\"import ..models.localStorageModel as localStorageModel\");\n\nvar TEST_CONNECTIONS = [\n\t{id: '1', name: 'Tom', verified: true, image: 'http://s.wee.cat/users/bbabe3d4e66c4601838c2480f51bbd33/image.png', services: [{service: 'gc', confirmed: true}]},\n\t{id: '2', name: 'Stephanie', nickname: 'Stephanie', verified: true, image: 'http://s.wee.cat/users/c7f81f485816401e8d4cc9808fe6906b/image.png', services: [{service: 'gc', confirmed: true}]},\n\t{id: '3', name: 'Arno', nickname: 'Arno', verified: true, image: 'http://s.wee.cat/users/256d8f4e8f5b49dc8ef1d43926b72529/image.png', services: [{service: 'gc', confirmed: false}]},\n];\n\nvar MOCK_USER = {\n\tid: \"mockUserID\",\n\tname: \"mock-full-name\",\n\tnickname: \"mock-nickname\",\n\tstatus: \"mock-status\"\n};\n\nvar TEST_USER_0 = {id: 1, verified: true, name: 'Tom', image: 'http://s.wee.cat/users/bbabe3d4e66c4601838c2480f51bbd33/image.png'};\nvar TEST_USER_1 = {id: 2, verified: true, nickname: 'Stephanie', image: 'http://s.wee.cat/users/c7f81f485816401e8d4cc9808fe6906b/image.png'};\nvar TEST_USER_2 = {id: '0afdbdb7021e4f54912a85482c1dd408', verified: true, nickname: 'Arno', image: 'http://s.wee.cat/users/256d8f4e8f5b49dc8ef1d43926b72529/image.png'};\n\nvar TEST_LADDER_ITEMS = [\n\t\t{id: 1, user: TEST_USER_0, score: 145},\n\t\t{id: 2, user: TEST_USER_1, score: 99},\n\t\t{id: 3, user: TEST_USER_2, score: 98}\n\t];\n\nvar TEST_GIFTS = [\n\t\t{id: 2, created: Date.now(), sourceUser: TEST_USER_1, targetUser: TEST_USER_0, data: ''},\n\t\t{id: 3, created: Date.now(), sourceUser: TEST_USER_2, sourceUser: TEST_USER_0, data: ''}\n\t];\n\nWeeby=__class__;var Weeby=Weeby(function Weeby(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\tvar defaults = {\n\t\tbaseURL: 'http://' + window.location.host + '/simulate/addons/weeby/mock_server/v1/',\n\t\tappID: 'd7fb97bfae514c9690efab195e8ac2f7',\n\t\tdebug: false\n\t};\n\n\tthis.init = function (opts) {\n\t\tthis._verifyOpts(opts);\n\t\topts = merge(opts, defaults);\n\n\t\tthis._appID = opts.appID;\n\t\tthis._baseURL = opts.baseURL;\n\t\tthis._debug = opts.debug;\n\t\tthis._offline = false;\n\t\tthis._gifts = TEST_GIFTS;\n\n\t\tthis._verifyKey = 1000 + ((Math.random() * 999) | 0) + '';\n\n\t\tthis.readData(opts.authKey);\n\t};\n\n\tthis.isMock = function () { return true; }\n\n\t/*\n\t * make sure we've been given everything we need to properly initialize\n\t * In debug mode, use some defaults but warn about them\n\t */\n\tthis._verifyOpts = function (opts) {\n\t\tif (!opts.appID) {\n\t\t\tlogger.error('no  appID specified');\n\t\t\tif (!opts.debug) {\n\t\t\t\tthrow new Error('Missing appID when creating weeby object!');\n\t\t\t} else {\n\t\t\t\tlogger.warn('Default app key won\\'t work in release mode');\n\t\t\t}\n\t\t}\n\t\tif (opts.authKey) {\n\t\t\tif (opts.debug) {\n\t\t\t\tlogger.info('Using mock auth key - not reading from settings');\n\t\t\t} else {\n\t\t\t\tlogger.error('mock auth key in release mode is not allowed');\n\t\t\t\tthrow new Error('Mock auth key in release mode');\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getAuthKey = function () { return this._saveData.authKey; }\n\n\t//TODO this stuff should probably be kept out of local storage when\n\t//we're not in the simulator.  A really simple plugin to do this would be \n\t//good - save it to a file or to user preferences. This will allow the \n\t//tests to run in node, too, which is nice.\n\tvar key = '__WEEBY__DATA__';\n\tthis.readData = function (debugKey) {\n\t\tthis._saveData = localStorageModel.getData(key);\n\t\tif (!this._saveData) {\n\t\t\tthis._saveData = {};\n\t\t}\n\t\tif (debugKey) { \n\t\t\t//if we're given a debug key, just use it and don't save to\n\t\t\t//settings.\n\t\t\tthis._saveData.authKey = debugKey;\n\t\t\tthis._persistData = false;\n\t\t} else {\n\t\t\tif (!this._saveData.authKey) {\n\t\t\t\tthis._saveData.authKey = exports.newAuthKey();\n\t\t\t\tlogger.log('generated new key', this._saveData.authKey);\n\t\t\t\tthis.writeData();\n\t\t\t}\n\t\t\tthis._persistData = true;\n\t\t}\n\t};\n\n\tthis.writeData = function () {\n\t\tif (this._persistData) {\n\t\t\tlocalStorageModel.setData(key, this._saveData);\n\t\t} else {\n\t\t\tif (!this._debug) {\n\t\t\t\t//data should always be persisted except in debug mode\n\t\t\t\tthrow new Error('persistData is false in release mode!');\n\t\t\t} else {\n\t\t\t\tlogger.info('Skipping persist of data');\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.debugSetIsVerified = function (isVerified) { this._isVerified = isVerified; };\n\n\tthis.getHost = function () { return 'localhost:9200/simulate/addons/weeby/mock_server'; };\n\n\tthis.getAppID = function () { return this._appID; }\n\n\tthis.login = function (cb) {\n\t\tsetTimeout(\n\t\t\tbind(this, function () {\n\t\t\t\tconsole.log('Login, not verified');\n\t\t\t\tcb(false, merge({verified: this._isVerified}, MOCK_USER));\n\t\t\t}),\n\t\t\t1000\n\t\t);\n\t};\n\n\tthis.connect = function () {\n\t};\n\n\tthis.getCrosspromoInfo = function (cb) {\n\t\tcb && cb(null, {});\n\t}\n\n\tthis.fetchCrosspromos = function (gamesPlayed, gamesSinceLastPromo, locale, cb) {\n\t\tthis.getCrosspromoInfo(cb);\n\t}\n\n\tthis.getCachedConnections = api.Weeby.prototype.getCachedConnections;\n\tthis.getCachedConnectionsSync = api.Weeby.prototype.getCachedConnectionsSync;\n\tthis.getUnconfirmedFriends = api.Weeby.prototype.getUnconfirmedFriends;\n\n\tthis.getConnections = function (cb) {\n\t\tsetTimeout(bind(this, function () {\n\t\t\t\t\t\t\t\tcb(false, TEST_CONNECTIONS);\n\t\t\t\t\t\t\t}), 500);\n\t};\n\n\tthis.confirmFriends = function () {\n\t};\n\n\tthis.getLadder = function (cb) {\n\t\tsetTimeout(\n\t\t\tbind(this, function () {\n\t\t\t\tcb(\n\t\t\t\t\tfalse,\n\t\t\t\t\t{\n\t\t\t\t\t\texpiration: new Date(Date.now() + 1000 * 60 * 60 * 24 * 7),\n\t\t\t\t\t\titems: TEST_LADDER_ITEMS\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}),\n\t\t\t500\n\t\t);\n\t};\n\n\tthis.verifyPhone = function (data, cb) {\n\t\tsetTimeout(\n\t\t\tbind(this, function () {\n\t\t\t\tconsole.log('Verify phone, number:', data.number);\n\t\t\t\tif (!data.number) {\n\t\t\t\t\tconsole.error('No valid number');\n\t\t\t\t\tcb(true, {message: 'No valid number'});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Verify key:', this._verifyKey);\n\t\t\t\t\tcb(false);\n\t\t\t\t}\n\t\t\t}),\n\t\t\t500\n\t\t);\n\t};\n\n\tthis.completeVerifyPhone = function (data, cb) {\n\t\tsetTimeout(\n\t\t\tbind(this, function () {\n\t\t\t\tif (data.code === this._verifyKey) {\n\t\t\t\t\tconsole.log('Verify key is correct');\n\t\t\t\t\tthis._isVerified = true;\n\t\t\t\t\tcb(false, {user: merge({verified: this._isVerified}, MOCK_USER)});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Verify key is not correct');\n\t\t\t\t\tcb(true);\n\t\t\t\t}\n\t\t\t}),\n\t\t\t500\n\t\t);\n\t};\n\n\tthis.updateInfo = function () {\n\t};\n\n\tthis.submitScore = function () {\n\t};\n\n\tthis.acceptGiftsByID = function (ids) {\n\t};\n\n\tthis.setFullName = function(name, cb) {\n\t\tif (typeof name !== 'string') {\n\t\t\tthrow new Error('setFullName called with a non-string argument');\n\t\t}\n\t\tthis.updateInfo({\n\t\t\tname: name\n\t\t}, cb);\n\t};\n\n\tthis.setNickname = function(nickname, cb) {\n\t\tif (typeof nickname !== 'string') {\n\t\t\tthrow new Error('setNickname called with a non-string argument');\n\t\t}\n\t\tthis.updateInfo({\n\t\t\tnickname: nickname\n\t\t}, cb);\n\t};\n\n\tthis.setStatus = function(status, cb) {\n\t\tif (typeof status !== 'string') {\n\t\t\tthrow new Error('setStatus called with a non-string argument');\n\t\t}\n\t\tthis.updateInfo({\n\t\t\tstatus: status\n\t\t}, cb);\n\t};\n\n\tthis.getGifts = function() {\n\t\treturn this._gifts;\n\t};\n\n\tthis.acceptGifts = function(users, cb) {\n\t\tvar ids = users.map(function(user) {\n\t\t\treturn user.id;\n\t\t});\n\t\tthis.acceptGiftsByID({ids: ids}, cb);\n\t};\n\n\tthis.sendGiftToUserID = function(id, cb) {\n\t};\n\n\tvar onContacts = function(cb, e, data) {\n\t\tif (cb) {\n\t\t\tcb(e, data);\n\t\t}\n\t};\n\n\tthis.getProfile = function () {\n\t\t// TODO\n\t}\n\n\t/**\n\t * get the contacts from the device (or fake simulator), and upload\n\t * them to the server\n\t **/\n\tthis.syncContacts = function (cb) {\n\t\tNATIVE.contacts.getContacts(bind(this, function(data) {\n\t\t\tthis.req('users/add-connections', data, bind(this, onContacts, cb));\n\t\t}));\n\t};\n\n\t//TODO\n\t//state.save-state What is state?\n\t//set photo\n\n\tthis.req = function(path, data, cb) {\n\t\tvar url = this._baseURL + path + '?key=' + this._saveData.authKey +\n\t\t\t'&app=' + this._appID;\n\n\t\tdata = merge(data, {\n\t\t\tauthKey: this._saveData.authKey,\n\t\t\tappID: this._appID\n\t\t});\n\n\t\tajax.post({\n\t\t\tdata: data,\n\t\t\turl: url,\n\t\t\ttype: 'json',\n\t\t\theaders:  {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t}, cb);\n\t};\n\n\tthis.setOffline = function (offline) {\n\t\tthis._offline = offline;\n\t};\n\n\tthis.isOffline = function () {\n\t\treturn this._offline;\n\t};\n});\n\nexports.newAuthKey = function() {\n\treturn std.uuid.uuid(32, 16).toLowerCase();\n};\n\nif (window.GC) {\n\tjsio('import device');\n\tif (device.isSimulator) {\n\t\tjsio('import .simulator.contacts');\n\t}\n}\nexports.Weeby = Weeby;\n\nexports.TEST_LADDER_ITEMS = TEST_LADDER_ITEMS;\nexports.TEST_CONNECTIONS = TEST_CONNECTIONS;\n","pre":true},"sdk/plugins/weeby/ui/WeebyViews.js":{"path":"sdk/plugins/weeby/ui/WeebyViews.js","friendlyPath":".ui.WeebyViews","directory":"sdk/plugins/weeby/ui/","filename":"WeebyViews.js","src":"jsio(\"import device\");\njsio(\"import lib.Enum as Enum\");\n\njsio(\"import ui.View as View\");\n\njsio(\"import .config\");\njsio(\"import .components.transitions as transitions\");\n\njsio(\"import .controllers.game.EquipViewController as EquipViewController\");\njsio(\"import .controllers.game.GameResultViewController as GameResultViewController\");\njsio(\"import .controllers.game.ConfirmFriendsViewController as ConfirmFriendsViewController\");\njsio(\"import .controllers.game.LadderViewController as LadderViewController\");\njsio(\"import .controllers.game.PickCountryViewController as PickCountryViewController\");\njsio(\"import .controllers.game.TOSViewController as TOSViewController\");\njsio(\"import .controllers.game.SplashViewController as SplashViewController\");\njsio(\"import .controllers.game.VerifyingViewController as VerifyingViewController\");\njsio(\"import .controllers.game.VerifyViewController as VerifyViewController\");\njsio(\"import .controllers.game.VerifyVariantViewController as VerifyVariantViewController\");\njsio(\"import .controllers.game.VerifyPhotoViewController as VerifyPhotoViewController\");\njsio(\"import .controllers.game.VerifyPhoneViewController as VerifyPhoneViewController\");\njsio(\"import .controllers.game.AuthCodeViewController as AuthCodeViewController\");\njsio(\"import .controllers.game.CrosspromoViewController as CrosspromoViewController\");\n\njsio(\"import .controllers.game.GiftViewController as GiftViewController\"); // Temp because clipping in modal is broken...\n\njsio(\"import .controllers.profile.EditProfileViewController as EditProfileViewController\");\njsio(\"import .controllers.profile.EditNameViewController as EditNameViewController\");\njsio(\"import .controllers.profile.FullnameEditViewController as FullnameEditViewController\");\njsio(\"import .controllers.profile.FullnameVerifyViewController as FullnameVerifyViewController\");\njsio(\"import .controllers.profile.FullnameCodeViewController as FullnameCodeViewController\");\njsio(\"import .controllers.profile.FullnameChangeViewController as FullnameChangeViewController\");\njsio(\"import .controllers.profile.ProfileViewController as ProfileViewController\");\n\njsio(\"import .controllers.weeby.FriendListViewController as FriendListViewController\");\njsio(\"import .controllers.weeby.ChatViewController as ChatViewController\");\njsio(\"import .controllers.weeby.ChatListViewController as ChatListViewController\");\njsio(\"import .controllers.weeby.FriendProfileViewController as FriendProfileViewController\");\n\njsio(\"import .dialogs.game.AlertDialog as AlertDialog\");\njsio(\"import .dialogs.game.CrosspromoRewardDialog as CrosspromoRewardDialog\");\njsio(\"import .dialogs.game.GiftDialog as GiftDialog\");\njsio(\"import .dialogs.game.GiftNoneDialog as GiftNoneDialog\");\njsio(\"import .dialogs.game.NotEnoughCommonDialog as NotEnoughCommonDialog\");\njsio(\"import .dialogs.game.NotEnoughLivesDialog as NotEnoughLivesDialog\");\njsio(\"import .dialogs.game.NotEnoughPremiumDialog as NotEnoughPremiumDialog\");\njsio(\"import .dialogs.game.SettingsDialog as SettingsDialog\");\njsio(\"import .dialogs.game.TosAcceptDialog as TosAcceptDialog\");\njsio(\"import .dialogs.game.OfflineDialog as OfflineDialog\");\njsio(\"import .dialogs.game.PassedPlayerDialog as PassedPlayerDialog\");\njsio(\"import .dialogs.game.LevelUpDialog as LevelUpDialog\");\njsio(\"import .dialogs.game.ShopCommonDialog as ShopCommonDialog\");\njsio(\"import .dialogs.game.ShopCommonSuccessDialog as ShopCommonSuccessDialog\");\njsio(\"import .dialogs.game.ShopConfirmCommonDialog as ShopConfirmCommonDialog\");\njsio(\"import .dialogs.game.ShopConfirmLivesDialog as ShopConfirmLivesDialog\");\njsio(\"import .dialogs.game.ShopConfirmPremiumDialog as ShopConfirmPremiumDialog\");\njsio(\"import .dialogs.game.ItemShopDialog as ItemShopDialog\");\njsio(\"import .dialogs.game.ItemShopConfirmDialog as ItemShopConfirmDialog\");\njsio(\"import .dialogs.game.ShopLivesDialog as ShopLivesDialog\");\njsio(\"import .dialogs.game.ShopLivesSuccessDialog as ShopLivesSuccessDialog\");\njsio(\"import .dialogs.game.ShopPremiumDialog as ShopPremiumDialog\");\njsio(\"import .dialogs.game.ShopPremiumSuccessDialog as ShopPremiumSuccessDialog\");\njsio(\"import .dialogs.game.AuthDialog as AuthDialog\");\njsio(\"import .dialogs.game.VerifyingDialog as VerifyingDialog\");\njsio(\"import .dialogs.game.PhotoPickDialog as PhotoPickDialog\");\n\njsio(\"import .dialogs.profile.ChoosePhotoSourceDialog as ChoosePhotoSourceDialog\");\njsio(\"import .dialogs.profile.FullnameConfirmDialog as FullnameConfirmDialog\");\n\njsio(\"import .UIInflator\");\n\njsio(\"import ..weebyController\");\njsio(\"import ..weebyStates\");\n\nvar states = weebyStates.states;\n\nvar CTORS = {};\n\nCTORS[states.STATE_DIALOG_ACCEPT_TOS] = TosAcceptDialog;\nCTORS[states.STATE_DIALOG_ACCEPT_TERMS] = AlertDialog;\nCTORS[states.STATE_DIALOG_ALERT] = AlertDialog;\nCTORS[states.STATE_DIALOG_CROSSPROMO_REWARD] = CrosspromoRewardDialog;\nCTORS[states.STATE_DIALOG_GIFT_NONE] = GiftNoneDialog;\nCTORS[states.STATE_DIALOG_GIFT] = GiftDialog;\nCTORS[states.STATE_DIALOG_NOT_ENOUGH_COMMON] = NotEnoughCommonDialog;\nCTORS[states.STATE_DIALOG_NOT_ENOUGH_PREMIUM] = NotEnoughPremiumDialog;\nCTORS[states.STATE_DIALOG_NOT_ENOUGH_LIVES] = NotEnoughLivesDialog;\nCTORS[states.STATE_DIALOG_OFFLINE] = OfflineDialog;\nCTORS[states.STATE_DIALOG_PASSED_PLAYER] = PassedPlayerDialog;\nCTORS[states.STATE_DIALOG_LEVEL_UP] = LevelUpDialog;\nCTORS[states.STATE_DIALOG_SETTINGS] = SettingsDialog;\nCTORS[states.STATE_DIALOG_SHOP_COMMON] = ShopCommonDialog;\nCTORS[states.STATE_DIALOG_SHOP_COMMON_SUCCESS] = ShopCommonSuccessDialog;\nCTORS[states.STATE_DIALOG_SHOP_LIVES] = ShopLivesDialog;\nCTORS[states.STATE_DIALOG_SHOP_LIVES_SUCCESS] = ShopLivesSuccessDialog;\nCTORS[states.STATE_DIALOG_SHOP_CONFIRM_COMMON] = ShopConfirmCommonDialog;\nCTORS[states.STATE_DIALOG_SHOP_CONFIRM_PREMIUM] = ShopConfirmPremiumDialog;\nCTORS[states.STATE_DIALOG_SHOP_CONFIRM_LIVES] = ShopConfirmLivesDialog;\nCTORS[states.STATE_DIALOG_SHOP_PREMIUM] = ShopPremiumDialog;\nCTORS[states.STATE_DIALOG_SHOP_PREMIUM_SUCCESS] = ShopPremiumSuccessDialog;\nCTORS[states.STATE_DIALOG_AUTH] = AuthDialog;\nCTORS[states.STATE_DIALOG_VERIFYING] = VerifyingDialog;\nCTORS[states.STATE_DIALOG_PHOTO_PICK] = PhotoPickDialog;\nCTORS[states.STATE_DIALOG_ITEM_SHOP] = ItemShopDialog;\nCTORS[states.STATE_DIALOG_ITEM_SHOP_CONFIRM] = ItemShopConfirmDialog;\n\nCTORS[states.STATE_DIALOG_CHOOSE_PHOTO_SOURCE] = ChoosePhotoSourceDialog;\nCTORS[states.STATE_DIALOG_FULLNAME_CONFIRM] = FullnameConfirmDialog;\n\nCTORS[states.STATE_FRIEND_PROFILE] = FriendProfileViewController;\n\nCTORS[states.STATE_EQUIP] = EquipViewController;\nCTORS[states.STATE_GAME_RESULT] = GameResultViewController;\nCTORS[states.STATE_CONFIRM_FRIENDS] = ConfirmFriendsViewController;\nCTORS[states.STATE_LADDER] = LadderViewController;\nCTORS[states.STATE_PICK_COUNTRY] = PickCountryViewController;\nCTORS[states.STATE_SPLASH] = SplashViewController;\nCTORS[states.STATE_TOS] = TOSViewController;\nCTORS[states.STATE_VERIFY] = VerifyViewController;\nCTORS[states.STATE_VERIFY_VARIANT] = VerifyVariantViewController;\nCTORS[states.STATE_VERIFY_PHOTO] = VerifyPhotoViewController;\nCTORS[states.STATE_VERIFY_PHONE] = VerifyPhoneViewController;\nCTORS[states.STATE_GIFT] = GiftViewController;\nCTORS[states.STATE_EDIT_NAME] = EditNameViewController;\nCTORS[states.STATE_FULLNAME_EDIT] = FullnameEditViewController;\nCTORS[states.STATE_FULLNAME_VERIFY] = FullnameVerifyViewController;\nCTORS[states.STATE_FULLNAME_CODE] = FullnameCodeViewController;\nCTORS[states.STATE_FULLNAME_CHANGE] = FullnameChangeViewController;\nCTORS[states.STATE_EDIT_PROFILE] = EditProfileViewController;\nCTORS[states.STATE_PROFILE] = ProfileViewController;\nCTORS[states.STATE_AUTH_CODE] = AuthCodeViewController;\nCTORS[states.STATE_CROSSPROMO] = CrosspromoViewController;\nCTORS[states.STATE_CHAT] = ChatViewController;\nCTORS[states.STATE_CHAT_LIST] = ChatListViewController;\nCTORS[states.STATE_FRIEND_LIST] = FriendListViewController;\n\nvar _instance;\n\nvar sdk_plugins_weeby_ui_WeebyViews=__class__;exports=sdk_plugins_weeby_ui_WeebyViews(function sdk_plugins_weeby_ui_WeebyViews(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tthis.init = function (opts) {\n\t\tGC.app.weebyRootView = this;\n\t\t_instance = this;\n\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\ttag: 'WeebyUI'\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis._inflator = new UIInflator();\n\n\t\tthis._viewStack = [];\n\t\tthis._currentView = null;\n\n\t\tthis._viewControllers = [];\n\t\tthis._underlays = [];\n\t\tthis.createControllers();\n\n\t\tweebyController.on('StateChanged', bind(this, 'onStateChanged'));\n\n\t\t//////////////////////////\n\t\t//TODO: This loads all view controllers on start. \n\t\t//\t\tWe should remove this call, and fix all view controllers that break.\n\t\tthis.getViewControllers();\n\t\t//////////////////////////\n\t};\n\n\tthis.createControllers = function () {\n\t\tjsio(\"import .components.StatusView as StatusView\");\n\t\tStatusView.setViewDef(this.getViewDef(states.STATE_HEADER));\n\t};\n\n\tthis.getCurrentView = function () {\n\t\treturn this._currentView;\n\t};\n\n\tthis.getViewController = function (state) {\n\t\tif (!this._viewControllers[state]) {\n\t\t\tvar Ctor = CTORS[state];\n\t\t\tvar filename = weebyStates.details[state].filename;\n\t\t\tif (!filename) {\n\t\t\t\tthrow new Error('No filename specified for state' + states[state]);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tvar controller = this._viewControllers[state] = new Ctor({\n\t\t\t\t\tsuperview: this,\n\t\t\t\t\tviews: this.getViewDef(state)\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\n\t\treturn this._viewControllers[state];\n\t};\n\n\tthis.getViewControllers = function () {\n\t\tfor (var state in CTORS) {\n\t\t\tthis.getViewController(state);\n\t\t}\n\n\t\treturn this._viewControllers;\n\t};\n\n\tthis.getViewDef = function (state) {\n\t\ttry {\n\t\t\treturn JSON.parse(CACHE['addons/weeby/theme/json/' + weebyStates.details[state].filename + '.json']);\n\t\t} catch (e) {\n\t\t\tlogger.error(\"NO FILE FOUND FOR\", states[state], weebyStates.details[state].filename);\n\t\t\treturn {};\n\t\t}\n\t};\n\n\t/**\n\t * onStateChanged is responsible for showing and hiding\n\t * views in response to state changes.  \n\t */\n\tthis.onStateChanged = function (state, prevState, type, data) {\n\t\tswitch (state) {\n\t\t\tcase states.STATE_GAME:\n\t\t\t\t// We're about to head into the game. Don't do anything with the\n\t\t\t\t// current views, just set the current state so we know what the \n\t\t\t\t// current state is.  The parent view controller will transition \n\t\t\t\t// the entire view into the game view.  When we come back from\n\t\t\t\t// the game view, we'll hide the current view, but we want it\n\t\t\t\t// visible now while we transition into the game.\n\t\t\t\tthis._currentState = states.STATE_GAME;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.showView(state, type);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.showView = function (state, type, view) {\n\t\tvar prevView = this._currentView;\n\n\t\t// grab the view for the current state\n\t\tvar nextView = view || this.getViewController(state);\n\n\t\t// let the view decide the best transition by default\n\t\tvar transition = undefined;\n\t\tswitch (type) {\n\t\t\tcase 'reload': // debugging only\n\t\t\t\ttransition = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 'push':\n\t\t\t\t// save the current view and set this._currentView to null\n\t\t\t\t// so that it doesn't get hidden in the next state transition\n\t\t\t\tthis._viewStack.push(this._currentView);\n\t\t\t\tbreak;\n\t\t\tcase 'pop':\n\t\t\t\t// restore a view from the stack as the current view\n\t\t\t\tnextView = this._viewStack.pop();\n\t\t\t\tbreak;\n\t\t\tcase 'back':\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// level is the depth of the view stack -- 0 means we're at the\n\t\t// bottom of the stack.  Dialogs are typically at 1 (above the\n\t\t// base view) as are profile views.\n\t\tvar level = this._viewStack.length;\n\n\t\tif (!this._currentState || this._currentState == states.STATE_GAME) {\n\t\t\t// override the view's default transition to 'no transition' if \n\t\t\t// we're coming back from the game (or the app is starting)\n\t\t\ttransition = 'none';\n\t\t}\n\t\t\n\t\t// it might be the same if we just popped state, since\n\t\t// popping state sets this._currentView equal to an older view\n\t\tif (prevView != nextView) {\n\n\t\t\t// update the state and show the new view\n\t\t\tthis._currentState = state;\n\t\t\tthis._currentView = nextView;\n\t\t\tif (this._currentView) {\n\t\t\t\tthis._currentView.show(type, transition, level, this._level);\n\t\t\t} else {\n\t\t\t\tlogger.error('No current view for state', states[state]);\n\t\t\t\tif (DEBUG && this._currentState != states.STATE_GAME) {\n\t\t\t\t\tvar msg = 'Please define a view controller for the state ' + states[this._currentState] + ' in WeebyViews.js';\n\t\t\t\t\tlogger.error(msg);\n\t\t\t\t\tthrow new Error(msg);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// hide the old view (note that 'type: push' doesn't actually hide)\n\t\t\tif (prevView) {\n\t\t\t\tprevView.hide(type, transition, level, this._level);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._currentState = state;\n\t\t\tthis._currentView.updateBackground(transition, level);\n\t\t}\n\n\t\tthis._level = level;\n\n\t\t// If we're popping a view, the underlay above us will be \n\t\t// visible.  Hide it!\n\t\tthis.hideUnderlay(level + 1);\n\n\t\tif (level > 0) {\n\t\t\t// Try to keep views higher in zIndex if they're higher on the stack\n\t\t\tvar lastZ = this._viewStack[level - 1].getView().style.zIndex;\n\t\t\tvar view = this._currentView.getView();\n\t\t\tif (view.style.zIndex <= lastZ + 1) {\n\t\t\t\tview.style.zIndex = lastZ + 2;\n\t\t\t}\n\n\t\t\t// Show the underlay immediately below us\n\t\t\tthis.showUnderlay(level, view.style.zIndex - 2);\n\t\t}\n\t}\n\n\tthis.getUnderlay = function (level) {\n\t\tvar underlay;\n\t\tif (level > 0) {\n\t\t\tunderlay = this._underlays[level];\n\t\t\tif (!underlay) {\n\t\t\t\tunderlay = this._underlays[level] = new View({\n\t\t\t\t\tsuperview: this,\n\t\t\t\t\tbackgroundColor: 'black',\n\t\t\t\t\topacity: 0.7,\n\t\t\t\t\twidth: this.style.width,\n\t\t\t\t\theight: this.style.height,\n\t\t\t\t\tzIndex: 999,\n\t\t\t\t\tcanHandleEvents: true,\n\t\t\t\t\tvisible: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn underlay;\n\t}\n\n\tthis.hideUnderlay = function (level) {\n\t\tvar underlay = this.getUnderlay(level);\n\t\tif (underlay) {\n\t\t\ttransitions.hide(underlay, 'fade');\n\t\t}\n\t}\n\n\tthis.showUnderlay = function (level, zIndex) {\n\t\tvar underlay = this.getUnderlay(level);\n\t\tvar prevUnderlay = this.getUnderlay(level - 1);\n\t\tif (prevUnderlay) {\n\t\t\tthis.hideUnderlay(level - 1);\n\t\t}\n\n\t\t// show the underlay as long as the current state is up the stack\n\t\tunderlay.style.visible = true;\n\t\tunderlay.style.zIndex = zIndex;\n\t\ttransitions.show(underlay, 'fade');\n\t}\n\n\tthis.showDialog = function (name, transition) {\n\t\tswitch (name) {\n\t\t\tcase 'offline':\n\t\t\t\tweebyController.pushState(states.STATE_DIALOG_OFFLINE);\n\t\t\t\tbreak;\n\t\t}\n\t\t// var dialog = this._dialogs[name];\n\t\t// if (this._currentDialog && this._currentDialog != dialog) {\n\t\t// \tthis._currentDialog.hide(transition);\n\t\t// }\n\n\t\t// this._currentDialog = dialog;\n\t\t// this._dialogContainer.style.visible = true;\n\t\t// this._underlay.style.visible = true;\n\t\t// dialog.show(transition, this._stack.length);\n\t\t// this._underlay.getAnimation().now({opacity: 0.7});\n\n\t\t// if (DEBUG) {\n\t\t// \tif (this._currentDialogName != name) {\n\t\t// \t\tthis.onDialogChanged(name);\n\t\t// \t}\n\t\t// }\n\n\t\t// this._currentDialogName = name;\n\n\t\t// return dialog;\n\t};\n\n\tthis.closeDialog = function (name) {\n\t\t// if (this._currentDialog) {\n\t\t// \tthis._currentDialog.hide();\n\t\t// }\n\t};\n\n\tthis.onCloseDialog = function (dialog) {\n\t\t// if (dialog == this._currentDialog) {\n\t\t// \tthis._currentDialog = null;\n\t\t// \tthis._underlay.getAnimation().now({opacity: 0}).then(bind(this, function () {\n\t\t// \t\tthis._dialogContainer.style.visible = false;\n\t\t// \t\tthis._underlay.style.visible = false;\n\t\t// \t}));\n\t\t// }\n\t};\n\n});\n\nexports.getInstance = function () {\n\tif (!_instance) {\n\t\t_instance = new exports({\n\t\t\tsuperview: GC.app,\n\t\t\twidth: config.MAX_WIDTH,\n\t\t\theight: config.MAX_HEIGHT,\n\t\t\tinfinite: true,\n\t\t\tscale: config.SCALE\n\t\t});\n\t}\n\n\treturn _instance;\n}\n","pre":true},"sdk/plugins/weeby/ui/components/transitions.js":{"path":"sdk/plugins/weeby/ui/components/transitions.js","friendlyPath":".components.transitions","directory":"sdk/plugins/weeby/ui/components/","filename":"transitions.js","src":"jsio(\"import ..config\");\njsio(\"import animate\");\n\nfunction prepView(view) {\n\tvar s = view.style;\n\treturn (view.__transition_initial = {\n\t\t\t\tx: s.x,\n\t\t\t\ty: s.y,\n\t\t\t\tinitialOpacity: s.opacity,\n\t\t\t\tr: s.r,\n\t\t\t\twidth: s.width,\n\t\t\t\theight: s.height\n\t\t\t});\n}\n\nexports.show = function (view, transition, cb) {\n\tview.getInput().blockEvents = true;\n\tvar s = view.style;\n\n\tvar initial = view.__transition_initial || prepView(view);\n\tfor (var key in initial) {\n\t\ts[key] = initial[key];\n\t}\n\n\tvar onFinish = bind(this, function () {\n\t\tif (!s.opacity) { s.opacity = 1; }\n\t\tview.getInput().blockEvents = false;\n\t\tcb && cb();\n\t});\n\n\ts.visible = true;\n\n\tswitch (transition) {\n\t\tcase 'none':\n\t\t\tonFinish();\n\t\t\tbreak;\n\t\tcase 'fade':\n\t\t\tview.getAnimation()\n\t\t\t\t.now({opacity: initial.initialOpacity}, config.TRANSITION_TIME, animate.easeOut)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'dialogFade':\n\t\t\ts.anchorX = s.width / 2;\n\t\t\ts.anchorY = s.height / 2;\n\t\t\ts.scale = 1.5;\n\t\t\tview.getAnimation()\n\t\t\t\t.now({scale: 1, opacity: 1}, config.TRANSITION_TIME, animate.easeOut)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'fall':\n\t\t\ts.y = -2 * s.height;\n\t\t\ts.r = 0.5;\n\t\t\tview.getAnimation()\n\t\t\t\t.now({y: initial.y, r: -0.05}, config.TRANSITION_TIME)\n\t\t\t\t.then({r: 0.05}, 50)\n\t\t\t\t.then({r: 0}, 50)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'slideup':\n\t\t\ts.y += config.MAX_HEIGHT;\n\t\t\tview.getAnimation()\n\t\t\t\t.now({y: initial.y}, config.TRANSITION_TIME)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'slidedown':\n\t\t\ts.y = -s.height - initial.y;\n\t\t\tanimate(view)\n\t\t\t\t.now({y: initial.y})\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'slideleft':\n\t\tcase 'slideright':\n\t\tdefault:\n\t\t\ts.x = transition == 'slideright' ? -s.width : s.width;\n\t\t\tanimate(view)\n\t\t\t\t.now({x: initial.x}, config.TRANSITION_TIME)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t}\n}\n\nexports.hide = function (view, transition, cb) {\n\tview.getInput().blockEvents = true;\n\n\tvar initial = view.__transition_initial || prepView(view);\n\n\tvar s = view.style;\n\tvar onFinish = bind(this, function () {\n\t\tview.getInput().blockEvents = false;\n\t\ts.visible = false;\n\t\tcb && cb();\n\t});\n\n\tswitch (transition) {\n\t\tcase 'none':\n\t\t\tonFinish();\n\t\t\tbreak;\n\t\tcase 'fade':\n\t\t\tview.getAnimation()\n\t\t\t\t.now({opacity: 0}, config.TRANSITION_TIME, animate.easeOut)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'fall':\n\t\t\tview.getAnimation()\n\t\t\t\t.now({x: -this._view.style.width * 2, r: -0.5}, config.TRANSITION_TIME)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'dialogFade':\n\t\t\tview.getAnimation()\n\t\t\t\t.now({scale: 0.8, opacity: 0}, config.TRANSITION_TIME, animate.easeOut)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'slideup':\n\t\t\tview.getAnimation()\n\t\t\t\t.now({y: config.MAX_HEIGHT + s.y}, config.TRANSITION_TIME)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t\tcase 'slideleft':\n\t\tcase 'slideright':\n\t\tdefault:\n\t\t\tanimate(view)\n\t\t\t\t.then({x: transition == 'slideright' ? config.MAX_WIDTH : -config.MAX_WIDTH}, config.TRANSITION_TIME)\n\t\t\t\t.then(onFinish);\n\t\t\tbreak;\n\t}\n}\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/EquipViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/EquipViewController.js","friendlyPath":".controllers.game.EquipViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"EquipViewController.js","src":"jsio(\"import animate\");\njsio(\"import ui.resource.Image as Image\");\njsio(\"import ui.widget.ListView as ListView\");\njsio(\"import ui.widget.CellView as CellView\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.ParticleEngine as ParticleEngine\");\n\njsio(\"import ...components.WeebyListViewController as WeebyListViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ...config as uiConfig\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....weebyController\");\n\nvar TIME_FLYING = 500;\nvar Z_FLYIN_HIGH = 9999999;\nvar PARTICLE_COUNT = 12;\n\nvar sdk_plugins_weeby_ui_controllers_game_EquipViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_EquipViewController(function sdk_plugins_weeby_ui_controllers_game_EquipViewController(){return this.init&&this.init.apply(this,arguments)},WeebyListViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'EquipController',\n\t\t\t\tlayout: '$equip',\n\t\t\t\tdataKey: 'name',\n\t\t\t\toverrideCtors: {\n\t\t\t\t\t'$rows': ListView,\n\t\t\t\t\t'$row': CellView\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\t\tthis.effectsParent = opts.superview;\n\n\t\tvar weebyConfig = weebyController.getWeebyConfig()\n\t\tthis._currentEquip = {};\n\t\tthis._equipItems = [];\n\t\tvar equipSlots = weebyConfig.getEquipSlots();\n\t\tfor (var i = 0; i < equipSlots; i++) {\n\t\t\tthis._equipItems.push({});\n\t\t\tthis._currentEquip[i] = false;\n\t\t}\n\t\tthis._equipSlots = equipSlots;\n\t\tthis._listData.key = 'index';\n\n\t\tvar items = ',' + weebyLocalData.getEquipItems() + ',';\n\t\tvar equipItems = weebyConfig.getEquipItems();\n\t\tfor (var i = 0; i < equipItems.length; i++) {\n\t\t\tvar equipItem = equipItems[i];\n\t\t\tvar selected = items.indexOf(',' + equipItem.id + ',') !== -1;\n\t\t\tvar item = {\n\t\t\t\t\tindex: equipItem.name,\n\t\t\t\t\tid: equipItem.id,\n\t\t\t\t\ttitle: equipItem.name,\n\t\t\t\t\tdescription: equipItem.description,\n\t\t\t\t\tprice: equipItem.price,\n\t\t\t\t\timage: equipItem.iconUrl,\n\t\t\t\t\tequipItem: equipItem,\n\t\t\t\t\tselected: selected,\n\t\t\t\t\tanimating: false\n\t\t\t\t};\n\t\t\tthis._listData.add(item);\n\n\t\t\tif (selected) {\n\t\t\t\tthis._addEquipItem(equipItem);\n\t\t\t}\n\t\t}\n\n\t\tthis._views.$rows.updateOpts({\n\t\t\tdataSource: this._listData,\n\t\t\tscrollX: false,\n\t\t\tisFixedSize: true,\n\t\t\trecycle: true,\n\t\t\tgetCell: bind(this, 'getCell')\n\t\t});\n\n\t\tfor (var i = 0; i < this._equipSlots; i++) {\n\t\t\tvar equipSlot = this._views['$equip' + i];\n\t\t\tequipSlot.onInputSelect = bind(this, 'onUnEquip', i);\n\t\t}\n\n\t\tthis._addEvent('$playButton', 'InputSelect', bind(this, 'onPlay'));\n\t\tthis._addEvent('$closeButton', 'InputSelect', bind(weebyController, 'handleAction', 'back', null));\n\t\tthis._addEvent('$itemShopButton', 'InputSelect', bind(this, 'onItemShop'));\n\t\tthis._showEquip();\n\n\t\tthis.pEngine = new ParticleEngine({\n\t\t\tsuperview: opts.superview,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tzIndex: Z_FLYIN_HIGH,\n\t\t\twidth: 1,\n\t\t\theight: 1,\n\t\t\tinitCount: 2 * PARTICLE_COUNT,\n\t\t\tinitImage: uiConfig.getThemeImageURL(\"sparkleWhite.png\")\n\t\t});\n\t\tthis.boundParticleTick = bind(this, function(dt) {\n\t\t\tthis.pEngine.runTick(dt);\n\t\t});\n\t};\n\n\tthis._addEquipItem = function(item) {\n\t\tvar added = false;\n\t\tfor (var key in this._currentEquip) {\n\t\t\tif (!this._currentEquip[key]) {\n\t\t\t\tadded = true;\n\t\t\t\tthis._currentEquip[key] = item;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn added;\n\t};\n\n\tthis._showEquip = function () {\n\t\tfor (var i = 0; i < this._equipSlots; i++) {\n\t\t\tvar icon = this._views['$icon' + i];\n\t\t\tif (this._currentEquip[i] && !this._currentEquip[i].animating) {\n\t\t\t\ticon.setImage(this._currentEquip[i].iconUrl);\n\t\t\t\ticon.style.visible = true;\n\t\t\t} else {\n\t\t\t\ticon.style.visible = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._saveEquip = function () {\n\t\tvar items = [];\n\t\tfor (var key in this._currentEquip) {\n\t\t\tif (this._currentEquip[key]) {\n\t\t\t\titems.push(this._currentEquip[key].id);\n\t\t\t}\n\t\t}\n\t\tweebyLocalData.setEquipItems(items.join(','));\n\t};\n\n\tthis._removeItem = function (remove) {\n\t\tthis._listData.each(\n\t\t\tbind(\n\t\t\t\tthis,\n\t\t\t\tfunction (data) {\n\t\t\t\t\tif (data.id === remove.id) {\n\t\t\t\t\t\tdata.selected = false;\n\t\t\t\t\t\tthis._listData.updated(data);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t};\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\t\treturn root;\n\t};\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tviewStates.views.$image.setImage(data.image);\n\t\tviewStates.views.$title.setText(data.title);\n\t\tviewStates.views.$description.setText(data.description);\n\t\tviewStates.views.$price.setText(data.price);\n\t\tviewStates.views.$row.onInputSelect = bind(this, 'onSelectItem', viewStates, data);\n\n\t\tif (data.selected) {\n\t\t\tviewStates.addState('$button', 'checked');\n\t\t} else {\n\t\t\tviewStates.removeState('$button', 'checked');\n\t\t}\n\t};\n\n\tthis.onUnEquip = function (index) {\n\t\tif (this._currentEquip[index]) {\n\t\t\tthis._removeItem(this._currentEquip[index]);\n\t\t\tthis._currentEquip[index] = false;\n\t\t\tthis._showEquip();\n\t\t\tthis._saveEquip();\n\t\t}\n\t};\n\n\tthis.animateItem = function (viewStates, item, slotIndex) {\n\t\tvar startView = viewStates.views.$image;\n\t\tvar parent = this.effectsParent;\n\t\tvar pos = startView.getPosition(parent);\n\t\tvar finalView = this._views['$icon' + slotIndex];\n\t\tvar finalPos = finalView.getPosition(parent);\n\n\t\tvar flyer = new ImageView({\n\t\t\tsuperview: parent,\n\t\t\tx: pos.x,\n\t\t\ty: pos.y,\n\t\t\tzIndex: Z_FLYIN_HIGH,\n\t\t\twidth: startView.style.width,\n\t\t\theight: startView.style.height,\n\t\t\tanchorX: startView.style.width / 2,\n\t\t\tanchorY: startView.style.height / 2,\n\t\t\timage: startView.getImage(),\n\t\t\tscale: startView.scale,\n\t\t\tvisible: false,\n\t\t\tcanHandleEvents: false\n\t\t});\n\n\t\tvar delay = 0;\n\t\tvar svs = startView.style;\n\t\tvar fs = flyer.style;\n\t\t\n\t\tfs.x = pos.x;\n\t\tfs.y = pos.y;\n\t\tfs.anchorX = svs.width / 2;\n\t\tfs.anchorY = svs.height / 2;\n\t\tfs.width = svs.width;\n\t\tfs.height = svs.height;\n\t\tfs.scale = svs.scale;\n\t\tfs.visible = true;\n\n\t\tanimate(flyer)\n\t\t.now({\n\t\t\tx: finalPos.x,\n\t\t\ty: finalPos.y,\n\t\t\twidth: finalView.style.width,\n\t\t\theight: finalView.style.height\n\t\t}, TIME_FLYING, animate.easeInOut)\n\t\t.then(bind(this, function() {\n\t\t\tfs.visible = false;\n\t\t\tflyer.removeFromSuperview();\n\t\t\titem.equipItem.animating = false;\n\t\t\tthis._showEquip();\n\t\t}));\n\n\t};\n\t\n\tthis.onSelectItem = function (viewStates, item) {\n\t\tif (!item.equipItem.animating) {\n\t\t\tif (item.selected) {\n\t\t\t\titem.selected = false;\n\t\t\t\titem.equipItem.animating = false;\n\t\t\t\tviewStates.removeState('$button', 'checked');\n\t\t\t\tthis.onUnselect(item);\n\n\t\t\t\ttrackers.track('equip:powerupDisabled', {powerup: item.id});\n\t\t\t} else {\n\t\t\t\titem.equipItem.animating = true;\n\t\t\t\tfor (var i = this._equipSlots; i > 0 ; i--) {\n\t\t\t\t\tif (!this._currentEquip[i - 1]) {\n\t\t\t\t\t\tvar slotIndex = i - 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.onSelect(item)) {\n\t\t\t\t\ttrackers.track('equip:powerupEnabled', {powerup: item.equipItem.id});\n\t\t\t\t\titem.selected = true;\n\t\t\t\t\tthis.animateItem(viewStates, item, slotIndex);\n\t\t\t\t\tviewStates.addState('$button', 'checked');\n\t\t\t\t} else {\n\t\t\t\t\titem.equipItem.animating = false;\n\t\t\t\t\ttrackers.track('equip:error:slots');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.onSelect = function (item) {\n\t\tvar added = this._addEquipItem(item.equipItem);\n\t\tthis._showEquip();\n\t\tthis._saveEquip();\n\t\treturn added;\n\t};\n\n\tthis.onUnselect = function (item) {\n\t\tfor (var key in this._currentEquip) {\n\t\t\tif (this._currentEquip[key] && this._currentEquip[key].id === item.id) {\n\t\t\t\tthis._currentEquip[key] = false;\n\t\t\t}\n\t\t}\n\n\t\tthis._showEquip();\n\t\tthis._saveEquip();\n\t};\n\n\tthis.getEquippedItems = function () {\n\t\tvar data = {};\n\t\tvar equipItems = {};\n\t\tfor (var key in this._currentEquip) {\n\t\t\tif (this._currentEquip[key]) {\n\t\t\t\tequipItems[this._currentEquip[key].id] = this._currentEquip[key];\n\t\t\t}\n\t\t}\n\t\tdata.equipItems = equipItems;\n\t\treturn data;\n\t};\n\n\tthis.onClose = function() {\n\t\ttrackers.track('equip:backBtn');\n\t\tweebyController.handleAction('close');\n\t};\n\n\tthis.onItemShop = function() {\n\t\ttrackers.track('equip:itemShopBtn');\n\t\tweebyController.handleAction('itemshop');\n\t}\n\n\tthis.onPlay = function () {\t\t\n\t\ttrackers.track('equip:playBtn');\n\t\tvar data = this.getEquippedItems();\n\t\tif (weebyController.canPlayGame(data)) {\n\t\t\tthis.startHeartBurst();\n\t\t}\n\t};\n\n\tvar heartImage = new Image({url: uiConfig.getThemeImageURL(\"icon_life.png\")});\n\tthis.startHeartBurst = function () {\n\t\tGC.app.view.getInput().blockEvents = true;\n\n\t\tvar parent = this.effectsParent,\n\t\t\tps = parent.style,\n\t\t\tmap = heartImage.getMap(),\n\t\t\ttargetHeartWidth = 60,\n\t\t\theartWidth = map.width + map.marginLeft + map.marginRight,\n\t\t\theartHeight = map.height + map.marginTop + map.marginBottom;\n\n\t\theartHeight = heartHeight * targetHeartWidth / heartWidth;\n\t\theartWidth = targetHeartWidth;\n\n\t\tvar heart = new ImageView({\n\t\t\tparent: parent,\n\t\t\tx: (ps.width - heartWidth) / 2,\n\t\t\ty: (ps.height - heartHeight) / 2,\n\t\t\tzIndex: Z_FLYIN_HIGH - 1,\n\t\t\tanchorX: heartWidth / 2,\n\t\t\tanchorY: heartHeight / 2,\n\t\t\twidth: heartWidth,\n\t\t\theight: heartHeight,\n\t\t\tscale: 0,\n\t\t\timage: heartImage,\n\t\t\tcanHandleEvents: false\n\t\t});\n\n\t\tanimate(heart)\n\t\t.now({ scale: 2 }, 250, animate.easeIn)\n\t\t.then({ scale: 1.5 }, 100, animate.easeOut)\n\t\t.then({ scale: 2 }, 200, animate.easeOut)\n\t\t.then({ scale: 1.8 }, 150, animate.easeOut)\n\t\t.then(bind(this, function() {\n\t\t\tanimate(heart)\n\t\t\t.then({ scale: 4, opacity: 0 }, 200, animate.easeOut)\n\t\t\t.then(bind(this, function() {\n\t\t\t\theart.removeFromSuperview();\n\t\t\t}))\n\t\t\t.wait(500)\n\t\t\t.then(bind(this, function() {\n\t\t\t\tthis.finishHeartBurst();\n\t\t\t}));\n\n\t\t\tthis.emitHeartBurst();\n\t\t}));\n\t};\n\n\tthis.emitHeartBurst = function () {\n\t\tthis._views.$equip.tick = this.boundParticleTick;\n\n\t\tvar random = Math.random,\n\t\t\tps = this.effectsParent.style,\n\t\t\tgleams = 5,\n\t\t\tdata = this.pEngine.obtainParticleArray(gleams),\n\t\t\twidth = 66,\n\t\t\theight = 66,\n\t\t\tttl = 666,\n\t\t\tstop = -1000 / ttl,\n\t\t\toffr = random() * 6.28;\n\n\t\tvar sparkleWhiteURL = uiConfig.getThemeImageURL(\"sparkleWhite.png\");\n\n\t\tfor (var i = 0; i < gleams; i++) {\n\t\t\tvar pObj = data[i];\n\n\t\t\tpObj.image = sparkleWhiteURL;\n\t\t\tpObj.polar = true;\n\t\t\tpObj.ox = (ps.width - width) / 2;\n\t\t\tpObj.oy = (ps.height - height) / 2;\n\t\t\tpObj.dr = 15;\n\t\t\tpObj.ddr = stop * pObj.dr;\n\t\t\tpObj.radius = 40;\n\t\t\tpObj.theta = offr + 6.28 * i / gleams;\n\t\t\tpObj.anchorX = width / 2;\n\t\t\tpObj.anchorY = height / 2;\n\t\t\tpObj.width = width;\n\t\t\tpObj.height = height;\n\t\t\tpObj.scale = 0;\n\t\t\tpObj.dscale = 12;\n\t\t\tpObj.ddscale = 2.75 * stop * pObj.dscale;\n\t\t\tpObj.ttl = ttl;\n\t\t}\n\n\t\tthis.pEngine.emitParticles(data);\n\n\t\tvar count = PARTICLE_COUNT,\n\t\t\tforce = 450;\n\n\t\tdata = this.pEngine.obtainParticleArray(count);\n\t\tstop = -1000 / ttl;\n\t\twidth = 45;\n\t\theight = 45;\n\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tvar pObj = data[i];\n\t\t\tpObj.image = sparkleWhiteURL;\n\t\t\tpObj.polar = true;\n\t\t\tpObj.ox = (ps.width - width) / 2;\n\t\t\tpObj.oy = (ps.height - height) / 2;\n\t\t\tpObj.dr = 15;\n\t\t\tpObj.ddr = stop * pObj.dr;\n\t\t\tpObj.radius = 40;\n\t\t\tpObj.dradius = force;\n\t\t\tpObj.ddradius = stop * pObj.dradius;\n\t\t\tpObj.theta = 6.28 * i / count + random() * 0.2 - 0.1;\n\t\t\tpObj.anchorX = width / 2;\n\t\t\tpObj.anchorY = height / 2;\n\t\t\tpObj.width = width;\n\t\t\tpObj.height = height;\n\t\t\tpObj.scale = 0.75;\n\t\t\tpObj.ttl = ttl;\n\n\t\t\tvar dspct = pObj.dradius / force;\n\t\t\tpObj.dscale = 2.25 * (1 - (dspct * dspct));\n\t\t\tpObj.ddscale = 7 * stop;\n\t\t}\n\n\t\tthis.pEngine.emitParticles(data);\n\t};\n\n\tthis.finishHeartBurst = function () {\n\t\tGC.app.view.getInput().blockEvents = false;\n\t\tthis.pEngine.killAllParticles();\n\t\tthis._views.$equip.tick = undefined;\n\n\t\tvar data = this.getEquippedItems();\n\t\tif (weebyController.canPlayGame(data)) {\n\t\t\tweebyController.handleAction('play', data);\n\t\t}\n\t};\n});\n","pre":true},"sdk/timestep/ui/widget/ListView.js":{"path":"sdk/timestep/ui/widget/ListView.js","friendlyPath":"ui.widget.ListView","directory":"sdk/timestep/ui/widget/","filename":"ListView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.widget.ListView;\n *\n * @doc http://doc.gameclosure.com/api/ui-widget-listview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/widget/listview.md\n */\n\njsio(\"import squill.models.List as List\");\njsio(\"import ui.ScrollView as ScrollView\");\njsio(\"import event.input.InputEvent as InputEvent\");\n\n/**\n * @extends ui.ScrollView\n */\nvar sdk_timestep_ui_widget_ListView=__class__;exports=sdk_timestep_ui_widget_ListView(function sdk_timestep_ui_widget_ListView(){return this.init&&this.init.apply(this,arguments)},ScrollView, function (supr) {\n\tthis.init = function (opts) {\n\n\t\tthis._scrollBuffer = opts.scrollBuffer;\n\n\t\topts.scrollBounds = {\n\t\t\tminX: 0,\n\t\t\tminY: 0,\n\t\t\tmaxX: Number.MAX_VALUE,\n\t\t\tmaxY: Number.MAX_VALUE\n\t\t};\n\n\t\tthis.model = new List({view: this});\n\t\tsupr(this, 'init', [opts]);\n\t};\n\n\tthis.tag = 'ListView';\n\n\tthis.updateOpts = function () {\n\t\tvar opts = supr(this, 'updateOpts', arguments);\n\n\t\tvar listOpts = {\n\t\t\tview: this,\n\t\t\tgetCell: opts.getCell,\n\t\t\tsorter: opts.sorter,\n\t\t\tselectable: opts.selectable,\n\t\t\tselections: opts.selections,\n\t\t\tmaxSelections: opts.maxSelections,\n\t\t\tdataSource: opts.dataSource,\n\t\t\tmargin: opts.renderMargin\n\t\t};\n\n\t\tif ('recycle' in opts) {\n\t\t\tlistOpts.recycle = opts.recycle;\n\t\t}\n\n\t\tif ('isFixedSize' in opts) {\n\t\t\tlistOpts.isFixedSize = opts.isFixedSize;\n\t\t}\n\n\t\tif ('isTiled' in opts) {\n\t\t\tlistOpts.isTiled = opts.isTiled;\n\t\t}\n\n\t\tthis.model.updateOpts(listOpts);\n\t\tthis.selection = this.model.selection;\n\t\tif (this._onSelect) {\n\t\t\tthis.model.subscribe('Select', this, this._onSelect);\n\t\t}\n\t\tif (this._onDeselect) {\n\t\t\tthis.model.subscribe('Deselect', this, this._onDeselect);\n\t\t}\n\n\t\tthis._autoSize = opts.autoSize;\n\n\t\t// make sure the height is not undefined for compatibility with the layouts\n\t\tif (this._autoSize && !this.style.height) { this.style.height = 0; }\n\n\t\tthis._needsModelRender = true;\n\n\t\tif (listOpts.isFixedSize) {\n\t\t\tthis.subscribe('Scrolled', this, '_onScroll');\n\t\t} else {\n\t\t\tthis.unsubscribe('Scrolled', this, '_onScroll');\n\t\t}\n\n\t\treturn opts;\n\t};\n\n\t// This function returns a DataSource\n\tthis.getSelections = function () {\n\t\treturn this.model.getSelections();\n\t};\n\n\t// This function returns an object the keys are the selected items\n\tthis.getSelection = function () {\n\t\treturn this.model.selection.get();\n\t};\n\n\tthis.getSelectionCount = function () {\n\t\treturn this.model.getSelectionCount();\n\t};\n\n\tthis.deselectAll = function () {\n\t\tthis.model.deselectAll();\n\t};\n\n\tthis._onScroll = function () {\n\t\tthis._needsModelRender = true;\n\t\tthis.needsRepaint();\n\t};\n\n\tthis.reflow = function () {\n\t\tthis._needsModelRender = true;\n\t};\n\n\t// This method is for internal use only!\n\tthis.addCell = function (cellView) {\n\t\tcellView.style.visible = true;\n\t\tthis.addSubview(cellView);\n\t\tthis.needsRepaint(true);\n\t};\n\n\tthis.setFooterView = function (footerView) {\n\t\tif (this._footerView) {\n\t\t\tthis._footerView.removeFromSuperview();\n\t\t}\n\t\t\n\t\tthis._footerView = footerView;\n\t\tif (this._footerView) {\n\t\t\tthis.addSubview(footerView);\n\n\t\t\t// position the footer at the bottom of the list\n\t\t\tfooterView.style.y = this._heightWithoutFooter || 0;\n\n\t\t\t// update the scroll bounds to account for the footer\n\t\t\tthis.setMaxY(this._heightWithoutFooter);\n\t\t}\n\t}\n\n\tthis.setMaxX = function (maxX) {\n\n\t\tif (this._autoSize && this.style.width != maxX) {\n\t\t\tthis.style.width = maxX;\n\t\t\tthis._needsModelRender = true;\n\t\t}\n\n\t\t// TODO: stop publishing WidthChanged when we move to timestep ui\n\t\t// because this is done by ScrollView\n\n\t\tvar bounds = this._scrollBounds;\n\t\tvar oldMaxX = bounds.maxX;\n\t\tvar newMaxX = Math.max(0, maxX);\n\n\t\tbounds.minX = bounds.maxX = 0;\n\t\tbounds.minX = 0;\n\t\tbounds.maxX = newMaxX;\n\n\t\tvar scrollBuffer = this._opts.scrollBuffer;\n\t\tif (scrollBuffer) {\n\t\t\tbounds.minX += scrollBuffer.minX;\n\t\t\tbounds.maxX += scrollBuffer.maxX;\n\t\t}\n\n\t\tif (oldMaxX != newMaxX) {\n\t\t\tthis.publish(\"WidthChanged\", maxX);\n\t\t}\n\t};\n\n\tthis.setMaxY = function (maxY) {\n\n\t\tvar footerHeight = 0;\n\t\tif (this._footerView) {\n\t\t\tfooterHeight = this._footerView.style.height || 0;\n\t\t\tthis._footerView.style.y = maxY;\n\t\t}\n\n\t\tthis._heightWithoutFooter = maxY;\n\t\tmaxY = maxY + footerHeight;\n\n\t\tif (this._autoSize && this.style.height != maxY) {\n\t\t\tthis.style.height = maxY;\n\t\t\tthis._needsModelRender = true;\n\t\t}\n\n\t\t// TODO: stop publishing HeightChanged when we move to timestep ui\n\t\t// because this is done by ScrollView\n\n\t\tvar bounds = this._scrollBounds;\n\t\tvar oldMaxY = bounds.maxY;\n\t\tvar newMaxY = Math.max(0, maxY);\n\n\t\tbounds.minX = bounds.maxX = 0;\n\t\tbounds.minY = 0;\n\t\tbounds.maxY = newMaxY;\n\n\t\tvar scrollBuffer = this._opts.scrollBuffer;\n\t\tif (scrollBuffer) {\n\t\t\tbounds.minY += scrollBuffer.minY;\n\t\t\tbounds.maxY += scrollBuffer.maxY;\n\t\t}\n\n\t\tif (oldMaxY != newMaxY) {\n\t\t\tthis.publish(\"HeightChanged\", maxY);\n\t\t}\n\t};\n\n\tthis.render = function (ctx, opts) {\n\t\tvar viewportChanged = supr(this, 'render', arguments);\n\n\t\tif (viewportChanged || this._needsModelRender || this.model._needsSort) {\n\t\t\tthis._needsModelRender = false;\n\t\t\tthis.model.render(opts.viewport);\n\t\t}\n\t};\n});\n\n","pre":true},"sdk/squill/models/List.js":{"path":"sdk/squill/models/List.js","friendlyPath":"squill.models.List","directory":"sdk/squill/models/","filename":"List.js","src":"jsio(\"import .Resource\");\njsio(\"import .Widget\");\njsio(\"import ..Selection\");\n\nvar sdk_squill_models_List=__class__;var List = exports=sdk_squill_models_List(function sdk_squill_models_List(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis.init = function(opts) {\n\t\topts = merge(opts, {\n\t\t\tisFixedSize: true,\n\t\t\trecycle: true\n\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._cellResource = new Resource();\n\t\tthis._cells = {};\n\t\tthis._needsSort = true;\n\t\tthis._removed = {};\n\t\tthis._renderOpts = {margin: 0};\n\n\t\tthis.isRecycleEnabled = opts.recycle;\n\n\t\tthis.updateOpts(opts);\n\t}\n\n\tthis.updateOpts = function (opts) {\n\t\tif (this._opts) {\n\t\t\tfor (var key in opts) {\n\t\t\t\tthis._opts[key] = opts[key];\n\t\t\t}\n\t\t} else {\n\t\t\tthis._opts = opts;\n\t\t}\n\n\t\tif (opts.getCell) { this.setCellGetter(opts.getCell); }\n\t\tif (opts.dataSource) { this.setDataSource(opts.dataSource); }\n\t\tif (opts.sorter) { this.setSorter(opts.sorter); }\n\n\t\tthis._renderMargin = opts.renderMargin || 0;\n\t\tthis._maxSelections = opts.maxSelections || 1;\n\n\t\tif (opts.selectable) {\n\t\t\tthis.selection = new Selection({parent: this, type: opts.selectable, maxSelections: opts.maxSelections});\n\t\t\tthis.selection.subscribe('Select',   this, this._onSelect);\n\t\t\tthis.selection.subscribe('Deselect', this, this._onDeselect);\n\t\t\tif (opts.selections) {\n\t\t\t\tthis.setSelections(opts.selections);\n\t\t\t}\n\t\t}\n\n\t\treturn this._opts;\n\t}\n\n\tthis.setSelections = function(selections) {\n\t\tselections.forEach(bind(this, 'select'));\n\t};\n\n\tthis.getDataSource = function() {\n\t\treturn this._dataSource;\n\t};\n\n\tthis.setDataSource = function(dataSource) {\n\t\tthis._dataSource = dataSource;\n\t\tthis._dataSource.subscribe('Update', this, '_onUpdate');\n\t\tthis._dataSource.subscribe('Remove', this, '_onRemove');\n\t}\n\n\tthis._onUpdate = function(id, item) {\n\t\tvar cell = this._cells[id];\n\t\tif (cell) { cell.setData(item, id); }\n\t\tthis.needsSort();\n\t}\n\n\tthis._onRemove = function(id, item) {\n\t\tthis._removed[id] = true;\n\t\tthis.needsSort();\n\t}\n\n\tthis.needsSort = function() { this._needsSort = true; this._view.needsRepaint(); }\n\n\tthis.setSelected = function(data) { this._selected = data; }\n\tthis.getSelected = function() { return this._selected; }\n\n\tthis.setCellGetter = function(getCell) { this._getCell = getCell; }\n\tthis.getCellById = function(id) { return this._cells[id]; }\n\n\tthis.setSorter = function(sorter) { this._sorter = sorter; }\n\n\t// just render all cells for now\n\tthis.render = function(viewport) {\n\t\tif (this._needsSort) {\n\t\t\tthis._needsSort = null;\n\t\t\tthis._dataSource.sort();\n\t\t}\n\n\t\tvar count = this._dataSource.length;\n\t\tif (this._opts.isFixedSize && count) {\n\t\t\tthis.renderFixed(viewport);\n\t\t} else {\n\t\t\tthis._removeCells(); // remove the views that were deleted from the datasource\n\n\t\t\tif (count) {\n\t\t\t\tthis.renderVariable(viewport);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.getRenderOpts = function() { return this._renderOpts; }\n\n\t// y is required for non-fixed-size lists.  Otherwise, y is ignored.\n\tthis._positionCell = function(cell, i, y) {\n\t\tthis._view.addCell(cell);\n\n\t\tvar r = this._renderOpts;\n\t\tif (this._opts.isFixedSize) {\n\t\t\tif (this._opts.isTiled) {\n\t\t\t\tvar x = i % r.numPerRow;\n\t\t\t\tvar y = (i / r.numPerRow) | 0;\n\t\t\t\tcell.setPosition({\n\t\t\t\t\tx: x * r.fullWidth,\n\t\t\t\t\ty: y * r.fullHeight,\n\t\t\t\t\twidth: r.cellWidth,\n\t\t\t\t\theight: r.cellHeight\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcell.setPosition({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: i * r.fullHeight || 0,\n\t\t\t\t\theight: r.cellHeight\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tcell.setPosition({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: y\n\t\t\t\t});\n\t\t}\n\t}\n\n\tthis.renderVariable = function(viewport) {\n\t\tif (!this._dataSource) { return; }\n\t\tif (!this._updateRenderOpts(viewport)) { return; }\n\n\t\tvar i = 0;\n\t\tvar y = 0;\n\t\tfunction renderOne() {\n\t\t\tvar item = this._dataSource.getItemForIndex(i);\n\t\t\tif (!item) {\n\t\t\t\tthis._view.setMaxY(y);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar id = item[this._dataSource.key];\n\t\t\tvar cell = this._createCell(item);\n\t\t\tthis._positionCell(cell, i, y);\n\t\t\tcell.needsRepaint();\n\n\t\t\t++i;\n\t\t\ty += cell.style.height;\n\t\t\treturn true;\n\t\t}\n\n\t\tfunction renderMany() {\n\t\t\tvar THRESHOLD = 50; // ms to render\n\t\t\tvar n = 0, t = +new Date();\n\t\t\twhile (n++ < 10 || +new Date() - t < THRESHOLD) {\n\t\t\t\tif (!renderOne.call(this)) { return; }\n\t\t\t}\n\n\t\t\tsetTimeout(bind(this, renderMany), 100);\n\t\t}\n\n\t\trenderMany.call(this);\n\t}\n\n\tthis._removeCells = function () {\n\t\tvar removed = this._removed;\n\t\tthis._removed = {};\n\t\tfor (var id in removed) {\n\t\t\tif (!this._dataSource.getItemForID(id)) {\n\t\t\t\tvar cell = this._cells[id];\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.remove(this);\n\t\t\t\t\tdelete this._cells[id];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tthis._createCell = function(item) {\n\n\t\tvar id = item[this._dataSource.key];\n\t\tvar cell = this._cells[id];\n\t\tif (!cell) {\n\t\t\tif (this.isRecycleEnabled) {\n\t\t\t\tcell = this._cellResource.get();\n\t\t\t}\n\n\t\t\tif (!cell) {\n\t\t\t\tcell = this._getCell(item, this._cellResource);\n\t\t\t}\n\n\t\t\tthis._cells[id] = cell;\n\t\t\tcell.setController(this);\n\t\t\tcell.setData(item, id);\n\t\t\tcell.model.setResource(this._cellResource);\n\t\t}\n\n\t\treturn cell;\n\t}\n\n\tthis._updateRenderOpts = function(viewport) {\n\t\tvar r = this._renderOpts;\n\t\tr.top = viewport.y - this._renderMargin;\n\t\tr.height = viewport.height + 2 * this._renderMargin;\n\t\tr.bottom = r.top + r.height;\n\t\tvar n = r.numRows = this._dataSource.length;\n\n\t\tif (this._opts.isFixedSize) {\n\t\t\tif (!r.cellWidth || !r.cellHeight) {\n\t\t\t\tvar item = this._dataSource.getItemForIndex(0);\n\t\t\t\tif (!item) { return false; }\n\n\t\t\t\tvar key = item[this._dataSource.key];\n\t\t\t\tvar cell = this._cells[key] || (this._cells[key] = this._createCell(item));\n\t\t\t\tr.fullWidth = r.cellWidth = cell.getWidth();\n\t\t\t\tr.fullHeight = r.cellHeight = cell.getHeight();\n\t\t\t\tif ((this._opts.isTiled && !r.cellWidth) || !r.cellHeight) { return null; }\n\n\t\t\t\tvar margin = this._opts.margin || 0;\n\t\t\t\tif (margin) { r.fullWidth += margin; r.fullHeight += margin; }\n\t\t\t}\n\n\t\t\tif (this._opts.isTiled) {\n\t\t\t\tr.maxWidth = viewport.width;\n\t\t\t\tr.numPerRow = r.maxWidth / r.fullWidth | 0;\n\t\t\t\tr.numRows = Math.ceil(n / r.numPerRow);\n\t\t\t\tr.start = Math.max(0, (r.top / r.fullHeight | 0) * r.numPerRow);\n\t\t\t\tr.end = Math.ceil(r.bottom / r.fullHeight) * r.numPerRow;\n\t\t\t} else {\n\t\t\t\tr.start = Math.max(0, r.top / r.fullHeight | 0);\n\t\t\t\tr.end = (r.bottom / r.fullHeight + 1) | 0;\n\t\t\t}\n\n\t\t\tthis._view.setMaxY(r.numRows * r.fullHeight);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tthis.renderFixed = function(viewport) {\n\t\tif (!(this._updateRenderOpts(viewport))) { return; }\n\n\t\tvar r = this._renderOpts;\n\t\tvar i = 0;\n\t\tvar dataSource = this._dataSource;\n\t\tvar key = dataSource.key;\n\n\t\tvar cells = this._cells;\n\t\tvar newCells = {};\n\n\t\tfor (var i = r.start; i < r.end; ++i) {\n\t\t\tvar item = dataSource.getItemForIndex(i);\n\t\t\tif (!item) {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tvar cell = this._createCell(item);\n\t\t\t\tif (cell) {\n\t\t\t\t\tnewCells[item[key]] = cell;\n\t\t\t\t\tthis._positionCell(cell, i);\n\n\t\t\t\t\t// we remove all cells in prevCells that aren't used.\n\t\t\t\t\t// mark it as used by deleting it.\n\t\t\t\t\tdelete cells[item[key]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var id in cells) {\n\t\t\tvar cell = cells[id];\n\n\t\t\tcell.remove(this);\n\t\t\tif (this.isRecycleEnabled) {\n\t\t\t\tcell.model.recycle();\n\t\t\t}\n\t\t}\n\n\t\tthis._cells = newCells;\n\t};\n\n\tthis._onSelect = function(dataItem, id) {\n\t\tthis.publish('Select', dataItem, id);\n\t};\n\n\tthis._onDeselect = function(dataItem, id) {\n\t\tthis.publish('Deselect', dataItem, id);\n\t};\n\n\tthis.isSelected = function(dataItem) {\n\t\treturn this.selection && this.selection.isSelected(dataItem);\n\t};\n\n\tthis.toggle = function(dataItem) {\n\t\tthis.selection && this.selection.toggle(dataItem);\n\t}\n\n\tthis.select = function(dataItem) {\n\t\tthis.selection && this.selection.select(dataItem);\n\t};\n\n\tthis.deselect = function(dataItem) {\n\t\tthis.selection && this.selection.deselect(dataItem);\n\t};\n\n\tthis.deselectAll = function() {\n\t\tif (this.selection) {\n\t\t\tvar selection = this.selection.get();\n\t\t\tfor (var id in selection) {\n\t\t\t\tvar cell = this._cells[id];\n\t\t\t\tcell && cell._onDeselect && cell._onDeselect();\n\t\t\t}\n\t\t\tthis.selection.deselectAll();\n\t\t}\n\t};\n\n\tthis.getSelections = function() {\n\t\tvar selectionIDMap = this.selection.get();\n\t\tvar dataSource = this.getDataSource();\n\t\tvar key = dataSource.getKey();\n\n\t\treturn dataSource.getFilteredDataSource(\n\t\t\t\tfunction(item){\n\t\t\t\t\tvar itemKey = item[key];\n\t\t\t\t\treturn !!selectionIDMap[itemKey];\n\t\t\t\t}\n\t\t\t);\n\t};\n\n\tthis.getSelectionCount = function() {\n\t\treturn this.selection && this.selection.getSelectionCount();\n\t};\n});\n","pre":true},"sdk/squill/models/Resource.js":{"path":"sdk/squill/models/Resource.js","friendlyPath":".Resource","directory":"sdk/squill/models/","filename":"Resource.js","src":"var sdk_squill_models_Resource=__class__;exports=sdk_squill_models_Resource(function sdk_squill_models_Resource(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function() {\n\t\tthis._data = {};\n\t}\n\t\n\tthis.get = function(key) {\n\t\treturn this._data[key] && this._data[key].pop();\n\t}\n\t\n\tthis.put = function(item, key) {\n\t\t(this._data[key] || (this._data[key] = [])).push(item);\n\t}\n});","pre":true},"sdk/squill/models/Widget.js":{"path":"sdk/squill/models/Widget.js","friendlyPath":".Widget","directory":"sdk/squill/models/","filename":"Widget.js","src":"\"use import\";\n\njsio(\"import lib.PubSub\");\n\nvar sdk_squill_models_Widget=__class__;exports=sdk_squill_models_Widget(function sdk_squill_models_Widget(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\tthis.init = function(opts) {\n\t\tthis._opts = opts;\n\t\tthis._view = opts.view;\n\t}\n});","pre":true},"sdk/squill/Selection.js":{"path":"sdk/squill/Selection.js","friendlyPath":"..Selection","directory":"sdk/squill/","filename":"Selection.js","src":"\"use import\";\n\njsio(\"import lib.PubSub\");\n\n/**\n * The Selection class connects a selection storage to a UI element.\n *\n * A selection storage is very simple class that maintains the data layer of \n * a selection. It is entirely based on item ID, exposing the methods:\n *   isSelected(id) -> bool\n *   select(id)\n *   deselect(id)\n * You may, for example, want to implement a selection store that persists\n * the current selection over a network. The base implementation of a selection\n * storage is exports.LocalStore, which simply wraps an in-memory object.\n * \n * The Selection class handles logic such as how many items can be selected\n * at once, and provides the API that UI widgets can interact with.  For example,\n * the squill.List class contains a public proprty .selection that is an\n * instance of a Selection instance.\n */\nvar sdk_squill_Selection=__class__;exports=sdk_squill_Selection(function sdk_squill_Selection(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\n\tthis.init = function(opts) {\n\t\tthis._parent = opts.parent;\n\t\tthis._type = opts.type || false;\n\t\tthis._selection = opts.selectionStore || new exports.LocalStore();\n\t\tthis._maxSelections = opts.maxSelections || 1;\n\t\tthis._currentSelectionCount = 0;\n\t\tthis._lastSelected = null;\n\t};\n\n\tthis.getType = function() { return this._type; };\n\n\tthis.isSelected = function(id) {\n\t\tif (typeof id == 'object') {\n\t\t\tid = id[this._parent.getDataSource().key];\n\t\t}\n\t\treturn this._selection.isSelected(id);\n\t};\n\n\tthis.toggle = function(item) {\n\t\tthis._setSelected(item, !this.isSelected(item[this._parent.getDataSource().key]));\n\t};\n\n\tthis.select = function(item) {\n\t\tif((this._currentSelectionCount < this._maxSelections) || this._type == 'single') {\n\t\t\tthis._setSelected(item, true);\n\t\t}\n\t};\n\n\tthis.deselect = function(item) {\n\t\tthis._setSelected(item, false);\n\t};\n\n\tthis.deselectAll = function() {\n\t\tthis._selection.deselectAll();\n\t};\n\n\tthis.get = function() { return this._selection.get(); };\n\n\tthis.getSelectionCount = function() {\n\t\treturn this._currentSelectionCount;\n\t};\n\t\n\tthis._setSelected = function(item, isSelected) {\n\t\tif (!item) { return; }\n\t\t\n\t\tvar dataSource = this._parent.getDataSource(),\n\t\t\tkey = dataSource.key;\n\t\tif (typeof item == 'string') {\n\t\t\titem = dataSource.get(item);\n\t\t}\n\t\tvar id = item[key];\n\n\t\tif (this._selection.isSelected(id) != isSelected) {\n\t\t\tif (isSelected) {\n\t\t\t\tif (this._lastSelected && this._type == 'single') {\n\t\t\t\t\tvar lastID = this._lastSelected[key];\n\t\t\t\t\tthis._selection.deselect(lastID);\n\t\t\t\t\tthis._currentSelectionCount--;\n\t\t\t\t\tthis.publish('Deselect', this._lastSelected, lastID);\n\t\t\t\t}\n\n\t\t\t\tthis._lastSelected = item;\n\t\t\t\tthis._selection.select(id);\n\t\t\t\tthis._currentSelectionCount++;\n\t\t\t} else {\n\t\t\t\tthis._selection.deselect(id);\n\t\t\t\tthis._currentSelectionCount--;\n\t\t\t}\n\n\t\t\tthis.publish(isSelected ? 'Select' : 'Deselect', item, id);\n\t\t}\n\t};\n});\n\nexports.LocalStore=__class__;exports.LocalStore=exports.LocalStore(function exports_LocalStore(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function() {\n\t\tthis._store = {};\n\t}\n\t\n\tthis.get = function() {\n\t\treturn merge({}, this._store);\n\t}\n\n\tthis.select = function(id) {\n\t\tthis._store[id] = true;\n\t}\n\t\n\tthis.deselect = function(id) {\n\t\tdelete this._store[id];\n\t}\n\t\n\tthis.deselectAll = function(id) {\n\t\tthis._store = {};\n\t}\n\t\n\tthis.isSelected = function(id) {\n\t\tif (id !== undefined) {\n\t\t\treturn !!this._store[id];\n\t\t} else {\n\t\t\tfor (var key in this._store) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n});\n\n","pre":true},"sdk/timestep/ui/ScrollView.js":{"path":"sdk/timestep/ui/ScrollView.js","friendlyPath":"ui.ScrollView","directory":"sdk/timestep/ui/","filename":"ScrollView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ScrollView;\n *\n * @doc http://doc.gameclosure.com/api/ui-scrollview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/scrollview.md\n */\njsio(\"import animate\");\njsio(\"import device\");\n\njsio(\"import event.input.dispatch as input\");\njsio(\"import event.input.InputEvent as InputEvent\");\n\njsio(\"import math.geom.Rect as Rect\");\njsio(\"import math.geom.Point as Point\");\njsio(\"import math.geom.Circle as Circle\");\njsio(\"import math.geom.intersect as intersect\");\n\njsio(\"import ui.View as View\");\njsio(\"import ui.backend.ReflowManager as ReflowManager\");\n\nvar _reflowMgr = ReflowManager.get();\n\nvar DEBUG = true;\nvar USE_CLIPPING = false;\n// var USE_CLIPPING = !device.useDOM && !device.isMobile;\n\nif (DEBUG) {\n\tvar _debug = {\n\t\tbounds: []\n\t};\n}\n/*function customEaseOut(x) {\n\tvar x = (1 - x);\n\tx *= x;\n\treturn 1 - x * x;\n}*/\n\n/**\n * @extends ui.View\n */\nvar sdk_timestep_ui_ScrollView=__class__;exports=sdk_timestep_ui_ScrollView(function sdk_timestep_ui_ScrollView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tthis.tag = \"ScrollView\";\n\n\tif (USE_CLIPPING) {\n\n\t\t// extend the default backing ctor\nthis.BackingCtor=__class__;\t\tthis.BackingCtor=this.BackingCtor(function this_BackingCtor(){return this.init&&this.init.apply(this,arguments)},View.prototype.BackingCtor, function () {\n\n\t\t\tfunction clippedWrapRender(contentView, backing, ctx, opts) {\n\t\t\t\tif (!backing.visible) { return; }\n\n\t\t\t\tif (!backing.__firstRender) { _reflowMgr.add(backing._view); }\n\n\t\t\t\t// non-native case only\n\t\t\t\tif (backing._needsSort) { backing._needsSort = false; backing._subviews.sort(); }\n\n\t\t\t\tctx.save();\n\t\t\t\tctx.translate(backing.x + backing.anchorX, backing.y + backing.anchorY);\n\n\t\t\t\tif (backing.r) { ctx.rotate(backing.r); }\n\n\t\t\t\t// clip this render to be within its view;\n\t\t\t\tif (backing.scale != 1) { ctx.scale(backing.scale, backing.scale); }\n\t\t\t\tif (backing.opacity != 1) { ctx.globalAlpha *= backing.opacity; }\n\n\t\t\t\tctx.translate(-backing.anchorX, -backing.anchorY);\n\n\t\t\t\t// if (backing._circle) { ctx.translate(-backing.width / 2, -backing.height / 2); }\n\n\t\t\t\tif (backing.clip) { ctx.clipRect(0, 0, backing.width, backing.height); }\n\t\t\t\t// var filters = this.getFilters();\n\t\t\t\t// ctx.setFilters(filters);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (backing.backgroundColor) {\n\t\t\t\t\t\tctx.fillStyle = backing.backgroundColor;\n\t\t\t\t\t\tctx.fillRect(0, 0, backing.width, backing.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tbacking._view.render && backing._view.render(ctx, opts);\n\n\t\t\t\t\tvar viewport = opts.viewport;\n\t\t\t\t\tvar subviews = backing._subviews;\n\n\t\t\t\t\tvar i = 0, subview;\n\t\t\t\t\twhile (subview = subviews[i++]) {\n\t\t\t\t\t\tif (subview == contentView) {\n\t\t\t\t\t\t\tclippedWrapRender(contentView, subview.__view, ctx, opts);\n\n\t\t\t\t\t\t\t// restore the old viewport it was changed\n\t\t\t\t\t\t\topts.viewport = viewport;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar pos = subview.getPosition(viewport.src);\n\t\t\t\t\t\t\tgetBoundingRectangle(pos);\n\n\t\t\t\t\t\t\tif (intersect.isRectAndRect(pos, viewport)) {\n\t\t\t\t\t\t\t\tclippedWrapRender(contentView, subview.__view, ctx, opts);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\t\t\t_debug.bounds.push(pos);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t \tlogger.error(backing._view, e.message, e.stack);\n\t\t\t\t} finally {\n\t\t\t\t\t// ctx.clearFilters();\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.wrapRender = function (ctx, opts) {\n\n\t\t\t\tclippedWrapRender(this._view._contentView, this, ctx, opts);\n\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tvar viewport = opts.viewport;\n\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(this.x + this.anchorX, this.y + this.anchorY);\n\t\t\t\t\tif (this.r) { ctx.rotate(this.r); }\n\t\t\t\t\tif (this.scale != 1) { ctx.scale(this.scale, this.scale); }\n\t\t\t\t\tctx.translate(-this.anchorX, -this.anchorY);\n\n\t\t\t\t\tctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n\t\t\t\t\tctx.fillRect(viewport.x, viewport.y, viewport.width, viewport.height);\n\n\t\t\t\t\tctx.translate(-viewport.x, -viewport.y);\n\n\t\t\t\t\tctx.fillStyle = 'rgba(255, 255, 255, 0.2)';\n\t\t\t\t\tfor (var i = 0, bounds; (bounds = _debug.bounds[i]); ++i) {\n\t\t\t\t\t\tctx.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);\n\t\t\t\t\t}\n\t\t\t\t\t_debug.bounds = [];\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tvar defaults = {\n\t\toffsetX: 0,\n\t\toffsetY: 0,\n\t\tscrollY: true,\n\t\tscrollX: true,\n\t\tclip: true,\n\t\tbounce: true,\n\t\tdrag: true,\n\t\tinertia: true,\n\t\tdragRadius: 10,\n\t\tsnapPixels: undefined,\n\t\tuseLayoutBounds: true,\n\t\tlayout: 'box'\n\t};\n\n\tthis.init = function (opts) {\n\n\t\topts = merge(opts, defaults);\n\n\t\tthis._acceleration = 15;\n\n\t\tthis._animState = {\n\t\t\toffset: 0,\n\t\t\tlastDelta: 0,\n\t\t\toffset: 0\n\t\t};\n\n\t\tthis._snapPixels = 1;\n\n\t\tthis._scrollBounds = merge(opts.scrollBounds, {\n\t\t\tminX: -Number.MAX_VALUE,\n\t\t\tminY: -Number.MAX_VALUE,\n\t\t\tmaxX: Number.MAX_VALUE,\n\t\t\tmaxY: Number.MAX_VALUE\n\t\t});\n\n\t\tthis._contentView = new View({\n\t\t\tx: opts.offsetX,\n\t\t\ty: opts.offsetY,\n\t\t\tinfinite: true,\n\t\t\ttag: \"ContentView\",\n\t\t\tlayout: 'box',\n\t\t\tlayoutWidth: '100%',\n\t\t\tlayoutHeight: '100%'\n\t\t});\n\n\t\tthis._viewport = new Rect();\n\t\tthis._viewport.src = this._contentView;\n\n\t\tsupr(this, 'init', [opts]);\n\t\tsupr(this, 'addSubview', [this._contentView]);\n\n\t\t// this.__layout = this._contentView.__layout;\n\t}\n\n\tthis.updateOpts = function (opts) {\n\t\tsupr(this, 'updateOpts', arguments);\n\n\t\tif ('useLayoutBounds' in opts) {\n\t\t\tif (opts.useLayoutBounds) {\n\t\t\t\tthis.subscribe('LayoutResize', this, '_updateLayoutBounds');\n\n\t\t\t\tif (this.style.layout == 'linear') {\n\t\t\t\t\tthis._updateLayoutBounds(this.__layout.getSize());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.unsubscribe('LayoutResize', this, '_updateLayoutBounds');\n\t\t\t}\n\t\t}\n\n\t\treturn opts;\n\t};\n\n\tthis._updateLayoutBounds = function (size) {\n\t\tif (size == undefined || this.style.layout != 'linear') { return; }\n\n\t\tvar bounds = this._scrollBounds;\n\t\tif (this.__layout.getDirection() == 'vertical') {\n\t\t\tbounds.minY = 0;\n\t\t\tbounds.maxY = size;\n\t\t} else {\n\t\t\tbounds.minX = 0;\n\t\t\tbounds.maxX = size;\n\t\t}\n\t};\n\n\tthis.buildView = function () {\n\t\tthis._snapPixels = this._opts.snapPixels || 1 / this.getPosition().scale;\n\t};\n\n\tthis.addSubview = function (view) { return this._contentView.addSubview(view); };\n\tthis.removeSubview = function (view) { return this._contentView.removeSubview(view); };\n\n\tthis.addFixedView = function (view) { return supr(this, 'addSubview', [view]); };\n\tthis.removeFixedView = function (view) { return supr(this, 'removeSubview', [view]); };\n\n\tvar BOUNCE_MAX_DIST = 50;\n\tvar PI_2 = Math.PI / 2;\n\n\tthis.getStyleBounds = function () {\n\t\tvar bounds = bounds = this._scrollBounds;\n\t\tvar minY = -bounds.maxY;\n\t\tvar maxY = -bounds.minY < minY ? minY : -bounds.minY;\n\t\tvar minX = -bounds.maxX;\n\t\tvar maxX = -bounds.minX < minX ? minX : -bounds.minX;\n\t\treturn {\n\t\t\tminY: Math.min(minY + this.style.height, maxY),\n\t\t\tmaxY: maxY,\n\t\t\tminX: Math.min(minX + this.style.width, maxX),\n\t\t\tmaxX: maxX\n\t\t};\n\t};\n\n\tthis.getOffset = function () { return new Point(this._contentView.style); };\n\tthis.getOffsetX = function () { return this._contentView.style.x; };\n\tthis.getOffsetY = function () { return this._contentView.style.y; };\n\n\tthis.setOffset = function (x, y) {\n\t\tvar style = this._contentView.style,\n\t\t\tdelta = {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0\n\t\t\t};\n\n\t\tvar bounds = this.getStyleBounds();\n\n\t\tif (typeof x == 'number') {\n\t\t\tif (this._isBouncing) {\n\t\t\t\t// do nothing\n\t\t\t} else if (this._canBounce) {\n\t\t\t\tif (x < bounds.minX) {\n\t\t\t\t\tvar delta = (bounds.minX - x) / BOUNCE_MAX_DIST;\n\t\t\t\t\tx = bounds.minX - Math.atan(delta) * BOUNCE_MAX_DIST / PI_2;\n\t\t\t\t}\n\n\t\t\t\tif (x > bounds.maxX) {\n\t\t\t\t\tvar delta = (x - bounds.maxX) / BOUNCE_MAX_DIST;\n\t\t\t\t\tx = bounds.maxX + Math.atan(delta) * BOUNCE_MAX_DIST / PI_2;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (x < bounds.minX) { x = bounds.minX; }\n\t\t\t\tif (x > bounds.maxX) { x = bounds.maxX; }\n\t\t\t}\n\n\t\t\tif (x != style.x) {\n\t\t\t\tdelta.x = x - style.x;\n\t\t\t\tstyle.x = (x / this._snapPixels | 0) * this._snapPixels;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof y == 'number') {\n\t\t\tif (this._isBouncing) {\n\t\t\t\t// do nothing\n\t\t\t} else if (this._canBounce) {\n\t\t\t\tif (y < bounds.minY) {\n\t\t\t\t\tvar delta = (bounds.minY - y) / BOUNCE_MAX_DIST;\n\t\t\t\t\ty = bounds.minY - Math.atan(delta) * BOUNCE_MAX_DIST / PI_2;\n\t\t\t\t}\n\n\t\t\t\tif (y > bounds.maxY) {\n\t\t\t\t\tvar delta = (y - bounds.maxY) / BOUNCE_MAX_DIST;\n\t\t\t\t\ty = bounds.maxY + Math.atan(delta) * BOUNCE_MAX_DIST / PI_2;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (y < bounds.minY) { y = bounds.minY; }\n\t\t\t\tif (y > bounds.maxY) { y = bounds.maxY; }\n\t\t\t}\n\n\t\t\tif (y != style.y) {\n\t\t\t\tdelta.y = y - style.y;\n\t\t\t\tstyle.y = (y / this._snapPixels | 0) * this._snapPixels;\n\t\t\t}\n\t\t}\n\n\t\tthis.publish('Scrolled', delta);\n\t};\n\n\tthis.isScrolling = function () { return this.isDragging() || this._anim && this._anim.hasFrames(); };\n\n\tthis.stopScrolling = function () {\n\t\tthis._anim && this._anim.now({}, 1);\n\t};\n\n\tthis.onInputStart = function (evt, pt) {\n\t\tif (this._opts.drag) {\n\t\t\tthis.startDrag({radius: this._opts.dragRadius * this._snapPixels});\n\n\t\t\tif (this._anim && this._anim.hasFrames()) {\n\t\t\t\tthis._anim.clear();\n\t\t\t}\n\n\t\t\tevt.cancel();\n\t\t}\n\t};\n\n\tthis.onDragStart = function (dragEvt) {\n\t\tinput.clearOverState(dragEvt.id);\n\n\t\tthis._contentView.getInput().blockEvents = true;\n\t\tthis._startBounce();\n\t\tthis._animState.offset = this.getOffset();\n\t\tthis._anim = animate(this._animState).clear();\n\t};\n\n\tthis.onDrag = function (dragEvt, moveEvt, delta) {\n\t\tvar state = this._animState;\n\t\tstate.dt = delta.t;\n\t\tstate.lastDelta = delta;\n\n\t\tif (!this._opts.scrollY) { delta.y = 0; }\n\t\tif (!this._opts.scrollX) { delta.x = 0; }\n\n\t\tthis.setOffset(state.offset.x += delta.x, state.offset.y += delta.y);\n\t\tmoveEvt.cancel();\n\t};\n\n\tthis.onDragStop = function (dragEvt, selectEvt) {\n\t\tthis._contentView.getInput().blockEvents = false;\n\n\t\tif (this._opts.inertia) {\n\t\t\tvar delta = new Point(this._animState.lastDelta).scale(this._acceleration);\n\t\t\tvar offset = this._animState.offset;\n\t\t\tvar distance = delta.getMagnitude();\n\n\t\t\t// if we overshot the bounds, don't waste time animating the acceleration.\n\t\t\tvar bounds = this.getStyleBounds();\n\t\t\tvar target = new Point(offset).add(delta);\n\t\t\tif (target.y < bounds.minY - BOUNCE_MAX_DIST) {\n\t\t\t\tif (offset.y < bounds.minY) {\n\t\t\t\t\tdistance = 0;\n\t\t\t\t} else {\n\t\t\t\t\tdelta.y += (bounds.minY - BOUNCE_MAX_DIST - target.y);\n\t\t\t\t\tdistance = delta.getMagnitude();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (target.y > bounds.maxY + BOUNCE_MAX_DIST) {\n\t\t\t\tif (offset.y > bounds.maxY) {\n\t\t\t\t\tdistance = 0;\n\t\t\t\t} else {\n\t\t\t\t\tdelta.y -= (target.y - (bounds.maxY - BOUNCE_MAX_DIST));\n\t\t\t\t\tdistance = delta.getMagnitude();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (distance) {\n\t\t\t\tthis._anim.now(bind(this, function (tt, t) {\n\t\t\t\t\tthis.setOffset(\n\t\t\t\t\t\toffset.x + delta.x * tt,\n\t\t\t\t\t\toffset.y + delta.y * tt);\n\t\t\t\t}), 100 * Math.log((distance + 1) * 100), animate.easeOut).then(bind(this, function () {\n\t\t\t\t\tthis._endBounce(offset);\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tthis._endBounce(offset);\n\t\t\t}\n\t\t}\n\t};\n\n\t\n\tthis._startBounce = function () {\n\t\tthis._isBouncing = false;\n\t\tif (this._opts.inertia && this._opts.bounce) {\n\t\t\tthis._canBounce = true;\n\t\t}\n\t};\n\n\tthis._endBounce = function () {\n\t\tvar offset = this.getOffset();\n\t\tvar bounds = this.getStyleBounds();\n\n\t\tvar dx = 0;\n\t\tvar dy = 0;\n\n\t\tvar ty = offset.y, tx = offset.x;\n\t\tif (offset.y < bounds.minY) {\n\t\t\tty = bounds.minY;\n\t\t} else if (offset.y > bounds.maxY) {\n\t\t\tty = bounds.maxY;\n\t\t}\n\n\t\tif (offset.x < bounds.minX) {\n\t\t\ttx = bounds.minX;\n\t\t} else if (offset.x > bounds.maxX) {\n\t\t\ttx = bounds.maxX;\n\t\t}\n\n\t\tdy = ty - offset.y;\n\t\tdx = tx - offset.x;\n\n\t\tif (dy === 0 && dx === 0) { return; }\n\n\t\tthis._isBouncing = true;\n\t\tthis._anim.now(bind(this, function (tt, t) {\n\t\t\tthis.setOffset(\n\t\t\t\toffset.x + dx * tt,\n\t\t\t\toffset.y + dy * tt);\n\t\t}), 500, animate.easeInOut).then(bind(this, function () {\n\t\t\tthis._canBounce = false;\n\t\t\tthis._isBouncing = false;\n\t\t}));\n\t};\n\n\tthis.setScrollBounds = function (bounds) { this._scrollBounds = bounds; }\n\tthis.getScrollBounds = function () { return this._scrollBounds; }\n\n\tthis.addOffset = function (x, y) {\n\t\tthis.setOffset(\n\t\t\t\tx != undefined && x != null && (this._contentView.style.x + x),\n\t\t\t\ty != undefined && y != null && (this._contentView.style.y + y)\n\t\t\t);\n\t}\n\t\n\tthis.getContentView = function () { return this._contentView; }\n\n\t/* @deprecated */\n\tthis.getFullWidth = function () { return this._contentView.style.width; }\n\t/* @deprecated */\n\tthis.getFullHeight= function () { return this._contentView.style.height; }\n\t\n\tfunction getBoundingRectangle(pos) {\n\t\tif (!pos.r) { return; }\n\n\t\tvar w = pos.width;\n\t\tvar h = pos.height;\n\t\tvar cr = Math.cos(pos.r);\n\t\tvar sr = Math.sin(pos.r);\n\n\t\tvar x1 = pos.x;\n\t\tvar y1 = pos.y;\n\n\t\tvar x = w;\n\t\tvar y = 0;\n\n\t\tvar x2 = x1 + x * cr - y * sr;\n\t\tvar y2 = y1 + x * sr + y * cr;\n\n\t\ty += h;\n\n\t\tvar x3 = x1 + x * cr - y * sr;\n\t\tvar y3 = y1 + x * sr + y * cr;\n\n\t\tx -= w;\n\n\t\tvar x4 = x1 + x * cr - y * sr;\n\t\tvar y4 = y1 + x * sr + y * cr;\n\n\t\tpos.x = Math.min(x1, x2, x3, x4);\n\t\tpos.y = Math.min(y1, y2, y3, y4);\n\n\t\tpos.width = Math.max(x1, x2, x3, x4) - pos.x;\n\t\tpos.height = Math.max(y1, y2, y3, y4) - pos.y;\n\t\tpos.r = 0;\n\t};\n\n\tfunction intersect(viewport, prevViewport) {\n\t\tvar pos = viewport.src.getPosition(prevViewport.src);\n\n\t\tpos.x = (prevViewport.x - pos.x) / pos.scale;\n\t\tpos.y = (prevViewport.y - pos.y) / pos.scale;\n\t\tpos.width = prevViewport.width / pos.scale;\n\t\tpos.height = prevViewport.height / pos.scale;\n\t\tpos.r = -pos.r;\n\n\t\tgetBoundingRectangle(pos);\n\n\t\tviewport.intersectRect(pos);\n\t};\n\n\tthis.render = function (ctx, opts) {\n\t\tvar s = this.style;\n\t\tvar cvs = this._contentView.style;\n\n\t\tvar viewport = this._viewport;\n\n\t\tvar x = viewport.x;\n\t\tvar y = viewport.y;\n\t\tvar width = viewport.width;\n\t\tvar height = viewport.height;\n\n\t\tviewport.x = -cvs.x;\n\t\tviewport.y = -cvs.y;\n\n\t\t// TODO: does flooring versus rounding hurt us?\n\t\t// NOTE: + 0.5 | 0 for rounding DOES NOT work for negative numbers\n\t\tviewport.width = s.width * s.scale | 0;\n\t\tviewport.height = s.height * s.scale | 0;\n\n\t\tif (opts.viewport) {\n\t\t\tintersect(viewport, opts.viewport);\n\t\t}\n\n\t\topts.viewport = viewport;\n\n\t\treturn viewport.x != x || viewport.y != y || viewport.width != width || viewport.height != height;\n\t};\n\n\tthis.onInputScroll = function (evt) {\n\t\tif (this._opts.scrollY && evt.scrollAxis == input.VERTICAL_AXIS) {\n\t\t\tthis.addOffset(undefined, evt.scrollDelta * 40);\n\t\t} else if (this._opts.scrollX) {\n\t\t\tthis.addOffset(evt.scrollDelta * 40);\n\t\t}\n\n\t\tevt.cancel();\n\t};\n\n\tthis.scrollTo = function (x, y, duration, cb) {\n\t\tduration = (duration == null ? 500 : duration);\n\t\tvar bounds = this.getStyleBounds();\n\n\t\tx = -x;\n\t\ty = -y;\n\n\t\tx = x < bounds.minX ? bounds.minX : x;\n\t\tx = x > bounds.maxX ? bounds.maxX : x;\n\t\ty = y < bounds.minY ? bounds.minY : y;\n\t\ty = y > bounds.maxY ? bounds.maxY : y;\n\n\t\tvar anim = animate(this._contentView).now({ x: x, y: y }, duration, animate.easeOut);\n\n\t\tif (cb) {\n\t\t\tanim.then(cb);\n\t\t}\n\t};\n});\n","pre":true},"sdk/jsio/math/geom/Circle.js":{"path":"sdk/jsio/math/geom/Circle.js","friendlyPath":"math.geom.Circle","directory":"sdk/jsio/math/geom/","filename":"Circle.js","src":"jsio(\"import .Point\");\n\n/**\n * @extends math.geom.Point\n * Models a circle given a radius.\n *   Circle(x, y, radius)\n *   Circle({x: default 0, y: default 0, radius: default 0})\n */\nvar sdk_jsio_math_geom_Circle=__class__;exports=sdk_jsio_math_geom_Circle(function sdk_jsio_math_geom_Circle(){return this.init&&this.init.apply(this,arguments)},Point, function(supr) {\n\tthis.init = function(a, b, c) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.x = 0;\n\t\t\t\tthis.y = 0;\n\t\t\t\tthis.radius = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\tcase 2:\n\t\t\t\tthis.x = a.x || 0;\n\t\t\t\tthis.y = a.y || 0;\n\t\t\t\tthis.radius = a.radius || 0;\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.x = a;\n\t\t\t\tthis.y = b;\n\t\t\t\tthis.radius = c;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Scale the position and radius of this circle by a percentage.\n\t */\n\t\n\tthis.scale = function(s) {\n\t\tsupr(this, 'scale', arguments);\n\t\tthis.radius *= s;\n\t\treturn this;\n\t}\n});","pre":true},"sdk/timestep/ui/widget/CellView.js":{"path":"sdk/timestep/ui/widget/CellView.js","friendlyPath":"ui.widget.CellView","directory":"sdk/timestep/ui/widget/","filename":"CellView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.widget.CellView;\n *\n * @doc http://doc.gameclosure.com/api/ui-widget-listview.html#class-ui.widget.cellview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/widget/listview.md\n */\n\njsio(\"import ui.View as View\");\njsio(\"import squill.models.Cell\");\n/**  \t\n * @extends ui.View\t\n */\nvar sdk_timestep_ui_widget_CellView=__class__;exports=sdk_timestep_ui_widget_CellView(function sdk_timestep_ui_widget_CellView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tlayout: 'box'\n\t\t});\n\t\tsupr(this, 'init', [opts]);\n\t\tthis.model = new squill.models.Cell({\n\t\t\tview: this\n\t\t});\n\t};\n\n\tthis.tag = 'CellView';\n\tthis.remove = function (list) {\n\t\tif (!list.isRecycleEnabled) {\n\t\t\tthis.removeFromSuperview();\n\t\t} else {\n\t\t\tthis.style.visible = false;\n\t\t}\n\t};\n\n\tthis.isSelected = function () {\n\t\treturn this.controller.isSelected && this._data && this.controller.isSelected(this._data);\n\t};\n\n\tthis.select = function () {\n\t\tthis.controller.select && this.controller.select(this._data);\n\t};\n\n\tthis.deselect = function () {\n\t\tthis.controller.deselect && this.controller.deselect(this._data);\n\t};\n\n\tthis.getHeight = function () { return this.style.height; }\n\tthis.getWidth = function () { return this.style.width; }\n\tthis.setData = function (data) { this._data = data; }\n\tthis.setPosition = function (pos) { this.style.update(pos); }\n\n\tthis.setController = function (controller) {\n\t\tthis.controller = controller;\n\t\tif (this._onSelect) {\n\t\t\tthis._selectCB = this._selectCB || function (data) {\n\t\t\t\t\t(data === this._data) && this._onSelect();\n\t\t\t\t};\n\t\t\tthis.controller.unsubscribe('Select', this, this._selectCB);\n\t\t\tthis.controller.subscribe('Select', this, this._selectCB);\n\t\t}\n\t\tif (this._onDeselect) {\n\t\t\tthis._deselectCB = this._deselectCB || function (data) {\n\t\t\t\t\t(data === this._data) && this._onDeselect();\n\t\t\t\t};\n\t\t\tthis.controller.unsubscribe('Deselect', this, this._deselectCB);\n\t\t\tthis.controller.subscribe('Deselect', this, this._deselectCB);\n\t\t}\n\t};\n\n\tthis.render = function (ctx) {};\n\n\tthis.onClick = this.onInputSelect = function () {\n\t\tif (!this.controller.selection) { return; }\n\n\t\tvar type = this.controller.selection.getType();\n\t\tif (type == 'toggle' || type == 'multi') {\n\t\t\tif (this.isSelected()) {\n\t\t\t\tthis.deselect();\n\t\t\t} else {\n\t\t\t\tthis.select();\n\t\t\t}\n\t\t} else if (type == 'single') {\n\t\t\tthis.select();\n\t\t}\n\t};\n});\n","pre":true},"sdk/squill/models/Cell.js":{"path":"sdk/squill/models/Cell.js","friendlyPath":"squill.models.Cell","directory":"sdk/squill/models/","filename":"Cell.js","src":"\"use import\";\n\njsio(\"import .Widget\");\n\nvar sdk_squill_models_Cell=__class__;var Cell = exports=sdk_squill_models_Cell(function sdk_squill_models_Cell(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis.init = function(params) {\n\t\tsupr(this, 'init', arguments);\n\t}\n\t\n\tthis.setRecycleID = function(id) { this._recycleID = id; }\n\tthis.setResource = function(resource) { this._resource = resource; }\n\n\tthis.recycle = function() {\n\t\tthis.publish('Recycle');\n\t\tif (this._resource) {\n\t\t\tthis._resource.put(this._view, this._recycleID);\n\t\t}\n\t}\n});\n","pre":true},"sdk/timestep/ui/ParticleEngine.js":{"path":"sdk/timestep/ui/ParticleEngine.js","friendlyPath":"ui.ParticleEngine","directory":"sdk/timestep/ui/","filename":"ParticleEngine.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ParticleEngine;\n */\n\njsio(\"import ui.View as View\");\njsio(\"import ui.resource.Image as Image\");\njsio(\"import ui.ImageView as ImageView\");\n\n/**\n * @extends ui.View\n */\nvar sdk_timestep_ui_ParticleEngine=__class__;exports=sdk_timestep_ui_ParticleEngine(function sdk_timestep_ui_ParticleEngine(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\t// animation transtion functions borrowed from animate\n\tvar TRANSITION_LINEAR = \"linear\",\n\t\ttransitions = {\n\t\t\tlinear: function (n) { return n; },\n\t\t\teaseIn: function (n) { return n * n; },\n\t\t\teaseInOut: function (n) { return (n *= 2) < 1 ? 0.5 * n * n * n : 0.5 * ((n -= 2) * n * n + 2); },\n\t\t\teaseOut: function (n) { return n * (2 - n); }\n\t\t};\n\n\t// all particle objects obtained from this class are initialized with these properties\n\tvar particleDefaults = {\n\t\tx: 0,\n\t\ty: 0,\n\t\tr: 0,\n\t\tanchorX: 0,\n\t\tanchorY: 0,\n\t\twidth: 1,\n\t\theight: 1,\n\t\tscale: 1,\n\t\tdscale: 0,\n\t\tddscale: 0,\n\t\tdx: 0,\n\t\tdy: 0,\n\t\tdr: 0,\n\t\tdanchorX: 0,\n\t\tdanchorY: 0,\n\t\tddx: 0,\n\t\tddy: 0,\n\t\tddr: 0,\n\t\tddanchorX: 0,\n\t\tddanchorY: 0,\n\t\tdwidth: 0,\n\t\tdheight: 0,\n\t\tddwidth: 0,\n\t\tddheight: 0,\n\t\topacity: 1,\n\t\tdopacity: 0,\n\t\tddopacity: 0,\n\t\tvisible: false,\n\t\tttl: 1000,\n\t\tdelay: 0,\n\t\tpolar: false,\n\t\tox: 0,\n\t\toy: 0,\n\t\ttheta: 0,\n\t\tradius: 0,\n\t\tdtheta: 0,\n\t\tdradius: 0,\n\t\tddtheta: 0,\n\t\tddradius: 0,\n\t\telapsed: 0,\n\t\ttransition: TRANSITION_LINEAR,\n\t\tonStart: null,\n\t\tonDeath: null,\n\t\texternal: false,\n\t\ttriggers: undefined // NOT ok to use array here, assign later\n\t};\n\n\t// class-wide image cache\n\tvar imageCache = {};\n\n\n\n\t/**\n\t * initCount (integer) pre-initialize this many ImageViews for smooth particle emission\n\t * initImage (string) a URL to give the ImageViews an image to start with\n\t */\n\tthis.init = function (opts) {\n\t\t// particles and their engine don't handle input events\n\t\topts.canHandleEvents = false;\n\t\topts.blockEvents = true;\n\t\tsupr(this, 'init', [opts]);\n\n\t\t// particle data array passed to user\n\t\tthis.particleDataArray = [];\n\n\t\t// recycled particle data objects\n\t\tthis.freeParticleObjects = [];\n\n\t\t// particle ImageViews\n\t\tthis.activeParticles = [];\n\t\tthis.freeParticles = [];\n\n\t\t// pre-initialization\n\t\tvar initCount = opts.initCount;\n\t\tvar initImage = opts.initImage;\n\t\tif (initCount) {\n\t\t\tfor (var i = 0; i < initCount; i++) {\n\t\t\t\t// initialize particle ImageViews\n\t\t\t\tvar particle = new ImageView({\n\t\t\t\t\tparent: this,\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\twidth: 1,\n\t\t\t\t\theight: 1,\n\t\t\t\t\timage: initImage,\n\t\t\t\t\tvisible: false,\n\t\t\t\t\tcanHandleEvents: false,\n\t\t\t\t\tinLayout: false\n\t\t\t\t});\n\t\t\t\tparticle.needsReflow = function () {};\n\t\t\t\tthis.freeParticles.push(particle);\n\n\t\t\t\t// initialize particle objects with default properties\n\t\t\t\t// duplicate of default properties for optimal performance\n\t\t\t\tthis.freeParticleObjects.push({\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tr: 0,\n\t\t\t\t\tanchorX: 0,\n\t\t\t\t\tanchorY: 0,\n\t\t\t\t\twidth: 1,\n\t\t\t\t\theight: 1,\n\t\t\t\t\tscale: 1,\n\t\t\t\t\tdscale: 0,\n\t\t\t\t\tddscale: 0,\n\t\t\t\t\tdx: 0,\n\t\t\t\t\tdy: 0,\n\t\t\t\t\tdr: 0,\n\t\t\t\t\tdanchorX: 0,\n\t\t\t\t\tdanchorY: 0,\n\t\t\t\t\tddx: 0,\n\t\t\t\t\tddy: 0,\n\t\t\t\t\tddr: 0,\n\t\t\t\t\tddanchorX: 0,\n\t\t\t\t\tddanchorY: 0,\n\t\t\t\t\tdwidth: 0,\n\t\t\t\t\tdheight: 0,\n\t\t\t\t\tddwidth: 0,\n\t\t\t\t\tddheight: 0,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tdopacity: 0,\n\t\t\t\t\tddopacity: 0,\n\t\t\t\t\tvisible: false,\n\t\t\t\t\tttl: 1000,\n\t\t\t\t\tdelay: 0,\n\t\t\t\t\tpolar: false,\n\t\t\t\t\tox: 0,\n\t\t\t\t\toy: 0,\n\t\t\t\t\ttheta: 0,\n\t\t\t\t\tradius: 0,\n\t\t\t\t\tdtheta: 0,\n\t\t\t\t\tdradius: 0,\n\t\t\t\t\tddtheta: 0,\n\t\t\t\t\tddradius: 0,\n\t\t\t\t\telapsed: 0,\n\t\t\t\t\ttransition: TRANSITION_LINEAR,\n\t\t\t\t\tonStart: null,\n\t\t\t\t\tonDeath: null,\n\t\t\t\t\texternal: false,\n\t\t\t\t\ttriggers: [] // OK to use an array here\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\n\n\t/**\n\t * returns an array populated with n particle objects\n\t * modify each particle object, then pass the array in via this.emitParticles\n\t */\n\tthis.obtainParticleArray = function (n) {\n\t\tfor (var i = 0; i < n; i++) {\n\t\t\tvar obj;\n\t\t\tif (this.freeParticleObjects.length) {\n\t\t\t\tobj = this.freeParticleObjects.pop();\n\t\t\t} else {\n\t\t\t\t// duplicate of default properties for optimal performance\n\t\t\t\tobj = {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tr: 0,\n\t\t\t\t\tanchorX: 0,\n\t\t\t\t\tanchorY: 0,\n\t\t\t\t\twidth: 1,\n\t\t\t\t\theight: 1,\n\t\t\t\t\tscale: 1,\n\t\t\t\t\tdscale: 0,\n\t\t\t\t\tddscale: 0,\n\t\t\t\t\tdx: 0,\n\t\t\t\t\tdy: 0,\n\t\t\t\t\tdr: 0,\n\t\t\t\t\tdanchorX: 0,\n\t\t\t\t\tdanchorY: 0,\n\t\t\t\t\tddx: 0,\n\t\t\t\t\tddy: 0,\n\t\t\t\t\tddr: 0,\n\t\t\t\t\tddanchorX: 0,\n\t\t\t\t\tddanchorY: 0,\n\t\t\t\t\tdwidth: 0,\n\t\t\t\t\tdheight: 0,\n\t\t\t\t\tddwidth: 0,\n\t\t\t\t\tddheight: 0,\n\t\t\t\t\topacity: 1,\n\t\t\t\t\tdopacity: 0,\n\t\t\t\t\tddopacity: 0,\n\t\t\t\t\tvisible: false,\n\t\t\t\t\tttl: 1000,\n\t\t\t\t\tdelay: 0,\n\t\t\t\t\tpolar: false,\n\t\t\t\t\tox: 0,\n\t\t\t\t\toy: 0,\n\t\t\t\t\ttheta: 0,\n\t\t\t\t\tradius: 0,\n\t\t\t\t\tdtheta: 0,\n\t\t\t\t\tdradius: 0,\n\t\t\t\t\tddtheta: 0,\n\t\t\t\t\tddradius: 0,\n\t\t\t\t\telapsed: 0,\n\t\t\t\t\ttransition: TRANSITION_LINEAR,\n\t\t\t\t\tonStart: null,\n\t\t\t\t\tonDeath: null,\n\t\t\t\t\texternal: false,\n\t\t\t\t\ttriggers: [] // OK to use an array here\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.particleDataArray.push(obj);\n\t\t}\n\n\t\treturn this.particleDataArray;\n\t};\n\n\n\n\t/**\n\t * takes a particle object, populates it with defaults, then returns it\n\t */\n\tthis.cleanObject = function (obj) {\n\t\tfor (var prop in particleDefaults) {\n\t\t\tobj[prop] = particleDefaults[prop];\n\t\t}\n\t\tobj.triggers = []; // don't keep an array in the particleDefaults object\n\t\treturn obj;\n\t};\n\n\n\n\t/**\n\t * treat an external view as if it were a particle (don't recycle it internally)\n\t */\n\tthis.addExternalParticle = function (particle, data) {\n\t\tdata.external = true;\n\t\tfor (var index in data.triggers) {\n\t\t\tvar trig = data.triggers[index];\n\t\t\ttrig.isStyle = trig.property.charAt(0) !== 'd';\n\t\t}\n\n\t\t// automatically interrupt any animation currently in progress\n\t\tvar active = this.activeParticles,\n\t\t\tindex = active.indexOf(particle);\n\t\twhile (index >= 0) {\n\t\t\tthis._killParticle(particle, particle.pData, index);\n\t\t\tindex = active.indexOf(particle);\n\t\t}\n\n\t\tparticle.pData = data;\n\t\tactive.push(particle);\n\t};\n\n\n\n\t/**\n\t * after obtaining the particle array full of particle objects\n\t * pass the array in here once you set up each objects' properties\n\t */\n\tthis.emitParticles = function (particleDataArray) {\n\t\tvar s, particle, data,\n\t\t\tsin = Math.sin,\n\t\t\tcos = Math.cos,\n\t\t\tcount = particleDataArray.length,\n\t\t\tactive = this.activeParticles,\n\t\t\tfree = this.freeParticles;\n\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tdata = particleDataArray.pop();\n\n\t\t\tfor (var index in data.triggers) {\n\t\t\t\tvar trig = data.triggers[index];\n\t\t\t\ttrig.isStyle = trig.property.charAt(0) !== 'd';\n\t\t\t}\n\n\t\t\t// use free particles if we have any\n\t\t\tif (free.length) {\n\t\t\t\tparticle = free.pop();\n\t\t\t\ts = particle.style;\n\n\t\t\t\tvar img = imageCache[data.image];\n\t\t\t\tif (!img) {\n\t\t\t\t\timg = imageCache[data.image] = new Image({ url: data.image });\n\t\t\t\t}\n\t\t\t\tparticle.setImage(img);\n\n\t\t\t\tif (data.polar) {\n\t\t\t\t\ts.x = data.ox + (data.radius * cos(data.theta));\n\t\t\t\t\ts.y = data.oy + (data.radius * sin(data.theta));\n\t\t\t\t} else {\n\t\t\t\t\ts.x = data.x;\n\t\t\t\t\ts.y = data.y;\n\t\t\t\t}\n\n\t\t\t\ts.r = data.r;\n\t\t\t\ts.anchorX = data.anchorX;\n\t\t\t\ts.anchorY = data.anchorY;\n\t\t\t\ts.width = data.width;\n\t\t\t\ts.height = data.height;\n\t\t\t\ts.scale = data.scale;\n\t\t\t\ts.opacity = data.opacity;\n\t\t\t\ts.visible = data.visible;\n\t\t\t} else {\n\t\t\t\t// no free particles, we must create a new particle\n\t\t\t\tparticle = new ImageView({\n\t\t\t\t\tparent: this,\n\t\t\t\t\tx: data.polar ? data.ox + (data.radius * cos(data.theta)) : data.x,\n\t\t\t\t\ty: data.polar ? data.oy + (data.radius * sin(data.theta)) : data.y,\n\t\t\t\t\tr: data.r,\n\t\t\t\t\tanchorX: data.anchorX,\n\t\t\t\t\tanchorY: data.anchorY,\n\t\t\t\t\twidth: data.width,\n\t\t\t\t\theight: data.height,\n\t\t\t\t\tscale: data.scale,\n\t\t\t\t\topacity: data.opacity,\n\t\t\t\t\timage: data.image,\n\t\t\t\t\tvisible: data.visible,\n\t\t\t\t\tblockEvents: true,\n\t\t\t\t\tcanHandleEvents: false,\n\t\t\t\t\tinLayout: false\n\t\t\t\t});\n\t\t\t\tparticle.needsReflow = function () {};\n\t\t\t}\n\n\t\t\tif (!data.delay) {\n\t\t\t\tparticle.style.visible = true;\n\t\t\t\tdata.onStart && data.onStart(particle);\n\t\t\t}\n\n\t\t\tparticle.pData = data;\n\t\t\tactive.push(particle);\n\t\t}\n\t};\n\n\n\n\t/**\n\t * internal use only\n\t * clean-up a particle\n\t *\n\t * particle (ImageView)\n\t * data (object)\n\t * index (integer) position in this.activeParticles\n\t */\n\tthis._killParticle = function (particle, data, index) {\n\t\tvar active = this.activeParticles,\n\t\t\ts = particle.style,\n\t\t\tspliced = active.splice(index, 1);\n\n\t\tparticle.pData = null;\n\t\tdata.onDeath && data.onDeath(particle, data);\n\n\t\t// external particles must handle their own clean-up, but we still handle the data object\n\t\tif (data.external) {\n\t\t\tthis.freeParticleObjects.push(this.cleanObject(data));\n\t\t} else {\n\t\t\ts.visible = false;\n\t\t\tthis.freeParticles.push(spliced[0]);\n\t\t\tthis.freeParticleObjects.push(this.cleanObject(data));\n\t\t}\n\t};\n\n\n\n\t/**\n\t * finish and hide all particles immediately\n\t */\n\tthis.killAllParticles = function () {\n\t\tvar active = this.activeParticles;\n\t\twhile (active.length) {\n\t\t\tvar particle = active[0];\n\t\t\tthis._killParticle(particle, particle.pData, 0);\n\t\t}\n\t};\n\n\n\n\t/**\n\t * step the particle engine forward in time by dt milliseconds\n\t * this should be called manually from your own tick function\n\t */\n\tthis.runTick = function (dt) {\n\t\tvar s, particle, data, pct,\n\t\t\tactive = this.activeParticles,\n\t\t\tfree = this.freeParticles,\n\t\t\tsin = Math.sin,\n\t\t\tcos = Math.cos,\n\t\t\tmax = Math.max,\n\t\t\tmin = Math.min,\n\t\t\ti = 0;\n\n\t\twhile (i < active.length) {\n\t\t\tparticle = active[i];\n\t\t\tdata = particle.pData;\n\t\t\ts = particle.style;\n\n\t\t\t// handle particle delays\n\t\t\tif (data.delay > 0) {\n\t\t\t\tdata.delay -= dt;\n\t\t\t\tif (data.delay <= 0) {\n\t\t\t\t\ts.visible = true;\n\t\t\t\t\tdata.onStart && data.onStart(particle);\n\t\t\t\t} else {\n\t\t\t\t\ti++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// is it dead yet?\n\t\t\tdata.elapsed += dt;\n\t\t\tif (data.elapsed >= data.ttl) {\n\t\t\t\tthis._killParticle(particle, data, i);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// calculate the percent of one second elapsed; deltas are in units / second\n\t\t\tif (data.transition !== TRANSITION_LINEAR) {\n\t\t\t\tvar getTransitionProgress = transitions[data.transition];\n\t\t\t\tvar prgBefore = getTransitionProgress((data.elapsed - dt) / data.ttl);\n\t\t\t\tvar prgAfter = getTransitionProgress(data.elapsed / data.ttl);\n\t\t\t\tpct = (prgAfter - prgBefore) * data.ttl / 1000;\n\t\t\t} else {\n\t\t\t\tpct = dt / 1000;\n\t\t\t}\n\n\t\t\t// translation\n\t\t\tif (data.polar) {\n\t\t\t\tvar drad = data.dradius, dth = data.dtheta, ddrad = data.ddradius, ddth = data.ddtheta;\n\t\t\t\tif (drad) { data.radius += pct * drad; }\n\t\t\t\tif (dth) { data.theta += pct * dth; }\n\t\t\t\tif (ddrad) { data.dradius += pct * ddrad; }\n\t\t\t\tif (ddth) { data.dtheta += pct * ddth; }\n\n\t\t\t\t// allow cartesian translation of the origin point\n\t\t\t\tvar dx = data.dx, dy = data.dy, ddx = data.ddx, ddy = data.ddy;\n\t\t\t\tif (dx) { data.ox += pct * dx; }\n\t\t\t\tif (dy) { data.oy += pct * dy; }\n\t\t\t\tif (ddx) { data.dx += pct * ddx; }\n\t\t\t\tif (ddy) { data.dy += pct * ddy; }\n\n\t\t\t\t// polar position\n\t\t\t\tdata.x = s.x = data.ox + data.radius * cos(data.theta);\n\t\t\t\tdata.y = s.y = data.oy + data.radius * sin(data.theta);\n\t\t\t} else {\n\t\t\t\t// cartesian by default\n\t\t\t\tvar dx = data.dx, dy = data.dy, ddx = data.ddx, ddy = data.ddy;\n\t\t\t\tif (dx) { data.x = s.x += pct * dx; }\n\t\t\t\tif (dy) { data.y = s.y += pct * dy; }\n\t\t\t\tif (ddx) { data.dx += pct * ddx; }\n\t\t\t\tif (ddy) { data.dy += pct * ddy; }\n\t\t\t}\n\n\t\t\t// anchor translation\n\t\t\tvar dax = data.danchorX, day = data.danchorY, ddax = data.ddanchorX, dday = data.ddanchorY;\n\t\t\tif (dax) { data.anchorX = s.anchorX += pct * dax; }\n\t\t\tif (day) { data.anchorY = s.anchorY += pct * day; }\n\t\t\tif (ddax) { data.danchorX += pct * ddax; }\n\t\t\tif (dday) { data.danchorY += pct * dday; }\n\n\t\t\t// stretching\n\t\t\tvar dw = data.dwidth, dh = data.dheight, ddw = data.ddwidth, ddh = data.ddheight;\n\t\t\tif (dw) { data.width = s.width = max(s.width + pct * dw, 1); }\n\t\t\tif (dh) { data.height = s.height = max(s.height + pct * dh, 1); }\n\t\t\tif (ddw) { data.dwidth += pct * ddw; }\n\t\t\tif (ddh) { data.dheight += pct * ddh; }\n\n\t\t\t// rotation\n\t\t\tvar dr = data.dr, ddr = data.ddr;\n\t\t\tif (dr) { data.r = s.r += pct * dr; }\n\t\t\tif (ddr) { data.dr += pct * ddr; }\n\n\t\t\t// scaling\n\t\t\tvar ds = data.dscale, dds = data.ddscale;\n\t\t\tif (ds) { data.scale = s.scale = max(s.scale + pct * ds, 0); }\n\t\t\tif (dds) { data.dscale += pct * dds; }\n\n\t\t\t// opacity\n\t\t\tvar dop = data.dopacity, ddop = data.ddopacity;\n\t\t\tif (dop) { data.opacity = s.opacity = min(max(s.opacity + pct * dop, 0), 1); }\n\t\t\tif (ddop) { data.dopacity += pct * ddop; }\n\n\t\t\t// triggers\n\t\t\tvar index = 0;\n\t\t\twhile (index < data.triggers.length) {\n\t\t\t\tvar trig = data.triggers[index],\n\t\t\t\t\t// where can the property be found, style or data?\n\t\t\t\t\twhere = trig.isStyle ? s : data;\n\n\t\t\t\tif (trig.smaller && where[trig.property] < trig.value) {\n\t\t\t\t\ttrig.action(particle);\n\t\t\t\t\tif (trig.count) {\n\t\t\t\t\t\ttrig.count -= 1;\n\t\t\t\t\t\tif (trig.count <= 0) {\n\t\t\t\t\t\t\tdata.triggers.splice(index, 1);\n\t\t\t\t\t\t\tindex -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (!trig.smaller && where[trig.property] > trig.value) {\n\t\t\t\t\ttrig.action(particle);\n\t\t\t\t\tif (trig.count) {\n\t\t\t\t\t\ttrig.count -= 1;\n\t\t\t\t\t\tif (trig.count <= 0) {\n\t\t\t\t\t\t\tdata.triggers.splice(index, 1);\n\t\t\t\t\t\t\tindex -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tindex += 1;\n\t\t\t}\n\n\t\t\ti += 1;\n\t\t}\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/components/WeebyListViewController.js":{"path":"sdk/plugins/weeby/ui/components/WeebyListViewController.js","friendlyPath":"...components.WeebyListViewController","directory":"sdk/plugins/weeby/ui/components/","filename":"WeebyListViewController.js","src":"jsio(\"import GCDataSource\");\n\njsio(\"import .WeebyViewController\");\n\nvar sdk_plugins_weeby_ui_components_WeebyListViewController=__class__;exports=sdk_plugins_weeby_ui_components_WeebyListViewController(function sdk_plugins_weeby_ui_components_WeebyListViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tstatus: true,\n\t\t\t\tdataKey: 'index'\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._listData = new GCDataSource({\n\t\t\tkey: opts.dataKey,\n\t\t\tsorter: function (data) { return data.index; }\n\t\t});\n\t};\n});\n","pre":true},"sdk/gc/api/GCDataSource.js":{"path":"sdk/gc/api/GCDataSource.js","friendlyPath":"GCDataSource","directory":"sdk/gc/api/","filename":"GCDataSource.js","baseMod":"GCDataSource","basePath":"sdk/gc/api/","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports = jsio(\"import squill.models.DataSource\");\n","pre":true},"sdk/plugins/weeby/ui/components/WeebyViewController.js":{"path":"sdk/plugins/weeby/ui/components/WeebyViewController.js","friendlyPath":".WeebyViewController","directory":"sdk/plugins/weeby/ui/components/","filename":"WeebyViewController.js","src":"jsio(\"import device\");\njsio(\"import animate\");\njsio(\"import ..UIInflator\");\njsio(\"import ...weebyController\");\njsio(\"import ..config\");\n\njsio(\"import .transitions\");\njsio(\"import .WeebyBaseView\");\njsio(\"import .BackgroundController\");\n\nvar sdk_plugins_weeby_ui_components_WeebyViewController=__class__;var WeebyViewController = exports=sdk_plugins_weeby_ui_components_WeebyViewController(function sdk_plugins_weeby_ui_components_WeebyViewController(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\t// static\n\tthis.constructor._background = new BackgroundController();\n\tthis.constructor.getBackground = function() {\n\t\treturn this._background;\n\t};\n\n\tthis.constructor.getHeader = function () {\n\t\treturn this._background.getStatusController();\n\t};\n\n\tthis.constructor.getSocialTabs = function () {\n\t\treturn SocialTabController.getInstance();\n\t};\n\n\tthis.init = function (opts) {\n\t\tif (!opts) { opts = {}; }\n\t\tthis._name = opts.name;\n\n\t\tthis._viewDef = opts.views;\n\t\tthis._overrideCtors = opts.overrideCtors;\n\t\tthis._inflator = UIInflator.get();\n\n\t\tvar x = config.CONTENT_OFFSET_X;\n\t\tvar y = config.CONTENT_OFFSET_Y;\n\t\tvar height = config.CONTENT_HEIGHT;\n\n\t\tweebyController.on('Data', bind(this, '_onWeebyData'));\n\t\tweebyController.on('State', bind(this, '_onWeebyState'));\n\n\t\tif (this._viewDef && this._viewDef.$background) {\n\t\t\tthis._transition = this._viewDef.$background.style.transition;\n\t\t\tthis._pushTransition = this._viewDef.$background.style.pushTransition;\n\t\t}\n\n\t\tif (!this._pushTransition) {\n\t\t\tthis._pushTransition = opts.pushTransition;\n\t\t}\n\n\t\tif (opts.layout) {\n\t\t\tvar viewOpts = this._viewOpts = opts.views[opts.layout];\n\n\t\t\tthis.setViewStates(this.inflate(opts.layout));\n\n\t\t\tif (opts.superview) {\n\t\t\t\topts.superview.addSubview(this._view);\n\t\t\t}\n\n\t\t\tif (!opts.views && DEBUG) {\n\t\t\t\tthrow new Error('Warning: no view definitions provided');\n\t\t\t}\n\n\t\t\tvar s = this._view.style;\n\t\t\tvar scale = 1;\n\t\t\ty += s.y || 0;\n\t\t\tx += s.x || 0;\n\t\t\theight = s.height !== undefined && s.height > 0 ? s.height : height;\n\t\t\twidth = s.width !== undefined && s.width > 0 ? s.width : config.CONTENT_WIDTH;\n\n\t\t\tif (viewOpts && viewOpts.style) {\n\t\t\t\tif (viewOpts.style.alignTop || opts.alignTop) {\n\t\t\t\t\ty = s.y * config.FULL_SCREEN_SCALE_RELATIVE;\n\t\t\t\t\tx = s.x * config.FULL_SCREEN_SCALE_RELATIVE;\n\t\t\t\t\tscale = config.FULL_SCREEN_SCALE_RELATIVE;\n\t\t\t\t\twidth = config.FULL_SCREEN_WIDTH;\n\t\t\t\t\theight = config.FULL_SCREEN_HEIGHT;\n\t\t\t\t\tthis._isFullScreen = true;\n\t\t\t\t}\n\n\t\t\t\tif (viewOpts.style.showStatusBar) {\n\t\t\t\t\tthis._showStatusBar = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._view.updateOpts(merge(opts, {\n\t\t\t\t\theight: height,\n\t\t\t\t\twidth: width,\n\t\t\t\t\tscale: scale,\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y,\n\t\t\t\t\tvisible: false\n\t\t\t}));\n\t\t} else if (DEBUG && !opts.noLayout) {\n\t\t\tthrow new Error('Warnng: no root layout element specified');\n\t\t}\n\t};\n\n\tthis.isFullScreen = function () {\n\t\treturn this._isFullScreen;\n\t}\n\n\tthis.getViewOpts = function () {\n\t\treturn this._viewOpts.style;\n\t}\n\n\tthis.hasView = function () { return !!this._view; }\n\n\tthis.setViewStates = function (viewStates) {\n\t\tthis._viewStates = viewStates;\n\t\tthis._views = viewStates.views;\n\t\tthis._view = viewStates.mainView;\n\t}\n\n\tthis.inflate = function (tag, /* optional */ viewStates) {\n\t\tif (DEBUG && !this._viewDef[tag]) {\n\t\t\tthrow new Error(this._name + ' has no definition for the view '\n\t\t\t\t\t+ tag + '. Possible values are: '\n\t\t\t\t\t+ JSON.stringify(Object.keys(this._viewDef)));\n\t\t}\n\n\t\tvar viewStates = this._inflator.inflate(this._viewDef[tag], this._overrideCtors, viewStates);\n\n\t\tif (!viewStates.mainView) {\n\t\t\tviewStates.mainView = viewStates.views[tag];\n\t\t}\n\n\t\treturn viewStates;\n\t};\n\n\tthis._addEvent = function (view, evtName, cb, required) {\n\t\tif (this._views[view]) {\n\t\t\tthis._views[view].on(evtName, cb);\n\t\t} else if (required) {\n\t\t\tlogger.error('Required view not found: view', view, 'is not defined for', this._name);\n\t\t}\n\t};\n\n\tthis._addButton = function (view, cb, required) {\n\t\tif (this._views[view]) {\n\t\t\t// this._views[view].on('InputStart');\n\t\t}\n\t}\n\n\tthis.getView = function () {\n\t\treturn this._view;\n\t};\n\n\tthis._getView = function (view) {\n\t\treturn this._views[view];\n\t};\n\n\tthis.disableInput = function () {\n\t\tthis._view.getInput().blockEvents = true;\n\t};\n\n\tthis.enableInput = function () {\n\t\tthis._view.getInput().blockEvents = false;\n\t};\n\n\tthis.updateBackground = function (transition, level) {\n\t\tif (this._viewDef.$background) {\n\t\t\tWeebyViewController._background.update(this._viewDef.$background, transition || this._transition, level);\n\t\t}\n\t};\n\n\tvar DEFAULT_TRANSITION = 'slideleft';\n\tvar TRANSITION_INVERSE = {\n\t\t'slideup': 'slidedown',\n\t\t'slideleft': 'slideright',\n\t\t'slideright': 'slideleft',\n\t\t'fade': 'fade',\n\t\t'none': 'none'\n\t};\n\n\tthis.hide = function (type, transition, level) {\n\t\tif (this._isVisible) {\n\t\t\tthis._isVisible = false;\n\n\t\t\tvar transition = (type == 'pop' && this._pushTransition) || transition || this._transition;\n\t\t\tif (!(transition in TRANSITION_INVERSE)) {\n\t\t\t\ttransition = DEFAULT_TRANSITION;\n\t\t\t}\n\n\t\t\tif (type == 'back') {\n\t\t\t\ttransition = TRANSITION_INVERSE[transition];\n\t\t\t}\n\n\t\t\t// if we're pushing a view on top, this view doesn't actually hide!\n\t\t\tif (type != 'push') {\n\n\t\t\t\t// otherwise, we want to hide this view\n\t\t\t\ttransitions.hide(this._view, transition);\n\t\t\t}\n\n\t\t\tif (this.onHide) {\n\t\t\t\tthis.onHide(type, transition, level);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.show = function (type, transition, level, prevLevel) {\n\n\t\tif (!this._isVisible) {\n\t\t\tthis._isVisible = true;\n\n\t\t\tif (this._showStatusBar) {\n\t\t\t\tconsole.log(\"SHOW>>> statusBar\");\n\t\t\t\tdevice.get('StatusBar').show();\n\t\t\t} else {\n\t\t\t\tdevice.get('StatusBar').hide();\n\t\t\t\tconsole.log(\"HIDE<<< statusBar\");\n\t\t\t}\n\n\t\t\tif (!this._substate) {\n\t\t\t\tthis._substate = weebyController.getSubstate();\n\t\t\t}\n\n\t\t\tthis.updateBackground(transition, level);\n\n\t\t\ttransition = (type == 'pop' && 'none') || (type == 'push' && this._pushTransition) || transition || this._transition;\n\t\t\tif (!(transition in TRANSITION_INVERSE)) {\n\t\t\t\ttransition = DEFAULT_TRANSITION;\n\t\t\t}\n\n\t\t\tif (type == 'back') {\n\t\t\t\ttransition = TRANSITION_INVERSE[transition];\n\t\t\t}\n\n\t\t\ttransitions.show(this._view, transition);\n\n\t\t\tif (this.onShow) {\n\t\t\t\tthis.onShow(type, transition, level);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._onWeebyData = function (data) {\n\t\tthis._view.style.visible && data && this.onWeebyData(data);\n\t};\n\n\tthis.onWeebyData = function (data) {\n\t\tdata && console.warn('Unhandled data:', data);\n\t};\n\n\tthis._onWeebyState = function (substate) {\n\t\tthis._substate = substate;\n\t\tthis._view.style.visible && substate && this.onWeebyState(substate);\n\t};\n\n\tthis.onWeebyState = function (state) {\n\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/UIInflator.js":{"path":"sdk/plugins/weeby/ui/UIInflator.js","friendlyPath":"..UIInflator","directory":"sdk/plugins/weeby/ui/","filename":"UIInflator.js","src":"jsio(\"import ui.View as View\");\njsio(\"import ui.TextView as TextView\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.ImageScaleView as ImageScaleView\");\njsio(\"import ui.ScrollView as ScrollView\");\njsio(\"import ui.TextPromptView as TextPromptView\");\njsio(\"import ui.TextInputView as TextInputView\");\njsio(\"import ui.TextEditView as TextEditView\");\njsio(\"import ui.widget.ListView as ListView\");\njsio(\"import ui.widget.CellView as CellView\");\n\njsio(\"import .components.SwitchView as SwitchView\");\njsio(\"import .components.ScoreView as ScoreView\");\n\njsio(\"import device\");\n\njsio(\"import ui.widget.ButtonView as ButtonView\");\njsio(\"import ui.widget.SliderView as SliderView\");\n\njsio(\"import .config as uiConfig\");\n\njsio(\"import ..i18n\");\n\nTextViewDefaults=__class__;var TextViewDefaults=TextViewDefaults(function TextViewDefaults(){return this.init&&this.init.apply(this,arguments)},TextView, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tautoSize: false,\n\t\t\t\tautoFontSize: false,\n\t\t\t\thorizontalAlign: 'left'\n\t\t\t}\n\t\t);\n\n\t\t// if (opts.wrap && /^zh/.test(i18n.getLanguage())) {\n\t\t// \topts.wrapCharacter = true;\n\t\t// }\n\n\t\tsupr(this, 'init', [opts]);\n\t};\n});\n\n// possible view types\nvar ctors = {\n\t'text': TextViewDefaults,\n\t'score': ScoreView,\n\t'scroller': ScrollView,\n\t'switch': SwitchView,\n\t'image': ImageView,\n\t'scaledImage': ImageScaleView,\n\t'prompt': TextPromptView,\n\t'slider': SliderView,\n\t'list': ListView,\n\t'cell': CellView,\n\t'default': View,\n\t'inputText': TextInputView,\n\t'editText': TextEditView\n};\n\nViewState=__class__;var ViewState=ViewState(function ViewState(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis.views = {};\n\t\tthis.mainView = null;\n\t\tthis._viewStates = {};\n\t};\n\n\tthis.addStateMap = function (uid, baseStyle, states) {\n\t\tthis._viewStates[uid] = new StateMap(baseStyle, states);\n\t};\n\nStateMap=__class__;\tvar StateMap=StateMap(function StateMap(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\tthis.init = function (baseStyle, states) {\n\t\t\tthis.baseStyle = baseStyle;\n\t\t\tthis.currentHash = {};\n\t\t\tthis.current = [];\n\t\t\tfor (var key in states) {\n\t\t\t\tthis.currentHash[key] = false;\n\t\t\t}\n\t\t\tthis.states = states;\n\t\t};\n\n\t\tthis.addState = function (view, stateName) {\n\t\t\tif ((stateName in this.currentHash) && !this.currentHash[stateName]) {\n\t\t\t\tthis.currentHash[stateName] = true;\n\t\t\t\tthis.current.push(stateName);\n\n\t\t\t\tview.updateOpts(this.computeOpts(view, this.states[stateName]));\n\t\t\t}\n\t\t};\n\n\t\tthis.removeState = function (view, stateName) {\n\t\t\tif (this.currentHash[stateName]) {\n\t\t\t\tthis.currentHash[stateName] = false;\n\t\t\t\tthis.current.splice(this.current.indexOf(stateName), 1);\n\n\t\t\t\tview.updateOpts(this.computeOpts(view, this.states[stateName]));\n\t\t\t}\n\t\t};\n\n\t\tthis.computeOpts = function (view, mapping) {\n\t\t\tvar stateNames = this.current;\n\t\t\tvar n = stateNames.length;\n\t\t\tvar opts = {};\n\t\t\tfor (var i = n - 1; i >= 0; --i) {\n\t\t\t\tvar state = this.states[stateNames[i]];\n\n\t\t\t\tfor (var key in mapping) {\n\t\t\t\t\tif (!(key in opts) && (key in state)) {\n\t\t\t\t\t\topts[key] = state[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var key in mapping) {\n\t\t\t\tif (!(key in opts)) {\n\t\t\t\t\tif (key in this.baseStyle) {\n\t\t\t\t\t\topts[key] = this.baseStyle[key];\n\t\t\t\t\t} else if (key in view.style) {\n\t\t\t\t\t\topts[key] = view.style[key];\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t}\n\n\t\t\treturn opts;\n\t\t};\n\t});\n\n\tthis.get = function (view) {\n\t\tif (typeof view == 'string') {\n\t\t\treturn this.views[view];\n\t\t} else {\n\t\t\treturn view;\n\t\t}\n\t};\n\n\tthis.addState = function (view, stateName) {\n\t\tvar view = this.get(view);\n\t\tif (view) {\n\t\t\tthis._addState(this.get(view), stateName);\n\t\t}\n\t};\n\n\tthis._addState = function (view, stateName) {\n\t\tvar viewState = this._viewStates[view.uid];\n\t\tif (viewState) {\n\t\t\tviewState.addState(view, stateName);\n\t\t}\n\n\t\tvar subviews = view.getSubviews();\n\t\tvar n = subviews.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tthis._addState(subviews[i], stateName);\n\t\t}\n\t};\n\n\tthis.removeState = function (view, stateName) {\n\t\tvar view = this.get(view);\n\t\tif (view) {\n\t\t\tthis._removeState(view, stateName)\n\t\t}\n\t};\n\n\tthis._removeState = function (view, stateName) {\n\t\tvar viewState = this._viewStates[view.uid];\n\t\tif (viewState) {\n\t\t\tviewState.removeState(view, stateName);\n\t\t}\n\n\t\tvar subviews = view.getSubviews();\n\t\tvar n = subviews.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tthis.removeState(subviews[i], stateName);\n\t\t}\n\t};\n});\n\n// doesn't do much, just wraps the inflate function!\nvar sdk_plugins_weeby_ui_UIInflator=__class__;exports=sdk_plugins_weeby_ui_UIInflator(function sdk_plugins_weeby_ui_UIInflator(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function () {\n\t};\n\n\t// creates a view hierarchy given a JSON view definition\n\t//  overrideCtors lets the controller specify constructors for\n\t//   certain view tags\n\t// returns the map state (tag -> view)\n\tthis.inflate = function (viewDef, /* optional */ overrideCtors, viewStates) {\n\n\t\tthis._offset = uiConfig.EXPAND_HEIGHT;\n\n\t\tif (viewDef.style.weebyFullScreen) {\n\t\t\tthis._offset = uiConfig.FULL_SCREEN_EXPAND_HEIGHT;\n\t\t\tif (viewDef.style && viewDef.style.showStatusBar) {\n\t\t\t\tthis._offset -= uiConfig.STATUS_BAR_HEIGHT * uiConfig.FULL_SCREEN_SCALE;\n\t\t\t}\n\t\t} else if (viewDef.style && viewDef.style.showStatusBar) {\n\t\t\tthis._offset -= uiConfig.STATUS_BAR_HEIGHT;\n\t\t}\n\n\t\tthis._expandSearch(viewDef);\n\n\t\tif (!viewStates) {\n\t\t\tviewStates = new ViewState();\n\t\t}\n\n\t\tthis._inflate(overrideCtors, null, viewDef, viewStates);\n\n\t\treturn viewStates;\n\t};\n\n\t// inflate a view\n\tthis._inflate = function (overrideCtors, superview, viewDef, viewStates) {\n\t\t// create the view\n\t\t\n\t\t// the tag is either specified, or if †he type starts with $, the type\n\t\tvar tag = viewDef.tag || viewDef.type.charAt(0) == '$' && viewDef.type;\n\n\t\t// use constructor from the overrides\n\t\tvar ctor = overrideCtors && overrideCtors[tag];\n\t\tif (typeof ctor == 'string') {\n\t\t\tctor = ctors[ctor];\n\t\t}\n\n\t\t// or look it up by string\n\t\tif (!ctor) {\n\t\t\tctor = ctors[viewDef.type];\n\t\t}\n\n\t\tif (viewDef.style && viewDef.style.prompt) {\n\t\t\tviewDef.style.prompt = i18n.get(viewDef.style.prompt);\n\t\t\tctor = ctors['prompt'];\n\t\t}\n\t\t// infer a nice default constructor if we still don't have one\n\t\tif (!ctor) {\n\t\t\t// was a background image specfiied?\n\t\t\tif (viewDef.style && viewDef.style.image) {\n\t\t\t\tif (viewDef.style.scaleMethod) {\n\t\t\t\t\tctor = ctors['scaledImage'];\n\t\t\t\t} else {\n\t\t\t\t\tctor = ctors['image'];\n\t\t\t\t}\n\t\t\t} else if (viewDef.style && ('text' in viewDef.style)) {\n\t\t\t\tctor = ctors['text'];\n\t\t\t} else {\n\t\t\t\tctor = ctors['default'];\n\t\t\t}\n\t\t}\n\n\t\t// create the view\n\t\tvar opts = {superview: superview, tag: tag};\n\n\t\tif (i18n && viewDef.style) { \n\t\t\tif (viewDef.style.text) {\n\t\t\t\topts.text = i18n.get(viewDef.style.text);\n\t\t\t}\n\n\t\t\tif (viewDef.style.hint) {\n\t\t\t\topts.hint = i18n.get(viewDef.style.hint); \n\t\t\t}\n\n\t\t\tif (viewDef.style.hintJs) {\n\t\t\t\topts.hintJs = i18n.get(viewDef.style.hintJs); \n\t\t\t}\n\t\t}\n\n\t\tvar view = new ctor(merge(opts, viewDef.style));\n\t\tview.__weeby_id = viewDef.id;\n\t\tif (superview) {\n\t\t\tsuperview.addSubview(view);\n\t\t}\n\n\t\tviewStates.views[tag] = view;\n\n\t\tif (viewDef.states) {\n\t\t\tviewStates.addStateMap(view.uid, viewDef.style, viewDef.states);\n\t\t}\n\n\t\tif (viewDef.type == 'button') {\n\t\t\tview.on('InputStart', bind(viewStates, 'addState', view, 'pressed'));\n\t\t\tview.on('InputSelect', bind(viewStates, 'removeState', view, 'pressed'));\n\t\t\tview.on('InputOut', bind(viewStates, 'removeState', view, 'pressed'));\n\t\t}\n\n\t\tif (viewDef.type === 'editText') {\n\t\t\tview.on('focusAdd', bind(viewStates, 'addState', view, 'focused'));\n\t\t\tview.on('focusRemove', bind(viewStates, 'removeState', view, 'focused'));\n\t\t}\n\n\t\t// build any subviews\n\t\tvar childDefs = viewDef.children;\n\t\tif (childDefs) {\n\t\t\tvar i = 0, n = childDefs.length;\n\t\t\tfor (var i = 0; i < n; ++i) {\n\t\t\t\tthis._inflate(overrideCtors, view, childDefs[i], viewStates);\n\t\t\t}\n\t\t}\n\n\t\treturn view;\n\t};\n\n\tthis._expandSearch = function (viewDef, parents, depth) {\n\n\t\tif (!parents) {\n\t\t\tparents = [];\n\t\t\tdepth = -1;\n\t\t}\n\n\t\tif (viewDef.style && viewDef.style.weebyExpand && !viewDef._expanded) {\n\t\t\tthis._expand(viewDef, parents, depth);\n\t\t}\n\n\t\tif (viewDef.children) {\n\t\t\tparents.push(viewDef);\n\t\t\tfor (var i = 0, n = viewDef.children.length; i < n; ++i) {\n\t\t\t\tthis._expandSearch(viewDef.children[i], parents, depth + 1);\n\t\t\t}\n\t\t\tparents.pop();\n\t\t}\n\t};\n\n\tthis._expand = function (viewDef, parents, depth) {\n\t\t// we might pass a parent multiple times -- only expand it once!\n\t\tif (!viewDef._expanded) {\n\t\t\t// mark this view as expanded\n\t\t\tviewDef._expanded = true;\n\n\t\t\t// expand the height\n\t\t\tif (viewDef.style && ('height' in viewDef.style)) {\n\t\t\t\tviewDef.style.height += this._offset;\n\t\t\t}\n\n\t\t\t// if there are any states with height, expand those too\n\t\t\tif (viewDef.states) {\n\t\t\t\tfor (var key in viewDef.states) {\n\t\t\t\t\tvar state = viewDef.states[key];\n\t\t\t\t\tif ('height' in state) {\n\t\t\t\t\t\tstate.height += this._offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar parent = parents[depth];\n\t\t\tif (parent) {\n\t\t\t\t// expand all unexpanded parents too\n\t\t\t\tif (!parent._expanded) {\n\t\t\t\t\tthis._expand(parent, parents, depth - 1);\n\t\t\t\t}\n\n\t\t\t\t// shift all siblings *after* this view *down* by the expand height\n\t\t\t\tvar children = parent.children;\n\t\t\t\tvar after = false;\n\t\t\t\tfor (var i = 0, n = children.length; i < n; ++i) {\n\t\t\t\t\tvar child = children[i];\n\t\t\t\t\tif (after) {\n\t\t\t\t\t\tif (!child._shifted) {\n\t\t\t\t\t\t\tchild._shifted = true;\n\t\t\t\t\t\t\tif (child.style && ('y' in child.style)) {\n\t\t\t\t\t\t\t\tchild.style.y += this._offset;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (child.states) {\n\t\t\t\t\t\t\t\tfor (var key in child.states) {\n\t\t\t\t\t\t\t\t\tvar state = child.states[key];\n\t\t\t\t\t\t\t\t\tif ('y' in state) {\n\t\t\t\t\t\t\t\t\t\tstate.y += this._offset;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (child == viewDef) {\n\t\t\t\t\t\tafter = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\n// singleton pattern\nvar _inflator = null;\nexports.get = function () {\n\treturn _inflator || (_inflator = new exports());\n};\n","pre":true},"sdk/timestep/ui/TextPromptView.js":{"path":"sdk/timestep/ui/TextPromptView.js","friendlyPath":"ui.TextPromptView","directory":"sdk/timestep/ui/","filename":"TextPromptView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.TextPromptView;\n * Implements a view that can accept input using the environment's InputPrompt.\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.textpromptview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\njsio(\"import ui.TextView as TextView\");\njsio(\"import device\");\n\nvar InputPrompt = device.get('InputPrompt');\n\nvar sdk_timestep_ui_TextPromptView=__class__;exports=sdk_timestep_ui_TextPromptView(function sdk_timestep_ui_TextPromptView(){return this.init&&this.init.apply(this,arguments)},TextView, function (supr) {\n\n\tvar defaults = {\n\t\tprompt: '',\n\t\tautoShowKeyboard: false,\n\t\tisPassword: false\n\t};\n\n\tthis.init = function (opts) {\n\t\tthis._opts = merge(opts, defaults)\n\n\t\tsupr(this, 'init', [this._opts]);\n\n\t\tthis._prompt = new InputPrompt({\n\t\t\tprompt: this._opts.prompt,\n\t\t\tautoShowKeyboard: this._opts.autoShowKeyboard,\n\t\t\tisPassword: this._opts.isPassword,\n\t\t\tonChange: bind(this, 'onChange'),\n\t\t\tonSubmit: bind(this, 'onSubmit'),\n\t\t\tkeyboardType: this._opts.keyboardType\n\t\t});\n\t};\n\n\tthis.onInputSelect = function () {\n\t\tthis._prompt.show();\n\t};\n\n\tthis.onSubmit = function (value) {\n\t\tthis.publish('Submit', value);\n\t}\n\n\tthis.onChange = function (changeValue) {\n\t\tif (changeValue === null) {\n\t\t\tthis.publish('Cancel');\n\t\t} else {\n\t\t\tvar value = this._prompt.getValue();\n\t\t\tif (value !== this.getText()) {\n\t\t\t\tthis.setText(value);\n\t\t\t\tthis.publish('Change', value);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.setOkButton = function (value) {\n\t\tthis._prompt.setOkButton(value);\n\t\treturn this;\n\t}\n\n\tthis.setCancelButton = function (value) {\n\t\tthis._prompt.setCancelButton(value);\n\t\treturn this;\n\t}\n\n\tthis.setPrompt = function (prompt) {\n\t\tthis._prompt.setMessage(prompt);\n\t\treturn this;\n\t};\n\n\tthis.showPrompt = function () {\n\t\tthis._prompt.show();\n\t};\n\n\tthis.setKeyboardType = function(keyboardType) {\n\t\tthis._prompt.setKeyboardType(keyboardType);\n\t\treturn this;\n\t};\n});\n\nexports.KeyboardTypes = InputPrompt.KeyboardTypes;\n","pre":true},"sdk/timestep/ui/TextInputView.js":{"path":"sdk/timestep/ui/TextInputView.js","friendlyPath":"ui.TextInputView","directory":"sdk/timestep/ui/","filename":"TextInputView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.TextInputView;\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.textinputview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\njsio(\"import device\");\njsio(\"import ui.View as View\");\n\nvar TextBox = device.get('TextBox');\n\nvar sdk_timestep_ui_TextInputView=__class__;exports=sdk_timestep_ui_TextInputView(function sdk_timestep_ui_TextInputView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\t\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tcolor: 'black',\n\t\t\theight: 20,\n\t\t\tlayout: 'box'\n\t\t});\n\t\t\n\t\tthis._props = {};\n\t\t\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._opts = opts;\n\t\tthis.updatePosition();\n\t};\n\t\n\tthis.getOpacity = function () {\n\t\tvar view = this,\n\t\t\t\topacity = this.style.opacity;\n\t\twhile (view._superview) {\n\t\t\tview = view._superview;\n\t\t\topacity *= view.style.opacity;\n\t\t}\n\t\treturn opacity;\n\t}\n\t\n\tthis._clearSuperview = function () {\n\t\tsupr(this, '_clearSuperview', arguments);\n\t\t\n\t\tthis._textBox.destroy();\n\t\tthis._textBox = null;\n\t}\n\t\n\tthis.updatePosition = function () {\n\t\tvar app = this.getApp();\n\t\tif (!app) { return; }\n\t\t\n\t\tvar s = this.style;\n\t\tvar a = this._props;\n\t\tvar b = this.getPosition();\n\t\tif (this._textBox && a.x == b.x && a.y == b.y && a.width == b.width && a.height == b.height && a.opacity == s.opacity) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar box = this._textBox;\n\t\tif (!box) {\n\t\t\tbox = this._textBox = new TextBox({color: this._opts.color});\n\t\t\tthis._textBox.onChange = bind(this, '_onValueChanged');\n\t\t\tbox.setValue(this._opts.value || '');\n\t\t}\n\t\t\n\t\tbox.setApp(app);\n\t\tbox.setPosition(b);\n\t\tbox.setDimensions(b);\n\t\tbox.setOpacity(s.opacity);\n\t\tbox.setVisible(true);\n\t\t\n\t\tthis._props = b;\n\t};\n\t\n\tthis._onValueChanged = function () {\n\t\tthis.publish('ValueChanged', this.getValue());\n\t}\n\n\tthis.setValue = function (value) { return this._textBox.setValue(value); }\n\tthis.getValue = function () { return this._textBox.getValue(); }\n\t\n\tthis.updateStyle = function (style) {\n\t\tthis._el.style = merge(style, this._el.style);\n\t};\n\t\n\tthis.updateOpts = function (opts) {\n\t\tthis.opts = merge(opts, this.opts);\n\t};\n\t\n\tthis.render = function () {\n\t\tthis.updatePosition();\n\t};\n\t\n});\n","pre":true},"sdk/plugins/weeby/ui/components/SwitchView.js":{"path":"sdk/plugins/weeby/ui/components/SwitchView.js","friendlyPath":".components.SwitchView","directory":"sdk/plugins/weeby/ui/components/","filename":"SwitchView.js","src":"jsio(\"import animate\");\n\njsio(\"import ui.View as View\");\njsio(\"import ui.TextView as TextView\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.ImageScaleView as ImageScaleView\");\n\njsio(\"import ...i18n\");\n\nvar sdk_plugins_weeby_ui_components_SwitchView=__class__;exports=sdk_plugins_weeby_ui_components_SwitchView(function sdk_plugins_weeby_ui_components_SwitchView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tonText: 'on',\n\t\t\toffText: 'off',\n\t\t\tisOn: false\n\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._halfWidth = this.style.width / 2;\n\t\tthis._height = this.style.height;\n\t\tthis._isOn = opts.isOn;\n\n\t\tvar onText = i18n.get(opts.onText);\n\t\tvar offText = i18n.get(opts.offText);\n\n\t\tthis._thumb = new View({\n\t\t\tsuperview: this,\n\t\t\twidth: this._halfWidth,\n\t\t\theight: this._height\n\t\t});\n\n\t\tthis._thumbTextOn = new TextView(merge({\n\t\t\tsuperview: this._thumb,\n\t\t\twidth: this._halfWidth,\n\t\t\theight: this._thumb.style.height,\n\t\t\ttext: onText,\n\t\t\tautoFontSize: false,\n\t\t\topacity: this._isOn ? 1 : 0\n\t\t}, opts.font));\n\n\t\tthis._thumbTextOff = new TextView(merge({\n\t\t\tsuperview: this._thumb,\n\t\t\twidth: this._halfWidth,\n\t\t\theight: this._thumb.style.height,\n\t\t\ttext: offText,\n\t\t\tautoFontSize: false,\n\t\t\topacity: this._isOn ? 0 : 1\n\t\t}, opts.font));\n\n\t\tif (opts.textInset) {\n\t\t\tthis._applyInset(this._thumbTextOn, opts.textInset);\n\t\t\tthis._applyInset(this._thumbTextOff, opts.textInset);\n\t\t}\n\n\t\tif (opts.image) {\n\t\t\tthis._createBgImage(this._thumb, opts.image, opts.sourceSlices);\n\t\t}\n\t};\n\n\tthis._applyInset = function (view, inset) {\n\t\tvar s = view.style;\n\t\ts.x += inset[3];\n\t\ts.y += inset[0];\n\t\ts.width -= inset[1] + inset[3];\n\t\ts.height -= inset[0] + inset[2];\n\t}\n\n\tthis._createBgImage = function (superview, image, slices) {\n\t\treturn new (slices ? ImageScaleView : ImageView)({\n\t\t\tsuperview: superview,\n\t\t\timage: image,\n\t\t\tscaleMethod: slices ? '9slice' : null,\n\t\t\tsourceSlices: slices,\n\t\t\twidth: superview.style.width,\n\t\t\theight: superview.style.height,\n\t\t\tzIndex: -1\n\t\t});\n\t};\n\n\tthis.onInputSelect = function () {\n\t\tthis._isOn = !this._isOn;\n\t\tthis.update(true);\n\t\tthis.emit('Change', this._isOn);\n\t};\n\n\tthis.update = function (isAnimated) {\n\t\tif (isAnimated) {\n\t\t\tanimate(this._thumb.style).then({x: this._isOn ? this._halfWidth : 0}, 200);\n\t\t\tthis._animateText(this._isOn);\n\t\t} else {\n\t\t\tthis._thumb.style.x = this._isOn ? this._halfWidth : 0;\n\t\t\tthis._thumbTextOn.style.opacity = this._isOn ? 1 : 0;\n\t\t\tthis._thumbTextOff.style.opacity = this._isOn ? 0 : 1;\n\t\t}\n\t};\n\n\tthis._animateText = function (state) {\n\t\tthis._thumbTextOn.getAnimation().now({opacity: state ? 1 : 0}, 200);\n\t\tthis._thumbTextOff.getAnimation().now({opacity: state ? 0 : 1}, 200);\n\t}\n\n\tthis.onInputStart = function () {\n\t\tthis.startDrag();\n\t\tthis._dragStartX = this._thumb.style.x;\n\t\tthis._currentState = this._isOn;\n\t}\n\n\tthis.onDrag = function (dragEvt, moveEvt, delta) {\n\t\tthis._thumb.style.x = Math.min(this._halfWidth, Math.max(0, this._dragStartX + (dragEvt.currPt.x - dragEvt.srcPt.x)));\n\t\tvar currentState = this._thumb.style.x >= this._halfWidth / 2;\n\t\tif (currentState != this._currentState) {\n\t\t\tthis._currentState = currentState;\n\t\t\tthis._animateText(currentState);\n\t\t}\n\t}\n\n\tthis.onDragStop = function () {\n\t\tthis._isOn = this._thumb.style.x >= this._halfWidth / 2;\n\t\tthis.update(true);\n\t\tthis.emit('Change', this._isOn);\n\t}\n\n\tthis.isOn = function () {\n\t\treturn this._isOn;\n\t};\n\n\tthis.setOn = function () {\n\t\tthis._isOn = true;\n\t\tthis.update(false);\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/components/ScoreView.js":{"path":"sdk/plugins/weeby/ui/components/ScoreView.js","friendlyPath":".components.ScoreView","directory":"sdk/plugins/weeby/ui/components/","filename":"ScoreView.js","src":"jsio(\"import ui.View as View\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.resource.Image as Image\");\n\n/* ScoreView.js\n * This class is designed for high performance text-rendering using images.\n * It is ideal for scores or other in-game counters that update often.\n */\n\nvar sdk_plugins_weeby_ui_components_ScoreView=__class__;exports=sdk_plugins_weeby_ui_components_ScoreView(function sdk_plugins_weeby_ui_components_ScoreView(){return this.init&&this.init.apply(this,arguments)},View, function(supr) {\n\n\tthis.init = function(opts) {\n\t\topts.blockEvents = true;\n\t\topts.canHandleEvents = false;\n\t\tsupr(this, 'init', arguments);\n\n\t\t// characters that should be rendered\n\t\tthis.activeCharacters = [];\n\t\tthis.imageViews = [];\n\n\t\t// text options\n\t\tthis.textAlign = opts.textAlign || opts.horizontalAlign || 'center';\n\t\tthis.spacing = opts.spacing || 0;\n\t\tthis.srcHeight = opts.srcHeight;\n\n\t\t// used for internal scaling / fitting text within bounds\n\t\tthis.textContainer = new View({\n\t\t\tparent: this,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tanchorX: this.style.width / 2,\n\t\t\tanchorY: this.style.height / 2,\n\t\t\twidth: this.style.width,\n\t\t\theight: this.style.height\n\t\t});\n\n\t\t// get our image data and set up Images\n\t\tif (opts.characterData) {\n\t\t\tthis.setCharacterData(opts.characterData);\n\t\t\tif (opts.text) {\n\t\t\t\tthis.setText(opts.text);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.setCharacterData = function(data) {\n\t\tthis.characterData = data;\n\n\t\tfor (var i in data) {\n\t\t\tvar d = data[i];\n\t\t\td.img = new Image({ url: d.image });\n\n\t\t\tvar map = d.img.getMap();\n\t\t\td.width = d.width || (map.width + map.marginLeft + map.marginRight);\n\t\t\tthis.srcHeight = this.srcHeight || (map.height + map.marginTop + map.marginBottom);\n\t\t}\n\n\t\tif (this.text) {\n\t\t\tthis.setText(this.text);\n\t\t}\n\t};\n\n\tthis.setText = function(text) {\n\t\tvar style = this.style;\n\n\t\tthis.text = text = text + \"\";\n\t\tthis.textWidth = 0;\n\n\t\t// scale to fit vertically based on source height\n\t\tvar scale = style.height / this.srcHeight,\n\t\t\tspacing = this.spacing * scale;\n\n\t\tvar i = 0, data;\n\t\twhile (i < text.length) {\n\t\t\tvar character = text.charAt(i),\n\t\t\t\tdata = this.characterData[character];\n\t\t\tif (data) {\n\t\t\t\tthis.activeCharacters[i] = data;\n\t\t\t\tthis.textWidth += data.width * scale;\n\t\t\t} else {\n\t\t\t\tlogger.warn(\"Invalid character in ScoreView, no data for: \" + character);\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\n\t\t// add spacing to textWidth\n\t\tif (text.length) {\n\t\t\tthis.textWidth += spacing * (text.length - 1);\n\t\t}\n\n\t\t// scale-to-fit horizontally within width\n\t\tif (style.width < this.textWidth) {\n\t\t\tthis.textContainer.style.scale = style.width / this.textWidth;\n\t\t} else {\n\t\t\tthis.textContainer.style.scale = 1;\n\t\t}\n\n\t\t// text alignment logic\n\t\tif (this.textAlign == 'center') {\n\t\t\tthis.offset = (style.width - this.textWidth) / 2;\n\t\t\tthis.textContainer.style.anchorX = this.style.width / 2;\n\t\t} else if (this.textAlign == 'right') {\n\t\t\tthis.offset = style.width - this.textWidth;\n\t\t\tthis.textContainer.style.anchorX = this.style.width;\n\t\t} else {\n\t\t\tthis.offset = 0;\n\t\t\tthis.textContainer.style.anchorX = 0;\n\t\t}\n\n\t\t// create new ImageViews if we need them\n\t\twhile (text.length > this.imageViews.length) {\n\t\t\tvar newView = new ImageView({\n\t\t\t\tparent: this.textContainer,\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: 1,\n\t\t\t\theight: 1,\n\t\t\t\tcanHandleEvents: false,\n\t\t\t\tinLayout: false\n\t\t\t});\n\t\t\tnewView.needsReflow = function() {};\n\t\t\tthis.imageViews.push(newView);\n\t\t}\n\n\t\t// trim excess characters\n\t\tthis.activeCharacters.length = text.length;\n\n\t\tvar x = this.offset, y = 0;\n\t\tfor (i = 0; i < this.activeCharacters.length; i++) {\n\t\t\tvar data = this.activeCharacters[i],\n\t\t\t\tview = this.imageViews[i],\n\t\t\t\ts = view.style,\n\t\t\t\tw = data.width * scale;\n\n\t\t\ts.x = x;\n\t\t\ts.y = y;\n\t\t\ts.width = w;\n\t\t\ts.height = style.height; // all characters should have the same height\n\t\t\ts.visible = true;\n\t\t\tview.setImage(data.img);\n\n\t\t\tx += w + spacing;\n\t\t}\n\n\t\twhile (i < this.imageViews.length) {\n\t\t\tthis.imageViews[i].style.visible = false;\n\t\t\ti++;\n\t\t}\n\t};\n\n\tthis.needsReflow = function() {};\n});","pre":true},"sdk/timestep/ui/widget/ButtonView.js":{"path":"sdk/timestep/ui/widget/ButtonView.js","friendlyPath":"ui.widget.ButtonView","directory":"sdk/timestep/ui/widget/","filename":"ButtonView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import ui.View as View\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.ImageScaleView as ImageScaleView\");\njsio(\"import ui.TextView as TextView\");\n\njsio(\"import AudioManager\");\njsio(\"import lib.Enum as Enum\");\n\nvar states = Enum(\n\t\"UP\",\n\t\"DOWN\",\n\t\"DISABLED\",\n\t\"SELECTED\",\n\t\"UNSELECTED\"\n);\nvar lastClicked = null;\nvar sdk_timestep_ui_widget_ButtonView=__class__;var ButtonView = exports=sdk_timestep_ui_widget_ButtonView(function sdk_timestep_ui_widget_ButtonView(){return this.init&&this.init.apply(this,arguments)},ImageScaleView, function (supr) {\n\n\tthis.init = function (opts) {\n\t\tthis._state = opts.defaultState || opts.state ||\n\t\t\t(opts.toggleSelected ? states.UNSELECTED : states.UP);\n\n\t\tsupr(this, \"init\", arguments);\n\n\t\tthis.selected = (opts.toggleSelected && \n\t\t\topts.state === states.SELECTED) ? true: false;\n\n\t\tvar textOpts = merge(\n\t\t\topts.text,\n\t\t\t{\n\t\t\t\tsuperview: this,\n\t\t\t\ttext: opts.title || \"\",\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: this.style.width,\n\t\t\t\theight: this.style.height,\n\t\t\t\tcanHandleEvents: false\n\t\t\t}\n\t\t);\n\t\tthis._text = new TextView(textOpts);\n\n\t\tvar iconOpts = merge(\n\t\t\topts.icon,\n\t\t\t{\n\t\t\t\tsuperview: this,\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: this.style.width,\n\t\t\t\theight: this.style.height,\n\t\t\t\tcanHandleEvents: false\n\t\t\t}\n\t\t);\n\t\tthis._icon = new ImageView(iconOpts);\n\n\t\tthis.updateOpts(opts);\n\t\tthis._trigger(this._state, true);\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\topts = merge(opts, this._opts);\n\n\t\topts = supr(this, \"updateOpts\", [opts]);\n\n\t\tthis._opts = opts;\n\t\tthis._images = opts.images;\n\t\tthis._onHandlers = opts.on || {};\n\t\tthis._audioManager = opts.audioManager;\n\t\tthis._sounds = opts.sounds;\n\n\t\t(\"text\" in opts) && this._text && this._text.updateOpts(opts.text);\n\t};\n\n\tthis.onInputStart = function () {\n\t\t//no action when disabled\n\t\tif (this._state === states.DISABLED) {\n\t\t\treturn;\n\t\t}\n\n\t\tlastClicked = this.uid;\n\n\t\tthis._state = states.DOWN;\n\t\tthis._trigger(states.DOWN);\n\t};\n\n\tthis.onInputOver = function () {\n\t\t//no action when disabled\n\t\tif (this._state === states.DISABLED || lastClicked != this.uid) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._state = states.DOWN;\n\t\tthis._trigger(states.DOWN, true);\n\t};\n\n\tthis.onInputSelect = function () {\n\t\t//no action when disabled\n\t\tif (this._state === states.DISABLED) {\n\t\t\treturn;\n\t\t}\n\n\t\t//call the click handler\n\t\tthis._opts.onClick && this._opts.onClick.call(this);\n\t\tthis.onClick && this.onClick();\n\n\t\t// onClick handler may disable button\n\t\tif (this._state == states.DISABLED) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._opts.clickOnce) {\n\t\t\tthis._state = states.DISABLED;\n\t\t\tthis._trigger(states.UP);\n\t\t\tthis._trigger(states.DISABLED);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._opts.toggleSelected) {\n\t\t\tif (this.selected) {\n\t\t\t\tthis._trigger(states.UNSELECTED);\n\t\t\t\tthis.selected = false;\n\t\t\t} else {\n\t\t\t\tthis._trigger(states.SELECTED);\n\t\t\t\tthis.selected = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._trigger(states.UP);\n\t\t}\n\t};\n\n\tthis.onInputOut = function () {\n\t\tif (this._state !== states.DISABLED && this._state !== states.UP) {\n\t\t\tthis._state = states.UP;\n\t\t\tthis._trigger(states.UP, true);\n\t\t}\n\t};\n\n\t//when this function is called from the constructor the dontPublish parameter to prevent publishing events on create...\n\tthis._trigger = function (state, dontPublish) {\n\t\tvar stateName = states[state];\n\t\tif (!stateName) return;\n\t\tstateName = stateName.toLowerCase();\n\n\t\tif (this._images && this._images[stateName]) {\n\t\t\tif (!(this._opts.toggleSelected && (state === states.UP))) {\n\t\t\t\tthis.setImage(this._images[stateName]);\n\t\t\t}\n\t\t}\n\t\tif (dontPublish) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof this._onHandlers[stateName] === \"function\") {\n\t\t\tthis._onHandlers[stateName].call(this);\n\t\t}\n\t\tif (this._sounds && this._sounds[stateName]) {\n\t\t\tthis._audioManager && this._audioManager.play(this._sounds[stateName]);\n\t\t}\n\n\t\tthis.emit(stateName);\n\t};\n\n\tthis.reflow = function () {\n\t\tthis._text.style.width = this.style.width;\n\t\tthis._text.style.height = this.style.height;\n\t};\n\n\tthis.getText = function () {\n\t\treturn this._text;\n\t};\n\n\tthis.setTitle = function (title) {\n\t\tthis._text.setText(title);\n\t};\n\n\tthis.getIcon = function () {\n\t\treturn this._icon;\n\t};\n\n\tthis.setIcon = function (icon) {\n\t\tthis._icon.setImage(icon);\n\t};\n\n\tthis.setState = function (state) {\n\t\tvar stateName = states[state];\n\t\tif (!stateName) return;\n\n\t\tswitch (state) {\n\t\t\tcase states.SELECTED:\n\t\t\t\tthis.selected = true;\n\t\t\t\tbreak;\n\n\t\t\tcase states.UNSELECTED:\n\t\t\t\tthis.selected = false;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis._state = state;\n\t\tstateName = stateName.toLowerCase();\n\t\tthis.setImage(this._images[stateName]);\n\t};\n});\n\nButtonView.states = states;\n","pre":true},"sdk/timestep/ui/widget/SliderView.js":{"path":"sdk/timestep/ui/widget/SliderView.js","friendlyPath":"ui.widget.SliderView","directory":"sdk/timestep/ui/widget/","filename":"SliderView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import ui.ImageScaleView as ImageScaleView\");\njsio(\"import ui.resource.Image as Image\");\n\nvar sdk_timestep_ui_widget_SliderView=__class__;exports=sdk_timestep_ui_widget_SliderView(function sdk_timestep_ui_widget_SliderView(){return this.init&&this.init.apply(this,arguments)},ImageScaleView, function (supr) {\n\n\tthis.init = function (opts) {\n\t\tthis._minValue = (\"minValue\" in opts) ? opts.minValue : 0;\n\t\tthis._maxValue = (\"maxValue\" in opts) ? opts.maxValue : 100;\n\t\tthis._thumbSize = opts.thumbSize || \"auto\";\n\t\tthis._active = (\"active\" in opts) ? opts.active : true;\n\t\tthis._increment = (\"increment\" in opts) ? opts.increment : false;\n\n\t\topts = merge(opts, opts.track);\n\t\tsupr(this, \"init\", [opts]);\n\n\t\tthis._value = Math.max(Math.min(opts.value || 0, this._maxValue), this._minValue);\n\n\t\tthis.updateOpts(opts);\n\t};\n\n\tthis._initThumb = function (opts) {\n\t\tvar thumb = merge({\n\t\t\t\tsuperview: this\n\t\t\t}, opts.thumb);\n\n\t\tif (!thumb.pressed) {\n\t\t\tthumb.pressed = thumb.active;\n\t\t}\n\t\tif (!thumb.inactive) {\n\t\t\tthumb.inactive = thumb.active;\n\t\t}\n\n\t\tthis._thumbActiveImage = (thumb.active instanceof Image) ? thumb.active : new Image({url: thumb.active || \"\"});\n\t\tthis._thumbPressedImage = (thumb.pressed instanceof Image) ? thumb.pressed : new Image({url: thumb.pressed || \"\"});\n\t\tthis._thumbInactiveImage = (thumb.inactive instanceof Image) ? thumb.inactive : new Image({url: thumb.inactive || \"\"});\n\n\t\tthumb.inactive = thumb.inactive || thumb.active;\n\n\t\tthis._thumb = new ImageScaleView(thumb);\n\t};\n\n\tthis.updateOpts = function (opts) { // This method updates all options which don't have a setter in this class!\n\t\topts = merge(opts, opts.track);\n\n\t\tsupr(this, \"updateOpts\", [opts]);\n\n\t\tvar track = opts.track || {};\n\t\tif (!track.inactive) {\n\t\t\ttrack.inactive = track.active;\n\t\t}\n\n\t\tthis._activeImage = new Image({url: track.active || \"\"});\n\t\tthis._inactiveImage = new Image({url: track.inactive || \"\"});\n\n\t\tthis._initThumb(opts);\n\t\tthis._updateStyle();\n\n\t\treturn opts;\n\t};\n\n\tthis._updateStyle = function () {\n\t\tvar opts = this._opts;\n\t\tvar active = this._active;\n\n\t\tif (\"activeColor\" in opts) {\n\t\t\tthis.style.backgroundColor = active ? opts.activeColor : opts.inactiveColor;\n\t\t\tthis._thumb.style.backgroundColor = active ? opts.thumb.activeColor : opts.thumb.inactiveColor;\n\t\t} else {\n\t\t\tthis._thumb.setImage(active ? this._thumbActiveImage : this._thumbInactiveImage);\n\t\t\tthis.setImage(active ? this._activeImage : this._inactiveImage);\n\t\t}\n\t};\n\n\tthis._publicValue = function () { // The value which will be published, depends on increment...\n\t\tif (this._increment === false) {\n\t\t\treturn this._value;\n\t\t}\n\t\treturn Math.round(this._value / this._increment) * this._increment;\n\t};\n\n\tthis._valueFromThumbPosition = function (pos) {\n\t\tvar fields = this._fields; // Which fields to use, based on orientation...\n\t\tvar padding = this.style.padding;\n\t\tvar padSize = padding[fields.padSize]();\n\t\tvar padPos = padding[fields.padPos];\n\t\tvar size = this.style[this._fields.size];\n\n\t\tpos = (pos == undefined) ? this._thumb.style[this._fields.pos] : pos;\n\n\t\treturn this._minValue + (pos - padPos) / (size - padSize - this._thumbLength) * (this._maxValue - this._minValue);\n\t};\n\n\tthis._positionFromPoint = function (pt) {\n\t\tvar fields = this._fields; // Which fields to use, based on orientation...\n\t\tvar padding = this.style.padding;\n\t\tvar padSize = padding[fields.padSize]();\n\t\tvar padPos = padding[fields.padPos];\n\t\tvar pos = pt[fields.pos] - (this._thumbLength / 2 + padPos);\n\t\tvar max = this.style[fields.size] - (padSize + this._thumbLength);\n\n\t\treturn padPos + Math.min(Math.max(pos, 0), max);\n\t};\n\n\tthis.onInputStart = function (event, pt) {\n\t\tif (this._active) {\n\t\t\tvar endPos = this._positionFromPoint(pt);\n\t\t\tvar pos = {};\n\n\t\t\tpos[this._fields.pos] = endPos;\n\n\t\t\tthis._value = this._valueFromThumbPosition(endPos);\n\t\t\tthis.publish(\"Change\", this._publicValue(this._value));\n\n\t\t\tif (\"pressedColor\" in this._opts.thumb) {\n\t\t\t\tthis._thumb.style.backgroundColor = this._opts.thumb.pressedColor;\n\t\t\t} else {\n\t\t\t\tthis._thumb.setImage(this._thumbPressedImage);\n\t\t\t}\n\t\t\tthis._thumb.getAnimation().now(pos, 100);\n\n\t\t\tthis.startDrag();\n\t\t}\n\t};\n\n\tthis.onDrag = function (dragEvt, moveEvt) {\n\t\tif (this._active && moveEvt.point[this.uid]) {\n\t\t\tthis._thumb.style[this._fields.pos] = this._positionFromPoint(moveEvt.point[this.uid]);\n\t\t\tthis._value = this._valueFromThumbPosition();\n\t\t\tthis.publish(\"Change\", this._publicValue(this._value));\n\t\t}\n\t};\n\n\tthis.onDragStop = function (event) {\n\t\tthis._updateStyle();\n\t};\n\n\tthis.onInputSelect = function (event, pt) {\n\t\tif (this._active) {\n\t\t\tthis._updateStyle();\n\t\t\tthis._thumb.style[this._fields.pos] = this._positionFromPoint(pt);\n\t\t\tthis._value = this._valueFromThumbPosition();\n\t\t\tthis.publish(\"Change\", this._publicValue(this._value));\n\t\t}\n\t};\n\n\tthis.setValue = function (value) {\n\t\tthis._value = Math.max(Math.min(value, this._maxValue), this._minValue);\n\n\t\tvar fields = this._fields;\n\t\tvar padding = this.style.padding;\n\t\tvar padSize = padding[fields.padSize]();\n\t\tvar padPos = padding[fields.padPos];\n\t\tvar minValue = this._minValue;\n\t\tvar maxValue = this._maxValue;\n\t\tvar range = maxValue - minValue;\n\n\t\tvar pos = {};\n\t\tpos[this._fields.pos] = padPos + ((this._value - minValue) / range) * (this.style[this._fields.size] - this._thumbLength - padSize);\n\t\tthis._thumb.getAnimation().now(pos, 100);\n\n\t\tthis.publish(\"Change\", this._publicValue(this._value));\n\t};\n\n\tthis.getValue = function () {\n\t\treturn this._publicValue(this._value);\n\t};\n\n\tthis.setIncrement = function (increment) {\n\t\tthis._increment = increment;\n\t\tthis.publish(\"Change\", this._publicValue(this._value));\n\t};\n\n\tthis.setMinValue = function (minValue) {\n\t\tthis._minValue = minValue;\n\t\tthis.setValue(this._value);\n\t};\n\n\tthis.setMaxValue = function (maxValue) {\n\t\tthis._maxValue = maxValue;\n\t\tthis.setValue(this._value);\n\t};\n\n\tthis.setThumbSize = function (thumbSize) {\n\t\tthis._thumbSize = thumbSize;\n\t\tthis.reflow();\n\t};\n\n\tthis.setActive = function (active) {\n\t\tthis._active = active;\n\t\tthis._updateStyle();\n\t};\n\n\tthis.reflow = function () {\n\t\tvar thumbStyle = this._thumb.style;\n\t\tvar style = this.style;\n\t\tvar thumbThickness;\n\n\t\tthis._isHorizontal = (\"horizontal\" in this._opts) ? this._opts.horizontal : (style.width > style.height);\n\n\t\tif (this._isHorizontal) {\n\t\t\tthis._fields = {pos: \"x\", size: \"width\", padPos: \"left\", padSize: \"getHorizontal\"};\n\t\t\tthumbThickness = style.height - style.padding.getVertical();\n\t\t\tthis._thumbLength = (this._thumbSize === \"auto\") ? thumbThickness : this._thumbSize;\n\t\t\tthumbStyle.y = style.padding.top;\n\t\t\tthumbStyle.width = this._thumbLength;\n\t\t\tthumbStyle.height = thumbThickness;\n\t\t} else {\n\t\t\tthis._fields = {pos: \"y\", size: \"height\", padPos: \"top\", padSize: \"getVertical\"};\n\t\t\tthumbThickness = style.width - style.padding.getHorizontal();\n\t\t\tthis._thumbLength = (this._thumbSize === \"auto\") ? thumbThickness : this._thumbSize;\n\t\t\tthumbStyle.x = style.padding.left;\n\t\t\tthumbStyle.width = thumbThickness;\n\t\t\tthumbStyle.height = this._thumbLength;\n\t\t}\n\n\t\tthis.setValue(this._value);\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/components/WeebyBaseView.js":{"path":"sdk/plugins/weeby/ui/components/WeebyBaseView.js","friendlyPath":".WeebyBaseView","directory":"sdk/plugins/weeby/ui/components/","filename":"WeebyBaseView.js","src":"jsio(\"import device\");\n\njsio(\"import ui.View as View\");\n\njsio(\"import ...weebyController\");\njsio(\"import ...Weeby\");\n\nvar sdk_plugins_weeby_ui_components_WeebyBaseView=__class__;exports=sdk_plugins_weeby_ui_components_WeebyBaseView(function sdk_plugins_weeby_ui_components_WeebyBaseView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tweebyController.on('State', bind(this, '_onWeebyState'));\n\t};\n\n\tthis.disableInput = function () {\n\t\tthis.getInput().blockEvents = true;\n\t};\n\n\tthis.enableInput = function () {\n\t\tthis.getInput().blockEvents = false;\n\t};\n\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\t\tthis.enableInput();\n\t};\n\n\tthis._onWeebyState = function (state) {\n\t\tthis.style.visible && state && this.onWeebyState(state);\n\t};\n\n\tthis.onWeebyState = function (state) {\n\t\tstate && console.warn('Unhandled state:', state);\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/components/BackgroundController.js":{"path":"sdk/plugins/weeby/ui/components/BackgroundController.js","friendlyPath":".BackgroundController","directory":"sdk/plugins/weeby/ui/components/","filename":"BackgroundController.js","src":"jsio(\"import ..UIInflator\");\njsio(\"import ..config\");\njsio(\"import .transitions\");\n\n/**\n * Lets multiple views define backgrounds, but only transitions the background\n * if the image source actually changes\n */\nvar sdk_plugins_weeby_ui_components_BackgroundController=__class__;exports=sdk_plugins_weeby_ui_components_BackgroundController(function sdk_plugins_weeby_ui_components_BackgroundController(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar inflator = UIInflator.get();\n\n\tthis._backgroundKey = null;\n\tthis._backgroundView = null;\n\tthis._hasHeader = false;\n\tthis._hasProfileIcon = false;\n\tthis._statusController;\n\n\tvar TRANSITION_TIME = 300;\n\n\tthis.getStatusController = function() {\n\t\treturn this._statusController;\n\t};\n\n\tthis.update = function (viewDef, transition, level) {\n\t\tif (!this._statusController) {\n\t\t\tjsio(\"import .StatusView\");\n\t\t\tthis._statusController = new StatusView();\n\t\t\tthis._hasHeader = false;\n\t\t}\n\n\t\t// we only care about the background and header at the bottom of the view stack\n\t\tif (level == 0) {\n\t\t\tvar bgTransition = transition && 'fade';\n\t\t\tvar key = JSON.stringify(viewDef.style.image + '|' + viewDef.style.scaleMethod);\n\t\t\tif (this._backgroundKey != key) {\n\t\t\t\tthis._backgroundKey = key;\n\t\t\t\tvar viewStates = inflator.inflate(viewDef);\n\t\t\t\tvar view = viewStates.views[Object.keys(viewStates.views)[0]];\n\t\t\t\tview.style.width = config.MAX_WIDTH;\n\t\t\t\tview.style.height = config.MAX_HEIGHT;\n\t\t\t\tthis.show(-1, view, this._backgroundView, bgTransition);\n\t\t\t\tthis._backgroundView = view;\n\t\t\t}\n\n\t\t\tif (this._hasHeader != viewDef.style.hasStatus) {\n\t\t\t\tthis._hasHeader = viewDef.style.hasStatus;\n\t\t\t\tif (this._hasHeader) {\n\t\t\t\t\tthis.show(1000, this._statusController.getView(), null, transition);\n\t\t\t\t} else if (this._statusController) {\n\t\t\t\t\tthis.show(1000, null, this._statusController.getView(), transition);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._hasProfileIcon != viewDef.style.hasProfileIcon) {\n\t\t\tthis._hasProfileIcon = viewDef.style.hasProfileIcon;\n\t\t\tif (this._hasProfileIcon) {\n\t\t\t\tif (!this._profileIcon) {\n\t\t\t\t\tjsio(\"import .ProfileIcon\");\n\t\t\t\t\tthis._profileIcon = new ProfileIcon();\n\t\t\t\t}\n\n\t\t\t\tthis.show(1000, this._profileIcon, null, 'slideup');\n\t\t\t} else if (this._profileIcon) {\n\t\t\t\tthis.show(1000, null, this._profileIcon, 'slideup');\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.show = function (zIndex, view, prevView, transition) {\n\t\tif (view != prevView) {\n\t\t\tif (prevView) {\n\t\t\t\tprevView.style.zIndex = zIndex - 1;\n\t\t\t\tvar onFinish = function () { prevView.removeFromSuperview(); };\n\t\t\t\ttransitions.hide(prevView, transition, onFinish);\n\t\t\t}\n\n\t\t\tif (view) {\n\t\t\t\tview.style.zIndex = zIndex;\n\t\t\t\tGC.app.weebyRootView.addSubview(view);\n\t\t\t\ttransitions.show(view, transition);\n\t\t\t}\n\t\t}\n\t}\n});","pre":true},"sdk/plugins/weeby/ui/components/StatusView.js":{"path":"sdk/plugins/weeby/ui/components/StatusView.js","friendlyPath":".StatusView","directory":"sdk/plugins/weeby/ui/components/","filename":"StatusView.js","src":"jsio(\"import animate\");\njsio(\"import ui.View as View\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.TextView as TextView\");\n\njsio(\"import ui.widget.ButtonView as ButtonView\");\n\njsio(\"import ...trackers.trackers as trackers\");\n\njsio(\"import ...weebyLocalData\");\njsio(\"import ...weebyController\");\njsio(\"import ...i18n\");\njsio(\"import .WeebyViewController\");\n\nvar sdk_plugins_weeby_ui_components_StatusView=__class__;exports=sdk_plugins_weeby_ui_components_StatusView(function sdk_plugins_weeby_ui_components_StatusView(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\n\t// default xp bar values\n\tvar EMPTY_WIDTH = 45,\n\t\tFULL_WIDTH = 163,\n\t\tFILL_WIDTH = FULL_WIDTH - EMPTY_WIDTH;\n\n\tvar _viewDef;\n\tthis.constructor.setViewDef = function (viewDef) {\n\t\t_viewDef = viewDef;\n\t}\n\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tlayout: '$header',\n\t\t\t\tviews: _viewDef,\n\t\t\t\twidth: 576,\n\t\t\t\theight: 100,\n\t\t\t\tvisible: true\n\t\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tvar themeConfig = weebyController.getThemeConfig();\n\n\t\t// look up theme config xp bar values if they exist\n\t\tvar xpBarData = themeConfig.XP_BAR;\n\t\tif (xpBarData) {\n\t\t\tEMPTY_WIDTH = xpBarData.emptyWidth;\n\t\t\tFULL_WIDTH = xpBarData.fullWidth;\n\t\t\tFILL_WIDTH = FULL_WIDTH - EMPTY_WIDTH;\n\t\t} else {\n\t\t\tEMPTY_WIDTH = this._views.$xpClipper._opts.emptyWidth || EMPTY_WIDTH;\n\t\t\tFULL_WIDTH = this._views.$xpClipper.style.width;\n\t\t\tFILL_WIDTH = FULL_WIDTH - EMPTY_WIDTH;\n\t\t}\n\n\t\tvar commonText = this._views.$commonText,\n\t\t\tpremiumText = this._views.$premiumText,\n\t\t\txpText = this._views.$xpText;\n\n\t\tif (commonText._opts.useAlt) {\n\t\t\tcommonText.setCharacterData(themeConfig.HEADER_ALT_CHARACTER_DATA);\n\t\t} else {\n\t\t\tcommonText.setCharacterData(themeConfig.HEADER_CHARACTER_DATA);\n\t\t}\n\n\t\tif (premiumText._opts.useAlt) {\n\t\t\tpremiumText.setCharacterData(themeConfig.HEADER_ALT_CHARACTER_DATA);\n\t\t} else {\n\t\t\tpremiumText.setCharacterData(themeConfig.HEADER_CHARACTER_DATA);\n\t\t}\n\n\t\tif (xpText._opts.useAlt) {\n\t\t\txpText.setCharacterData(themeConfig.HEADER_ALT_CHARACTER_DATA);\n\t\t} else {\n\t\t\txpText.setCharacterData(themeConfig.HEADER_CHARACTER_DATA);\n\t\t}\n\n\t\tthis._xpPct = 0;\n\n\t\tvar model = weebyController._gameModel,\n\t\t\tlevel = weebyLocalData.getLevel(),\n\t\t\txpBase = model.getXPForLevel(level),\n\t\t\txpThreshold = model.getXPForLevel(level + 1),\n\t\t\txpCurrent = weebyLocalData.getXP();\n\n\t\tthis._xpPct = (xpCurrent - xpBase) / (xpThreshold - xpBase);\n\t\tthis._views.$xpClipper.style.width = EMPTY_WIDTH + this._xpPct * FILL_WIDTH;\n\t\txpText.setText(~~(100 * this._xpPct) + \"%\");\n\n\t\t// If a common header item is defined then attach the click event to the entire header\n\t\t// otherwise just attach the event to the common plus button (same for premium)\n\t\tif (this._views.$commonHeaderItem) {\n\t\t\tthis._addEvent('$commonHeaderItem', 'InputSelect', bind(this, 'onCommon'));\n\t\t} else {\n\t\t\tthis._addEvent('$commonPlusButton', 'InputSelect', bind(this, 'onCommon'));\n\t\t}\n\n\t\tif (this._views.$premiumHeaderItem) {\n\t\t\tthis._addEvent('$premiumHeaderItem', 'InputSelect', bind(this, 'onPremium'));\n\t\t} else {\n\t\t\tthis._addEvent('$premiumPlusButton', 'InputSelect', bind(this, 'onPremium'));\n\t\t}\n\n\n\t\tpremiumText.setText(i18n.formatNumber(weebyLocalData.getPremiumCurrency()));\n\t\tcommonText.setText(i18n.formatNumber(weebyLocalData.getCommonCurrency()));\n\n\t\tthis._views.$level.setText(weebyLocalData.getLevel());\n\n\t\tweebyLocalData.on('CurrencyChanged', bind(this, 'onCurrencyChanged'));\n\t\tweebyLocalData.on('LevelChanged', bind(this, 'onLevelChanged'));\n\n\t\tthis.boundUpdateXP = bind(this, function(dt) {\n\t\t\tvar pct = (this._views.$xpClipper.style.width - EMPTY_WIDTH) / FILL_WIDTH;\n\t\t\txpText.setText(~~(100 * pct) + \"%\");\n\t\t});\n\n\t\tthis.boundUpdateCommon = bind(this, function(dt) {\n\t\t\tvar pct = (Date.now() - this._startCommonTime) / this._totalCommonTime;\n\t\t\tif(pct > 1) {\n\t\t\t\tpct = 1;\n\t\t\t}\n\t\t\tcommonText.setText(i18n.formatNumber(this._startingCommon + ~~((this._targetCommon - this._startingCommon) * pct)));\n\t\t});\n\t\t\n\t\tthis.boundUpdatePremium = bind(this, function(dt) {\n\t\t\tvar pct = (Date.now() - this._startPremiumTime) / this._totalPremiumTime;\n\t\t\tif(pct > 1) {\n\t\t\t\tpct = 1;\n\t\t\t}\n\t\t\tpremiumText.setText(i18n.formatNumber(this._startingPremium + ~~((this._targetPremium - this._startingPremium) * pct)));\n\t\t});\n\t};\n\n\tthis.setValue = function (index, value) {\n\t\tthis._list[index].value.setText(value);\n\t};\n\n\tthis.onCommon = function () {\n\t\ttrackers.track('header:commonBtn');\n\t\tweebyController.handleHeader('addCommon');\n\t};\n\n\tthis.onPremium = function () {\n\t\ttrackers.track('header:premiumBtn');\n\t\tweebyController.handleHeader('addPremium');\n\t};\n\n\tthis.onCurrencyChanged = function (commonCurrency, premiumCurrency) {\n\t\tthis._views.$commonText.setText(i18n.formatNumber(commonCurrency));\n\t\tthis._views.$premiumText.setText(i18n.formatNumber(premiumCurrency));\n\t};\n\n\tthis.onLevelChanged = function (level) {\n\t\tthis._views.$level.setText(level);\n\t};\n\n\tthis.animateXP = function(pct, time, levelUp) {\n\t\tvar clipper = this._views.$xpClipper;\n\t\tclipper.tick = this.boundUpdateXP;\n\n\t\tif (levelUp) {\n\t\t\t// fill to max, then start over with any extra\n\t\t\tanimate(clipper)\n\t\t\t.now({ width: FULL_WIDTH }, time / 3, animate.easeOut)\n\t\t\t.then({ width: EMPTY_WIDTH }, 0)\n\t\t\t.then({ width: EMPTY_WIDTH + pct * FILL_WIDTH }, 2 * time / 3, animate.easeOut)\n\t\t\t.then(bind(this, function() {\n\t\t\t\tclipper.tick = undefined;\n\t\t\t}));\n\t\t} else {\n\t\t\t// animate to pct\n\t\t\tanimate(clipper)\n\t\t\t.now({ width: EMPTY_WIDTH + pct * FILL_WIDTH }, time, animate.easeOut)\n\t\t\t.then(bind(this, function() {\n\t\t\t\tclipper.tick = undefined;\n\t\t\t}));\n\t\t}\n\n\t\t// save our current percentage\n\t\tthis._xpPct = pct;\n\t};\n\n\tthis.animateCommon = function(value, time) {\n\t\tthis._startingCommon = weebyLocalData.getCommonCurrency();\n\t\tthis._targetCommon = value;\n\t\tthis._startCommonTime = Date.now();\n\t\tthis._totalCommonTime = time;\n\n\t\tthis._views.$commonText.tick = this.boundUpdateCommon;\n\t\tsetTimeout(bind(this, function() {\n\t\t\tthis._views.$commonText.tick = undefined;\n\t\t\tthis._views.$commonText.setText(i18n.formatNumber(value));\n\t\t}), time);\n\t}\n\n\tthis.animatePremium = function(value, time) {\n\t\tthis._startingPremium = weebyLocalData.getPremiumCurrency();\n\t\tthis._targetPremium = value;\n\t\tthis._startPremiumTime = Date.now();\n\t\tthis._totalPremiumTime = time;\n\n\t\tthis._views.$premiumText.tick = this.boundUpdatePremium;\n\t\tsetTimeout(bind(this, function() {\n\t\t\tthis._views.$premiumText.tick = undefined;\n\t\t\tthis._views.$premiumText.setText(i18n.formatNumber(value));\n\t\t}), time);\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/components/ProfileIcon.js":{"path":"sdk/plugins/weeby/ui/components/ProfileIcon.js","friendlyPath":".ProfileIcon","directory":"sdk/plugins/weeby/ui/components/","filename":"ProfileIcon.js","src":"jsio(\"import ui.View\");\njsio(\"import ui.ImageView\");\njsio(\"import ..config\");\n\njsio(\"import ...weebyController\");\njsio(\"import ...weebyStates\");\n\nvar states = weebyStates.states;\n\nvar sdk_plugins_weeby_ui_components_ProfileIcon=__class__;exports=sdk_plugins_weeby_ui_components_ProfileIcon(function sdk_plugins_weeby_ui_components_ProfileIcon(){return this.init&&this.init.apply(this,arguments)},ui.View, function (supr) {\n\n\tvar DIM = 115;\n\n\tthis.init = function (opts) {\n\t\topts = merge({\n\t\t\t\t// overrides\n\t\t\t\twidth: DIM,\n\t\t\t\theight: DIM,\n\t\t\t\tx: 0,\n\t\t\t\ty: config.MAX_HEIGHT - DIM\n\t\t\t}, opts);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._clipper = new ui.View({\n\t\t\tsuperview: this,\n\t\t\tx: 0,\n\t\t\ty: 26,\n\t\t\twidth: 89,\n\t\t\theight: 89,\n\t\t\tclip: true\n\t\t});\n\n\t\tthis._userPhoto = new ui.ImageView({\n\t\t\tsuperview: this._clipper,\n\t\t\tx: 3,\n\t\t\ty: -9,\n\t\t\twidth: 90,\n\t\t\theight: 90\n\t\t});\n\n\t\tnew ui.ImageView({\n\t\t\tsuperview: this,\n\t\t\timage: config.IMAGE_DIR + 'frame_profile.png',\n\t\t\twidth: 115,\n\t\t\theight: 115,\n\t\t\tx: 0,\n\t\t\ty: 0\n\t\t});\n\n\t\tthis._userPhoto.setImage(weebyController.getUser().getPhotoImage());\n\t}\n\n\tthis.onInputSelect = function () {\n\t\tif (weebyController.getUser().isVerified()) {\n\t\t\tweebyController.showMyProfile();\n\t\t} else {\n\t\t\tweebyController.pushState(states.STATE_VERIFY);\n\t\t}\n\t}\n\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/GameResultViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/GameResultViewController.js","friendlyPath":".controllers.game.GameResultViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"GameResultViewController.js","src":"jsio(\"import animate\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.ParticleEngine as ParticleEngine\");\n\njsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ...config as uiConfig\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\nvar DELAY_INITIAL = 500,\n\tTIME_SCORE = 1500,\n\tRESULT_STEP_WAIT = 0,\n\tRESULT_STEP_COUNT = 1,\n\tRESULT_STEP_RANK = 2,\n\tRESULT_STEP_XP = 3,\n\tRESULT_STEP_LEVEL = 4,\n\tRESULT_STEP_FINISHED = 5,\n\tTIME_FLYING = 1000,\n\tZ_FLYIN_HIGH = 9999999;\n\nvar sdk_plugins_weeby_ui_controllers_game_GameResultViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_GameResultViewController(function sdk_plugins_weeby_ui_controllers_game_GameResultViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'GameResultViewController',\n\t\t\t\tlayout: '$gameResult'\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tvar themeConfig = weebyController.getThemeConfig();\n\n\t\tthis._views.$score.setCharacterData(themeConfig.RESULT_SCORE_CHARACTER_DATA);\n\n\t\tthis._views.$commonText.setText('+0');\n\t\tthis._views.$premiumText.setText('+0');\n\t\tthis._views.$xpText.setText('+0');\n\n\t\tthis._views.$bestScore.setText('0');\n\t\tthis._views.$score.setText('0');\n\t\tthis._views.$scoreBonus.setText('0');\n\n\t\tweebyController.on('GameResult', bind(this, 'onGameResult'));\n\t\tthis._views.$playButton.on('InputSelect', bind(this, 'onPlay'));\n\t\tthis._views.$close.on('InputSelect', bind(this, 'onClose'));\n\t\tthis._views.$mainContent.on('InputSelect', bind(this, 'skipAnimations'));\n\n\t\tthis.commonFlyer = new ImageView({\n\t\t\tsuperview: opts.superview,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tzIndex: Z_FLYIN_HIGH,\n\t\t\twidth: this._views.$commonIcon.style.width,\n\t\t\theight: this._views.$commonIcon.style.height,\n\t\t\timage: uiConfig.getThemeImageURL(\"icon_common.png\"),\n\t\t\tvisible: false,\n\t\t\tcanHandleEvents: false\n\t\t});\n\n\t\tthis.premiumFlyer = new ImageView({\n\t\t\tsuperview: opts.superview,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tzIndex: Z_FLYIN_HIGH,\n\t\t\twidth: this._views.$premiumIcon.style.width,\n\t\t\theight: this._views.$premiumIcon.style.height,\n\t\t\timage: uiConfig.getThemeImageURL(\"icon_premium.png\"),\n\t\t\tvisible: false,\n\t\t\tcanHandleEvents: false\n\t\t});\n\n\t\tthis.xpFlyer = new ImageView({\n\t\t\tsuperview: opts.superview,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tzIndex: Z_FLYIN_HIGH,\n\t\t\twidth: this._views.$xpIcon.style.width,\n\t\t\theight: this._views.$xpIcon.style.height,\n\t\t\timage: uiConfig.getThemeImageURL(\"icon_xp.png\"),\n\t\t\tvisible: false,\n\t\t\tcanHandleEvents: false\n\t\t});\n\n\t\tthis.pEngine = new ParticleEngine({\n\t\t\tsuperview: opts.superview,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 1,\n\t\t\theight: 1,\n\t\t\tinitCount: 50,\n\t\t\tinitImage: uiConfig.getThemeImageURL(\"icon_xp.png\")\n\t\t});\n\n\t\tthis.boundParticleTick = bind(this, function(dt) {\n\t\t\tvar cfs = this.commonFlyer.style,\n\t\t\t\tpfs = this.premiumFlyer.style,\n\t\t\t\txfs = this.xpFlyer.style;\n\n\t\t\tif (cfs.visible) {\n\t\t\t\tthis.trailParticle(cfs, uiConfig.getThemeImageURL(\"icon_common.png\"));\n\t\t\t}\n\n\t\t\tif (pfs.visible) {\n\t\t\t\tthis.trailParticle(pfs, uiConfig.getThemeImageURL(\"icon_premium.png\"));\n\t\t\t}\n\n\t\t\tif (xfs.visible) {\n\t\t\t\tthis.trailParticle(xfs, uiConfig.getThemeImageURL(\"icon_xp.png\"));\n\t\t\t}\n\n\t\t\tthis.pEngine.runTick(dt);\n\t\t});\n\n\t\t// handler for level up / rank up dialogs finishing\n\t\tweebyController.on('StatePopped', bind(this, function() {\n\t\t\tif (this._views.$gameResult.style.visible) {\n\t\t\t\tif (this.resultStep === RESULT_STEP_RANK) {\n\t\t\t\t\tthis.resultStep = RESULT_STEP_WAIT;\n\t\t\t\t\tsetTimeout(bind(this, 'startXPFlow'), DELAY_INITIAL);\n\t\t\t\t} else if (this.resultStep === RESULT_STEP_LEVEL) {\n\t\t\t\t\tsetTimeout(bind(this, 'finishGameResult'), DELAY_INITIAL);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\t// The view controller was created on demand, so fetch the game result manually and show it\n\t\tthis.onGameResult(weebyController.getGameResult());\n\t};\n\n\tthis.trailParticle = function(style, img) {\n\t\tvar random = Math.random,\n\t\t\tdata = this.pEngine.obtainParticleArray(1),\n\t\t\tpObj = data[0],\n\t\t\twidth = style.width,\n\t\t\theight = style.height,\n\t\t\tttl = 400,\n\t\t\tstop = -1000 / ttl;\n\n\t\tif (random() < 0.33) {\n\t\t\tpObj.image = uiConfig.getThemeImageURL(\"icon_flare.png\");\n\t\t} else {\n\t\t\tpObj.image = img;\n\t\t}\n\n\t\tpObj.x = style.x + (style.width - width) / 2;\n\t\tpObj.y = style.y + (style.height - height) / 2;\n\t\tpObj.r = 6.28 * random();\n\t\tpObj.anchorX = width / 2;\n\t\tpObj.anchorY = height / 2;\n\t\tpObj.dx = random() * 200 - 100;\n\t\tpObj.dy = random() * 200 - 100;\n\t\tpObj.dr = random() * 6.28 - 3.14;\n\t\tpObj.ddx = stop * pObj.dx;\n\t\tpObj.ddy = 600;\n\t\tpObj.ddr = stop * pObj.dr;\n\t\tpObj.width = width;\n\t\tpObj.height = height;\n\t\tpObj.scale = random() * 0.1 + 0.9;\n\t\tpObj.dscale = stop;\n\t\tpObj.ttl = ttl;\n\t\tthis.pEngine.emitParticles(data);\n\t};\n\n\tthis.onPlay = function () {\n\t\tif (this.resultStep && this.resultStep === RESULT_STEP_FINISHED) {\n\t\t\tthis.disableInput();\n\t\t\tweebyController.handleAction('play');\n\t\t} else {\n\t\t\tthis.skipAnimations();\n\t\t}\n\t};\n\n\tthis.onClose = function () {\n\t\tif (this.resultStep && this.resultStep === RESULT_STEP_FINISHED) {\n\t\t\tthis.disableInput();\n\t\t\tweebyController.handleAction('close');\n\t\t} else {\n\t\t\tthis.skipAnimations();\n\t\t}\n\t};\n\n\tthis.skipAnimations = function () {\n\t\tif (this.resultStep === RESULT_STEP_COUNT) {\n\t\t\tthis.finishScoreCount(true);\n\t\t} else if (this.resultStep === RESULT_STEP_XP) {\n\t\t\tanimate(this.commonFlyer).commit();\n\t\t\tanimate(this.premiumFlyer).commit();\n\t\t\tanimate(this.xpFlyer).commit();\n\t\t\tanimate(this.commonFlyer, 'scale').commit();\n\t\t\tanimate(this.premiumFlyer, 'scale').commit();\n\t\t\tanimate(this.xpFlyer, 'scale').commit();\n\t\t\tclearTimeout(this.xpTimeout);\n\t\t\tthis.finishXP();\n\t\t}\n\t};\n\n\tthis.finishScoreCount = function(skip) {\n\t\tthis._views.$score.setText(i18n.formatNumber(this._targetScore));\n\t\tthis._views.$mainContent.tick = undefined;\n\n\t\tif (skip) {\n\t\t\tif (this._gameResult.isRankUp) {\n\t\t\t\tthis.showRankUp();\n\t\t\t} else {\n\t\t\t\tthis.startXPFlow();\n\t\t\t}\n\t\t} else {\n\t\t\tsetTimeout(bind(this, function() {\n\t\t\t\tif (this._gameResult.isRankUp) {\n\t\t\t\t\tthis.showRankUp();\n\t\t\t\t} else {\n\t\t\t\t\tthis.startXPFlow();\n\t\t\t\t}\n\t\t\t}), DELAY_INITIAL);\n\t\t}\n\t};\n\n\tthis.showRankUp = function() {\n\t\tthis.resultStep = RESULT_STEP_RANK;\n\t\tweebyController.handleAction('showRankUp');\n\t};\n\n\tthis.startXPFlow = function() {\n\t\tthis.resultStep = RESULT_STEP_XP;\n\t\tthis._views.$mainContent.tick = this.boundParticleTick;\n\n\t\tvar bg = WeebyViewController.getHeader(),\n\t\t\thdrCommonIcon = bg._views.$commonIcon,\n\t\t\thdrPremiumIcon = bg._views.$premiumIcon,\n\t\t\thdrXpIcon = bg._views.$xpIcon;\n\n\t\t// animate common?\n\t\tvar parent = this.commonFlyer.getSuperview(),\n\t\t\tdelay = 0,\n\t\t\tcommonView = this._views.$commonIcon,\n\t\t\tcvs = commonView.style,\n\t\t\tcfs = this.commonFlyer.style;\n\t\tif (cvs.visible) {\n\t\t\tvar pos = commonView.getPosition(parent),\n\t\t\t\tfinalPos = hdrCommonIcon.getPosition(parent);\n\t\t\tcfs.x = pos.x;\n\t\t\tcfs.y = pos.y;\n\t\t\tcfs.anchorX = cvs.width / 2;\n\t\t\tcfs.anchorY = cvs.height / 2;\n\t\t\tcfs.width = cvs.width;\n\t\t\tcfs.height = cvs.height;\n\t\t\tcfs.scale = 1;\n\t\t\tcfs.visible = true;\n\n\t\t\tanimate(this.commonFlyer)\n\t\t\t.now({\n\t\t\t\tx: finalPos.x,\n\t\t\t\ty: finalPos.y,\n\t\t\t\twidth: hdrCommonIcon.style.width,\n\t\t\t\theight: hdrCommonIcon.style.height\n\t\t\t}, TIME_FLYING, animate.easeInOut)\n\t\t\t.then(bind(this, function() {\n\t\t\t\tcfs.visible = false;\n\t\t\t\tbg.animateCommon(this._gameResult.afterGame.commonCurrency, TIME_FLYING / 2);\n\t\t\t}));\n\n\t\t\tanimate(this.commonFlyer, 'scale')\n\t\t\t.now({ scale: 1.35 }, TIME_FLYING / 2, animate.easeOut)\n\t\t\t.then({ scale: 1 }, TIME_FLYING / 2, animate.easeIn);\n\n\t\t\tdelay += TIME_FLYING / 2;\n\t\t}\n\n\t\t// animate premium?\n\t\tvar premiumView = this._views.$premiumIcon,\n\t\t\tpvs = premiumView.style,\n\t\t\tpfs = this.premiumFlyer.style;\n\t\tif (pvs.visible) {\n\t\t\tvar pos = premiumView.getPosition(parent),\n\t\t\t\tfinalPos = hdrPremiumIcon.getPosition(parent);\n\t\t\tpfs.x = pos.x;\n\t\t\tpfs.y = pos.y;\n\t\t\tpfs.anchorX = pvs.width / 2;\n\t\t\tpfs.anchorY = pvs.height / 2;\n\t\t\tpfs.width = pvs.width;\n\t\t\tpfs.height = pvs.height;\n\t\t\tpfs.scale = 1;\n\n\t\t\tanimate(this.premiumFlyer)\n\t\t\t.wait(delay)\n\t\t\t.then(bind(this, function() {\n\t\t\t\tpfs.visible = true;\n\t\t\t}))\n\t\t\t.then({\n\t\t\t\tx: finalPos.x,\n\t\t\t\ty: finalPos.y,\n\t\t\t\twidth: hdrPremiumIcon.style.width,\n\t\t\t\theight: hdrPremiumIcon.style.height\n\t\t\t}, TIME_FLYING, animate.easeInOut)\n\t\t\t.then(bind(this, function() {\n\t\t\t\tpfs.visible = false;\n\t\t\t\tbg.animatePremium(this._gameResult.afterGame.premiumCurrency, TIME_FLYING / 2);\n\t\t\t}));\n\n\t\t\tanimate(this.premiumFlyer, 'scale')\n\t\t\t.wait(delay)\n\t\t\t.then({ scale: 1.35 }, TIME_FLYING / 2, animate.easeOut)\n\t\t\t.then({ scale: 1 }, TIME_FLYING / 2, animate.easeIn);\n\n\t\t\tdelay += TIME_FLYING / 2;\n\t\t}\n\n\t\t// animate xp?\n\t\tvar xpView = this._views.$xpIcon,\n\t\t\txvs = xpView.style,\n\t\t\txfs = this.xpFlyer.style,\n\t\t\txpEarned = this._gameResult.afterGame.xp - this._gameResult.beforeGame.xp;\n\t\tif (xvs.visible && xpEarned > 0) {\n\t\t\tvar pos = xpView.getPosition(parent),\n\t\t\t\tfinalPos = hdrXpIcon.getPosition(parent);\n\t\t\txfs.x = pos.x;\n\t\t\txfs.y = pos.y;\n\t\t\txfs.anchorX = xvs.width / 2;\n\t\t\txfs.anchorY = xvs.height / 2;\n\t\t\txfs.width = xvs.width;\n\t\t\txfs.height = xvs.height;\n\t\t\txfs.scale = 1;\n\n\t\t\tanimate(this.xpFlyer)\n\t\t\t.wait(delay)\n\t\t\t.then(bind(this, function() {\n\t\t\t\txfs.visible = true;\n\t\t\t}))\n\t\t\t.then({\n\t\t\t\tx: finalPos.x,\n\t\t\t\ty: finalPos.y,\n\t\t\t\twidth: hdrXpIcon.style.width,\n\t\t\t\theight: hdrXpIcon.style.height\n\t\t\t}, TIME_FLYING, animate.easeInOut)\n\t\t\t.then(bind(this, function() {\n\t\t\t\t// animate xp bar\n\t\t\t\tvar level = this._gameResult.beforeGame.level,\n\t\t\t\t\txpBase = this._gameResult.getXPForLevel(level),\n\t\t\t\t\txpThreshold = this._gameResult.getXPForLevel(level + 1),\n\t\t\t\t\txpFinal = this._gameResult.afterGame.xp;\n\n\t\t\t\tif (xpFinal >= xpThreshold) {\n\t\t\t\t\tvar xpNextThreshold = this._gameResult.getXPForLevel(level + 2),\n\t\t\t\t\t\tpct = (xpFinal - xpThreshold) / (xpNextThreshold - xpThreshold);\n\t\t\t\t\tbg.animateXP(pct, TIME_FLYING / 2, true);\n\t\t\t\t} else {\n\t\t\t\t\tvar pct = (xpFinal - xpBase) / (xpThreshold - xpBase);\n\t\t\t\t\tbg.animateXP(pct, TIME_FLYING / 2, false);\n\t\t\t\t}\n\n\t\t\t\txfs.visible = false;\n\t\t\t}));\n\n\t\t\tanimate(this.xpFlyer, 'scale')\n\t\t\t.wait(delay)\n\t\t\t.then({ scale: 1.35 }, TIME_FLYING / 2, animate.easeOut)\n\t\t\t.then({ scale: 1 }, TIME_FLYING / 2, animate.easeIn);\n\t\t}\n\n\t\tthis.xpTimeout = setTimeout(bind(this, function() {\n\t\t\tthis.finishXP();\n\t\t}), delay + TIME_FLYING + DELAY_INITIAL);\n\t};\n\n\tthis.finishXP = function() {\n\t\tthis.xpTimeout = undefined;\n\t\tthis._views.$mainContent.tick = undefined;\n\t\tthis.pEngine.killAllParticles();\n\n\t\t// Award currency\n\t\tif(this._gameResult.data.currency.common) {\n\t\t\tweebyLocalData.addCommonCurrency(this._gameResult.data.currency.common)\n\t\t}\n\t\tif(this._gameResult.data.currency.premium) {\n\t\t\tweebyLocalData.addPremiumCurrency(this._gameResult.data.currency.premium)\n\t\t}\n\n\t\tif (this._gameResult.isLevelUp) {\n\t\t\tthis.showLevelUp();\n\t\t} else {\n\t\t\tthis.finishGameResult();\n\t\t}\n\t};\n\n\tthis.showLevelUp = function() {\n\t\tthis.resultStep = RESULT_STEP_LEVEL;\n\t\tweebyController.handleAction('showLevelUp');\n\t};\n\n\tthis.finishGameResult = function() {\n\t\tif (this.resultStep != RESULT_STEP_FINISHED) {\n\t\t\tvar playBtn = this._views.$playButton;\n\t\t\tvar closeBtn = this._views.$close;\n\n\t\t\t// Hide the play/close buttons and make sure their anchor point is at their center\n\t\t\tplayBtn.style.visible = true;\n\t\t\tplayBtn.style.scale = 0;\n\t\t\tplayBtn.style.anchorX = playBtn.style.width / 2;\n\t\t\tplayBtn.style.anchorY = playBtn.style.height / 2;\n\n\t\t\tcloseBtn.style.visible = true;\n\t\t\tcloseBtn.style.scale = 0;\n\t\t\tcloseBtn.style.anchorX = closeBtn.style.width / 2;\n\t\t\tcloseBtn.style.anchorY = closeBtn.style.height / 2;\n\n\t\t\t// Add a quick scale up/overshoot animation to the play/close buttons\n\t\t\tvar upTime = 300;\n\t\t\tvar downTime = 150;\n\t\t\tvar bigScale = 1.1;\n\n\t\t\tanimate(playBtn).now({\n\t\t\t\tscale: bigScale\n\t\t\t}, upTime, animate.easeInOut).then({\n\t\t\t\tscale: 1\t\n\t\t\t}, downTime, animate.easeIn);\n\n\t\t\tanimate(closeBtn).now({\n\t\t\t\tscale: bigScale\n\t\t\t}, upTime, animate.easeInOut).then({\n\t\t\t\tscale: 1\t\n\t\t\t}, downTime, animate.easeIn);\n\n\t\t\tthis.resultStep = RESULT_STEP_FINISHED;\n\t\t}\n\t};\n\n\tthis.onGameResult = function (gameResult) {\n\t\tthis.resultStep = RESULT_STEP_WAIT;\n\t\tthis._gameResult = gameResult;\n\n\t\tif (gameResult) {\n\t\t\tif (gameResult.beforeGame.weeklyHighScore >= gameResult.score.total) {\n\t\t\t\tthis._views.$bestScore.setText(i18n.get(\"bestScore\")\n\t\t\t\t\t+ i18n.formatNumber(gameResult.beforeGame.weeklyHighScore));\n\t\t\t} else {\n\t\t\t\tthis._views.$bestScore.setText(i18n.get(\"newHighScore\"));\n\t\t\t}\n\n\t\t\tthis._targetScore = gameResult.score.total;\n\t\t\tthis._scoreTimer = TIME_SCORE;\n\n\t\t\tthis._views.$score.setText(0);\n\t\t\tthis._views.$scoreBonus.setText(i18n.get(\"scoreBonus\")\n\t\t\t\t+ i18n.formatNumber(gameResult.score.bonus));\n\n\t\t\tvar currency = gameResult.data.currency,\n\t\t\t\tcommonEarned = 0,\n\t\t\t\tpremiumEarned = 0;\n\t\t\tif(currency) {\n\t\t\t\t\n\t\t\t\t// Deduct spent currency\n\t\t\t\tif(currency.commonSpent) {\n\t\t\t\t\tweebyLocalData.useCommonCurrency(currency.commonSpent);\n\t\t\t\t}\n\t\t\t\tif(currency.premiumSpent) {\n\t\t\t\t\tweebyLocalData.usePremiumCurrency(currency.premiumSpent);\n\t\t\t\t}\n\n\t\t\t\tcommonEarned = gameResult.data.currency.common;\n\t\t\t\tpremiumEarned = gameResult.data.currency.premium;\n\t\t\t\t\n\t\t\t}\n\n\t\t\tvar xpEarned = gameResult.afterGame.xp - gameResult.beforeGame.xp;\n\n\t\t\tvar cis = this._views.$commonIcon.style,\n\t\t\t\tcts = this._views.$commonText.style,\n\t\t\t\tpis = this._views.$premiumIcon.style,\n\t\t\t\tpts = this._views.$premiumText.style,\n\t\t\t\txis = this._views.$xpIcon.style,\n\t\t\t\txts = this._views.$xpText.style;\n\n\t\t\tvar numVisible = 1;\n\t\t\tif (commonEarned) {\n\t\t\t\tnumVisible++;\n\t\t\t\tcts.visible = true;\n\t\t\t\tcis.visible = true;\n\t\t\t\tthis._views.$commonText.setText(\"+\" + commonEarned);\n\t\t\t} else {\n\t\t\t\tcts.visible = false;\n\t\t\t\tcis.visible = false;\n\t\t\t}\n\n\t\t\tif (premiumEarned) {\n\t\t\t\tnumVisible++;\n\t\t\t\tpts.visible = true;\n\t\t\t\tpis.visible = true;\n\t\t\t\tthis._views.$premiumText.setText(\"+\" + premiumEarned);\n\t\t\t} else {\n\t\t\t\tpts.visible = false;\n\t\t\t\tpis.visible = false;\n\t\t\t}\n\n\t\t\tthis._views.$xpText.setText(\"+\" + xpEarned);\n\n\t\t\t// center the icons and text based on visibility\n\t\t\tvar totalHeight = this._views.$currencyFrame.style.height;\n\t\t\tif (numVisible === 3) {\n\t\t\t\tvar ispacing = totalHeight / 4,\n\t\t\t\t\ttspacing = totalHeight / 4;\n\n\t\t\t\tcis.y = ispacing - cis.height / 2;\n\t\t\t\tcts.y = tspacing - cts.height / 2;\n\t\t\t\tpis.y = 2 * ispacing - pis.height / 2;\n\t\t\t\tpts.y = 2 * tspacing - pts.height / 2;\n\t\t\t\txis.y = 3 * ispacing - xis.height / 2;\n\t\t\t\txts.y = 3 * tspacing - xts.height / 2;\n\t\t\t} else if (numVisible === 2) {\n\t\t\t\tif (commonEarned) {\n\t\t\t\t\tvar ispacing = totalHeight / 3,\n\t\t\t\t\t\ttspacing = totalHeight / 3;\n\n\t\t\t\t\tcis.y = ispacing - cis.height / 2;\n\t\t\t\t\tcts.y = tspacing - cts.height / 2;\n\t\t\t\t\txis.y = 2 * ispacing - xis.height / 2;\n\t\t\t\t\txts.y = 2 * tspacing - xts.height / 2;\n\t\t\t\t} else {\n\t\t\t\t\t// premium earned\n\t\t\t\t\tvar ispacing = totalHeight / 3,\n\t\t\t\t\t\ttspacing = totalHeight / 3;\n\n\t\t\t\t\tpis.y = ispacing - pis.height / 2;\n\t\t\t\t\tpts.y = tspacing - pts.height / 2;\n\t\t\t\t\txis.y = 2 * ispacing - xis.height / 2;\n\t\t\t\t\txts.y = 2 * tspacing - xts.height / 2;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\txis.y = (totalHeight - xis.height) / 2;\n\t\t\t\txts.y = (totalHeight - xts.height) / 2;\n\t\t\t}\n\n\t\t\t// hide the close and play buttons until animations are finished\n\t\t\tthis._views.$playButton.style.visible = false;\n\t\t\tthis._views.$close.style.visible = false;\n\n\t\t\t// delay animations\n\t\t\tsetTimeout(bind(this, function() {\n\t\t\t\tthis.resultStep = RESULT_STEP_COUNT;\n\n\t\t\t\t// increment score\n\t\t\t\tthis._views.$mainContent.tick = bind(this, function(dt) {\n\t\t\t\t\tthis._scoreTimer -= dt;\n\t\t\t\t\tif (this._scoreTimer <= 0) {\n\t\t\t\t\t\tthis.finishScoreCount(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar pct = 1 - this._scoreTimer / TIME_SCORE;\n\t\t\t\t\t\tthis._views.$score.setText(i18n.formatNumber(~~(pct * this._targetScore)));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}), DELAY_INITIAL);\n\t\t}\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/ConfirmFriendsViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/ConfirmFriendsViewController.js","friendlyPath":".controllers.game.ConfirmFriendsViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"ConfirmFriendsViewController.js","src":"jsio(\"import ui.widget.ListView as ListView\");\njsio(\"import ui.widget.CellView as CellView\");\n\njsio(\"import ...components.WeebyListViewController as WeebyListViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_controllers_game_ConfirmFriendsViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_ConfirmFriendsViewController(function sdk_plugins_weeby_ui_controllers_game_ConfirmFriendsViewController(){return this.init&&this.init.apply(this,arguments)},WeebyListViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tstatus: true,\n\t\t\t\tlayout: '$confirmfriends',\n\t\t\t\toverrideCtors: {\n\t\t\t\t\t$rows: ListView,\n\t\t\t\t\t$row: CellView\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tsupr(this, 'init', [opts]);\n\n\t\tif (!this._views.$rows) {\n\t\t\tthrow new Error('$row is required and was not defined');\n\t\t}\n\n\t\tthis._views.$rows.updateOpts({\n\t\t\tgetCell: bind(this, 'getCell'),\n\t\t\tdataSource: this._listData,\n\t\t\tisFixedSize: true,\n\t\t\tscrollX: false,\n\t\t\trecycle: true\n\t\t});\n\n\t\tthis._addEvent('$acceptButton', 'InputSelect', bind(this, 'onAccept'), true);\n\t};\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\t\treturn root;\n\t};\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tvar views = viewStates.views;\n\n\t\tviews.$nickname.setText(data.name);\n\t\tviews.$icon.setImage(weebyController.getSocial().getPhotoImage(data.id));\n\t\tviews.$icon.on('InputSelect', bind(this, 'onSelectFriendPhoto', viewStates, data));\n\t\tviews.$acceptButton.on('InputSelect', bind(this, 'onSelectFriend', viewStates, data));\n\n\t\tif (data.selected) {\n\t\t\tviewStates.addState('$acceptButton', 'checked');\n\t\t} else {\n\t\t\tviewStates.removeState('$acceptButton', 'checked');\n\t\t}\n\t};\n\n\tthis.onSelectFriend = function (viewStates, data) {\n\t\tvar views = viewStates.views;\n\t\tconsole.log('select');\n\t\tif (data.selected) {\n\t\t\tdata.selected = false;\n\t\t\tviewStates.removeState('$acceptButton', 'checked');\n\t\t\ttrackers.track('newFriends:uncheck');\n\t\t} else {\n\t\t\tdata.selected = true;\n\t\t\tviewStates.addState('$acceptButton', 'checked');\n\t\t\ttrackers.track('newFriends:check');\n\t\t}\n\t};\n\n\tthis.onSelectFriendPhoto = function (viewStates, data) {\n\t\ttrackers.track('newFriends:viewProfile', {userId: data.id, isMe: false});\n\t\tweebyController.handleAction('viewFriendProfile', {user: data});\n\t};\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\n\t\tthis._listData.clear();\n\t\tthis._listData.key = 'index';\n\n\t\tvar list = weebyController.getUser().getUnconfirmedFriends();\n\t\tvar i = list.length;\n\t\twhile (i) {\n\t\t\tvar item = list[--i];\n\t\t\tthis._listData.add({\n\t\t\t\tindex: item.created + '_' + item.id,\n\t\t\t\tname: item.nickname || item.name,\n\t\t\t\timage: item.image,\n\t\t\t\tid: item.id,\n\t\t\t\tselected: true\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.onAccept = function () {\n\t\ttrackers.track('newFriends:confirmBtn');\n\t\tthis.disableInput();\n\n\t\tvar acceptedFriends = [];\n\t\tvar blockedFriends = [];\n\t\tthis._listData.forEach(function (item) {\n\t\t\tif (item.selected) {\n\t\t\t\tacceptedFriends.push(item.id);\n\t\t\t} else {\n\t\t\t\tblockedFriends.push(item.id);\n\t\t\t}\n\t\t});\n\n\t\tweebyController.handleAction(\n\t\t\t'accept',\n\t\t\t{\n\t\t\t\tacceptedFriends: acceptedFriends,\n\t\t\t\tblockedFriends: blockedFriends\n\t\t\t}\n\t\t);\n\t};\n});\n\nif (DEBUG) {\n\tvar DEBUG_DATA = {};\n}","pre":true},"sdk/plugins/weeby/ui/controllers/game/LadderViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/LadderViewController.js","friendlyPath":".controllers.game.LadderViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"LadderViewController.js","src":"jsio(\"import device\");\njsio(\"import ui.widget.ListView as ListView\");\njsio(\"import ui.widget.CellView as CellView\");\njsio(\"import ui.View as View\");\n\njsio(\"import ...components.WeebyListViewController as WeebyListViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....i18n\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\n\nvar UPLOAD_CONTACT_INTERVAL_HOURS = 6;\n\nvar sdk_plugins_weeby_ui_controllers_game_LadderViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_LadderViewController(function sdk_plugins_weeby_ui_controllers_game_LadderViewController(){return this.init&&this.init.apply(this,arguments)},WeebyListViewController, function (supr) {\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\t\tstatus: true,\n\t\t\t\tlayout: '$ladder',\n\t\t\t\toverrideCtors: {\n\t\t\t\t\t$rows: ListView,\n\t\t\t\t\t$row: CellView,\n\t\t\t\t\t$nickname: 'text',\n\t\t\t\t\t$icon: 'image'\n\t\t\t\t}\n\t\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tif (!this._views.$rows) {\n\t\t\tthrow new Error('$row is required and was not defined');\n\t\t}\n\n\t\tvar ladder = weebyController.getLadder();\n\n\t\tthis._views.$rows.updateOpts({\n\t\t\tgetCell: bind(this, 'getCell'),\n\t\t\tdataSource: ladder.getList(),\n\t\t\tisFixedSize: true,\n\t\t\tscrollX: false,\n\t\t\trecycle: true\n\t\t});\n\n\t\tthis.onGiftsUpdated();\n\t\tweebyController.on('GiftsUpdated', bind(this, 'onGiftsUpdated'));\n\n\t\tthis._addEvent('$playButton', 'InputSelect', bind(this, 'onPlay'), true);\n\t\tthis._addEvent('$giftsButton', 'InputSelect', bind(this, 'onButtonInbox'), true);\n\t\tthis._addEvent('$settingsButton', 'InputSelect', bind(this, 'onButtonSettings'), true);\n\t\tthis._addEvent('$loginButton', 'InputSelect', bind(this, 'onButtonLogin'), true);\n\t\t\n\t\t// If the time till next life frame exists bind the click event to it rather than the button\n\t\t// so it is easier to click\n\t\tif (this._views.$timeTillNextLife) {\n\t\t\tthis._addEvent('$timeTillNextLife', 'InputSelect', bind(this, 'onButtonAddLives'), true);\n\t\t} else {\n\t\t\tthis._addEvent('$buyLivesButton', 'InputSelect', bind(this, 'onButtonAddLives'), true);\n\t\t}\n\n\t\tweebyLocalData.on('LifeChanged', bind(this, 'onLifeChanged'));\n\n\t\tvar user = weebyController.getUser();\n\t\tthis._userID = user.getID();\n\n\t\tuser.on('updated', bind(this, 'onUserUpdated'));\n\t\tuser.on('contactsAccessChanged', bind(this, 'onUserUpdated'));\n\n\t\tsetInterval(bind(this, 'onUpdateTime'), 1000);\n\t\tthis._views.$installButtonFullCrosspromo.subscribe('InputSelect', this, 'onCrosspromoSelect');\n\t\tthis._views.$gameIconFullCrosspromo.subscribe('InputSelect', this, 'onCrosspromoSelect');\n\t};\n\n\tthis._updateFooter = function () {\n\t\tvar iosView = null;\n\t\tvar crosspromoView = null;\n\t\tvar user = weebyController.getUser();\n\t\t// if we don't have access yet and we cannot request it from the user, make them go to settings\n\t\tif (user.isVerified() && !user.hasContactsAccess() && !user.canRequestContactsAccess()) {\n\t\t\tif (!this._iosSettingsView) {\n\t\t\t\tvar views = this.inflate('$iosSettings').views;\n\t\t\t\tthis._iosSettingsView = views.$iosSettings;\n\t\t\t\tviews.$description.setText(i18n.get('iosMustEnableContacts', {'this game': CONFIG.title}));\n\t\t\t\tthis._iosSettingsView.subscribe('InputSelect', this, 'onIOSFooterSelect');\n\t\t\t}\n\n\t\t\tiosView = this._iosSettingsView;\n\t\t} else if (user.isVerified() && user.canRequestContactsAccess()) {\n\t\t\tif (!this._iosSyncContactsView) {\n\t\t\t\tthis._iosSyncContactsView = this.inflate('$iosSyncContacts').views.$iosSyncContacts;\n\t\t\t\tthis._iosSyncContactsView.subscribe('InputSelect', this, 'onIOSFooterSelect');\n\t\t\t}\n\t\t\t\n\t\t\tiosView = this._iosSyncContactsView;\n\t\t}\n\n\t\tvar bucket = weebyLocalData.getCrosspromoBucket() && weebyLocalData.getCrosspromoBucket().bucket;\n\n\t\tif (this._crosspromo && (bucket == 'ladderrow1' || bucket == 'ladderrow2')) {\n\t\t\tcrosspromo = this._crosspromo;\n\t\t\t\n\t\t\tif (!this._crosspromoView) {\n\t\t\t\tthis._crosspromoView = this.inflate('$crosspromoRow');\n\t\t\t\tthis._crosspromoView.views.$crosspromoRow.subscribe('InputSelect', this, 'onCrosspromoSelect');\n\t\t\t}\n\n\t\t\tvar premium = weebyController.getWeebyConfig().getCurrencies().premium;\n\n\t\t\tif (bucket == 'ladderrow1') {\n\t\t\t\tthis._crosspromoView.views.$gameIcon.setImage(crosspromo.app.images.iconSmall);\n\t\t\t\tthis._crosspromoView.views.$gameTitle.setText(i18n.get(\"crosspromoMessage\").replace('{game}', crosspromo.app.localizedName || crosspromo.app.name));\n\t\t\t\n\t\t\t\t//Show reward on Android, but not on iOS\n\t\t\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\t\t\tthis._crosspromoView.views.$rewardIcon.setImage(premium.iconUrl);\n\t\t\t\t\tthis._crosspromoView.views.$rewardAmount.setText('+' + crosspromo.rewardAmount);\n\t\t\t\t} else {\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.style.x = 110;\n\t\t\t\t\tthis._crosspromoView.views.$rowTitle.style.x = 110;\n\t\t\t\t\tthis._crosspromoView.views.$rewardIcon.style.x = 380;\n\t\t\t\t\t\n\t\t\t\t\tthis._crosspromoView.views.$rewardIcon.setImage(crosspromo.app.images.iconSmall);\n\t\t\t\t\tthis._crosspromoView.views.$rewardAmount.style.visible = false;\n\t\t\t\t}\n\t\t\t} else if (bucket == 'ladderrow2') {\n\t\t\t\t//Show reward on Android, but not on iOS\n\t\t\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\t\t\tthis._crosspromoView.views.$rewardIcon.style.x = 380;\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.style.x = 110;\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.style.y = 28;\n\t\t\t\t\tthis._crosspromoView.views.$rowTitle.style.visible = false;\n\t\t\t\t\tthis._crosspromoView.views.$gameIcon.setImage(premium.iconUrl);\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.setText(i18n.get(\"getPremiumReward\").replace('{amount}', crosspromo.rewardAmount).replace('{premium}', premium.displayName));\n\t\t\t\t\tthis._crosspromoView.views.$rewardAmount.style.visible = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis._crosspromoView.views.$gameIcon.style.visible = false;\n\t\t\t\t\tthis._crosspromoView.views.$rowTitle.style.visible = false;\n\t\t\t\t\tthis._crosspromoView.views.$rewardIcon.style.x = 380;\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.style.x = 70;\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.style.y = 28;\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.style.width = 280;\n\t\t\t\t\tthis._crosspromoView.views.$gameTitle.setText(i18n.get(\"crosspromoRowTitle\") + ' ' + i18n.get(\"crosspromoMessage\").replace('{game}', crosspromo.app.localizedName || crosspromo.app.name));\n\t\t\t\n\t\t\t\t\tthis._crosspromoView.views.$rewardIcon.setImage(crosspromo.app.images.iconSmall);\n\t\t\t\t\tthis._crosspromoView.views.$rewardAmount.style.visible = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t\n\n\t\t\tcrosspromoView = this._crosspromoView;\n\t\t}\n\n\t\tvar footerView = null;\n\t\tif (crosspromoView) {\n\t\t\t// create footerView\n\t\t\tfooterView = new View();\n\t\t\tfooterView.style.height = 0;\n\t\t\tfooterView.style.width = this._crosspromoView.views.$crosspromoRow.style.width;\n\n\t\t\t// Add crosspromoView as first child\n\t\t\tthis._crosspromoView.views.$crosspromoRow.style.y = footerView.style.height;\n\t\t\tfooterView.addSubview(crosspromoView.views.$crosspromoRow);\n\t\t\tfooterView.style.height += this._crosspromoView.views.$crosspromoRow.style.height;\n\t\t}\n\n\t\tif (iosView) {\n\t\t\t// create footerView if not created\n\t\t\tif (!footerView) {\n\t\t\t\tfooterView = new View();\n\t\t\t\tfooterView.style.height = 0;\n\t\t\t\tfooterView.style.width = iosView.style.width;\n\t\t\t}\n\n\t\t\t// Add crosspromoView as fisrt/next child\n\t\t\tiosView.style.y = footerView.style.height;\n\t\t\tfooterView.addSubview(iosView);\n\t\t\tfooterView.style.height += iosView.style.height;\n\t\t}\n\n\t\tthis._views.$rows.setFooterView(footerView);\n\t}\n\n\tthis._trackCrosspromo = function (name, item) {\n\t\ttrackers.track(\n\t\t\tname, \n\t\t\titem\n\t\t);\n\t};\n\n\tthis.onGiftsUpdated = function () {\n\t\tvar numGifts = weebyController.getReceivedGifts().length;\n\n\t\tthis._views.$giftNotifications.style.visible = numGifts > 0;\n\t\tthis._views.$giftCount.setText(numGifts);\n\t};\n\n\tthis.onLifeChanged = function (life) {\n\t\tthis.showLife();\n\t};\n\n\tvar MINUTE = 1000 * 60;\n\tvar HOUR = MINUTE * 60;\n\tvar DAY = HOUR * 24;\n\n\tthis.onUpdateTime = function () {\n\t\tif (this._view.style.visible) {\n\t\t\tvar replayTime = weebyLocalData.updateLifeRegen();\n\n\t\t\tvar numLives = weebyLocalData.getLife();\n\t\t\tif (numLives >= 5) {\n\t\t\t\tthis._views.$time.setText(i18n.get('max').toUpperCase());\n\t\t\t} else {\n\t\t\t\tthis._views.$time.setText(replayTime.min + ':' + ('00' + replayTime.sec).substr(-2));\n\t\t\t}\n\n\t\t\tif (this._views.$extraLives) {\n\t\t\t\tthis._views.$extraLives.setText('+' + Math.max(0, numLives - 5));\n\t\t\t}\n\n\t\t\tif (this._views.$resetCountdown) {\n\t\t\t\tvar ladder = weebyController.getLadder();\n\t\t\t\tvar expiration = ladder.getExpiration();\n\t\t\t\tthis._views.$resetCountdown.style.visible = !!expiration;\n\t\t\t\tif (expiration) {\n\t\t\t\t\tvar remaining = (expiration - Date.now());\n\t\t\t\t\tif (remaining >= 0) {\n\t\t\t\t\t\tvar days = Math.floor(remaining / DAY);\n\t\t\t\t\t\tvar hours = Math.floor((remaining - days * DAY) / HOUR);\n\t\t\t\t\t\tvar minutes = Math.floor((remaining - days * DAY - hours * HOUR) / MINUTE);\n\n\t\t\t\t\t\tthis._views.$day.setText(days);\n\t\t\t\t\t\tthis._views.$hour.setText(hours);\n\t\t\t\t\t\tthis._views.$min.setText(minutes);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\n\tvar _lastSync = null;\n\t\n\tthis.onUserUpdated = function () {\n\t\tthis.refresh();\n\t}\n\n\tthis.onShow = function () {\n\t\tthis.refresh();\n\t}\n\n\tthis.refresh = function () {\n\t\tvar user = weebyController.getUser();\n\t\tthis._userID = user.getID();\n\n\t\tvar isVerified = user.isVerified();\n\t\tthis._views.$disabledOverlay.style.visible = !isVerified;\n\t\tthis._views.$loginUpsell.style.visible = !isVerified;\n\n\t\t// trigger update of footer cell in case contacts access has changed\n\t\tthis._updateFooter();\n\t};\n\n\tthis.onSendHeart = function (viewStates, evt) {\n\t\tvar data = viewStates.data;\n\t\tevt.cancel();\n\t\n\t\tif (weebyController.isOffline()) {\n\t\t\tGC.app.weebyRootView.showDialog('offline');\n\t\t} else {\n\t\t\ttrackers.track('leaderboard:sendGift', {userId: data.user.id});\n\t\t\tthis._sentHearts[data.id] = Date.now() + 24 * 60 * 60 * 1000;\n\t\t\tweebyLocalData.setSentHearts(this._sentHearts);\n\t\t\tweebyController.sendGiftToUserID(\n\t\t\t\tdata.id,\n\t\t\t\tfunction (error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\ttrackers.track('leaderboard:sendGift:fail', {userId: data.user.id});\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttrackers.track('leaderboard:sendGift:success', {userId: data.user.id});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tviewStates.views.$iconSent.style.visible = true;\n\t\t\tviewStates.addState('$sendHeartButton', 'sent');\n\t\t}\n\t};\n\n\tthis.onPlay = function () {\n\t\ttrackers.track('leaderboard:playBtn:showEquip');\n\t\tweebyController.handleAction('play');\n\t};\n\n\tthis.onCounter = function () {\n\t\tconsole.log('Counter clicked');\n\t};\n\n\tthis.onButtonLogin = function () {\n\t\tweebyController.handleAction('login');\n\t};\n\n\tthis.onButtonInbox = function () {\n\t\tweebyController.handleAction('gift');\n\t};\n\n\tthis.onButtonSettings = function () {\n\t\tweebyController.handleAction('settings');\n\t};\n\n\tthis.onButtonAddLives = function () {\n\t\tweebyController.handleAction('addLives');\n\t};\n\n\tthis.onIconSent = function (evt) {\n\t\tevt.cancel();\n\t};\n\n\tthis.onIOSFooterSelect = function (viewStates) {\n\t\tvar user = weebyController.getUser();\n\t\tvar gotoSettings = !user.hasContactsAccess() && !user.canRequestContactsAccess();\n\t\tif (gotoSettings) {\n\t\t\talert(i18n.get(\"iosMustEnableContacts\", {\"this game\": CONFIG.title}));\n\t\t} else {\n\t\t\tuser.syncContacts();\n\t\t}\n\t}\n\n\tthis.onCrosspromoSelect = function (viewStates) {\n\t\tthis._views.$ladderCrosspromo.style.visible = false;\n\t\tweebyController.crosspromoManager.onInstall(this._crosspromo);\n\t\tthis._trackCrosspromo(\"crosspromo:click\", this._crosspromo.referrer);\n\t\tweebyController.showAppStore(this._crosspromo);\n\t}\n\n\tthis.onRowSelect = function (viewStates) {\n\t\tvar data = viewStates.data;\n\t\tif (weebyController.isOffline()) {\n\t\t\tGC.app.weebyRootView.showDialog('offline');\n\t\t\ttrackers.track('leaderboard:viewProfile:noInternet');\n\t\t} else {\n\t\t\tif (data.user.id === weebyController.getUser().getID()) {\n\t\t\t\tweebyController.showMyProfile();\n\t\t\t\ttrackers.track('leaderboard:viewProfile', {userId: data.user.id, isMe: true});\n\t\t\t} else {\n\t\t\t\ttrackers.track('leaderboard:viewProfile', {userId: data.user.id, isMe: false});\n\t\t\t\tweebyController.handleAction('viewFriendProfile', {user: data.user});\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\n\t\tviewStates.views.$row.onInputSelect = bind(this, 'onRowSelect', viewStates);\n\t\tviewStates.views.$sendHeartButton.onInputSelect = bind(this, 'onSendHeart', viewStates);\n\t\tviewStates.views.$iconSent.onInputSelect = bind(this, 'onIconSent');\n\n\t\treturn root;\n\t};\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tvar views = viewStates.views;\n\n\t\tviewStates.data = data;\n\n\t\tvar themeConfig = weebyController.getThemeConfig();\n\n\t\tif (!views.$score.charDataSet) {\n\t\t\tviews.$score.charDataSet = true;\n\t\t\tviews.$score.setCharacterData(themeConfig.LEADERBOARD_SCORE_CHARACTER_DATA);\n\t\t}\n\n\t\tif (!views.$rank.charDataSet) {\n\t\t\tviews.$rank.charDataSet = true;\n\t\t\tviews.$rank.setCharacterData(themeConfig.LEADERBOARD_RANK_CHARACTER_DATA);\n\t\t}\n\n\t\tvar isMe = data.id == this._userID;\n\t\tvar name = data.name;\n\t\tif (!name && isMe) {\n\t\t\tname = i18n.get('me');\n\t\t}\n\n\t\tviews.$nickname.setText(name);\n\t\tviews.$icon.setImage(weebyController.getSocial().getPhotoImage(data.id));\n\n\t\tviewStates.removeState('$row', 'footer');\n\t\t\n\t\tviews.$score.setText(i18n.formatNumber(data.score));\n\n\t\tif (data.rank <= 3) {\n\t\t\tviews.$rank.style.visible = false;\n\t\t\tviews.$rankImage.style.visible = true;\n\t\t\tviewStates.removeState('$row', 'rank1');\n\t\t\tviewStates.removeState('$row', 'rank2');\n\t\t\tviewStates.removeState('$row', 'rank3');\n\t\t\tviewStates.addState('$row', 'rank' + data.rank);\n\t\t} else {\n\t\t\tviews.$rankImage.style.visible = false;\n\t\t\tviews.$rank.style.visible = true;\n\t\t\tviews.$rank.setText(data.rank);\n\t\t}\n\n\t\tif (data.user.id === this._userID) {\n\t\t\tif (views.$sendHeartButton) {\n\t\t\t\tviews.$sendHeartButton.style.visible = false;\n\t\t\t}\n\t\t\tif (views.$iconSent) {\n\t\t\t\tviews.$iconSent.style.visible = false;\n\t\t\t}\n\t\t} else if (this._sentHearts[data.id] && (this._sentHearts[data.id] > Date.now())) {\n\t\t\tviewStates.removeState('$sendHeartButton', 'enabled');\n\t\t\tviewStates.addState('$sendHeartButton', 'sent');\n\t\t\t\n\t\t\tif (views.$iconSent) {\n\t\t\t\tviews.$iconSent.style.visible = true;\n\t\t\t}\n\t\t} else {\n\t\t\tviewStates.addState('$sendHeartButton', 'enabled');\n\t\t\tviewStates.removeState('$sendHeartButton', 'sent');\n\t\t\t\n\t\t\tif (views.$sendHeartButton) {\n\t\t\t\tviews.$sendHeartButton.style.visible = true;\n\t\t\t}\n\n\t\t\tif (views.$iconSent) {\n\t\t\t\tviews.$iconSent.style.visible = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.showLife = function () {\n\t\tvar life = weebyLocalData.getLife();\n\t\tvar weebyConfig = weebyController.getWeebyConfig();\n\t\tvar count = Math.min(5, weebyConfig.getMaxLives());\n\n\t\tfor (var i = 0; i < 5; i++) {\n\t\t\tvar key = '$heart' + i;\n\t\t\tif (i < count) {\n\t\t\t\tif (i < life) {\n\t\t\t\t\tthis._views[key].style.visible = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis._views[key].style.visible = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._views[key].style.visible = false;\n\t\t\t}\n\t\t}\n\n\t\tthis.onUpdateTime();\n\t};\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\t\tthis._sentHearts = weebyLocalData.getSentHearts();\n\t\tthis.onUserUpdated(weebyController.getUser());\n\t\tthis.showLife();\n\t\tthis._views.$rows.reflow();\n\t\tvar premium = weebyController.getWeebyConfig().getCurrencies().premium;\n\n\t\t\n\t\tvar crosspromo1 = weebyController.shouldShowCrosspromo('leaderboard:start', 'ladderrow1') \n\t\t\t\t\t\t|| weebyController.shouldShowCrosspromo('leaderboard:start', 'ladderrow2');\n\n\t\tif (crosspromo1) {\n\t\t\tthis._crosspromo = crosspromo1;\n\t\t\tthis._trackCrosspromo(\"crosspromo:show\", crosspromo1.referrer);\n\t\t} else {\n\t\t\tvar crosspromo = weebyController.shouldShowCrosspromo('leaderboard:start', 'ladderfull1');\n\n\t\t\tif (crosspromo) {\n\t\t\t\tthis._crosspromo = crosspromo;\n\t\t\t\tthis._trackCrosspromo(\"crosspromo:show\", crosspromo.referrer);\n\t\t\t\tweebyLocalData.setLastCrosspromoTime(Date.now());\n\t\t\t\tweebyLocalData.setLastCrosspromoGamesPlayed(weebyLocalData.getGamesPlayed());\n\t\t\t\t\n\t\t\t\tthis._views.$ladderCrosspromo.style.visible = true;\n\t\t\t\t\n\t\t\t\tthis._views.$gameIconFullCrosspromo.setImage(crosspromo.app.images.iconSmall);\n\t\t\t\tthis._views.$messageFullCrosspromo.setText(i18n.get(\"installGame\").replace('{game}', crosspromo.app.localizedName || crosspromo.app.name));\n\t\t\t\n\t\t\t\t//Show reward on Android, but not on iOS\n\t\t\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\t\t\tthis._views.$rewardIconLeft.style.visible = true;\n\t\t\t\t\tthis._views.$rewardIconRight.style.visible = true;\n\t\t\t\t\tthis._views.$rewardAmountFullCrosspromo.style.visible = true;\n\n\t\t\t\t\tthis._views.$rewardAmountFullCrosspromo.setText(i18n.get(\"getPremiumReward\").replace('{amount}', crosspromo.rewardAmount).replace('{premium}', premium.displayName));\n\t\t\t\t} else {\n\t\t\t\t\tthis._views.$rewardIconLeft.style.visible = false;\n\t\t\t\t\tthis._views.$rewardIconRight.style.visible = false;\n\t\t\t\t\tthis._views.$rewardAmountFullCrosspromo.style.visible = true;\n\t\t\t\t\t\n\t\t\t\t\tthis._views.$messageFullCrosspromo.setText(i18n.get(\"newReward\"));\n\t\t\t\t\tthis._views.$rewardAmountFullCrosspromo.setText(i18n.get(\"installGame\").replace('{game}', crosspromo.app.localizedName || crosspromo.app.name));\n\t\t\t\n\t\t\t\t}\n\n\t\t\t\tcrosspromoView = this._crosspromoView;\n\t\t\t} else {\n\t\t\t\tthis._views.$ladderCrosspromo.style.visible = false;\n\t\t\t}\n\t\t}\n\t};\n});\n\nif (DEBUG) {\n\tvar DEBUG_DATA = {};\n}\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/PickCountryViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/PickCountryViewController.js","friendlyPath":".controllers.game.PickCountryViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"PickCountryViewController.js","src":"jsio(\"import ui.widget.ListView as ListView\");\njsio(\"import ui.widget.CellView as CellView\");\n\njsio(\"import ...components.WeebyListViewController as WeebyListViewController\");\n\njsio(\"import ....constants.countryConstants as countryConstants\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\njsio(\"import device\");\n\nvar sdk_plugins_weeby_ui_controllers_game_PickCountryViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_PickCountryViewController(function sdk_plugins_weeby_ui_controllers_game_PickCountryViewController(){return this.init&&this.init.apply(this,arguments)},WeebyListViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'PickCountryViewController',\n\t\t\t\tlayout: '$pickCountry',\n\t\t\t\toverrideCtors: {\n\t\t\t\t\t'$rows': ListView,\n\t\t\t\t\t'$row': CellView\n\t\t\t\t},\n\t\t\t\tdataKey: 'name',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._listData.add(countryConstants);\n\t\tthis._listData.setSorter(function(value) {\n\t\t\treturn value.name;\n\t\t});\n\n\t\tthis._views.$rows.updateOpts({\n\t\t\tdataSource: this._listData,\n\t\t\tscrollX: false,\n\t\t\tisFixedSize: true,\n\t\t\trecycle: true,\n\t\t\tgetCell: bind(this, 'getCell')\n\t\t});\n\n\t\tthis._views.$backButton.on('InputSelect', bind(this, 'onBack'));\n\t\tthis._views.$countryWrapper.style.height = (device.height / (device.width / 576)) - 250;\n\t\tthis._views.$searchBox.on('onChange', bind(this, 'onSearch'));\n\t};\n\n\tthis.onSearch = function(value) {\n\t\tvar reCode = /[0-9]+/.test(value) && new RegExp('^' + value + '$', 'i');\n\t\tvar reName = /[a-zA-Z]/.test(value) && new RegExp('(^| )' + value, 'i');\n\n\t\tvar ds = this._listData.getFilteredDataSource(function(countryData) {\n\t\t\treturn !value\n\t\t\t\t|| reCode && reCode.test(countryData.code)\n\t\t\t\t|| reName && reName.test(countryData.name);\n\t\t});\n\n\t\tif (ds.getCount() == 0) {\n\t\t\tds.add({\n\t\t\t\tname: i18n.get('noCountryMatch'),\n\t\t\t\tcode: ''\n\t\t\t});\n\t\t}\n\n\t\tthis._views.$rows.updateOpts({\n\t\t\tdataSource: ds\n\t\t});\n\n\t\tthis._views.$rows.setOffset(0, 0);\n\t}\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\t\treturn root;\n\t};\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tvar name = i18n.get(data.iso);\n\t\t// if the key is not found just use the name in english\n\t\tif (name == data.iso) {\n\t\t\tname = data.name;\n\t\t}\n\t\tviewStates.views.$title.setText(name);\n\t\tviewStates.views.$code.setText(data.code.length > 0 ? '+' + data.code : data.code);\n\t\tviewStates.views.$clickArea.onInputSelect = bind(this, 'onSelectItem', viewStates, data);\n\t};\n\n\tthis.onSelectItem = function (viewStates, item) {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('pick', {\n\t\t\tname: item.name,\n\t\t\tiso: item.iso,\n\t\t\tnumber: item.code\n\t\t});\n\t};\n\n\tthis.onBack = function() {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('cancel', {\n\t\t\taction: 'cancel'\n\t\t});\n\t};\n});\n","pre":true},"sdk/plugins/weeby/constants/countryConstants.js":{"path":"sdk/plugins/weeby/constants/countryConstants.js","friendlyPath":"....constants.countryConstants","directory":"sdk/plugins/weeby/constants/","filename":"countryConstants.js","src":"exports = [\n\t{\"name\": \"Afghanistan\", \"iso\": \"AF\", \"code\": \"93\"},\n\t{\"name\": \"Albania\", \"iso\": \"AL\", \"code\": \"355\"},\n\t{\"name\": \"Algeria\", \"iso\": \"DZ\", \"code\": \"213\"},\n\t{\"name\": \"American Samoa\", \"iso\": \"AS\", \"code\": \"1\"},\n\t{\"name\": \"Andorra\", \"iso\": \"AD\", \"code\": \"376\"},\n\t{\"name\": \"Angola\", \"iso\": \"AO\", \"code\": \"244\"},\n\t{\"name\": \"Anguilla\", \"iso\": \"AI\", \"code\": \"1\"},\n\t{\"name\": \"Antarctica\", \"iso\": \"AQ\", \"code\": \"672\"},\n\t{\"name\": \"Antigua and Barbuda\", \"iso\": \"AG\", \"code\": \"1\"},\n\t{\"name\": \"Argentina\", \"iso\": \"AR\", \"code\": \"54\"},\n\t{\"name\": \"Armenia\", \"iso\": \"AM\", \"code\": \"374\"},\n\t{\"name\": \"Aruba\", \"iso\": \"AW\", \"code\": \"297\"},\n\t{\"name\": \"Australia\", \"iso\": \"AU\", \"code\": \"61\"},\n\t{\"name\": \"Austria\", \"iso\": \"AT\", \"code\": \"43\"},\n\t{\"name\": \"Azerbaijan\", \"iso\": \"AZ\", \"code\": \"994\"},\n\t{\"name\": \"Bahamas\", \"iso\": \"BS\", \"code\": \"1\"},\n\t{\"name\": \"Bahrain\", \"iso\": \"BH\", \"code\": \"973\"},\n\t{\"name\": \"Bangladesh\", \"iso\": \"BD\", \"code\": \"880\"},\n\t{\"name\": \"Barbados\", \"iso\": \"BB\", \"code\": \"1\"},\n\t{\"name\": \"Belarus\", \"iso\": \"BY\", \"code\": \"375\"},\n\t{\"name\": \"Belgium\", \"iso\": \"BE\", \"code\": \"32\"},\n\t{\"name\": \"Belize\", \"iso\": \"BZ\", \"code\": \"501\"},\n\t{\"name\": \"Benin\", \"iso\": \"BJ\", \"code\": \"229\"},\n\t{\"name\": \"Bermuda\", \"iso\": \"BM\", \"code\": \"1\"},\n\t{\"name\": \"Bhutan\", \"iso\": \"BT\", \"code\": \"975\"},\n\t{\"name\": \"Bolivia\", \"iso\": \"BO\", \"code\": \"591\"},\n\t{\"name\": \"Bosnia and Herzegovina\", \"iso\": \"BA\", \"code\": \"387\"},\n\t{\"name\": \"Botswana\", \"iso\": \"BW\", \"code\": \"267\"},\n\t{\"name\": \"Brazil\", \"iso\": \"BR\", \"code\": \"55\"},\n\t{\"name\": \"British Virgin Islands\", \"iso\": \"VG\", \"code\": \"1\"},\n\t{\"name\": \"Brunei\", \"iso\": \"BN\", \"code\": \"673\"},\n\t{\"name\": \"Bulgaria\", \"iso\": \"BG\", \"code\": \"359\"},\n\t{\"name\": \"Burkina Faso\", \"iso\": \"BF\", \"code\": \"226\"},\n\t{\"name\": \"Burma\", \"iso\": \"MM\", \"code\": \"95\"},\n\t{\"name\": \"Burundi\", \"iso\": \"BI\", \"code\": \"257\"},\n\t{\"name\": \"Cambodia\", \"iso\": \"KH\", \"code\": \"855\"},\n\t{\"name\": \"Cameroon\", \"iso\": \"CM\", \"code\": \"237\"},\n\t{\"name\": \"Canada\", \"iso\": \"CA\", \"code\": \"1\"},\n\t{\"name\": \"Cape Verde\", \"iso\": \"CV\", \"code\": \"238\"},\n\t{\"name\": \"Cayman Islands\", \"iso\": \"KY\", \"code\": \"1\"},\n\t{\"name\": \"Central African Republic\", \"iso\": \"CF\", \"code\": \"236\"},\n\t{\"name\": \"Chad\", \"iso\": \"TD\", \"code\": \"235\"},\n\t{\"name\": \"Chile\", \"iso\": \"CL\", \"code\": \"56\"},\n\t{\"name\": \"China\", \"iso\": \"CN\", \"code\": \"86\"},\n\t{\"name\": \"Christmas Island\", \"iso\": \"CX\", \"code\": \"61\"},\n\t{\"name\": \"Cocos Islands\", \"iso\": \"CC\", \"code\": \"61\"},\n\t{\"name\": \"Colombia\", \"iso\": \"CO\", \"code\": \"57\"},\n\t{\"name\": \"Comoros\", \"iso\": \"KM\", \"code\": \"269\"},\n\t{\"name\": \"Cook Islands\", \"iso\": \"CK\", \"code\": \"682\"},\n\t{\"name\": \"Costa Rica\", \"iso\": \"CR\", \"code\": \"506\"},\n\t{\"name\": \"Croatia\", \"iso\": \"HR\", \"code\": \"385\"},\n\t{\"name\": \"Cuba\", \"iso\": \"CU\", \"code\": \"53\"},\n\t{\"name\": \"Cyprus\", \"iso\": \"CY\", \"code\": \"357\"},\n\t{\"name\": \"Czech Republic\", \"iso\": \"CZ\", \"code\": \"420\"},\n\t{\"name\": \"Democratic Republic of the Congo\", \"iso\": \"CD\", \"code\": \"243\"},\n\t{\"name\": \"Denmark\", \"iso\": \"DK\", \"code\": \"45\"},\n\t{\"name\": \"Djibouti\", \"iso\": \"DJ\", \"code\": \"253\"},\n\t{\"name\": \"Dominica\", \"iso\": \"DM\", \"code\": \"1\"},\n\t{\"name\": \"Dominican Republic\", \"iso\": \"DO\", \"code\": \"1\"},\n\t{\"name\": \"Ecuador\", \"iso\": \"EC\", \"code\": \"593\"},\n\t{\"name\": \"Egypt\", \"iso\": \"EG\", \"code\": \"20\"},\n\t{\"name\": \"El Salvador\", \"iso\": \"SV\", \"code\": \"503\"},\n\t{\"name\": \"Equatorial Guinea\", \"iso\": \"GQ\", \"code\": \"240\"},\n\t{\"name\": \"Eritrea\", \"iso\": \"ER\", \"code\": \"291\"},\n\t{\"name\": \"Estonia\", \"iso\": \"EE\", \"code\": \"372\"},\n\t{\"name\": \"Ethiopia\", \"iso\": \"ET\", \"code\": \"251\"},\n\t{\"name\": \"Falkland Islands\", \"iso\": \"FK\", \"code\": \"500\"},\n\t{\"name\": \"Faroe Islands\", \"iso\": \"FO\", \"code\": \"298\"},\n\t{\"name\": \"Fiji\", \"iso\": \"FJ\", \"code\": \"679\"},\n\t{\"name\": \"Finland\", \"iso\": \"FI\", \"code\": \"358\"},\n\t{\"name\": \"France\", \"iso\": \"FR\", \"code\": \"33\"},\n\t{\"name\": \"French Polynesia\", \"iso\": \"PF\", \"code\": \"689\"},\n\t{\"name\": \"Gabon\", \"iso\": \"GA\", \"code\": \"241\"},\n\t{\"name\": \"Gambia\", \"iso\": \"GM\", \"code\": \"220\"},\n\t{\"name\": \"Georgia\", \"iso\": \"GE\", \"code\": \"995\"},\n\t{\"name\": \"Germany\", \"iso\": \"DE\", \"code\": \"49\"},\n\t{\"name\": \"Ghana\", \"iso\": \"GH\", \"code\": \"233\"},\n\t{\"name\": \"Gibraltar\", \"iso\": \"GI\", \"code\": \"350\"},\n\t{\"name\": \"Greece\", \"iso\": \"GR\", \"code\": \"30\"},\n\t{\"name\": \"Greenland\", \"iso\": \"GL\", \"code\": \"299\"},\n\t{\"name\": \"Grenada\", \"iso\": \"GD\", \"code\": \"1\"},\n\t{\"name\": \"Guam\", \"iso\": \"GU\", \"code\": \"1\"},\n\t{\"name\": \"Guatemala\", \"iso\": \"GT\", \"code\": \"502\"},\n\t{\"name\": \"Guinea\", \"iso\": \"GN\", \"code\": \"224\"},\n\t{\"name\": \"Guinea-Bissau\", \"iso\": \"GW\", \"code\": \"245\"},\n\t{\"name\": \"Guyana\", \"iso\": \"GY\", \"code\": \"592\"},\n\t{\"name\": \"Haiti\", \"iso\": \"HT\", \"code\": \"509\"},\n\t{\"name\": \"Vatican City\", \"iso\": \"VA\", \"code\": \"39\"},\n\t{\"name\": \"Honduras\", \"iso\": \"HN\", \"code\": \"504\"},\n\t{\"name\": \"Hong Kong\", \"iso\": \"HK\", \"code\": \"852\"},\n\t{\"name\": \"Hungary\", \"iso\": \"HU\", \"code\": \"36\"},\n\t{\"name\": \"Iceland\", \"iso\": \"IS\", \"code\": \"354\"},\n\t{\"name\": \"India\", \"iso\": \"IN\", \"code\": \"91\"},\n\t{\"name\": \"Indonesia\", \"iso\": \"ID\", \"code\": \"62\"},\n\t{\"name\": \"Iran\", \"iso\": \"IR\", \"code\": \"98\"},\n\t{\"name\": \"Iraq\", \"iso\": \"IQ\", \"code\": \"964\"},\n\t{\"name\": \"Ireland\", \"iso\": \"IE\", \"code\": \"353\"},\n\t{\"name\": \"Isle of Man\", \"iso\": \"IM\", \"code\": \"44\"},\n\t{\"name\": \"Israel\", \"iso\": \"IL\", \"code\": \"972\"},\n\t{\"name\": \"Italy\", \"iso\": \"IT\", \"code\": \"39\"},\n\t{\"name\": \"Ivory Coast\", \"iso\": \"CI\", \"code\": \"225\"},\n\t{\"name\": \"Jamaica\", \"iso\": \"JM\", \"code\": \"1\"},\n\t{\"name\": \"Japan\", \"iso\": \"JP\", \"code\": \"81\"},\n\t{\"name\": \"Jersey\", \"iso\": \"JE\", \"code\": \"44\"},\n\t{\"name\": \"Jordan\", \"iso\": \"JO\", \"code\": \"962\"},\n\t{\"name\": \"Kazakhstan\", \"iso\": \"KZ\", \"code\": \"7\"},\n\t{\"name\": \"Kenya\", \"iso\": \"KE\", \"code\": \"254\"},\n\t{\"name\": \"Kiribati\", \"iso\": \"KI\", \"code\": \"686\"},\n\t{\"name\": \"Kuwait\", \"iso\": \"KW\", \"code\": \"965\"},\n\t{\"name\": \"Kyrgyzstan\", \"iso\": \"KG\", \"code\": \"996\"},\n\t{\"name\": \"Laos\", \"iso\": \"LA\", \"code\": \"856\"},\n\t{\"name\": \"Latvia\", \"iso\": \"LV\", \"code\": \"371\"},\n\t{\"name\": \"Lebanon\", \"iso\": \"LB\", \"code\": \"961\"},\n\t{\"name\": \"Lesotho\", \"iso\": \"LS\", \"code\": \"266\"},\n\t{\"name\": \"Liberia\", \"iso\": \"LR\", \"code\": \"231\"},\n\t{\"name\": \"Libya\", \"iso\": \"LY\", \"code\": \"218\"},\n\t{\"name\": \"Liechtenstein\", \"iso\": \"LI\", \"code\": \"423\"},\n\t{\"name\": \"Lithuania\", \"iso\": \"LT\", \"code\": \"370\"},\n\t{\"name\": \"Luxembourg\", \"iso\": \"LU\", \"code\": \"352\"},\n\t{\"name\": \"Macau\", \"iso\": \"MO\", \"code\": \"853\"},\n\t{\"name\": \"Macedonia\", \"iso\": \"MK\", \"code\": \"389\"},\n\t{\"name\": \"Madagascar\", \"iso\": \"MG\", \"code\": \"261\"},\n\t{\"name\": \"Malawi\", \"iso\": \"MW\", \"code\": \"265\"},\n\t{\"name\": \"Malaysia\", \"iso\": \"MY\", \"code\": \"60\"},\n\t{\"name\": \"Maldives\", \"iso\": \"MV\", \"code\": \"960\"},\n\t{\"name\": \"Mali\", \"iso\": \"ML\", \"code\": \"223\"},\n\t{\"name\": \"Malta\", \"iso\": \"MT\", \"code\": \"356\"},\n\t{\"name\": \"Marshall Islands\", \"iso\": \"MH\", \"code\": \"692\"},\n\t{\"name\": \"Mauritania\", \"iso\": \"MR\", \"code\": \"222\"},\n\t{\"name\": \"Mauritius\", \"iso\": \"MU\", \"code\": \"230\"},\n\t{\"name\": \"Mayotte\", \"iso\": \"YT\", \"code\": \"262\"},\n\t{\"name\": \"Mexico\", \"iso\": \"MX\", \"code\": \"52\"},\n\t{\"name\": \"Micronesia\", \"iso\": \"FM\", \"code\": \"691\"},\n\t{\"name\": \"Moldova\", \"iso\": \"MD\", \"code\": \"373\"},\n\t{\"name\": \"Monaco\", \"iso\": \"MC\", \"code\": \"377\"},\n\t{\"name\": \"Mongolia\", \"iso\": \"MN\", \"code\": \"976\"},\n\t{\"name\": \"Montenegro\", \"iso\": \"ME\", \"code\": \"382\"},\n\t{\"name\": \"Montserrat\", \"iso\": \"MS\", \"code\": \"1\"},\n\t{\"name\": \"Morocco\", \"iso\": \"MA\", \"code\": \"212\"},\n\t{\"name\": \"Mozambique\", \"iso\": \"MZ\", \"code\": \"258\"},\n\t{\"name\": \"Namibia\", \"iso\": \"NA\", \"code\": \"264\"},\n\t{\"name\": \"Nauru\", \"iso\": \"NR\", \"code\": \"674\"},\n\t{\"name\": \"Nepal\", \"iso\": \"NP\", \"code\": \"977\"},\n\t{\"name\": \"Netherlands\", \"iso\": \"NL\", \"code\": \"31\"},\n\t{\"name\": \"Netherlands Antilles\", \"iso\": \"AN\", \"code\": \"599\"},\n\t{\"name\": \"New Caledonia\", \"iso\": \"NC\", \"code\": \"687\"},\n\t{\"name\": \"New Zealand\", \"iso\": \"NZ\", \"code\": \"64\"},\n\t{\"name\": \"Nicaragua\", \"iso\": \"NI\", \"code\": \"505\"},\n\t{\"name\": \"Niger\", \"iso\": \"NE\", \"code\": \"227\"},\n\t{\"name\": \"Nigeria\", \"iso\": \"NG\", \"code\": \"234\"},\n\t{\"name\": \"Niue\", \"iso\": \"NU\", \"code\": \"683\"},\n\t{\"name\": \"North Korea\", \"iso\": \"KP\", \"code\": \"850\"},\n\t{\"name\": \"Northern Mariana Islands\", \"iso\": \"MP\", \"code\": \"1\"},\n\t{\"name\": \"Norway\", \"iso\": \"NO\", \"code\": \"47\"},\n\t{\"name\": \"Oman\", \"iso\": \"OM\", \"code\": \"968\"},\n\t{\"name\": \"Pakistan\", \"iso\": \"PK\", \"code\": \"92\"},\n\t{\"name\": \"Palau\", \"iso\": \"PW\", \"code\": \"680\"},\n\t{\"name\": \"Panama\", \"iso\": \"PA\", \"code\": \"507\"},\n\t{\"name\": \"Papua New Guinea\", \"iso\": \"PG\", \"code\": \"675\"},\n\t{\"name\": \"Paraguay\", \"iso\": \"PY\", \"code\": \"595\"},\n\t{\"name\": \"Peru\", \"iso\": \"PE\", \"code\": \"51\"},\n\t{\"name\": \"Philippines\", \"iso\": \"PH\", \"code\": \"63\"},\n\t{\"name\": \"Pitcairn Islands\", \"iso\": \"PN\", \"code\": \"870\"},\n\t{\"name\": \"Poland\", \"iso\": \"PL\", \"code\": \"48\"},\n\t{\"name\": \"Portugal\", \"iso\": \"PT\", \"code\": \"351\"},\n\t{\"name\": \"Puerto Rico\", \"iso\": \"PR\", \"code\": \"1\"},\n\t{\"name\": \"Qatar\", \"iso\": \"QA\", \"code\": \"974\"},\n\t{\"name\": \"Republic of the Congo\", \"iso\": \"CG\", \"code\": \"242\"},\n\t{\"name\": \"Romania\", \"iso\": \"RO\", \"code\": \"40\"},\n\t{\"name\": \"Russia\", \"iso\": \"RU\", \"code\": \"7\"},\n\t{\"name\": \"Rwanda\", \"iso\": \"RW\", \"code\": \"250\"},\n\t{\"name\": \"Saint Barthelemy\", \"iso\": \"BL\", \"code\": \"590\"},\n\t{\"name\": \"Saint Helena\", \"iso\": \"SH\", \"code\": \"290\"},\n\t{\"name\": \"Saint Kitts and Nevis\", \"iso\": \"KN\", \"code\": \"1\"},\n\t{\"name\": \"Saint Lucia\", \"iso\": \"LC\", \"code\": \"1\"},\n\t{\"name\": \"Saint Martin\", \"iso\": \"MF\", \"code\": \"1\"},\n\t{\"name\": \"Saint Pierre and Miquelon\", \"iso\": \"PM\", \"code\": \"508\"},\n\t{\"name\": \"Saint Vincent and the Grenadines\", \"iso\": \"VC\", \"code\": \"1\"},\n\t{\"name\": \"Samoa\", \"iso\": \"WS\", \"code\": \"685\"},\n\t{\"name\": \"San Marino\", \"iso\": \"SM\", \"code\": \"378\"},\n\t{\"name\": \"Sao Tome and Principe\", \"iso\": \"ST\", \"code\": \"239\"},\n\t{\"name\": \"Saudi Arabia\", \"iso\": \"SA\", \"code\": \"966\"},\n\t{\"name\": \"Senegal\", \"iso\": \"SN\", \"code\": \"221\"},\n\t{\"name\": \"Serbia\", \"iso\": \"RS\", \"code\": \"381\"},\n\t{\"name\": \"Seychelles\", \"iso\": \"SC\", \"code\": \"248\"},\n\t{\"name\": \"Sierra Leone\", \"iso\": \"SL\", \"code\": \"232\"},\n\t{\"name\": \"Singapore\", \"iso\": \"SG\", \"code\": \"65\"},\n\t{\"name\": \"Slovakia\", \"iso\": \"SK\", \"code\": \"421\"},\n\t{\"name\": \"Slovenia\", \"iso\": \"SI\", \"code\": \"386\"},\n\t{\"name\": \"Solomon Islands\", \"iso\": \"SB\", \"code\": \"677\"},\n\t{\"name\": \"Somalia\", \"iso\": \"SO\", \"code\": \"252\"},\n\t{\"name\": \"South Africa\", \"iso\": \"ZA\", \"code\": \"27\"},\n\t{\"name\": \"South Korea\", \"iso\": \"KR\", \"code\": \"82\"},\n\t{\"name\": \"Spain\", \"iso\": \"ES\", \"code\": \"34\"},\n\t{\"name\": \"Sri Lanka\", \"iso\": \"LK\", \"code\": \"94\"},\n\t{\"name\": \"Sudan\", \"iso\": \"SD\", \"code\": \"249\"},\n\t{\"name\": \"Suriname\", \"iso\": \"SR\", \"code\": \"597\"},\n\t{\"name\": \"Svalbard\", \"iso\": \"SJ\", \"code\": \"47\"},\n\t{\"name\": \"Swaziland\", \"iso\": \"SZ\", \"code\": \"268\"},\n\t{\"name\": \"Sweden\", \"iso\": \"SE\", \"code\": \"46\"},\n\t{\"name\": \"Switzerland\", \"iso\": \"CH\", \"code\": \"41\"},\n\t{\"name\": \"Syria\", \"iso\": \"SY\", \"code\": \"963\"},\n\t{\"name\": \"Taiwan\", \"iso\": \"TW\", \"code\": \"886\"},\n\t{\"name\": \"Tajikistan\", \"iso\": \"TJ\", \"code\": \"992\"},\n\t{\"name\": \"Tanzania\", \"iso\": \"TZ\", \"code\": \"255\"},\n\t{\"name\": \"Thailand\", \"iso\": \"TH\", \"code\": \"66\"},\n\t{\"name\": \"Timor-Leste\", \"iso\": \"TL\", \"code\": \"670\"},\n\t{\"name\": \"Togo\", \"iso\": \"TG\", \"code\": \"228\"},\n\t{\"name\": \"Tokelau\", \"iso\": \"TK\", \"code\": \"690\"},\n\t{\"name\": \"Tonga\", \"iso\": \"TO\", \"code\": \"676\"},\n\t{\"name\": \"Trinidad and Tobago\", \"iso\": \"TT\", \"code\": \"1\"},\n\t{\"name\": \"Tunisia\", \"iso\": \"TN\", \"code\": \"216\"},\n\t{\"name\": \"Turkey\", \"iso\": \"TR\", \"code\": \"90\"},\n\t{\"name\": \"Turkmenistan\", \"iso\": \"TM\", \"code\": \"993\"},\n\t{\"name\": \"Turks and Caicos Islands\", \"iso\": \"TC\", \"code\": \"1\"},\n\t{\"name\": \"Tuvalu\", \"iso\": \"TV\", \"code\": \"688\"},\n\t{\"name\": \"Uganda\", \"iso\": \"UG\", \"code\": \"256\"},\n\t{\"name\": \"Ukraine\", \"iso\": \"UA\", \"code\": \"380\"},\n\t{\"name\": \"United Arab Emirates\", \"iso\": \"AE\", \"code\": \"971\"},\n\t{\"name\": \"United Kingdom\", \"iso\": \"GB\", \"code\": \"44\"},\n\t{\"name\": \"United States\", \"iso\": \"US\", \"code\": \"1\"},\n\t{\"name\": \"Uruguay\", \"iso\": \"UY\", \"code\": \"598\"},\n\t{\"name\": \"US Virgin Islands\", \"iso\": \"VI\", \"code\": \"1\"},\n\t{\"name\": \"Uzbekistan\", \"iso\": \"UZ\", \"code\": \"998\"},\n\t{\"name\": \"Vanuatu\", \"iso\": \"VU\", \"code\": \"678\"},\n\t{\"name\": \"Venezuela\", \"iso\": \"VE\", \"code\": \"58\"},\n\t{\"name\": \"Vietnam\", \"iso\": \"VN\", \"code\": \"84\"},\n\t{\"name\": \"Wallis and Futuna\", \"iso\": \"WF\", \"code\": \"681\"},\n\t{\"name\": \"Yemen\", \"iso\": \"YE\", \"code\": \"967\"},\n\t{\"name\": \"Zambia\", \"iso\": \"ZM\", \"code\": \"260\"},\n\t{\"name\": \"Zimbabwe\", \"iso\": \"ZW\", \"code\": \"263\"}\n];\n\n// build accessor hash maps\nvar codeToName = {};\nvar codeToIso = {};\nvar isoToName = {};\nvar isoToCode = {};\nvar i;\nvar data;\n\nfor (i = 0; i < exports.length; i++) {\n\tdata = exports[i];\n\n\t// 1 belongs to a lot of countries as their country code.\n\t// US is probably the most likely, so prioritize US.\n\tif (data.code != \"1\" || data.iso === \"US\") {\n\t\tcodeToName[data.code] = data.name;\n\t\tcodeToIso[data.code] = data.iso;\n\t\tisoToName[data.iso] = data.name;\n\t\tisoToCode[data.iso] = data.code;\n\t}\n}\n\nexports.codeToName = codeToName;\nexports.codeToIso = codeToIso;\nexports.isoToName = isoToName;\nexports.isoToCode = isoToCode;\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/TOSViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/TOSViewController.js","friendlyPath":".controllers.game.TOSViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"TOSViewController.js","src":"jsio(\"import device\");\n\njsio(\"import ui.widget.ListView as ListView\");\njsio(\"import ui.widget.CellView as CellView\");\n\njsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....weebyStates\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_game_TOSViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_TOSViewController(function sdk_plugins_weeby_ui_controllers_game_TOSViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'TOSController',\n\t\t\t\tlayout: '$tos',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._isAccepted = true;\n\n\t\tthis._addEvent('$loginButton', 'InputSelect', bind(this, 'onSignin'), true);\n\t\tthis._views.$guestButton.on('InputSelect', bind(this, 'onGuestClick'));\n\t\tthis._views.$guestButton.style.visible = false;\n\n\t\tvar user = weebyController.getUser();\n\t\tthis.onUserUpdated(user);\n\t\tuser.on('updated', bind(this, 'onUserUpdated'));\n\n\t\tweebyController.on('StateChanged', bind(this, 'onStateChanged'));\n\t};\n\n\tthis.show = function() {\n\t\tsupr(this, 'show', Array.prototype.slice(arguments, 0));\n\t}\n\n\tthis.onStateChanged = function(curr, prev) {\n\t\t// TODO: refactor\n\t\tif (weebyStates.states[curr] === 'STATE_TOS' && \n\t\t\tweebyStates.states[prev] === 'STATE_DIALOG_ACCEPT_TOS' &&\n\t\t\t!weebyLocalData.hasAcceptedTOS()) {\n\t\t\t// When coming to this screen from the accept tos dialog and\n\t\t\t// we have not already accepted the tos\n\t\t\tsetTimeout(function() {\n\t\t\t\tweebyController.handleAction('back'); \n\t\t\t}, 0);\n\t\t} else if (weebyStates.states[curr] === 'STATE_TOS' &&\n\t\t\t\t   weebyStates.states[prev] === 'STATE_DIALOG_ACCEPT_TOS' &&\n\t\t\t\t   weebyLocalData.hasAcceptedTOS()) {\n\t\t\t// When coming to this screen from the accept tos dialog and\n\t\t\t// we have already accepted the tos\n\t\t\tsetTimeout(function() {\n\t\t\t\tweebyController.handleAction('login'); \n\t\t\t}, 0);\n\t\t} else if (weebyStates.states[curr] === 'STATE_TOS' &&\n\t\t\t\t   (weebyStates.states[prev] === 'STATE_SPLASH' ||\n\t\t\t\t\tweebyStates.states[prev] == null)) {\n\t\t\t// When coming to this screen from the splash screen or when\n\t\t\t// it is our first screen\n\t\t\tsetTimeout(function() {\n\t\t\t\tweebyController.handleAction('showAcceptTos');\n\t\t\t}, 0);\n\t\t} else if (weebyStates.states[curr] === 'STATE_TOS' &&\n\t\t\t\t   !(weebyStates.states[prev] === 'STATE_SPLASH' || \n\t\t\t\t\t weebyStates.states[prev] === 'STATE_DIALOG_ACCEPT_TOS')) {\n\t\t\t// When coming to this screen from anywhere but the splash or accept tos\n\t\t\t// dialog\n\t\t\tthis._views.$guestButton.style.visible = true;\n\t\t}\n\t}\n\n\tthis.onGuestClick = function() {\n\t\tweebyController.handleAction('game'); \n\t}\n\n\tthis.onAcceptTermsChange = function (isAccepted) {\n\t\tif (this._isAccepted != isAccepted) {\n\t\t\tthis._isAccepted = isAccepted;\n\t\t}\n\t};\n\n\tthis.onShowTerms = function () {\n\t\tweebyController.handleAction('viewTerms');\n\t};\n\n\tthis.onUserUpdated = function (user) {\n\t\tthis.refresh();\n\t};\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\n\t\tthis.refresh();\n\t}\n\n\tthis.refresh = function () {\n\t\t// var user = weebyController.getUser();\n\t\t// if (user.isVerified()) {\n\t\t//\tthis._showWelcomeBackBubble();\n\t\t// } else {\n\t\t//\tif (this._substate == 'tos.waitingTutorial') {\n\t\t//\t\tthis._showTutorialBubble();\n\t\t//\t} else {\n\t\t//\t\tthis._showLoginBubble();\n\t\t//\t}\n\t\t// }\n\t}\n\n\t// this._showWelcomeBackBubble = function () {\n\t//\tvar user = weebyController.getUser();\n\t//\tthis._views.$loginText.setText(i18n.get('welcomeBack', {name: user.getName()}));\n\t//\tvar image = user.getImage();\n\t//\tif (image && typeof image == 'string') {\n\t//\t\tthis._views.$profileImage.setImage(user.getImage());\n\t//\t}\n\t// }\n\n\t// this._showLoginBubble = function () {\n\t//\tthis._views.$registerText.setText(i18n.get('tosForceLogin'));\n\t//\tthis._views.$loginText.style.visible = false;\n\t//\tthis._views.$profileImage.style.visible = false;\n\t// }\n\n\t// this._showTutorialBubble = function () {\n\t//\tthis._views.$registerText.setText(i18n.get('tosTutorial'));\n\t//\tthis._views.$loginButtonText.setText(i18n.get('tosTutorialButton'));\n\t//\tthis._views.$loginText.style.visible = false;\n\t//\tthis._views.$profileImage.style.visible = false;\n\t// }\n\n\t// this.onSignin = function () {\n\t//\tif (this._isAccepted) {\n\t//\t\tif (weebyController.isOffline()) {\n\t//\t\t\tGC.app.weebyRootView.showDialog('offline');\n\t//\t\t} else {\n\t//\t\t\tthis.disableInput();\n\t//\t\t\tif (this._substate == 'tos.waitingTutorial') {\n\t//\t\t\t\tweebyController.handleAction('tutorial');\n\t//\t\t\t} else {\n\t//\t\t\t\tweebyController.handleAction('login');\n\t//\t\t\t}\n\t//\t\t}\n\t//\t} else {\n\t//\t\tthis.disableInput();\n\t//\t\tweebyController.handleAction('login');\n\t//\t}\n\t// };\n\n\tthis.onWeebyState = function (state) {\n\t};\n\n\tthis.onSignin = function () {\n\t\tif (weebyController.isOffline()) {\n\t\t\tGC.app.weebyRootView.showDialog('offline');\n\t\t} else {\n\t\t\tthis.disableInput();\n\t\t\tweebyController.handleAction('login');\n\t\t}\n\t};\n\n\tthis.onOkTerms = function () {\n\t\tif (weebyController.isOffline()) {\n\t\t\tGC.app.weebyRootView.showDialog('offline');\n\t\t} else {\n\t\t\tthis.disableInput();\n\t\t\tweebyController.handleAction('login');\n\t\t}\n\t};\n\n\tthis.onViewTerms = function () {\n\t\tGC.app.weebyRootView.showDialog('tos');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/SplashViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/SplashViewController.js","friendlyPath":".controllers.game.SplashViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"SplashViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....i18n\");\njsio(\"import device\");\n\nvar sdk_plugins_weeby_ui_controllers_game_SplashViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_SplashViewController(function sdk_plugins_weeby_ui_controllers_game_SplashViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function(supr) {\n\t\n\tthis.init = function(opts) {\n\t\topts = merge(opts, { \n\t\t\tname: 'SplashController',\n\t\t\tlayout: '$splash' \n\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._addEvent('$loginButton', 'InputSelect', bind(this, 'onLogin'), true);\n\n\t\tvar screenHeight = (device.height / (device.width / 576));\n\t\tthis._views.$loginButton.style.y = Math.min(screenHeight - 110, 680);\n\t}\n\n\tthis.onLogin = function() {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('login');\t\t\n\t}\n\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/VerifyingViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/VerifyingViewController.js","friendlyPath":".controllers.game.VerifyingViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"VerifyingViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\n\nvar sdk_plugins_weeby_ui_controllers_game_VerifyingViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_VerifyingViewController(function sdk_plugins_weeby_ui_controllers_game_VerifyingViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'VerifyinViewController',\n\t\t\t\tlayout: '$verifying'\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$message.setText('');\n\n\t\tweebyController.on('PhoneUpdated', bind(this, 'onPhoneUpdate'));\n\t\tthis._views.$prompt.on('Change', bind(this, 'onChange'));\n\t};\n\n\tthis.onChange = function (value) {\n\t\tweebyController.handleAction('verify', {code: value});\n\t};\n\n\tthis.onPhoneUpdate = function (number) {\n\t\tthis._views.$prompt.setText('');\n\t\tthis._views.$number.setText(number);\n\t};\n\n\tthis.onWeebyState = function (state) {\n\t\tswitch (state) {\n\t\t\tcase 'verifying.error':\n\t\t\t\tthis.enableInput();\n\t\t\t\tthis._views.$message.setText('Error validating code');\n\t\t\t\ttrackers.track('auth:enteredCode:fail');\n\t\t\t\tbreak;\n\n\t\t\tcase 'verifying.noCode':\n\t\t\t\tthis.enableInput();\n\t\t\t\tthis._views.$message.setText('Please enter a code');\n\t\t\t\tbreak;\n\n\t\t\tcase 'verifying.waiting':\n\t\t\t\tthis.enableInput();\n\t\t\t\tthis._views.$message.setText('Waiting');\n\t\t\t\tbreak;\n\t\t}\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/VerifyViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/VerifyViewController.js","friendlyPath":".controllers.game.VerifyViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"VerifyViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import device\");\njsio(\"import ui.resource.Image as Image\");\njsio(\"import ....constants.countryConstants as countryConstants\");\njsio(\"import ....trackers.trackers as trackers\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....weebyStates\");\njsio(\"import ....i18n\");\njsio(\"import ....sdk.simulator.PhoneFormat as PhoneFormat\");\njsio(\"import ....weebyNative\");\n\nvar n = countryConstants.length;\nvar isoIndex = {};\nfor (var i = 0; i < n; ++i) {\n\tisoIndex[countryConstants[i].iso] = countryConstants[i];\n}\n\nvar sdk_plugins_weeby_ui_controllers_game_VerifyViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_VerifyViewController(function sdk_plugins_weeby_ui_controllers_game_VerifyViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\tvar that = this;\n\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'VerifyViewController',\n\t\t\t\tlayout: '$verify',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\t// TODO: how to detect this if they do not choose a country from picker?\n\t\t// default to US?\n\t\tthis._iso = '';\n\t\tthis._countryName = '';\n\t\tthis._prevState = '';\n\n\t\tthis._views.$verifyButton.on('InputSelect', bind(this, 'onVerify'));\n\t\tthis._views.$photoButton.on('InputSelect', bind(this, 'onPhotoPick'));\n\t\tthis._views.$backButton.on('InputSelect', bind(this, 'onBack'));\n\n\t\tthis._views.$firstNameText.setForward(this._views.$lastNameText);\n\t\tthis._views.$lastNameText.setBackward(this._views.$firstNameText);\n\t\tthis._views.$lastNameText.setForward(this._views.$usernameText);\n\t\tthis._views.$usernameText.setBackward(this._views.$lastNameText);\n\t\tthis._views.$usernameText.setForward(this._views.$promptCountry);\n\t\tthis._views.$promptCountry.setForward(this._views.$promptPhone);\n\t\tthis._views.$promptPhone.setBackward(this._views.$promptCountry);\n\t\tthis._views.$promptPhone.registerTextFilter(function(val, prevVal) {\n\t\t\treturn that.onProcessPhoneChange(val, prevVal);\n\t\t}, function(val, prevVal, currPos) {\n\t\t\tvar unformatted = val.replace(/[^0-9]/g, '');\n\t\t\tvar formatted = that.onProcessPhoneChange(val, prevVal);\n\n\t\t\tif (prevVal != null) {\n\t\t\t\t// move cursor to number where it should occur by removing formatted spots that\n\t\t\t\t// occur before current currPos\n\t\t\t\tvar currUnformattedPos = currPos;\n\t\t\t\tfor (var j = 0; j < currPos; j++) {\n\t\t\t\t\tif (!/[0-9]/.test(val[j])) {\n\t\t\t\t\t\tcurrUnformattedPos--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// move cursor relative to added or removed numbers\n\t\t\t\tcurrUnformattedPos -= (unformatted.replace(/[^0-9]/g, '').length - formatted.replace(/[^0-9]/g, '').length);\n\n\t\t\t\t// account for formatting\n\t\t\t\tvar formatCount = 0;\n\t\t\t\tvar lookIdx = 0;\n\t\t\t\tvar i = 0;\n\t\t\t\twhile (i < formatted.length &&\n\t\t\t\t\t   lookIdx < currUnformattedPos &&\n\t\t\t\t\t   (!/[0-9]/.test(formatted[i]) || unformatted[lookIdx++] === formatted[i])) {\n\t\t\t\t\tif (!/[0-9]/.test(formatted[i])) {\n\t\t\t\t\t\t// if not a number\t\n\t\t\t\t\t\tformatCount++;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\t\t   \n\t\t\t\t}\n\n\t\t\t\treturn formatCount + currUnformattedPos;\n\t\t\t} else {\n\t\t\t\tformatted.length;\t\n\t\t\t}\n\t\t});\n\n\t\t// text change\n\t\tthis._views.$firstNameText.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changeFirstName'); \n\t\t});\n\t\tthis._views.$lastNameText.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changeLastName'); \n\t\t});\n\t\tthis._views.$usernameText.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changeUsername'); \n\t\t});\n\t\tthis._views.$promptCountry.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changeCountry'); \n\t\t});\n\t\tthis._views.$promptPhone.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changePhone'); \n\t\t});\n\n\t\tthis._views.$promptCountry.requestFocus = function() {\n\t\t\tthis.removeFocus();\n\t\t\tweebyController.handleAction('pickCountry');\t\n\t\t}\n\t\tthis._views.$promptPhone.on('InputStart', bind(this, 'onStartEditPhone'));\n\n\t\tvar info = isoIndex[this._iso];\n\t\tweebyController.on('CountryCodeChanged', bind(this, 'onCountryCodeChanged'));\n\t\tweebyController.on('StateChanged', bind(this, 'onStateChanged'));\n\t\tweebyController.on('AuthPhotoUpdate', bind(this, 'updatePhoto'));\n\t\tweebyController.on('AuthPhotoReturn', bind(this, 'returnPhoto'));\n\n\t\tvar user = weebyController.getUser();\n\t\tuser.getCountryIso(bind(this, '_onCountryIso'));\n\n\t\tweebyNative.getPhoneNumber(bind(this, '_onPhoneNumber'));\n\t};\n\n\tthis.onProcessPhoneChange = function(val, prevVal) {\n\t\t// check special case, delete non numeric character\n\t\tif (prevVal && \n\t\t\tval.replace(/[^0-9]/g, '') === prevVal.replace(/[^0-9]/g, '') && \n\t\t\tval.length < prevVal.length) {\n\t\t\tvar deleteIdx = -1;\n\t\t\tfor (var i = 0; i < val.length; i++) {\n\t\t\t\tif (val[i] !== prevVal[i]) {\n\t\t\t\t\tdeleteIdx = i - 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\t\n\n\t\t\tfor (var j = deleteIdx; j >= 0; j--) {\n\t\t\t\tif (!isNaN(+(val[j]))) {\n\t\t\t\t\tval = val.substring(0, j) + val.substring(j + 1, val.length);\t\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn PhoneFormat.formatLocal(this._iso, val);\n\t}\n\n\tthis.onBack = function() {\n\t\tif (this._views.$verify.style.visible) {\n\t\t\tdevice.get('StatusBar').hide();\n\n\t\t\ttrackers.track('auth:backFromVerifyView');\n\n\t\t\tif (this._prevState === 'STATE_TOS') {\n\t\t\t\tweebyController.handleAction('back');\n\t\t\t} else {\n\t\t\t\tweebyController.handleAction('backLadder'); \n\t\t\t}\n\t\t}\n\t}\n\n\tthis.onStateChanged = function(curr, prev) {\n\t\tif (weebyStates.states[curr] === 'STATE_VERIFY' &&\n\t\t\tweebyStates.states[prev] === 'STATE_PICK_COUNTRY') {\n\t\t\tvar phoneText = this._views.$promptPhone;\n\n\t\t\tif (phoneText == null || phoneText.length <= 2) {\n\t\t\t\tthis._views.$promptPhone.requestFocus();\n\t\t\t}\n\t\t} else if (weebyStates.states[curr] === 'STATE_VERIFY' &&\n\t\t\t\t   (weebyStates.states[prev] === 'STATE_TOS' ||\n\t\t\t\t    weebyStates.states[prev] === 'STATE_LADDER')) {\n\t\t\tdevice.get('StatusBar').show();\n\t\t\ttrackers.track('auth:start');\n\t\t}\n\n\t\tif (weebyStates.states[prev] === 'STATE_TOS') this._prevState = 'STATE_TOS';\n\t\tif (weebyStates.states[prev] === 'STATE_LADDER') this._prevState = 'STATE_LADDER';\n\t}\n\n\tthis.updatePhoto = function (imgURL) {\n\t\tvar base64Image = 'data:image/png;base64,' + imgURL;\n\n\t\tthis._views.$photo.setImage(base64Image);\n\t\tthis._views.$photoOverlay.style.visible = false;\n\t}\n\n\tthis.returnPhoto = function() {\n\t\tthis._views.$photoOverlay.style.visible = true;\t\t\n\t};\n\n\tthis._onCountryIso = function(data) {\n\t\tvar iso = data.iso; \n\t\tvar code;\n\n\t\tif (iso != null && iso.length == 2) {\n\t\t\tiso = iso.toUpperCase();\n\t\t\tcode = countryConstants.isoToCode[iso];\n\n\t\t\tif (code != null) {\n\t\t\t\tthis._iso = iso;\n\t\t\t\tthis._countryName = countryConstants.isoToName[iso];\n\t\t\t\tthis._views.$promptCountry.setText('+' + code);\n\t\t\t\tvar number = this._views.$promptPhone.getText();\n\t\t\t\tthis._views.$promptPhone.setText(PhoneFormat.formatLocal(this._iso, number));\n\t\t\t}\n\t\t}\n\t}\n\n\tthis._onPhoneNumber = function(data) {\n\t\tvar number = data.number;\n\n\t\tif (number != null) {\n\t\t\tif (this._iso != null && this._iso.length == 2) {\n\t\t\t\tvar code = countryConstants.isoToCode[this._iso];\n\t\t\t\t// remove country code prefix if it exists\n\t\t\t\tnumber = number.replace(new RegExp('^' + code), '');\t\n\t\t\t\tnumber = PhoneFormat.formatLocal(this._iso, number);\n\n\t\t\t\tthis._views.$promptPhone.setText(number);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.onStartEditPhone = function () {\n\t\ttrackers.track('auth:editNumber', {numberBefore: true});\n\t};\n\n\tthis.onPhotoPick = function() {\n\t\tweebyController.handleAction('pickPhoto');\n\t}\n\n\tthis.onVerify = function () {\n\t\tvar firstName = this._views.$firstNameText.getText();\n\t\tvar lastName = this._views.$lastNameText.getText();\n\t\tvar username = this._views.$usernameText.getText();\n\t\tvar countryCode = this._views.$promptCountry.getText();\n\t\tvar phone = this._views.$promptPhone.getText();\n\n\t\ttrackers.track('auth:clickVerify');\n\n\t\tif (firstName == null || firstName.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:firstNameError');\n\t\t\tthis.promptSingleButtonError(i18n.get('missingFirstName'));\n\t\t} else if (lastName == null || lastName.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:lastNameError');\n\t\t\tthis.promptSingleButtonError(i18n.get('missingLastName'));\n\t\t} else if (username == null || username.length < 3) {\n\t\t\ttrackers.track('auth:clickVerify:usernameError');\n\t\t\tthis.promptSingleButtonError(i18n.get('missingUsername'));\n\t\t} else if (countryCode == null || countryCode.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:countryCodeError');\n\t\t\tthis.promptSingleButtonError(i18n.get('missingCountry'));\n\t\t} else if (phone == null || phone.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:phoneError');\n\t\t\tthis.promptSingleButtonError(i18n.get(\"phoneNumberNotValid\") + ' ' + this._countryName);\n\t\t} else {\n\t\t\tweebyController.handleAction('confirm', {\n\t\t\t\tsingleButton: false,\n\t\t\t\ttitle: countryCode + ' ' + PhoneFormat.formatLocal(this._iso, phone),\n\t\t\t\tmessage: i18n.get('phoneNumberCorrect'),\n\t\t\t\tleftButtonText: i18n.get(\"edit\"),\n\t\t\t\trightButtonText: i18n.get(\"okay\"),\n\t\t\t\trightButtonAction: 'verify',\n\t\t\t\tcountryCode: countryCode.replace('+', ''),\n\t\t\t\tphoneNumber: phone,\n\t\t\t\tcountryName: this._countryName,\n\t\t\t\tiso: this._iso,\n\t\t\t\tfullName: firstName + ' ' + lastName,\n\t\t\t\tusername: username\n\t\t\t});\n\n\t\t\tthis._number = this._views.$promptCountry.getText() + this._views.$promptPhone.getText();\n\t\t\ttrackers.track('auth:clickVerify:success', {number: this._number});\n\t\t}\n\t};\n\n\tthis.onCountryPicker = function () {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('pickCountry');\n\t};\n\n\tthis.onCountryCodeChanged = function(name, iso, code) {\n\t\tif (code != null && code.length > 0) {\n\t\t\ttrackers.track('auth:editCountry', {index: code});\n\t\t\tthis._iso = iso;\n\t\t\tthis._countryName = name;\n\t\t\tthis._views.$promptCountry.setText('+' + code);\n\t\t\tvar number = this._views.$promptPhone.getText();\n\t\t\tthis._views.$promptPhone.setText(PhoneFormat.formatLocal(this._iso, number));\n\t\t}\n\t};\n\n\tthis.onChange = function(value) {\n\t\ttrackers.track('auth:editNumber', {numberAfter: true});\n\t\tthis._views.$promptPhone.setText(PhoneFormat.formatLocal(this._iso, value));\n\t};\n\n\tthis.promptSingleButtonError = function(text) {\n\t\tweebyController.handleAction('error', {\n\t\t\tsingleButton: true,\n\t\t\ttitle: i18n.get(\"somethingNotRight\"),\n\t\t\tmessage: text,\n\t\t\tbuttonText: i18n.get(\"tryAgain\"),\n\t\t\tbuttonAction: 'ok'\n\t\t});\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/VerifyVariantViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/VerifyVariantViewController.js","friendlyPath":".controllers.game.VerifyVariantViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"VerifyVariantViewController.js","src":"jsio(\"import device\");\n\njsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ....trackers.trackers as trackers\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyStates\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_game_VerifyVariantViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_VerifyVariantViewController(function sdk_plugins_weeby_ui_controllers_game_VerifyVariantViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function(opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'VerifyVariantController',\n\t\t\t\tlayout: '$verifyVariant',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tthis._prevState = '';\n\n\t\tsupr(this, 'init', arguments);\t\n\n\t\tthis._views.$verifyButton.on('InputSelect', bind(this, 'onVerify'));\n\t\tthis._views.$backButton.on('InputSelect', bind(this, 'onBack'));\n\t\tweebyController.on('StateChanged', bind(this, 'onStateChanged'));\n\t\t\n\t\tthis._views.$firstNameText.setForward(this._views.$lastNameText);\n\t\tthis._views.$lastNameText.setBackward(this._views.$firstNameText);\n\t\t\n\t\t// text change\n\t\tthis._views.$firstNameText.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changeFirstName'); \n\t\t});\n\t\tthis._views.$lastNameText.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changeLastName'); \n\t\t});\n\t\t\n\t};\n\n\tthis.onBack = function() {\n\t\tif (this._views.$verifyVariant.style.visible) {\n\t\t\tdevice.get('StatusBar').hide();\n\n\t\t\ttrackers.track('auth:backFromVerifyNameView');\n\n\t\t\tif (this._prevState === 'STATE_TOS') {\n\t\t\t\tweebyController.handleAction('back');\n\t\t\t} else {\n\t\t\t\tweebyController.handleAction('backLadder'); \n\t\t\t}\n\t\t}\n\t}\n\n\tthis.onVerify = function () {\n\t\tvar firstName = this._views.$firstNameText.getText();\n\t\tvar lastName = this._views.$lastNameText.getText();\n\t\t\n\t\ttrackers.track('auth:verifyName:clickSetName');\n\n\t\tif (firstName == null || firstName.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:firstNameError');\n\t\t\tthis.promptSingleButtonError(i18n.get('missingFirstName'));\n\t\t} else if (lastName == null || lastName.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:lastNameError');\n\t\t\tthis.promptSingleButtonError(i18n.get('missingLastName'));\n\t\t} else {\n\t\t\tweebyController.handleAction('verify', {\n\t\t\t\tfullName: firstName + ' ' + lastName\n\t\t\t});\n\n\t\t\ttrackers.track('auth:verifyName:clickSetName:success', {number: this._number});\n\t\t}\n\t};\n\n\tthis.onStateChanged = function(curr, prev) {\n\t\tif (weebyStates.states[curr] === 'STATE_VERIFY_VARIANT' &&\n\t\t\t\t   (weebyStates.states[prev] === 'STATE_TOS' ||\n\t\t\t\t    weebyStates.states[prev] === 'STATE_LADDER')) {\n\t\t\tdevice.get('StatusBar').show();\n\t\t\ttrackers.track('auth:start');\n\t\t}\n\n\t\tif (weebyStates.states[prev] === 'STATE_TOS') this._prevState = 'STATE_TOS';\n\t\tif (weebyStates.states[prev] === 'STATE_LADDER') this._prevState = 'STATE_LADDER';\n\t}\n\n\tthis.promptSingleButtonError = function(text) {\n\t\tweebyController.handleAction('error', {\n\t\t\tsingleButton: true,\n\t\t\ttitle: i18n.get(\"somethingNotRight\"),\n\t\t\tmessage: text,\n\t\t\tbuttonText: i18n.get(\"tryAgain\"),\n\t\t\tbuttonAction: 'ok'\n\t\t});\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/VerifyPhotoViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/VerifyPhotoViewController.js","friendlyPath":".controllers.game.VerifyPhotoViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"VerifyPhotoViewController.js","src":"jsio(\"import device\");\n\njsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ....trackers.trackers as trackers\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyStates\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_game_VerifyPhotoViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_VerifyPhotoViewController(function sdk_plugins_weeby_ui_controllers_game_VerifyPhotoViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function(opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'VerifyPhotoController',\n\t\t\t\tlayout: '$verifyPhoto',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tthis._prevState = '';\n\n\t\tsupr(this, 'init', arguments);\t\n\t\tweebyController.on('AuthPhotoUpdate:verifyPhoto', bind(this, 'updatePhoto'));\n\t\tweebyController.on('AuthPhotoReturn:verifyPhoto', bind(this, 'returnPhoto'));\n\n\t\tvar skipText = this._views.$skip;\n\t\t\n\t\t//Initially both buttons show photo picker\n\t\tthis._views.$verifyButton.on('InputSelect', bind(this, 'onPhotoVerifySelect'));\n\t\tthis._views.$photoButton.on('InputSelect', bind(this, 'onPhotoVerifyIconPress'));\n\t\tskipText.on('InputSelect', bind(this, 'onSkip'));\n\n\t\tweebyController.getUser().on('updated', bind(this, function () {\n\t\t\tthis._views.$name.setText(weebyController.getUser().getName());\n\t\t}));\n\t\t\n\t\tskipText.style.y = (device.height / (device.width / 576) - 100);\n\t};\n\n\tthis.onPhotoPick = function() {\n\t\tweebyController.handleAction('pickPhoto');\n\t}\n\n\tthis.onPhotoVerifySelect = function() {\n\t\ttrackers.track('auth:verifyPhoto:clickSelectButton');\t\n\t\tthis.onPhotoPick();\n\t}\n\n\tthis.onPhotoVerifyIconPress = function() {\n\t\ttrackers.track('auth:verifyPhoto:clickPhotoIcon');\t\n\t\tthis.onPhotoPick();\n\t}\n\n\tthis.updatePhoto = function (imgURL) {\n\t\tthis._views.$verifyButtonText.setText(i18n.get('finish'));\n\t\tthis._views.$verifyButton.removeAllListeners('InputSelect');\n\t\tthis._views.$verifyButton.on('InputSelect', bind(this, 'onVerify'));\n\t\t\n\t\tvar base64Image = 'data:image/png;base64,' + imgURL;\n\t\tthis._views.$photo.setImage(base64Image);\n\t\tthis._views.$photoOverlay.style.visible = false;\n\t}\n\n\tthis.returnPhoto = function() {\n\t\tthis._views.$photoOverlay.style.visible = true;\n\t};\n\n\tthis.onVerify = function () {\n\t\ttrackers.track('auth:verifyPhoto:finish');\n\t\tweebyController.handleAction('verify');\n\t};\n\n\tthis.onSkip = function() {\n\t\tdevice.get('StatusBar').hide();\n\t\ttrackers.track('auth:verifyPhoto:skip');\n\t\tweebyController.handleAction('skip');\n\t}\n\n\tthis.promptSingleButtonError = function(text) {\n\t\tweebyController.handleAction('error', {\n\t\t\tsingleButton: true,\n\t\t\ttitle: i18n.get(\"somethingNotRight\"),\n\t\t\tmessage: text,\n\t\t\tbuttonText: i18n.get(\"tryAgain\"),\n\t\t\tbuttonAction: 'ok'\n\t\t});\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/VerifyPhoneViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/VerifyPhoneViewController.js","friendlyPath":".controllers.game.VerifyPhoneViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"VerifyPhoneViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import device\");\njsio(\"import ....constants.countryConstants as countryConstants\");\njsio(\"import ....trackers.trackers as trackers\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyStates\");\njsio(\"import ....i18n\");\njsio(\"import ....sdk.simulator.PhoneFormat as PhoneFormat\");\njsio(\"import ....weebyNative\");\n\nvar sdk_plugins_weeby_ui_controllers_game_VerifyPhoneViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_VerifyPhoneViewController(function sdk_plugins_weeby_ui_controllers_game_VerifyPhoneViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function(supr) {\n\tthis.init = function(opts) {\n\t\tvar that = this;\n\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'VerifyPhoneViewController',\n\t\t\t\tlayout: '$verifyPhone',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis._iso = null;\n\t\tthis._countryName = \"\";\n\t\tthis._number = \"\";\n\n\t\tthis._views.$promptCountry.setForward(this._views.$promptPhone);\n\t\tthis._views.$promptPhone.setBackward(this._views.$promptCountry);\n\t\tthis._views.$promptPhone.registerTextFilter(function(val, prevVal) {\n\t\t\treturn that.onProcessPhoneChange(val, prevVal);\n\t\t}, function(val, prevVal, currPos) {\n\t\t\tvar unformatted = val.replace(/[^0-9]/g, '');\n\t\t\tvar formatted = that.onProcessPhoneChange(val, prevVal);\n\n\t\t\tif (prevVal != null) {\n\t\t\t\t// move cursor to number where it should occur by removing formatted spots that\n\t\t\t\t// occur before current currPos\n\t\t\t\tvar currUnformattedPos = currPos;\n\t\t\t\tfor (var j = 0; j < currPos; j++) {\n\t\t\t\t\tif (!/[0-9]/.test(val[j])) {\n\t\t\t\t\t\tcurrUnformattedPos--;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// move cursor relative to added or removed numbers\n\t\t\t\tcurrUnformattedPos -= (unformatted.replace(/[^0-9]/g, '').length - formatted.replace(/[^0-9]/g, '').length);\n\n\t\t\t\t// account for formatting\n\t\t\t\tvar formatCount = 0;\n\t\t\t\tvar lookIdx = 0;\n\t\t\t\tvar i = 0;\n\t\t\t\twhile (i < formatted.length &&\n\t\t\t\t\t   lookIdx < currUnformattedPos &&\n\t\t\t\t\t   (!/[0-9]/.test(formatted[i]) || unformatted[lookIdx++] === formatted[i])) {\n\t\t\t\t\tif (!/[0-9]/.test(formatted[i])) {\n\t\t\t\t\t\t// if not a number\t\n\t\t\t\t\t\tformatCount++;\n\t\t\t\t\t}\n\t\t\t\t\ti++;\t\t   \n\t\t\t\t}\n\n\t\t\t\treturn formatCount + currUnformattedPos;\n\t\t\t} else {\n\t\t\t\treturn formatted.length;\t\t\n\t\t\t}\n\t\t});\n\t\tthis._views.$promptCountry.registerTextFilter(function(val) {\n\t\t\treturn '+' + val.replace(/[^0-9]/g, '');\t\n\t\t});\n\n\t\tthis._views.$promptCountry.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changeCountry'); \n\t\t});\n\t\tthis._views.$promptPhone.on('focusAdd', function() { \n\t\t\ttrackers.track('auth:changePhone'); \n\t\t});\n\t\tthis._views.$countrySelect.requestFocus = function() {\n\t\t\tthis.removeFocus();\n\t\t\ttrackers.track('auth:changeCountryName'); \n\t\t\tweebyController.handleAction('pickCountry');\t\n\t\t}\n\n\t\tweebyController.on('HandlePickCountry', bind(this, 'onPickCountry'));\n\n\t\tvar user = weebyController.getUser();\n\t\tuser.getCountryIso(bind(this, 'onCountryIso'));\n\t\tweebyNative.getPhoneNumber(bind(this, 'onPhoneNumber'));\n\n\t\tthis._views.$verifyButton.on('InputSelect', bind(this, 'onVerify'));\n\t\tthis._views.$promptCountry.on('onChange', bind(this, 'countryCodeAutoComplete'));\n\t\tthis._views.$backButton.on('InputSelect', bind(this, 'onBack'));\n\t};\n\n\tthis.onBack = function() {\n\t\tweebyController.handleAction('back');\t\n\t}\n\n\tthis.onProcessPhoneChange = function(val, prevVal) {\n\t\t// check special case, delete non numeric character\n\t\tif (prevVal && \n\t\t\tval.replace(/[^0-9]/g, '') === prevVal.replace(/[^0-9]/g, '') && \n\t\t\tval.length < prevVal.length) {\n\t\t\tvar deleteIdx = -1;\n\t\t\tfor (var i = 0; i < val.length; i++) {\n\t\t\t\tif (val[i] !== prevVal[i]) {\n\t\t\t\t\tdeleteIdx = i - 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\t\n\n\t\t\tfor (var j = deleteIdx; j >= 0; j--) {\n\t\t\t\tif (!isNaN(+(val[j]))) {\n\t\t\t\t\tval = val.substring(0, j) + val.substring(j + 1, val.length);\t\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn PhoneFormat.formatLocal(this._iso, val);\n\t};\n\n\tthis.onCountryIso = function(data) {\n\t\tvar iso = data.iso; \n\t\tvar code;\n\n\t\tif (iso != null && iso.length == 2) {\n\t\t\tiso = iso.toUpperCase();\n\t\t\tcode = countryConstants.isoToCode[iso];\n\n\t\t\tif (code != null) {\n\t\t\t\tthis._iso = iso;\n\t\t\t\tthis._countryName = i18n.get(iso);\n\t\t\t\tthis._views.$countrySelect.setText(this._countryName);\n\t\t\t\tthis._views.$promptCountry.setText('+' + code);\n\t\t\t\tvar number = this._views.$promptPhone.getText();\n\t\t\t\tthis._views.$promptPhone.setText(PhoneFormat.formatLocal(this._iso, number));\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.onPhoneNumber = function(data) {\n\t\tvar number = data.number;\n\n\t\tif (number != null) {\n\t\t\tif (this._iso != null && this._iso.length == 2) {\n\t\t\t\tvar code = countryConstants.isoToCode[this._iso];\n\t\t\t\t// remove country code prefix if it exists\n\t\t\t\tnumber = number.replace(new RegExp('^' + code), '');\t\n\t\t\t\tnumber = PhoneFormat.formatLocal(this._iso, number);\n\n\t\t\t\tthis._views.$promptPhone.setText(number);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.countryCodeAutoComplete = function(value) {\n\t\tvar code = value != null ? value.replace(/[^0-9]/g, '') : value;\n\t\tvar name = code != null ? i18n.get(countryConstants.codeToIso[code]) : code;\n\n\t\tif (code == null || code.trim().length === 0) {\n\t\t\tthis._views.$countrySelect.setHint(i18n.get('chooseCountry'));\n\t\t\tthis._views.$countrySelect.setText('');\t\n\t\t} else if (name == null) {\n\t\t\tthis._views.$countrySelect.setHint(i18n.get('invalidCountryCode'));\n\t\t\tthis._views.$countrySelect.setText('');\t\n\t\t} else {\n\t\t\tthis._views.$countrySelect.setText(name);\n\t\t\tthis._iso = countryConstants.codeToIso[code];\n\t\t\tthis._countryName = name;\n\t\t}\n\t};\n\n\tthis.onPickCountry = function(name, iso, code) {\n\t\tif (code != null && code.length > 0) {\n\t\t\ttrackers.track('auth:editCountry', {index: code});\n\t\t\tthis._iso = iso;\n\t\t\tthis._countryName = i18n.get(iso);\n\t\t\tthis._views.$promptCountry.setText('+' + code);\n\t\t\tthis._views.$countrySelect.setText(this._countryName);\n\t\t\tvar number = this._views.$promptPhone.getText();\n\t\t\tthis._views.$promptPhone.setText(PhoneFormat.formatLocal(this._iso, number));\n\t\t}\n\t}\n\n\tthis.onVerify = function() {\n\t\tvar countryName = this._views.$countrySelect.getText();\n\t\tvar countryCode = this._views.$promptCountry.getText();\n\t\tvar phone = this._views.$promptPhone.getText();\n\n\t\ttrackers.track('auth:clickVerify');\n\n\t\tif (countryCode == null || countryCode.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:countryCodeError');\n\t\t\tthis.promptSingleButtonError(i18n.get('missingCountry'));\n\t\t} else if (phone == null || phone.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:phoneError');\n\t\t\tthis.promptSingleButtonError(i18n.get(\"phoneNumberNotValid\") + ' ' + this._countryName);\n\t\t} else if (countryName == null || countryName.length == 0) {\n\t\t\ttrackers.track('auth:clickVerify:countryCodeInvalid');\n\t\t\tthis.promptSingleButtonError(i18n.get(\"enteredInvalidCountryCode\"));\n\t\t} else {\n\t\t\tweebyController.handleAction('confirm', {\n\t\t\t\tsingleButton: false,\n\t\t\t\ttitle: countryCode + ' ' + PhoneFormat.formatLocal(this._iso, phone),\n\t\t\t\tmessage: i18n.get('phoneNumberCorrect'),\n\t\t\t\tleftButtonText: i18n.get(\"edit\"),\n\t\t\t\trightButtonText: i18n.get(\"okay\"),\n\t\t\t\trightButtonAction: 'verify',\n\t\t\t\tcountryCode: countryCode.replace('+', ''),\n\t\t\t\tphoneNumber: phone,\n\t\t\t\tcountryName: this._countryName,\n\t\t\t\tiso: this._iso\n\t\t\t});\n\n\t\t\tthis._number = this._views.$promptCountry.getText() + this._views.$promptPhone.getText();\n\t\t\ttrackers.track('auth:clickVerify:success', {number: this._number});\n\t\t}\n\t};\n\n\tthis.promptSingleButtonError = function(text) {\n\t\tweebyController.handleAction('error', {\n\t\t\tsingleButton: true,\n\t\t\ttitle: i18n.get(\"somethingNotRight\"),\n\t\t\tmessage: text,\n\t\t\tbuttonText: i18n.get(\"tryAgain\"),\n\t\t\tbuttonAction: 'ok'\n\t\t});\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/AuthCodeViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/AuthCodeViewController.js","friendlyPath":".controllers.game.AuthCodeViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"AuthCodeViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ui.TextEditView as TextEditView\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyAbTests\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_game_AuthCodeViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_AuthCodeViewController(function sdk_plugins_weeby_ui_controllers_game_AuthCodeViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'AuthCodeViewController',\n\t\t\t\tlayout: '$authcode',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._countryCode = '';\n\t\tthis._phoneNumber = '';\n\t\tthis._fullName = '';\n\t\tthis._username = '';\n\n\t\tthis._views.$backButton.on('InputSelect', bind(this, 'onBack'));\n\t\tthis._views.$verifyButton.on('InputSelect', bind(this, 'onVerify'));\n\t\tthis._views.$codeText.on('onChange', bind(this, 'onDetectChange'));\n\n\t\tweebyController.on('AuthCodeData', bind(this, 'onUpdate'));\n\t}\n\n\tthis.onUpdate = function(data) {\n\t\tthis._countryCode = data.countryCode;\n\t\tthis._phoneNumber = data.phoneNumber;\n\t\tthis._fullName = data.fullName;\n\t\tthis._username = data.username;\n\t}\n\n\tthis.onBack = function() {\n\t\tweebyController.handleAction('back');\n\t}\n\n\tthis.onVerify = function() {\n\t\tvar code = this._views.$codeText.getText();\n\n\t\tif (code != null && /[0-9]+/.test(code) && code.length == 4) {\n\t\t\tweebyController.handleAction('verify', {\n\t\t\t\tcountryCode: this._countryCode,\n\t\t\t\tphoneNumber: this._phoneNumber, \n\t\t\t\tcode: code,\n\t\t\t\tfullName: this._fullName,\n\t\t\t\tusername: this._username\n\t\t\t});\t\n\t\t} else {\n\t\t\tweebyController.handleAction('error', {\n\t\t\t\tcode: code\n\t\t\t});\n\t\t}\n\t}\n\n\tthis.onDetectChange = function(value) {\n\t\tif (value != null && /[0-9]+/.test(value) && value.length == 4) {\n\t\t\tthis._views.$codeText.removeFocus();\n\t\t\t\n\t\t\tweebyController.handleAction('verify', {\n\t\t\t\tcountryCode: this._countryCode,\n\t\t\t\tphoneNumber: this._phoneNumber, \n\t\t\t\tcode: value,\n\t\t\t\tfullName: this._fullName,\n\t\t\t\tusername: this._username\n\t\t\t});\n\t\t}\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/game/CrosspromoViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/CrosspromoViewController.js","friendlyPath":".controllers.game.CrosspromoViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"CrosspromoViewController.js","src":"jsio(\"import animate\");\njsio(\"import device\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.ParticleEngine as ParticleEngine\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ...config as uiConfig\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_game_CrosspromoViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_CrosspromoViewController(function sdk_plugins_weeby_ui_controllers_game_CrosspromoViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'CrosspromoViewController',\n\t\t\t\tlayout: '$crosspromo'\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$close.on('InputSelect', bind(this, 'onClose'));\n\t\tthis._views.$gameIcon.on('InputSelect', bind(this, 'onClick'));\n\t\tthis._views.$installButton.on('InputSelect', bind(this, 'onClick'));\n\t};\n\n\tthis.onClick = function () {\n\t\tweebyController.crosspromoManager.onInstall(this._crosspromo);\n\t\tthis._trackCrosspromo(\"crosspromo:click\", this._crosspromo.referrer);\n\t\tweebyController.handleAction('install');\n\t}\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\t\t// Fetch saved crosspromo data and reset view\n\t\tvar crosspromo = weebyController.crosspromoManager.getCrosspromoTrigger();\n\t\tthis._crosspromo = crosspromo;\n\t\tthis._views.$message.setText(i18n.get(\"crosspromoMessage\").replace('{game}', crosspromo.app.localizedName || crosspromo.app.name));\n\t\tthis._views.$gameIcon.setImage(crosspromo.app.images.iconSmall);\n\n\t\t//Show reward on Android, but not on iOS\n\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\tthis._views.$rewardPrefix.style.visible = true;\n\t\t\tthis._views.$rewardIcon.style.visible = true;\n\t\t\tthis._views.$rewardAmount.style.visible = true;\n\n\t\t\tthis._views.$rewardAmount.setText('+' + crosspromo.rewardAmount);\n\t\t} else {\n\t\t\tthis._views.$rewardPrefix.style.visible = false;\n\t\t\tthis._views.$rewardIcon.style.visible = false;\n\t\t\tthis._views.$rewardAmount.style.visible = false;;\n\t\t}\n\n\t\tif (crosspromo.friends && crosspromo.friends.length > 0) {\n\t\t\tthis._views.$friendsPlaying.style.visible = true;\n\t\t\tvar count = crosspromo.friends.length > 5 ? 5 : crosspromo.friends.length;\n\n\t\t\tvar totalWidth = this._views.$friendsPlaying.style.width;\n\t\t\tvar friendWidth = this._views.$friend1.style.width\n\t\t\tvar space = totalWidth - count * friendWidth;\n\t\t\tvar padding = ~~(space / (count + 1));\n\t\t\tfor (var i = 0; i < 5; i++) {\n\t\t\t\tvar friend = this._views['$profile' + (i + 1)];\n\t\t\t\tif (i >= count) {\n\t\t\t\t\tfriend.style.visible = false;\n\t\t\t\t} else {\n\t\t\t\t\tfriend.style.visible = true;\n\t\t\t\t\tfriend.style.x = padding + i * (padding + friendWidth);\n\t\t\t\t\tfriend.setImage(weebyController.getSocial().getPhotoImage(crosspromo.friends[i].id));\n\t\t\t\t\tfriend.onInputSelect = bind(this, 'onFriendProfile', crosspromo.friends[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis._views.$friendsPlaying.style.visible = false;\n\t\t}\n\n\t\tweebyLocalData.setLastCrosspromoTime(Date.now());\n\t\tweebyLocalData.setLastCrosspromoGamesPlayed(weebyLocalData.getGamesPlayed());\n\t\tthis._trackCrosspromo(\"crosspromo:show\", this._crosspromo.referrer);\n\t};\n\n\tthis.onClose = function () {\n\t\tthis._trackCrosspromo(\"crosspromo:close\", this._crosspromo.referrer);\n\t\tweebyController.handleAction('close');\n\t};\n\n\tthis.onFriendProfile = function (friend) {\n\t\tif (weebyController.isOffline()) {\n\t\t\tGC.app.weebyRootView.showDialog('offline');\n\t\t} else {\n\t\t\tweebyController.handleAction('viewFriendProfile', {user: friend});\n\t\t}\n\t};\n\n\tthis._trackCrosspromo = function (name, item) {\n\t\ttrackers.track(\n\t\t\tname, \n\t\t\titem\n\t\t);\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/controllers/game/GiftViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/game/GiftViewController.js","friendlyPath":".controllers.game.GiftViewController","directory":"sdk/plugins/weeby/ui/controllers/game/","filename":"GiftViewController.js","src":"jsio(\"import ui.widget.ListView as ListView\");\njsio(\"import ui.widget.CellView as CellView\");\n\njsio(\"import ...components.WeebyListViewController as WeebyListViewController\");\n\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_controllers_game_GiftViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_game_GiftViewController(function sdk_plugins_weeby_ui_controllers_game_GiftViewController(){return this.init&&this.init.apply(this,arguments)},WeebyListViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tlayout: '$gift',\n\t\t\t\toverrideCtors: {\n\t\t\t\t\t$rows: ListView,\n\t\t\t\t\t$row: CellView,\n\t\t\t\t\t$nickname: 'text',\n\t\t\t\t\t$score: 'text',\n\t\t\t\t\t$rank: 'text',\n\t\t\t\t\t$icon: 'image'\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._listData.key = 'index';\n\n\t\tif (!this._views.$rows) {\n\t\t\tthrow new Error('$row is required and was not defined');\n\t\t}\n\n\t\tthis._views.$rows.updateOpts({\n\t\t\tgetCell: bind(this, 'getCell'),\n\t\t\tdataSource: this._listData,\n\t\t\tisFixedSize: true,\n\t\t\tscrollX: false,\n\t\t\trecycle: true\n\t\t});\n\n\t\tthis._addEvent('$acceptButton', 'InputSelect', bind(this, 'onAccept'), true);\n\t\tthis._addEvent('$closeButton', 'InputSelect', bind(this, 'onClose'), true);\n\t};\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\tviewStates.views.$acceptButton.on('InputSelect', bind(this, 'onSelectGift', viewStates));\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\t\treturn root;\n\t};\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tvar views = viewStates.views;\n\n\t\tviewStates.data = data;\n\n\t\tif (views.$icon) {\n\t\t\tviews.$icon.setImage(weebyController.getSocial().getPhotoImage(data.gift.sourceUser.id));\n\t\t}\n\n\t\tif (views.$nickname) {\n\t\t\tviews.$nickname.setText(data.username);\n\t\t}\n\n\t\tif (data.selected) {\n\t\t\tviewStates.addState('$acceptButton', 'checked');\n\t\t} else {\n\t\t\tviewStates.removeState('$acceptButton', 'checked');\n\t\t}\n\t};\n\n\tthis.onSelectGift = function (viewStates) {\n\t\tvar data = viewStates.data;\n\t\tvar views = viewStates.views;\n\t\tif (data.selected) {\n\t\t\tdata.selected = false;\n\t\t\tviewStates.removeState('$acceptButton', 'checked');\n\t\t} else {\n\t\t\tdata.selected = true;\n\t\t\tviewStates.addState('$acceptButton', 'checked');\n\t\t}\n\t};\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\n\t\tvar list = weebyController.getReceivedGifts();\n\t\tthis._listData.clear();\n\t\tif (list) {\n\t\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\t\tvar item = list[i];\n\t\t\t\tthis._listData.add({\n\t\t\t\t\tindex: item.created + item.id,\n\t\t\t\t\tusername: item.sourceUser.nickname || item.sourceUser.name,\n\t\t\t\t\tgift: item,\n\t\t\t\t\tselected: true\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.onClose = function () {\n\t\tthis.disableInput();\n\n\t\tweebyController.handleAction('close');\n\t};\n\n\tthis.onAccept = function () {\n\t\tthis.disableInput();\n\n\t\tvar acceptedGifts = [];\n\t\tthis._listData.forEach(function (item) {\n\t\t\titem.selected && acceptedGifts.push(item.gift);\n\t\t});\n\n\t\tweebyController.handleAction('accept', {gifts: acceptedGifts});\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/controllers/profile/EditProfileViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/EditProfileViewController.js","friendlyPath":".controllers.profile.EditProfileViewController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"EditProfileViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ....trackers.trackers as trackers\");\njsio(\"import ....weebyController\");\njsio(\"import ...config as uiConfig\");\n\nvar sdk_plugins_weeby_ui_controllers_profile_EditProfileViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_EditProfileViewController(function sdk_plugins_weeby_ui_controllers_profile_EditProfileViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'ProfileEditViewController',\n\t\t\t\tlayout: '$editprofile',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\t\tthis._addEvent('$back', 'InputSelect', bind(weebyController, 'handleAction', 'back', null), true);\n\t\tthis._addEvent('$photoFrame', 'InputSelect', bind(this, 'onEditPhoto'), true);\n\t\tthis._addEvent('$fullnameFrame', 'InputSelect', bind(this, 'onEditFullName'), true);\n\t\tthis._addEvent('$nicknameFrame', 'InputSelect', bind(this, 'onEditNickName'), true);\n\n\t\tthis._views.$nicknamePrompt.on('Change', bind(this, 'onSetNickName'));\n\n\t\tvar user = weebyController.getUser();\n\t\tthis._views.$profilePhoto.setImage(user.getPhotoImage());\n\n\t\t// when native starts loading the photo, show a loading icon\n\t\tweebyController.on('PhotoBeginLoad', bind(this, 'onPhotoLoadStart'));\n\n\t\t// when we start sending the photo to the server, show a loading icon\n\t\tuser.on('BeforePhotoURLChange', bind(this, 'onPhotoLoadStart'));\n\n\t\t// when the photo is saved on the server, remove the loading icon\n\t\tuser.on('PhotoURLChanged', bind(this, 'onPhotoLoadEnd'));\n\n\t\tthis._views.$contents.setScrollBounds({\n\t\t\tminY: 0,\n\t\t\tmaxY: uiConfig.CONTENT_HEIGHT\n\t\t});\n\t};\n\n\tthis.onWeebyState = function (state) {\n\t\tswitch (state) {\n\t\t\tcase 'tos.pending':\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.onPhotoLoadStart = function() {\n\t\tif (this._views.$profilePhotoOverlay) {\n\t\t\tthis._views.$profilePhotoOverlay.style.visible = true;\n\t\t}\n\t};\n\n\tthis.onPhotoLoadEnd = function () {\n\t\tif (this._views.$profilePhotoOverlay) {\n\t\t\tthis._views.$profilePhotoOverlay.style.visible = false;\n\t\t}\n\t}\n\n\tthis.onEditPhoto = function() {\n\t\tif (this._views.$profilePhotoOverlay) {\n\t\t\tthis._views.$profilePhotoOverlay.style.visible = false;\n\t\t}\n\t\ttrackers.track('editProfile:startPhoto');\n\t\ttrackers.track('editProfile:startTakePhoto'); // ????\n\t\tweebyController.handleAction('editPhoto');\n\t\t//TODO make this work in the simulator\n\t};\n\n\tthis.onEditFullName = function() {\n\t\ttrackers.track('editProfile:startName');\n\t\tweebyController.handleAction('editFullname');\n\t};\n\n\tthis.onEditNickName = function() {\n\t\ttrackers.track('editProfile:startNickname');\n\t\tthis._views.$nicknamePrompt.showPrompt();\n\t};\n\n\tthis.onSetNickName = function(nickname) {\n\t\ttrackers.track('editProfile:nicknameSet');\n\t\tweebyController.getUser().setNickname(nickname, function (error) {\n\t\t\ttrackers.track('editProfile:nicknameSet:success:' + (error ? 'fail' : 'success'), {nickname: nickname});\n\t\t});\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/profile/EditNameViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/EditNameViewController.js","friendlyPath":".controllers.profile.EditNameViewController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"EditNameViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_profile_EditNameViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_EditNameViewController(function sdk_plugins_weeby_ui_controllers_profile_EditNameViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'EditNameViewController',\n\t\t\t\tlayout: '$editname'\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$verifyButton.on('InputSelect', bind(this, 'onVerify'));\n\t\tthis._views.$back.on('InputSelect', bind(this, 'onBack'));\n\t};\n\n\tthis.onVerify = function () {\n\t\tthis.disableInput();\n\n\t\tvar name = this._views.$promptName.getText();\n\t\tweebyController.handleAction('verify', {name: name});\n\t};\n\n\tthis.onBack = function() {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('cancel');\n\t};\n\n\tthis.onWeebyState = function (state) {\n\t\tswitch (state) {\n\t\t\tdefault:\n\t\t\t\tthis.enableInput();\n\t\t\t\tbreak;\n\t\t}\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/controllers/profile/FullnameEditViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/FullnameEditViewController.js","friendlyPath":".controllers.profile.FullnameEditViewController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"FullnameEditViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyStates\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_profile_FullnameEditViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_FullnameEditViewController(function sdk_plugins_weeby_ui_controllers_profile_FullnameEditViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'FullnameEditViewController',\n\t\t\t\tlayout: '$fullnameedit',\n\t\t\t \talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$back.on('InputSelect', bind(this, 'onBack'));\n\t\tthis._views.$changeFullnameButton.on('InputSelect', bind(this, 'onChangeFullname'));\n\t\tthis._views.$changeNicknameButton.on('InputSelect', bind(this, 'onChangeNickname'));\n\t};\n\n\tthis.onBack = function () {\n\t\tweebyController.handleAction('back');\n\t};\n\n\tthis.onChangeFullname = function () {\n\t\tweebyController.handleAction('fullname');\n\t};\n\n\tthis.onChangeNickname = function () {\n\t\tweebyController.handleAction('nickname');\n\n\t\tsetTimeout(function () {\n\t\t\tjsio(\"import ...WeebyViews\");\n\n\t\t\tvar editProfileController = WeebyViews.getInstance().getViewController(weebyStates.states.STATE_EDIT_PROFILE);\n\t\t\tif (editProfileController.onEditNickName) {\n\t\t\t\teditProfileController.onEditNickName();\n\t\t\t}\n\t\t}, 0);\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/profile/FullnameVerifyViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/FullnameVerifyViewController.js","friendlyPath":".controllers.profile.FullnameVerifyViewController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"FullnameVerifyViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_profile_FullnameVerifyViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_FullnameVerifyViewController(function sdk_plugins_weeby_ui_controllers_profile_FullnameVerifyViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'FullnameVerifyViewController',\n\t\t\t\tlayout: '$fullnameverify',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$back.on('InputSelect', bind(this, 'onBack'));\n\t\tthis._views.$changeFullnameButton.on('InputSelect', bind(this, 'onChangeFullname'));\n\t\tthis._views.$cancelFullnameButton.on('InputSelect', bind(this, 'onCancelFullname'));\n\n\t\tweebyController.on('FullnameVerifyError', bind(this, 'onFullnameVerifyError'));\n\t};\n\n\tthis.onShow = function () {\n\t\tthis._views.$phoneNumber.setText(weebyController.getUser().getPhoneNumber() || 'Phone number');\n\n\t\tthis._views.$sendingText.style.visible = false;\n\t\tthis._views.$sendingError.style.visible = false;\n\t}\n\n\tthis.onBack = function () {\n\t\tweebyController.handleAction('back');\n\t};\n\n\tthis.onChangeFullname = function () {\n\t\tthis._views.$sendingText.style.visible = true;\n\t\tthis._views.$sendingError.style.visible = false;\n\t\tweebyController.handleAction('change');\n\t};\n\n\tthis.onCancelFullname = function () {\n\t\tweebyController.handleAction('cancel');\n\t};\n\n\tthis.onFullnameVerifyError = function () {\n\t\tthis._views.$sendingText.style.visible = false;\n\t\tthis._views.$sendingError.style.visible = true;\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/profile/FullnameCodeViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/FullnameCodeViewController.js","friendlyPath":".controllers.profile.FullnameCodeViewController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"FullnameCodeViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import device\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_profile_FullnameCodeViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_FullnameCodeViewController(function sdk_plugins_weeby_ui_controllers_profile_FullnameCodeViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'FullnameCodeViewController',\n\t\t\t\tlayout: '$fullnamecode',\n\t\t\t \talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$back.on('InputSelect', bind(this, 'onBack'));\n\t\tthis._views.$confirmCodeButton.on('InputSelect', bind(this, 'onConfirmCode'));\n\t\tthis._views.$fullnameCodeText.style.visible = false;\n\t\tthis._views.$codeText.subscribe('Change', this, 'onChangeCode');\n\n\t\tweebyController.on('FullnameCodeError', bind(this, 'onFullnameCodeError'));\n\t};\n\n\tthis.onShow = function () {\n\t\tthis._views.$fullnameCodeText.style.visible = false;\n\t\tthis._views.$fullnameCodeErrorText.style.visible = false;\n\t\tthis._views.$codeText.setText('');\n\t};\n\n\tthis.onBack = function () {\n\t\tweebyController.handleAction('back');\n\t};\n\n\tthis.onConfirmCode = function () {\n\t\tvar code = this._views.$codeText.getText();\n\t\tif ((code === null) || (code.replace(/^\\s+|\\s+$/g, '') === '')) {\n\t\t\tthis._views.$fullnameCodeText.style.visible = false;\n\t\t\tthis._views.$fullnameCodeErrorText.style.visible = true;\n\t\t\tthis._views.$fullnameCodeErrorText.setText(i18n.get('fullnameVerifyingCodeNone'));\n\t\t} else {\n\t\t\tthis._views.$fullnameCodeText.style.visible = true; // Status text, showing that the code is checked...\n\t\t\tthis._views.$fullnameCodeErrorText.style.visible = false;\n\t\t\tweebyController.handleAction('confirmCode', {code: this._views.$codeText.getText()});\n\t\t}\n\t};\n\n\tthis.onChangeCode = function () {\n\t\tthis._views.$fullnameCodeText.style.visible = false;\n\t\tthis._views.$fullnameCodeErrorText.style.visible = false;\n\t};\n\n\tthis.onFullnameCodeError = function() {\n\t\tthis._views.$fullnameCodeText.style.visible = false; // Status text, showing that the code is checked...\n\t\tthis._views.$fullnameCodeErrorText.style.visible = true; \n\t\tthis._views.$fullnameCodeErrorText.setText(i18n.get('fullnameVerifyingCodeError'));\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/profile/FullnameChangeViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/FullnameChangeViewController.js","friendlyPath":".controllers.profile.FullnameChangeViewController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"FullnameChangeViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_controllers_profile_FullnameChangeViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_FullnameChangeViewController(function sdk_plugins_weeby_ui_controllers_profile_FullnameChangeViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'FullnameChangeViewController',\n\t\t\t\tlayout: '$fullnamechange',\n\t\t\t \talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$back.on('InputSelect', bind(this, 'onCancel'));\n\t\tthis._views.$changeFullnameButton.on('InputSelect', bind(this, 'onChangeFullname'));\n\t};\n\n\tthis.onShow = function () {\n\t\tthis._views.$fullnameErrorText.style.visible = false;\n\t};\n\n\tthis.onCancel = function () {\n\t\tweebyController.handleAction('cancel');\n\t};\n\n\tthis.onChangeFullname = function () {\n\t\tvar fullname = this._views.$fullnameText.getText();\n\t\tif ((fullname === null) || (fullname.replace(/^\\s+|\\s+$/g, '') === '')) {\n\t\t\tthis._views.$fullnameErrorText.style.visible = true;\n\t\t} else {\n\t\t\tthis._views.$fullnameErrorText.style.visible = false;\n\t\t\tweebyController.handleAction('change', {fullname: fullname});\n\t\t}\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/profile/ProfileViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/ProfileViewController.js","friendlyPath":".controllers.profile.ProfileViewController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"ProfileViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....i18n\");\njsio(\"import .SocialTabController\");\n\nvar sdk_plugins_weeby_ui_controllers_profile_ProfileViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_ProfileViewController(function sdk_plugins_weeby_ui_controllers_profile_ProfileViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\tname: 'ProfileViewController',\n\t\t\t\tlayout: '$profile',\n\t\t\t\ttransition: 'slideup',\n\t\t\t\talignTop: true\n\t\t\t}\n\t\t);\n\n\t\tsupr(this, 'init', [opts]);\n\t\t\n\t\tthis._views.$setStatusText\n\t\t\t.setPrompt(i18n.get('enterStatusText'))\n\t\t\t.setOkButton(i18n.get('submit'))\n\t\t\t.setCancelButton(i18n.get('cancel'))\n\t\t\t.on('Submit', bind(this, 'onEditStatus'));\n\n\t\tthis._addEvent('$editStatusButton', 'InputSelect', bind(this, function() {\n\t\t\ttrackers.track('editProfile:startStatus');\n\t\t\tthis._views.$setStatusText.showPrompt();\n\t\t}), true);\n\n\t\tvar user = weebyController.getUser();\n\t\tuser.subscribe('NameChanged', bind(this, 'onNameChanged'));\n\t\tuser.subscribe('NicknameChanged', bind(this, 'onNicknameChanged'));\n\t\tuser.subscribe('StatusChanged', bind(this, 'onStatusChanged'));\n\t\tuser.subscribe('updated', bind(this, 'onUserUpdate'));\n\t\tthis.onUserUpdate(user);\n\n\t\tthis._views.$profilePhoto.setImage(user.getPhotoImage());\n\t\tthis._views.$statusPhoto.setImage(user.getPhotoImage());\n\t};\n\n\tthis.getHeader = function () {\n\n\t\tif (!this._headerView) {\n\t\t\tthis._headerView = this.inflate('$editButton').mainView;\n\t\t\tthis._headerView.on('InputSelect', bind(this, 'onEdit'));\n\t\t}\n\t\t\n\t\treturn {\n\t\t\ttitle: weebyController.getUser().getName(),\n\t\t\trightView: this._headerView\n\t\t};\n\t}\n\n\tthis.onShow = function (type, transition, level) {\n\t\tthis.onUserUpdate(weebyController.getUser());\n\t\tSocialTabController.getInstance().showFor(this, type, transition);\n\t}\n\n\tthis.onHide = function (type, transition, level) {\n\t\tSocialTabController.getInstance().hideFor(this, type, transition);\n\t}\n\n\tthis.onAcceptTermsChange = function (isAccepted) {\n\t\tif (this._isAccepted != isAccepted) {\n\t\t\tthis._isAccepted = isAccepted;\n\t\t}\n\t};\n\n\tthis.onTOSData = function (data) {\n\t};\n\n\tthis.onWeebyState = function (state) {\n\t\tswitch (state) {\n\t\t\tcase 'tos.pending':\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tthis.onAcceptTerms = function () {\n\t\tconsole.log('Accept terms');\n\t};\n\n\tthis.onSignin = function () {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('login');\n\t};\n\n\tthis.onEdit = function() {\n\t\tweebyController.handleAction('edit');\n\t};\n\n\tthis.onEditStatus = function(text) {\n\t\ttrackers.track('editProfile:statusSet');\n\t\tweebyController.getUser().setStatus(text, function (error) {\n\t\t\ttrackers.track('editProfile:statusSet:' + (error ? 'fail' : 'success'));\n\t\t});\n\t};\n\n\tthis.onUserUpdate = function (user) {\n\t\tthis.onNameChanged(user.getName());\n\t\tthis.onNicknameChanged(user.getNickname());\n\t\tthis.onStatusChanged(user.getStatus());\n\t};\n\n\tthis.onNicknameChanged = function (newNickname) {\n\t\tvar name = newNickname || weebyController.getUser().getName();\n\t\tthis._views.$nickText.setText(name);\n\t\tthis._views.$nickNameText.setText(name);\n\t};\n\n\tthis.onNameChanged = function (name) {\n\t\tvar name = name || weebyController.getUser().getName();\n\t\tthis._views.$nameText.setText(name);\n\n\t\tSocialTabController.getInstance().update();\n\t}\n\n\tthis.onStatusChanged = function (newStatus) {\n\t\tif (!newStatus) {\n\t\t\tthis._viewStates.addState('$statusText', 'noStatus');\n\t\t\tthis._views.$statusText.setText(i18n.get('statusMessage'));\n\t\t} else {\n\t\t\tthis._viewStates.removeState('$statusText', 'noStatus');\n\t\t\tthis._views.$statusText.setText(newStatus);\n\t\t}\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/controllers/profile/SocialTabController.js":{"path":"sdk/plugins/weeby/ui/controllers/profile/SocialTabController.js","friendlyPath":".SocialTabController","directory":"sdk/plugins/weeby/ui/controllers/profile/","filename":"SocialTabController.js","src":"jsio(\"import ....weebyController\");\njsio(\"import ....weebyStates\");\njsio(\"import ....models.chatModel as chatModel\");\n\njsio(\"import ...config as uiConfig\");\n\njsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ...components.transitions as transitions\");\n\njsio(\"import ..weeby.ChatViewController as ChatViewController\");\n\nvar states = weebyStates.states;\n\nvar sdk_plugins_weeby_ui_controllers_profile_SocialTabController=__class__;exports=sdk_plugins_weeby_ui_controllers_profile_SocialTabController(function sdk_plugins_weeby_ui_controllers_profile_SocialTabController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\n\tvar tabMap = {\n\t\t'$myProfile': states.STATE_PROFILE,\n\t\t'$chats': states.STATE_CHAT_LIST,\n\t\t'$friends': states.STATE_FRIEND_LIST\n\t};\n\n\tthis.init = function (opts) {\n\t\tjsio(\"import ...WeebyViews\");\n\n\t\tsupr(this, 'init', [merge(opts, {\n\t\t\tname: 'SocialTabController',\n\t\t\tviews: WeebyViews.getInstance().getViewDef(states.STATE_SOCIAL_TABS),\n\t\t\tlayout: '$tabs'\n\t\t})]);\n\n\t\tthis._showFor = [];\n\n\t\tthis.inflate('$header', this._viewStates);\n\t\tthis._header = this._views.$header;\n\n\t\tthis._view.style.scale = uiConfig.FULL_SCREEN_SCALE_RELATIVE;\n\t\tthis._header.style.scale = uiConfig.FULL_SCREEN_SCALE_RELATIVE;\n\n\t\tweebyController.on('StateChanged', bind(this, '_onStateChanged'));\n\n\t\tthis._addEvent('$back', 'InputSelect', bind(this, 'onBack'), true);\n\n\t\tfor (var key in tabMap) {\n\t\t\tthis._addEvent(key, 'InputSelect', bind(this, 'switchTab', key));\n\t\t}\n\n\t\tthis._views.$profilePhoto.setImage(weebyController.getUser().getPhotoImage());\n\n\t\tchatModel.on('Message', bind(this, 'update'));\n\t}\n\n\tthis.onBack = function() {\n\t\tweebyController.handleAction('back');\n\t};\n\n\tthis._onStateChanged = function (state) {\n\t\tfor (var key in tabMap) {\n\t\t\tif (tabMap[key] == state) {\n\t\t\t\tthis._viewStates.addState(key, 'active');\n\t\t\t} else {\n\t\t\t\tthis._viewStates.removeState(key, 'active');\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tthis.update = function () {\n\t\tvar view = WeebyViews.getInstance().getCurrentView();\n\t\tif (view) {\n\t\t\tthis._updateHeader(view.getHeader && view.getHeader());\n\t\t}\n\n\t\t// let chat view add messages\n\t\tsetTimeout(bind(this, function () {\n\t\t\tvar unread = ChatViewController.getTotalUnread();\n\t\t\tif (unread) {\n\t\t\t\tthis._views.$unreadNotification.style.visible = true;\n\t\t\t\tthis._views.$unreadCount.setText(unread);\n\t\t\t} else {\n\t\t\t\tthis._views.$unreadNotification.style.visible = false;\n\t\t\t}\n\t\t}), 0);\n\t}\n\n\tthis._updateHeader = function (header) {\n\t\tvar title = header && header.title || '';\n\t\tvar rightView = header && header.rightView || null;\n\n\t\tthis._views.$title.setText(title);\n\n\t\tif (this._rightView != rightView) {\n\t\t\tif (this._rightView) {\n\t\t\t\tthis._rightView.removeFromSuperview()\n\t\t\t}\n\n\t\t\tthis._rightView = rightView;\n\t\t\tif (this._rightView) {\n\t\t\t\tthis._header.addSubview(this._rightView);\n\t\t\t\tthis._rightView.style.x = this._header.style.width - this._rightView.style.width;\n\t\t\t\tthis._rightView.style.y = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.switchTab = function (name) {\n\t\tvar nextState = tabMap[name];\n\t\tif (nextState) {\n\t\t\tweebyController.setState(nextState, 'replace');\n\t\t}\n\t}\n\n\tthis.showFor = function (target, type, transition) {\n\t\tif (this._showFor.indexOf(target) == -1) {\n\t\t\tthis._showFor.push(target);\n\n\t\t\tthis._header.style.x = 0;\n\t\t\tthis._view.style.x = 0;\n\t\t\tthis._view.style.y = uiConfig.MAX_HEIGHT - this._view.style.height * this._view.style.scale;\n\t\t\tGC.app.weebyRootView.addSubview(this._view);\n\t\t\tGC.app.weebyRootView.addSubview(this._header);\n\t\t\tif (!this._isVisible) {\n\t\t\t\tif (type == 'back') {\n\t\t\t\t\ttype = 'replace';\n\t\t\t\t}\n\t\t\t\tthis.show(type, transition);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.onShow = function (type, transition, level) {\n\t\ttransitions.show(this._header, transition);\n\n\t\tif (type == 'push') {\n\t\t\tthis._views.$backImage.style.anchorX = this._views.$backImage.style.width / 2;\n\t\t\tthis._views.$backImage.style.anchorY = this._views.$backImage.style.height / 2;\n\t\t\tthis._views.$backImage.getAnimation().clear().wait(100).then({r: Math.PI});\n\t\t}\n\t}\n\n\tthis.onHide = function (type, transition, level) {\n\t\ttransitions.hide(this._header, transition);\n\n\t\tif (type == 'pop') {\n\t\t\tthis._views.$backImage.getAnimation().clear().wait(50).then({r: 0});\n\t\t}\n\t}\n\n\tthis.hideFor = function (target, type, transition) {\n\t\tvar index = this._showFor.indexOf(target);\n\t\tif (index != -1) {\n\t\t\tthis._showFor.splice(index, 1);\n\t\t\tif (!this._showFor.length) {\n\t\t\t\tthis.hide(type, transition);\n\n\t\t\t\ttransitions.hide(this._header, transition);\n\t\t\t}\n\t\t}\n\t}\n});\n\nvar _instance = null;\nexports.getInstance = function () {\n\treturn _instance || (_instance = new exports());\n}\n","pre":true},"sdk/plugins/weeby/models/chatModel.js":{"path":"sdk/plugins/weeby/models/chatModel.js","friendlyPath":"....models.chatModel","directory":"sdk/plugins/weeby/models/","filename":"chatModel.js","src":"jsio(\"import event.Emitter as Emitter\");\njsio(\"import ..trackers.trackers as trackers\");\njsio(\"import ..weebyNative as weebyNative\");\n\nchatModel=__class__;var chatModel=chatModel(function chatModel(){return this.init&&this.init.apply(this,arguments)},Emitter, function(supr) {\n\n\n    this._connectedId = null;\n    this._connected = false;\n    this._darkLaunchIntervalId = -1;\n    this._darkLaunchData = {};\n    this._messageCbs = {};\n\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', arguments);\n\n        // emit on this\n        weebyNative.on('ChatMessage', bind(this, function (message) {\n            trackers.track(\"chat:messageReceived\", message);\n            this.emit('Message', message);\n        }));\n\n        weebyNative.on('ChatMessageSent', bind(this, function (message) {\n            this.emit('MessageSent', message);\n        }));\n\n        weebyNative.on('ChatMessageSuccess', bind(this, function (data) {\n            trackers.track(\"chat:messageSuccess\", data);\n            if (data && data.success) {\n                var localMessageID = data && data.localMessageID;\n                var cb = this._messageCbs[localMessageID];\n                this._messageCbs[localMessageID] = null;\n                cb && cb(data);\n            }\n            this.emit('MessageSuccess', data);\n        }));\n\n\n//        weebyNative.on('ChatDarkLaunch', bind(this, function(data) {\n//            this._darkLaunchData = data;\n//            trackers.track(\"chat:darkLaunch\", data);\n//            this.emit('DarkLaunch', data);\n//        }));\n\n        weebyNative.on('ChatConnect', bind(this, function(data) {\n            this._connected = data && data.isConnected;\n            trackers.track(\"chat:connected\", data);\n        }));\n\t};\n\n    this.getConnectedId = function() {\n        return this._connectedId;\n    }\n\n    this.isConnected = function() {\n        return this._connected;\n    };\n\n    this.online = function() {\n        weebyNative.online();\n    }\n\n    this.offline = function() {\n        weebyNative.offline();\n    }\n\n    this.connect = function(id, key) {\n        this._connectedId = id;\n        trackers.track(\"chat:connecting\", {id: id, key: key});\n        weebyNative.connectToChatServer(id, key);\n        //using a test account for now\n        //weebyNative.connectToChatServer(\"01fa100000000094c98b4e69\", \"97CF7F67-B217-4ED2-8B45-286280AFE453\");\n    };\n\n    this.disconnect = function() {\n        //disconnect right now\n        weebyNative.disconnectFromChatServer();\n        this._connected = false;\n    }\n\n    this.postDisconnect = function(ms) {\n        //disconnect in ms\n        weebyNative.postDisconnectFromChatServer(ms);\n    }\n\n    this.sendMessage = function(id, message, cb) {\n        trackers.track(\"chat:sendMessageStart\");\n        var uuid = weebyNative.sendChatMessage(id, message);\n        this._messageCbs[uuid] = cb;\n        trackers.track(\"chat:sendMessageEnd\", data);\n        return uuid;\n    };\n\n    this.setupDarkLaunch = function(id, ladder) {\n        // if (this._darkLaunchData.isOn && this._darkLaunchData.msTimeToSend) {\n        //     if (ladder) {\n        //         var items = ladder.items.filter(bind(this, function(item) {\n        //             return item.id != this._connectedId\n        //         }));\n        //         if (items && items.length > 0) {\n        //             var i = Math.floor(Math.random() * ladder.items.length);\n        //             var user = items[i].user;\n        //             if (this._darkLaunchIntervalId != -1) {\n        //                 clearInterval(this._darkLaunchIntervalId);\n        //             }\n        //             this._darkLaunchIntervalId = setInterval(bind(this, function() {\n        //                 this.sendMessage(user.id, \"Random Message: \" + Math.floor(Math.random() * 10000));\n        //             }), this._darkLaunchData.msTimeToSend);\n        //         }\n        //     }\n        // }\n    };\n\n\n});\n\nvar chatModel = new chatModel();\nexports = chatModel;\n","pre":true},"sdk/plugins/weeby/ui/controllers/weeby/ChatViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/weeby/ChatViewController.js","friendlyPath":"..weeby.ChatViewController","directory":"sdk/plugins/weeby/ui/controllers/weeby/","filename":"ChatViewController.js","src":"jsio(\"import lib.PubSub\");\n\njsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ....i18n\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyStates\");\njsio(\"import ...config as uiConfig\");\n\njsio(\"import ....models.chatModel as chatModel\");\njsio(\"import ....models.globalStorageModel as globalStorageModel\");\n\njsio(\"import device\");\n\njsio(\"import squill.models.DataSource as DataSource\");\n\n// store ThreadViewControllers indexed by their thread ID (same as user ID for single-recipient, non-group chat)\nvar _chats = new DataSource({\n\t\tkey: '_threadID',\n\t\tsorter: function (item) {\n\t\t\treturn item._lastDate || 0;\n\t\t},\n\t\treverse: true\n\t});\n\nvar _instance = null;\n\nvar states = weebyStates.states;\n\nMessageBlock=__class__;var MessageBlock=MessageBlock(function MessageBlock(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\tthis.init = function () {\n\t\tthis.messages = [];\n\t}\n\n\tthis.add = function (ctx, messageData) {\n\t\tif (!this.userID) { this.userID = messageData.sender; }\n\t\tthis.messages.push(messageData);\n\t\tthis.emit('message', ctx, messageData);\n\t}\n\n\tthis.getLast = function () {\n\t\treturn this.messages[this.messages.length - 1];\n\t}\n\n\tthis.getCount = function () {\n\t\treturn this.messages.length;\n\t}\n\n});\n\nMessageStorage=__class__;var MessageStorage=MessageStorage(function MessageStorage(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar MAX_HISTORY = 200;\n\n\tthis.init = function () {\n\t\tthis._cache = {};\n\t}\n\n\tthis.getHistory = function (threadID) {\n\t\tvar history = globalStorageModel.getData('chat.' + threadID) || [];\n\t\tif (!isArray(history)) { history = []; }\n\t\treturn history;\n\t}\n\n\tthis.addMessage = function (threadID, messageData) {\n\t\tvar cache = this._cache[threadID];\n\t\tif (!cache) {\n\t\t\tcache = this._cache[threadID] = [];\n\t\t}\n\n\t\tcache.push(messageData);\n\t}\n\n\tthis.updateMessage = function (threadID, messageData) {\n\t\t// console.log(\"UPDATE MESSAGE FROM THREAD\", threadID, messageData.uuid, messageData.localMessageID);\n\n\t\t// find the message in the cache and update it replacing\n\t\t// the temporary local ID with the message uuid\n\t\t// var cache = this._cache[threadID];\n\t\t// for (var i = cache.length - 1; i >= 0; --i) {\n\t\t// \tvar message = cache[i];\n\t\t// \tif (message.uuid == '*local*' + messageData.localMessageID) {\n\t\t// \t\tmessage.uuid = messageData.uuid;\n\t\t// \t\tbreak;\n\t\t// \t}\n\t\t// }\n\t}\n\n\tfunction fastSort () { return +new Date(this.date); }\n\n\tthis.getOpenedThreads = function () {\n\t\treturn globalStorageModel.getData('chat.open-threads') || [];\n\t}\n\n\tthis.persistOpenedThreads = function () {\n\t\tvar openedChats = [];\n\t\t_chats.forEach(function (chat) {\n\t\t\tif (chat.getLastDate()) {\n\t\t\t\topenedChats.push(chat.getThreadID());\n\t\t\t}\n\t\t});\n\n\t\tglobalStorageModel.setData('chat.open-threads', openedChats);\n\t}\n\n\tthis.persist = function () {\n\t\tObject.keys(this._cache).forEach(bind(this, 'persistThread'));\n\n\t\tthis._cache = {};\n\t}\n\n\tthis.persistThread = function (threadID) {\n\t\tvar messages = this._cache[threadID];\n\t\tif (messages) {\n\t\t\tvar history = this.getHistory(threadID);\n\t\t\tvar n = history.length;\n\t\t\tvar ids = {};\n\t\t\tfor (var i = 0; i < n; ++i) {\n\t\t\t\tids[history[i].uuid] = true;\n\t\t\t\t\n\t\t\t\thistory[i].toString = fastSort;\n\t\t\t}\n\n\t\t\tn = messages.length;\n\t\t\tfor (var i = 0; i < n; ++i) {\n\t\t\t\tvar message = messages[i];\n\t\t\t\tif (!(message.uuid in ids)) {\n\t\t\t\t\tmessage.toString = fastSort;\n\t\t\t\t\tmessage.date = new Date(message.date).toISOString();\n\t\t\t\t\thistory.push(message);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thistory.sort();\n\t\t\tif (history.length > MAX_HISTORY) {\n\t\t\t\thistory = history.slice(history.length - MAX_HISTORY);\n\t\t\t}\n\n\t\t\t// max-length 43:\n\t\t\t//      5: 'chat.'\n\t\t\t//   + 32: uuid/threadID\n\t\t\t//   [ 37 ]\n\t\t\tglobalStorageModel.setData('chat.' + threadID, history);\n\t\t\tdelete this._cache[threadID];\n\t\t}\n\t}\n});\n\nvar _storage = new MessageStorage();\n\n// TODO: don't autoscroll if the user has scrolled away from the bottom?\n// TODO: or don't autoscroll while the user is trying to scroll\n\nThreadViewController=__class__;var ThreadViewController=ThreadViewController(function ThreadViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [merge(opts, {noLayout: true})]);\n\n\t\tthis._threadID = opts.threadID;\n\n\t\tthis._history = _storage.getHistory(this._threadID);\n\t\tthis._unreadMessages = [];\n\t\tthis._rendered = {};\n\n\t\tthis._social = weebyController.getSocial();\n\n\t\tthis._bottom = 0;\n\t\tthis._view = null;\n\t\tthis._viewStates = null;\n\n\t\t// should always be an ISO string from the history at this point in time\n\t\tvar lastMessage = this.getLastMessage();\n\t\tthis._lastDate = lastMessage && lastMessage.date;\n\t}\n\n\t// userID and threadID are the same for single-recipient, non-group chat\n\tthis.getUserID = function () { return this._threadID; }\n\tthis.getThreadID = function () { return this._threadID; }\n\n\tthis.getLastDate = function () { return this._lastDate; }\n\tthis.toString = function () { return this._lastDate; }\n\n\t// opts:\n\t//   * id: message ID\n\t//   * sender: sender user ID (can be yourself)\n\t//   * threadID: should be the same as this._threadID\n\t//   * message: text\n\t//   * date: JavaScript date\n\tthis.addMessage = function (messageData) {\n\t\tthis._unreadMessages.push(messageData);\n\n\t\t// add message to storage\n\t\t_storage.addMessage(this._threadID, messageData);\n\n\t\t// signal this chat item changed\n\t\t_chats.updated(_chats.get(this._threadID));\n\t}\n\n\tthis.didSendMessage = function (messageData) {\n\t\t_storage.updateMessage(this._threadID, messageData);\n\n\t\t// for (var i in this._unreadMessages) {\n\t\t// \tif (this._unreadMessages[i].localMessageID == messageData.localMessageID) {\n\t\t// \t\tlogger.log(\"jared did send message with uuid \", messageData.localMessageID);\n\t\t// \t\tbreak;\n\t\t// \t\t//update as sent\n\t\t// \t}\n\t\t// }\n\t}\n\n\tthis.getUnreadMessages = function () { return this._unreadMessages; }\n\tthis.getLastMessage = function () {\n\t\tvar data = this._lastMessage && this._lastMessage.getLast();\n\t\tif (!data && this._history) {\n\t\t\tdata = this._history[this._history.length - 1];\n\t\t}\n\t\treturn data;\n\t}\n\t\n\tthis._updateBounds = function () {\n\t\tvar bounds = this._scroller.getScrollBounds();\n\t\tbounds.maxY = this._bottom;\n\t}\n\n\tthis.setViewStates = function () {\n\t\tsupr(this, 'setViewStates', arguments);\n\n\t\tvar scroller = this._scroller = this._viewStates.mainView;\n\t\tvar scrollerRender = scroller.render;\n\t\tscroller.render = bind(this, '_render', scrollerRender);\n\t\t\n\t\tvar bounds = this._scroller.getScrollBounds();\n\t\tbounds.minY = 0;\n\n\t\tthis._initialTop = this._view.style.y;\n\t\tthis._updateBounds();\n\t}\n\n\tthis.setScreenBottom = function (screenBottom) {\n\t\tvar unusedHeight = Math.max(0, this._view.style.height - this._bottom);\n\t\tvar top = this._initialTop - Math.max(0, screenBottom - unusedHeight);\n\t\ttop = Math.min(this._initialTop, top);\n\t\tthis._view.getAnimation().now({y: top});\n\t\tif (top != this._initialTop && !unusedHeight) {\n\t\t\tthis.scrollToBottom();\n\t\t}\n\t}\n\n\t// create views for pending chat messages once we're visible\n\tthis._render = function (originalRender, ctx, opts) {\n\t\tif (originalRender) {\n\t\t\toriginalRender.call(this._scroller, ctx, opts);\n\t\t}\n\n\t\tif (this._history.length) {\n\t\t\tvar messages = this._history;\n\t\t\tthis._history = [];\n\t\t\tthis._renderMessages(ctx, messages);\n\t\t}\n\n\t\tif (this._unreadMessages.length) {\n\t\t\tvar messages = this._unreadMessages;\n\t\t\tthis._unreadMessages = [];\n\t\t\tthis._renderMessages(ctx, messages);\n\n\t\t}\n\t}\n\n\tthis._renderMessages = function (ctx, messages) {\n\t\tvar n = messages.length;\n\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tvar message = messages[i];\n\t\t\tif (!this._rendered[message.uuid]) {\n\t\t\t\tthis._rendered[message.uuid] = true;\n\t\t\t\tthis._renderMessage(ctx, message);\n\t\t\t}\n\t\t}\n\n\t\t_chats.updated(_chats.get(messages[0].threadID));\n\t}\n\n\t// called during render for text measuring\n\tthis._renderMessage = function (ctx, messageData) {\n\t\tvar date = messageData.date;\n\t\tif (!(date instanceof Date)) {\n\t\t\tdate = new Date(date);\n\t\t}\n\n\t\tvar day = date.getDay();\n\t\tvar dateChanged = (this._lastDay != day || !this._lastDateHeader);\n\t\tif (dateChanged) {\n\t\t\tthis._addDateHeader(date);\n\t\t\tthis._lastDay = day;\n\t\t}\n\n\t\tif (!this._lastMessage || this._lastMessage.userID != messageData.sender\n\t\t\t|| dateChanged) {\n\n\t\t\tthis._lastMessage = new MessageBlock();\n\n\t\t\tvar isMe = messageData.sender == weebyController.getUser().getID();\n\t\t\tvar viewStates = this.inflate(isMe ? '$myMessageBlock' : '$friendMessageBlock');\n\n\t\t\tif (viewStates.views.$nickname) {\n\t\t\t\tviewStates.views.$nickname.setText(this._social.getDisplayName(messageData.sender));\n\t\t\t}\n\n\t\t\tif (viewStates.views.$photo) {\n\t\t\t\tviewStates.views.$photo.setImage(this._social.getPhotoImage(messageData.sender));\n\t\t\t}\n\n\t\t\tthis._addView(viewStates.mainView);\n\t\t\tthis._lastMessage.subscribe('message', this, '_addMessageView', isMe ? '$myMessage' : '$friendMessage', viewStates);\n\t\t}\n\n\t\tthis._lastMessage.add(ctx, messageData);\n\t}\n\n\tthis._addView = function (view) {\n\t\tthis._scroller.addSubview(view);\n\t\tview.style.y = this._bottom;\n\t\tthis.setBottom(this._bottom + view.style.height);\n\t}\n\n\tthis._addMessageView = function (messageTag, viewStates, ctx, messageData) {\n\t\tvar date = messageData.date;\n\t\tif (!(date instanceof Date)) {\n\t\t\tdate = new Date(date);\n\t\t}\n\n\t\tthis._lastDate = date.toISOString();\n\n\t\t// set view contents\n\t\tvar messageStates = this.inflate(messageTag);\n\t\tvar mainView = messageStates.mainView;\n\t\tvar messageViews = messageStates.views;\n\t\tif (messageViews.$time) {\n\t\t\tmessageViews.$time.setText(i18n.formatTime(date));\n\t\t}\n\n\t\tvar messageView = messageViews.$message;\n\t\tmessageView.setText(messageData.message);\n\t\tmessageView.computeSize(ctx);\n\t\tvar dh = messageView.style.height;\n\n\t\tif (messageViews.$photo) {\n\t\t\tweebyController.getPhoto(messageData.sender, function (err, res) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tmessageViews.setImage(res.photoURL);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// add to parent view\n\t\tvar containerView = viewStates.mainView;\n\t\tvar parentView = viewStates.views.$messages;\n\t\tparentView.addSubview(mainView);\n\n\t\t// position the message view vertically\n\t\tmainView.style.y = parentView.style.height;\n\t\tvar height = (mainView.style.height += dh);\n\n\t\t// reflow parent view and parent's container view\n\t\tparentView.style.height += height;\n\t\tcontainerView.style.height += height;\n\n\t\tthis.setBottom(this._bottom + height);\n\t}\n\n\tthis._addDateHeader = function (date) {\n\t\tvar views = this.inflate('$dateHeader').views;\n\n\t\tviews.$date.setText(i18n.formatDate(date));\n\n\t\tthis._addView(views.$dateHeader);\n\t\tthis._lastDateHeader = views.$dateHeader;\n\t}\n\n\tthis.setBottom = function (bottom) {\n\t\tthis._bottom = bottom;\n\t\tthis._scroller.getScrollBounds().maxY = this._bottom;\n\t\tthis.scrollToBottom();\n\t}\n\n\tthis.scrollToBottom = function () {\n\t\tthis._scroller.scrollTo(0, this._bottom, 1000);\n\t}\n\n});\n\nvar sdk_plugins_weeby_ui_controllers_weeby_ChatViewController=__class__;var ChatViewController = exports=sdk_plugins_weeby_ui_controllers_weeby_ChatViewController(function sdk_plugins_weeby_ui_controllers_weeby_ChatViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [merge(opts, {\n\t\t\talignTop: true,\n\t\t\tlayout: '$chatContainer'\n\t\t})]);\n\n\t\twindow.addEventListener('keyboardScreenResize', bind(this, '_keyboardScreenResize'), false);\n\n\t\t_instance = this;\n\n\t\t// the currently active chat view\n\t\tthis._chatView = null;\n\n\t\tthis._addEvent('$back', 'InputSelect', bind(weebyController, 'handleAction', 'back', null));\n\n\t\tthis._social = weebyController.getSocial();\n\t\tthis._social.getFriends().on('UPDATE', bind(this, '_onFriendUpdate'));\n\t\tthis._onUserUpdated();\n\t\t\n\t\tchatModel.on('Message', bind(this, 'addMessage'));\n\t\tchatModel.on('MessageSent', bind(this, 'addSentMessage'));\n\n\t\tvar user = weebyController.getUser();\n\t\tuser.on('updated', bind(this, '_onUserUpdated'));\n\n\t\twindow.addEventListener('pageshow', bind(this, \"onAppShow\"), false);\n\t\twindow.addEventListener('pagehide', bind(this, \"onAppHide\"), false);\n\n\t\twindow.addEventListener('online', bind(this, \"onOnline\"), false);\n\t\twindow.addEventListener('offline', bind(this, \"onOffline\"), false);\n\n\t\tthis._views.$chatInput.onSubmit = bind(this, '_onSubmit');\n\t\tthis._views.$sendButton.on('InputSelect', bind(this, '_onSubmit', false));\n\n\t\t// restore previously open chats\n\t\tvar threads = _storage.getOpenedThreads();\n\t\tfor (var i = 0, n = threads.length; i < n; ++i) {\n\t\t\tthis._getThreadViewController(threads[i]);\n\t\t}\n\t}\n\n\tthis._keyboardScreenResize = function(data) {\n\t\t// check if data.height < some percentage of device height (75% ?)\n\t\t// and move the root view, else move back to 0\n\t\tvar screenBottom = (device.screen.height - data.height) / uiConfig.FULL_SCREEN_SCALE;\n\n\t\tif (this._chatView) {\n\t\t\tvar controller = _chats.get(this._currentThreadID);\n\t\t\tif (controller) {\n\t\t\t\tcontroller.setScreenBottom(screenBottom);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis._onFriendUpdate = function (friend) {\n\t\tvar chat = _chats.get(friend.id);\n\t\tif (chat) {\n\t\t\t// signal update on chat object to update the chat list view\n\t\t\t_chats.updated(chat);\n\t\t}\n\t}\n\n\tthis._onSubmit = function (message) {\n\t\tif (message === false) {\n\t\t\tmessage = this._views.$chatInput.getValue();\n\t\t}\n\n\t\tif (message && !/^\\s+$/.test(message)) {\n\t\t\tvar uuid = chatModel.sendMessage(this._currentThreadID, message, bind(this, '_onMessageSuccess'));\n\t\t\tthis._views.$chatInput.setValue(\"\");\n\n\t\t\tvar threadID = this._currentThreadID;\n\n\t\t\tthis._getThreadViewController(threadID).addMessage({\n\t\t\t\tuuid: uuid,\n\t\t\t\tdate: new Date(),\n\t\t\t\tmessage: message,\n\t\t\t\tthreadID: threadID,\n\t\t\t\tsender: weebyController.getUser().getID()\n\t\t\t});\n\t\t}\n\t}\n\n\tthis._onMessageSuccess = function (data) {\n\t\tif (data) {\n\t\t\t// var threadID = this._localMessageIDMap[data.localMessageID];\n\t\t\t// this._getThreadViewController(threadID).didSendMessage({\n\t\t\t// \t\tuuid: data.uuid,\n\t\t\t// \t\tlocalMessageID: data.localMessageID,\n\t\t\t// \t\tsuccess: data.success\n\t\t\t// \t});\n\t\t}\n\t}\n\n\tthis._getThreadViewController = function (threadID) {\n\t\tif (!_chats.contains(threadID)) {\n\t\t\t_chats.add(new ThreadViewController({views: this._viewDef, threadID: threadID}));\n\t\t}\n\n\t\treturn _chats.get(threadID);\n\t}\n\n\tthis._onChatSelected = function (threadID) {\n\t\tif (threadID) {\n\t\t\tvar controller = this._getThreadViewController(threadID);\n\n\t\t\t// make sure we've created the view for this chat\n\t\t\tif (!controller.hasView()) {\n\t\t\t\tvar viewStates = this.inflate('$chat');\n\t\t\t\tcontroller.setViewStates(viewStates);\n\t\t\t}\n\n\n\t\t\t// get and swap the chat view into the main content area\n\t\t\tvar chatView = controller.getView();\n\t\t\tif (chatView != this._chatView) {\n\t\t\t\t_storage.persistThread(this._currentThreadID);\n\t\t\t\t\n\t\t\t\tif (this._chatView) {\n\t\t\t\t\tthis._chatView.removeFromSuperview();\n\t\t\t\t}\n\n\t\t\t\tthis._chatView = chatView;\n\t\t\t\tthis._chatController = controller;\n\t\t\t\tthis._views.$contents.addSubview(chatView);\n\t\t\t\tthis._currentThreadID = threadID;\n\n\t\t\t\tthis._views.$title.setText(this._social.getDisplayName(threadID));\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.addMessage = function (data) {\n\t\tvar message = {\n\t\t\tuuid: data.uuid,\n\t\t\tdate: data.timestamp ? new Date(data.timestamp) : new Date(),\n\t\t\t// localMessageID: data.localMessageID || \"\",\n\t\t\tmessage: data.message,\n\t\t\tthreadID: data.from,\n\t\t\tsender: data.from\n\t\t};\n\n\t\tvar threadID = message.threadID;\n\t\tif (threadID) {\n\t\t\tthis._getThreadViewController(threadID).addMessage(message);\n\t\t}\n\t}\n\n\tthis.addSentMessage = function (data) {\n\t\tvar message = {\n\t\t\tuuid: data.uuid,\n\t\t\tdate: data.timestamp ? new Date(data.timestamp) : new Date(),\n\t\t\t// localMessageID: data.localMessageID || \"\",\n\t\t\tmessage: data.message,\n\t\t\tthreadID: data.to,\n\t\t\tsender: this._myUserID\n\t\t};\n\n\t\tvar threadID = message.threadID;\n\t\tif (threadID) {\n\t\t\tthis._getThreadViewController(threadID).addMessage(message);\n\t\t}\n\t}\n\n\tthis.onAppHide = function() {\n\t\tchatModel.disconnect();\n\n\t\t_storage.persistOpenedThreads();\n\t\t_storage.persist();\n\t}\n\n\tthis.onAppShow = function() {\n\t\tvar user = weebyController.getUser();\n\t\tvar id = user.getID();\n\t\tif (user.isVerified()) {\n\t\t\tchatModel.connect(id, user.getAuthKey());\n\t\t}\n\t}\n\n\tthis.onOnline = function() {\n\t\tchatModel.online();\n\t}\n\n\tthis.onOffline = function() {\n\t\tchatModel.offline();\n\t}\n\n\tthis._onUserUpdated = function () {\n\t\tvar user = weebyController.getUser();\n\t\tthis._myUserID = user.getID();\n\t\tvar idChanged = (this._myUserID != chatModel.getConnectedId());\n\n\t\tif (chatModel.isConnected() && (!user.isVerified() || idChanged)) {\n\t\t\tchatModel.disconnect();\n\t\t}\n\n\t\tif (!chatModel.isConnected() && user.isVerified()) {\n\t\t\tchatModel.connect(this._myUserID, user.getAuthKey());\n\t\t}\n\t}\n\n});\n\nexports.getChats = function () {\n\treturn _chats;\n}\n\nexports.setActiveChat = function (threadID) {\n\t_instance._onChatSelected(threadID);\n}\n\nexports.addMessage = function (messageData) {\n\t_instance.addMessage(messageData);\n}\n\nexports.getTotalUnread = function () {\n\tvar unread = 0;\n\t_chats.forEach(function (chat) {\n\t\tunread += chat.getUnreadMessages().length;\n\t});\n\n\treturn unread;\n}\n\nexports.on = function (signal, cb) {\n\t_instance.on(signal, cb);\n}\n","pre":true},"sdk/plugins/weeby/ui/controllers/weeby/FriendListViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/weeby/FriendListViewController.js","friendlyPath":".controllers.weeby.FriendListViewController","directory":"sdk/plugins/weeby/ui/controllers/weeby/","filename":"FriendListViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ....i18n\");\njsio(\"import ....weebyController\");\n\njsio(\"import ..profile.SocialTabController as SocialTabController\");\n\nvar sdk_plugins_weeby_ui_controllers_weeby_FriendListViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_weeby_FriendListViewController(function sdk_plugins_weeby_ui_controllers_weeby_FriendListViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [merge(opts, {\n\t\t\talignTop: true,\n\t\t\tlayout: '$friendList'\n\t\t})]);\n\n\t\tthis._friends = weebyController.getSocial().getFriends();\n\t\t\n\t\tthis._views.$contents.updateOpts({\n\t\t\tgetCell: bind(this, 'getCell'),\n\t\t\tdataSource: this._friends,\n\t\t\tisFixedSize: true,\n\t\t\tscrollX: false,\n\t\t\trecycle: true\n\t\t});\n\n\t\tthis._views.$searchBox.on('onChange', bind(this, 'onSearch'));\n\t}\n\n\tthis.getHeader = function () {\n\t\treturn {\n\t\t\ttitle: i18n.get('weebyFriends')\n\t\t};\n\t}\n\n\tthis.onSearch = function(value) {\n\n\t\tvar filter = new RegExp(value, 'i');\n\t\tvar ds = this._friends.getFilteredDataSource(function (friend) {\n\t\t\treturn filter.test(friend.name) || filter.test(friend.nickname);\n\t\t});\n\n\t\tif (ds.getCount() == 0) {\n\t\t\t// ds.add({\n\t\t\t// \tname: i18n.get('noCountryMatch'),\n\t\t\t// \tcode: ''\n\t\t\t// });\n\t\t}\n\n\t\tthis._views.$contents.updateOpts({\n\t\t\tdataSource: ds\n\t\t});\n\n\t\tthis._views.$contents.setOffset(0, 0);\n\t}\n\n\tthis.onShow = function (type, transition, level) {\n\t\tSocialTabController.getInstance().showFor(this, type, transition);\n\n\t\t// weebyController.getCachedConnections(bind(this, function (err, connections) {\n\t\t// \tif (err) {\n\t\t// \t\tthis._views.$errorGettingFriends.style.visible = true;\n\t\t// \t} else {\n\t\t// \t\tthis._views.$errorGettingFriends.style.visible = false;\n\t\t// \t}\n\t\t// }));\n\t}\n\n\tthis.onHide = function (type, transition, level) {\n\t\tSocialTabController.getInstance().hideFor(this, type, transition);\n\t}\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\n\t\tviewStates.views.$row.onInputSelect = bind(this, 'onRowSelect', viewStates);\n\n\t\treturn root;\n\t};\n\n\tthis.onRowSelect = function (viewStates) {\n\t\tweebyController.handleAction('viewFriendProfile', {user: viewStates.data});\n\t}\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tvar views = viewStates.views;\n\n\t\tviewStates.data = data;\n\n\t\tvar nickname = data.nickname || data.name;\n\t\tvar name = data.nickname && (data.name != data.nickname) && data.name || '';\n\n\t\tif (views.$nickname) {\n\t\t\tviews.$nickname.setText(nickname);\n\t\t}\n\n\t\tif (views.$name) {\n\t\t\tviews.$name.setText(name);\n\t\t}\n\n\t\tif (views.$photo) {\n\t\t\tviews.$photo.setImage(weebyController.getSocial().getPhotoImage(data.id));\n\t\t}\n\n\t\tif (views.$status) {\n\t\t\tviews.$status.setText(data.status);\n\t\t}\n\t}\n});","pre":true},"sdk/plugins/weeby/ui/controllers/weeby/ChatListViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/weeby/ChatListViewController.js","friendlyPath":".controllers.weeby.ChatListViewController","directory":"sdk/plugins/weeby/ui/controllers/weeby/","filename":"ChatListViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ....i18n\");\njsio(\"import ....weebyController\");\n\njsio(\"import ..profile.SocialTabController as SocialTabController\");\n\njsio(\"import .ChatViewController\");\n\nvar sdk_plugins_weeby_ui_controllers_weeby_ChatListViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_weeby_ChatListViewController(function sdk_plugins_weeby_ui_controllers_weeby_ChatListViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [merge(opts, {\n\t\t\talignTop: true,\n\t\t\tlayout: '$chatList'\n\t\t})]);\n\n\t\tthis._chats = ChatViewController.getChats();\n\t\tthis._social = weebyController.getSocial();\n\n\t\t// this._chats.add({id: \"3085b84c206b4859b666e66e1be3968d\", nickname: 'Martin', lastMessage: 'hello'});\n\t\t// this._chats.add({id: \"1c1e66ff00ae4be4b69f473f29b5b083\", nickname: 'Tom', lastMessage: 'hello'});\n\t\t// this._chats.add({id: \"ace4c9a012d14904b47a30f7074f610b\", nickname: 'Michael', lastMessage: 'hello'});\n\n\t\tthis._views.$contents.updateOpts({\n\t\t\tgetCell: bind(this, 'getCell'),\n\t\t\tdataSource: this._chats,\n\t\t\tisFixedSize: true,\n\t\t\tscrollX: false,\n\t\t\trecycle: true\n\t\t});\n\n\t\tthis._views.$searchBox.on('onChange', bind(this, 'onSearch'));\n\t}\n\n\tthis.getHeader = function () {\n\t\treturn {\n\t\t\ttitle: i18n.get('weebyChats')\n\t\t};\n\t}\n\n\tthis.onSearch = function(value) {\n\n\t\tvar filter = new RegExp(value, 'i');\n\t\tvar ds = this._chats.getFilteredDataSource(bind(this, function (chat) {\n\t\t\tvar id = chat.getUserID();\n\t\t\treturn filter.test(this._social.getName(id))\n\t\t\t\t|| filter.test(this._social.getNickname(id));\n\t\t}));\n\n\t\tif (ds.getCount() == 0) {\n\t\t\t// ds.add({\n\t\t\t// \tname: i18n.get('noCountryMatch'),\n\t\t\t// \tcode: ''\n\t\t\t// });\n\t\t}\n\n\t\tthis._views.$contents.updateOpts({\n\t\t\tdataSource: ds\n\t\t});\n\n\t\tthis._views.$contents.setOffset(0, 0);\n\t}\n\n\tthis.onShow = function (type, transition, level) {\n\t\tSocialTabController.getInstance().showFor(this, type, transition);\n\t}\n\n\tthis.onHide = function (type, transition, level) {\n\t\tSocialTabController.getInstance().hideFor(this, type, transition);\n\t}\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\n\t\tviewStates.views.$row.onInputSelect = bind(this, 'onRowSelect', viewStates);\n\n\t\treturn root;\n\t};\n\n\tthis.onRowSelect = function (viewStates) {\n\t\tChatViewController.setActiveChat(viewStates.data.getThreadID());\n\t\tweebyController.handleAction('openChat');\n\t}\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tvar views = viewStates.views;\n\n\t\tviewStates.data = data;\n\n\t\tif (views.$nickname) {\n\t\t\tviews.$nickname.setText(this._social.getDisplayName(data.getUserID()));\n\t\t}\n\n\t\tif (views.$photo) {\n\t\t\tviews.$photo.setImage(this._social.getPhotoImage(data.getUserID()));\n\t\t}\n\n\t\tif (views.$lastMessage) {\n\t\t\tvar unreadMessages = data.getUnreadMessages();\n\t\t\tvar lastMessage = data.getLastMessage();\n\t\t\tvar message;\n\t\t\tif (unreadMessages[0]) {\n\t\t\t\tmessage = unreadMessages[0].message;\n\t\t\t} else {\n\t\t\t\tmessage = lastMessage && lastMessage.message;\n\t\t\t}\n\t\t\t\n\t\t\tif (!message) {\n\t\t\t\tmessage = '';\n\t\t\t} else if (message.length > 60) {\n\t\t\t\tmessage = message.substring(0, 60) + '...';\n\t\t\t}\n\n\t\t\tviews.$lastMessage.setText(message);\n\t\t}\n\n\t\tif (views.$date) {\n\t\t\tvar date = data.getLastDate();\n\t\t\tif (date) {\n\t\t\t\tviews.$date.setText(i18n.getTimeAgo(new Date(date)));\n\t\t\t} else {\n\t\t\t\tviews.$date.setText(\"\");\n\t\t\t}\n\t\t}\n\n\t\tif (views.$unreadCount) {\n\t\t\tviews.$unreadCount.setText(unreadMessages.length);\n\t\t}\n\t}\n});","pre":true},"sdk/plugins/weeby/ui/controllers/weeby/FriendProfileViewController.js":{"path":"sdk/plugins/weeby/ui/controllers/weeby/FriendProfileViewController.js","friendlyPath":".controllers.weeby.FriendProfileViewController","directory":"sdk/plugins/weeby/ui/controllers/weeby/","filename":"FriendProfileViewController.js","src":"jsio(\"import ...components.WeebyViewController as WeebyViewController\");\njsio(\"import ...controllers.weeby.ChatViewController as ChatViewController\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....trackers.trackers as trackers\");\n\nvar sdk_plugins_weeby_ui_controllers_weeby_FriendProfileViewController=__class__;exports=sdk_plugins_weeby_ui_controllers_weeby_FriendProfileViewController(function sdk_plugins_weeby_ui_controllers_weeby_FriendProfileViewController(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [merge(opts, {\n\t\t\tpushTransition: 'slideup',\n\t\t\talignTop: true,\n\t\t\tlayout: '$friendProfile'\n\t\t})]);\n\n\t\tweebyController.subscribe('ActiveFriendProfile', this, 'update');\n\t\tthis._views.$back.on('InputSelect', bind(weebyController, 'handleAction', 'back', null));\n\t\tthis._views.$chatButton.on('InputSelect', bind(this, '_onStartChat'));\n\t};\n\n\tthis.update = function (user) {\n\t\tthis._user = user;\n\n\t\ttrackers.track('show:viewProfile', {\n\t\t\tuserId: user.id\n\t\t});\n\n\t\tthis._views.$nameHeader.setText(user.nickname || user.name);\n\t\tthis._views.$name.setText(user.name);\n\n\t\tvar nickname = user.nickname;\n\t\tif (!nickname || nickname == user.name) {\n\t\t\tnickname = user.name;\n\t\t\tthis._views.$nameText.setText(\"\");\n\t\t} else {\n\t\t\tthis._views.$nameText.setText(user.name);\n\t\t}\n\n\t\tthis._views.$nickNameText.setText(nickname);\n\n\t\tvar image = weebyController.getSocial().getPhotoImage(user.id);\n\t\tthis._views.$image.setImage(image);\n\t\tthis._views.$profileImage.setImage(image);\n\n\t\tthis._views.$statusText.setText(user.status || '');\n\n\t\tthis._views.$cover.style.visible = false;\n\t\tthis._views.$defaultCover.style.visible = true;\n\n\t\t// TODO: this is probably not the proper place to query for this additional data\n\n\t\t// TODO: move to weebyController.getSocial().getProfile\n\t\tweebyController._api.getProfile({id: user.id}, bind(this, function (error, data) {\n\t\t\tif (!error) {\n\t\t\t\tdata.status && this._views.$statusText.setText(data.status);\n\t\t\t\tif (data.coverImage) {\n\t\t\t\t\tthis._views.$cover.setImage(data.coverImage);\n\t\t\t\t\tthis._views.$cover.doOnLoad(bind(this, function() {\n\t\t\t\t\t\tthis._views.$cover.style.visible = true;\n\t\t\t\t\t\tthis._views.$defaultCover.style.visible = false;\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t};\n\n\tthis.onShow = function (type, transition) {\n\t\tvar view = this._views.$backImage;\n\t\tif (type == 'push') {\n\t\t\tview.style.r = 0;\n\t\t\tview.getAnimation().wait(200).now({r: Math.PI});\n\t\t} else {\n\t\t\tview.style.r = -Math.PI / 2;\n\t\t}\n\t}\n\n\tthis._onStartChat = function () {\n\t\tChatViewController.setActiveChat(this._user.id);\n\t\tweebyController.handleAction('openChat');\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/AlertDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/AlertDialog.js","friendlyPath":".dialogs.game.AlertDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"AlertDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_AlertDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_AlertDialog(function sdk_plugins_weeby_ui_dialogs_game_AlertDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis.okCB = null;\n\t};\n\n\tthis.setText = function (text) {\n\t\tthis._views.$text.setText(i18n.get(text));\n\t\treturn this;\n\t};\n\n\tthis.onOk = function () {\n\t\tthis.hide();\n\t\tthis.okCB && this.okCB();\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/components/WeebyBaseDialog.js":{"path":"sdk/plugins/weeby/ui/components/WeebyBaseDialog.js","friendlyPath":"...components.WeebyBaseDialog","directory":"sdk/plugins/weeby/ui/components/","filename":"WeebyBaseDialog.js","src":"jsio(\"import .WeebyViewController as WeebyViewController\");\njsio(\"import ..config\");\njsio(\"import ...weebyController\");\njsio(\"import .transitions\");\n\njsio(\"import animate\");\n\nvar sdk_plugins_weeby_ui_components_WeebyBaseDialog=__class__;exports=sdk_plugins_weeby_ui_components_WeebyBaseDialog(function sdk_plugins_weeby_ui_components_WeebyBaseDialog(){return this.init&&this.init.apply(this,arguments)},WeebyViewController, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tlayout: '$dialog',\n\t\t\tcanHandleEvents: false,\n\t\t\ttransition: 'dialogFade'\n\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._isShowing = false;\n\t\tthis._transition = opts.transition;\n\n\t\t// add some optional events for common dialog buttons\n\t\tthis._addEvent('$closeButton', 'InputSelect', bind(this, 'close'));\n\t\tthis._addEvent('$okButton', 'InputSelect', bind(this, 'onOk'));\n\t\tthis._addEvent('$cancelButton', 'InputSelect', bind(this, 'onCancel'));\n\n\t\tthis.closeCB = null;\n\n\t\tif (!this._views.$dialog.style.zIndex) {\n\t\t\tthis._views.$dialog.style.zIndex = 1200;\n\t\t}\n\n\t\tthis._views.$dialog.setHandleEvents(false);\n\t};\n\n\t// may be overriden by subclass\n\t// shows the view and reenables input\n\tthis.show = function (type, transition) {\n\n\t\tif (!this._isShowing) {\n\t\t\tthis._isShowing = true;\n\t\t\tthis.onShow();\n\n\t\t\ttransitions.show(this._view, (type == 'pop' && 'none') || transition || this._transition);\n\t\t}\n\t};\n\n\t// may be overriden by subclass\n\t// hides the view and disables input\n\tthis.onClose = function () {};\n\tthis.onShow = function () {};\n\n\tthis.close = function () {\n\t\tweebyController.handleAction('close');\n\t};\n\n\tthis.hide = function (type, transition) {\n\t\tvar view = this._view;\n\n\t\tif (this._isShowing) {\n\t\t\tthis._isShowing = false;\n\t\t\tthis.onClose();\n\n\t\t\tjsio(\"import ..WeebyViews\");\n\t\t\tWeebyViews.getInstance().onCloseDialog(this);\n\n\t\t\t// if type is push, we don't actually want to hide this view -- it'll be under the view\n\t\t\t// that's being pushed on\n\t\t\tif (type != 'push') {\n\t\t\t\ttransitions.hide(this._view, transition || this._transition, this.closeCB);\n\t\t\t}\n\t\t}\n\t};\n\n\t// Override in child class if desired\n\tthis.onCancel = function () {\n\t\tweebyController.handleAction('cancel');\n\t};\n\n\tthis.onOk = function () {\n\t\tweebyController.handleAction('ok');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/CrosspromoRewardDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/CrosspromoRewardDialog.js","friendlyPath":".dialogs.game.CrosspromoRewardDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"CrosspromoRewardDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\njsio(\"import ....weebyController\");\njsio(\"import device\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_CrosspromoRewardDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_CrosspromoRewardDialog(function sdk_plugins_weeby_ui_dialogs_game_CrosspromoRewardDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\t};\n\n\tthis.onShow = function () {\n\t\tthis._activeReward = weebyController.getActiveCrosspromoReward();\n\t\t\n\t\tif (this._activeReward) {\n\t\t\tthis._views.$gameName.setText(this._activeReward.name);\n\t\t\tthis._views.$gameIcon.setImage(this._activeReward.image);\n\n\t\t\t//Show reward on Android, but not on iOS\n\t\t\tif (device.isAndroid || device.isAndroidSimulator) {\n\t\t\t\tthis._views.$rewardinset.style.visible = true;\n\t\t\t\tthis._views.$rewardAmount.setText('+' + this._activeReward.amount);\n\n\t\t\t\tthis._views.$char.style.x = 40;\n\n\t\t\t} else {\n\t\t\t\tthis._views.$rewardinset.style.visible = false;\n\n\t\t\t\tthis._views.$char.style.x = ~~(this._views.$dialog.style._width / 2 - this._views.$char.style._width / 2);\n\t\t\t}\n\t\t}\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/GiftDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/GiftDialog.js","friendlyPath":".dialogs.game.GiftDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"GiftDialog.js","src":"jsio(\"import GCDataSource\");\n\njsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_GiftDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_GiftDialog(function sdk_plugins_weeby_ui_dialogs_game_GiftDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\toverrideCtors: {\n\t\t\t\t\t$rows: 'list',\n\t\t\t\t\t$row: 'cell',\n\t\t\t\t\t$nickname: 'text',\n\t\t\t\t\t$score: 'text',\n\t\t\t\t\t$rank: 'text',\n\t\t\t\t\t$icon: 'image'\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._listData = new GCDataSource({\n\t\t\tkey: 'index',\n\t\t\tsorter: function (data) { return data.index; }\n\t\t});\n\t\tif (!this._views.$rows) {\n\t\t\tthrow new Error('$row is required and was not defined');\n\t\t}\n\n\t\tthis._views.$rows.updateOpts({\n\t\t\tgetCell: bind(this, 'getCell'),\n\t\t\tdataSource: this._listData,\n\t\t\tisFixedSize: true,\n\t\t\tscrollX: false,\n\t\t\trecycle: true\n\t\t});\n\n\t\tthis._addEvent('$acceptButton', 'InputSelect', bind(this, 'onAccept'), true);\n\t};\n\n\tthis.getCell = function () {\n\t\tvar viewStates = this.inflate('$row');\n\t\tvar root = viewStates.views.$row;\n\t\troot.on('InputSelect', bind(this, 'onSelectGift', viewStates));\n\t\troot.setData = bind(this, 'setCellData', root, viewStates);\n\t\treturn root;\n\t};\n\n\tthis.setCellData = function (cell, viewStates, data) {\n\t\tvar views = viewStates.views;\n\n\t\tviewStates.data = data;\n\t\tviews.$icon.setImage(weebyController.getSocial().getPhotoImage(data.gift.sourceUser.id));\n\t\tviews.$nickname.setText(data.username);\n\n\t\tif (data.selected) {\n\t\t\tviewStates.addState('$acceptButton', 'checked');\n\t\t} else {\n\t\t\tviewStates.removeState('$acceptButton', 'checked');\n\t\t}\n\t};\n\n\tthis.onSelectGift = function (viewStates) {\n\t\tvar data = viewStates.data;\n\t\tvar views = viewStates.views;\n\t\tif (data.selected) {\n\t\t\tdata.selected = false;\n\t\t\tviewStates.removeState('$acceptButton', 'checked');\n\t\t} else {\n\t\t\tdata.selected = true;\n\t\t\tviewStates.addState('$acceptButton', 'checked');\n\t\t}\n\t};\n\n\tthis.onShow = function () {\n\t\tvar list = weebyController.getReceivedGifts();\n\t\tthis._listData.clear();\n\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\tvar item = list[i];\n\t\t\tthis._listData.add({\n\t\t\t\tindex: item.created + item.id,\n\t\t\t\tusername: item.sourceUser.nickname || item.sourceUser.name,\n\t\t\t\tgift: item,\n\t\t\t\tselected: true\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.onAccept = function () {\n\t\tthis.disableInput();\n\n\t\tvar acceptedGifts = [];\n\t\tthis._listData.forEach(function (item) {\n\t\t\titem.selected && acceptedGifts.push(item.gift);\n\t\t});\n\n\t\tweebyController.handleAction('accept', {\n\t\t\tgifts: acceptedGifts\n\t\t});\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/GiftNoneDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/GiftNoneDialog.js","friendlyPath":".dialogs.game.GiftNoneDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"GiftNoneDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_GiftNoneDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_GiftNoneDialog(function sdk_plugins_weeby_ui_dialogs_game_GiftNoneDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function () {\n\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/NotEnoughCommonDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/NotEnoughCommonDialog.js","friendlyPath":".dialogs.game.NotEnoughCommonDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"NotEnoughCommonDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_NotEnoughCommonDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_NotEnoughCommonDialog(function sdk_plugins_weeby_ui_dialogs_game_NotEnoughCommonDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tvar weebyConfig = weebyController.getWeebyConfig()\n\t\tvar notEnoughDialog = weebyConfig.getCurrencies().common.notEnoughDialog;\n\n\t\tthis._views.$title.setText(notEnoughDialog.title);\n\t\tthis._views.$text.setText(notEnoughDialog.text);\n\t};\n\n\tthis.onOk = function () {\n\t\tweebyController.handleAction('gotoCommon');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/NotEnoughLivesDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/NotEnoughLivesDialog.js","friendlyPath":".dialogs.game.NotEnoughLivesDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"NotEnoughLivesDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_NotEnoughLivesDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_NotEnoughLivesDialog(function sdk_plugins_weeby_ui_dialogs_game_NotEnoughLivesDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tvar weebyConfig = weebyController.getWeebyConfig()\n\t\tvar notEnoughDialog = weebyConfig.getCurrencies().life.notEnoughDialog;\n\n\t\tthis._views.$title.setText(notEnoughDialog.title);\n\t\tthis._views.$text.setText(notEnoughDialog.text);\n\n\t};\n\n\tthis.onOk = function () {\n\t\tweebyController.handleAction('gotoLives');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/NotEnoughPremiumDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/NotEnoughPremiumDialog.js","friendlyPath":".dialogs.game.NotEnoughPremiumDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"NotEnoughPremiumDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_NotEnoughPremiumDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_NotEnoughPremiumDialog(function sdk_plugins_weeby_ui_dialogs_game_NotEnoughPremiumDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tvar weebyConfig = weebyController.getWeebyConfig()\n\t\tvar notEnoughDialog = weebyConfig.getCurrencies().premium.notEnoughDialog;\n\n\t\tthis._views.$title.setText(notEnoughDialog.title);\n\t\tthis._views.$text.setText(notEnoughDialog.text);\n\t};\n\n\tthis.onOk = function () {\n\t\tweebyController.handleAction('gotoPremium');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/SettingsDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/SettingsDialog.js","friendlyPath":".dialogs.game.SettingsDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"SettingsDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyLocalData\");\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_SettingsDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_SettingsDialog(function sdk_plugins_weeby_ui_dialogs_game_SettingsDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._addEvent('$musicButton', 'InputSelect', bind(this, 'onMusic'), true);\n\t\tthis._addEvent('$sfxButton', 'InputSelect', bind(this, 'onSfx'), true);\n\n\t\tif (weebyLocalData.getMusicOn()) {\n\t\t\tthis._viewStates.addState('$musicButton', 'checked');\n\t\t} else {\n\t\t\tthis._viewStates.removeState('$musicButton', 'checked');\n\t\t}\n\t\tif (weebyLocalData.getSfxOn()) {\n\t\t\tthis._viewStates.addState('$sfxButton', 'checked');\n\t\t} else {\n\t\t\tthis._viewStates.removeState('$sfxButton', 'checked');\n\t\t}\n\t};\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\t}\n\n\tthis.onMusic = function () {\n\t\tif (weebyLocalData.setMusicOn(!weebyLocalData.getMusicOn())) {\n\t\t\tthis._viewStates.addState('$musicButton', 'checked');\n\t\t\ttrackers.track('settings:enableMusic');\n\t\t} else {\n\t\t\tthis._viewStates.removeState('$musicButton', 'checked');\n\t\t\ttrackers.track('settings:disableMusic');\n\t\t}\n\t\tweebyController.setMute(!weebyLocalData.getMusicOn());\n\t};\n\n\tthis.onSfx = function () {\n\t\tif (weebyLocalData.setSfxOn(!weebyLocalData.getSfxOn())) {\n\t\t\tthis._viewStates.addState('$sfxButton', 'checked');\n\t\t\ttrackers.track('settings:enableEffects');\n\t\t} else {\n\t\t\tthis._viewStates.removeState('$sfxButton', 'checked');\n\t\t\ttrackers.track('settings:disableEffects');\n\t\t}\n\t};\n\n\tthis.onClose = function () {\n\t\ttrackers.track('settings:closeBtn');\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/TosAcceptDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/TosAcceptDialog.js","friendlyPath":".dialogs.game.TosAcceptDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"TosAcceptDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyLocalData\");\njsio(\"import ....weebyController\");\njsio(\"import ....trackers.trackers as trackers\");\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_TosAcceptDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_TosAcceptDialog(function sdk_plugins_weeby_ui_dialogs_game_TosAcceptDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function(supr) {\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tvar baseURL = \"http://www.weebygames.com/\";\n\t\tvar hash = \"#!privacy-policy/c1mgs\";\n\t\tvar query = \"?studio=\" + encodeURIComponent(CONFIG.title);\n\n\t\tthis._viewableTosLink = baseURL + hash;\n\t\tthis._tosLink = baseURL + query + hash;\n\n\t\tthis._privacyLink = this._tosLink;\n\n\t\tthis._views.$tosLinkText.setText(i18n.get('tosTOS'));\n\t\tthis._views.$privacyLinkText.setText(i18n.get('tosPrivacyPolicy'));\n\n\t\tthis._addEvent('$tosLink', 'InputSelect', bind(this, 'openTos'), true);\n\t\tthis._addEvent('$privacyLink', 'InputSelect', bind(this, 'openPrivacy'), true);\n\t\tthis._addEvent('$cancel', 'InputSelect', bind(this, 'cancelTos'), true);\n\t\tthis._addEvent('$accept', 'InputSelect', bind(this, 'acceptTos'), true);\n\t}\n\n\tthis.openTos = function() {\n\t\ttrackers.track('auth:openTosUrl'); \n\t\twindow.setLocation(this._tosLink);\n\t}\n\n\tthis.openPrivacy = function() {\n\t\ttrackers.track('auth:openPrivacyUrl'); \n\t\twindow.setLocation(this._tosLink);\n\t}\n\n\tthis.cancelTos = function() {\n\t\tthis.close();\n\t}\n\n\tthis.acceptTos = function() {\n\t\tweebyController.handleAction('acceptTos');\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/OfflineDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/OfflineDialog.js","friendlyPath":".dialogs.game.OfflineDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"OfflineDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_OfflineDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_OfflineDialog(function sdk_plugins_weeby_ui_dialogs_game_OfflineDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._addEvent('$okButton', 'InputSelect', bind(this, 'onClose'), true);\n\t};\n\n\tthis.onClose = function () {\n\t\tthis.hide();\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/PassedPlayerDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/PassedPlayerDialog.js","friendlyPath":".dialogs.game.PassedPlayerDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"PassedPlayerDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\n\njsio(\"import ...config as config\");\n\n// TODO\nvar DEFAULT_IMAGE = config.IMAGE_DIR + 'icon_pic_rounded.png';\n\nvar sdk_plugins_weeby_ui_dialogs_game_PassedPlayerDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_PassedPlayerDialog(function sdk_plugins_weeby_ui_dialogs_game_PassedPlayerDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$radial.style.y = -config.CONTENT_OFFSET_Y;\n\t};\n\n\tthis.onShow = function () {\n\t\tvar gameResult = weebyController.getGameResult();\n\t\tvar userModel = weebyController.getUser();\n\n\t\tif (gameResult) {\n\t\t\ttrackers.track('game:rankup', {\n\t\t\t\tprev: gameResult.beforeGame.rank,\n\t\t\t\trank: gameResult.afterGame.rank\n\t\t\t});\n\t\t\tthis._views.$user1.setText(userModel.getNickname() || userModel.getName());\n\t\t\tthis._views.$score1.setText(gameResult.afterGame.weeklyHighScore);\n\t\t\tthis._views.$icon1.setImage(weebyController.getSocial().getPhotoImage(userModel.getID()));\n\n\t\t\tthis._views.$rank1.setText(gameResult.afterGame.rank);\n\n\t\t\tif (gameResult.passed) {\n\t\t\t\tthis._views.$user2.setText(gameResult.passed.nickname || gameResult.passed.name);\n\t\t\t\tthis._views.$score2.setText(gameResult.passed.score);\n\t\t\t\tthis._views.$icon2.setImage(weebyController.getSocial().getPhotoImage(gameResult.passed.id));\n\n\t\t\t\tthis._views.$rank2.setText(gameResult.passed.rank);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.close = function () {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('close');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/LevelUpDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/LevelUpDialog.js","friendlyPath":".dialogs.game.LevelUpDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"LevelUpDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\n\njsio(\"import ...config\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_LevelUpDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_LevelUpDialog(function sdk_plugins_weeby_ui_dialogs_game_LevelUpDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._views.$radial.style.y = -config.CONTENT_OFFSET_Y;\n\t};\n\n\tthis.onShow = function () {\n\t\tvar gameResult = weebyController.getGameResult();\n\n\t\tif (gameResult) {\n\t\t\tvar level = gameResult.afterGame.level;\n\t\t\tvar reward = weebyController.getLevelUpReward(level);\n\n\t\t\ttrackers.track('game:levelup', {\n\t\t\t\tprev: gameResult.beforeGame.level,\n\t\t\t\tlevel: gameResult.afterGame.level\n\t\t\t});\n\n\t\t\tthis._views.$level.setText(level);\n\t\t\tthis._views.$common.setText('+' + reward.common);\n\t\t\tthis._views.$premium.setText('+' + reward.premium);\n\t\t}\n\t};\n\n\tthis.close = function () {\n\t\tthis.disableInput();\n\t\tweebyController.handleAction('close');\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopCommonDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopCommonDialog.js","friendlyPath":".dialogs.game.ShopCommonDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopCommonDialog.js","src":"jsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\njsio(\"import .ShopDialog\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopCommonDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopCommonDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopCommonDialog(){return this.init&&this.init.apply(this,arguments)},ShopDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tvar weebyConfig = weebyController.getWeebyConfig();\n\n\t\tthis.addRows(this._views.$content, weebyConfig.getCommonCurrencyPurchases());\n\t\t\n\t\tthis._views.$title.setText(i18n.get('buyCommon'));\n\t};\n\n\tthis._onStartPurchase = function (item) {\n\t\tweebyController.handleAction('purchase', {item: item});\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopDialog.js","friendlyPath":".ShopDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.addRows = function (superview, items) {\n\t\tvar y = 160;\n\t\tif (this._views.$currencyView) {\n\t\t\ty = this._views.$currencyView.style.y;\n\t\t}\n\t\tfor (var i = 0, j = items.length; i < j; i++) {\n\t\t\tvar item = items[i];\n\t\t\tvar viewStates = this.inflate('$row');\n\t\t\tvar row = viewStates.views.$row;\n\n\t\t\trow.style.y = y;\n\t\t\ty += row.style.height;\n\t\t\tsuperview.addSubview(row);\n\n\t\t\tif (item.costIconUrl) {\n\t\t\t\tviewStates.views.$costIcon.setImage(item.costIconUrl);\n\t\t\t\tviewStates.views.$cost.style.visible = false;\n\t\t\t\tviewStates.views.$costWithIcon.setText(item.displayCost);\n\t\t\t} else {\n\t\t\t\tviewStates.views.$costIcon.style.visible = false;\n\t\t\t\tviewStates.views.$cost.setText(item.displayCost);\n\t\t\t\tviewStates.views.$costWithIcon.style.visible = false;\n\t\t\t}\n\t\t\tif (item.displaySaleTitle) {\n\t\t\t\tviewStates.views.$sale.setText(item.displaySaleTitle);\n\t\t\t} else {\n\t\t\t\tviewStates.views.$sale.style.visible = false;\n\t\t\t}\n\n\t\t\tviewStates.views.$icon.setImage(item.iconUrl);\n\t\t\tviewStates.views.$name.setText(item.displayName);\n\t\t\tviewStates.views.$line.style.visible = i < j - 1;\n\t\t\tviewStates.views.$button.on('InputSelect', bind(this, '_onStartPurchase', item));\n\t\t}\n\t};\n\n\tthis.onClose = function () {\n\t\ttrackers.track('store:closeBtn');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopCommonSuccessDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopCommonSuccessDialog.js","friendlyPath":".dialogs.game.ShopCommonSuccessDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopCommonSuccessDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopCommonSuccessDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopCommonSuccessDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopCommonSuccessDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\t\tthis._views.$text.setText(i18n.get('commonPurchaseSuccess', weebyController.getPurchaseCommonItem()));\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopConfirmCommonDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopConfirmCommonDialog.js","friendlyPath":".dialogs.game.ShopConfirmCommonDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopConfirmCommonDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopConfirmCommonDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopConfirmCommonDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopConfirmCommonDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\t\tthis._views.$text.setText(i18n.get('confirmCommonPurchase', weebyController.getPurchaseCommonItem()));\n\t};\n\n\tthis.onOk = function () {\n\t\tweebyController.handleAction('purchase');\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopConfirmLivesDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopConfirmLivesDialog.js","friendlyPath":".dialogs.game.ShopConfirmLivesDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopConfirmLivesDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopConfirmLivesDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopConfirmLivesDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopConfirmLivesDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\t\tthis._views.$text.setText(i18n.get('confirmLivesPurchase', weebyController.getPurchaseLivesItem()));\n\t};\n\n\tthis.onOk = function () {\n\t\tconsole.log('onOk');\n\t\tweebyController.handleAction('purchase');\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopConfirmPremiumDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopConfirmPremiumDialog.js","friendlyPath":".dialogs.game.ShopConfirmPremiumDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopConfirmPremiumDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopConfirmPremiumDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopConfirmPremiumDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopConfirmPremiumDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\t\tthis._views.$text.setText(i18n.get('confirmPremiumPurchase', weebyController.getPurchasePremiumItem()));\n\t};\n\n\tthis.onOk = function () {\n\t\tweebyController.handleAction('purchase');\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ItemShopDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ItemShopDialog.js","friendlyPath":".dialogs.game.ItemShopDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ItemShopDialog.js","src":"jsio(\"import ui.widget.GridView as GridView\");\n\njsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\njsio(\"import ui.View as View\");\njsio(\"import ui.ImageView as ImageView\");\njsio(\"import ui.ScrollView as ScrollView\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ItemShopDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ItemShopDialog(function sdk_plugins_weeby_ui_dialogs_game_ItemShopDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tvar weebyConfig;\n\tvar categoryInfo;\n\tvar itemInfo;\n\tvar itemContainers;\n\tvar currencyInfo;\n\tvar equipCount;\n\n\tthis.init = function (opts) {\n\t\topts = merge(\n\t\t\topts,\n\t\t\t{\n\t\t\t\toverrideCtors: {\n\n\t\t\t\t\t$rows: ScrollView,\n\t\t\t\t\t$item: ImageView\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t);\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._addEvent('$actionButton', 'InputSelect', bind(this, 'actionButtonClick'));\n\t\tthis._currentAction = 'equip';\n\t\tthis.selectedItem = null;\n\n\t\t// Get categories/items from the weeby config\n\t\tweebyConfig = weebyController.getWeebyConfig();\n\t\tvar itemShopData = weebyConfig._configData.itemShop;\n\t\t\n\t\t// Only construct the itemshop if the user has specified itemshop data in their\n\t\t// weeby config\n\t\tif (itemShopData) {\n\t\t\tvar categories = itemShopData.categories;\n\n\t\t\tcategoryInfo = {};\n\t\t\tequipCount = {};\n\t\t\titemContainers = {};\n\t\t\titemInfo = itemShopData.items;\n\t\t\tcurrencyInfo = weebyConfig.getCurrencies();\n\n\t\t\tfor (var i = 0; i < categories.length; i++) {\n\t\t\t\tcategoryInfo[categories[i].id] = categories[i];\n\t\t\t\tequipCount[categories[i].id] = 0;\n\t\t\t}\n\n\t\t\t// Compute the required grid sizes and configuration based on\n\t\t\t// the number of items\n\t\t\tvar gridView = this._views.$rows;\n\t\t\tvar itemCount = itemInfo.length;\n\t\t\tvar itemWidth = this._viewDef.$item.style.width;\n\t\t\tvar itemHeight = this._viewDef.$item.style.height;\n\t\t\tvar itemsPerRow = ~~(gridView.style.width / itemWidth);\n\t\t\tvar padding = (gridView.style.width - itemsPerRow * itemWidth) / itemsPerRow;\n\n\t\t\tvar totalGridHeight = padding + (Math.ceil((itemCount) / itemsPerRow)) * (itemHeight + padding);\n\n\t\t\tgridView._scrollBounds = {\n\t\t\t\tminX: 0,\n\t\t\t\tmaxX: gridView.style.width,\n\t\t\t\tminY: 0,\n\t\t\t\tmaxY: totalGridHeight\n\t\t\t};\n\n\t\t\tgridView.updateOpts({\n\t\t\t\tscrollX: false\n\t\t\t});\n\n\t\t\t// Place the items onto the grid and update their data\n\t\t\tfor (var i = 0; i < itemCount; i++) {\n\t\t\t\tvar col = (i % itemsPerRow);\n\t\t\t\tvar row = ~~(i / itemsPerRow);\n\t\t\t\tvar x = 0.5 * padding + col * (itemWidth + padding);\n\t\t\t\tvar y = 0.5 * padding + row * (itemHeight + padding);\n\n\t\t\t\t// create the item view/position it/set its images\n\t\t\t\tvar itemContainer = this.inflate(\"$item\");\n\t\t\t\titemContainers[itemInfo[i].id] = itemContainer;\n\t\t\t\titemContainer.views.$item.updateOpts({\n\t\t\t\t\tsuperview: gridView,\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y\n\t\t\t\t});\n\t\t\t\tvar cat = categoryInfo[itemInfo[i].category];\n\t\t\t\tif (cat) {\n\t\t\t\t\titemContainer.views.$item.setImage(cat.iconUrl);\n\t\t\t\t}\n\t\t\t\titemContainer._index = i;\n\t\t\t\titemContainer.views.$icon.setImage(itemInfo[i].iconUrl);\n\t\t\t\titemContainer.views.$item.onInputSelect = bind(this, 'selectItem', itemContainer);\n\t\t\t\titemContainer.addState('$item', 'category_' + itemInfo[i].category);\n\n\t\t\t\t// if the item is marked as owned then make sure the user owns it\n\t\t\t\tvar data = weebyLocalData.getShopItemData(itemInfo[i]);\n\t\t\t\tif (!data.owned && (itemInfo[i].owned || itemInfo[i].unlocked)) {\n\t\t\t\t\tweebyLocalData.purchaseShopItem(itemInfo[i]);\n\t\t\t\t}\n\t\t\t\tif (data.equipped) {\n\t\t\t\t\titemContainer.addState('$item', 'equipped');\n\t\t\t\t}\n\n\t\t\t\tthis.updateItem(itemContainer);\n\n\t\t\t\t// select the first item\n\t\t\t\tif (i == 0) {\n\t\t\t\t\tthis.selectItem(itemContainer);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// make sure the proper number of items are equipped per category\n\t\t\tthis.resolveItemEquips();\n\t\t}\n\t};\n\n\t// this goes through each item/category and makes sure the proper amount\n\t// of items are equipped\n\tthis.resolveItemEquips = function() {\n\t\tvar itemCount = itemInfo.length;\n\n\t\t// reset the count\n\t\tfor (var cat in categoryInfo) {\n\t\t\tequipCount[cat] = 0;\n\t\t}\n\n\t\t// count the number of equipped items\n\t\tfor (var i = 0; i < itemCount; i++) {\n\t\t\tvar item = itemInfo[i];\n\t\t\tvar data = weebyLocalData.getShopItemData(item);\n\t\t\tif (data.equipped) {\n\t\t\t\tequipCount[item.category] += 1;\n\t\t\t}\n\t\t}\n\n\t\t// make sure too many items are not equipped per category\n\t\tfor (var i = itemCount - 1; i >= 0; i--) {\n\t\t\tvar item = itemInfo[i];\n\t\t\tvar data = weebyLocalData.getShopItemData(item);\n\t\t\tvar cat = categoryInfo[item.category];\n\t\t\tif (data.equipped && cat.usableItems && equipCount[item.category] > cat.usableItems) {\n\t\t\t\tthis.unequipItem(item);\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t// make sure the mimimum items are equipped per category\n\t\tfor (var i = 0; i < itemCount; i++) {\n\t\t\tvar item = itemInfo[i];\n\t\t\tvar data = weebyLocalData.getShopItemData(item);\n\t\t\tvar cat = categoryInfo[item.category];\n\t\t\tif (!data.equipped && cat.minEquipped &&  equipCount[item.category] < cat.minEquipped) {\n\t\t\t\tthis.equipItem(item);\n\t\t\t}\n\t\t}\n\t}\n\n\t// selects the given item container\n\tthis.selectItem = function (itemContainer) {\n\t\tif (this.selectedItem) {\n\t\t\tthis.selectedItem.removeState('$item', 'selected');\n\t\t\tvar selectedData = itemInfo[this.selectedItem._index];\n\t\t\tthis.selectedItem.removeState('$item', 'category_' + selectedData.category  + '_selected');\n\t\t}\n\t\tvar item = itemInfo[itemContainer._index];\n\t\titemContainer.addState('$item', 'selected');\n\t\titemContainer.addState('$item', 'category_' + item.category  + '_selected');\n\t\tthis.selectedItem = itemContainer;\n\n\t\t// update the item description\n\t\tthis.updateSelectedInfo();\n\t\t\n\t\t// update the action button\n\t\tthis.updateActionButton(itemContainer);\n\t}\n\n\t// updates the information for the selected item (this includes its title/description)\n\tthis.updateSelectedInfo = function () {\n\t\tif (this.selectedItem) {\n\t\t\tvar item = itemInfo[this.selectedItem._index];\n\t\t\tvar data = weebyLocalData.getShopItemData(item);\n\n\t\t\t// update the selected item description/images\n\t\t\tthis._views.$selectedIcon.setImage(item.iconUrl);\n\t\t\tthis._views.$selectedTitle.setText(item.name);\n\t\t\t// if the item has multiple descriptions choose from there\n\t\t\tif (item.descriptions && data.level < item.descriptions.length) {\n\t\t\t\tthis._views.$selectedDescription.setText(item.descriptions[data.level]);\n\t\t\t} else {\n\t\t\t\tthis._views.$selectedDescription.setText(item.description);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// update the text information on an itemcontainer (level/count)\n\tthis.updateItem = function (itemContainer) {\n\t\tvar item = itemInfo[itemContainer._index];\n\t\tvar data = weebyLocalData.getShopItemData(item);\n\t\tif (item.canLevel && data.level > 0) {\n\t\t\titemContainer.views.$level.style.visible = true;\n\t\t\titemContainer.views.$level.setText(i18n.get(\"itemShopLevel\") + data.level);\n\t\t} else {\n\t\t\titemContainer.views.$level.style.visible = false;\n\t\t}\n\t\tif (item.canConsume) {\n\t\t\titemContainer.views.$count.style.visible = true;\n\t\t\titemContainer.views.$count.setText(data.count);\n\t\t} else {\n\t\t\titemContainer.views.$count.style.visible = false;\n\t\t}\n\t}\n\t\n\t// update the action button text and current action\n\tthis.updateActionButton = function(itemContainer) {\n\t\tvar item = itemInfo[itemContainer._index];\n\t\tvar data = weebyLocalData.getShopItemData(item);\n\t\tvar cat = categoryInfo[item.category];\n\t\tlogger.log(JSON.stringify(data));\n\n\t\tthis._currentAction = 'buy';\n\t\t// If the item is not owned the user must always buy it first\n\t\tif (!data.owned) {\n\t\t\tthis._views.$actionButtonTopText.setText(i18n.get('unlock'));\n\t\t} else {\n\t\t\t// if the item cannot be equipped it can only be bought or upgraded\n\t\t\tif (!item.canEquip) {\n\t\t\t\tvar text = i18n.get('buy');\n\t\t\t\tif (item.canLevel) {\n\t\t\t\t\tif (!item.maxLevel || data.level < item.maxLevel) {\n\t\t\t\t\t\ttext = i18n.get('upgrade');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._views.$actionButtonCenterText.setText(i18n.get('max'));\n\t\t\t\t\t\tthis._currentAction = 'none';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._views.$actionButtonTopText.setText(text);\n\t\t\t} else {\n\t\t\t\t// If the item is not equipped yet then the user must equip it first\n\t\t\t\tif (!data.equipped) {\n\t\t\t\t\tthis._views.$actionButtonCenterText.setText(i18n.get('equip'));\n\t\t\t\t\tthis._currentAction = 'equip';\n\t\t\t\t} else {\n\t\t\t\t\t// If the item is equipped then display unequip/buy/upgrade depending\n\t\t\t\t\t// on the item type\n\t\t\t\t\tif (item.canLevel && !item.maxLevel || data.level < item.maxLevel) {\n\t\t\t\t\t\tthis._views.$actionButtonTopText.setText(i18n.get('upgrade'));\n\t\t\t\t\t} else if (item.canConsume) {\n\t\t\t\t\t\tthis._views.$actionButtonTopText.setText(i18n.get('buy'));\n\t\t\t\t\t} else if (equipCount[item.category] <= cat.minEquipped) {\n\t\t\t\t\t\tthis._views.$actionButtonCenterText.setText(i18n.get('equipped'));\n\t\t\t\t\t\tthis._currentAction = 'none';\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._views.$actionButtonCenterText.setText(i18n.get('unequip'));\n\t\t\t\t\t\tthis._currentAction = 'unequip';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// for all buy/upgrade actions show the cost on the button\n\t\tif (this._currentAction == 'buy') {\n\t\t\tthis._views.$actionButtonCenterText.style.visible = false;\n\t\t\tthis._views.$actionButtonBuyView.style.visible = true;\n\t\t\tthis._views.$actionButtonCost.setText(item.cost);\n\t\t\tif (currencyInfo[item.currency]) {\n\t\t\t\tthis._views.$actionButtonCurrency.setImage(currencyInfo[item.currency].iconUrl);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._views.$actionButtonCenterText.style.visible = true;\n\t\t\tthis._views.$actionButtonBuyView.style.visible = false;\n\t\t}\n\n\n\t}\n\n\tthis.equipItem = function(item) {\n\t\tvar eCount = 0;\n\t\tvar maxCount = categoryInfo[item.category].usableItems;\n\t\tvar lastItem;\n\n\t\t// count the number of items that are equipped\n\t\tfor (var i = 0; i < itemInfo.length; i++) {\n\t\t\tif (itemInfo[i].category == item.category &&\n\t\t\t\t\titemInfo[i].id != item.id &&\n\t\t\t\t\tweebyLocalData.getShopItemData(itemInfo[i]).equipped) {\n\t\t\t\t\t\teCount++;\n\t\t\t\t\t\tlastItem = itemInfo[i];\n\t\t\t\t\t}\n\t\t}\n\n\t\t// if too many items are equipped (unequip last item)\n\t\tif (lastItem && maxCount && eCount >= maxCount) {\n\t\t\tthis.unequipItem(lastItem);\n\t\t\teCount--;\n\t\t}\n\n\t\t// equip the item if few enough items are equipped\n\t\tif (!maxCount || eCount < maxCount) {\n\t\t\tweebyLocalData.setShopItemEquipped(item, true);\n\t\t\tequipCount[item.category] += 1;\n\t\t\titemContainers[item.id].addState('$item', 'equipped');\n\t\t}\n\t}\n\n\tthis.unequipItem = function(item) {\n\t\tweebyLocalData.setShopItemEquipped(item, false);\n\t\tequipCount[item.category] -= 1;\n\t\titemContainers[item.id].removeState('$item', 'equipped');\n\t}\n\n\tthis.actionButtonClick = function () {\n\t\tif (!this.selectedItem) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar item = itemInfo[this.selectedItem._index];\n\n\t\tif (this._currentAction == 'buy') {\n\t\t\tweebyController.handleAction('buy', item);\n\t\t} else if (this._currentAction == 'equip') {\n\t\t\tthis.equipItem(item);\n\t\t} else if (this._currentAction == 'unequip') {\n\t\t\tthis.unequipItem(item);\n\t\t}\n\n\t\tthis.updateSelectedInfo();\n\t\tthis.updateActionButton(this.selectedItem);\n\t\tthis.updateItem(this.selectedItem);\n\t}\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\n\t};\n\n});\n\n","pre":true},"sdk/timestep/ui/widget/GridView.js":{"path":"sdk/timestep/ui/widget/GridView.js","friendlyPath":"ui.widget.GridView","directory":"sdk/timestep/ui/widget/","filename":"GridView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio(\"import ui.View as View\");\n\n/**\n * @class ui.widget.GridView\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/widget/gridview.md\n */\nGridView=__class__;exports = GridView=GridView(function GridView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\thorizontalMargin: 0,\n\t\t\tverticalMargin: 0,\n\t\t\thorizontalGutter: 0,\n\t\t\tverticalGutter: 0,\n\t\t\tautoCellSize: true\n\t\t});\n\n\t\tsupr(this, \"init\", [opts]);\n\n\t\tthis._rows = Math.max(opts.rows || 3, 1);\n\t\tthis._cols = Math.max(opts.cols || 3, 1);\n\n\t\tthis._lastWidth = null;\n\t\tthis._lastHeight = null;\n\n\t\tthis._colInfo = [];\n\t\tthis._rowInfo = [];\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\tif ((\"horizontalMargin\" in opts) || (\"verticalMargin\" in opts)) {\n\t\t\tthis.needsReflow();\n\t\t} else if ((\"horizontalGutter\" in opts) || (\"verticalGutter\" in opts)) {\n\t\t\tthis._lastWidth = null;\n\t\t\tthis._lastHeight = null;\n\t\t\tthis.needsReflow();\n\t\t}\n\n\t\tsupr(this, \"updateOpts\", [opts]);\n\t};\n\n\t// Make a list of cell sizes, rounding errors can lead to cells\n\t// having a slightly different size which is why they are stored...\n\tthis._getInfo = function (list, count, totalSize, gutterSize) {\n\t\tvar globalScale = this.getPosition().scale;\n\t\tvar size = ((totalSize + gutterSize) / count) | 0;\n\n\t\tvar balance = 0;\n\t\tvar sizeSum = 0;\n\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tvar item = list[i];\n\t\t\tif (!item) {\n\t\t\t\titem = {};\n\t\t\t\tlist[i] = item;\n\t\t\t}\n\t\t\tvar idealSize = size + balance;\n\t\t\tvar roundedSize = Math.round(globalScale * size) / globalScale;\n\t\t\tbalance = idealSize - roundedSize;\n\t\t\titem.size = size;\n\t\t\tsizeSum += size;\n\t\t}\n\t\tlist[count >> 1].size += (totalSize - sizeSum);\n\n\t\tvar pos = 0;\n\t\tvar start = 0;\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tvar item = list[i];\n\t\t\titem.pos = pos;\n\t\t\tpos += item.size;\n\t\t\tstart = gutterSize;\n\t\t\titem.size -= start;\n\t\t}\n\t};\n\n\tthis._resize = function () {\n\t\tvar width =  this.style.width;\n\t\tvar height = this.style.height;\n\n\t\tthis._lastWidth = width;\n\t\tthis._lastHeight = height;\n\n\t\tthis._getInfo(this._colInfo, this._cols, width, this._opts.horizontalGutter);\n\t\tthis._getInfo(this._rowInfo, this._rows, height, this._opts.verticalGutter);\n\t};\n\n\t// Define getters and setters in a subview of GridView, when the col, row, colspan or rowspan\n\t// of the subview changes its location is calculated based on the GridView grid...\n\tthis._createGetSet = function (subview, opts, property) {\n\t\tvar privateProperty = \"_\" + property;\n\t\topts[privateProperty] = opts[property];\n\t\topts.__defineSetter__(property, bind(this, function (c) {\n\t\t\tif (opts[privateProperty] !== c) {\n\t\t\t\topts[privateProperty] = c;\n\t\t\t\tthis._updateSubview(subview);\n\t\t\t}\n\t\t}));\n\n\t\topts.__defineGetter__(property, function () {\n\t\t\treturn opts[privateProperty];\n\t\t});\n\t};\n\n\tthis._checkSubview = function (subview, opts) {\n\t\tif (!(\"row\" in opts) || !(\"col\" in opts)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (\"_row\" in opts) { // If this private property exists then the getters and setters are there...\n\t\t\treturn true;\n\t\t}\n\n\t\topts.colspan = opts.colspan || 1;\n\t\topts.rowspan = opts.rowspan || 1;\n\n\t\tthis._createGetSet(subview, opts, \"col\");\n\t\tthis._createGetSet(subview, opts, \"row\");\n\t\tthis._createGetSet(subview, opts, \"colspan\");\n\t\tthis._createGetSet(subview, opts, \"rowspan\");\n\n\t\treturn true;\n\t};\n\n\tthis._updateSubview = function (subview) {\n\t\tvar opts = this._opts;\n\t\tvar subviewOpts = subview._opts;\n\t\tvar row = subviewOpts.row;\n\t\tvar col = subviewOpts.col;\n\n\t\t// Check is the range is valid...\n\t\tif ((row < 0) || (row >= this._rows) || (col < 0) || (col >= this._cols)) {\n\t\t\tif (opts.hideOutOfRange) {\n\t\t\t\tsubview.style.visible = false;\n\t\t\t}\n\t\t\treturn;\n\t\t} else if (opts.showInRange) {\n\t\t\tsubview.style.visible = true;\n\t\t}\n\n\t\tvar style = subview.style;\n\t\tvar horizontalMargin = isArray(opts.horizontalMargin) ? opts.horizontalMargin : [opts.horizontalMargin, opts.horizontalMargin];\n\t\tvar verticalMargin = isArray(opts.verticalMargin) ? opts.verticalMargin : [opts.verticalMargin, opts.verticalMargin];\n\n\t\tstyle.x = this._colInfo[col].pos + horizontalMargin[0];\n\t\tstyle.y = this._rowInfo[row].pos + verticalMargin[0];\n\n\t\tif (!opts.autoCellSize) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Calculate the width based on the stored column sizes...\n\t\tvar item = this._colInfo[Math.max(Math.min(col + subviewOpts.colspan - 1, this._cols - 1), 0)];\n\t\tstyle.width = item.pos + item.size - this._colInfo[col].pos - horizontalMargin[0] - horizontalMargin[1];\n\n\t\t// Calculate the height based on the stored row sizes...\n\t\tvar item = this._rowInfo[Math.max(Math.min(row + subviewOpts.rowspan - 1, this._rows - 1), 0)];\n\t\tstyle.height = item.pos + item.size - this._rowInfo[row].pos - verticalMargin[0] - verticalMargin[1];\n\t};\n\n\tthis.reflow = function () {\n\t\t((this.style.width !== this._lastWidth) || (this.style.height !== this._lastHeight)) && this._resize();\n\n\t\tvar subviews = this._subviews;\n\t\tvar i = subviews.length;\n\n\t\twhile (i) {\n\t\t\tvar subview = subviews[--i];\n\t\t\tthis._checkSubview(subview, subview._opts) && this._updateSubview(subview);\n\t\t}\n\t};\n\n\tthis.getCols = function () {\n\t\treturn this._cols;\n\t};\n\n\tthis.setCols = function (cols) {\n\t\tif (this._cols !== cols) {\n\t\t\tthis._cols = Math.max(cols || 3, 1);\n\t\t\tthis._lastWidth = null; // Forces the cell info to be re-calculated...\n\t\t\tthis.needsReflow();\n\t\t}\n\t};\n\n\tthis.getRows = function () {\n\t\treturn this._rows;\n\t};\n\n\tthis.setRows = function (rows) {\n\t\tif (this._rows !== rows) {\n\t\t\tthis._rows = Math.max(rows || 3, 1);\n\t\t\tthis._lastHeight = null; // Forces the cell info to be re-calculated...\n\t\t\tthis.needsReflow();\n\t\t}\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ItemShopConfirmDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ItemShopConfirmDialog.js","friendlyPath":".dialogs.game.ItemShopConfirmDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ItemShopConfirmDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ItemShopConfirmDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ItemShopConfirmDialog(function sdk_plugins_weeby_ui_dialogs_game_ItemShopConfirmDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\n\t\tvar purchase = weebyController.getPurchaseItemShopItem(),\n\t\t\tresults = weebyController.getPurchaseItemShopItemResults(),\n\t\t\ttitle = \"\",\n\t\t\ttext = \"\",\n\t\t\tdata = {\n\t\t\t\titem: purchase.name,\n\t\t\t\tlevel: results.level,\n\t\t\t\tcount: results.count\n\t\t\t};\n\n\t\tif (purchase.canLevel) {\n\t\t\tif (results.level === 1) {\n\t\t\t\t// this item was just unlocked\n\t\t\t\ttitle = i18n.get('itemShopConfirmTitleUnlock');\n\t\t\t\ttext = i18n.get('itemShopConfirmTextUnlock', data);\n\t\t\t} else if (results.level === purchase.maxLevel) {\n\t\t\t\t// this item just reached max level\n\t\t\t\ttitle = i18n.get('itemShopConfirmTitleMaxLevel');\n\t\t\t\ttext = i18n.get('itemShopConfirmTextMaxLevel', data);\n\t\t\t} else {\n\t\t\t\t// this item just leveled up\n\t\t\t\ttitle = i18n.get('itemShopConfirmTitleLevelUp');\n\t\t\t\ttext = i18n.get('itemShopConfirmTextLevelUp', data);\n\t\t\t}\n\t\t} else if (purchase.canConsume) {\n\t\t\t// consumable purchased\n\t\t\ttitle = i18n.get('itemShopConfirmTitleConsumable');\n\t\t\ttext = i18n.get('itemShopConfirmTextConsumable', data);\n\t\t} else {\n\t\t\t// this item was just unlocked\n\t\t\ttitle = i18n.get('itemShopConfirmTitleUnlock');\n\t\t\ttext = i18n.get('itemShopConfirmTextUnlock', data);\n\t\t}\n\n\t\tthis._views.$title.setText(title);\n\t\tthis._views.$text.setText(text);\n\t};\n\n\tthis.onOk = function () {\n\t\tweebyController.handleAction('close');\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopLivesDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopLivesDialog.js","friendlyPath":".dialogs.game.ShopLivesDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopLivesDialog.js","src":"jsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\n\njsio(\"import .ShopDialog\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopLivesDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopLivesDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopLivesDialog(){return this.init&&this.init.apply(this,arguments)},ShopDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tvar weebyConfig = weebyController.getWeebyConfig();\n\n\t\tthis.addRows(this._views.$content, weebyConfig.getLifePurchases());\n\n\t\tthis._views.$title.setText(i18n.get('buyLives'));\n\t};\n\n\tthis._onStartPurchase = function (item) {\n\t\tweebyController.handleAction('purchase', {item: item});\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopLivesSuccessDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopLivesSuccessDialog.js","friendlyPath":".dialogs.game.ShopLivesSuccessDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopLivesSuccessDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopLivesSuccessDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopLivesSuccessDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopLivesSuccessDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\t\tthis._views.$text.setText(i18n.get('livesPurchaseSuccess', weebyController.getPurchaseLivesItem()));\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopPremiumDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopPremiumDialog.js","friendlyPath":".dialogs.game.ShopPremiumDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopPremiumDialog.js","src":"jsio(\"import plugins.billing.billing as billing\");\n\njsio(\"import ....trackers.trackers as trackers\");\n\njsio(\"import ....weebyController\");\njsio(\"import ....weebyLocalData\");\njsio(\"import ....i18n\");\njsio(\"import ...config as config\");\n\njsio(\"import .ShopDialog\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopPremiumDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopPremiumDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopPremiumDialog(){return this.init&&this.init.apply(this,arguments)},ShopDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\t\tthis._pendingPurchases = {};\n\t\tvar weebyConfig = weebyController.getWeebyConfig();\n\n\t\tthis.addRows(this._views.$content, weebyConfig.getPremiumCurrencyPurchases());\n\n\t\tthis._views.$title.setText(i18n.get('buyPremium'));\n\n\t\tthis._views.$dark.style.y = -config.CONTENT_OFFSET_Y;\n\t};\n\n\tthis._onStartPurchase = function(item) {\n\t\tweebyController.handleAction('purchase', {item: item});\n\t\t//TODO disable button until purchase goes through?\n\t};\n\n\tthis.onWeebyState = function (state) {\n\t\tif (state === 'dialogShopPremium.purchasing') {\n\t\t\ttrackers.track('store:dialogPending');\n\t\t\tthis._views.$purchasingText.setText(i18n.get('purchasing', weebyController.getPurchasePremiumItem()));\n\t\t\tthis._views.$purchasing.style.visible = true;\n\t\t} else {\n\t\t\tthis._views.$purchasing.style.visible = false;\n\t\t}\n\t};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/ShopPremiumSuccessDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/ShopPremiumSuccessDialog.js","friendlyPath":".dialogs.game.ShopPremiumSuccessDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"ShopPremiumSuccessDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyController\");\n\njsio(\"import ....i18n\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_ShopPremiumSuccessDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_ShopPremiumSuccessDialog(function sdk_plugins_weeby_ui_dialogs_game_ShopPremiumSuccessDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.show = function () {\n\t\tsupr(this, 'show');\n\t\tthis._views.$text.setText(i18n.get('premiumPurchaseSuccess', weebyController.getPurchasePremiumItem()));\n\t};\n});","pre":true},"sdk/plugins/weeby/ui/dialogs/game/AuthDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/AuthDialog.js","friendlyPath":".dialogs.game.AuthDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"AuthDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\njsio(\"import ....weebyController\");\njsio(\"import ....i18n\");\njsio(\"import ....trackers.trackers as trackers\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_AuthDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_AuthDialog(function sdk_plugins_weeby_ui_dialogs_game_AuthDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._confirmAction = 'ok';\n\t\tthis._cancelAction = 'ok';\n\t\tthis._countryCode = '';\n\t\tthis._countryName = '';\n\t\tthis._countryIso = '';\n\t\tthis._phoneNumber = '';\n\t\tthis._fullName = '';\n\t\tthis._username = '';\n\n\t\tthis._views.$singleButton.on('InputSelect', bind(this, 'confirm'), true);\n\t\tthis._views.$leftButton.on('InputSelect', bind(this, 'cancelButton'), true);\n\t\tthis._views.$rightButton.on('InputSelect', bind(this, 'confirm'), true);\n\n\t\tweebyController.on('AuthDialog', bind(this, 'changeData'));\n\t\tweebyController.on('VerifyError', bind(this, 'handleAuthError'));\n\t};\n\n\tthis.confirm = function() {\n\t\tif (this._confirmAction === 'verify' || this._confirmAction === 'voice') {\n\t\t\tthis.setLoadState();\n\t\t\tweebyController.handleAction(this._confirmAction, {\n\t\t\t\tcountryCode: this._countryCode,\n\t\t\t\tphoneNumber: this._phoneNumber,\n\t\t\t\tcountryIso: this._countryIso,\n\t\t\t\tfullName: this._fullName,\n\t\t\t\tusername: this._username\n\t\t\t});\n\t\t} else {\n\t\t\tweebyController.handleAction(this._confirmAction);\n\t\t}\n\t}\n\n\tthis.cancelButton = function() {\n\t\tweebyController.handleAction(this._cancelAction);\n\t}\n\n\tthis.changeData = function(data) {\n\t\tif (data.countryCode != null) this._countryCode = data.countryCode;\n\t\tif (data.phoneNumber != null) this._phoneNumber = data.phoneNumber;\n\t\tif (data.countryName != null) this._countryName = data.countryName;\n\t\tif (data.iso != null) this._countryIso = data.iso;\n\t\tif (data.fullName != null) this._fullName = data.fullName;\n\t\tif (data.username != null) this._username = data.username;\n\n\t\t// check for any predefined substates\n\t\tif (data.substate != null) {\n\t\t\tthis.onSubstate(data.substate);\n\t\t\treturn;\n\t\t}\n\n\t\t// change state according to opts\n\t\tif (data.buttonAction != null) this._confirmAction = data.buttonAction;\n\t\tif (data.rightButtonAction != null) this._confirmAction = data.rightButtonAction;\n\t\tif (data.leftButtonAction != null) this._cancelAction = data.leftButtonAction;\n\t\tif (data.title != null) this._views.$title.setText(data.title);\n\t\tif (data.message != null) this._views.$message.setText(data.message);\n\n\t\tif (data.singleButton) {\n\t\t\tthis._views.$singleButton.style.visible = true;\t\n\t\t\tthis._views.$leftButton.style.visible = false;\n\t\t\tthis._views.$rightButton.style.visible = false;\n\n\t\t\tif (data.buttonText != null) {\n\t\t\t\tthis._views.$singleButtonText.setText(data.buttonText);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._views.$singleButton.style.visible = false;\n\t\t\tthis._views.$leftButton.style.visible = true;\n\t\t\tthis._views.$rightButton.style.visible = true;\n\n\t\t\tif (data.leftButtonText != null) {\n\t\t\t\tthis._views.$leftButtonText.setText(data.leftButtonText);\n\t\t\t}\n\n\t\t\tif (data.rightButtonText != null) {\n\t\t\t\tthis._views.$rightButtonText.setText(data.rightButtonText);\n\t\t\t}\n\t\t}\n\n\t\tthis._views.$message.updateOpts({ textAlign: 'left' });\n\t\tsetTimeout(bind(this, function() {\n\t\t\t// height just doesn't want to update sometimes without\n\t\t\t// this setTimeout 0\n\t\t\t// TODO: fix me. Maybe change to style states.\n\t\t\tthis._views.$dialog.style.height = 380;\n\t\t}), 0);\n\t}\n\n\tthis.handleAuthError = function(error) {\n\t\tconsole.log(\"Handle auth error: \" + JSON.stringify(error));\t\n\t\tif (error.response && /is\\snot\\sa\\smobile\\snumber/.test(error.response)) {\n\t\t\tthis.setNotMobileNumberErrorState();\t\n\t\t} else {\n\t\t\tthis.setPhoneNumberErrorState();\n\t\t}\n\t}\n\n\tthis.setNotMobileNumberErrorState = function() {\n\t\tthis._views.$title.setText(i18n.get(\"somethingNotRight\"));\n\t\tthis._views.$message.setText(i18n.get(\"notMobileNumber\") + \n\t\t\t\t\t\t\t\t\t ' ' + \n\t\t\t\t\t\t\t\t\t this._countryName + \n\t\t\t\t\t\t\t\t\t '. ' + \n\t\t\t\t\t\t\t\t\t i18n.get('notMobileNumber2'));\n\t\tthis._views.$singleButton.style.visible = false;\n\t\tthis._views.$leftButton.style.visible = true;\n\t\tthis._views.$rightButton.style.visible = true;\n\t\tthis._views.$message.updateOpts({ textAlign: 'left' });\n\t\tthis._views.$dialog.style.height = 380;\n\t\tthis._confirmAction = 'voice';\n\t\tthis._cancelAction = 'ok';\n\t\tthis._views.$leftButtonText.setText(i18n.get(\"tryAgain\"));\t\n\t\tthis._views.$rightButtonText.setText(i18n.get(\"voice\"));\t\n\t};\n\n\tthis.setLoadState = function() {\n\t\tthis._views.$title.setText(i18n.get(\"pleaseWait\"));\n\t\tthis._views.$message.setText(i18n.get(\"connecting\"));\n\t\tthis._views.$message.updateOpts({ textAlign: 'center' });\n\t\tthis._views.$singleButton.style.visible = false;\n\t\tthis._views.$leftButton.style.visible = false;\n\t\tthis._views.$rightButton.style.visible = false;\n\t\tthis._views.$dialog.style.height = 270;\n\t}\n\n\tthis.setErrorState = function(errorText) {\n\t\tthis._views.$title.setText(i18n.get(\"somethingNotRight\"));\n\t\tthis._views.$message.setText(errorText);\n\t\tthis._views.$singleButton.style.visible = true;\n\t\tthis._views.$leftButton.style.visible = false;\n\t\tthis._views.$rightButton.style.visible = false;\n\t\tthis._views.$message.updateOpts({ textAlign: 'left' });\n\t\tthis._views.$dialog.style.height = 380;\n\t\tthis._confirmAction = 'ok';\n\t\tthis._cancelAction = 'ok';\n\t\tthis._views.$singleButtonText.setText(i18n.get(\"tryAgain\"));\t\n\t}\n\t\n\tthis.setPhoneNumberErrorState = function() {\n\t\tthis.changeData({\n\t\t\tsingleButton: true,\n\t\t\ttitle: i18n.get(\"somethingNotRight\"),\n\t\t\tmessage: i18n.get(\"phoneNumberNotValid\") + ' ' + this._countryName,\n\t\t\tbuttonText: i18n.get(\"tryAgain\"),\n\t\t\tbuttonAction: 'ok'\n\t\t});\n\t}\n\n\tthis.setVoiceState = function(messageText) {\n\t\tthis._views.$title.setText(i18n.get(\"somethingNotRight\"));\n\t\tthis._views.$message.setText(messageText);\n\t\tthis._views.$singleButton.style.visible = false;\n\t\tthis._views.$leftButton.style.visible = true;\n\t\tthis._views.$rightButton.style.visible = true;\n\t\tthis._views.$message.updateOpts({ textAlign: 'left' });\n\t\tthis._views.$dialog.style.height = 380;\n\t\tthis._confirmAction = 'voice';\n\t\tthis._cancelAction = 'ok';\n\t\tthis._views.$leftButtonText.setText(i18n.get(\"tryAgain\"));\t\n\t\tthis._views.$rightButtonText.setText(i18n.get(\"voice\"));\t\n\t}\n\n\tthis.onSubstate = function(substate) {\n\t\tswitch (substate) {\n\t\t\tcase 'nameError': \n\t\t\t\tthis.setErrorState(i18n.get(\"authErrorSetName\"));\n\t\t\t\tbreak;\n\t\t\tcase 'codeError': \n\t\t\t\tthis.setErrorState(i18n.get(\"codeTooShort\"));\n\t\t\t\tbreak;\n\t\t\tcase 'codeIncorrect':\n\t\t\t\tthis.setVoiceState(i18n.get('invalidCode') + ' ' + i18n.get('notMobileNumber2'));\n\t\t\t\tbreak;\n\t\t\tcase 'loading':\n\t\t\t\tthis.setLoadState();\n\t\t\t\tbreak;\n\t\t}\t\n\t}\n\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/VerifyingDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/VerifyingDialog.js","friendlyPath":".dialogs.game.VerifyingDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"VerifyingDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\njsio(\"import ....weebyController\");\njsio(\"import ....i18n\");\njsio(\"import ....sdk.simulator.PhoneFormat as PhoneFormat\");\njsio(\"import ....weebyNative as weebyNative\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_VerifyingDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_VerifyingDialog(function sdk_plugins_weeby_ui_dialogs_game_VerifyingDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\n\tvar TIMEOUT = 1000 * 60 * 5;\n\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._running = false;\n\t\tthis._timeStart = 0;\n\t\tthis._timer = null;\n\n\t\tthis._countryCode = '';\n\t\tthis._phoneNumber = '';\n\t\tthis._fullName = '';\n\t\tthis._username = '';\n\n\t\tthis._views.$editButton.on('InputSelect', bind(this, 'editNumber'));\n\t\tthis._views.$manualButton.on('InputSelect', bind(this, 'enterManually'));\n\n\t\tweebyController.on('NumberSubmitSuccess', bind(this, 'update'));\n\t\tweebyNative.on('authCode', bind(this, 'autoDetect'));\n\t}\n\n\tthis.update = function(data) {\n\t\tthis._countryCode = data.countryCode;\t\n\t\tthis._phoneNumber = data.phoneNumber;\n\t\tthis._fullName = data.fullName;\n\t\tthis._username = data.username;\n\n\t\tthis._views.$phoneTitle.setText('+' + this._countryCode + ' ' + PhoneFormat.formatLocal(data.countryIso, this._phoneNumber));\n\t\tthis.start();\n\t}\n\n\tthis.autoDetect = function(data) {\n\t\tvar code = data.code;\t\n\t\tconsole.log('autodetect sms code: ' + code);\n\t\tweebyController.handleAction('autodetect', {\n\t\t\tphoneNumber: this._countryCode + this._phoneNumber,\n\t\t\tcode: code,\n\t\t\tfullName: this._fullName,\n\t\t\tusername: this._username\n\t\t});\n\t}\n\n\tthis.start = function() {\n\t\tif (!this._running) {\n\t\t\tthis._running = true;\t\n\t\t\tthis._timeStart = +(new Date);\n\n\t\t\tthis.incrementProgress();\n\n\t\t\t// DEBUG\n\t\t\t//var that = this;\n\t\t\t//setTimeout(function() {\n\t\t\t//\tthat.autoDetect({ code: '1234' });\t\n\t\t\t//}, 3000);\n\t\t}\n\t}\n\n\tthis.incrementProgress = function() {\n\t\tif (!this._running) {\n\t\t\treturn;\t\n\t\t}\n\n\t\tvar that = this;\n\t\tvar diff = +(new Date) - this._timeStart;\n\t\tvar progress = diff == 0 ? diff : ~~((diff / TIMEOUT) * 100);\n\t\tthis._views.$progressText.setText(progress + '% Complete');\n\n\t\tif (progress >= 100) {\n\t\t\tthat.finish();\t\t\n\t\t} else {\n\t\t\tvar interval = ~~(TIMEOUT / 100);\n\t\t\tthis._timer = setTimeout(function() {\n\t\t\t\tthat.incrementProgress();\t\n\t\t\t}, interval);\t\n\t\t}\n\t}\n\n\tthis.finish = function() {\n\t\tclearTimeout(this._timer);\n\t\tthis._running = false;\n\n\t\tweebyController.handleAction('finish', {\n\t\t\tcountryCode: this._countryCode,\n\t\t\tphoneNumber: this._phoneNumber,\n\t\t\tfullName: this._fullName,\n\t\t\tusername: this._username,\n\t\t\tsingleButton: false,\n\t\t\ttitle: i18n.get(\"somethingNotRight\"),\n\t\t\tmessage: i18n.get(\"smsError\") + ' ' + i18n.get('notMobileNumber2'),\n\t\t\tleftButtonText: i18n.get('tryAgain'),\n\t\t\trightButtonText: i18n.get('voice'),\n\t\t\tleftButtonAction: 'ok',\n\t\t\trightButtonAction: 'voice'\n\t\t});\n\t}\n\n\tthis.editNumber = function() {\n\t\tif (this._timer != null) {\n\t\t\tclearTimeout(this._timer);\t\n\t\t\tthis._running = false;\n\t\t}\t\t\n\n\t\tweebyController.handleAction('edit');\n\t}\n\n\tthis.enterManually = function() {\n\t\tif (this._timer != null) {\n\t\t\tclearTimeout(this._timer);\t\n\t\t\tthis._running = false;\n\t\t}\t\t\n\n\t\tweebyController.handleAction('enterManually', {\n\t\t\tcountryCode: this._countryCode,\n\t\t\tphoneNumber: this._phoneNumber,\n\t\t\tfullName: this._fullName,\n\t\t\tusername: this._username\n\t\t});\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/game/PhotoPickDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/game/PhotoPickDialog.js","friendlyPath":".dialogs.game.PhotoPickDialog","directory":"sdk/plugins/weeby/ui/dialogs/game/","filename":"PhotoPickDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\njsio(\"import ....weebyController\");\njsio(\"import ....i18n\");\njsio(\"import ....weebyNative\");\njsio(\"import ....trackers.trackers as trackers\");\njsio(\"import ....weebyStates\");\njsio(\"import ....weebyAbTests\");\n\nvar sdk_plugins_weeby_ui_dialogs_game_PhotoPickDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_game_PhotoPickDialog(function sdk_plugins_weeby_ui_dialogs_game_PhotoPickDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function (supr) {\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', [opts]);\n\t\tthis._views.$takePictureButton.on('InputSelect', bind(this, 'takePicture'));\n\t\tthis._views.$choosePictureButton.on('InputSelect', bind(this, 'choosePicture'));\n\t\tthis._views.$backButton.on('InputSelect', bind(this, 'onBack'));\n\n\t\tweebyNative.on('PhotoBeginLoaded', bind(this, function() {\n\t\t\tif (weebyStates.states[weebyController._state] === 'STATE_DIALOG_PHOTO_PICK') {\n\t\t\t\tlogger.log('==============================');\n\t\t\t\tlogger.log('received photo begin loaded event');\n\t\t\t\tlogger.log('===========================');\n\t\t\t\tweebyController.handleAction('photoReturn');\n\t\t\t}\n\t\t}));\n\n\t\tweebyNative.on('PhotoLoaded', bind(this, function(evt) {\n\t\t\tif (weebyStates.states[weebyController._state] === 'STATE_DIALOG_PHOTO_PICK' ||\n\t\t\t\tweebyStates.states[weebyController._state] === 'STATE_VERIFY' ||\n\t\t\t\tweebyStates.states[weebyController._state] === 'STATE_VERIFY_PHOTO') {\n\t\t\t\tlogger.log('==============================');\n\t\t\t\tlogger.log('received photo loaded event');\n\t\t\t\tlogger.log('===========================');\n\t\t\t\ttrackers.track('auth:photoSet');\n\n\t\t\t\tif (weebyAbTests.isAbTest(weebyAbTests.ABTest_authVariant,\n\t\t\t\t\t\t\t\t\t\t weebyAbTests.ABTest_authVariant.VARIANT2)) {\n\t\t\t\t\tweebyController.emit('AuthPhotoUpdate:verifyPhoto', evt.data);\n\t\t\t\t} else {\n\t\t\t\t\tweebyController.emit('AuthPhotoUpdate', evt.data);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tweebyController.getUser().setPhoto(evt.data, bind(this, function (err, data) {\n\t\t\t\t\ttrackers.track('auth:photoSet:success');\n\t\t\t\t}), true);\n\t\t\t}\n\t\t}));\n\t}\n\n\tthis.onBack = function() {\n\t\ttrackers.track('auth:photoPickerBack');\n\t\tweebyController.popState();\n\t}\n\n\tthis.takePicture = function() {\n\t\tif (NATIVE.camera) {\n\t\t\ttrackers.track('auth:takeNewPhoto');\n\t\t\tNATIVE.camera.getPhoto('photo' + (+ new Date));\n\t\t}\n\t}\n\n\tthis.choosePicture = function() {\n\t\tif (NATIVE.gallery) {\n\t\t\ttrackers.track('auth:chooseExistingPhoto');\n\t\t\tNATIVE.gallery.getPhoto('photo' + (+ new Date));\n\t\t}\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/profile/ChoosePhotoSourceDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/profile/ChoosePhotoSourceDialog.js","friendlyPath":".dialogs.profile.ChoosePhotoSourceDialog","directory":"sdk/plugins/weeby/ui/dialogs/profile/","filename":"ChoosePhotoSourceDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyNative\");\njsio(\"import ....weebyController\");\njsio(\"import ....weebyStates\");\n\nvar sdk_plugins_weeby_ui_dialogs_profile_ChoosePhotoSourceDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_profile_ChoosePhotoSourceDialog(function sdk_plugins_weeby_ui_dialogs_profile_ChoosePhotoSourceDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function(supr) {\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\t// center the dialog\n\t\tvar contents = this._views.$contents,\n\t\t\theader = this._views.$header,\n\t\t\tparent = contents.getSuperview(),\n\t\t\tcenterY = (parent.style.height - contents.style.height) / 2;\n\n\t\tcontents.style.y = centerY;\n\t\theader.style.y = centerY;\n\n\t\tthis._views.$back.on('InputSelect', bind(this, 'onBack'));\n\t\tthis._views.$camera.on('InputSelect', bind(this, 'onCamera'));\n\t\tthis._views.$gallery.on('InputSelect', bind(this, 'onGallery'));\n\n\t\tweebyNative.on('PhotoBeginLoaded', bind(this, function() {\n\t\t\tif (this._views.$dialog.style.visible) {\n\t\t\t\tthis.onBack();\n\t\t\t\tweebyController.emit('PhotoBeginLoad');\n\t\t\t}\n\t\t}));\n\n\t\tweebyNative.on('PhotoLoaded', bind(this, function(evt) {\n\t\t\tif (weebyStates.states[weebyController._state] === 'STATE_DIALOG_CHOOSE_PHOTO_SOURCE' ||\n\t\t\t\tweebyStates.states[weebyController._state] === 'STATE_EDIT_PROFILE') {\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('got a picture');\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('-----------------------------');\n\t\t\t\tlogger.log('-----------------------------');\n\n\t\t\t\tvar base64Image = evt.data;\n\t\t\t\tweebyController.getUser().setPhoto(base64Image, function () {\n\t\t\t\t\tweebyController.emit('EditProfilePhotoUpdate', base64Image);\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t};\n\n\tthis.show = function() {\n\t\tsupr(this, 'show');\n\t\tthis.enableInput();\n\t};\n\n\tthis.onBack = function() {\n\t\tweebyController.popState();\n\t};\n\n\tthis.onCamera = function() {\n\t\tNATIVE.camera.getPhoto('photo' + (+ new Date()));\n\t};\n\n\tthis.onGallery = function() {\n\t\tNATIVE.gallery.getPhoto('photo' + (+ new Date()));\n\t};\n\n\tthis.update = function() {};\n});\n","pre":true},"sdk/plugins/weeby/ui/dialogs/profile/FullnameConfirmDialog.js":{"path":"sdk/plugins/weeby/ui/dialogs/profile/FullnameConfirmDialog.js","friendlyPath":".dialogs.profile.FullnameConfirmDialog","directory":"sdk/plugins/weeby/ui/dialogs/profile/","filename":"FullnameConfirmDialog.js","src":"jsio(\"import ...components.WeebyBaseDialog as WeebyBaseDialog\");\n\njsio(\"import ....weebyNative\");\njsio(\"import ....weebyController\");\n\nvar sdk_plugins_weeby_ui_dialogs_profile_FullnameConfirmDialog=__class__;exports=sdk_plugins_weeby_ui_dialogs_profile_FullnameConfirmDialog(function sdk_plugins_weeby_ui_dialogs_profile_FullnameConfirmDialog(){return this.init&&this.init.apply(this,arguments)},WeebyBaseDialog, function(supr) {\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', [opts]);\n\n\t\t// center the dialog\n\t\tvar contents = this._views.$contents,\n\t\t\theader = this._views.$header,\n\t\t\tparent = contents.getSuperview(),\n\t\t\tcenterY = (parent.style.height - contents.style.height) / 2;\n\n\t\tcontents.style.y = centerY;\n\t\theader.style.y = centerY;\n\n\t\tthis._views.$back.on('InputSelect', bind(this, 'onBack'));\n\t\t//this._views.$cancelButton.on('InputSelect', bind(this, 'onBack'));\n\t\tthis._views.$changeButton.on('InputSelect', bind(this, 'onChange'));\n\t};\n\n\tthis.show = function() {\n\t\tsupr(this, 'show');\n\t\tthis.enableInput();\n\t};\n\n\tthis.onBack = function () {\n\t\tweebyController.popState();\n\t};\n\n\tthis.onChange = function () {\n\t\tweebyController.handleAction('change');\n\t};\n\n\tthis.update = function() {};\n});\n","pre":true},"sdk/plugins/weeby/ui/layouts/parser/parser.js":{"path":"sdk/plugins/weeby/ui/layouts/parser/parser.js","friendlyPath":".ui.layouts.parser.parser","directory":"sdk/plugins/weeby/ui/layouts/parser/","filename":"parser.js","src":"jsio(\"import .util as objects\");\njsio(\"import .tokenizer as Tokenizer\");\n\nfunction copy(json) {\n\treturn JSON.parse(JSON.stringify(json));\n}\n\nfunction toString(obj) {\n\treturn JSON.stringify(obj, null, '  ');\n}\n\n/*\n\nTODO:\n\n * parseParams\n * add token type key\n\n*/\n\nvar sdk_plugins_weeby_ui_layouts_parser_parser=__class__;var Parser = exports=sdk_plugins_weeby_ui_layouts_parser_parser(function sdk_plugins_weeby_ui_layouts_parser_parser(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.consumeNewLines = function () {\n\t\twhile (true) {\n\t\t\tvar token = this.tokens.peekNext();\n\t\t\tif (token && token.type == 'newline') {\n\t\t\t\tthis.getNext('newline');\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t}\n\n\tthis.getNext = function (type) {\n\t\ttry {\n\t\t\treturn this.tokens.getNext(type);\n\t\t} catch (e) {\n\t\t\tconsole.log(new Error().stack);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tthis.tryConsume = function (value) {\n\t\tif (value != '\\n') {\n\t\t\tthis.consumeNewLines();\n\t\t}\n\n\t\tvar token = this.tokens.peekNext();\n\t\tif (token && token.value == value) {\n\t\t\tthis.getNext();\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tthis.parse = function (str) {\n\t\tthis.tokens = new Tokenizer(str);\n\n\t\tvar result = {\n\t\t\tviews: {},\n\t\t\tstyles: {}\n\t\t};\n\n\t\twhile (true) {\n\t\t\tvar token = this.getNext();\n\t\t\tif (!token) { break; }\n\n\t\t\tvar name = token.value;\n\t\t\tthis.getNext('assignment');\n\t\t\tvar object = this.parseObject(name);\n\t\t\tif (object.isStyle) {\n\t\t\t\tresult.styles[name] = object;\n\t\t\t} else {\n\t\t\t\tresult.views[name] = object;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tthis.createObject = function (obj) {\n\t\tif (!obj) { obj = {}; }\n\t\tobj.where = this.tokens.getLocation();\n\t\tvar comments = this.tokens.getComments();\n\t\tif (comments) {\n\t\t\tobj.lineComments = comments.lineComments;\n\t\t\tobj.comments = comments.comments;\n\t\t}\n\t\treturn obj;\n\t}\n\n\tthis.parseObject = function (optionalId) {\n\t\tvar obj = this.getNext('word');\n\t\tif (obj.value == 'style') {\n\t\t\t// parse a style\n\t\t\treturn this.parseStyle(obj.value);\n\t\t} else if (obj.value == 'state') {\n\t\t\treturn this.parseStyleState(obj.value);\n\t\t} else {\n\t\t\t// parse a named value (single value associated with a key)\n\t\t\tif (this.tryConsume(':')) {\n\t\t\t\treturn this.createObject({\n\t\t\t\t\tkey: obj.value,\n\t\t\t\t\tvalue: this.parseValue()\n\t\t\t\t});\n\t\t\t} else if (this.tryConsume('=')) {\n\t\t\t\tvar id = obj.value;\n\t\t\t\treturn this.parseView(id, this.getNext('word').value);\n\t\t\t} else {\n\t\t\t\t// parse a view\n\t\t\t\treturn this.parseView(optionalId, obj.value);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.parseValue = function () {\n\t\tvar value = this.getNext('word').value;\n\t\tvar stack = [];\n\t\twhile (true) {\n\t\t\tvar next = this.tokens.peekNext();\n\t\t\tif (!next) {\n\t\t\t\tif (this.stack.length) {\n\t\t\t\t\tthrow new Error('Unmatched parenthesis at ' + stack[stack.length - 1] + ' (current position: ' + next.location + ')');\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (next.value == '(') {\n\t\t\t\tthis.tokens.getNext();\n\t\t\t\tstack.push(next);\n\t\t\t} else if (next.value == ')') {\n\t\t\t\tthis.tokens.getNext();\n\t\t\t\tstack.pop();\n\t\t\t} else if (stack.length || next.type == 'word') {\n\t\t\t\tvar nextValue = this.getNext().value;\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tvalue.push(nextValue);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = [value, nextValue];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.parseStyle = function () {\n\t\tvar style = this.createObject({\n\t\t\tisStyle: true,\n\t\t\tstates: [],\n\t\t\tprops: []\n\t\t});\n\n\t\tstyle.parents = this.parseParams();\n\n\t\t// style contents should only have key/value pairs and states\n\t\tthis.parseContents().forEach(function (obj) {\n\t\t\tif (obj.isState) {\n\t\t\t\tif (Array.isArray(obj.name)) {\n\t\t\t\t\tvar index = obj.name.indexOf('default');\n\t\t\t\t\tvar isDefault = index >= 0;\n\t\t\t\t\tif (isDefault) {\n\t\t\t\t\t\tif (obj.name.length > 1) {\n\t\t\t\t\t\t\tobj.name.splice(index, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstyle.defaultState = obj.name[0];\n\t\t\t\t\t}\n\n\t\t\t\t\tobj.name.forEach(function (name) {\n\t\t\t\t\t\tvar state = objects.deepCopy(obj);\n\t\t\t\t\t\tstate.name = name;\n\t\t\t\t\t\tstyle.states.push(state);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstyle.states.push(obj);\n\t\t\t\t}\n\t\t\t} else if (obj.key && obj.value) {\n\t\t\t\tstyle.props.push(obj);\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unexpected object found at ' + obj.where + ' in a style:\\n' + toString(obj));\n\t\t\t}\n\t\t});\n\n\t\treturn style;\n\t}\n\n\tthis.parseStyleState = function () {\n\t\tvar state = this.createObject({\n\t\t\tisState: true,\n\t\t\tprops: []\n\t\t});\n\n\t\tvar params = this.parseParams();\n\t\tif (!params.length || !params[0].value) {\n\t\t\tthrow new Error('No name found for state at ' + state.where);\n\t\t} else if (params.length > 1) {\n\t\t\tstate.name = params.map(function (param) { return param.value; });\n\t\t} else {\n\t\t\tstate.name = params[0].value;\n\t\t}\n\n\t\tthis.parseContents().forEach(function (obj) {\n\t\t\tif (obj.key && obj.value) {\n\t\t\t\tstate.props.push(obj);\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unexpected object found while parsing a state at ' + obj.where + ':\\n' + toString(obj));\n\t\t\t}\n\t\t});\n\n\t\treturn state;\n\t}\n\n\tthis.parseParams = function () {\n\t\t// params are a comma-separated list of items\n\t\t// each item can be either a plain values or a key/value pair\n\t\tvar result = [];\n\t\tif (!this.tryConsume('(')) {\n\t\t\treturn result;\n\t\t}\n\n\t\tvar param = this.createObject();;\n\t\tvar createParam = bind(this, function () {\n\t\t\t// store current param\n\t\t\tif (param) {\n\t\t\t\tif (param.value) {\n\t\t\t\t\tresult.push(param);\n\n\t\t\t\t\t// create a new one\n\t\t\t\t\tparam = this.createObject();\n\t\t\t\t} else {\n\t\t\t\t\tparam.where = this.tokens.getLocation();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\twhile (true) {\n\t\t\tif (this.tryConsume(')')) {\n\t\t\t\t// end of params\n\t\t\t\tcreateParam();\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\tif (this.tryConsume(',')) {\n\t\t\t\tcreateParam();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar token = this.getNext('word');\n\t\t\tif (this.tryConsume(':')) {\n\t\t\t\t// found a key\n\t\t\t\t\n\t\t\t\t// add the previous param if we have one (comma not required)\n\t\t\t\tcreateParam();\n\n\t\t\t\tparam.key = token.value;\n\t\t\t} else if (!param.value) {\n\t\t\t\t// normal param\n\t\t\t\tparam.value = token.value;\n\n\t\t\t\t// keyed params can have an array of values\n\t\t\t\t// non-keyed params should just be stored as is\n\t\t\t\tif (!param.key) {\n\t\t\t\t\tcreateParam();\n\t\t\t\t}\n\t\t\t} else if (param.key) {\n\t\t\t\t// param already has a value. If we have a key, we're storing\n\t\t\t\t// an array of values under the param.\n\t\t\t\tif (!Array.isArray(param.value)) {\n\t\t\t\t\tparam.value = [param.value, token.value];\n\t\t\t\t} else {\n\t\t\t\t\tparam.value.push(token.value);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unexpected case:' + toString(param) + ' ' + toString(token));\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.parseView = function (id, type) {\n\t\tvar view = this.createObject({\n\t\t\tisView: true,\n\t\t\ttype: type,\n\t\t\tid: id,\n\t\t\tprops: [],\n\t\t\tchildren: []\n\t\t});\n\n\t\tview.params = this.parseParams();\n\t\tthis.parseContents().forEach(function (obj) {\n\t\t\tif (obj.isView) {\n\t\t\t\tview.children.push(obj);\n\t\t\t} else if (obj.key && obj.value) {\n\t\t\t\tview.props.push(obj);\n\t\t\t} else {\n\t\t\t\tthrow new Error('Unexpected object found while parsing a view at ' + obj.where + ':\\n' + toString(obj));\n\t\t\t}\n\t\t});\n\n\t\treturn view;\n\t}\n\n\tthis.parseContents = function () {\n\t\tvar result = [];\n\n\t\t// contents are optional\n\t\tif (!this.tryConsume('[')) {\n\t\t\treturn result;\n\t\t};\n\n\t\twhile (true) {\n\t\t\t// commas are optional\n\t\t\twhile (this.tryConsume(',')) {}\n\n\t\t\tif (this.tryConsume(']')) {\n\t\t\t\t// end of contents\n\t\t\t\treturn result;\n\t\t\t}\n\n\t\t\t// get an object\n\t\t\tresult.push(this.parseObject());\n\t\t}\n\t}\n});\n\n","pre":true},"sdk/plugins/weeby/ui/layouts/parser/util.js":{"path":"sdk/plugins/weeby/ui/layouts/parser/util.js","friendlyPath":".util","directory":"sdk/plugins/weeby/ui/layouts/parser/","filename":"util.js","src":"exports.getValues = function (obj) {\n\treturn Object.keys(obj).map(function (key) { return obj[key]; });\n}\n\nexports.isEmpty = function (obj) {\n\treturn Object.keys(obj).length == 0;\n}\n\nexports.deepCopy = function (obj) {\n\treturn JSON.parse(JSON.stringify(obj));\n}\n\nexports.forEach = function (obj, cb, ctx) {\n\tObject.keys(obj).forEach(function (key) {\n\t\tcb.call(ctx, key, obj[key]);\n\t});\n}\n","pre":true},"sdk/plugins/weeby/ui/layouts/parser/tokenizer.js":{"path":"sdk/plugins/weeby/ui/layouts/parser/tokenizer.js","friendlyPath":".tokenizer","directory":"sdk/plugins/weeby/ui/layouts/parser/","filename":"tokenizer.js","src":"/**\n * class Location\n *\n * Represents a character location in the source file\n *    this.line : integer - the line number\n *    this.character :integer - the character position within the line\n */\nLocation=__class__;var Location=Location(function Location(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (line, character) {\n\t\tif (arguments[0] instanceof Location) {\n\t\t\t// copy constructor\n\t\t\tthis.line = arguments[0].line;\n\t\t\tthis.character = arguments[0].character;\n\t\t} else {\n\t\t\t// default constructor\n\t\t\tthis.line = line || 1;\n\t\t\tthis.character = character || 0;\n\t\t}\n\t}\n\n\tthis.nextLine = function () { this.line++; this.character = 0; }\n\tthis.nextCharacter = function () { this.character++; }\n\tthis.toString = function () {\n\t\treturn '[ line ' + this.line + ', char ' + this.character + ' ]';\n\t}\n\n\tthis.toJSON = function () {\n\t\treturn {\n\t\t\t'line': this.line,\n\t\t\t'character': this.character\n\t\t};\n\t}\n});\n\n/**\n * class Tokenizer\n * \n * Reads tokens out of a string\n * \n */\nvar sdk_plugins_weeby_ui_layouts_parser_tokenizer=__class__;var Tokenizer = exports=sdk_plugins_weeby_ui_layouts_parser_tokenizer(function sdk_plugins_weeby_ui_layouts_parser_tokenizer(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (str) {\n\t\tthis.tokens = [];\n\t\tthis.src = str;\n\t\tthis.i = -1;\n\t\tthis.loc = new Location();\n\n\t\tthis._tokenOnLine = false;\n\t\t\n\t\tthis._lineComments = [];\n\t\tthis._comments = [];\n\n\t\tthis._commentBuffer = [];\n\t}\n\n\tthis.getComments = function () {\n\t\t\n\t\tif (this._lineComments.length) {\n\t\t\tvar lineComments = this._lineComments;\n\t\t\tthis._lineComments = [];\n\t\t}\n\n\t\tif (this._comments.length) {\n\t\t\tvar comments = this._comments;\n\t\t\tthis._comments = [];\n\t\t}\n\n\t\tif (comments || lineComments) {\n\t\t\treturn {\n\t\t\t\tlineComments: lineComments,\n\t\t\t\tcomments: comments\n\t\t\t};\n\t\t}\n\t}\n\n\tthis._getCommentBuffer = function () {\n\t\tif (this._commentBuffer.length) {\n\t\t\tvar comments = this._commentBuffer;\n\t\t\tthis._commentBuffer = [];\n\t\t}\n\n\t\treturn comments;\n\t}\n\n\tthis.getLocation = function () {\n\t\treturn new Location(this.loc);\n\t}\n\n\tthis.getNext = function (type) {\n\t\tdo {\n\t\t\tif (!this.tokens[0]) {\n\t\t\t\tthis._readLine();\n\t\t\t}\n\t\t\tvar token = this.tokens.shift();\n\t\t} while (type != 'newline' && token && token.type == 'newline');\n\n\t\tif (type && (!token || token.type != type)) {\n\t\t\tvar loc = this.getLocation();\n\t\t\tthrow new Error('Error at ' + loc + '. Expecting ' + type + '. Unexpected token: ' + JSON.stringify(token, null, '\\t'));\n\t\t}\n\n\t\tif (token) {\n\t\t\tif (token.lineComment) {\n\t\t\t\tthis._lineComments.push(token.lineComment);\n\t\t\t}\n\n\t\t\tif (token.comments) {\n\t\t\t\tthis._comments = this._comments.concat(token.comments);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn token;\n\t}\n\n\tthis.debug = function () {\n\t\tif (this.tokens.length < 4) {\n\t\t\tthis._readLine();\n\t\t\tthis._readLine();\n\t\t\tthis._readLine();\n\t\t\tthis._readLine();\n\t\t}\n\n\t\tconsole.log(' ' + this.getLocation() + ' <current token stack>: ', this.tokens.map(function (token) { return token.value == '\\n' ? '\\\\n' : token.value; }).join(','));\n\t}\n\n\tthis.peekNext = function () {\n\t\tthis.readTokens();\n\t\treturn this.tokens[0];\n\t}\n\n\tthis.hasNext = function () {\n\t\tthis.readTokens();\n\t\treturn !!this.tokens[0];\n\t}\n\n\tthis.readTokens = function () {\n\t\tif (!this.tokens[0]) {\n\t\t\tthis._readLine();\n\t\t}\n\t\t// this.debug();\n\t}\n\n\tthis._getChar = function () {\n\t\tif (this._isEndOfLine) {\n\t\t\tthis._isEndOfLine = false;\n\t\t\tthis.loc.nextLine();\n\t\t}\n\n\t\t++this.i;\n\t\tthis.loc.nextCharacter();\n\t\tvar c = this.src[this.i];\n\t\tif (c == '\\n') {\n\t\t\tthis._isEndOfLine = true;\n\t\t}\n\n\t\treturn c;\n\t}\n\n\tthis._advanceTo = function (target) {\n\t\tvar str = '';\n\t\tvar c;\n\t\twhile (true) {\n\t\t\tc = this._getChar();\n\t\t\tif (c == target) { break; }\n\t\t\tstr += c;\n\t\t};\n\n\t\treturn str;\n\t}\n\n\tthis._getType = function (value) {\n\t\tif (/[\\[\\]{})(]/.test(value)) {\n\t\t\treturn 'brace';\n\t\t}\n\n\t\t// if (/^(\\d+)?\\.?(\\d+)?$/.test(value)) {\n\t\t// \treturn 'number';\n\t\t// }\n\n\t\tif (value == ',') {\n\t\t\treturn 'comma';\n\t\t}\n\n\t\tif (value == '=') {\n\t\t\treturn 'assignment';\n\t\t}\n\n\t\tif (value == ':') {\n\t\t\treturn 'key';\n\t\t}\n\n\t\treturn 'word';\n\t}\n\n\tthis._readLine = function () {\n\n\t\tvar token = '';\n\t\tvar addedToken = false;\n\t\tvar readLine = false;\n\t\twhile (!readLine) {\n\t\t\tvar c = this._getChar();\n\t\t\tif (!c) {\n\t\t\t\t// console.log('eof');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (c) {\n\t\t\t\tcase '/':\n\t\t\t\t\ttoken += c;\n\t\t\t\t\tif (token == '//') {\n\t\t\t\t\t\ttoken = '';\n\t\t\t\t\t\tif (this._lineToken) {\n\t\t\t\t\t\t\tthis._lineToken.lineComment = this._advanceTo('\\n');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._commentBuffer.push(this._advanceTo('\\n'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// addToken(, 'comment');\n\t\t\t\t\tbreak;\n\t\t\t\tcase '\\n':\n\t\t\t\t\tif (addedToken) {\n\t\t\t\t\t\treadLine = true;\n\t\t\t\t\t}\n\n\t\t\t\t\taddToken.call(this, token);\n\t\t\t\t\taddToken.call(this, '\\n', 'newline');\n\t\t\t\t\tthis._lineToken = null; // reset flag\n\t\t\t\tcase '\\t':\n\t\t\t\tcase ' ':\n\t\t\t\t\taddToken.call(this, token);\n\t\t\t\t\tbreak;\n\t\t\t\tcase '(':\n\t\t\t\tcase ')':\n\t\t\t\tcase '[':\n\t\t\t\tcase ']':\n\t\t\t\tcase ':':\n\t\t\t\tcase '=':\n\t\t\t\tcase ',':\n\t\t\t\tcase ';':\n\t\t\t\t\taddToken.call(this, token);\n\t\t\t\t\taddToken.call(this, c);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\ttoken += c;\n\t\t\t}\n\t\t}\n\n\t\tfunction addToken(value, type) {\n\t\t\tif (!value) { return; }\n\n\t\t\tif (value == ';') { value = ','; }\n\n\t\t\taddedToken = true;\n\t\t\ttoken = '';\n\t\t\t\n\t\t\tvar tokenObj = {\n\t\t\t\tvalue: value,\n\t\t\t\ttype: type || this._getType(value),\n\t\t\t\tlocation: new Location(this.loc),\n\t\t\t\tcomments: this._getCommentBuffer()\n\t\t\t};\n\n\t\t\tthis.tokens.push(tokenObj);\n\n\t\t\tif (!this._lineToken) {\n\t\t\t\tthis._lineToken = tokenObj;\n\t\t\t}\n\t\t}\n\t}\n});\n\n","pre":true},"sdk/plugins/weeby/ui/layouts/parser/evaluator.js":{"path":"sdk/plugins/weeby/ui/layouts/parser/evaluator.js","friendlyPath":".ui.layouts.parser.evaluator","directory":"sdk/plugins/weeby/ui/layouts/parser/","filename":"evaluator.js","src":"jsio(\"import .util as objects\");\n\nvar sdk_plugins_weeby_ui_layouts_parser_evaluator=__class__;var Evaluator = exports=sdk_plugins_weeby_ui_layouts_parser_evaluator(function sdk_plugins_weeby_ui_layouts_parser_evaluator(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (rules) {\n\t\tthis.common = {\n\t\t\tstyles: {}\n\t\t};\n\n\t\tthis._rules = rules;\n\n\t\tthis.viewUID = 1000;\n\t\tthis.friendlyIdMap = {};\n\t}\n\n\tthis.getViewId = function (friendlyId) {\n\t\treturn this.friendlyIdMap[friendlyId];\n\t}\n\n\tthis.evaluate = function (data) {\n\t\tthis.computeStyles(data.styles);\n\n\t\tvar views = objects.getValues(data.views);\n\t\tthis.createComputedStyles(views);\n\t\tthis.applyStyles(views, data.styles);\n\t\tthis.cleanComputedStyles(views);\n\n\t\treturn data;\n\t}\n\n\tthis.createComputedStyles = function (views) {\n\t\tviews.forEach(function (view) {\n\t\t\tview.computed = {\n\t\t\t\ttype: view.type,\n\t\t\t\tstyle: {},\n\t\t\t\tstates: {},\n\t\t\t\ttag: view.id,\n\t\t\t\tid: ++this.viewUID\n\t\t\t};\n\n\t\t\tif (view.id) {\n\t\t\t\tthis.friendlyIdMap[view.id] = view.computed.id;\n\t\t\t}\n\n\t\t\tif (view.type[0] == '$') {\n\t\t\t\tthis.friendlyIdMap[view.type] = view.computed.id;\n\t\t\t}\n\n\t\t\tif (view.children) {\n\t\t\t\tthis.createComputedStyles(view.children);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\tthis.applyStyles = function (views, styles) {\n\t\tviews.forEach(function (view) {\n\t\t\tview.params.concat(view.props).forEach(function (param) {\n\t\t\t\tthis.applyParam(styles, view, param);\n\t\t\t}, this);\n\n\t\t\tif (view.children) {\n\t\t\t\tthis.applyStyles(view.children, styles);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\tthis.cleanComputedStyles = function (views) {\n\t\tviews.forEach(function (view) {\n\t\t\tif (objects.isEmpty(view.computed.style)) {\n\t\t\t\tdelete view.computed.style;\n\t\t\t}\n\n\t\t\tif (objects.isEmpty(view.computed.states)) {\n\t\t\t\tdelete view.computed.states;\n\t\t\t}\n\n\t\t\tif (view.children) {\n\t\t\t\tthis.cleanComputedStyles(view.children);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\tthis.applyParam = function (styles, view, param) {\n\t\tvar computedView = view.computed;\n\n\t\tif (!param.key && param.value in styles) {\n\t\t\tthis.applyStyle(computedView, styles[param.value]);\n\t\t} else if (param.value in this.common.styles) {\n\t\t\tthis.applyStyle(computedView, this.common.styles[param.value]);\n\t\t} else if (param.value in this._rules.keywords) {\n\t\t\tthis._rules.keywords[param.value](computedView);\n\t\t} else if (param.key && param.value) {\n\t\t\tthis.setStyle(param.where, computedView.style, param.key, param.value);\n\t\t} else {\n\t\t\tconsole.log('[warn] unexpected param:', (param.key ? param.key + ' ' : '') + param.value, param.where);\n\t\t}\n\t}\n\n\tthis.applyStyle = function (computedView, style) {\n\t\tvar props = style.computed.props;\n\t\tif (props) {\n\t\t\tfor (var key in props) {\n\t\t\t\tif (!('key' in computedView.style)) {\n\t\t\t\t\tthis.setStyle(null, computedView.style, key, props[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// mergeObj(props, computedView.style);\n\t\t}\n\n\t\tvar states = style.computed.states;\n\t\tif (states) {\n\t\t\tobjects.forEach(states, function (name, state) {\n\t\t\t\tif (name in computedView.states) {\n\t\t\t\t\tmergeObj(computedView.states[name], state);\n\t\t\t\t} else {\n\t\t\t\t\tvar computedState = computedView.states[name] = {};\n\t\t\t\t\tfor (var key in state) {\n\t\t\t\t\t\tthis.setStyle(null, computedState, key, state[key]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\n\t\tif (style.defaultState) {\n\t\t\tcomputedView.defaultState = style.defaultState;\n\t\t}\n\t}\n\n\t/**\n\t * Resolves style dependencies in three easy steps:\n\t * \n\t *  1. compute dependencies: determine which styles depend on \n\t *     other styles by looking at the style params.\n\t * \n\t *  2. resolve dependencies: iterate over all dependencies and \n\t *     perform a merge between the two.  If we didn't change any\n\t *     keys then stop.  Otherwise, repeat until we converge.\n\t *     This resolves circular dependencies nicely (keep copying\n\t *     around the circle until nothing changes).\n\t */\n\tthis.computeStyles = function (styles) {\n\t\t// 1. compute dependencies\n\t\tvar toResolve = [];\n\t\tobjects.forEach(styles, function (key, style) {\n\n\t\t\tstyle.computed = {\n\t\t\t\tprops: {},\n\t\t\t\tstates: {},\n\t\t\t\twhere: {\n\t\t\t\t\tprops: {},\n\t\t\t\t\tstates: {}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tstyle.props.forEach(function (prop) {\n\t\t\t\tstyle.computed.props[prop.key] = prop.value;\n\t\t\t\tstyle.computed.where.props[prop.key] = prop.where;\n\t\t\t});\n\n\t\t\tstyle.states.forEach(function (state) {\n\t\t\t\tvar computedState = style.computed.states[state.name] = {};\n\t\t\t\tvar where = style.computed.where.states[state.name] = {};\n\t\t\t\tstate.props.forEach(function (prop) {\n\t\t\t\t\tcomputedState[prop.key] = prop.value;\n\t\t\t\t\twhere[prop.key] = prop.where;\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tstyle.computed.defaultState = style.defaultState;\n\t\t});\n\n\t\tobjects.forEach(styles, function (key, style) {\n\t\t\tstyle.parents.forEach(function (parent) {\n\t\t\t\tvar name = parent.value;\n\t\t\t\tif (name in styles) {\n\t\t\t\t\t// resolve style names against styles in the same set first\n\t\t\t\t\ttoResolve.push({\n\t\t\t\t\t\tfrom: styles[name].computed,\n\t\t\t\t\t\tto: style.computed\n\t\t\t\t\t});\n\t\t\t\t} else if (name in this.common.styles) {\n\t\t\t\t\t// then resolve styles against other sets\n\t\t\t\t\ttoResolve.push({\n\t\t\t\t\t\tfrom: this.common.styles[name],\n\t\t\t\t\t\tto: style.computed\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('[warn] Unknown parent style:', name, parent.where);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}, this);\n\n\t\t// 2. resolve dependencies by copying\n\t\tvar iter = 0;\n\t\tvar MAX_ITER = 500;\n\t\tdo {\n\t\t\tvar changed = false;\n\t\t\ttoResolve.forEach(function (resolve) {\n\t\t\t\t// copy style states\n\t\t\t\tvar to = resolve.to;\n\t\t\t\tvar from = resolve.from;\n\t\t\t\tfor (var state in from.states) {\n\t\t\t\t\t// copy state if it doesn't exist\n\t\t\t\t\tif (!(state in to.states)) {\n\t\t\t\t\t\tto.states[state] = {};\n\t\t\t\t\t\tto.where.states[state] = {};\n\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var key in from.states[state]) {\n\t\t\t\t\t\tif (!to.states[state][key]) {\n\t\t\t\t\t\t\tto.states[state][key] = from.states[state][key];\n\t\t\t\t\t\t\tto.where.states[state][key] = from.where.states[state][key];\n\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// copy style props\n\t\t\t\tchanged |= mergeObj(resolve.from.props, resolve.to.props);\n\t\t\t}, this);\n\t\t} while (changed && ++iter < MAX_ITER);\n\n\t\t// 3. simplify\n\t\tobjects.forEach(styles, function (key, style) {\n\n\t\t\t// remove empty styles\n\n\t\t\tvar hasProps = true;\n\t\t\tif (objects.isEmpty(style.computed.props)) {\n\t\t\t\tdelete style.computed.props;\n\t\t\t\thasProps = false;\n\t\t\t}\n\n\t\t\tobjects.forEach(style.computed.states, function (key, state) {\n\t\t\t\tif (objects.isEmpty(state)) {\n\t\t\t\t\tdelete style.computed.states[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar hasStates = true;\n\t\t\tif (objects.isEmpty(style.computed.states)) {\n\t\t\t\tdelete style.computed.states;\n\t\t\t\thasStates = false;\n\t\t\t}\n\n\t\t\tif (!hasProps && !hasStates) {\n\t\t\t\tdelete styles[key];\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction coerceString(value) {\n\t\t// color and number post-parsing\n\t\tif (value == 'true') {\n\t\t\tvalue = true;\n\t\t} else if (value == 'false') {\n\t\t\tvalue = false;\n\t\t} else if (value.match && (match = value.match(/^#(.)(.)(.)$/))) {\n\t\t\t// does it look like a hex color shorthand? Convert #123 -> #112233\n\t\t\tvalue = '#' + match[1] + match[1] + match[2] + match[2] + match[3] + match[3];\n\t\t} else if (parseInt(value) == value) {\n\t\t\t// does it look like an integer?\n\t\t\tvalue = parseInt(value);\n\t\t} else if (parseFloat(value) == value) {\n\t\t\t// does it look like a float?\n\t\t\tvalue = parseFloat(value);\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tthis.error = function (key, where /*, [msg...] */) {\n\t\tthrow new Error('Error at ' + where + ' parsing key ' + key + ':' + Array.prototype.slice.call(arguments, 2).join(' '));\n\t}\n\n\tthis.setStyle = function (where, style, key, value) {\n\t\t// camel case any dash-separated strings\n\t\tif (/-/.test(key)) {\n\t\t\tkey = key.replace(/-./g, function (str) { return str[1].toUpperCase(); });\n\t\t}\n\n\t\tif (typeof value == 'string') {\n\t\t\tvalue = coerceString(value);\n\t\t} else if (isArray(value)) {\n\t\t\tvalue = value.map(coerceString);\n\t\t}\n\n\t\t// apply correct rule\n\t\tif (key in this._rules.rules) {\n\t\t\tthis._rules.rules[key](this, where, style, key, value);\n\t\t} else {\n\t\t\tthis._rules.rules['default'](this, where, style, key, value);\n\t\t}\n\t}\n\n\tfunction mergeObj(from, to) {\n\t\tvar changed = false;\n\t\tfor (var key in from) {\n\t\t\tif (!(key in to)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t}\n\t\treturn changed;\n\t}\n});\n","pre":true},"sdk/plugins/weeby/ui/layouts/parser/timestep/rules.js":{"path":"sdk/plugins/weeby/ui/layouts/parser/timestep/rules.js","friendlyPath":".ui.layouts.parser.timestep.rules","directory":"sdk/plugins/weeby/ui/layouts/parser/timestep/","filename":"rules.js","src":"jsio(\"import ui.resource.Font as Font\");\n\nvar rules = exports.rules = {};\nvar keywords = exports.keywords = {};\n\n// TODO: hardcoded\nvar IMAGE_DIR = 'addons/weeby/theme/images/';\n\nrules['default'] = function (evaluator, where, style, key, value) {\n\tstyle[key] = value;\n}\n\nrules.background = function (evaluator, where, style, key, value) {\n\tif (isArray(value)) {\n\t\tvalue.forEach(function (value) {\n\t\t\tif (value == 'cover' || value == 'contain' || /slice$/.test(value)) {\n\t\t\t\tevaluator.setStyle(where, style, 'scaleMethod', value);\n\t\t\t} else if (value == 'top' || value == 'middle' || value == 'bottom') {\n\t\t\t\tevaluator.setStyle(where, style, 'verticalAlign', value);\n\t\t\t} else if (value == 'left' || value == 'right' || value == 'center') {\n\t\t\t\tevaluator.setStyle(where, style, 'align', value);\n\t\t\t} else if (value.charAt(0) == '#') {\n\t\t\t\tevaluator.setStyle(where, style, 'backgroundColor', value);\n\t\t\t} else {\n\t\t\t\tevaluator.setStyle(where, style, 'image', IMAGE_DIR + value);\n\t\t\t}\n\t\t});\n\t} else if (value.charAt(0) == '#') {\n\t\tevaluator.setStyle(where, style, 'backgroundColor', value);\n\t} else {\n\t\tevaluator.setStyle(where, style, 'image', IMAGE_DIR + value);\n\t}\n}\n\nfunction toFloat(value) { return parseFloat(value); }\nfunction toSlices(value) {\n\treturn {\n\t\thorizontal: {left: value[3], right: value[1]},\n\t\tvertical: {top: value[0], bottom: value[2]}\n\t};\n}\nfunction getInsets(value) {\n\tvar values;\n\tif (Array.isArray(value)) {\n\t\tif (value.length == 2) {\n\t\t\tvalues = [value[0], value[1], value[0], value[1]];\n\t\t} else if (value.length == 3) {\n\t\t\tvalues = [value[0], value[1], value[2], value[1]];\n\t\t} else if (value.length == 4) {\n\t\t\tvalues = value;\n\t\t}\n\t} else {\n\t\tvalues = [value, value, value, value];\n\t}\n\n\treturn values;\n}\n\nrules.slices = function (evaluator, where, style, key, value) {\n\tvalue = getInsets(value).map(toFloat);\n\tevaluator.setStyle(where, style, 'sourceSlices', toSlices(value));\n}\n\nrules.textInset = function (evaluator, where, style, key, value) {\n\tstyle.textInset = getInsets(value);\n}\n\nrules.switchFont = function (evaluator, where, style, key, value) {\n\tstyle.font = parseFont(value);\n}\n\nrules.size = function (evaluator, where, style, key, value) {\n\tif (typeof value == 'string') {\n\t\tvar dimensions = value.split('x');\n\t\tif (dimensions.length > 0) {\n\t\t\tevaluator.setStyle(where, style, 'width', dimensions[0]);\n\t\t}\n\n\t\tif (dimensions.length > 1) {\n\t\t\tevaluator.setStyle(where, style, 'height', dimensions[1]);\n\t\t} else {\n\t\t\tthrow new Error('Unexpected size at ' + where + ': ' + value);\n\t\t}\n\t} else {\n\t\tevaluator.setStyle(where, style, 'width', value);\n\t\tevaluator.setStyle(where, style, 'height', value);\n\t}\n}\n\nrules.margin =\nrules.padding = function (evaluator, where, style, key, value) {\n\tstyle[key] = getInsets(value);\n}\n\nvar weights = {normal: 1, bold: 1, bolder: 1, lighter: 1};\nvar styles = {normal: 1, italic: 1, oblique: 1};\n\n// hacky constants...\nvar defaultSize = '16px';\nvar defaultName = 'bpreplaybold';\n\nfunction parseFont(value) {\n\tif (!isArray(value)) {\n\t\tvalue = [value];\n\t}\n\n\tvar font = {};\n\tvar other = [];\n\tvar fontSize;\n\tvar fontWeight;\n\tvar fontStyle;\n\tvalue.forEach(function (value) {\n\t\tif (value.charAt(0) == '#') {\n\t\t\tif (!font.color) {\n\t\t\t\tfont.color = value;\n\t\t\t} else {\n\t\t\t\tfont.strokeColor = value;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tif (/^(\\d)+(px)?$/.test(value)) {\n\t\t\tif (!fontSize) {\n\t\t\t\tfontSize = value;\n\t\t\t} else {\n\t\t\t\tfont.strokeWidth = parseInt(value);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (value in weights) {\n\t\t\tfontWeight = value;\n\t\t\treturn false;\n\t\t} else if (value in styles) {\n\t\t\tfontStyle = value;\n\t\t\treturn false;\n\t\t}\n\n\t\tother.push(value);\n\t});\n\n\tvar fontData = Font.parse((fontWeight || '') + ' ' + (fontStyle || '') + ' ' + (fontSize || defaultSize) + ' ' + (other.length && other.join(' ') || defaultName));\n\tvar size = fontData.getSize();\n\tif (size) {\n\t\tfont.size = size;\n\t}\n\n\tvar name = fontData.getName();\n\tif (name) {\n\t\tfont.fontFamily = name;\n\t}\n\n\treturn font;\n}\n\n// parse \"12px Helvetica\"\nrules.font = function (evaluator, where, style, key, value) {\n\tvar font = parseFont(value);\n\tObject.keys(font).forEach(function (key) {\n\t\tstyle[key] = font[key];\n\t});\n}\n\nexports.getComputedViews = function (tree) {\n\tvar res = {};\n\tfor (var key in tree.views) {\n\t\tvar view = tree.views[key];\n\t\tres[key] = view.computed;\n\t\tif (view.children) {\n\t\t\tres[key].children = getComputedViews(view.children);\n\t\t}\n\t}\n\treturn res;\n\n\tfunction getComputedViews(views) {\n\t\treturn views.map(function (view) {\n\t\t\tvar computed = view.computed;\n\t\t\tif (view.children.length) {\n\t\t\t\tcomputed.children = getComputedViews(view.children);\n\t\t\t}\n\t\t\treturn computed;\n\t\t});\n\t}\n}\n","pre":true}});// this file is included at the end of the embedded JS

// it's responsible for initializing the js.io environment

;(function() {
	function getCwd() { return NATIVE.location.substring(0, NATIVE.location.lastIndexOf('/') + 1) + 'code/__cmd__/'; }
	NATIVE.console.log(NATIVE.location);
	
	var mobileEnv = function(util) {
		var SLICE = Array.prototype.slice,
			cwd = null;
				
		this.name = /android/.test(GLOBAL.userAgent) ? 'android' : 'ios';
	
		this.global = GLOBAL;
		this.global.jsio = jsio;
	
		this.log = function() { NATIVE.console.log(SLICE.call(arguments).join(' ')); }
		this.getCwd = getCwd;
		this.getPath = function() { return './sdk/jsio/'; };
		this.eval = function(code, path) { return NATIVE.eval(code, path); };
		this.fetch = function(filePath) {
			if (filePath.substring(0, 4) != 'http') {
				var parts = this.getCwd().match(/^(https?):\/\/(.*)$/);
				this.log('cwd is ' + this.getCwd());
				filePath = parts[1] + '://' + util.resolveRelativePath(parts[2] + filePath);
			}
			return NATIVE.getFileSync(filePath);
		}
	}
	
//TODO detect which name to pass
	jsio.setEnv(mobileEnv);
	
	// jsio.path.add('./sdk');
	// jsio.path.add('./sdk/gc/api');
	// jsio.path.add('./sdk/lib');
	// jsio.path.add('.');
})();
